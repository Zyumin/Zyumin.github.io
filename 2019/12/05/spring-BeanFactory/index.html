<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>spring-BeanFactory | Zyumin</title>
  <meta name="keywords" content=" spring , beanFactory ">
  <meta name="description" content="spring-BeanFactory | Zyumin">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="为了将事情做好，首先你得喜欢做这件事，而不是喜欢这件事的结果，那仅仅是第二位。">
<meta property="og:type" content="website">
<meta property="og:title" content="tags">
<meta property="og:url" content="http://zyumin.github.io/tags/index.html">
<meta property="og:site_name" content="Zyumin">
<meta property="og:description" content="为了将事情做好，首先你得喜欢做这件事，而不是喜欢这件事的结果，那仅仅是第二位。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2019-03-23T07:09:38.000Z">
<meta property="article:modified_time" content="2019-03-23T07:09:56.000Z">
<meta property="article:author" content="zhengyumin">
<meta property="article:tag" content="java">
<meta name="twitter:card" content="summary">


<link rel="icon" href="/img/avatar.png">

<link href="/css/style.css?v=1.1.0" rel="stylesheet">

<link href="/css/hl_theme/github-gist.css?v=1.1.0" rel="stylesheet">

<link href="//cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" rel="stylesheet">

<script src="//cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="/js/titleTip.js?v=1.1.0" ></script>

<script src="//cdn.jsdelivr.net/npm/highlightjs@9.16.2/highlight.pack.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script>



<script src="//cdn.jsdelivr.net/npm/jquery.cookie@1.4.1/jquery.cookie.min.js" ></script>

<script src="/js/iconfont.js?v=1.1.0" ></script>

<meta name="generator" content="Hexo 6.2.0"></head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="">
  <input class="theme_blog_path" value="">
  <input id="theme_shortcut" value="true" />
  <input id="theme_highlight_on" value="true" />
  <input id="theme_code_copy" value="true" />
</div>



<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/"
   class="avatar_target">
    <img class="avatar"
         src="/img/avatar.png"/>
</a>
<div class="author">
    <span>zhengyumin</span>
</div>

<div class="icon">
    
        
            <a title="github"
               href="https://github.com/Zyumin"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-github"></use>
                    </svg>
                
            </a>
        
    
        
            <a title="neteasemusic"
               href="https://music.163.com/#/user/home?id=60037019"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-neteasemusic"></use>
                    </svg>
                
            </a>
        
    
</div>




<ul>
    <li>
        <div class="all active" data-rel="全部文章">全部文章
            
                <small>(56)</small>
            
        </div>
    </li>
    
        
            
                <li>
                    <div data-rel="design">
                        
                        design
                        <small>(1)</small>
                        
                    </div>
                    
                </li>
            
        
    
        
            
                <li>
                    <div data-rel="java">
                        
                        java
                        <small>(9)</small>
                        
                    </div>
                    
                </li>
            
        
    
        
            
                <li>
                    <div data-rel="jdk">
                        
                        jdk
                        <small>(13)</small>
                        
                    </div>
                    
                </li>
            
        
    
        
            
                <li>
                    <div data-rel="mysql">
                        
                        mysql
                        <small>(2)</small>
                        
                    </div>
                    
                </li>
            
        
    
        
            
                <li>
                    <div data-rel="redis">
                        
                        redis
                        <small>(4)</small>
                        
                    </div>
                    
                </li>
            
        
    
        
            
                <li>
                    <div data-rel="spring">
                        
                        spring
                        <small>(12)</small>
                        
                    </div>
                    
                </li>
            
        
    
</ul>
<div class="left-bottom">
    <div class="menus">
        
            
            
            
    </div>
    <div>
        
            <a class="about  site_url"
               
               href="/about">关于</a>
        
        
    </div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="56">
<input type="hidden" id="yelog_site_word_count" value="230.7k">
<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        友情链接
        <i class="iconfont icon-left"></i>
    </div>
    <div class="friends-content">
        <ul>
            
            <li><a target="_blank" href="http://yelog.org/">叶落阁</a></li>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <div class="right-top">
        <div id="default-panel">
            <i class="iconfont icon-search" data-title="搜索 快捷键 i"></i>
            <div class="right-title">全部文章</div>
            <i class="iconfont icon-file-tree" data-title="切换到大纲视图 快捷键 w"></i>
        </div>
        <div id="search-panel">
            <i class="iconfont icon-left" data-title="返回"></i>
            <input id="local-search-input" autocomplete="off"/>
            <label class="border-line" for="input"></label>
            <i class="iconfont icon-case-sensitive" data-title="大小写敏感"></i>
            <i class="iconfont icon-tag" data-title="标签"></i>
        </div>
        <div id="outline-panel" style="display: none">
            <div class="right-title">大纲</div>
            <i class="iconfont icon-list" data-title="切换到文章列表"></i>
        </div>
    </div>

    <div class="tags-list">
    <input id="tag-search" />
    <div class="tag-wrapper">
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>aop</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>applicationContext</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>beanFactory</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>classLoader</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>collections</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>ddd</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>design</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>distributed</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>doc</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>ejb</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>elasticsearch</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>event</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>file</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>framework</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>gc</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>hbase</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>hotspot</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>io</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>ioc</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>j2ee</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>java</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>jdk</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>job</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>juc</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>jvm</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>kafka</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>lang</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>map</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>mysql</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>netty</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>nio</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>note</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>packages</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>patten</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>redis</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>serialization</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>servlet</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>spark</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Spec</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>spring</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>spring-mvc</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>spring-webflux</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>summary</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>thread</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>tomcat</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>utils</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>zookeeper</a>
            </li>
        
    </div>

</div>

    
    <div id="local-search-result">

    </div>
    
    <nav id="title-list-nav">
        
        
        <a id="top" class="全部文章 java "
           href="/2019/02/02/Overview_java/"
           data-tag="summary"
           data-author="" >
            <span class="post-title" title="Overview_java">Overview_java</span>
            <span class="post-date" title="2019-02-02 20:43:14">2019/02/02</span>
        </a>
        
        
        <a id="top" class="全部文章 spring "
           href="/2019/03/02/Overview_Spring/"
           data-tag="spring,framework"
           data-author="" >
            <span class="post-title" title="Overview-Spring">Overview-Spring</span>
            <span class="post-date" title="2019-03-02 12:29:06">2019/03/02</span>
        </a>
        
        
        <a id="top" class="全部文章 jdk "
           href="/2019/06/13/Overview_JDK/"
           data-tag="jdk,hotspot"
           data-author="" >
            <span class="post-title" title="Overview_JDK">Overview_JDK</span>
            <span class="post-date" title="2019-06-13 19:36:54">2019/06/13</span>
        </a>
        
        
        <a id="top" class="全部文章 java "
           href="/2020/05/10/%E9%9D%A2%E8%AF%95%E5%B8%B8%E8%A7%81%E7%9F%A5%E8%AF%86%E7%82%B9%E6%A2%B3%E7%90%86/"
           data-tag="job"
           data-author="" >
            <span class="post-title" title="面试常见知识点梳理">面试常见知识点梳理</span>
            <span class="post-date" title="2020-05-10 23:46:06">2020/05/10</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2023/01/20/%E9%82%A3%E4%BA%9B%E4%BB%A3%E7%A0%81%E8%AF%A5%E6%80%8E%E4%B9%88%E6%B5%8B/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="那些代码该怎么测">那些代码该怎么测</span>
            <span class="post-date" title="2023-01-20 10:54:09">2023/01/20</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2023/01/01/%E5%B7%A5%E7%A8%8B%E5%B8%88%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/"
           data-tag="java"
           data-author="" >
            <span class="post-title" title="工程师的自我修养">工程师的自我修养</span>
            <span class="post-date" title="2023-01-01 19:52:34">2023/01/01</span>
        </a>
        
        
        <a  class="全部文章 design "
           href="/2022/07/31/%E6%B5%85%E8%B0%88%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1/"
           data-tag="design,patten,ddd"
           data-author="" >
            <span class="post-title" title="浅谈软件设计">浅谈软件设计</span>
            <span class="post-date" title="2022-07-31 00:45:09">2022/07/31</span>
        </a>
        
        
        <a  class="全部文章 java "
           href="/2021/01/13/GC%E8%B0%83%E4%BC%98%E6%80%BB%E7%BB%93/"
           data-tag="jvm,gc,summary"
           data-author="" >
            <span class="post-title" title="GC调优总结">GC调优总结</span>
            <span class="post-date" title="2021-01-13 21:36:01">2021/01/13</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2020/03/18/Overview-Hbase/"
           data-tag="distributed,hbase,framework"
           data-author="" >
            <span class="post-title" title="Overview_Hbase">Overview_Hbase</span>
            <span class="post-date" title="2020-03-18 22:00:51">2020/03/18</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2020/03/18/Overview-Spark/"
           data-tag="distributed,framework,spark"
           data-author="" >
            <span class="post-title" title="Overview_Spark">Overview_Spark</span>
            <span class="post-date" title="2020-03-18 22:00:43">2020/03/18</span>
        </a>
        
        
        <a  class="全部文章 redis "
           href="/2020/02/28/Redis%E9%9B%86%E7%BE%A4%E7%AF%87/"
           data-tag="framework,redis"
           data-author="" >
            <span class="post-title" title="Redis集群篇">Redis集群篇</span>
            <span class="post-date" title="2020-02-28 18:52:52">2020/02/28</span>
        </a>
        
        
        <a  class="全部文章 redis "
           href="/2020/02/28/Redis%E5%AE%9E%E6%88%98%E7%AF%87/"
           data-tag="framework,redis"
           data-author="" >
            <span class="post-title" title="Redis实战篇">Redis实战篇</span>
            <span class="post-date" title="2020-02-28 18:52:43">2020/02/28</span>
        </a>
        
        
        <a  class="全部文章 redis "
           href="/2020/02/28/Redis%E5%8E%9F%E7%90%86%E7%AF%87/"
           data-tag="framework,redis"
           data-author="" >
            <span class="post-title" title="Redis原理篇">Redis原理篇</span>
            <span class="post-date" title="2020-02-28 18:52:35">2020/02/28</span>
        </a>
        
        
        <a  class="全部文章 spring "
           href="/2020/01/23/spring-aop/"
           data-tag="spring,aop"
           data-author="" >
            <span class="post-title" title="spring-aop">spring-aop</span>
            <span class="post-date" title="2020-01-23 23:54:29">2020/01/23</span>
        </a>
        
        
        <a  class="全部文章 spring "
           href="/2020/01/16/Spring-ApplicationContext/"
           data-tag="spring,applicationContext"
           data-author="" >
            <span class="post-title" title="Spring-ApplicationContext">Spring-ApplicationContext</span>
            <span class="post-date" title="2020-01-16 21:04:45">2020/01/16</span>
        </a>
        
        
        <a  class="全部文章 spring "
           href="/2019/12/05/spring-BeanFactory/"
           data-tag="spring,beanFactory"
           data-author="" >
            <span class="post-title" title="spring-BeanFactory">spring-BeanFactory</span>
            <span class="post-date" title="2019-12-05 21:28:57">2019/12/05</span>
        </a>
        
        
        <a  class="全部文章 spring "
           href="/2019/12/02/spring-Q-A/"
           data-tag="spring"
           data-author="" >
            <span class="post-title" title="spring Q&amp;A">spring Q&amp;A</span>
            <span class="post-date" title="2019-12-02 18:20:38">2019/12/02</span>
        </a>
        
        
        <a  class="全部文章 spring "
           href="/2019/10/29/Documentation-Spring-Core-IOC/"
           data-tag="spring,doc"
           data-author="" >
            <span class="post-title" title="Documentation-Spring_Core_IOC">Documentation-Spring_Core_IOC</span>
            <span class="post-date" title="2019-10-29 21:51:07">2019/10/29</span>
        </a>
        
        
        <a  class="全部文章 jdk "
           href="/2019/09/26/JDK-Packages-java-nio/"
           data-tag="jdk,packages,nio"
           data-author="" >
            <span class="post-title" title="JDK_Packages_java_nio">JDK_Packages_java_nio</span>
            <span class="post-date" title="2019-09-26 10:39:22">2019/09/26</span>
        </a>
        
        
        <a  class="全部文章 jdk "
           href="/2019/09/23/JDK-Packages-java-io/"
           data-tag="jdk,packages,io,serialization,file"
           data-author="" >
            <span class="post-title" title="JDK_Packages_java_io">JDK_Packages_java_io</span>
            <span class="post-date" title="2019-09-23 16:07:43">2019/09/23</span>
        </a>
        
        
        <a  class="全部文章 jdk "
           href="/2019/08/31/JDK-Class/"
           data-tag="jdk"
           data-author="" >
            <span class="post-title" title="JDK_Class">JDK_Class</span>
            <span class="post-date" title="2019-08-31 19:38:34">2019/08/31</span>
        </a>
        
        
        <a  class="全部文章 jdk "
           href="/2019/08/31/JDK-Thread/"
           data-tag="jvm,jdk,hotspot"
           data-author="" >
            <span class="post-title" title="JDK_Thread">JDK_Thread</span>
            <span class="post-date" title="2019-08-31 18:16:08">2019/08/31</span>
        </a>
        
        
        <a  class="全部文章 java "
           href="/2019/08/29/JVM-main%E6%96%B9%E6%B3%95%E5%88%86%E6%9E%90/"
           data-tag="jvm,java"
           data-author="" >
            <span class="post-title" title="JVM_main方法分析">JVM_main方法分析</span>
            <span class="post-date" title="2019-08-29 23:38:13">2019/08/29</span>
        </a>
        
        
        <a  class="全部文章 jdk "
           href="/2019/08/24/JDK-ReentrantLock/"
           data-tag="juc,jdk"
           data-author="" >
            <span class="post-title" title="JDK_ReentrantLock">JDK_ReentrantLock</span>
            <span class="post-date" title="2019-08-24 18:48:54">2019/08/24</span>
        </a>
        
        
        <a  class="全部文章 java "
           href="/2019/08/17/JVM-Synchronized/"
           data-tag="jvm"
           data-author="" >
            <span class="post-title" title="JVM_Synchronized">JVM_Synchronized</span>
            <span class="post-date" title="2019-08-17 17:01:54">2019/08/17</span>
        </a>
        
        
        <a  class="全部文章 java "
           href="/2019/08/11/Overview-Java-Virtual-Machine/"
           data-tag="jvm"
           data-author="" >
            <span class="post-title" title="Overview_Java Virtual Machine">Overview_Java Virtual Machine</span>
            <span class="post-date" title="2019-08-11 19:05:38">2019/08/11</span>
        </a>
        
        
        <a  class="全部文章 jdk "
           href="/2019/08/11/JDK-Packages-java-lang/"
           data-tag="jdk,packages,lang"
           data-author="" >
            <span class="post-title" title="JDK_Packages_java_lang">JDK_Packages_java_lang</span>
            <span class="post-date" title="2019-08-11 19:04:56">2019/08/11</span>
        </a>
        
        
        <a  class="全部文章 jdk "
           href="/2019/08/11/JDK-Packages-java-utils/"
           data-tag="jdk,packages,utils"
           data-author="" >
            <span class="post-title" title="JDK_Packages_java_utils">JDK_Packages_java_utils</span>
            <span class="post-date" title="2019-08-11 19:04:25">2019/08/11</span>
        </a>
        
        
        <a  class="全部文章 jdk "
           href="/2019/08/10/JDK-The-Concurrent-Framework/"
           data-tag="juc,jdk"
           data-author="" >
            <span class="post-title" title="JDK_The Concurrent Framework">JDK_The Concurrent Framework</span>
            <span class="post-date" title="2019-08-10 19:45:39">2019/08/10</span>
        </a>
        
        
        <a  class="全部文章 jdk "
           href="/2019/07/29/JDK-The-Collections-Framework/"
           data-tag="jdk,collections"
           data-author="" >
            <span class="post-title" title="JDK_The Collections Framework">JDK_The Collections Framework</span>
            <span class="post-date" title="2019-07-29 15:26:01">2019/07/29</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2019/07/10/Note-%E7%A0%81%E5%86%9C%E7%BF%BB%E8%BA%AB/"
           data-tag="java,note"
           data-author="" >
            <span class="post-title" title="Note_码农翻身">Note_码农翻身</span>
            <span class="post-date" title="2019-07-10 22:18:56">2019/07/10</span>
        </a>
        
        
        <a  class="全部文章 jdk "
           href="/2019/07/06/JDK-ClassLoader/"
           data-tag="jdk,classLoader"
           data-author="" >
            <span class="post-title" title="JDK_ClassLoader">JDK_ClassLoader</span>
            <span class="post-date" title="2019-07-06 23:12:51">2019/07/06</span>
        </a>
        
        
        <a  class="全部文章 spring "
           href="/2019/07/03/spring-ApplicationContext%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%E5%92%8C%E4%BA%8B%E4%BB%B6%E6%9C%BA%E5%88%B6/"
           data-tag="classLoader,spring,servlet,tomcat,event"
           data-author="" >
            <span class="post-title" title="spring-ApplicationContext启动流程和事件机制">spring-ApplicationContext启动流程和事件机制</span>
            <span class="post-date" title="2019-07-03 09:37:08">2019/07/03</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2019/06/26/Overview_Elasticsearch/"
           data-tag="framework,elasticsearch"
           data-author="" >
            <span class="post-title" title="Overview_Elasticsearch">Overview_Elasticsearch</span>
            <span class="post-date" title="2019-06-26 18:06:48">2019/06/26</span>
        </a>
        
        
        <a  class="全部文章 jdk "
           href="/2019/06/24/J-U-C-ConcurrentHashMap/"
           data-tag="juc,map"
           data-author="" >
            <span class="post-title" title="J.U.C_ConcurrentHashMap">J.U.C_ConcurrentHashMap</span>
            <span class="post-date" title="2019-06-24 19:03:29">2019/06/24</span>
        </a>
        
        
        <a  class="全部文章 java "
           href="/2019/06/19/JVM-Garbage-Collection/"
           data-tag="jvm,gc"
           data-author="" >
            <span class="post-title" title="JVM_Garbage Collection">JVM_Garbage Collection</span>
            <span class="post-date" title="2019-06-19 00:28:10">2019/06/19</span>
        </a>
        
        
        <a  class="全部文章 jdk "
           href="/2019/06/16/J-U-C-InterruptedException/"
           data-tag="juc"
           data-author="" >
            <span class="post-title" title="J.U.C_InterruptedException">J.U.C_InterruptedException</span>
            <span class="post-date" title="2019-06-16 16:09:43">2019/06/16</span>
        </a>
        
        
        <a  class="全部文章 java "
           href="/2019/06/14/Spec-JSR133/"
           data-tag="jvm,Spec,thread"
           data-author="" >
            <span class="post-title" title="Spec_JSR133">Spec_JSR133</span>
            <span class="post-date" title="2019-06-14 19:26:57">2019/06/14</span>
        </a>
        
        
        <a  class="全部文章 java "
           href="/2019/06/13/Spec-Java-Virtual-Machine/"
           data-tag="jvm,Spec"
           data-author="" >
            <span class="post-title" title="Spec_Java Virtual Machine">Spec_Java Virtual Machine</span>
            <span class="post-date" title="2019-06-13 17:25:17">2019/06/13</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2019/06/12/Overview_Kafka/"
           data-tag="framework,kafka"
           data-author="" >
            <span class="post-title" title="kafka深入浅出">kafka深入浅出</span>
            <span class="post-date" title="2019-06-12 20:05:37">2019/06/12</span>
        </a>
        
        
        <a  class="全部文章 redis "
           href="/2019/06/10/Overview_Redis/"
           data-tag="framework,redis"
           data-author="" >
            <span class="post-title" title="redis深入浅出">redis深入浅出</span>
            <span class="post-date" title="2019-06-10 18:33:40">2019/06/10</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2019/06/06/Note_java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%9A%84%E8%89%BA%E6%9C%AF/"
           data-tag="juc,java,note"
           data-author="" >
            <span class="post-title" title="Note_java并发编程的艺术">Note_java并发编程的艺术</span>
            <span class="post-date" title="2019-06-06 19:05:01">2019/06/06</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2019/06/05/Overview_Netty/"
           data-tag="nio,framework,netty"
           data-author="" >
            <span class="post-title" title="Netty深入浅出">Netty深入浅出</span>
            <span class="post-date" title="2019-06-05 22:01:31">2019/06/05</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2019/06/05/Note_%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/"
           data-tag="jvm,java,note"
           data-author="" >
            <span class="post-title" title="Note_深入理解java虚拟机">Note_深入理解java虚拟机</span>
            <span class="post-date" title="2019-06-05 21:12:25">2019/06/05</span>
        </a>
        
        
        <a  class="全部文章 mysql "
           href="/2019/06/04/Overview_MySQL/"
           data-tag="mysql"
           data-author="" >
            <span class="post-title" title="MySQL深入浅出">MySQL深入浅出</span>
            <span class="post-date" title="2019-06-04 22:02:31">2019/06/04</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2019/06/03/Overview_Zookeeper/"
           data-tag="distributed,framework,zookeeper"
           data-author="" >
            <span class="post-title" title="Zookeeper深入浅出">Zookeeper深入浅出</span>
            <span class="post-date" title="2019-06-03 21:15:05">2019/06/03</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2019/06/03/Overview_Distributed/"
           data-tag="distributed"
           data-author="" >
            <span class="post-title" title="分布式理论基础">分布式理论基础</span>
            <span class="post-date" title="2019-06-03 20:34:37">2019/06/03</span>
        </a>
        
        
        <a  class="全部文章 spring "
           href="/2019/04/10/spring-api-1-0/"
           data-tag="spring"
           data-author="" >
            <span class="post-title" title="spring-api-1.0">spring-api-1.0</span>
            <span class="post-date" title="2019-04-10 09:45:25">2019/04/10</span>
        </a>
        
        
        <a  class="全部文章 mysql "
           href="/2019/03/30/%E8%AE%B0%E4%B8%80%E6%AC%A1mysql%E6%9F%A5%E8%AF%A2in%E7%9A%84%E6%80%9D%E8%80%83/"
           data-tag="mysql"
           data-author="" >
            <span class="post-title" title="记一次mysql查询in的思考">记一次mysql查询in的思考</span>
            <span class="post-date" title="2019-03-30 20:39:49">2019/03/30</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2019/03/26/%E8%AE%B0%E4%B8%80%E6%AC%A1Broken-pipe%E9%97%AE%E9%A2%98%E7%9A%84%E6%80%9D%E8%80%83/"
           data-tag="tomcat"
           data-author="" >
            <span class="post-title" title="记一次Broken pipe问题的思考">记一次Broken pipe问题的思考</span>
            <span class="post-date" title="2019-03-26 10:53:37">2019/03/26</span>
        </a>
        
        
        <a  class="全部文章 spring "
           href="/2019/03/10/Note_Expert%20One-on-One-J2EE-Development-without-EJB/"
           data-tag="spring,j2ee,ejb"
           data-author="" >
            <span class="post-title" title="Expert One-on-One J2EE Development without EJB">Expert One-on-One J2EE Development without EJB</span>
            <span class="post-date" title="2019-03-10 19:45:57">2019/03/10</span>
        </a>
        
        
        <a  class="全部文章 spring "
           href="/2019/03/10/Note_Expert-One-on-One-J2EE-Design-and-Development/"
           data-tag="spring,j2ee"
           data-author="" >
            <span class="post-title" title="Expert One-on-One J2EE Design and Development">Expert One-on-One J2EE Design and Development</span>
            <span class="post-date" title="2019-03-10 19:45:18">2019/03/10</span>
        </a>
        
        
        <a  class="全部文章 spring "
           href="/2019/03/03/spring-Core-Container%E9%A2%84%E8%A7%88/"
           data-tag="spring,ioc"
           data-author="" >
            <span class="post-title" title="spring-Core-Container预览">spring-Core-Container预览</span>
            <span class="post-date" title="2019-03-03 14:51:56">2019/03/03</span>
        </a>
        
        
        <a  class="全部文章 spring "
           href="/2019/02/03/spring-mvc/"
           data-tag="spring,servlet,spring-mvc,spring-webflux"
           data-author="" >
            <span class="post-title" title="servlet_spring-mvc">servlet_spring-mvc</span>
            <span class="post-date" title="2019-02-03 15:50:16">2019/02/03</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2019/02/03/Overview_Tomcat/"
           data-tag="servlet,tomcat"
           data-author="" >
            <span class="post-title" title="servlet_tomcat">servlet_tomcat</span>
            <span class="post-date" title="2019-02-03 15:49:08">2019/02/03</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2019/02/02/Spec_Servlet/"
           data-tag="j2ee,servlet"
           data-author="" >
            <span class="post-title" title="j2ee_servlet">j2ee_servlet</span>
            <span class="post-date" title="2019-02-02 18:05:54">2019/02/02</span>
        </a>
        
        <div id="no-item-tips">

        </div>
    </nav>
    <div id="outline-list">
    </div>
</div>

    </div>
    <div class="hide-list">
        <div class="semicircle" data-title="切换全屏 快捷键 s">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div id="post">
    <div class="pjax">
        <article id="post-spring-BeanFactory" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">spring-BeanFactory</h1>
    
    <div class="article-meta">
        
        
        
        <span class="book">
            <i class="iconfont icon-category"></i>
            
            
            <a  data-rel="spring">spring</a>
            
        </span>
        
        
        <span class="tag">
            <i class="iconfont icon-tag"></i>
            
            <a class="color2">spring</a>
            
            <a class="color2">beanFactory</a>
            
        </span>
        
    </div>
    <div class="article-meta">
        
            发布时间 : <time class="date" title='最后更新: 2020-07-24 16:27:38'>2019-12-05 21:28</time>
        
    </div>
    <div class="article-meta">
        
        <span>字数:7k</span>
        
        
        <span id="busuanzi_container_page_pv">
            阅读 :<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%90%E6%8E%A5%E5%8F%A3"><span class="toc-text">子接口</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#HierarchicalBeanFactory"><span class="toc-text">HierarchicalBeanFactory</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ListableBeanFactory"><span class="toc-text">ListableBeanFactory</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AutowireCapableBeanFactory"><span class="toc-text">AutowireCapableBeanFactory</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ConfigurableBeanFactory"><span class="toc-text">ConfigurableBeanFactory</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ConfigurableListableBeanFactory"><span class="toc-text">ConfigurableListableBeanFactory</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%BB%98%E8%AE%A4%E5%AE%9E%E7%8E%B0"><span class="toc-text">默认实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#DefaultSingletonBeanRegistry"><span class="toc-text">DefaultSingletonBeanRegistry</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#earlySingletonObjects"><span class="toc-text">earlySingletonObjects</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#singletonFactories"><span class="toc-text">singletonFactories</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#singletonObjects"><span class="toc-text">singletonObjects</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BeanFactory"><span class="toc-text">BeanFactory</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#DefaultListableBeanFactory-getBean"><span class="toc-text">DefaultListableBeanFactory#getBean</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DefaultListableBeanFactory-resolveBean"><span class="toc-text">DefaultListableBeanFactory#resolveBean</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DefaultListableBeanFactory-resolveNamedBean"><span class="toc-text">DefaultListableBeanFactory#resolveNamedBean</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AbstractBeanFactory-GetBean"><span class="toc-text">AbstractBeanFactory#GetBean</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#x3D-x3D-AbstractBeanFactory-doGetBean-x3D-x3D"><span class="toc-text">&#x3D;&#x3D;AbstractBeanFactory#doGetBean&#x3D;&#x3D;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AbstractAutowireCapableBeanFactory-createBean"><span class="toc-text">AbstractAutowireCapableBeanFactory#createBean</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#x3D-x3D-AbstractAutowireCapableBeanFactory-doCreateBean-x3D-x3D"><span class="toc-text">&#x3D;&#x3D;AbstractAutowireCapableBeanFactory#doCreateBean&#x3D;&#x3D;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AbstractAutowireCapableBeanFactory-createBeanInstance"><span class="toc-text">AbstractAutowireCapableBeanFactory#createBeanInstance</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AbstractAutowireCapableBeanFactory-populateBean"><span class="toc-text">AbstractAutowireCapableBeanFactory#populateBean</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AbstractAutowireCapableBeanFactory-initializeBean"><span class="toc-text">AbstractAutowireCapableBeanFactory#initializeBean</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#x3D-x3D-Bean%E5%88%9D%E5%A7%8B%E5%8C%96%E6%B5%81%E7%A8%8B%E5%9B%BE-x3D-x3D"><span class="toc-text">&#x3D;&#x3D;Bean初始化流程图&#x3D;&#x3D;</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BeanDefinitionRegistry"><span class="toc-text">BeanDefinitionRegistry</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#BeanDefinition"><span class="toc-text">BeanDefinition</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BB%A7%E6%89%BF%E4%BD%93%E7%B3%BB"><span class="toc-text">继承体系</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#BeanDefinition%E4%BF%A1%E6%81%AF"><span class="toc-text">BeanDefinition信息</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#AbstractBeanDefinition"><span class="toc-text">AbstractBeanDefinition</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#RootBeanDefinition"><span class="toc-text">RootBeanDefinition</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ChildBeanDefinition"><span class="toc-text">ChildBeanDefinition</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#GenericBeanDefinition"><span class="toc-text">GenericBeanDefinition</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ConfigurationClassBeanDefinition"><span class="toc-text">ConfigurationClassBeanDefinition</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#AbstractBeanFactory-getMergedBeanDefinition"><span class="toc-text">AbstractBeanFactory#getMergedBeanDefinition</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#BeanDefinitionRegistry-1"><span class="toc-text">BeanDefinitionRegistry</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#BeanDefinitionReader"><span class="toc-text">BeanDefinitionReader</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#XmlBeanDefinitionReader"><span class="toc-text">XmlBeanDefinitionReader</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%80%E5%90%8E"><span class="toc-text">最后</span></a></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-4 i,
    .toc-level-4 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>今天来看看BeanFactory </p>
<ul>
<li><p>子接口都有哪些? 职责分别是哪些?</p>
</li>
<li><p>getBean 方法?Bean是怎么加载进来的?</p>
</li>
<li><p>BeanDefined的创建过程 ?BeanDefined的理解?</p>
</li>
<li><p>容器启动流程?</p>
</li>
</ul>
<p><strong>基础容器接口</strong></p>
<p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1g9m6s4c8c5j31c00hidhx.jpg" alt="image-20191205215235310"></p>
<p><strong>IOC时序图</strong></p>
<p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb8ma8csfvj32ga0pk7bm.jpg" alt="image-20200125105144265"></p>
<p><strong>DI 时序图</strong></p>
<p>![image-20200125104717425](&#x2F;Users&#x2F;zhengyumin&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20200125104717425.png)</p>
<h2 id="子接口"><a href="#子接口" class="headerlink" title="子接口"></a>子接口</h2><h3 id="HierarchicalBeanFactory"><a href="#HierarchicalBeanFactory" class="headerlink" title="HierarchicalBeanFactory"></a>HierarchicalBeanFactory</h3><p>新增继承关系的容器</p>
<pre><code class="java">public interface HierarchicalBeanFactory extends BeanFactory &#123;

   /**
    * Return the parent bean factory, or &#123;@code null&#125; if there is none.
    */
   @Nullable
   BeanFactory getParentBeanFactory();

   /**
    * Return whether the local bean factory contains a bean of the given name,
    * ignoring beans defined in ancestor contexts.
    * &lt;p&gt;This is an alternative to &#123;@code containsBean&#125;, ignoring a bean
    * of the given name from an ancestor bean factory.
    * @param name the name of the bean to query
    * @return whether a bean with the given name is defined in the local factory
    * @see BeanFactory#containsBean
    */
   boolean containsLocalBean(String name);

&#125;
</code></pre>
<h3 id="ListableBeanFactory"><a href="#ListableBeanFactory" class="headerlink" title="ListableBeanFactory"></a>ListableBeanFactory</h3><p>扩展BeanFactory接口,提供所有bean 实例的枚举,不再需要客户端通过一个个bean name查找.BeanFactory实现类预加载bean定义(如通过实现xml的工厂)需要实现这个接口.</p>
<p>如果一样实现了HierarchicalBeanFactory,返回值不会考虑父类BeanFactory,只考虑当前factory定义的类.当然也可以使用BeanFactoryUtils辅助类来查找祖先工厂中的类.</p>
<p>这个接口中的方法只会考虑本factory定义的bean.这些方法会忽略ConfigurableBeanFactory的registerSingleton注册的单例bean,getBeanNamesOfType和getBeansOfType是例外,一样会考虑手动注册的单例.当然BeanFactory的getBean一样可以透明访问这些特殊bean.当然在典型情况下,所有的bean都是由external bean定义,所以应用不需要顾虑这些差别.</p>
<p>注意:getBeanDefinitionCount和containsBeanDefinition的实现方法因为效率比较低,并不是供频繁调用的.</p>
<p>来源:  <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.1.RELEASE/javadoc-api/org/springframework/beans/factory/ListableBeanFactory.html">https://docs.spring.io/spring-framework/docs/5.2.1.RELEASE/javadoc-api/org/springframework/beans/factory/ListableBeanFactory.html</a> </p>
<pre><code class="java">public interface ListableBeanFactory extends BeanFactory &#123;
   boolean containsBeanDefinition(String beanName);
   int getBeanDefinitionCount();
   String[] getBeanDefinitionNames();
   String[] getBeanNamesForType(ResolvableType type);
   String[] getBeanNamesForType(@Nullable Class&lt;?&gt; type);
   String[] getBeanNamesForType(@Nullable Class&lt;?&gt; type, boolean includeNonSingletons, boolean allowEagerInit);
   &lt;T&gt; Map&lt;String, T&gt; getBeansOfType(@Nullable Class&lt;T&gt; type) throws BeansException;
   &lt;T&gt; Map&lt;String, T&gt; getBeansOfType(@Nullable Class&lt;T&gt; type, boolean includeNonSingletons, boolean allowEagerInit)
         throws BeansException;
   String[] getBeanNamesForAnnotation(Class&lt;? extends Annotation&gt; annotationType);
   Map&lt;String, Object&gt; getBeansWithAnnotation(Class&lt;? extends Annotation&gt; annotationType) throws BeansException;
   @Nullable
   &lt;A extends Annotation&gt; A findAnnotationOnBean(String beanName, Class&lt;A&gt; annotationType)
         throws NoSuchBeanDefinitionException;
&#125;
</code></pre>
<h3 id="AutowireCapableBeanFactory"><a href="#AutowireCapableBeanFactory" class="headerlink" title="AutowireCapableBeanFactory"></a>AutowireCapableBeanFactory</h3><p>新增了生命周期的管理、依赖能力, 其他框架的集成代码可以利用此接口来连接和填充Spring无法控制其生命周期的现有bean实例。</p>
<p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.1.RELEASE/javadoc-api/org/springframework/beans/factory/config/AutowireCapableBeanFactory.html">https://docs.spring.io/spring-framework/docs/5.2.1.RELEASE/javadoc-api/org/springframework/beans/factory/config/AutowireCapableBeanFactory.html</a></p>
<pre><code class="java">public interface AutowireCapableBeanFactory extends BeanFactory &#123;
    &lt;T&gt; T createBean(Class&lt;T&gt; beanClass) throws BeansException;
    void autowireBean(Object existingBean) throws BeansException;
    Object configureBean(Object existingBean, String beanName) throws BeansException;
    Object createBean(Class&lt;?&gt; beanClass, int autowireMode, boolean dependencyCheck) throws BeansException;
    Object autowire(Class&lt;?&gt; beanClass, int autowireMode, boolean dependencyCheck) throws BeansException;
    void autowireBeanProperties(Object existingBean, int autowireMode, boolean dependencyCheck)
            throws BeansException;
    void applyBeanPropertyValues(Object existingBean, String beanName) throws BeansException;
    Object initializeBean(Object existingBean, String beanName) throws BeansException;
    Object applyBeanPostProcessorsBeforeInitialization(Object existingBean, String beanName)
            throws BeansException;
    Object applyBeanPostProcessorsAfterInitialization(Object existingBean, String beanName)
            throws BeansException;
    void destroyBean(Object existingBean);
    &lt;T&gt; NamedBeanHolder&lt;T&gt; resolveNamedBean(Class&lt;T&gt; requiredType) throws BeansException;
    Object resolveDependency(DependencyDescriptor descriptor, String requestingBeanName) throws BeansException;
    Object resolveDependency(DependencyDescriptor descriptor, String requestingBeanName,
            Set&lt;String&gt; autowiredBeanNames, TypeConverter typeConverter) throws BeansException;
&#125;
</code></pre>
<h3 id="ConfigurableBeanFactory"><a href="#ConfigurableBeanFactory" class="headerlink" title="ConfigurableBeanFactory"></a>ConfigurableBeanFactory</h3><p>主要用于配置 BeanFactory,(scope、classLoader、beanPostProcess) 这个接口里面定义的方法通常都是供框架内部使用的, 不适用于通常的应用程序, 源码如下</p>
<pre><code class="java">public interface ConfigurableBeanFactory extends HierarchicalBeanFactory,
                                                 SingletonBeanRegistry &#123;
    String SCOPE_SINGLETON = &quot;singleton&quot;;
    String SCOPE_PROTOTYPE = &quot;prototype&quot;;

    void setParentBeanFactory(BeanFactory parentBeanFactory)
      throws IllegalStateException;

    // 设置 ClassLoader 的方法, 通常使用 setBeanClassLoader
    void setBeanClassLoader(@Nullable ClassLoader beanClassLoader);
    ClassLoader getBeanClassLoader();
    void setTempClassLoader(@Nullable ClassLoader tempClassLoader);
    ClassLoader getTempClassLoader();

    // 是否缓存 bean 的源数据, 默认为 true
    void setCacheBeanMetadata(boolean cacheBeanMetadata);
    boolean isCacheBeanMetadata();

    // 设置 SPEL 表达式解析器
    void setBeanExpressionResolver(@Nullable BeanExpressionResolver resolver);
    BeanExpressionResolver getBeanExpressionResolver();

    void setConversionService(@Nullable ConversionService conversionService);
    ConversionService getConversionService();

    // 设置属性编辑器
    void addPropertyEditorRegistrar(PropertyEditorRegistrar registrar);
    void registerCustomEditor(Class&lt;?&gt; requiredType,
                              Class&lt;? extends PropertyEditor&gt; propertyEditorClass);
    void copyRegisteredEditorsTo(PropertyEditorRegistry registry);

    // 设置类型转换器
    void setTypeConverter(TypeConverter typeConverter);
    TypeConverter getTypeConverter();

    void addEmbeddedValueResolver(StringValueResolver valueResolver);
    boolean hasEmbeddedValueResolver();
    String resolveEmbeddedValue(String value);

    // 设置 bean 后置处理器
    void addBeanPostProcessor(BeanPostProcessor beanPostProcessor);
    int getBeanPostProcessorCount();

    // 注册 scope
    void registerScope(String scopeName, Scope scope);
    String[] getRegisteredScopeNames();
    Scope getRegisteredScope(String scopeName);

    AccessControlContext getAccessControlContext();

    void copyConfigurationFrom(ConfigurableBeanFactory otherFactory);

    // 为 bean 设置添加别名
    void registerAlias(String beanName, String alias)
      throws BeanDefinitionStoreException;
    void resolveAliases(StringValueResolver valueResolver);

    BeanDefinition getMergedBeanDefinition(String beanName)
      throws NoSuchBeanDefinitionException;

    boolean isFactoryBean(String name) throws NoSuchBeanDefinitionException;

    void setCurrentlyInCreation(String beanName, boolean inCreation);
    boolean isCurrentlyInCreation(String beanName);

    void registerDependentBean(String beanName, String dependentBeanName);
    String[] getDependentBeans(String beanName);
    String[] getDependenciesForBean(String beanName);

    void destroyBean(String beanName, Object beanInstance);
    void destroyScopedBean(String beanName);
    void destroySingletons();
&#125;
</code></pre>
<h3 id="ConfigurableListableBeanFactory"><a href="#ConfigurableListableBeanFactory" class="headerlink" title="ConfigurableListableBeanFactory"></a>ConfigurableListableBeanFactory</h3><p>​	大多数可列出的bean工厂都将实现配置接口。 除了ConfigurableBeanFactory，它还提供了用于分析和修改Bean定义以及预先实例化单例的工具。<br>​	BeanFactory的此子接口不能在常规应用程序代码中使用：在典型使用情况下，请坚持使用BeanFactory或ListableBeanFactory。 即使需要访问bean工厂配置方法，该接口也仅允许框架内部即插即用。</p>
<p>注意: ApplicationContext中使用的就是ConfigurableListableBeanFactory</p>
<pre><code class="java">public interface ConfigurableListableBeanFactory
      extends ListableBeanFactory, AutowireCapableBeanFactory, ConfigurableBeanFactory &#123;
        void ignoreDependencyType(Class&lt;?&gt; type);	
        void ignoreDependencyInterface(Class&lt;?&gt; ifc);	
        void registerResolvableDependency(Class&lt;?&gt; dependencyType, @Nullable Object autowiredValue);
        boolean isAutowireCandidate(String beanName, DependencyDescriptor descriptor)
            throws NoSuchBeanDefinitionException;
        Iterator&lt;String&gt; getBeanNamesIterator();
        BeanDefinition getBeanDefinition(String beanName) throws NoSuchBeanDefinitionException;
        void clearMetadataCache();
        void freezeConfiguration();
        boolean isConfigurationFrozen();
        void preInstantiateSingletons() throws BeansException;
&#125;
</code></pre>
<h2 id="默认实现"><a href="#默认实现" class="headerlink" title="默认实现"></a>默认实现</h2><p>DefaultListableBeanFactory</p>
<pre><code class="java">public class DefaultListableBeanFactory extends AbstractAutowireCapableBeanFactory
      implements ConfigurableListableBeanFactory, BeanDefinitionRegistry, Serializable &#123;
  ...
&#125;
</code></pre>
<p>直接分析源码, 没什么目标会很迷茫 </p>
<p>所以我们带着各种问题来看看spring的源码</p>
<ul>
<li><p>spring是怎么解决循环依赖问题?</p>
</li>
<li><p>getBean 方法?Bean是怎么加载进来的?</p>
</li>
<li><p>BeanDefined的创建过程 ?BeanDefined的理解?</p>
</li>
<li><p>容器启动流程?</p>
</li>
</ul>
<p>先来看看继承体系</p>
<p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1g9m63mhdewj31vs0tyjxb.jpg" alt="image-20191205172006709"></p>
<p>对以上类简单介绍下:</p>
<p>FactoryBeanRegistrySupport 支持了类实例、别名、FactoryBean的注册、循环依赖的解决</p>
<p>*BeanFactory : 实现各种BeanFactory接口</p>
<p>BeanDefinitionRegistry :BeanDefintion注册</p>
<h3 id="DefaultSingletonBeanRegistry"><a href="#DefaultSingletonBeanRegistry" class="headerlink" title="DefaultSingletonBeanRegistry"></a>DefaultSingletonBeanRegistry</h3><pre><code class="java">public class DefaultSingletonBeanRegistry extends SimpleAliasRegistry implements SingletonBeanRegistry &#123;
/** Cache of singleton objects: bean name to bean instance. */
private final Map&lt;String, Object&gt; singletonObjects = new ConcurrentHashMap&lt;&gt;(256);

/** Cache of singleton factories: bean name to ObjectFactory. */
private final Map&lt;String, ObjectFactory&lt;?&gt;&gt; singletonFactories = new HashMap&lt;&gt;(16);

/** Cache of early singleton objects: bean name to bean instance. */
private final Map&lt;String, Object&gt; earlySingletonObjects = new HashMap&lt;&gt;(16);

/** Set of registered singletons, containing the bean names in registration order. */
private final Set&lt;String&gt; registeredSingletons = new LinkedHashSet&lt;&gt;(256);

/** Names of beans that are currently in creation. */
private final Set&lt;String&gt; singletonsCurrentlyInCreation =
      Collections.newSetFromMap(new ConcurrentHashMap&lt;&gt;(16));

/** Names of beans currently excluded from in creation checks. */
private final Set&lt;String&gt; inCreationCheckExclusions =
            Collections.newSetFromMap(new ConcurrentHashMap&lt;&gt;(16));
&#125;
</code></pre>
<p>(仔细看看上面各种类型,spring是怎么处理并发问题的)</p>
<p>这里是3个map用于存放singleton bean</p>
<ul>
<li>singletonObjects :存放已经初始化完成的beanName 和bean的映射缓存(注意线程安全)</li>
<li>earlySingletonObjects : 提前暴露的beanName 和bean的映射缓存</li>
<li>singletonFactories: 存放beanName 和ObjectFactory的映射缓存</li>
</ul>
<p>同时三个set</p>
<ul>
<li>registeredSingletons :用于存放已经注册的bean</li>
<li>singletonsCurrentlyInCreation: 当前正在创建的bean</li>
<li>inCreationCheckExclusions : 不需要检查是否正常创建中的bean</li>
</ul>
<p>而我们的关键是看看earlySingletonObjects这个map</p>
<p>什么样的对象可以放进去? </p>
<p>什么时候放进去?</p>
<p>(另外: 为什么需要singletonFactories?)</p>
<h4 id="earlySingletonObjects"><a href="#earlySingletonObjects" class="headerlink" title="earlySingletonObjects"></a>earlySingletonObjects</h4><p>–&gt;先看看earlySingletonObjects 是什么时候put对象进去的</p>
<pre><code class="java">/**
 * Return the (raw) singleton object registered under the given name.
 * &lt;p&gt;Checks already instantiated singletons and also allows for an early
 * reference to a currently created singleton (resolving a circular reference).
 * @param beanName the name of the bean to look for
 * @param allowEarlyReference whether early references should be created or not
 * @return the registered singleton object, or &#123;@code null&#125; if none found
 */
@Nullable
protected Object getSingleton(String beanName, boolean allowEarlyReference) &#123;
   //是否在一级缓存中,有的话直接返回
   Object singletonObject = this.singletonObjects.get(beanName);
  //如果不在缓存中,并且正在创建中(什么时候放进去?)
   if (singletonObject == null &amp;&amp; isSingletonCurrentlyInCreation(beanName)) &#123;
     //锁住singletonObjects ,解决循环依赖中等待的问题
      synchronized (this.singletonObjects) &#123;
         singletonObject = this.earlySingletonObjects.get(beanName);
            //不在二级缓存中,并且允许提前初始化引用
         if (singletonObject == null &amp;&amp; allowEarlyReference) &#123;
            ObjectFactory&lt;?&gt; singletonFactory = this.singletonFactories.get(beanName);
            if (singletonFactory != null) &#123;
               singletonObject = singletonFactory.getObject();
               //将bean提前暴露,并从移除singletonFactories(什么时候放进singletonFactories?)
               this.earlySingletonObjects.put(beanName, singletonObject);
               this.singletonFactories.remove(beanName);
            &#125;
         &#125;
      &#125;
   &#125;
   return singletonObject;
&#125;
</code></pre>
<p>可以发现是#getSingleton方法, 思考两个问题</p>
<ul>
<li>什么时候放进去singletonsCurrentlyInCreation?</li>
<li>什么时候放进singletonFactories?</li>
</ul>
<p>问题1–&gt; 在#beforeSingletonCreation方法中可以看到</p>
<pre><code class="java">protected void beforeSingletonCreation(String beanName) &#123;
  //是否在不需要检查的集合中,并且不在正在创建的集合中(循环依赖检查)
   if (!this.inCreationCheckExclusions.contains(beanName) &amp;&amp; !this.singletonsCurrentlyInCreation.add(beanName)) &#123;
      throw new BeanCurrentlyInCreationException(beanName);
   &#125;
&#125;
</code></pre>
<p>该方法在其父类中调用.</p>
<h4 id="singletonFactories"><a href="#singletonFactories" class="headerlink" title="singletonFactories"></a>singletonFactories</h4><p>在#addSingletonFactory中</p>
<pre><code class="java">/**
 * Add the given singleton factory for building the specified singleton
 * if necessary.
 * &lt;p&gt;To be called for eager registration of singletons, e.g. to be able to
 * resolve circular references.
 * @param beanName the name of the bean
 * @param singletonFactory the factory for the singleton object
 */
protected void addSingletonFactory(String beanName, ObjectFactory&lt;?&gt; singletonFactory) &#123;
   Assert.notNull(singletonFactory, &quot;Singleton factory must not be null&quot;);
   synchronized (this.singletonObjects) &#123;
      if (!this.singletonObjects.containsKey(beanName)) &#123;
         this.singletonFactories.put(beanName, singletonFactory);
         this.earlySingletonObjects.remove(beanName);
         this.registeredSingletons.add(beanName);
      &#125;
   &#125;
&#125;
</code></pre>
<p>问题2–&gt;可以发现registeredSingletons , singletonFactories 都在这里调用, 该方法在org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory#doCreateBean中调用</p>
<h4 id="singletonObjects"><a href="#singletonObjects" class="headerlink" title="singletonObjects"></a>singletonObjects</h4><p>我们再看下主角singletonObjects 是怎么初始化的</p>
<pre><code class="java">/**
 * Add the given singleton object to the singleton cache of this factory.
 * &lt;p&gt;To be called for eager registration of singletons.
 * @param beanName the name of the bean
 * @param singletonObject the singleton object
 */
protected void addSingleton(String beanName, Object singletonObject) &#123;
   synchronized (this.singletonObjects) &#123;
      this.singletonObjects.put(beanName, singletonObject);
      this.singletonFactories.remove(beanName);
      this.earlySingletonObjects.remove(beanName);
      this.registeredSingletons.add(beanName);
   &#125;
&#125;
</code></pre>
<p>addSingleton的调用在#registerSingleton 以及 getSingleton(String,ObjectFactory&lt;?&gt;)</p>
<pre><code class="java">@Override
public void registerSingleton(String beanName, Object singletonObject) throws IllegalStateException &#123;
   Assert.notNull(beanName, &quot;Bean name must not be null&quot;);
   Assert.notNull(singletonObject, &quot;Singleton object must not be null&quot;);
   synchronized (this.singletonObjects) &#123;
      Object oldObject = this.singletonObjects.get(beanName);
      if (oldObject != null) &#123;
         throw new IllegalStateException(&quot;Could not register object [&quot; + singletonObject +
               &quot;] under bean name &#39;&quot; + beanName + &quot;&#39;: there is already object [&quot; + oldObject + &quot;] bound&quot;);
      &#125;
      addSingleton(beanName, singletonObject);
   &#125;
&#125;
</code></pre>
<p>至此,DefaultSingletonBeanRegistry 的分析差不多了.</p>
<p>更多细节:<a target="_blank" rel="noopener" href="https://www.cnblogs.com/binarylei/p/10326046.html">https://www.cnblogs.com/binarylei/p/10326046.html</a></p>
<h3 id="BeanFactory"><a href="#BeanFactory" class="headerlink" title="BeanFactory"></a>BeanFactory</h3><p>接下来我们来看下完整的调用顺序 从BeanFactory#getBean(java.lang.Class<T>)说起</p>
<h4 id="DefaultListableBeanFactory-getBean"><a href="#DefaultListableBeanFactory-getBean" class="headerlink" title="DefaultListableBeanFactory#getBean"></a>DefaultListableBeanFactory#getBean</h4><pre><code class="java">@SuppressWarnings(&quot;unchecked&quot;)
@Override
public &lt;T&gt; T getBean(Class&lt;T&gt; requiredType, @Nullable Object... args) throws BeansException &#123;
   Object resolved = resolveBean(ResolvableType.forRawClass(requiredType), args, false);
   if (resolved == null) &#123;
      throw new NoSuchBeanDefinitionException(requiredType);
   &#125;
   return (T) resolved;
&#125;
</code></pre>
<h4 id="DefaultListableBeanFactory-resolveBean"><a href="#DefaultListableBeanFactory-resolveBean" class="headerlink" title="DefaultListableBeanFactory#resolveBean"></a>DefaultListableBeanFactory#resolveBean</h4><pre><code class="java">@Nullable
private &lt;T&gt; T resolveBean(ResolvableType requiredType, @Nullable Object[] args, boolean nonUniqueAsNull) &#123;
    //从当前容器中获取
    NamedBeanHolder&lt;T&gt; namedBean = resolveNamedBean(requiredType, args, nonUniqueAsNull);
    if (namedBean != null) &#123;
        return namedBean.getBeanInstance();
    &#125;
  //如果不存在,查询父容器是否存在
    BeanFactory parent = getParentBeanFactory();
    if (parent instanceof DefaultListableBeanFactory) &#123;
        return ((DefaultListableBeanFactory) parent).resolveBean(requiredType, args, nonUniqueAsNull);
    &#125;
    else if (parent != null) &#123;
        ObjectProvider&lt;T&gt; parentProvider = parent.getBeanProvider(requiredType);
        if (args != null) &#123;
            return parentProvider.getObject(args);
        &#125;
        else &#123;
            return (nonUniqueAsNull ? parentProvider.getIfUnique() : parentProvider.getIfAvailable());
        &#125;
    &#125;
    return null;
&#125;
</code></pre>
<h4 id="DefaultListableBeanFactory-resolveNamedBean"><a href="#DefaultListableBeanFactory-resolveNamedBean" class="headerlink" title="DefaultListableBeanFactory#resolveNamedBean"></a>DefaultListableBeanFactory#resolveNamedBean</h4><pre><code class="java">@SuppressWarnings(&quot;unchecked&quot;)
@Nullable
private &lt;T&gt; NamedBeanHolder&lt;T&gt; resolveNamedBean(
      ResolvableType requiredType, @Nullable Object[] args, boolean nonUniqueAsNull) throws BeansException &#123;

   Assert.notNull(requiredType, &quot;Required type must not be null&quot;);
   //检查所有的bean definitions. (bean definitions 时候写入? )
   String[] candidateNames = getBeanNamesForType(requiredType);

   //过滤处理
   if (candidateNames.length &gt; 1) &#123;
      List&lt;String&gt; autowireCandidates = new ArrayList&lt;&gt;(candidateNames.length);
      for (String beanName : candidateNames) &#123;
         if (!containsBeanDefinition(beanName) || getBeanDefinition(beanName).isAutowireCandidate()) &#123;
            autowireCandidates.add(beanName);
         &#125;
      &#125;
      if (!autowireCandidates.isEmpty()) &#123;
         candidateNames = StringUtils.toStringArray(autowireCandidates);
      &#125;
   &#125;

   if (candidateNames.length == 1) &#123;
      String beanName = candidateNames[0];
      //先只关注这里 ,只有一个候选的时候
      return new NamedBeanHolder&lt;&gt;(beanName, (T) getBean(beanName, requiredType.toClass(), args));
   &#125;
   else if (candidateNames.length &gt; 1) &#123;
      Map&lt;String, Object&gt; candidates = new LinkedHashMap&lt;&gt;(candidateNames.length);
      for (String beanName : candidateNames) &#123;
         if (containsSingleton(beanName) &amp;&amp; args == null) &#123;
            Object beanInstance = getBean(beanName);
            candidates.put(beanName, (beanInstance instanceof NullBean ? null : beanInstance));
         &#125;
         else &#123;
            candidates.put(beanName, getType(beanName));
         &#125;
      &#125;
      String candidateName = determinePrimaryCandidate(candidates, requiredType.toClass());
      if (candidateName == null) &#123;
         candidateName = determineHighestPriorityCandidate(candidates, requiredType.toClass());
      &#125;
      if (candidateName != null) &#123;
         Object beanInstance = candidates.get(candidateName);
         if (beanInstance == null || beanInstance instanceof Class) &#123;
            beanInstance = getBean(candidateName, requiredType.toClass(), args);
         &#125;
         return new NamedBeanHolder&lt;&gt;(candidateName, (T) beanInstance);
      &#125;
      if (!nonUniqueAsNull) &#123;
         throw new NoUniqueBeanDefinitionException(requiredType, candidates.keySet());
      &#125;
   &#125;

   return null;
&#125;
</code></pre>
<p>先只关注只有一个候选者的情况</p>
<h4 id="AbstractBeanFactory-GetBean"><a href="#AbstractBeanFactory-GetBean" class="headerlink" title="AbstractBeanFactory#GetBean"></a>AbstractBeanFactory#GetBean</h4><pre><code class="java">/**
 * Return an instance, which may be shared or independent, of the specified bean.
 * @param name the name of the bean to retrieve
 * @param requiredType the required type of the bean to retrieve
 * @param args arguments to use when creating a bean instance using explicit arguments
 * (only applied when creating a new instance as opposed to retrieving an existing one)
 * @return an instance of the bean
 * @throws BeansException if the bean could not be created
 */
public &lt;T&gt; T getBean(String name, @Nullable Class&lt;T&gt; requiredType, @Nullable Object... args)
      throws BeansException &#123;

   return doGetBean(name, requiredType, args, false);
&#125;
</code></pre>
<h4 id="x3D-x3D-AbstractBeanFactory-doGetBean-x3D-x3D"><a href="#x3D-x3D-AbstractBeanFactory-doGetBean-x3D-x3D" class="headerlink" title="&#x3D;&#x3D;AbstractBeanFactory#doGetBean&#x3D;&#x3D;"></a>&#x3D;&#x3D;AbstractBeanFactory#doGetBean&#x3D;&#x3D;</h4><pre><code class="java">protected &lt;T&gt; T doGetBean(final String name, @Nullable final Class&lt;T&gt; requiredType,
      @Nullable final Object[] args, boolean typeCheckOnly) throws BeansException &#123;
        
    //beanClass Name处理
    final String beanName = transformedBeanName(name);
    //缓存实例
    // Eagerly check singleton cache for manually registered singletons. 
        Object sharedInstance = getSingleton(beanName);
    ...
     //如果存在缓存直接调用
      if (sharedInstance != null &amp;&amp; args == null) &#123;
                   bean = getObjectForBeanInstance(sharedInstance, name, beanName, null);
     &#125;else&#123;
      //循环依赖检查
      // Fail if we&#39;re already creating this bean instance:
            // We&#39;re assumably within a circular reference.
            if (isPrototypeCurrentlyInCreation(beanName)) &#123;
                throw new BeanCurrentlyInCreationException(beanName);
            &#125;
            //父工厂检查
            // Check if bean definition exists in this factory.
            BeanFactory parentBeanFactory = getParentBeanFactory();
       
      //beanDefinition处理  
      final RootBeanDefinition mbd = getMergedLocalBeanDefinition(beanName);
            checkMergedBeanDefinition(mbd, beanName, args);
      
       //dependsOn处理  
      // Guarantee initialization of beans that the current bean depends on.
            String[] dependsOn = mbd.getDependsOn();
      registerDependentBean(dep, beanName);
            try &#123;
                 getBean(dep);
            &#125;
                ...
      //根据scope创建    
            // Create bean instance.
                if (mbd.isSingleton()) &#123;
                    sharedInstance = getSingleton(beanName, () -&gt; &#123;
                        try &#123;
                            return createBean(beanName, mbd, args);
                        &#125;
                        catch (BeansException ex) &#123;
         // Explicitly remove instance from singleton cache: It might have been put there
         // eagerly by the creation process, to allow for circular reference resolution.
         // Also remove any beans that received a temporary reference to the bean.
                            destroySingleton(beanName);
                            throw ex;
                        &#125;
                    &#125;);
                    bean = getObjectForBeanInstance(sharedInstance, name, beanName, mbd);
                &#125;      
    &#125;
&#125;
</code></pre>
<p>#transformedBeanName : 名字处理</p>
<p>#getSingleton  : 循环依赖和缓存</p>
<p>​	第一次调用getSingleton,这里返回 null ,因为缓存中不存在</p>
<p>​	第二次,调用getSingleton  DefaultSingletonBeanRegistry#getSingleton(java.lang.String, org.springframework.beans.factory.ObjectFactory&lt;?&gt;)</p>
<p>​	(其中调用了#beforeSingletonCreation (正在实例化的bean添加进去))</p>
<p>#getParentBeanFactory :  父容器查找(当前容器不存在) </p>
<p>#getMergedLocalBeanDefinition : beanDefinition处理,dependsOn处理</p>
<p>#createBean 创建bean逻辑</p>
<p>#getSingleton缓存bean </p>
<h4 id="AbstractAutowireCapableBeanFactory-createBean"><a href="#AbstractAutowireCapableBeanFactory-createBean" class="headerlink" title="AbstractAutowireCapableBeanFactory#createBean"></a>AbstractAutowireCapableBeanFactory#createBean</h4><pre><code class="java">protected Object createBean(String beanName, RootBeanDefinition mbd, @Nullable Object[] args)&#123;
    ...
        Class&lt;?&gt; resolvedClass = resolveBeanClass(mbd, beanName);
// Give BeanPostProcessors a chance to return a proxy instead of the target bean instance.
      try &#123;
      //InstantiationAwareBeanPostProcessor 去创建bean 
            Object bean = resolveBeforeInstantiation(beanName, mbdToUse);
            if (bean != null) &#123;
                return bean;
            &#125;
        &#125;
        catch (Throwable ex) &#123;
            throw new BeanCreationException(mbdToUse.getResourceDescription(), beanName,
                    &quot;BeanPostProcessor before instantiation of bean failed&quot;, ex);
        &#125;
        try &#123;
            Object beanInstance = doCreateBean(beanName, mbdToUse, args);
            if (logger.isTraceEnabled()) &#123;
                logger.trace(&quot;Finished creating instance of bean &#39;&quot; + beanName + &quot;&#39;&quot;);
            &#125;
            return beanInstance;
        &#125;
        catch (BeanCreationException | ImplicitlyAppearedSingletonException ex) &#123;
            // A previously detected exception with proper bean creation context already,
            // or illegal singleton state to be communicated up to DefaultSingletonBeanRegistry.
            throw ex;
        &#125;
        catch (Throwable ex) &#123;
            throw new BeanCreationException(
                    mbdToUse.getResourceDescription(), beanName, &quot;Unexpected exception during bean creation&quot;, ex);
        &#125;  
&#125;
</code></pre>
<p>tips : InstantiationAwareBeanPostProcessor 前置处理器</p>
<h4 id="x3D-x3D-AbstractAutowireCapableBeanFactory-doCreateBean-x3D-x3D"><a href="#x3D-x3D-AbstractAutowireCapableBeanFactory-doCreateBean-x3D-x3D" class="headerlink" title="&#x3D;&#x3D;AbstractAutowireCapableBeanFactory#doCreateBean&#x3D;&#x3D;"></a>&#x3D;&#x3D;AbstractAutowireCapableBeanFactory#doCreateBean&#x3D;&#x3D;</h4><pre><code class="java">protected Object doCreateBean(final String beanName, final RootBeanDefinition mbd, final @Nullable Object[] args)
      throws BeanCreationException &#123;
 // 实例化 Instantiate the bean.  在内存中创建了bean 属性还没填充
 //instantiation strategy :factory method, constructor autowiring, or simple instantiation.
    // 默认使用cglib
        instanceWrapper = createBeanInstance(beanName, mbd, args);
    
        // 允许后置处理器来修改这个BeanDefinition
        synchronized (mbd.postProcessingLock) &#123;
            if (!mbd.postProcessed) &#123;
                try &#123;
                    applyMergedBeanDefinitionPostProcessors(mbd, beanType, beanName);
                &#125;
                catch (Throwable ex) &#123;
                    throw new BeanCreationException(mbd.getResourceDescription(), beanName,
                            &quot;Post-processing of merged bean definition failed&quot;, ex);
                &#125;
                mbd.postProcessed = true;
            &#125;
        &#125; 	
        
  
    //提前暴露解决循环依赖问题
        boolean earlySingletonExposure = (mbd.isSingleton() &amp;&amp; this.allowCircularReferences &amp;&amp;
                isSingletonCurrentlyInCreation(beanName));
        if (earlySingletonExposure) &#123;
            if (logger.isTraceEnabled()) &#123;
                logger.trace(&quot;Eagerly caching bean &#39;&quot; + beanName +
                        &quot;&#39; to allow for resolving potential circular references&quot;);
            &#125; 
            addSingletonFactory(beanName, () -&gt; getEarlyBeanReference(beanName, mbd, bean));
        &#125;  
  
   // 初始化bean实例。
   //通过beanDefinition 填充BeanWrapper 属性值
        populateBean(beanName, mbd, instanceWrapper);

   //进行一些初始化方法的调用，比如afterPropertiesSet等等。
        exposedObject = initializeBean(beanName, exposedObject, mbd);  
  
    //提前暴露的类检查,防止非代理对象被提前暴露注入,导致两个bean不一致
        if (earlySingletonExposure) &#123;
            Object earlySingletonReference = getSingleton(beanName, false);
            if (earlySingletonReference != null) &#123;
                if (exposedObject == bean) &#123;
                    exposedObject = earlySingletonReference;
                &#125;
                else if (!this.allowRawInjectionDespiteWrapping &amp;&amp; hasDependentBean(beanName)) &#123;
                    String[] dependentBeans = getDependentBeans(beanName);
                    Set&lt;String&gt; actualDependentBeans = new LinkedHashSet&lt;&gt;(dependentBeans.length);
                    for (String dependentBean : dependentBeans) &#123;
                        if (!removeSingletonIfCreatedForTypeCheckOnly(dependentBean)) &#123;
                            actualDependentBeans.add(dependentBean);
                        &#125;
                    &#125;
                    if (!actualDependentBeans.isEmpty()) &#123;
                        throw new BeanCurrentlyInCreationException(beanName,
                                &quot;Bean with name &#39;&quot; + beanName + &quot;&#39; has been injected into other beans [&quot; +
                                StringUtils.collectionToCommaDelimitedString(actualDependentBeans) +
                                &quot;] in its raw version as part of a circular reference, but has eventually been &quot; +
                                &quot;wrapped. This means that said other beans do not use the final version of the &quot; +
                                &quot;bean. This is often the result of over-eager type matching - consider using &quot; +
                                &quot;&#39;getBeanNamesOfType&#39; with the &#39;allowEagerInit&#39; flag turned off, for example.&quot;);
                    &#125;
                &#125;
            &#125;
        &#125;    
   ...
   // Register bean as disposable.
        try &#123;
            registerDisposableBeanIfNecessary(beanName, bean, mbd);
        &#125;
&#125;
</code></pre>
<p>这里调用了addSingletonFactory</p>
<p>在 bean 初始化完成还后还需要进行依赖的检查，这时因为提前暴露的这个 bean(即使用工厂方法或构造方法创建出来的对象) initializeBean 还可以进行增强(例如aop代理)，这样这两个 bean 就不是同一个了。Spring 默认是不允许这种情况发生的。</p>
<h4 id="AbstractAutowireCapableBeanFactory-createBeanInstance"><a href="#AbstractAutowireCapableBeanFactory-createBeanInstance" class="headerlink" title="AbstractAutowireCapableBeanFactory#createBeanInstance"></a>AbstractAutowireCapableBeanFactory#createBeanInstance</h4><p>实例化</p>
<p>方式 根据工厂方法、构造函数、默认方式 </p>
<p>方法:CGLIB&#x2F;JDK</p>
<p>@see #instantiateUsingFactoryMethod<br>@see #autowireConstructor<br>@see #instantiateBean</p>
<h4 id="AbstractAutowireCapableBeanFactory-populateBean"><a href="#AbstractAutowireCapableBeanFactory-populateBean" class="headerlink" title="AbstractAutowireCapableBeanFactory#populateBean"></a>AbstractAutowireCapableBeanFactory#populateBean</h4><p>ibp.postProcessAfterInstantiation(bw.getWrappedInstance(), beanName)</p>
<p>autowireByName(beanName, mbd, bw, newPvs) or autowireByType(beanName, mbd, bw, newPvs);</p>
<p>pvsToUse &#x3D; ibp.postProcessPropertyValues(pvs, filteredPds, bw.getWrappedInstance(), beanName);</p>
<p>applyPropertyValues(beanName, mbd, bw, pvs);</p>
<h4 id="AbstractAutowireCapableBeanFactory-initializeBean"><a href="#AbstractAutowireCapableBeanFactory-initializeBean" class="headerlink" title="AbstractAutowireCapableBeanFactory#initializeBean"></a>AbstractAutowireCapableBeanFactory#initializeBean</h4><p>invokeAwareMethods</p>
<ul>
<li>@see BeanNameAware</li>
<li>@see BeanClassLoaderAware</li>
<li>@see BeanFactoryAware</li>
</ul>
<p>@see #applyBeanPostProcessorsBeforeInitialization</p>
<p>@see #invokeInitMethods</p>
<p>@see #applyBeanPostProcessorsAfterInitialization</p>
<p>至此getBean调用结束,可以通过调试模拟下</p>
<p>代码:</p>
<p>BeanClass 用于被加载的class</p>
<pre><code class="java">public class BeanClass &#123;
    public BeanClass() &#123;
        System.out.println(&quot;init...&quot;);
    &#125;

&#125;
</code></pre>
<p>BeanFactory引导类</p>
<pre><code class="java">public class ContainerStarter &#123;
    public static void main(String[] args) &#123;
        XmlBeanFactory xmlBeanFactory = new XmlBeanFactory(
                new ClassPathResource(&quot;application.xml&quot;));
        //获取Bean 实例
        xmlBeanFactory.getBean(BeanClass.class);
    &#125;
&#125;
</code></pre>
<p>resources目录下的xml配置文件</p>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;&gt;
    &lt;bean id=&quot;beanClass&quot; class=&quot;beanfatory.BeanClass&quot;&gt;&lt;/bean&gt;
&lt;/beans&gt;
</code></pre>
<h4 id="x3D-x3D-Bean初始化流程图-x3D-x3D"><a href="#x3D-x3D-Bean初始化流程图-x3D-x3D" class="headerlink" title="&#x3D;&#x3D;Bean初始化流程图&#x3D;&#x3D;"></a>&#x3D;&#x3D;Bean初始化流程图&#x3D;&#x3D;</h4><p>主要是在下面的两个类, 简单划分为两个阶段 </p>
<ul>
<li><p>准备阶段(AbstractBeanFactory#doGetBean)</p>
<ul>
<li>从缓存中获取</li>
<li>循环依赖检查</li>
<li>BeanDefinition检查、合并</li>
<li>依赖Bean检查、创建 (dependsOn)</li>
<li>根据scope创建</li>
</ul>
</li>
<li><p>实例化阶段(AbstractAutowireCapableBeanFactory#doCreateBean)</p>
<ul>
<li>允许InstantiationAwareBeanPostProcessor 返回代理 (AOP的实现, 代理也会回调BeanPostProcessor的处理)</li>
<li>实例化 (默认、工厂、构造函数)</li>
<li>MergedBeanDefinitionPostProcessor修改BeanDeinition</li>
<li>提前暴露Bean</li>
<li>属性填充</li>
<li>初始化(接口的回调)<ul>
<li>AwareMethods</li>
<li>BPP-Before</li>
<li>invokeMethods (afterProperts、init-method)</li>
<li>BBP-After</li>
</ul>
</li>
</ul>
<p>简单流程如下:</p>
</li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gazp1f340fj30zf02raa1.jpg" alt="Spirng 对 Bean 的处理"></p>
<p>详细的流程图可以参考某位大佬的:<a target="_blank" rel="noopener" href="https://blog.csdn.net/zghwaicsdn/article/details/50910384">https://blog.csdn.net/zghwaicsdn/article/details/50910384</a></p>
<h3 id="BeanDefinitionRegistry"><a href="#BeanDefinitionRegistry" class="headerlink" title="BeanDefinitionRegistry"></a>BeanDefinitionRegistry</h3><p>接下来看看BeanDefinition是什么,BeanDefinition是在哪里注册的,BeanDefinition是怎么来的</p>
<h4 id="BeanDefinition"><a href="#BeanDefinition" class="headerlink" title="BeanDefinition"></a>BeanDefinition</h4><h5 id="继承体系"><a href="#继承体系" class="headerlink" title="继承体系"></a>继承体系</h5><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1g9m63lra9zj31ra0ja0ws.jpg" alt="image-20191205212750684"></p>
<h5 id="BeanDefinition信息"><a href="#BeanDefinition信息" class="headerlink" title="BeanDefinition信息"></a>BeanDefinition信息</h5><p>先来看看BeanDefinition,BeanDefinition描述了一个bean实例，该实例具有属性值，构造函数参数值以及具体实现所提供的更多信息。</p>
<p>主要目的是允许 BeanFactoryPostProcessor,例如 PropertyPlaceholderConfigurer 内省和修改, 属性值和其他bean元数据。</p>
<p>获取上述的BeanClass 打印信息如下</p>
<pre><code class="java">Generic bean: class [beanfatory.BeanClass]; scope=; abstract=false; lazyInit=false; autowireMode=0; dependencyCheck=0; autowireCandidate=true; primary=false; factoryBeanName=null; factoryMethodName=null; initMethodName=null; destroyMethodName=null; defined in class path resource [application.xml]
</code></pre>
<p>可以得知 它具有哪些属性,以及它是一个GenericBeanDefinition</p>
<pre><code class="java">public interface BeanDefinition extends AttributeAccessor, BeanMetadataElement &#123;
    //scope值，单例还是非单例
    String SCOPE_SINGLETON = ConfigurableBeanFactory.SCOPE_SINGLETON;
    String SCOPE_PROTOTYPE = ConfigurableBeanFactory.SCOPE_PROTOTYPE;
  
    //Bean角色：
    //用户
    int ROLE_APPLICATION = 0;
    //某些复杂的配置
    int ROLE_SUPPORT = 1;
    //完全内部使用
    int ROLE_INFRASTRUCTURE = 2;

    //返回此bean定义的父bean定义的名称，如果有的话 &lt;bean parent=&quot;&quot;&gt;
    String getParentName();
    void setParentName(String parentName);

    //获取bean对象className &lt;bean class=&quot;&quot;&gt;
    String getBeanClassName();
    void setBeanClassName(String beanClassName);

    //定义创建该Bean对象的工厂类  &lt;bean factory-bean=&quot;&quot;&gt;
    String getFactoryBeanName();
    void setFactoryBeanName(String factoryBeanName);

    //定义创建该Bean对象的工厂方法 &lt;bean factory-method=&quot;&quot;&gt;
    String getFactoryMethodName();
    void setFactoryMethodName(String factoryMethodName);

    //&lt;bean scope=&quot;singleton/prototype&quot;&gt;
    String getScope();
    void setScope(String scope);

    //懒加载 &lt;bean lazy-init=&quot;true/false&quot;&gt;
    boolean isLazyInit();
    void setLazyInit(boolean lazyInit);

    //依赖对象  &lt;bean depends-on=&quot;&quot;&gt;
    String[] getDependsOn();
    void setDependsOn(String[] dependsOn);

    //是否为被自动装配 &lt;bean autowire-candidate=&quot;true/false&quot;&gt;
    boolean isAutowireCandidate();
    void setAutowireCandidate(boolean autowireCandidate);

    //是否为主候选bean    使用注解：@Primary
    boolean isPrimary();
    void setPrimary(boolean primary);

    //返回此bean的构造函数参数值。
    ConstructorArgumentValues getConstructorArgumentValues();

    //获取普通属性集合
    MutablePropertyValues getPropertyValues();

    boolean isSingleton();
    boolean isPrototype();
    boolean isAbstract();
    int getRole();

    //返回对bean定义的可读描述。
    String getDescription();
    //返回该bean定义来自的资源的描述（用于在出现错误时显示上下文）
    String getResourceDescription();
    BeanDefinition getOriginatingBeanDefinition();
&#125;
&#125;
</code></pre>
<h5 id="AbstractBeanDefinition"><a href="#AbstractBeanDefinition" class="headerlink" title="AbstractBeanDefinition"></a>AbstractBeanDefinition</h5><p>Base class for concrete, full-fledged {@link BeanDefinition} classes, factoring out common properties of {@link GenericBeanDefinition}, {@link RootBeanDefinition}, and {@link ChildBeanDefinition}.</p>
<pre><code class="java">public abstract class AbstractBeanDefinition extends BeanMetadataAttributeAccessor
      implements BeanDefinition, Cloneable &#123;
  ...
&#125;
</code></pre>
<p>BeanDefinition基础实现类,另外继承了BeanMetadataAttributeAccessor(元数据属性 )</p>
<pre><code class="java">public class BeanMetadataAttributeAccessor extends AttributeAccessorSupport implements BeanMetadataElement &#123;
    public void addMetadataAttribute(BeanMetadataAttribute attribute) &#123;
        super.setAttribute(attribute.getName(), attribute);
    &#125;
    @Nullable
    public BeanMetadataAttribute getMetadataAttribute(String name) &#123;
        return (BeanMetadataAttribute) super.getAttribute(name);
    &#125;
  ....
&#125;
public abstract class AttributeAccessorSupport implements AttributeAccessor, Serializable &#123;
    /** Map with String keys and Object values. */
    private final Map&lt;String, Object&gt; attributes = new LinkedHashMap&lt;&gt;();
  ...
&#125;
</code></pre>
<p>在AttributeAccessorSupport 中维护了k-name ,v-BeanMetadata 的map</p>
<p>BeanMetadataAttribute: Holder for a key-value style attribute that is part of a bean definition.<br>Keeps track of the definition source in addition to the key-value pair.</p>
<p>再来看看三个实现类</p>
<ul>
<li>GenericBeanDefinition </li>
<li>RootBeanDefinition </li>
<li>ChildBeanDefinition</li>
</ul>
<h5 id="RootBeanDefinition"><a href="#RootBeanDefinition" class="headerlink" title="RootBeanDefinition"></a>RootBeanDefinition</h5><p><em>A root bean definition represents the merged bean definition that backs a specific bean in a Spring BeanFactory at runtime.It might have been created from multiple original bean definitions that inherit from each other, typically registered as GenericBeanDefinitions. A root bean definition is essentially the ‘unified’ bean definition view at runtime.Root bean definitions may also be used for registering individual bean definitions in the configuration phase.</em> </p>
<p><em>However, since Spring 2.5, the preferred way to register bean definitions programmatically is the GenericBeanDefinition class. GenericBeanDefinition has the advantage that it allows to dynamically define parent dependencies, not ‘hard-coding’ the role as a root bean definition.</em> </p>
<p>root bean定义表示在运行时支持Spring BeanFactory中特定bean 的merge dbean定义。它可能是由多个相互继承的原始bean定义创建的，通常注册为genericbeandefinition。root bean定义本质上是运行时的“统一”bean定义视图。root bean定义也可以用于在配置阶段注册各个bean定义。</p>
<p>但是，自spring2.5以来，以编程方式注册bean定义的首选方法是GenericBeanDefinition类。GenericBeanDefinition的优点是它允许动态定义父依赖项，而不是将角色“硬编码”为root bean。</p>
<pre><code class="java">public class RootBeanDefinition extends AbstractBeanDefinition &#123;
    @Override
    public String getParentName() &#123;
        return null;
    &#125;

    @Override
    public void setParentName(@Nullable String parentName) &#123;
        if (parentName != null) &#123;
            throw new IllegalArgumentException(&quot;Root bean cannot be changed into a child bean with parent reference&quot;);
        &#125;
    &#125;
  ...
&#125;
</code></pre>
<h5 id="ChildBeanDefinition"><a href="#ChildBeanDefinition" class="headerlink" title="ChildBeanDefinition"></a>ChildBeanDefinition</h5><p><em>Bean definition for beans which inherit settings from their parent. Child bean definitions have a fixed dependency on a parent bean definition.</em><br><em>A child bean definition will inherit constructor argument values, property values and method overrides from the parent, with the option to add new values. If init method, destroy method and&#x2F;or static factory method are specified, they will override the corresponding parent settings. The remaining settings will always be taken from the child definition: depends on, autowire mode, dependency check, singleton, lazy init.</em></p>
<p><em>NOTE: Since Spring 2.5, the preferred way to register bean definitions programmatically is the GenericBeanDefinition class, which allows to dynamically define parent dependencies through the GenericBeanDefinition.setParentName(java.lang.String) method. This effectively supersedes the ChildBeanDefinition class for most use cases.</em></p>
<p>Bean定义，用于从父类继承设置的Bean。子bean定义对父bean定义有固定的依赖关系。</p>
<p>子bean定义将继承父类的构造函数参数值、属性值和方法重写，并可选择添加新值。如果指定了init方法、destroy方法和&#x2F;或静态工厂方法，它们将覆盖相应的父设置。</p>
<p>其余的设置将始终从子定义:依赖、自动装配模式、依赖项检查、单例、惰性初始化。</p>
<p>注意:自spring2.5以来，以编程方式注册bean定义的首选方法是GenericBeanDefinition类，它允许通过GenericBeanDefinition. setParentName (java.lang.String)方法动态定义父依赖项。对于大多数用例，这实际上取代了ChildBeanDefinition类。</p>
<pre><code class="java">public class ChildBeanDefinition extends AbstractBeanDefinition &#123;
        @Override
    public void setParentName(@Nullable String parentName) &#123;
        this.parentName = parentName;
    &#125;

    @Override
    @Nullable
    public String getParentName() &#123;
        return this.parentName;
    &#125;

    @Override
    public void validate() throws BeanDefinitionValidationException &#123;
        super.validate();
        if (this.parentName == null) &#123;
            throw new BeanDefinitionValidationException(&quot;&#39;parentName&#39; must be set in ChildBeanDefinition&quot;);
        &#125;
    &#125;
&#125;
</code></pre>
<p>可以看到从2.5开始 Child 和 Root 都被GenericBeanDefinition替代  ,其中重要的原因是允许动态定义父依赖</p>
<h5 id="GenericBeanDefinition"><a href="#GenericBeanDefinition" class="headerlink" title="GenericBeanDefinition"></a>GenericBeanDefinition</h5><p><em>GenericBeanDefinition is a one-stop shop for standard bean definition purposes. Like any bean definition, it allows for specifying a class plus optionally constructor argument values and property values. Additionally, deriving from a parent bean definition can be flexibly configured through the “parentName” property. In general, use this GenericBeanDefinition class for the purpose of registering user-visible bean definitions (which a post-processor might operate on, potentially even reconfiguring the parent name). Use RootBeanDefinition &#x2F; ChildBeanDefinition where parent&#x2F;child relationships happen to be pre-determined.</em></p>
<p>GenericBeanDefinition是标准bean定义的一站式服务。与任何bean定义一样，它允许指定一个类加上可选的构造函数参数值和属性值。此外，可以通过“parentName”属性灵活地配置来自父bean定义的派生。</p>
<p>通常，使用这个GenericBeanDefinition类的目的是注册用户可见的bean定义(后处理器可以对其进行操作，甚至可能重新配置父名称)。使用RootBeanDefinition &#x2F; ChildBeanDefinition来预先确定父&#x2F;子关系。</p>
<pre><code class="java">public class GenericBeanDefinition extends AbstractBeanDefinition &#123;
   @Nullable
   private String parentName;
   ...
  /**
     * Create a new GenericBeanDefinition, to be configured through its bean
     * properties and configuration methods.
     * @see #setBeanClass
     * @see #setScope
     * @see #setConstructorArgumentValues
     * @see #setPropertyValues
     */
    public GenericBeanDefinition() &#123;
        super();
    &#125;
&#125;
</code></pre>
<h5 id="ConfigurationClassBeanDefinition"><a href="#ConfigurationClassBeanDefinition" class="headerlink" title="ConfigurationClassBeanDefinition"></a>ConfigurationClassBeanDefinition</h5><pre><code class="java">class org.springframework.context.annotation.ConfigurationClassBeanDefinitionReader.ConfigurationClassBeanDefinition extends RootBeanDefinition implements AnnotatedBeanDefinition()&#123;
  
&#125;
/**
 * Build and validate a configuration model based on the registry of
 * &#123;@link Configuration&#125; classes.
 */
public void org.springframework.context.annotation.ConfigurationClassPostProcessor#processConfigBeanDefinitions(BeanDefinitionRegistry registry)&#123;
   
&#125;
</code></pre>
<p>更多细节:</p>
<p>@see ConfigurationClassPostProcessor</p>
<p>@see ConfigurationClassBeanDefinitionReader</p>
<p>@see ConfigurationClassParser</p>
<h5 id="AbstractBeanFactory-getMergedBeanDefinition"><a href="#AbstractBeanFactory-getMergedBeanDefinition" class="headerlink" title="AbstractBeanFactory#getMergedBeanDefinition"></a>AbstractBeanFactory#getMergedBeanDefinition</h5><pre><code class="java">/**
 * Return a RootBeanDefinition for the given bean, by merging with the
 * parent if the given bean&#39;s definition is a child bean definition.
 * @param beanName the name of the bean definition
 * @param bd the original bean definition (Root/ChildBeanDefinition)
 * @param containingBd the containing bean definition in case of inner bean,
 * or &#123;@code null&#125; in case of a top-level bean
 * @return a (potentially merged) RootBeanDefinition for the given bean
 * @throws BeanDefinitionStoreException in case of an invalid bean definition
 */
protected RootBeanDefinition getMergedBeanDefinition(
      String beanName, BeanDefinition bd, @Nullable BeanDefinition containingBd)
      throws BeanDefinitionStoreException &#123;

   synchronized (this.mergedBeanDefinitions) &#123;
      RootBeanDefinition mbd = null;

      // Check with full lock now in order to enforce the same merged instance.
      if (containingBd == null) &#123;
         mbd = this.mergedBeanDefinitions.get(beanName);
      &#125;

      if (mbd == null) &#123;
         if (bd.getParentName() == null) &#123;
            // Use copy of given root bean definition.
            if (bd instanceof RootBeanDefinition) &#123;
               mbd = ((RootBeanDefinition) bd).cloneBeanDefinition();
            &#125;
            else &#123;
               mbd = new RootBeanDefinition(bd);
            &#125;
         &#125;
         else &#123;
            // Child bean definition: needs to be merged with parent.
            BeanDefinition pbd;
            try &#123;
               String parentBeanName = transformedBeanName(bd.getParentName());
               if (!beanName.equals(parentBeanName)) &#123;
                  pbd = getMergedBeanDefinition(parentBeanName);
               &#125;
               else &#123;
                  BeanFactory parent = getParentBeanFactory();
                  if (parent instanceof ConfigurableBeanFactory) &#123;
                     pbd = ((ConfigurableBeanFactory) parent).getMergedBeanDefinition(parentBeanName);
                  &#125;
                  else &#123;
                     throw new NoSuchBeanDefinitionException(parentBeanName,
                           &quot;Parent name &#39;&quot; + parentBeanName + &quot;&#39; is equal to bean name &#39;&quot; + beanName +
                           &quot;&#39;: cannot be resolved without an AbstractBeanFactory parent&quot;);
                  &#125;
               &#125;
            &#125;
            catch (NoSuchBeanDefinitionException ex) &#123;
               throw new BeanDefinitionStoreException(bd.getResourceDescription(), beanName,
                     &quot;Could not resolve parent bean definition &#39;&quot; + bd.getParentName() + &quot;&#39;&quot;, ex);
            &#125;
            //进行深拷贝, 合并、 覆盖父类overridden方法 
            mbd = new RootBeanDefinition(pbd);
            mbd.overrideFrom(bd);
         &#125;

         // Set default singleton scope, if not configured before.
         if (!StringUtils.hasLength(mbd.getScope())) &#123;
            mbd.setScope(RootBeanDefinition.SCOPE_SINGLETON);
         &#125;

         // A bean contained in a non-singleton bean cannot be a singleton itself.
         // Let&#39;s correct this on the fly here, since this might be the result of
         // parent-child merging for the outer bean, in which case the original inner bean
         // definition will not have inherited the merged outer bean&#39;s singleton status.
         if (containingBd != null &amp;&amp; !containingBd.isSingleton() &amp;&amp; mbd.isSingleton()) &#123;
            mbd.setScope(containingBd.getScope());
         &#125;

         // Cache the merged bean definition for the time being
         // (it might still get re-merged later on in order to pick up metadata changes)
         if (containingBd == null &amp;&amp; isCacheBeanMetadata()) &#123;
            this.mergedBeanDefinitions.put(beanName, mbd);
         &#125;
      &#125;

      return mbd;
   &#125;
&#125;
</code></pre>
<ol>
<li>在mergedBeanDefinitions同步的情况下再次读取缓存，防止该BeanDefinition已经被合并过了。</li>
<li>检查是否有父类，若有父类，则必须递归去合并BeanDefinition。</li>
<li>将子类重写后的方法覆盖到定义的BeanDefinition中。</li>
<li>设置scope类型。</li>
<li>将生成的BeanDefinition缓存起来。</li>
</ol>
<h4 id="BeanDefinitionRegistry-1"><a href="#BeanDefinitionRegistry-1" class="headerlink" title="BeanDefinitionRegistry"></a>BeanDefinitionRegistry</h4><pre><code class="java">public interface BeanDefinitionRegistry extends AliasRegistry &#123;
        void registerBeanDefinition(String beanName, BeanDefinition beanDefinition)
            throws BeanDefinitionStoreException;
      void removeBeanDefinition(String beanName) throws NoSuchBeanDefinitionException;
      BeanDefinition getBeanDefinition(String beanName) throws NoSuchBeanDefinitionException;
        boolean containsBeanDefinition(String beanName);
        String[] getBeanDefinitionNames();
        int getBeanDefinitionCount();
        boolean isBeanNameInUse(String beanName);
&#125;
</code></pre>
<ol>
<li>首先是实现,实现方式是怎么样的?</li>
</ol>
<p>registerBeanDefinition 在哪里实现 , 可以定位到 DefaultListableBeanFactory中</p>
<pre><code class="java">//---------------------------------------------------------------------
// Implementation of BeanDefinitionRegistry interface
//---------------------------------------------------------------------

@Override
public void registerBeanDefinition(String beanName, BeanDefinition beanDefinition)
      throws BeanDefinitionStoreException &#123;
     //校验
   ((AbstractBeanDefinition) beanDefinition).validate();
        ...
     //已存在的处理
   BeanDefinition existingDefinition = this.beanDefinitionMap.get(beanName);
   if (existingDefinition != null) &#123;
      if (!isAllowBeanDefinitionOverriding()) &#123;
         throw new BeanDefinitionOverrideException(beanName, beanDefinition, existingDefinition);
      &#125;
            //省略日志打印
      this.beanDefinitionMap.put(beanName, beanDefinition);
   &#125;
   else &#123;
      if (hasBeanCreationStarted()) &#123;
         // Cannot modify startup-time collection elements anymore (for stable iteration)
         synchronized (this.beanDefinitionMap) &#123;
            this.beanDefinitionMap.put(beanName, beanDefinition);
            List&lt;String&gt; updatedDefinitions = new ArrayList&lt;&gt;(this.beanDefinitionNames.size() + 1);
            updatedDefinitions.addAll(this.beanDefinitionNames);
            updatedDefinitions.add(beanName);
            this.beanDefinitionNames = updatedDefinitions;
            if (this.manualSingletonNames.contains(beanName)) &#123;
               Set&lt;String&gt; updatedSingletons = new LinkedHashSet&lt;&gt;(this.manualSingletonNames);
               updatedSingletons.remove(beanName);
               this.manualSingletonNames = updatedSingletons;
            &#125;
         &#125;
      &#125;
      else &#123;
         // Still in startup registration phase
         this.beanDefinitionMap.put(beanName, beanDefinition);
         this.beanDefinitionNames.add(beanName);
         this.manualSingletonNames.remove(beanName);
      &#125;
      this.frozenBeanDefinitionNames = null;
   &#125;
   if (existingDefinition != null || containsSingleton(beanName)) &#123;
      resetBeanDefinition(beanName);
   &#125;
&#125;
</code></pre>
<p>简单来说就是干了以下的事情</p>
<p>this.beanDefinitionMap.put(beanName, beanDefinition);</p>
<p>this.beanDefinitionNames.add(beanName);</p>
<p>this.manualSingletonNames.remove(beanName);</p>
<ol start="2">
<li>那么在哪里调用?BeanDefinition是怎么来的?</li>
</ol>
<p>从XmlBeanFactory 中可以发现 XmlBeanDefinitionReader 的作用是loadBeanDefinitions ,那么我们先从其父类说起</p>
<img src="https://tva1.sinaimg.cn/large/006tNbRwgy1g9pqnrafenj30rw0fet9w.jpg" alt="image-20191208233705110" style="zoom:50%;" />

<h4 id="BeanDefinitionReader"><a href="#BeanDefinitionReader" class="headerlink" title="BeanDefinitionReader"></a>BeanDefinitionReader</h4><pre><code class="java">package org.springframework.beans.factory.support;

import org.springframework.beans.factory.BeanDefinitionStoreException;
import org.springframework.core.io.Resource;
import org.springframework.core.io.ResourceLoader;
import org.springframework.lang.Nullable;

/**
 * Simple interface for bean definition readers.
 * Specifies load methods with Resource and String location parameters.
 *
 * &lt;p&gt;Concrete bean definition readers can of course add additional
 * load and register methods for bean definitions, specific to
 * their bean definition format.
 *
 * &lt;p&gt;Note that a bean definition reader does not have to implement
 * this interface. It only serves as suggestion for bean definition
 * readers that want to follow standard naming conventions.
 *
 * @author Juergen Hoeller
 * @since 1.1
 * @see org.springframework.core.io.Resource
 */
public interface BeanDefinitionReader &#123;
   BeanDefinitionRegistry getRegistry();
   @Nullable
   ResourceLoader getResourceLoader();
   @Nullable
   ClassLoader getBeanClassLoader();
   BeanNameGenerator getBeanNameGenerator();

   int loadBeanDefinitions(Resource resource) throws BeanDefinitionStoreException;
   int loadBeanDefinitions(Resource... resources) throws BeanDefinitionStoreException;
   int loadBeanDefinitions(String location) throws BeanDefinitionStoreException;
   int loadBeanDefinitions(String... locations) throws BeanDefinitionStoreException;
&#125;
</code></pre>
<p>可以看到这个Reader 在整个BeanFactory中的重要性, 其作用根据接口我们可以猜测出是 资源定位 解析 注册</p>
<p>@see ResourceLoader</p>
<p>@see ClassLoader</p>
<p>@see BeanNameGenerator</p>
<h5 id="XmlBeanDefinitionReader"><a href="#XmlBeanDefinitionReader" class="headerlink" title="XmlBeanDefinitionReader"></a>XmlBeanDefinitionReader</h5><p>调用链请看</p>
<p>org.springframework.beans.factory.xml.XmlBeanDefinitionReader#registerBeanDefinitions</p>
<p>org.springframework.beans.factory.xml.DefaultBeanDefinitionDocumentReader#parseBeanDefinitions</p>
<p>org.springframework.beans.factory.xml.BeanDefinitionParserDelegate#parseBeanDefinitionElement(org.w3c.dom.Element)</p>
<p>org.springframework.beans.factory.support.BeanDefinitionReaderUtils#registerBeanDefinition</p>
<p>详细</p>
<p>@see AbstractBeanDefinitionReader</p>
<p>@see DefaultBeanDefinitionDocumentReader</p>
<p>@see BeanDefinitionParserDelegate</p>
<p>@see BeanDefinitionReaderUtils</p>
<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>todo 总结</p>

      
       <hr><span style="font-style: italic;color: gray;"> 转载请注明来源，欢迎对文章中的引用来源进行考证，欢迎指出任何有错误或不够清晰的表达。可以在下面评论区评论，也可以邮件至 951488791@qq.com </span>
    </div>
</article>



<div class="article_copyright">
    <p><span class="copy-title">文章标题:</span>spring-BeanFactory</p>
    <p><span class="copy-title">字数:</span><span class="post-count">7k</span></p>
    <p><span class="copy-title">本文作者:</span><a  title="zhengyumin">zhengyumin</a></p>
    <p><span class="copy-title">发布时间:</span>2019-12-05, 21:28:57</p>
    <p><span class="copy-title">最后更新:</span>2020-07-24, 16:27:38</p>
    <span class="copy-title">原始链接:</span><a class="post-url" href="/2019/12/05/spring-BeanFactory/" title="spring-BeanFactory">http://zyumin.github.io/2019/12/05/spring-BeanFactory/</a>
    <p>
        <span class="copy-title">版权声明:</span><i class="fa fa-creative-commons"></i> <a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">&#34;署名-非商用-相同方式共享 4.0&#34;</a> 转载请保留原文链接及作者。
    </p>
</div>





    




    </div>
    <div class="copyright">
        <p class="footer-entry">
    ©2016-2022 zhengyumin
</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full" data-title="切换全屏 快捷键 s"><span class="min "></span></button>
<a class="" id="rocket" ></a>

    </div>
</div>

</body>
<script src="/js/jquery.pjax.js?v=1.1.0" ></script>

<script src="/js/script.js?v=1.1.0" ></script>
<script>
    var img_resize = 'default';
    function initArticle() {
        /*渲染对应的表格样式*/
        
            $("#post .pjax table").addClass("green_title");
        

        /*渲染打赏样式*/
        

        /*高亮代码块行号*/
        
        $('pre code').each(function(){
            var lines = $(this).text().trim().split('\n').length, widther='';
            if (lines>99) {
                widther = 'widther'
            }
            var $numbering = $('<ul/>').addClass('pre-numbering ' + widther).attr("unselectable","on");
            $(this).addClass('has-numbering ' + widther)
                    .parent()
                    .append($numbering);
            for(var i=1;i<=lines;i++){
                $numbering.append($('<li/>').text(i));
            }
        });
        

        /*访问数量*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*代码高亮，行号对齐*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
        
    }

    /*打赏页面隐藏与展示*/
    

</script>

<!--加入行号的高亮代码块样式-->

<style>
    pre{
        position: relative;
        margin-bottom: 24px;
        border-radius: 10px;
        border: 1px solid #e2dede;
        background: #FFF;
        overflow: hidden;
    }
    code.has-numbering{
        margin-left: 30px;
    }
    code.has-numbering.widther{
        margin-left: 35px;
    }
    .pre-numbering{
        margin: 0;
        position: absolute;
        top: 0;
        left: 0;
        width: 20px;
        padding: 0.5em 3px 0.7em 5px;
        border-right: 1px solid #C3CCD0;
        text-align: right;
        color: #AAA;
        background-color: ;
    }
    .pre-numbering.widther {
        width: 35px;
    }
</style>

<!--自定义样式设置-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*列表样式*/
    

    /* 背景图样式 */
    
    


    /*引用块样式*/
    

    /*文章列表背景图*/
    
    .nav-right:before {
        content: ' ';
        display: block;
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        opacity: 0.3;
        background: url("https://i.loli.net/2019/07/22/5d3521411f3f169375.png");
        background-repeat: no-repeat;
        background-position: 50% 0;
        -ms-background-size: cover;
        -o-background-size: cover;
        -moz-background-size: cover;
        -webkit-background-size: cover;
        background-size: cover;
    }
    

    
</style>







</html>
