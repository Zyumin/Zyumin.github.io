<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  <title>redis深入浅出 | Zyumin</title>
  <meta name="keywords" content=" framework , redis ">
  <meta name="description" content="redis深入浅出 | Zyumin">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="为了将事情做好，首先你得喜欢做这件事，而不是喜欢这件事的结果，那仅仅是第二位。">
<meta name="keywords" content="java">
<meta property="og:type" content="website">
<meta property="og:title" content="tags">
<meta property="og:url" content="http://yoursite.com/tags/index.html">
<meta property="og:site_name" content="Zyumin">
<meta property="og:description" content="为了将事情做好，首先你得喜欢做这件事，而不是喜欢这件事的结果，那仅仅是第二位。">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-03-23T07:09:56.946Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="tags">
<meta name="twitter:description" content="为了将事情做好，首先你得喜欢做这件事，而不是喜欢这件事的结果，那仅仅是第二位。">


<link rel="icon" href="/img/avatar.png">

<link href="/css/style.css?v=1.0.1" rel="stylesheet">

<link href="/css/hl_theme/github-gist.css?v=1.0.1" rel="stylesheet">

<link href="//cdn.bootcss.com/animate.css/3.5.2/animate.min.css" rel="stylesheet">
<link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="/js/jquery.autocomplete.min.js?v=1.0.1"></script>

<script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.js"></script>



<script src="//cdn.bootcss.com/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>

<script src="/js/iconfont.js?v=1.0.1"></script>

</head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="false">
  <input class="theme_blog_path" value="">
</div>

<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/" class="avatar_target">
    <img class="avatar" src="/img/avatar.png">
</a>
<div class="author">
    <span>zhengyumin</span>
</div>

<div class="icon">
    
        
        <a title="github" href="https://github.com/Zyumin" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-github"/>
                </svg>
            
        </a>
        
    
        
        <a title="neteasemusic" href="https://music.163.com/#/user/home?id=60037019" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-neteasemusic"/>
                </svg>
            
        </a>
        
    
</div>




<ul>
    <li><div class="all active">全部文章<small>(51)</small></div></li>
    
        
            
            <li><div data-rel="jdk">jdk<small>(13)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="java">java<small>(7)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="mysql">mysql<small>(2)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="spring">spring<small>(10)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="redis">redis<small>(4)</small></div>
                
            </li>
            
        
    
</ul>
<div class="left-bottom">
    <div class="menus">
    
    
    
    
    </div>
    <div></div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="51">
<input type="hidden" id="yelog_site_word_count" value="166.1k">
<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        友情链接
        <i class="back-title-list"></i>
    </div>
    <div class="friends-content">
        <ul>
            
            <li><a target="_blank" href="http://yelog.org/">叶落阁</a></li>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <form onkeydown="if(event.keyCode==13){return false;}">
        <input class="search" type="text" placeholder="以 in: 开头进行全文搜索" autocomplete="off" id="local-search-input">
        <i class="cross"></i>
        <span>
            <label for="tagswitch">Tags:</label>
            <input id="tagswitch" type="checkbox" style="display: none">
            <i id="tagsWitchIcon"></i>
        </span>
    </form>
    <div class="tags-list">
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">week</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">hide</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">jdk</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">packages</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">utils</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">juc</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color2">classLoader</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">java</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">note</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">jvm</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color2">distributed</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">netty</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">nio</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">framework</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">kafka</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">zookeeper</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">Spec</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color2">thread</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color2">tomcat</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">mysql</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color2">spring</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">hotspot</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">j2ee</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">redis</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">summary</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">ioc</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">io</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">serialization</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">file</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">lang</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">elasticsearch</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">servlet</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">ejb</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">gc</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">aop</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">event</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">map</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color2">collections</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">applicationContext</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color2">beanFactory</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">spring-mvc</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">spring-webflux</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">doc</a>
    </li>
    
    <div class="clearfix"></div>
</div>

    
    <div id="local-search-result">

    </div>
    
    <nav id="title-list-nav">
        
        <a id="top" class="java " href="/2019/02/02/Overview_java/" data-tag="summary" data-author="">
            <span class="post-title" title="Overview_java">Overview_java</span>
            <span class="post-date" title="2019-02-02 20:43:14">2019/02/02</span>
        </a>
        
        <a id="top" class="spring " href="/2019/03/02/Overview_Spring/" data-tag="framework,spring" data-author="">
            <span class="post-title" title="Overview-Spring">Overview-Spring</span>
            <span class="post-date" title="2019-03-02 12:29:06">2019/03/02</span>
        </a>
        
        <a id="top" class="jdk " href="/2019/06/13/Overview_JDK/" data-tag="jdk,hotspot" data-author="">
            <span class="post-title" title="Overview_JDK">Overview_JDK</span>
            <span class="post-date" title="2019-06-13 19:36:54">2019/06/13</span>
        </a>
        
        <a class="redis " href="/2020/02/28/Redis集群篇/" data-tag="framework,redis" data-author="">
            <span class="post-title" title="Redis集群篇">Redis集群篇</span>
            <span class="post-date" title="2020-02-28 18:52:52">2020/02/28</span>
        </a>
        
        <a class="redis " href="/2020/02/28/Redis实战篇/" data-tag="framework,redis" data-author="">
            <span class="post-title" title="Redis实战篇">Redis实战篇</span>
            <span class="post-date" title="2020-02-28 18:52:43">2020/02/28</span>
        </a>
        
        <a class="redis " href="/2020/02/28/Redis原理篇/" data-tag="framework,redis" data-author="">
            <span class="post-title" title="Redis原理篇">Redis原理篇</span>
            <span class="post-date" title="2020-02-28 18:52:35">2020/02/28</span>
        </a>
        
        <a class="spring " href="/2020/01/23/spring-aop/" data-tag="spring,aop" data-author="">
            <span class="post-title" title="spring-aop">spring-aop</span>
            <span class="post-date" title="2020-01-23 23:54:29">2020/01/23</span>
        </a>
        
        <a class="spring " href="/2020/01/16/Spring-ApplicationContext/" data-tag="spring,applicationContext" data-author="">
            <span class="post-title" title="Spring-ApplicationContext">Spring-ApplicationContext</span>
            <span class="post-date" title="2020-01-16 21:04:45">2020/01/16</span>
        </a>
        
        <a class="spring " href="/2019/12/05/spring-BeanFactory/" data-tag="spring,beanFactory" data-author="">
            <span class="post-title" title="spring-BeanFactory">spring-BeanFactory</span>
            <span class="post-date" title="2019-12-05 21:28:57">2019/12/05</span>
        </a>
        
        <a class="spring " href="/2019/12/02/spring-Q-A/" data-tag="spring" data-author="">
            <span class="post-title" title="spring Q&amp;A">spring Q&amp;A</span>
            <span class="post-date" title="2019-12-02 18:20:38">2019/12/02</span>
        </a>
        
        <a class="spring " href="/2019/10/29/Documentation-Spring-Core-IOC/" data-tag="spring,doc" data-author="">
            <span class="post-title" title="Documentation-Spring_Core_IOC">Documentation-Spring_Core_IOC</span>
            <span class="post-date" title="2019-10-29 21:51:07">2019/10/29</span>
        </a>
        
        <a class="jdk " href="/2019/09/26/JDK-Packages-java-nio/" data-tag="jdk,packages,nio" data-author="">
            <span class="post-title" title="JDK_Packages_java_nio">JDK_Packages_java_nio</span>
            <span class="post-date" title="2019-09-26 10:39:22">2019/09/26</span>
        </a>
        
        <a class="jdk " href="/2019/09/23/JDK-Packages-java-io/" data-tag="jdk,packages,io,serialization,file" data-author="">
            <span class="post-title" title="JDK_Packages_java_io">JDK_Packages_java_io</span>
            <span class="post-date" title="2019-09-23 16:07:43">2019/09/23</span>
        </a>
        
        <a class="jdk " href="/2019/08/31/JDK-Class/" data-tag="jdk" data-author="">
            <span class="post-title" title="JDK_Class">JDK_Class</span>
            <span class="post-date" title="2019-08-31 19:38:34">2019/08/31</span>
        </a>
        
        <a class="jdk " href="/2019/08/31/JDK-Thread/" data-tag="jdk,jvm,hotspot" data-author="">
            <span class="post-title" title="JDK_Thread">JDK_Thread</span>
            <span class="post-date" title="2019-08-31 18:16:08">2019/08/31</span>
        </a>
        
        <a class="java " href="/2019/08/29/JVM-main方法分析/" data-tag="java,jvm" data-author="">
            <span class="post-title" title="JVM_main方法分析">JVM_main方法分析</span>
            <span class="post-date" title="2019-08-29 23:38:13">2019/08/29</span>
        </a>
        
        <a class="jdk " href="/2019/08/24/JDK-ReentrantLock/" data-tag="jdk,juc" data-author="">
            <span class="post-title" title="JDK_ReentrantLock">JDK_ReentrantLock</span>
            <span class="post-date" title="2019-08-24 18:48:54">2019/08/24</span>
        </a>
        
        <a class="java " href="/2019/08/17/JVM-Synchronized/" data-tag="jvm" data-author="">
            <span class="post-title" title="JVM_Synchronized">JVM_Synchronized</span>
            <span class="post-date" title="2019-08-17 17:01:54">2019/08/17</span>
        </a>
        
        <a class="java " href="/2019/08/11/Overview-Java-Virtual-Machine/" data-tag="jvm" data-author="">
            <span class="post-title" title="Overview_Java Virtual Machine">Overview_Java Virtual Machine</span>
            <span class="post-date" title="2019-08-11 19:05:38">2019/08/11</span>
        </a>
        
        <a class="jdk " href="/2019/08/11/JDK-Packages-java-lang/" data-tag="jdk,packages,lang" data-author="">
            <span class="post-title" title="JDK_Packages_java_lang">JDK_Packages_java_lang</span>
            <span class="post-date" title="2019-08-11 19:04:56">2019/08/11</span>
        </a>
        
        <a class="jdk " href="/2019/08/11/JDK-Packages-java-utils/" data-tag="jdk,packages,utils" data-author="">
            <span class="post-title" title="JDK_Packages_java_utils">JDK_Packages_java_utils</span>
            <span class="post-date" title="2019-08-11 19:04:25">2019/08/11</span>
        </a>
        
        <a class="jdk " href="/2019/08/10/JDK-The-Concurrent-Framework/" data-tag="jdk,juc" data-author="">
            <span class="post-title" title="JDK_The Concurrent Framework">JDK_The Concurrent Framework</span>
            <span class="post-date" title="2019-08-10 19:45:39">2019/08/10</span>
        </a>
        
        <a class="jdk " href="/2019/07/29/JDK-The-Collections-Framework/" data-tag="jdk,collections" data-author="">
            <span class="post-title" title="JDK_The Collections Framework">JDK_The Collections Framework</span>
            <span class="post-date" title="2019-07-29 15:26:01">2019/07/29</span>
        </a>
        
        <a class="" href="/2019/07/10/Note-码农翻身/" data-tag="java,note" data-author="">
            <span class="post-title" title="Note_码农翻身">Note_码农翻身</span>
            <span class="post-date" title="2019-07-10 22:18:56">2019/07/10</span>
        </a>
        
        <a class="jdk " href="/2019/07/06/JDK-ClassLoader/" data-tag="jdk,classLoader" data-author="">
            <span class="post-title" title="JDK_ClassLoader">JDK_ClassLoader</span>
            <span class="post-date" title="2019-07-06 23:12:51">2019/07/06</span>
        </a>
        
        <a class="spring " href="/2019/07/03/spring-ApplicationContext启动流程和事件机制/" data-tag="classLoader,tomcat,spring,servlet,event" data-author="">
            <span class="post-title" title="spring-ApplicationContext启动流程和事件机制">spring-ApplicationContext启动流程和事件机制</span>
            <span class="post-date" title="2019-07-03 09:37:08">2019/07/03</span>
        </a>
        
        <a class="" href="/2019/06/26/Overview_Elasticsearch/" data-tag="framework,elasticsearch" data-author="">
            <span class="post-title" title="Overview_Elasticsearch">Overview_Elasticsearch</span>
            <span class="post-date" title="2019-06-26 18:06:48">2019/06/26</span>
        </a>
        
        <a class="jdk " href="/2019/06/24/J-U-C-ConcurrentHashMap/" data-tag="juc,map" data-author="">
            <span class="post-title" title="J.U.C_ConcurrentHashMap">J.U.C_ConcurrentHashMap</span>
            <span class="post-date" title="2019-06-24 19:03:29">2019/06/24</span>
        </a>
        
        <a class="java " href="/2019/06/19/JVM-Garbage-Collection/" data-tag="jvm,gc" data-author="">
            <span class="post-title" title="JVM_Garbage Collection">JVM_Garbage Collection</span>
            <span class="post-date" title="2019-06-19 00:28:10">2019/06/19</span>
        </a>
        
        <a class="jdk " href="/2019/06/16/J-U-C-InterruptedException/" data-tag="juc" data-author="">
            <span class="post-title" title="J.U.C_InterruptedException">J.U.C_InterruptedException</span>
            <span class="post-date" title="2019-06-16 16:09:43">2019/06/16</span>
        </a>
        
        <a class="java " href="/2019/06/14/Spec-JSR133/" data-tag="jvm,Spec,thread" data-author="">
            <span class="post-title" title="Spec_JSR133">Spec_JSR133</span>
            <span class="post-date" title="2019-06-14 19:26:57">2019/06/14</span>
        </a>
        
        <a class="java " href="/2019/06/13/Spec-Java-Virtual-Machine/" data-tag="jvm,Spec" data-author="">
            <span class="post-title" title="Spec_Java Virtual Machine">Spec_Java Virtual Machine</span>
            <span class="post-date" title="2019-06-13 17:25:17">2019/06/13</span>
        </a>
        
        <a class="" href="/2019/06/12/Overview_Kafka/" data-tag="framework,kafka" data-author="">
            <span class="post-title" title="kafka深入浅出">kafka深入浅出</span>
            <span class="post-date" title="2019-06-12 20:05:37">2019/06/12</span>
        </a>
        
        <a class="redis " href="/2019/06/10/Overview_Redis/" data-tag="framework,redis" data-author="">
            <span class="post-title" title="redis深入浅出">redis深入浅出</span>
            <span class="post-date" title="2019-06-10 18:33:40">2019/06/10</span>
        </a>
        
        <a class="" href="/2019/06/06/Note_java并发编程的艺术/" data-tag="juc,java,note" data-author="">
            <span class="post-title" title="Note_java并发编程的艺术">Note_java并发编程的艺术</span>
            <span class="post-date" title="2019-06-06 19:05:01">2019/06/06</span>
        </a>
        
        <a class="" href="/2019/06/05/Overview_Netty/" data-tag="netty,nio,framework" data-author="">
            <span class="post-title" title="Netty深入浅出">Netty深入浅出</span>
            <span class="post-date" title="2019-06-05 22:01:31">2019/06/05</span>
        </a>
        
        <a class="" href="/2019/06/05/Note_深入理解java虚拟机/" data-tag="java,note,jvm" data-author="">
            <span class="post-title" title="Note_深入理解java虚拟机">Note_深入理解java虚拟机</span>
            <span class="post-date" title="2019-06-05 21:12:25">2019/06/05</span>
        </a>
        
        <a class="mysql " href="/2019/06/04/Overview_MySQL/" data-tag="mysql" data-author="">
            <span class="post-title" title="MySQL深入浅出">MySQL深入浅出</span>
            <span class="post-date" title="2019-06-04 22:02:31">2019/06/04</span>
        </a>
        
        <a class="" href="/2019/06/03/Overview_Zookeeper/" data-tag="distributed,framework,zookeeper" data-author="">
            <span class="post-title" title="Zookeeper深入浅出">Zookeeper深入浅出</span>
            <span class="post-date" title="2019-06-03 21:15:05">2019/06/03</span>
        </a>
        
        <a class="" href="/2019/06/03/Overview_Distributed/" data-tag="distributed" data-author="">
            <span class="post-title" title="分布式理论基础">分布式理论基础</span>
            <span class="post-date" title="2019-06-03 20:34:37">2019/06/03</span>
        </a>
        
        <a class="spring " href="/2019/04/10/spring-api-1-0/" data-tag="spring" data-author="">
            <span class="post-title" title="spring-api-1.0">spring-api-1.0</span>
            <span class="post-date" title="2019-04-10 09:45:25">2019/04/10</span>
        </a>
        
        <a class="" href="/2019/04/01/3月第四周知识点记录/" data-tag="week,hide" data-author="">
            <span class="post-title" title="3月第四周知识点记录">3月第四周知识点记录</span>
            <span class="post-date" title="2019-04-01 09:51:07">2019/04/01</span>
        </a>
        
        <a class="mysql " href="/2019/03/30/记一次mysql查询in的思考/" data-tag="mysql" data-author="">
            <span class="post-title" title="记一次mysql查询in的思考">记一次mysql查询in的思考</span>
            <span class="post-date" title="2019-03-30 20:39:49">2019/03/30</span>
        </a>
        
        <a class="" href="/2019/03/26/记一次Broken-pipe问题的思考/" data-tag="tomcat" data-author="">
            <span class="post-title" title="记一次Broken pipe问题的思考">记一次Broken pipe问题的思考</span>
            <span class="post-date" title="2019-03-26 10:53:37">2019/03/26</span>
        </a>
        
        <a class="" href="/2019/03/24/3月第三周知识点记录/" data-tag="week,hide" data-author="">
            <span class="post-title" title="3月第三周知识点记录">3月第三周知识点记录</span>
            <span class="post-date" title="2019-03-24 20:55:31">2019/03/24</span>
        </a>
        
        <a class="" href="/2019/03/10/Note_Expert One-on-One-J2EE-Development-without-EJB/" data-tag="spring,j2ee,ejb" data-author="">
            <span class="post-title" title="Expert One-on-One J2EE Development without EJB">Expert One-on-One J2EE Development without EJB</span>
            <span class="post-date" title="2019-03-10 19:45:57">2019/03/10</span>
        </a>
        
        <a class="" href="/2019/03/10/Note_Expert-One-on-One-J2EE-Design-and-Development/" data-tag="spring,j2ee" data-author="">
            <span class="post-title" title="Expert One-on-One J2EE Design and Development">Expert One-on-One J2EE Design and Development</span>
            <span class="post-date" title="2019-03-10 19:45:18">2019/03/10</span>
        </a>
        
        <a class="spring " href="/2019/03/03/spring-Core-Container预览/" data-tag="spring,ioc" data-author="">
            <span class="post-title" title="spring-Core-Container预览">spring-Core-Container预览</span>
            <span class="post-date" title="2019-03-03 14:51:56">2019/03/03</span>
        </a>
        
        <a class="spring " href="/2019/02/03/spring-mvc/" data-tag="spring,servlet,spring-mvc,spring-webflux" data-author="">
            <span class="post-title" title="servlet_spring-mvc">servlet_spring-mvc</span>
            <span class="post-date" title="2019-02-03 15:50:16">2019/02/03</span>
        </a>
        
        <a class="" href="/2019/02/03/Overview_Tomcat/" data-tag="tomcat,servlet" data-author="">
            <span class="post-title" title="servlet_tomcat">servlet_tomcat</span>
            <span class="post-date" title="2019-02-03 15:49:08">2019/02/03</span>
        </a>
        
        <a class="" href="/2019/02/02/Spec_Servlet/" data-tag="j2ee,servlet" data-author="">
            <span class="post-title" title="j2ee_servlet">j2ee_servlet</span>
            <span class="post-date" title="2019-02-02 18:05:54">2019/02/02</span>
        </a>
        
    </nav>
</div>
    </div>
    <div class="hide-list">
        <div class="semicircle">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div class="post">
    <div class="pjax">
        <article id="post-Overview_Redis" class="article article-type-post" itemscope="" itemprop="blogPost">
    
        <h1 class="article-title">redis深入浅出</h1>
    
    <div class="article-meta">
        
        
        
        <span class="book">
            
                <a href="javascript:" data-rel="redis">redis</a>
            
        </span>
        
        
        <span class="tag">
            
            <a href="javascript:" class="color5">framework</a>
            
            <a href="javascript:" class="color1">redis</a>
            
        </span>
        
    </div>
    <div class="article-meta">
        
        创建时间:<time class="date" title="更新时间: 2020-02-28 18:57:55">2019-06-10 18:33</time>
        
    </div>
    <div class="article-meta">
        
        <span>字数:5.3k</span>
        
        
        <span id="busuanzi_container_page_pv">
            阅读:<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#初识"><span class="toc-text">初识</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#版本特征"><span class="toc-text">版本特征</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#数据结构"><span class="toc-text">数据结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#String"><span class="toc-text">String</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#存储-实现-原理"><span class="toc-text">存储(实现)原理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#数据模型"><span class="toc-text">数据模型</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#redisObject"><span class="toc-text">redisObject</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#内部编码"><span class="toc-text">内部编码</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#应用场景"><span class="toc-text">应用场景</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hash"><span class="toc-text">Hash</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#存储-实现-原理-1"><span class="toc-text">存储(实现)原理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#ziplist-压缩列表"><span class="toc-text">ziplist 压缩列表</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#hashtable-dict"><span class="toc-text">hashtable(dict)</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#dictht"><span class="toc-text">dictht</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#dict"><span class="toc-text">dict</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#rehash"><span class="toc-text">rehash</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#应用场景-1"><span class="toc-text">应用场景</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#List"><span class="toc-text">List</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#存储-实现-原理-2"><span class="toc-text">存储(实现)原理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#quicklist"><span class="toc-text">quicklist</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#quicklistNode"><span class="toc-text">quicklistNode</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#应用场景-2"><span class="toc-text">应用场景</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Set"><span class="toc-text">Set</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#存储-实现-原理-3"><span class="toc-text">存储(实现)原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#应用场景-3"><span class="toc-text">应用场景</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#抽奖"><span class="toc-text">抽奖</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#点赞、签到、打卡"><span class="toc-text">点赞、签到、打卡</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#商品标签"><span class="toc-text">商品标签</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#商品筛选"><span class="toc-text">商品筛选</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#用户关注、推荐模型"><span class="toc-text">用户关注、推荐模型</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Zset"><span class="toc-text">Zset</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#存储-实现-原理-4"><span class="toc-text">存储(实现)原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#应用场景-4"><span class="toc-text">应用场景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#其他数据结构"><span class="toc-text">其他数据结构</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#BitMaps"><span class="toc-text">BitMaps</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Hyperloglogs"><span class="toc-text">Hyperloglogs</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Streams"><span class="toc-text">Streams</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#总结"><span class="toc-text">总结</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#数据结构总结"><span class="toc-text">数据结构总结</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#编码转换总结"><span class="toc-text">编码转换总结</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用"><span class="toc-text">使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#发布订阅"><span class="toc-text">发布订阅</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#传统list队列局限"><span class="toc-text">传统list队列局限</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#发布订阅模式"><span class="toc-text">发布订阅模式</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#订阅频道"><span class="toc-text">订阅频道</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#按规则-Pattern-订阅频道"><span class="toc-text">按规则(Pattern)订阅频道</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis事务"><span class="toc-text">Redis事务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#watch命令"><span class="toc-text">watch命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#事务可能遇到的问题"><span class="toc-text">事务可能遇到的问题</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#在执行-exec-之前发生错误"><span class="toc-text">在执行 exec 之前发生错误</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#在执行-exec-之后发生错误"><span class="toc-text">在执行 exec 之后发生错误</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lua脚本"><span class="toc-text">Lua脚本</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Lua应用"><span class="toc-text">Lua应用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#管理"><span class="toc-text">管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#持久化"><span class="toc-text">持久化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#集群"><span class="toc-text">集群</span></a></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-4 i,
    .toc-level-4 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="http://ww3.sinaimg.cn/large/006tNc79gy1g3x0bypob8j30u70u0kjl.jpg" alt="image-20190611102836454"></p>
<a id="more"></a>
<h2 id="初识"><a href="#初识" class="headerlink" title="初识"></a>初识</h2><p>官网介绍    </p>
<p>​    Redis is an open source (BSD licensed), in-memory data structure store, used as a database, cache and message broker. </p>
<p>​    It supports data structures such as strings, hashes, lists, sets, sorted sets with range queries, bitmaps, hyperloglogs, geospatial indexes with radius queries and streams.</p>
<p>​     Redis has built-in replication, Lua scripting, LRU eviction, transactions and different levels of on-disk persistence, and provides high availability via Redis Sentinel and automatic partitioning with Redis Cluster</p>
<p>简单翻译下</p>
<p>​    内存数据结构存储 ,被当成数据库、缓存、消息代理使用</p>
<p>​    支持的数据结构,字符串 、哈希、列表、集合等</p>
<p>​    副本集(主从复制)、Lua脚本、LRU淘汰策略(Least Recently Used、Least Frequently Used)、事务(不可回滚)、不同级别的磁盘持久、用Sentinel保证高可用、用集群来自动分区</p>
<p>​    </p>
<p>单线程 、简单、高性能的key-value数据库</p>
<p>Redis 的特性:<br> 1)更丰富的数据类型 </p>
<p> 2)进程内与跨进程;单机与分布式</p>
<p> 3)功能丰富:持久化机制、过期策略</p>
<p> 4)支持多种编程语言</p>
<p> 5)高可用，集群</p>
<h2 id="版本特征"><a href="#版本特征" class="headerlink" title="版本特征"></a>版本特征</h2><p><strong>1.Redis2.6</strong></p>
<p>Redis2.6在2012年正式发布，相对于Redis2.4，主要特性如下：</p>
<ul>
<li>支持Lua脚本</li>
<li>键的过期时间支持毫秒</li>
<li>从节点支持只读功能</li>
</ul>
<p><strong>2.Redis2.8</strong></p>
<p>Redis2.8在2013年11月22日正式发布，相比于Redis2.6，主要特性如下：</p>
<ul>
<li>PSYNC 添加部分主从复制的功能</li>
<li>Redis Sentinel生产可用</li>
<li>新增命令：SCAN、SSCAN、HSCAN和ZSCAN</li>
</ul>
<p><strong>3.Redis3.0（里程碑）</strong></p>
<p>Redis3.0在2015年4月1日正式发布，相比于Redis2.8主要特性如下：</p>
<ul>
<li><strong>Redis Cluster：Redis的官方分布式实现</strong>。</li>
<li>全新的embedded string对象编码结果，优化小对象内存访问，在特定的工作负载下载速度大幅提升</li>
</ul>
<p><strong>4.Redis3.2</strong></p>
<p>Redis3.2在2016年5月6日正式发布，相比于Redis3.0主要特征如下：</p>
<ul>
<li>新的List编码类型：quicklist。</li>
</ul>
<p><strong>5.Redis4.0</strong></p>
<p>Redis4.0在2016年底正式发布，相比于Redis3.2主要特征如下： <a href="http://antirez.com/news/110" target="_blank" rel="noopener">http://antirez.com/news/110</a></p>
<ul>
<li>模块化</li>
<li>PSYNC2.0：优化了之前版本中，主从节点切换必然引起全量复制的问题。</li>
<li>提供了新的缓存剔除算法：LFU（Last Frequently Used），并对已有算法进行了优化。</li>
<li>提供了非阻塞del和flushall/flushdb功能，有效解决删除了bigkey可能造成的Redis阻塞。</li>
<li>提供了RDB-AOF混合持久化格式，充分利用了AOF和RDB各自优势。</li>
</ul>
<p><strong>6.Redis5.0</strong></p>
<p>Redis5.0在2018年5月正式发布相比于Redis4.0主要特征如下：</p>
<ul>
<li>Stream data type</li>
</ul>
<p> more: <a href="https://raw.githubusercontent.com/antirez/redis/5.0/00-RELEASENOTES" target="_blank" rel="noopener">https://raw.githubusercontent.com/antirez/redis/5.0/00-RELEASENOTES</a></p>
<h2 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h2><h3 id="String"><a href="#String" class="headerlink" title="String"></a>String</h3><p>​    Redis 的字符串是动态字符串，是可以修改的字符串，内部结构实现上类似于 Java 的 ArrayList，采用预分配冗余空间的方式来减少内存的频繁分配。 当字符串长度小于 1M 时，扩容都是加倍现有的空间，如果超过 1M，扩容时一次只会多扩 1M 的空间。需要注意的是字符串最大长度为 512M。</p>
<h4 id="存储-实现-原理"><a href="#存储-实现-原理" class="headerlink" title="存储(实现)原理"></a>存储(实现)原理</h4><h5 id="数据模型"><a href="#数据模型" class="headerlink" title="数据模型"></a>数据模型</h5><pre><code class="c">/*dict.h*/
typedef struct dictEntry {
    void *key; /* key 关键字定义 */
    union {
        void *val; uint64_t u64; /* value 定义 */
    int64_t s64; double d;
    } v;
    struct dictEntry *next; /* 指向下一个键值对节点 */
} dictEntry;
</code></pre>
<p>以set hello world 为例子</p>
<p><img src="https://tva1.sinaimg.cn/large/0082zybply1gc8qxitborj312y0fajz4.jpg" alt="image-20200225165251801" style="zoom:50%;"></p>
<p>key 是字符串，但是 Redis 没有直接使用 C 的字符数组，而是存储在自定义的 SDS 中。</p>
<p>value 既不是直接作为字符串存储，也不是直接存储在 SDS 中，而是存储在 redisObject 中。实际上五种常用的数据类型的任何一种，都是通过 redisObject 来存储 的。</p>
<h5 id="redisObject"><a href="#redisObject" class="headerlink" title="redisObject"></a>redisObject</h5><pre><code class="c">/* server.h */
typedef struct redisObject {
    unsigned type:4; /* 对象的类型，包括:OBJ_STRING、OBJ_LIST、OBJ_HASH、OBJ_SET、OBJ_ZSET */             unsigned encoding:4; /* 具体的数据结构 */
    unsigned lru:LRU_BITS; /* 24 位，对象最后一次被命令程序访问的时间，与内存回收有关 */
    int refcount; /* 引用计数。当refcount为0的时候，表示该对象不被任何对象引用，可以进行垃圾回收了*/
    void *ptr; /* 指向对象实际的数据结构 */
} robj;
</code></pre>
<p>可以使用 type 命令来查看对外的类型。</p>
<p>可以使用 object encoding 来查看具体的数据结构。</p>
<h5 id="内部编码"><a href="#内部编码" class="headerlink" title="内部编码"></a>内部编码</h5><p><img src="https://tva1.sinaimg.cn/large/0082zybply1gc8r6meyqsj31040a8djs.jpg" alt="image-20200225170138936" style="zoom:50%;"></p>
<p>字符串类型的内部编码有三种:<br> 1、int，存储 8 个字节的长整型(long，2^63-1)。<br> 2、embstr, 代表 embstr 格式的 SDS(Simple Dynamic String 简单动态字符串)，</p>
<p>存储小于 44 个字节的字符串。<br> 3、raw，存储大于 44 个字节的字符串(3.2 版本之前是 39 字节)</p>
<p>问题 1、什么是 SDS? Redis 中字符串的实现?</p>
<p>​    在 3.2 以后的版本中，SDS 又有多种结构(sds.h):    sdshdr5、sdshdr8、sdshdr16、sdshdr32、sdshdr64，用于存储不同的长度的字符串，分别代表 2^5=32byte， 2^8=256byte，2^16=65536byte=64KB，2^32byte=4GB。</p>
<pre><code class="c">/* sds.h */
struct __attribute__ ((__packed__)) sdshdr8 {
    uint8_t len; /* 当前字符数组的长度 */
    uint8_t alloc; /*当前字符数组总共分配的内存大小 */
    unsigned char flags; /* 当前字符数组的属性、用来标识到底是 sdshdr8 还是 sdshdr16 等 */ 
    char buf[]; /* 字符串真正的值 */
};
</code></pre>
<p>问题 2、为什么 Redis 要用 SDS 实现字符串?</p>
<table>
<thead>
<tr>
<th><strong>C</strong> 字符串</th>
<th><strong>SDS</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>获取字符串长度的复杂度为 O(N)</td>
<td>获取字符串长度的复杂度为 O(1)</td>
</tr>
<tr>
<td>API 是不安全的，可能会造成缓冲区溢出</td>
<td>API 是安全的，不会造成缓冲区溢出</td>
</tr>
<tr>
<td>修改字符串长度 N 次必然需要执行 N 次内存重分配</td>
<td>修改字符串长度 N 次最多需要执行 N 次内存重分配</td>
</tr>
<tr>
<td>只能保存文本数据</td>
<td><code>可以保存文本或者二进制数据</code></td>
</tr>
<tr>
<td>可以使用所有&lt;string.h&gt;库中的函数</td>
<td>可以使用一部分&lt;string.h&gt;库中的函数</td>
</tr>
</tbody>
</table>
<p>问题 3、embstr 和 raw 的区别?</p>
<p>​    embstr 的使用只分配一次内存空间(因为 RedisObject 和 SDS 是连续的,只读)，而 raw 需要分配两次内存空间(分别为 RedisObject 和 SDS 分配空间)。</p>
<p>问题 4、int 和 embstr 什么时候转化为 raw?</p>
<p>​    当int数据不再是整数，或大小超过了 long 的范围 (2^63-1=9223372036854775807)时，自动转化为 raw</p>
<p>​    对于 embstr，由于其实现是只读的，因此在对 embstr对象进行修改时，都会先转化为raw 再进行修改。</p>
<h4 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h4><p>缓存</p>
<p>数据共享分布式</p>
<p>分布式锁</p>
<p>​    STRING 类型 setnx 方法，只有不存在时才能添加成功，返回 true。</p>
<p>全局 ID</p>
<p>​    INT 类型，INCRBY，利用原子性</p>
<p>计数器</p>
<p>​    INT 类型，INCR 方法</p>
<p>限流</p>
<p>​    INT 类型，INCR 方法</p>
<p>位统计</p>
<p>​    bit count</p>
<h3 id="Hash"><a href="#Hash" class="headerlink" title="Hash"></a>Hash</h3><p>​    Redis 的字典相当于 Java 语言里面的 HashMap，它是无序字典。不同的是，Redis 的字典的值只能是字符串，另外它们 rehash 的方式不一样，因为 Java 的 HashMap 在字典很大时，rehash 是个耗时的操作，需要一次性全部 rehash(在concurrentHashMap中也是渐进式,而且是多线程)。</p>
<p>Redis 为了高性能，不能堵塞服务，所以采用了渐进式 rehash 策略。(操作的时候会触发rehash,同时后台会有个定时任务在执行)</p>
<p>​    相比字符串 ,可以进行部分获取,减少网络传输.  但hash 结构的存储消耗要高于单个字符串.</p>
<h4 id="存储-实现-原理-1"><a href="#存储-实现-原理-1" class="headerlink" title="存储(实现)原理"></a>存储(实现)原理</h4><p>​    外层的哈希(Redis KV 的实现)只用到了 hashtable。当存储 hash 数据类型时， 我们把它叫做内层的哈希。内层的哈希底层可以使用两种数据结构实现:</p>
<p>ziplist:OBJ_ENCODING_ZIPLIST(压缩列表) </p>
<p>hashtable:OBJ_ENCODING_HT(哈希表)</p>
<h5 id="ziplist-压缩列表"><a href="#ziplist-压缩列表" class="headerlink" title="ziplist 压缩列表"></a>ziplist 压缩列表</h5><p>ziplist 是一个经过特殊编码的双向链表，它不存储指向上一个链表节点和指向下一 个链表节点的指针，而是存储上一个节点长度和当前节点长度，通过牺牲部分读写性能， 来换取高效的内存空间利用率，是一种时间换空间的思想。只用在字段个数少，字段值 小的场景里面。</p>
<p>内部结构</p>
<pre><code class="c">typedef struct zlentry {
    unsigned int prevrawlensize;     /* 上一个链表节点占用的长度 */
    unsigned int prevrawlen;             /* 存储上一个链表节点的长度数值所需要的字节数 */ 
    unsigned int lensize;                 /* 存储当前链表节点长度数值所需要的字节数 */
    unsigned int len;                         /* 当前链表节点占用的长度 */
    unsigned int headersize; /* 当前链表节点的头部大小(prevrawlensize + lensize)，即非数据域的大小 */
    unsigned char encoding;  /* 编码方式 */
    unsigned char *p; /* 压缩链表以字符串的形式保存，该指针指向当前节点起始位置 */
} zlentry;
</code></pre>
<p>编码 encoding(ziplist.c 源码第 204 行)</p>
<pre><code class="c">#define ZIP_STR_06B (0 &lt;&lt; 6) //长度小于等于 63 字节
#define ZIP_STR_14B (1 &lt;&lt; 6) //长度小于等于 16383 字节 
#define ZIP_STR_32B (2 &lt;&lt; 6) //长度小于等于 4294967295 字节
</code></pre>
<p><img src="https://tva1.sinaimg.cn/large/0082zybply1gc8t03187tj31500oyk4q.jpg" alt="image-20200225180434113" style="zoom:50%;"></p>
<p>什么时候使用?</p>
<p>当 hash 对象同时满足以下两个条件的时候，使用 ziplist 编码:</p>
<p> 1)所有的键值对的健和值的字符串长度都小于等于 64byte(一个英文字母一个字节);</p>
<p>2)哈希对象保存的键值对数量小于 512 个。</p>
<h5 id="hashtable-dict"><a href="#hashtable-dict" class="headerlink" title="hashtable(dict)"></a>hashtable(dict)</h5><p>在 Redis 中，hashtable 被称为字典(dictionary)，它是一个数组+链表的结构。</p>
<p><img src="https://tva1.sinaimg.cn/large/0082zybply1gc8tkih1qwj31hg0piav8.jpg" alt="image-20200225182411033"></p>
<h6 id="dictht"><a href="#dictht" class="headerlink" title="dictht"></a>dictht</h6><pre><code class="c">/* This is our hash table structure. Every dictionary has two of this as we * implement incremental rehashing, for the old to the new table. */ 
typedef struct dictht {
    dictEntry **table; /* 哈希表数组 */
    unsigned long size; /* 哈希表大小 */
    unsigned long sizemask; /* 掩码大小，用于计算索引值。总是等于 size-1 */ 
    unsigned long used; /* 已有节点数 */
} dictht;
</code></pre>
<h6 id="dict"><a href="#dict" class="headerlink" title="dict"></a>dict</h6><pre><code class="c">typedef struct dict {
    dictType *type; /* 字典类型 */
    void *privdata; /* 私有数据 */
    dictht ht[2]; /* 一个字典有两个哈希表 */
    long rehashidx; /* rehash 索引 */
    unsigned long iterators; /* 当前正在使用的迭代器数量 */
} dict;
</code></pre>
<h6 id="rehash"><a href="#rehash" class="headerlink" title="rehash"></a>rehash</h6><p>步骤:<br> 1、为字符 ht[1]哈希表分配空间，这个哈希表的空间大小取决于要执行的操作，以及 ht[0]当前包含的键值对的数量。<br> 扩展:ht[1]的大小为第一个大于等于 ht[0].used*2。<br> 2、将所有的 ht[0]上的节点 rehash 到 ht[1]上，重新计算 hash 值和索引，然后放入指定的位置。<br> 3、当 ht[0]全部迁移到了 ht[1]之后，释放 ht[0]的空间，将 ht[1]设置为 ht[0]表，并创建新的 ht[1]，为下次 rehash 做准备</p>
<p>扩容缩容?</p>
<p>负载因子</p>
<pre><code class="c">static int dict_can_resize = 1;
static unsigned int dict_force_resize_ratio = 5;
</code></pre>
<p>ratio = used / size，已使用节点与字典大小的比例</p>
<p>dict_can_resize 为 1 并且 dict_force_resize_ratio 已使用节点数和字典大小之间的 比率超过 1:5，触发扩容</p>
<h4 id="应用场景-1"><a href="#应用场景-1" class="headerlink" title="应用场景"></a>应用场景</h4><p>string</p>
<p>存储对象类型的数据</p>
<p>购物车</p>
<h3 id="List"><a href="#List" class="headerlink" title="List"></a>List</h3><p>​    Redis 的列表相当于 Java 语言里面的 LinkedList，注意它是链表而不是数组。这意味着 list 的插入和删除操作非常快，时间复杂度为 O(1)，但是索引定位很慢，时间复杂度为 O(n)，这点让人非常意外。 常用于异步队列。</p>
<p>​    <img src="http://ww4.sinaimg.cn/large/006tNc79gy1g3xeyqvqyoj30zk03d3za.jpg" alt="image-20190611185500346"></p>
<p>在列表元素较少的情况下会使用一块连续的内存存储，这个结构是 <code>ziplist</code>，也即是压缩列表。</p>
<p>​    当数据量比较多的时候才会改成 <code>quicklist</code>。因为普通的链表需要的附加指针空间太大，会比较浪费空间，而且会加重内存的碎片化。比如这个列表里存的只是 <code>int</code> 类型的数据，结构上还需要两个额外的指针 <code>prev</code> 和 <code>next</code> 。所以 Redis 将链表和 <code>ziplist</code> 结合起来组成了 <code>quicklist</code>。也就是将多个 <code>ziplist</code> 使用双向指针串起来使用。这样既满足了快速的插入删除性能，又不会出现太大的空间冗余。</p>
<h4 id="存储-实现-原理-2"><a href="#存储-实现-原理-2" class="headerlink" title="存储(实现)原理"></a>存储(实现)原理</h4><p>在早期的版本中，数据量较小时用 ziplist 存储，达到临界值时转换为 linkedlist 进 行存储，分别对应 OBJ_ENCODING_ZIPLIST 和 OBJ_ENCODING_LINKEDLIST 。</p>
<p>3.2 版本之后，统一用 quicklist 来存储。quicklist 存储了一个双向链表，每个节点 都是一个 ziplist。</p>
<p><img src="https://tva1.sinaimg.cn/large/0082zybply1gc8xdedczwj31bk0qoql7.jpg" alt="image-20200225203545120"></p>
<h5 id="quicklist"><a href="#quicklist" class="headerlink" title="quicklist"></a>quicklist</h5><p>quicklist(快速列表)是 ziplist 和 linkedlist 的结合体。</p>
<pre><code class="c">typedef struct quicklist {
    quicklistNode *head; /* 指向双向列表的表头 */ 
    quicklistNode *tail; /* 指向双向列表的表尾 */
    unsigned long count; /* 所有的 ziplist 中一共存了多少个元素 */ 
    unsigned long len;    /* 双向链表的长度，node 的数量 */
    int fill : 16; /* fill factor for individual nodes */
    unsigned int compress : 16;  /* 压缩深度，0:不压缩; */
} quicklist;    
</code></pre>
<h5 id="quicklistNode"><a href="#quicklistNode" class="headerlink" title="quicklistNode"></a>quicklistNode</h5><p> quicklistNode 中的*zl 指向一个 ziplist，一个 ziplist 可以存放多个元素。</p>
<pre><code class="c">typedef struct quicklistNode {
    struct quicklistNode *prev; /* 前一个节点 */
    struct quicklistNode *next; /* 后一个节点 */
    unsigned char *zl; /* 指向实际的 ziplist */
    unsigned int sz; /* 当前 ziplist 占用多少字节 */
    unsignedintcount:16;/* 当前ziplist中存储了多少个元素，占16bit(下同)，最大65536个*/ unsigned int        encoding : 2; /* 是否采用了 LZF 压缩算法压缩节点，1:RAW 2:LZF */
    unsigned int   container : 2; /* 2:ziplist，未来可能支持其他结构存储 */
    unsigned int   recompress : 1; /* 当前 ziplist 是不是已经被解压出来作临时使用 */
    unsigned int   attempted_compress : 1; /* 测试用 */
    unsigned int   extra : 10; /* 预留给未来使用 */
} quicklistNode;
</code></pre>
<h4 id="应用场景-2"><a href="#应用场景-2" class="headerlink" title="应用场景"></a>应用场景</h4><p>用户消息时间线 timeline</p>
<p>消息队列</p>
<h3 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h3><p>​    Redis 的集合相当于 Java 语言里面的 HashSet，它内部的键值对是无序的唯一的。它的内部实现相当于一个特殊的字典，字典中所有的 value 都是一个值<code>NULL</code>。</p>
<h4 id="存储-实现-原理-3"><a href="#存储-实现-原理-3" class="headerlink" title="存储(实现)原理"></a>存储(实现)原理</h4><p>​    Redis 用 intset 或 hashtable 存储 set。如果元素都是整数类型，就用 inset 存储。 如果不是整数类型，就用 hashtable(数组+链表的存来储结构)。</p>
<h4 id="应用场景-3"><a href="#应用场景-3" class="headerlink" title="应用场景"></a>应用场景</h4><h5 id="抽奖"><a href="#抽奖" class="headerlink" title="抽奖"></a>抽奖</h5><p>​    随机获取元素 spop myset</p>
<h5 id="点赞、签到、打卡"><a href="#点赞、签到、打卡" class="headerlink" title="点赞、签到、打卡"></a>点赞、签到、打卡</h5><p>​    这条微博的 ID 是 t1001，用户 ID 是 u3001。</p>
<p>​     用 like:t1001 来维护 t1001 这条微博的所有点赞用户。 </p>
<p>​    点赞了这条微博:sadd like:t1001 u3001 </p>
<p>​    取消点赞:srem like:t1001 u3001 </p>
<p>​    是否点赞:sismember like:t1001 u3001 </p>
<p>​    点赞的所有用户:smembers like:t1001 </p>
<p>​    点赞数:scard like:t1001</p>
<h5 id="商品标签"><a href="#商品标签" class="headerlink" title="商品标签"></a>商品标签</h5><p>用 tags:i5001 来维护商品所有的标签。</p>
<p>sadd tags:i5001 画面清晰细腻 sadd tags:i5001 真彩清晰显示屏 sadd tags:i5001 流畅至极</p>
<h5 id="商品筛选"><a href="#商品筛选" class="headerlink" title="商品筛选"></a>商品筛选</h5><p>​    获取差集</p>
<p>​        sdiff set1 set2</p>
<p>​    获取交集(intersection ) </p>
<p>​        sinter set1 set2<br>     获取并集<br>​         sunion set1 set2</p>
<p>sadd brand:apple iPhone11<br> sadd brand:ios iPhone11<br> sad screensize:6.0-6.24 iPhone11 sad screentype:lcd iPhone11</p>
<p>筛选商品，苹果的，iOS 的，屏幕在 6.0-6.24 之间的，屏幕材质是 LCD 屏幕</p>
<p>​     sinter brand:apple brand:ios screensize:6.0-6.24 screentype:lcd</p>
<h5 id="用户关注、推荐模型"><a href="#用户关注、推荐模型" class="headerlink" title="用户关注、推荐模型"></a>用户关注、推荐模型</h5><p>思考</p>
<p>1)相互关注? 2)我关注的人也关注了他? 3)可能认识的人?</p>
<h3 id="Zset"><a href="#Zset" class="headerlink" title="Zset"></a>Zset</h3><p>​    zset 可能是 Redis 提供的最为特色的数据结构。它类似于 Java 的 SortedSet 和 HashMap 的结合体，一方面它是一个 set，保证了内部 value 的唯一性，另一方面它可以给每个 value 赋予一个 score，代表这个 value 的排序权重。</p>
<p>​    我们需要这个链表按照 score 值进行排序。这意味着当有新元素需要插入时，要定位到特定位置的插入点，这样才可以继续保证链表是有序的。通常我们会通过二分查找来找到插入点，但是二分查找的对象必须是数组，所以 它的内部实现用的是一种叫做「跳跃列表」的数据结构。</p>
<p>数据结构对比:</p>
<table>
<thead>
<tr>
<th>数据结构</th>
<th>是否允许重复元素</th>
<th>是否有序</th>
<th>有序实现方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>列表 list</td>
<td>是</td>
<td>是</td>
<td>索引下标</td>
</tr>
<tr>
<td>集合 set</td>
<td>否</td>
<td>否</td>
<td>无</td>
</tr>
<tr>
<td>有序集合 zset</td>
<td>否</td>
<td>是</td>
<td>分值 score</td>
</tr>
</tbody>
</table>
<h4 id="存储-实现-原理-4"><a href="#存储-实现-原理-4" class="headerlink" title="存储(实现)原理"></a>存储(实现)原理</h4><p>同时满足以下条件时使用 ziplist 编码:<br>     元素数量小于 128 个<br>     所有 member 的长度都小于 64 字节</p>
<p>超过阈值之后，使用 skiplist+dict 存储。</p>
<p>什么是 skiplist?</p>
<p>二分查找法只适用于有序数组，不适用于链表。所以为了解决这个问题</p>
<p>插入一个数据的时候，决定要放到那一层，取决于一个算法 ,zslRandomLevel</p>
<pre><code class="c">/* t_zset.c */
int zslRandomLevel(void) {
    int level = 1;
    while ((random()&amp;0xFFFF) &lt; (ZSKIPLIST_P * 0xFFFF))
    level += 1;
    return (level&lt;ZSKIPLIST_MAXLEVEL) ? level : ZSKIPLIST_MAXLEVEL;
}
</code></pre>
<p>为什么不用 AVL 树或者红黑树?因为 skiplist 更加简洁。</p>
<pre><code class="c">typedef struct zskiplistNode {
    sds ele; /* zset 的元素 */
    double score; /* 分值 */
    struct zskiplistNode *backward; /* 后退指针 */ struct zskiplistLevel {
    struct zskiplistNode *forward; /* 前进指针，对应 level 的下一个节点 */
    unsigned long span; /* 从当前节点到下一个节点的跨度(跨越的节点数) */ } level[]; /* 层 */
} zskiplistNode; 

typedef struct zskiplist {
    struct zskiplistNode *header, *tail; /* 指向跳跃表的头结点和尾节点 */ 
  unsigned long length; /* 跳跃表的节点数 */
    int level; /* 最大的层数 */
} zskiplist; 

typedef struct zset {
    dict *dict;
    zskiplist *zsl; 
} zset;
</code></pre>
<h4 id="应用场景-4"><a href="#应用场景-4" class="headerlink" title="应用场景"></a>应用场景</h4><p>排行榜</p>
<h4 id="其他数据结构"><a href="#其他数据结构" class="headerlink" title="其他数据结构"></a>其他数据结构</h4><h5 id="BitMaps"><a href="#BitMaps" class="headerlink" title="BitMaps"></a>BitMaps</h5><p>Bitmaps 是在字符串类型上面定义的位操作。一个字节由 8 个二进制位组成。</p>
<p>应用场景:<br>    用户访问统计<br>    在线用户统计</p>
<h5 id="Hyperloglogs"><a href="#Hyperloglogs" class="headerlink" title="Hyperloglogs"></a>Hyperloglogs</h5><p>Hyperloglogs:提供了一种不太准确的基数统计方法，比如统计网站的 UV，存在 一定的误差</p>
<h5 id="Streams"><a href="#Streams" class="headerlink" title="Streams"></a>Streams</h5><p>5.0 推出的数据类型。支持多播的可持久化的消息队列，用于实现发布订阅功能，借 鉴了 kafka 的设计。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><h4 id="数据结构总结"><a href="#数据结构总结" class="headerlink" title="数据结构总结"></a>数据结构总结</h4><p><img src="https://tva1.sinaimg.cn/large/0082zybply1gc8yt7wf1tj31cu0i0gsu.jpg" alt="image-20200225212533444"></p>
<h4 id="编码转换总结"><a href="#编码转换总结" class="headerlink" title="编码转换总结"></a>编码转换总结</h4><p><img src="https://tva1.sinaimg.cn/large/0082zybply1gc8ytljqnaj31g80nmagp.jpg" alt="image-20200225212555266"></p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><ul>
<li><p>管道（Pipelining）</p>
<p>  一次发送多个命令，可以包含Batch命令,节省往返时间。 </p>
</li>
<li><p>淘汰策略 LRU LFU</p>
<p>  Least Recently Used    按照访问时间  这个可以用LinkHashMap 简单实现<br>  Least Frequently Used  按照访问次数  需要额外的队列记录访问频率</p>
</li>
<li><p>Batch 命令</p>
<p>  批量相同指令</p>
</li>
<li><p>事务  </p>
<p>  Redis 事务保证了其中的一致性（C）和隔离性（I），但并不保证原子性（A）和持久性（D）。</p>
</li>
<li><p>分布式锁</p>
<p>  Lua脚本实现原子性</p>
</li>
<li><p>TTL 过期删除 </p>
<p>  惰性、异步 删除, 注意过期时间要采用 一个常量加一个随机时间戳 防止大批量的key同一时间过期</p>
</li>
</ul>
<h3 id="发布订阅"><a href="#发布订阅" class="headerlink" title="发布订阅"></a>发布订阅</h3><h4 id="传统list队列局限"><a href="#传统list队列局限" class="headerlink" title="传统list队列局限"></a>传统list队列局限</h4><p>1、如果生产者生产消息的速度远大于消费者消费消息的速度，List 会占用大量的内 存。</p>
<p>2、消息的实时性降低。</p>
<p>基于 list 实现的消息队列，不支持一对多的消息分发。</p>
<h4 id="发布订阅模式"><a href="#发布订阅模式" class="headerlink" title="发布订阅模式"></a>发布订阅模式</h4><h5 id="订阅频道"><a href="#订阅频道" class="headerlink" title="订阅频道"></a>订阅频道</h5><p>​    我们有很多的频道(channel)，我们也可以把这个频道理解成 queue。订 阅者可以订阅一个或者多个频道。消息的发布者(生产者)可以给指定的频道发</p>
<p>订阅</p>
<p>​    subscribe channel-1 channel-2 channel-3</p>
<p>发布</p>
<p>​    publish channel-1 2673</p>
<h5 id="按规则-Pattern-订阅频道"><a href="#按规则-Pattern-订阅频道" class="headerlink" title="按规则(Pattern)订阅频道"></a>按规则(Pattern)订阅频道</h5><p>支持?和<em>占位符。?代表一个字符，</em>代表 0 个或者多个字符。</p>
<h3 id="Redis事务"><a href="#Redis事务" class="headerlink" title="Redis事务"></a>Redis事务</h3><p>Redis 的事务有两个特点: </p>
<p>1、按进入队列的顺序执行。</p>
<p> 2、不会受到其他客户端的请求的影响。</p>
<p>Redis 的事务涉及到四个命令:multi(开启事务)，exec(执行事务)，discard (取消事务)，watch(监视)</p>
<h4 id="watch命令"><a href="#watch命令" class="headerlink" title="watch命令"></a>watch命令</h4><p>它可以为 Redis 事务提供 CAS 乐观锁行为(Check and Set / Compare and Swap)</p>
<p>我们可以用 watch 监视一个或者多个 key，如果开启事务之后，至少有一个被监视 key 键在 exec 执行之前被修改了， 那么整个事务都会被取消(key 提前过期除外)。可 以用 unwatch 取消。</p>
<h4 id="事务可能遇到的问题"><a href="#事务可能遇到的问题" class="headerlink" title="事务可能遇到的问题"></a>事务可能遇到的问题</h4><h5 id="在执行-exec-之前发生错误"><a href="#在执行-exec-之前发生错误" class="headerlink" title="在执行 exec 之前发生错误"></a>在执行 exec 之前发生错误</h5><p>比如:入队的命令存在语法错误，包括参数数量，参数名等等(编译器错误)。</p>
<p>在这种情况下事务会被拒绝执行，也就是队列中所有的命令都不会得到执行。</p>
<h5 id="在执行-exec-之后发生错误"><a href="#在执行-exec-之后发生错误" class="headerlink" title="在执行 exec 之后发生错误"></a>在执行 exec 之后发生错误</h5><p>比如，类型错误，比如对 String 使用了 Hash 的命令，这是一种运行时错误。</p>
<p>为什么在一个事务中存在错误，Redis 不回滚?</p>
<ul>
<li>Redis 命令只会因为错误的语法而失败（并且这些问题不能在入队时发现），或是命令用在了错误类型的键上面：这也就是说，从实用性的角度来说，失败的命令是由编程错误造成的，而这些错误应该在开发的过程中被发现，而不应该出现在生产环境中。</li>
<li>因为不需要对回滚进行支持，所以 Redis 的内部可以保持简单且快速。</li>
</ul>
<h3 id="Lua脚本"><a href="#Lua脚本" class="headerlink" title="Lua脚本"></a>Lua脚本</h3><p>Lua/ˈluə/是一种轻量级脚本语言，它是用 C 语言编写的，跟数据的存储过程有点类 似。 使用 Lua 脚本来执行 Redis 命令的好处:</p>
<p>1、一次发送多个命令，减少网络开销。</p>
<p>2、Redis 会将整个脚本作为一个整体执行，不会被其他请求打断，保持原子性。 </p>
<p>3、对于复杂的组合命令，我们可以放在文件中，可以实现程序之间的命令集复用。</p>
<h4 id="Lua应用"><a href="#Lua应用" class="headerlink" title="Lua应用"></a>Lua应用</h4><p>分布式锁</p>
<p>限流</p>
<h2 id="管理"><a href="#管理" class="headerlink" title="管理"></a>管理</h2><h3 id="持久化"><a href="#持久化" class="headerlink" title="持久化"></a>持久化</h3><ul>
<li><p>快照RDB</p>
<p>  全量备份</p>
</li>
<li><p>AOF 指令 </p>
<ul>
<li>1条指令执行一次刷盘</li>
<li>1段时间执行一次刷盘</li>
<li>1s执行一次刷盘</li>
</ul>
</li>
<li><p>RDB快照 +AOF同步</p>
</li>
</ul>
<p>​    </p>
<h2 id="集群"><a href="#集群" class="headerlink" title="集群"></a>集群</h2><p>​    高可用 主从同步(RDB快照 +AOF同步) 、raft 一致性算法 、gossip 通信协议</p>
<p>​    高性能 读写分离</p>
<p>​    分片 横向扩展 算法槽</p>
<p><a href="https://redis.io/topics/cluster-spec" target="_blank" rel="noopener">https://redis.io/topics/cluster-spec</a></p>
<p>参考:</p>
<blockquote>
<p>redis深度历险</p>
</blockquote>

      
       <hr><span style="font-style: italic;color: gray;"> 转载请注明来源，欢迎对文章中的引用来源进行考证，欢迎指出任何有错误或不够清晰的表达。可以在下面评论区评论，也可以邮件至 951488791@qq.com </span>
    </div>
</article>



<div class="article_copyright">
    <p><span class="copy-title">文章标题:</span>redis深入浅出</p>
    <p><span class="copy-title">文章字数:</span><span class="post-count">5.3k</span></p>
    <p><span class="copy-title">本文作者:</span><a href="javascript:void(0)" title="zhengyumin">zhengyumin</a></p>
    <p><span class="copy-title">发布时间:</span>2019-06-10, 18:33:40</p>
    <p><span class="copy-title">最后更新:</span>2020-02-28, 18:57:55</p>
    <span class="copy-title">原始链接:</span><a class="post-url" href="/2019/06/10/Overview_Redis/" title="redis深入浅出">http://yoursite.com/2019/06/10/Overview_Redis/</a>
    <p>
        <span class="copy-title">版权声明:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target="_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
    </p>
</div>





    




    </div>
    <div class="copyright">
        <p class="footer-entry">©2016-2019 zhengyumin</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full"><span class="min "></span></button>
<button class="post-toc-menu"><span class="post-toc-menu-icons"></span></button>
<div class="post-toc"><span class="post-toc-title">目录</span>
    <div class="post-toc-content">

    </div>
</div>
<a class="" id="rocket" href="javascript:void(0)"></a>
    </div>
</div>
<div class="acParent"></div>

</body>
<script src="/js/jquery.pjax.js?v=1.0.1"></script>

<script src="/js/script.js?v=1.0.1"></script>
<script>
    var img_resize = 'default';
    /*作者、标签的自动补全*/
    $(function () {
        $('.search').AutoComplete({
            'data': ['#week','#hide','#jdk','#packages','#utils','#juc','#classLoader','#java','#note','#jvm','#distributed','#netty','#nio','#framework','#kafka','#zookeeper','#Spec','#thread','#tomcat','#mysql','#spring','#hotspot','#j2ee','#redis','#summary','#ioc','#io','#serialization','#file','#lang','#elasticsearch','#servlet','#ejb','#gc','#aop','#event','#map','#collections','#applicationContext','#beanFactory','#spring-mvc','#spring-webflux','#doc',],
            'itemHeight': 20,
            'width': 418
        }).AutoComplete('show');
    })
    function initArticle() {
        /*渲染对应的表格样式*/
        
            $(".post .pjax table").addClass("green_title");
        

        /*渲染打赏样式*/
        

        /*高亮代码块行号*/
        
        $('pre code').each(function(){
            var lines = $(this).text().split('\n').length - 1, widther='';
            if (lines>99) {
                widther = 'widther'
            }
            var $numbering = $('<ul/>').addClass('pre-numbering ' + widther).attr("unselectable","on");
            $(this).addClass('has-numbering ' + widther)
                    .parent()
                    .append($numbering);
            for(var i=1;i<=lines;i++){
                $numbering.append($('<li/>').text(i));
            }
        });
        

        /*访问数量*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*代码高亮，行号对齐*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
    }

    /*打赏页面隐藏与展示*/
    

</script>

<!--加入行号的高亮代码块样式-->

<style>
    pre{
        position: relative;
        margin-bottom: 24px;
        border-radius: 10px;
        border: 1px solid #e2dede;
        background: #FFF;
        overflow: hidden;
    }
    code.has-numbering{
        margin-left: 30px;
    }
    code.has-numbering.widther{
        margin-left: 35px;
    }
    .pre-numbering{
        margin: 0px;
        position: absolute;
        top: 0;
        left: 0;
        width: 20px;
        padding: 0.5em 3px 0.7em 5px;
        border-right: 1px solid #C3CCD0;
        text-align: right;
        color: #AAA;
        background-color: ;
    }
    .pre-numbering.widther {
        width: 35px;
    }
</style>

<!--自定义样式设置-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
        .nav .hide-list.fullscreen {
            left: 492px
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*列表样式*/
    

    /* 背景图样式 */
    
    


    /*引用块样式*/
    

    /*文章列表背景图*/
    
    .nav-right:before {
        content: ' ';
        display: block;
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        opacity: 0.3;
        background: url("https://i.loli.net/2019/07/22/5d3521411f3f169375.png");
        background-repeat: no-repeat;
        background-position: 50% 0;
        -ms-background-size: cover;
        -o-background-size: cover;
        -moz-background-size: cover;
        -webkit-background-size: cover;
        background-size: cover;
    }
    

    
</style>







</html>
