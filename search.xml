<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>spring Q&amp;A</title>
      <link href="/2019/12/02/spring-Q-A/"/>
      <url>/2019/12/02/spring-Q-A/</url>
      
        <content type="html"><![CDATA[<h1 id="springå­¦ä¹ é—®é¢˜è®°å½•"><a href="#springå­¦ä¹ é—®é¢˜è®°å½•" class="headerlink" title="springå­¦ä¹ é—®é¢˜è®°å½•"></a>springå­¦ä¹ é—®é¢˜è®°å½•</h1><h2 id="spring-èµ„æºç®¡ç†"><a href="#spring-èµ„æºç®¡ç†" class="headerlink" title="spring èµ„æºç®¡ç†"></a>spring èµ„æºç®¡ç†</h2><p>Q:spring ClassLoaderæ˜¯æ€ä¹ˆç ´ååŒäº²å§”æ´¾çš„?</p><p><a href="https://www.cnblogs.com/binarylei/p/10312531.html" target="_blank" rel="noopener">https://www.cnblogs.com/binarylei/p/10312531.html</a></p><p>Q:ResourceLoaderçš„é—®é¢˜?</p><h2 id="BeanFactory"><a href="#BeanFactory" class="headerlink" title="BeanFactory"></a>BeanFactory</h2><p>Q:BeanFactory å’ŒApplicationçš„å…³ç³»?</p><p>Q:springå®¹å™¨å’ŒspringMvcå®¹å™¨æ˜¯ä¸€ä¸ªä¸œè¥¿å—? è¯´è¯´çˆ¶å­å®¹å™¨?</p><p>A:<a href="https://blog.csdn.net/qfikh/article/details/80507011" target="_blank" rel="noopener">https://blog.csdn.net/qfikh/article/details/80507011</a></p><p>Q:ç®€å•è¯´è¯´ä½ å¯¹springçš„ç†è§£?</p><p>A:?</p><p>Q: BeanFactory.getBean() å‘ç”Ÿäº†ä»€ä¹ˆ?beançš„åˆ›å»ºè¿‡ç¨‹?</p><p>A:?</p><p>Q:springæ˜¯æ€ä¹ˆå¤„ç†å¾ªç¯ä¾èµ–é—®é¢˜?</p><p>Q:ä¸ºä»€ä¹ˆéœ€è¦singletonFactories? </p><p>A:éœ€è¦Factoriesæ¥åˆ›bean</p><p>Q:springçº¿ç¨‹å®‰å…¨é—®é¢˜</p><p>A:<a href="https://segmentfault.com/a/1190000004255203" target="_blank" rel="noopener">https://segmentfault.com/a/1190000004255203</a></p><p>Q: beanFactoryã€factorybeanã€ObjectFactoryçš„åŒºåˆ«ä½ èƒ½è¯´è¯´å—</p><p>Q: which  runs first?  beanPostProcess  or Initialization Callbacks </p><p>A:You can refer to the section 5.8.1 of the Spring docs <a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/html/beans.html#beans-factory-extension" target="_blank" rel="noopener">here</a>. The key point here is that the â€œpostProcessBeforeInitializationâ€ should be read as â€œpostProcessBeforeInitializationCallbackâ€ and â€œpostProcessAfterInitializationâ€ should be read as â€œpostProcessAfterInitializationCallbackâ€. So these are pre and post processeors after the before/after initialization callback are run by the Spring container on the bean. This is what is conveyed in the docs of these methods <a href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/beans/factory/config/BeanPostProcessor.html#postProcessAfterInitialization-java.lang.Object-java.lang.String-" target="_blank" rel="noopener">here</a> too.</p><p>Q: å¯åŠ¨æ—¶å€™æ§åˆ¶å°æ‰“å°çš„è¿™ä¸ªæ˜¯ä»€ä¹ˆæ„æ€å‘¢? not eligible for auto-proxying</p><p>A:<code>BeanPostProcessor</code> instances and AOP auto-proxying</p><p>Classes that implement the <code>BeanPostProcessor</code> interface are special and are treated differently by the container. All <code>BeanPostProcessor</code> instances and beans that they directly reference are instantiated on startup, as part of the special startup phase of the <code>ApplicationContext</code>. Next, all <code>BeanPostProcessor</code> instances are registered in a sorted fashion and applied to all further beans in the container. Because AOP auto-proxying is implemented as a <code>BeanPostProcessor</code> itself, neither <code>BeanPostProcessor</code> instances nor the beans they directly reference are eligible for auto-proxying and, thus, do not have aspects woven into them.</p><p>For any such bean, you should see an informational log message: <code>Bean someBean is not eligible for getting processed by all BeanPostProcessor interfaces (for example: not eligible for auto-proxying)</code>.</p><p>If you have beans wired into your <code>BeanPostProcessor</code> by using autowiring or <code>@Resource</code> (which may fall back to autowiring), Spring might access unexpected beans when searching for type-matching dependency candidates and, therefore, make them ineligible for auto-proxying or other kinds of bean post-processing. For example, if you have a dependency annotated with <code>@Resource</code> where the field or setter name does not directly correspond to the declared name of a bean and no name attribute is used, Spring accesses other beans for matching them by type.</p><p>Q: all of beanPostProcess and beanFactoryProcess Extends point :Scope?</p><p>A: Also, <code>BeanFactoryPostProcessor</code> instances are scoped per-container.</p><p>marking it for lazy initialization will be ignored?</p><p> As with <code>BeanPostProcessor</code>s , you typically do not want to configure <code>BeanFactoryPostProcessor</code>s for lazy initialization. If no other bean references a <code>Bean(Factory)PostProcessor</code>, that post-processor will not get instantiated at all. Thus, marking it for lazy initialization will be ignored, and the <code>Bean(Factory)PostProcessor</code> will be instantiated eagerly even if you set the <code>default-lazy-init</code> attribute to <code>true</code> on the declaration of your <code></code> element.</p><p>Q:classLoader åŠ è½½æ•ˆç‡ä½?  springæœ‰å“ªäº›ä¼˜åŒ– ?</p><p>A:Spring IoC çš„ Lazy loading æœ‰å…³, Spring IoC ä¸ºäº†åŠ å¿«åˆå§‹åŒ–é€Ÿåº¦, å› æ­¤å¤§é‡ä½¿ç”¨äº†å»¶æ—¶åŠ è½½æŠ€æœ¯. è€Œä½¿ç”¨ classloader ä¸éœ€è¦æ‰§è¡Œç±»ä¸­çš„åˆå§‹åŒ–ä»£ç , å¯ä»¥åŠ å¿«åŠ è½½é€Ÿåº¦, æŠŠç±»çš„åˆå§‹åŒ–å·¥ä½œç•™åˆ°å®é™…ä½¿ç”¨åˆ°è¿™ä¸ªç±»çš„æ—¶å€™.</p><p>Q:æœ‰çœ‹è¿‡å®˜æ–¹æ–‡æ¡£å— ? Annotation-based Container Configuration å’Œ </p><p>Java-based Container Configuration</p><p>Using JSR 330 Standard Annotations  è¿™å‡ ç« çš„ä¾§é‡ç‚¹?(æˆ–è€…è°ˆè°ˆä½ å¯¹æ³¨è§£çš„ç†è§£)</p><p>A:</p><p><strong>Annotation-based Container Configuration    (å…ƒä¿¡æ¯é…ç½®)</strong> </p><p>ğŸ”‘å…³é”®è¯: configuration metadata; @Autowired ;@Order;@Primary;@Qulifier;@Resources;BeanPostProcessor</p><p><strong>Java-based Container Configuration  (javaä»£ç çš„æ–¹å¼å®ç°é…ç½®)</strong></p><p>@Bean; @Configuration;AnnotationConfigApplicationContext;lite vs full;@Import; @ImportResource;@Condition</p><p><strong>Java-based Container Configuration (ä¸»è¦æ˜¯æ”¯æŒJSR330)</strong></p><p>ğŸ”‘å…³é”®è¯: javax.inject ; @Inject; @Named</p><p>Q:Springçš„é…ç½®æ–‡ä»¶ä¸­</p><p>&lt;context:annotation-config /&gt;</p><p>&lt;context:component-scan base-package=â€â€/&gt;</p><p>&lt;mvc:annotation-driven /&gt; åˆ†åˆ«æœ‰ä»€ä¹ˆä¸åŒå’Œè”ç³»?</p><p>A:é‚£æ˜¯å› ä¸º&lt;context:annotation-config /&gt;<strong>ä»…èƒ½å¤Ÿåœ¨å·²ç»åœ¨å·²ç»æ³¨å†Œè¿‡çš„beanä¸Šé¢èµ·ä½œç”¨</strong>ã€‚</p><p><a href="https://stackoverflow.com/questions/7414794/difference-between-contextannotation-config-and-contextcomponent-scan" target="_blank" rel="noopener">https://stackoverflow.com/questions/7414794/difference-between-contextannotation-config-and-contextcomponent-scan</a></p><p>Q:Full @Configuration vs â€œliteâ€ @Bean mode ?</p><p>A:åœ¨<code>lite @Bean mode</code>æ¨¡å¼ä¸‹ï¼Œ <code>@Bean</code>æ–¹æ³•ä¸ä¼šè¢«CGLIBä»£ç†</p><p>That definitely would be problematic: In Spring, instantiated beans have a <code>singleton</code> scope by default. </p><p>This is where the magic comes in: All <code>@Configuration</code> classes are subclassed at startup-time with <code>CGLIB</code>. </p><p>In the subclass, the child method checks the container first for any cached (scoped) beans before it calls the parent method and creates a new instance.</p><p>Q:spring ä¸ºä»€ä¹ˆä¼šä½¿ç”¨cglib ã€ä»€ä¹ˆæ—¶å€™ä½¿ç”¨?</p><p>A: Springæä¾›äº†ProxyFactoryBeanåˆ›å»ºä»£ç†ï¼ŒåŠåˆ©ç”¨BeanPostProcessorå®ç°è‡ªåŠ¨åˆ›å»ºä»£ç†ã€‚</p><p>Q : spring Xml schema æ‰©å±•çš„äº†è§£?</p><p>A : <a href="https://juejin.im/post/5d06018b518825276a286a3d" target="_blank" rel="noopener">https://juejin.im/post/5d06018b518825276a286a3d</a></p><p>Q:LTWæ˜¯å•¥?</p><p>A:  Springæ˜¯åœ¨è¿è¡ŒæœŸåˆ©ç”¨JDKæˆ–CGLibåˆ›å»ºä»£ç†ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨ç±»åŠ è½½æœŸé—´é€šè¿‡å­—èŠ‚ç ç¼–è¾‘çš„æŠ€æœ¯ï¼Œå°†åˆ‡é¢ç»‡å…¥åˆ°ç›®æ ‡ç±»ä¸­ï¼Œè¿™ç§ç»‡å…¥æ–¹å¼ç§°ä¸ºLTW(Load Time Weaving)ã€‚Springä¸ºLTWçš„è¿‡ç¨‹æä¾›äº†ç»†ç²’åº¦çš„æ§åˆ¶ï¼Œå®ƒæ”¯æŒåœ¨å•ä¸ªClassLoaderèŒƒå›´å†…å®æ–½ç±»æ–‡ä»¶è½¬æ¢ï¼Œä¸”é…ç½®æ›´ä¸ºç®€å•ã€‚</p><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://blog.csdn.net/evergreenfetch/article/details/42002017" target="_blank" rel="noopener">https://blog.csdn.net/evergreenfetch/article/details/42002017</a></p><p>å°† spring-agent.jar, </p><p>spring-aspects.jar, </p><p>aspectj-weaver.jar, </p><p>aspectj-rt.jar åŠ å…¥åˆ° classpath ä¸­ï¼Œ è¿è¡ŒæœŸä¸»è¦å‘ç”Ÿä»¥ä¸‹è°ƒç”¨ : </p><p>LoadTimeWeaverBeanDefinitionParser (spring.jar) // è§£æé…ç½®<br>-&gt;  AspectJWeavingEnabler (spring.jar) // å¼€å¯ aspectj weaving<br>-&gt;  InstrumentationSavingAgent (spring-agent.jar)  // è·å– instrumentation<br>-&gt;  InstrumentationLoadTimeWeaver#addTransformer (spring.jar) // å¢åŠ  aspectj class transformer åˆ° instrumentation<br>-&gt;  ClassPreProcessorAgentAdapter#transform (aspectj-weaver.jar) // aspectj æ‹¦æˆª domain object è£…è½½<br>-&gt;  AnnotationBeanConfigurerAspect#configureBean (spring-aspects.jar) // spring æ³¨å…¥ä¾èµ–åˆ°æ ‡æ³¨äº† @Configurable çš„å¯¹è±¡ä¸­</p><p>beanfactoryæ”¯æŒaopå—ï¼Ÿ</p><p>BeanFactory or ApplicationContext?</p><p>Users are sometimes unsure whether a BeanFactory or an ApplicationContext is best suited for use in a particular situation. A BeanFactory pretty much just instantiates and configures beans. An ApplicationContext also does that, and it provides the supporting infrastructure to enable lots of enterprise-specific features such as transactions and AOP.</p><p>ä¸ºä»€ä¹ˆ</p><p> aopæ˜¯åœ¨ä»€ä¹ˆç»‡å…¥çš„ ï¼Ÿ</p><p>-beanåˆå§‹åŒ–æ—¶</p><p><a href="https://juejin.im/entry/5b572405e51d451964625f66" target="_blank" rel="noopener">https://juejin.im/entry/5b572405e51d451964625f66</a></p><p><a href="https://www.javadoop.com/post/spring-aop-intro" target="_blank" rel="noopener">https://www.javadoop.com/post/spring-aop-intro</a></p><p>factorybean beanfactory?</p><p>- mvcå®¹å™¨å’Œiocå®¹å™¨ï¼Ÿ</p><p>âˆš aopå’Œaspectj?</p><p>âˆš äº‹ä»¶é©±åŠ¨ è¯·æ±‚é©±åŠ¨</p><p>âˆš spring beançš„å®ä¾‹åŒ–ï¼Ÿä¸åŠ è½½å¯¹è±¡çš„è¿‡ç¨‹ï¼Ÿ</p><p><a href="https://swenfang.github.io/2019/04/22/Springé¢è¯•é¢˜/" target="_blank" rel="noopener">https://swenfang.github.io/2019/04/22/Spring%E9%9D%A2%E8%AF%95%E9%A2%98/</a></p><p><a href="https://swenfang.github.io/2019/05/12/é¢è¯•æ€»ç»“/é¢è¯•æ€»ç»“/" target="_blank" rel="noopener">https://swenfang.github.io/2019/05/12/%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93/%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93/</a></p><p>æ€ä¹ˆè§£å†³å¾ªç¯ä¾èµ–é—®é¢˜?</p><p>spring listenerçš„åˆå§‹åŒ–æ—¶æœº?</p><p>springmvcå®¹å™¨åˆå§‹åŒ–æ—¶æœº?ç¬¬ä¸€æ¬¡è¯·æ±‚ä¸ºå•¥æ¯”è¾ƒæ…¢?</p><p>springBoot ä¸­çš„ webApplicationContext ä»€ä¹ˆæ—¶å€™åˆ›å»ºçš„?</p><p>org.springframework.web.servlet.FrameworkServlet#initWebApplicationContext</p><p>springBootçš„å¯åŠ¨æµç¨‹?</p><p>beanä¸ºä»€ä¹ˆä¼šè¢«é‡å¤åˆå§‹åŒ–?</p>]]></content>
      
      
      <categories>
          
          <category> spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Documentation-Spring_Core_IOC</title>
      <link href="/2019/10/29/Documentation-Spring-Core-IOC/"/>
      <url>/2019/10/29/Documentation-Spring-Core-IOC/</url>
      
        <content type="html"><![CDATA[<p>å…³é”®å­—:  bean(å®šä¹‰-å…³ç³»ã€ åŠ è½½æ–¹å¼(åˆ›å»ºã€è§£æ)  ã€æ‰©å±•)ã€application(å®¹å™¨ã€resourceã€åŠ è½½ã€æ‰©å±•)ã€æ³¨è§£ã€ç¯å¢ƒ(Environment)</p><p>Tips: åœ¨çœ‹å®˜æ–¹æ–‡æ¡£æ—¶å€™çš„ä¸€äº›æ‘˜æŠ„ã€æ€»ç»“(å»ºè®®ç›´æ¥é˜…è¯»å®˜æ–¹æ–‡æ¡£</p><p><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans" target="_blank" rel="noopener">https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans</a></p><p>Version 5.2.1.RELEASE  ) </p><p>IOC å®¹å™¨(DI æŸ¥æ‰¾å’Œæ³¨å…¥)</p><p>â€‹    â€”&gt; Beanç®¡ç† (å…³ç³»ã€ä½œç”¨åŸŸã€ç”Ÿå‘½å‘¨æœŸã€æ‰©å±•ç‚¹)</p><p>â€‹    â€”&gt; Beanå…ƒä¿¡æ¯(å±æ€§å€¼)</p><p>åŸºç¡€è®¾æ–½æ‰©å±• (èµ„æºç®¡ç† ç±»å‹ äº‹ä»¶ç­‰)</p><a id="more"></a><!--toc--><h2 id="ğŸŒŸintroduction-ï¼ˆä»‹ç»ï¼‰"><a href="#ğŸŒŸintroduction-ï¼ˆä»‹ç»ï¼‰" class="headerlink" title="ğŸŒŸintroduction ï¼ˆä»‹ç»ï¼‰"></a>ğŸŒŸintroduction ï¼ˆä»‹ç»ï¼‰</h2><p>å…³é”®è¯: BeanFactoryã€ApplicationContext (App internationalization ã€event ã€web)ã€beans</p><p>This chapter covers the Spring Framework implementation of the Inversion of Control (IoC) principle.</p><p> IoC is also known as dependency injection (DI)</p><p>The <code>org.springframework.beans</code> and <code>org.springframework.context</code> packages are the basis for Spring Frameworkâ€™s IoC container. </p><h3 id="BeanFactory"><a href="#BeanFactory" class="headerlink" title="BeanFactory"></a>BeanFactory</h3><p>The <a href="https://docs.spring.io/spring-framework/docs/5.2.0.RELEASE/javadoc-api/org/springframework/beans/factory/BeanFactory.html" target="_blank" rel="noopener"><code>BeanFactory</code></a> interface provides an advanced configuration mechanism capable of managing any type of object</p><p>æä¾›äº†ä¸€ç§èƒ½å¤Ÿç®¡ç†ä»»ä½•ç±»å‹å¯¹è±¡çš„é«˜çº§é…ç½®æœºåˆ¶</p><h3 id="ApplicationContext"><a href="#ApplicationContext" class="headerlink" title="ApplicationContext"></a>ApplicationContext</h3><p><a href="https://docs.spring.io/spring-framework/docs/5.2.0.RELEASE/javadoc-api/org/springframework/context/ApplicationContext.html" target="_blank" rel="noopener"><code>ApplicationContext</code></a> </p><ul><li>Easier integration with Springâ€™s AOP features (å’ŒAOPæ›´å¥½é›†æˆ)</li><li>Message resource handling (for use in internationalization)</li><li>Event publication (äº‹ä»¶å‘å¸ƒæœºåˆ¶)</li><li>Application-layer specific contexts such as the <code>WebApplicationContext</code> for use in web applications.</li></ul><h3 id="Beans"><a href="#Beans" class="headerlink" title="Beans"></a>Beans</h3><p>A bean is an object that is instantiated, assembled, and otherwise managed by a Spring IoC container.</p><p>Beans, and the dependencies among them, are reflected in the configuration metadata used by a container.</p><p>beanæ˜¯ç”±Spring IoCå®¹å™¨å®ä¾‹åŒ–ã€ç»„è£…å’Œç®¡ç†çš„å¯¹è±¡ã€‚</p><p>beanåŠå…¶ä¹‹é—´çš„ä¾èµ–å…³ç³»åæ˜ åœ¨å®¹å™¨ä½¿ç”¨çš„é…ç½®å…ƒæ•°æ®ä¸­ã€‚</p><h2 id="ğŸŒŸContainer-overview-ï¼ˆå®¹å™¨é¢„è§ˆï¼‰"><a href="#ğŸŒŸContainer-overview-ï¼ˆå®¹å™¨é¢„è§ˆï¼‰" class="headerlink" title="ğŸŒŸContainer overview ï¼ˆå®¹å™¨é¢„è§ˆï¼‰"></a>ğŸŒŸContainer overview ï¼ˆå®¹å™¨é¢„è§ˆï¼‰</h2><p>å…³é”®è¯: configuration metadataã€Instantiating</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g8fetrcx4vj30du088mxd.jpg" alt="container magic"></p><h3 id="configuration-metadata-é…ç½®å…ƒä¿¡æ¯"><a href="#configuration-metadata-é…ç½®å…ƒä¿¡æ¯" class="headerlink" title="configuration metadata (é…ç½®å…ƒä¿¡æ¯)"></a>configuration metadata (é…ç½®å…ƒä¿¡æ¯)</h3><p>The configuration metadata is represented in XML, Java annotations, or Java code. </p><p>annotations </p><ul><li>spring 2.5   annotation-based</li><li>spring 3.0   java-based  Starting with Spring 3.0, many features provided by the Spring JavaConfig project became part of the core Spring Framework. Thus, you can define beans external to your application classes by using Java rather than XML files. To use these new features, see the @Configuration, @Bean, @Import, and @DependsOn annotations.</li></ul><h3 id="Instantiating-a-Container-å®ä¾‹åŒ–å®¹å™¨"><a href="#Instantiating-a-Container-å®ä¾‹åŒ–å®¹å™¨" class="headerlink" title="Instantiating a Container (å®ä¾‹åŒ–å®¹å™¨)"></a>Instantiating a Container (å®ä¾‹åŒ–å®¹å™¨)</h3><!--The location path or paths supplied to an `ApplicationContext` constructor are resource strings that let the container load configuration metadata from a variety of external resources, such as the local file system, the Java `CLASSPATH`, and so on.--><p>æä¾›ç»™â€œApplicationContextâ€æ„é€ å‡½æ•°çš„ä½ç½®è·¯å¾„æ˜¯èµ„æºå­—ç¬¦ä¸²ï¼Œå®ƒå…è®¸å®¹å™¨ä»å„ç§å¤–éƒ¨èµ„æº(å¦‚æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿã€Javaâ€œCLASSPATHâ€ç­‰)åŠ è½½é…ç½®å…ƒæ•°æ®ã€‚</p><h3 id="Using-the-Container-ä½¿ç”¨å®¹å™¨"><a href="#Using-the-Container-ä½¿ç”¨å®¹å™¨" class="headerlink" title="Using the Container (ä½¿ç”¨å®¹å™¨)"></a>Using the Container (ä½¿ç”¨å®¹å™¨)</h3><pre><code class="java">// create and configure beansApplicationContext context = new ClassPathXmlApplicationContext(&quot;services.xml&quot;, &quot;daos.xml&quot;);// retrieve configured instancePetStoreService service = context.getBean(&quot;petStore&quot;, PetStoreService.class);// use configured instanceList&lt;String&gt; userList = service.getUsernameList();</code></pre><h2 id="ğŸŒŸBean-Overview-bean-é¢„è§ˆ"><a href="#ğŸŒŸBean-Overview-bean-é¢„è§ˆ" class="headerlink" title="ğŸŒŸBean Overview (bean é¢„è§ˆ)"></a>ğŸŒŸBean Overview (bean é¢„è§ˆ)</h2><p>beançš„ä¸€ä¸ªä»‹ç»</p><p>å…³é”®è¯: beanDefinitionã€instantiatingã€Naming  </p><h3 id="beanDefinition-beanå®šä¹‰"><a href="#beanDefinition-beanå®šä¹‰" class="headerlink" title="beanDefinition(beanå®šä¹‰)"></a>beanDefinition(beanå®šä¹‰)</h3><p>Within the container itself, these bean definitions are represented as <code>BeanDefinition</code> objects, which contain (among other information) the following metadata:</p><ul><li>A package-qualified class name: typically, the actual implementation class of the bean being defined.(åå­—)</li><li>Bean behavioral configuration elements, which state how the bean should behave in the container (scope, lifecycle callbacks, and so forth). (çŠ¶æ€ã€è¡Œä¸º)</li><li>References to other beans that are needed for the bean to do its work. These references are also called collaborators or dependencies. (ä¾èµ–å…³ç³»)</li><li>Other configuration settings to set in the newly created objectâ€‰â€”â€‰for example, the size limit of the pool or the number of connections to use in a bean that manages a connection pool.</li></ul><table><thead><tr><th style="text-align:left">Property</th><th style="text-align:left">Explained inâ€¦</th></tr></thead><tbody><tr><td style="text-align:left">Class</td><td style="text-align:left"><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-factory-class" target="_blank" rel="noopener">Instantiating Beans</a></td></tr><tr><td style="text-align:left">Name</td><td style="text-align:left"><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-beanname" target="_blank" rel="noopener">Naming Beans</a></td></tr><tr><td style="text-align:left">Scope</td><td style="text-align:left"><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-factory-scopes" target="_blank" rel="noopener">Bean Scopes</a></td></tr><tr><td style="text-align:left">Constructor arguments</td><td style="text-align:left"><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-factory-collaborators" target="_blank" rel="noopener">Dependency Injection</a></td></tr><tr><td style="text-align:left">Properties</td><td style="text-align:left"><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-factory-collaborators" target="_blank" rel="noopener">Dependency Injection</a></td></tr><tr><td style="text-align:left">Autowiring mode</td><td style="text-align:left"><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-factory-autowire" target="_blank" rel="noopener">Autowiring Collaborators</a></td></tr><tr><td style="text-align:left">Lazy initialization mode</td><td style="text-align:left"><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-factory-lazy-init" target="_blank" rel="noopener">Lazy-initialized Beans</a></td></tr><tr><td style="text-align:left">Initialization method</td><td style="text-align:left"><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-factory-lifecycle-initializingbean" target="_blank" rel="noopener">Initialization Callbacks</a></td></tr><tr><td style="text-align:left">Destruction method</td><td style="text-align:left"><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-factory-lifecycle-disposablebean" target="_blank" rel="noopener">Destruction Callbacks</a></td></tr></tbody></table><h3 id="naming-bean-beanå‘½å"><a href="#naming-bean-beanå‘½å" class="headerlink" title="naming  bean (beanå‘½å)"></a>naming  bean (beanå‘½å)</h3><h4 id="Aliasing-a-Bean-outside-the-Bean-Definition"><a href="#Aliasing-a-Bean-outside-the-Bean-Definition" class="headerlink" title="Aliasing a Bean outside the Bean Definition"></a>Aliasing a Bean outside the Bean Definition</h4><h3 id="Instantiating-bean-beanæ„é€ æ–¹å¼"><a href="#Instantiating-bean-beanæ„é€ æ–¹å¼" class="headerlink" title="Instantiating bean (beanæ„é€ æ–¹å¼)"></a>Instantiating bean (beanæ„é€ æ–¹å¼)</h3><p>You can use the <code>Class</code> property in one of two ways:</p><ul><li>Typically, to specify the bean class to be constructed in the case where the container itself directly creates the bean by calling its constructor reflectively, somewhat equivalent to Java code with the <code>new</code> operator.</li><li>To specify the actual class containing the <code>static</code> factory method that is invoked to create the object, in the less common case where the container invokes a <code>static</code> factory method on a class to create the bean. The object type returned from the invocation of the <code>static</code> factory method may be the same class or another class entirely.</li></ul><h4 id="Instantiation-with-a-Constructor"><a href="#Instantiation-with-a-Constructor" class="headerlink" title="Instantiation with a Constructor"></a>Instantiation with a Constructor</h4><!--The Spring IoC container can manage virtually any class you want it to manage. It is not limited to managing true JavaBeans.--> <!--Most Spring users prefer actual JavaBeans with only a default (no-argument) constructor and appropriate setters and getters modeled after the properties in the container.--> <!--You can also have more exotic non-bean-style classes in your container. If, for example, you need to use a legacy connection pool that absolutely does not adhere to the JavaBean specification, Spring can manage it as well.--><p>Spring IoCå®¹å™¨å‡ ä¹å¯ä»¥ç®¡ç†æ‚¨å¸Œæœ›å®ƒç®¡ç†çš„ä»»ä½•ç±»ã€‚å®ƒä¸ä»…é™äºç®¡ç†çœŸæ­£çš„javabeanã€‚</p><p>å¤§å¤šæ•°Springç”¨æˆ·æ›´å–œæ¬¢å®é™…çš„javabeanï¼Œå®ƒåªæœ‰ä¸€ä¸ªé»˜è®¤çš„(æ— å‚æ•°çš„)æ„é€ å‡½æ•°ï¼Œä»¥åŠæ ¹æ®å®¹å™¨ä¸­çš„å±æ€§å»ºæ¨¡çš„é€‚å½“çš„setterå’Œgetteræ–¹æ³•ã€‚</p><p>æ‚¨è¿˜å¯ä»¥åœ¨å®¹å™¨ä¸­åŒ…å«æ›´å¤šébeané£æ ¼çš„ç±»ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨éœ€è¦ä½¿ç”¨å®Œå…¨ä¸ç¬¦åˆJavaBeanè§„èŒƒçš„é—ç•™è¿æ¥æ± ï¼ŒSpringä¹Ÿå¯ä»¥ç®¡ç†å®ƒã€‚</p><h4 id="Instantiation-with-a-Static-Factory-Method"><a href="#Instantiation-with-a-Static-Factory-Method" class="headerlink" title="Instantiation with a Static Factory Method"></a>Instantiation with a Static Factory Method</h4><!--One use for such a bean definition is to call `static` factories in legacy code.--><p>è¿™ç§beanå®šä¹‰çš„ä¸€ä¸ªç”¨é€”æ˜¯åœ¨é—ç•™ä»£ç ä¸­è°ƒç”¨â€œé™æ€â€å·¥å‚ã€‚</p><h4 id="Instantiation-by-Using-an-Instance-Factory-Method"><a href="#Instantiation-by-Using-an-Instance-Factory-Method" class="headerlink" title="Instantiation by Using an Instance Factory Method"></a>Instantiation by Using an Instance Factory Method</h4><!--Similar to instantiation through a [static factory method](https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-factory-class-static-factory-method), instantiation with an instance factory method invokes a non-static method of an existing bean from the container to create a new bean.--> <p>ä¸é€šè¿‡é™æ€å·¥å‚æ–¹æ³•å®ä¾‹åŒ–ç±»ä¼¼ï¼Œä½¿ç”¨å®ä¾‹å·¥å‚æ–¹æ³•å®ä¾‹åŒ–å°†ä»å®¹å™¨ä¸­è°ƒç”¨ç°æœ‰beançš„éé™æ€æ–¹æ³•æ¥åˆ›å»ºæ–°beanã€‚</p><blockquote><p>In Spring documentation, â€œfactory beanâ€ refers to a bean that is configured in the Spring container and that creates objects through an <a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-factory-class-instance-factory-method" target="_blank" rel="noopener">instance</a> or <a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-factory-class-static-factory-method" target="_blank" rel="noopener">static</a> factory method. By contrast, <code>FactoryBean</code> (notice the capitalization) refers to a Spring-specific <a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-factory-extension-factorybean" target="_blank" rel="noopener"><code>FactoryBean</code></a>.</p></blockquote><p>åœ¨Springæ–‡æ¡£ä¸­ï¼Œâ€œå·¥å‚beanâ€æŒ‡çš„æ˜¯åœ¨Springå®¹å™¨ä¸­é…ç½®çš„beanï¼Œå®ƒé€šè¿‡å®ä¾‹æˆ–é™æ€å·¥å‚æ–¹æ³•åˆ›å»ºå¯¹è±¡ã€‚ç›¸åï¼ŒFactoryBean(æ³¨æ„å¤§å°å†™)æŒ‡çš„æ˜¯ç‰¹å®šäºspringçš„FactoryBeanã€‚</p><h2 id="ğŸŒŸDependencies-ä¾èµ–"><a href="#ğŸŒŸDependencies-ä¾èµ–" class="headerlink" title="ğŸŒŸDependencies (ä¾èµ–)"></a>ğŸŒŸDependencies (ä¾èµ–)</h2><p>æ›´å¤šæè¿°çš„æ˜¯beanä¹‹é—´çš„å…³ç³»</p><p>å…³é”®è¯: IOCã€DIã€collaborate(åä½œè€…)ã€ construct-b(type index name)ã€ setter-b ã€è§£æè¿‡ç¨‹ã€å¾ªç¯ä¾èµ–ã€æå‰å®ä¾‹ã€è‡ªåŠ¨è£…é…ã€æ–¹æ³•æ³¨å…¥</p><!--A typical enterprise application does not consist of a single object (or bean in the Spring parlance). Even the simplest application has a few objects that work together to present what the end-user sees as a coherent application.--> <!--This next section explains how you go from defining a number of bean definitions that stand alone to a fully realized application where objects collaborate to achieve a goal.--><p>å…¸å‹çš„ä¼ä¸šåº”ç”¨ç¨‹åºä¸åŒ…å«å•ä¸ªå¯¹è±¡(æˆ–Springä¸­çš„bean)ã€‚å³ä½¿æ˜¯æœ€ç®€å•çš„åº”ç”¨ç¨‹åºä¹Ÿæœ‰å‡ ä¸ªå¯¹è±¡ä¸€èµ·å·¥ä½œï¼Œä»¥å‘ˆç°æœ€ç»ˆç”¨æˆ·æ‰€çœ‹åˆ°çš„ä¸€è‡´çš„åº”ç”¨ç¨‹åºã€‚</p><p>ä¸‹ä¸€èŠ‚å°†è§£é‡Šå¦‚ä½•ä»å®šä¹‰è®¸å¤šç‹¬ç«‹çš„beanå®šä¹‰è¿‡æ¸¡åˆ°ä¸€ä¸ªå®Œå…¨å®ç°çš„åº”ç”¨ç¨‹åºï¼Œå…¶ä¸­å¯¹è±¡é€šè¿‡åä½œå®ç°ç›®æ ‡ã€‚</p><h3 id="Dependency-Injection-DI"><a href="#Dependency-Injection-DI" class="headerlink" title="Dependency Injection(DI)"></a>Dependency Injection(DI)</h3><!--Code is cleaner with the DI principle, and decoupling is more effective when objects are provided with their dependencies. The object does not look up its dependencies and does not know the location or class of the dependencies.--><!--DI exists in two major variants: Constructor-based dependency and Setter-based dependency injection. --><p>ä½¿ç”¨DIåŸåˆ™ï¼Œä»£ç æ›´ç®€æ´ï¼Œå¹¶ä¸”å½“å¯¹è±¡æä¾›å…¶ä¾èµ–é¡¹æ—¶ï¼Œè§£è€¦æ›´æœ‰æ•ˆã€‚å¯¹è±¡ä¸æŸ¥æ‰¾å…¶ä¾èµ–é¡¹ï¼Œä¹Ÿä¸çŸ¥é“ä¾èµ–é¡¹çš„ä½ç½®æˆ–ç±»ã€‚</p><h4 id="Constructor-based-Dependency-Injection-æ„é€ æ³¨å…¥"><a href="#Constructor-based-Dependency-Injection-æ„é€ æ³¨å…¥" class="headerlink" title="Constructor-based Dependency Injection(æ„é€ æ³¨å…¥)"></a>Constructor-based Dependency Injection(æ„é€ æ³¨å…¥)</h4><ul><li>Constructor argument type matching</li><li>Constructor argument index</li><li>Constructor argument name</li></ul><h4 id="Setter-based-Dependency-Injection-Setteræ³¨å…¥"><a href="#Setter-based-Dependency-Injection-Setteræ³¨å…¥" class="headerlink" title="Setter-based Dependency Injection(Setteræ³¨å…¥)"></a>Setter-based Dependency Injection(Setteræ³¨å…¥)</h4><!--Setter-based DI is accomplished by the container calling setter methods on your beans after invoking a no-argument constructor or a no-argument `static` factory method to instantiate your bean.--> <!--You configure the dependencies in the form of a `BeanDefinition`, which you use in conjunction with `PropertyEditor` instances to convert properties from one format to another.--> <!--However, most Spring users do not work with these classes directly (that is, programmatically) but rather with XML `bean` definitions, annotated components (that is, classes annotated with `@Component`, `@Controller`, and so forth), or `@Bean` methods in Java-based `@Configuration` classes.--> <!--These sources are then converted internally into instances of `BeanDefinition` and used to load an entire Spring IoC container instance.--><p>åŸºäºsetterçš„DIæ˜¯åœ¨è°ƒç”¨æ— å‚æ•°æ„é€ å‡½æ•°æˆ–æ— å‚æ•°â€œé™æ€â€å·¥å‚æ–¹æ³•æ¥å®ä¾‹åŒ–beanä¹‹åï¼Œé€šè¿‡å®¹å™¨è°ƒç”¨beanä¸Šçš„setteræ–¹æ³•æ¥å®Œæˆçš„ã€‚</p><p>æ‚¨å¯ä»¥å°†ä¾èµ–é¡¹é…ç½®ä¸ºâ€œBeanDefinitionâ€çš„å½¢å¼ï¼Œå¹¶å°†å…¶ä¸â€œPropertyEditorâ€å®ä¾‹ç»“åˆä½¿ç”¨ï¼Œå°†å±æ€§ä»ä¸€ç§æ ¼å¼è½¬æ¢ä¸ºå¦ä¸€ç§æ ¼å¼ã€‚</p><p>ä½†æ˜¯ï¼Œå¤§å¤šæ•°Springç”¨æˆ·å¹¶ä¸ç›´æ¥ä½¿ç”¨è¿™äº›ç±»(ä¹Ÿå°±æ˜¯è¯´ï¼Œä»¥ç¼–ç¨‹çš„æ–¹å¼)ï¼Œè€Œæ˜¯ä½¿ç”¨XML â€˜ bean â€˜å®šä¹‰ã€å¸¦æ³¨é‡Šçš„ç»„ä»¶(ä¹Ÿå°±æ˜¯è¯´ï¼Œä½¿ç”¨â€™ @Component â€˜ã€â€™ @Controller â€˜ç­‰æ³¨é‡Šçš„ç±»)æˆ–åŸºäºjavaçš„â€™ @Configuration â€˜ç±»ä¸­çš„â€™ @Bean â€˜æ–¹æ³•ã€‚</p><p>ç„¶åï¼Œè¿™äº›æºåœ¨å†…éƒ¨è½¬æ¢ä¸ºâ€œBeanDefinitionâ€å®ä¾‹ï¼Œå¹¶ç”¨äºåŠ è½½æ•´ä¸ªSpring IoCå®¹å™¨å®ä¾‹ã€‚</p><p><strong>Constructor-based or setter-based DI?</strong></p><blockquote><p>Since you can mix constructor-based and setter-based DI, it is a good rule of thumb to use constructors for mandatory dependencies and setter methods or configuration methods for optional dependencies. Note that use of the <a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-required-annotation" target="_blank" rel="noopener">@Required</a> annotation on a setter method can be used to make the property be a required dependency; however, constructor injection with programmatic validation of arguments is preferable.</p><p>The Spring team generally advocates constructor injection, as it lets you implement application components as immutable objects and ensures that required dependencies are not <code>null</code>. Furthermore, constructor-injected components are always returned to the client (calling) code in a fully initialized state. As a side note, a large number of constructor arguments is a bad code smell, implying that the class likely has too many responsibilities and should be refactored to better address proper separation of concerns.</p><p>Setter injection should primarily only be used for optional dependencies that can be assigned reasonable default values within the class. Otherwise, not-null checks must be performed everywhere the code uses the dependency. One benefit of setter injection is that setter methods make objects of that class amenable to reconfiguration or re-injection later. Management through <a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/integration.html#jmx" target="_blank" rel="noopener">JMX MBeans</a> is therefore a compelling use case for setter injection.</p></blockquote><h4 id="Dependency-Resolution-Process-ä¾èµ–è§£æè¿‡ç¨‹"><a href="#Dependency-Resolution-Process-ä¾èµ–è§£æè¿‡ç¨‹" class="headerlink" title="Dependency Resolution Process (ä¾èµ–è§£æè¿‡ç¨‹)"></a>Dependency Resolution Process (ä¾èµ–è§£æè¿‡ç¨‹)</h4><p>ApplicationContext(configuration metadata)  -&gt; æ³¨å…¥æ–¹å¼ -&gt; æ³¨å…¥valueåˆå§‹åŒ– -&gt; value-type</p><p>The container performs bean dependency resolution as follows:</p><ul><li>The <code>ApplicationContext</code> is created and initialized with configuration metadata that describes all the beans. Configuration metadata can be specified by XML, Java code, or annotations.(é…ç½®å…ƒä¿¡æ¯)</li><li>For each bean, its dependencies are expressed in the form of properties, constructor arguments, or arguments to the static-factory method (if you use that instead of a normal constructor). These dependencies are provided to the bean, when the bean is actually created. (æ³¨å…¥æ–¹å¼)</li><li>Each property or constructor argument is an actual definition of the value to set, or a reference to another bean in the container.(value)</li><li>Each property or constructor argument that is a value is converted from its specified format to the actual type of that property or constructor argument. By default, Spring can convert a value supplied in string format to all built-in types, such as <code>int</code>, <code>long</code>, <code>String</code>, <code>boolean</code>, and so forth.(value-type)</li></ul><h5 id="Circular-dependencies-å¾ªç¯ä¾èµ–é—®é¢˜"><a href="#Circular-dependencies-å¾ªç¯ä¾èµ–é—®é¢˜" class="headerlink" title="Circular dependencies (å¾ªç¯ä¾èµ–é—®é¢˜)"></a>Circular dependencies (å¾ªç¯ä¾èµ–é—®é¢˜)</h5><blockquote><p>If you use predominantly constructor injection, it is possible to create an unresolvable circular dependency scenario.</p><p>For example: Class A requires an instance of class B through constructor injection, and class B requires an instance of class A through constructor injection. </p><p>If you configure beans for classes A and B to be injected into each other, the Spring IoC container detects this circular reference at runtime, and throws a <code>BeanCurrentlyInCreationException</code>.</p><p>One possible solution is to edit the source code of some classes to be configured by setters rather than constructors. Alternatively, avoid constructor injection and use setter injection only. </p><p>In other words, although it is not recommended, you can configure circular dependencies with setter injection.</p></blockquote><p>å¦‚æœä¸»è¦ä½¿ç”¨æ„é€ å‡½æ•°æ³¨å…¥ï¼Œå¯èƒ½ä¼šåˆ›å»ºæ— æ³•è§£æçš„å¾ªç¯ä¾èµ–åœºæ™¯ã€‚</p><p>ä¾‹å¦‚:ç±»Aéœ€è¦ä¸€ä¸ªç±»Bé€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥çš„å®ä¾‹ï¼Œè€Œç±»Béœ€è¦ä¸€ä¸ªç±»Aé€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥çš„å®ä¾‹ã€‚</p><p>å¦‚æœæ‚¨å°†beané…ç½®ä¸ºç±»Aå’ŒBç›¸äº’æ³¨å…¥ï¼ŒSpring IoCå®¹å™¨ä¼šåœ¨è¿è¡Œæ—¶æ£€æµ‹åˆ°è¿™ä¸ªå¾ªç¯å¼•ç”¨ï¼Œå¹¶æŠ›å‡ºä¸€ä¸ªâ€œBeanCurrentlyInCreationExceptionâ€ã€‚</p><p>ä¸€ç§å¯èƒ½çš„è§£å†³æ–¹æ¡ˆæ˜¯ç¼–è¾‘æŸäº›ç±»çš„æºä»£ç ï¼Œç”±setterè€Œä¸æ˜¯æ„é€ å‡½æ•°æ¥é…ç½®ã€‚å¦å¤–ï¼Œé¿å…æ„é€ å‡½æ•°æ³¨å…¥ï¼Œåªä½¿ç”¨setteræ³¨å…¥ã€‚</p><p>æ¢å¥è¯è¯´ï¼Œå°½ç®¡ä¸å»ºè®®è¿™æ ·åšï¼Œä½†æ‚¨å¯ä»¥ä½¿ç”¨setteræ³¨å…¥é…ç½®å¾ªç¯ä¾èµ–é¡¹ã€‚</p><h5 id="pre-instantiate-é¢„å®ä¾‹åŒ–å¯ä»¥ææ—©å‘ç°é”™è¯¯"><a href="#pre-instantiate-é¢„å®ä¾‹åŒ–å¯ä»¥ææ—©å‘ç°é”™è¯¯" class="headerlink" title="pre-instantiate (é¢„å®ä¾‹åŒ–å¯ä»¥ææ—©å‘ç°é”™è¯¯)"></a>pre-instantiate (é¢„å®ä¾‹åŒ–å¯ä»¥ææ—©å‘ç°é”™è¯¯)</h5><!--This potentially delayed visibility of some configuration issues is why `ApplicationContext` implementations by default pre-instantiate singleton beans.--> <!--At the cost of some upfront time and memory to create these beans before they are actually needed, you discover configuration issues when the `ApplicationContext` is created, not later--><p>è¿™å¯èƒ½ä¼šå»¶è¿ŸæŸäº›é…ç½®é—®é¢˜çš„å¯è§æ€§ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆé»˜è®¤æƒ…å†µä¸‹ApplicationContextå®ç°ä¼šé¢„å…ˆå®ä¾‹åŒ–å•ä¾‹beançš„åŸå› ã€‚</p><p>åœ¨å®é™…éœ€è¦ä½¿ç”¨è¿™äº›beanä¹‹å‰è¦èŠ±ä¸€äº›å‰æœŸæ—¶é—´å’Œå†…å­˜ï¼Œæ‚¨ä¼šåœ¨åˆ›å»ºApplicationContextæ—¶å‘ç°é…ç½®é—®é¢˜ï¼Œè€Œä¸æ˜¯ç¨åã€‚</p><h5 id="collaborating-è¢«è£…è½½çš„æ˜¯å®Œæ•´å®ä¾‹"><a href="#collaborating-è¢«è£…è½½çš„æ˜¯å®Œæ•´å®ä¾‹" class="headerlink" title="collaborating (è¢«è£…è½½çš„æ˜¯å®Œæ•´å®ä¾‹)"></a>collaborating (è¢«è£…è½½çš„æ˜¯å®Œæ•´å®ä¾‹)</h5><!--If no circular dependencies exist, when one or more collaborating beans are being injected into a dependent bean, each collaborating bean is totally configured prior to being injected into the dependent bean.--> <!--This means that, if bean A has a dependency on bean B, the Spring IoC container completely configures bean B prior to invoking the setter method on bean A.--> <!--In other words, the bean is instantiated (if it is not a pre-instantiated singleton), its dependencies are set, and the relevant lifecycle methods (such as a [configured init method](https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-factory-lifecycle-initializingbean) or the [InitializingBean callback method](https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-factory-lifecycle-initializingbean)) are invoked.--><p>å¦‚æœä¸å­˜åœ¨å¾ªç¯ä¾èµ–é¡¹ï¼Œé‚£ä¹ˆå½“ä¸€ä¸ªæˆ–å¤šä¸ªåä½œbeanè¢«æ³¨å…¥ä¸€ä¸ªä¾èµ–beanæ—¶ï¼Œæ¯ä¸ªåä½œbeanåœ¨è¢«æ³¨å…¥ä¾èµ–beanä¹‹å‰éƒ½è¦å®Œå…¨é…ç½®å¥½ã€‚</p><p>è¿™æ„å‘³ç€ï¼Œå¦‚æœbean Aä¾èµ–äºbean Bï¼Œé‚£ä¹ˆSpring IoCå®¹å™¨å°†åœ¨è°ƒç”¨bean Açš„setteræ–¹æ³•ä¹‹å‰å®Œå…¨é…ç½®bean Bã€‚</p><p>æ¢å¥è¯è¯´ï¼Œbeanè¢«å®ä¾‹åŒ–(å¦‚æœå®ƒä¸æ˜¯ä¸€ä¸ªé¢„å®ä¾‹åŒ–çš„å•ä¾‹å¯¹è±¡)ï¼Œå®ƒçš„ä¾èµ–é¡¹è¢«è®¾ç½®ï¼Œç›¸å…³çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•(ä¾‹å¦‚é…ç½®çš„initæ–¹æ³•æˆ–InitializingBeanå›è°ƒæ–¹æ³•)è¢«è°ƒç”¨ã€‚</p><h4 id="Examples-of-Dependency-Injection"><a href="#Examples-of-Dependency-Injection" class="headerlink" title="Examples of Dependency Injection"></a><del>Examples of Dependency Injection</del></h4><h3 id="Dependencies-and-Configuration-in-Detail"><a href="#Dependencies-and-Configuration-in-Detail" class="headerlink" title="Dependencies and Configuration in Detail"></a><del>Dependencies and Configuration in Detail</del></h3><h3 id="Using-depends-on-ä½¿ç”¨-depends-on"><a href="#Using-depends-on-ä½¿ç”¨-depends-on" class="headerlink" title="Using depends-on (ä½¿ç”¨ depends-on)"></a>Using depends-on (ä½¿ç”¨ depends-on)</h3><!--The depends-on attribute can specify both an initialization-time dependency and, in the case of singleton beans only, a corresponding destruction-time dependency. Dependent beans that define a depends-on relationship with a given bean are destroyed first, prior to the given bean itself being destroyed. Thus, depends-on can also control shutdown order.--><p>èƒ½æ§åˆ¶åŠ è½½é¡ºåº</p><h3 id="Lazy-initialized-Beans-æ‡’åŠ è½½"><a href="#Lazy-initialized-Beans-æ‡’åŠ è½½" class="headerlink" title="Lazy-initialized Beans (æ‡’åŠ è½½)"></a>Lazy-initialized Beans (æ‡’åŠ è½½)</h3><!--By default, `ApplicationContext` implementations eagerly create and configure all singleton beans as part of the initialization process.--> <!--Generally, this pre-instantiation is desirable, because errors in the configuration or surrounding environment are discovered immediately, as opposed to hours or even days later.--> <!--When this behavior is not desirable, you can prevent pre-instantiation of a singleton bean by marking the bean definition as being lazy-initialized. A lazy-initialized bean tells the IoC container to create a bean instance when it is first requested, rather than at startup.--><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œâ€œApplicationContextâ€å®ç°ä¼šåœ¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­åˆ›å»ºå¹¶é…ç½®æ‰€æœ‰çš„å•ä¾‹beanã€‚</p><p>é€šå¸¸ï¼Œè¿™ç§é¢„å®ä¾‹åŒ–æ˜¯å¯å–çš„ï¼Œå› ä¸ºé…ç½®æˆ–å‘¨å›´ç¯å¢ƒä¸­çš„é”™è¯¯ä¼šç«‹å³è¢«å‘ç°ï¼Œè€Œä¸æ˜¯å‡ å°æ—¶ç”šè‡³å‡ å¤©ä¹‹åã€‚</p><p>å½“æ­¤è¡Œä¸ºä¸å¯å–æ—¶ï¼Œæ‚¨å¯ä»¥é€šè¿‡å°†beanå®šä¹‰æ ‡è®°ä¸ºå»¶è¿Ÿåˆå§‹åŒ–æ¥é˜²æ­¢å•ä¾‹beançš„é¢„å®ä¾‹åŒ–ã€‚å»¶è¿Ÿåˆå§‹åŒ–çš„beanå‘Šè¯‰IoCå®¹å™¨åœ¨ç¬¬ä¸€æ¬¡è¯·æ±‚æ—¶åˆ›å»ºbeanå®ä¾‹ï¼Œè€Œä¸æ˜¯åœ¨å¯åŠ¨æ—¶ã€‚</p><!--However, when a lazy-initialized bean is a dependency of a singleton bean that is not lazy-initialized, the `ApplicationContext` creates the lazy-initialized bean at startup, because it must satisfy the singletonâ€™s dependencies. The lazy-initialized bean is injected into a singleton bean elsewhere that is not lazy-initialized.--><!--You can also control lazy-initialization at the container level by using the `default-lazy-init` attribute on the `<beans/>` element--><p>ä½†æ˜¯ï¼Œå¦‚æœå»¶è¿Ÿåˆå§‹åŒ–çš„beanæ˜¯æœªå»¶è¿Ÿåˆå§‹åŒ–çš„å•ä¾‹beançš„ä¾èµ–é¡¹ï¼Œåˆ™ApplicationContextä¼šåœ¨å¯åŠ¨æ—¶åˆ›å»ºå»¶è¿Ÿåˆå§‹åŒ–çš„beanï¼Œå› ä¸ºå®ƒå¿…é¡»æ»¡è¶³å•ä¾‹çš„ä¾èµ–é¡¹ã€‚å»¶è¿Ÿåˆå§‹åŒ–çš„beanè¢«æ³¨å…¥åˆ°å…¶ä»–æœªå»¶è¿Ÿåˆå§‹åŒ–çš„å•ä¾‹beanä¸­ã€‚</p><p>å¦å¤–è¿˜å¯ä»¥å®¹å™¨çº§åˆ«çš„é…ç½®æ‡’åŠ è½½</p><p>æ³¨:ä½¿ç”¨@Lazy , åœ¨éœ€è¦æ³¨å…¥åˆ°å…¶ä»–not lazyçš„beançš„æ—¶å€™ ä½¿ç”¨@Autowireçš„è¯ åœ¨ä¸Šé¢æ ‡æ³¨@Lazy ä¼šå»¶è¿Ÿåˆå§‹åŒ–</p><pre><code class="java">@Lazy@Componentclass LazyBean{   @PostConstruct           public void init(){               System.out.prinlt(&quot;init...&quot;);           }}@Componentclass NotLazyBean{       @Lazy       @Autowise               LazyBean lazyBean;}</code></pre><p>ä¼šåœ¨å®é™…ä½¿ç”¨lazyBeançš„æ—¶å€™æ‰å®ä¾‹</p><h3 id="Autowiring-Collaborators-è‡ªåŠ¨è£…é…"><a href="#Autowiring-Collaborators-è‡ªåŠ¨è£…é…" class="headerlink" title="Autowiring Collaborators(è‡ªåŠ¨è£…é…)"></a>Autowiring Collaborators(è‡ªåŠ¨è£…é…)</h3><p> Autowiring has the following advantages:</p><ul><li>Autowiring can significantly reduce the need to specify properties or constructor arguments. (Other mechanisms such as a bean template <a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-child-bean-definitions" target="_blank" rel="noopener">discussed elsewhere in this chapter</a> are also valuable in this regard.)</li><li>Autowiring can update a configuration as your objects evolve. For example, if you need to add a dependency to a class, that dependency can be satisfied automatically without you needing to modify the configuration. Thus autowiring can be especially useful during development, without negating the option of switching to explicit wiring when the code base becomes more stable.</li></ul><p>è¯‘:</p><ul><li>è‡ªåŠ¨è£…é…å¯ä»¥å¤§å¤§å‡å°‘æŒ‡å®šå±æ€§æˆ–æ„é€ å‡½æ•°å‚æ•°çš„éœ€è¦ã€‚(å…¶ä»–æœºåˆ¶ï¼Œå¦‚beanæ¨¡æ¿<a href="https://docs.spring.io/spring-framework/docs/current/spring-framereference/core.html #beans-child-bean-definitions" target="_blank" rel="noopener">åœ¨æœ¬ç« å…¶ä»–åœ°æ–¹è®¨è®ºè¿‡</a>åœ¨è¿™æ–¹é¢ä¹Ÿå¾ˆæœ‰ä»·å€¼ã€‚)</li><li>è‡ªåŠ¨è£…é…å¯ä»¥éšç€å¯¹è±¡çš„æ¼”åŒ–æ›´æ–°é…ç½®ã€‚ä¾‹å¦‚ï¼Œå¦‚æœéœ€è¦å‘ç±»æ·»åŠ ä¾èµ–é¡¹ï¼Œåˆ™å¯ä»¥è‡ªåŠ¨æ»¡è¶³è¯¥ä¾èµ–é¡¹ï¼Œè€Œä¸éœ€è¦ä¿®æ”¹é…ç½®ã€‚å› æ­¤ï¼Œè‡ªåŠ¨è£…é…åœ¨å¼€å‘è¿‡ç¨‹ä¸­ç‰¹åˆ«æœ‰ç”¨ï¼Œå½“ä»£ç åº“å˜å¾—æ›´åŠ ç¨³å®šæ—¶ï¼Œè‡ªåŠ¨è£…é…å¯ä»¥é¿å…åˆ‡æ¢åˆ°æ˜¾å¼è¿æ¥çš„é€‰é¡¹ã€‚</li></ul><table><thead><tr><th style="text-align:left">Mode</th><th style="text-align:left">Explanation</th></tr></thead><tbody><tr><td style="text-align:left"><code>no</code></td><td style="text-align:left">(Default) No autowiring. Bean references must be defined by <code>ref</code> elements. Changing the default setting is not recommended for larger deployments, because specifying collaborators explicitly gives greater control and clarity. To some extent, it documents the structure of a system.</td></tr><tr><td style="text-align:left"><code>byName</code></td><td style="text-align:left">Autowiring by property name. Spring looks for a bean with the same name as the property that needs to be autowired. For example, if a bean definition is set to autowire by name and it contains a <code>master</code> property (that is, it has a <code>setMaster(..)</code> method), Spring looks for a bean definition named <code>master</code> and uses it to set the property.</td></tr><tr><td style="text-align:left"><code>byType</code></td><td style="text-align:left">Lets a property be autowired if exactly one bean of the property type exists in the container. If more than one exists, a fatal exception is thrown, which indicates that you may not use <code>byType</code> autowiring for that bean. If there are no matching beans, nothing happens (the property is not set).</td></tr><tr><td style="text-align:left"><code>constructor</code></td><td style="text-align:left">Analogous to <code>byType</code> but applies to constructor arguments. If there is not exactly one bean of the constructor argument type in the container, a fatal error is raised.</td></tr></tbody></table><h4 id="Limitations-and-Disadvantages-of-Autowiring-è‡ªåŠ¨è£…é…çš„å±€é™æ€§å’Œç¼ºç‚¹"><a href="#Limitations-and-Disadvantages-of-Autowiring-è‡ªåŠ¨è£…é…çš„å±€é™æ€§å’Œç¼ºç‚¹" class="headerlink" title="Limitations and Disadvantages of Autowiring (è‡ªåŠ¨è£…é…çš„å±€é™æ€§å’Œç¼ºç‚¹)"></a>Limitations and Disadvantages of Autowiring (è‡ªåŠ¨è£…é…çš„å±€é™æ€§å’Œç¼ºç‚¹)</h4><p>Consider the limitations and disadvantages of autowiring:</p><ul><li>Explicit dependencies in <code>property</code> and <code>constructor-arg</code> settings always override autowiring. You cannot autowire simple properties such as primitives, <code>Strings</code>, and <code>Classes</code> (and arrays of such simple properties). This limitation is by-design.</li><li>Autowiring is less exact than explicit wiring. Although, as noted in the earlier table, Spring is careful to avoid guessing in case of ambiguity that might have unexpected results. The relationships between your Spring-managed objects are no longer documented explicitly.</li><li>Wiring information may not be available to tools that may generate documentation from a Spring container.</li><li>Multiple bean definitions within the container may match the type specified by the setter method or constructor argument to be autowired. For arrays, collections, or <code>Map</code> instances, this is not necessarily a problem. However, for dependencies that expect a single value, this ambiguity is not arbitrarily resolved. If no unique bean definition is available, an exception is thrown.</li></ul><p>In the latter scenario, you have several options:</p><ul><li>Abandon autowiring in favor of explicit wiring.</li><li>Avoid autowiring for a bean definition by setting its <code>autowire-candidate</code> attributes to <code>false</code>, as described in the <a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-factory-autowire-candidate" target="_blank" rel="noopener">next section</a>.</li><li>Designate a single bean definition as the primary candidate by setting the <code>primary</code> attribute of its <code>&lt;bean/&gt;</code> element to <code>true</code>.</li><li>Implement the more fine-grained control available with annotation-based configuration, as described in <a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-annotation-config" target="_blank" rel="noopener">Annotation-based Container Configuration</a>.</li></ul><p>ä½¿ç”¨è‡ªåŠ¨è£…é… ,å¯èƒ½ä¸é‚£ä¹ˆç²¾ç¡®, ä¼šå¯¼è‡´ä¸€äº›é—®é¢˜</p><h4 id="Excluding-a-Bean-from-Autowiring-ä»è‡ªåŠ¨è£…é…ä¸­æ’é™¤Bean"><a href="#Excluding-a-Bean-from-Autowiring-ä»è‡ªåŠ¨è£…é…ä¸­æ’é™¤Bean" class="headerlink" title="Excluding a Bean from Autowiring(ä»è‡ªåŠ¨è£…é…ä¸­æ’é™¤Bean)"></a>Excluding a Bean from Autowiring(ä»è‡ªåŠ¨è£…é…ä¸­æ’é™¤Bean)</h4><!--On a per-bean basis, you can exclude a bean from autowiring. In Springâ€™s XML format, set the `autowire-candidate` attribute of the `<bean/>` element to `false`. The container makes that specific bean definition unavailable to the autowiring infrastructure (including annotation style configurations such as [`@Autowired`](https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-autowired-annotation)).--><p>åœ¨æ¯ä¸ªbeançš„åŸºç¡€ä¸Šï¼Œå¯ä»¥å°†beanæ’é™¤åœ¨è‡ªåŠ¨è£…é…ä¹‹å¤–ã€‚åœ¨Springçš„XMLæ ¼å¼ä¸­ï¼Œå°†â€œâ€å…ƒç´ çš„â€œautowire-candidateâ€å±æ€§è®¾ç½®ä¸ºâ€œfalseâ€ã€‚å®¹å™¨ä½¿ç‰¹å®šçš„beanå®šä¹‰å¯¹è‡ªåŠ¨è£…é…åŸºç¡€è®¾æ–½ä¸å¯ç”¨(åŒ…æ‹¬æ³¨é‡Šæ ·å¼é…ç½®ï¼Œå¦‚<a href="https://docs.spring.io/spring-framework/docs/current/spring-framereference/core.html #beans-autowired-annotation" target="_blank" rel="noopener">â€˜ @Autowired â€˜</a>)ã€‚</p><h3 id="Method-Injection-æ–¹æ³•æ³¨å…¥"><a href="#Method-Injection-æ–¹æ³•æ³¨å…¥" class="headerlink" title="Method Injection (æ–¹æ³•æ³¨å…¥)"></a>Method Injection (æ–¹æ³•æ³¨å…¥)</h3><!--Suppose singleton bean A needs to use non-singleton (prototype) bean B, perhaps on each method invocation on A. The container creates the singleton bean A only once, and thus only gets one opportunity to set the properties.--> <!--A solution is to forego some inversion of control. You can make bean A aware of the container by implementing the ApplicationContextAware interface, and by making a getBean("B") call to the container ask for (a typically new) bean B instance every time bean A needs it.--><p>å‡è®¾å•ä¾‹bean Aéœ€è¦ä½¿ç”¨éå•ä¾‹(åŸå‹)bean Bï¼Œå¯èƒ½æ˜¯åœ¨Açš„æ¯ä¸ªæ–¹æ³•è°ƒç”¨ä¸Šã€‚å®¹å™¨åªåˆ›å»ºä¸€æ¬¡å•ä¾‹bean Aï¼Œå› æ­¤åªæœ‰ä¸€æ¬¡æœºä¼šæ¥è®¾ç½®å±æ€§ã€‚</p><p>è§£å†³çš„åŠæ³•æ˜¯æ”¾å¼ƒä¸€äº›æ§åˆ¶åè½¬ã€‚æ‚¨å¯ä»¥é€šè¿‡å®ç°applicationcontext - wareæ¥å£ï¼Œå¹¶åœ¨æ¯æ¬¡bean Aéœ€è¦æ—¶è°ƒç”¨å®¹å™¨çš„getBean(â€œBâ€)æ¥è¯·æ±‚(é€šå¸¸æ˜¯ä¸€ä¸ªæ–°çš„)bean Bå®ä¾‹ï¼Œä»è€Œä½¿bean AçŸ¥é“å®¹å™¨ã€‚</p><h4 id="Lookup-Method-Injection"><a href="#Lookup-Method-Injection" class="headerlink" title="Lookup Method Injection"></a>Lookup Method Injection</h4><!--Lookup method injection is the ability of the container to override methods on container-managed beans and return the lookup result for another named bean in the container.--> <!--The Spring Framework implements this method injection by using bytecode generation from the CGLIB library to dynamically generate a subclass that overrides the method.--><p>æŸ¥æ‰¾æ–¹æ³•æ³¨å…¥æ˜¯å®¹å™¨è¦†ç›–å®¹å™¨ç®¡ç†beanä¸Šçš„æ–¹æ³• å¹¶è¿”å›å®¹å™¨ä¸­å¦ä¸€ä¸ªå‘½åbeançš„æŸ¥æ‰¾ç»“æœçš„èƒ½åŠ›ã€‚</p><p>Springæ¡†æ¶é€šè¿‡ä½¿ç”¨æ¥è‡ªCGLIBåº“çš„å­—èŠ‚ç ç”Ÿæˆæ¥åŠ¨æ€ç”Ÿæˆè¦†ç›–è¯¥æ–¹æ³•çš„å­ç±»ï¼Œä»è€Œå®ç°äº†è¿™ç§æ–¹æ³•æ³¨å…¥ã€‚</p><p>ex</p><h4 id="Arbitrary-ä»»æ„çš„-Method-Replacement"><a href="#Arbitrary-ä»»æ„çš„-Method-Replacement" class="headerlink" title="Arbitrary (ä»»æ„çš„)Method Replacement"></a><del>Arbitrary (ä»»æ„çš„)Method Replacement</del></h4><!--A less useful form of method injection than lookup method injection is the ability to replace arbitrary methods in a managed bean with another method implementation.--> <p>ä¸æŸ¥æ‰¾æ–¹æ³•æ³¨å…¥ç›¸æ¯”ï¼Œä¸€ç§ä¸å¤ªæœ‰ç”¨çš„æ–¹æ³•æ³¨å…¥å½¢å¼æ˜¯èƒ½å¤Ÿç”¨å¦ä¸€ç§æ–¹æ³•å®ç°æ›¿æ¢æ‰˜ç®¡beanä¸­çš„ä»»æ„æ–¹æ³•ã€‚</p><h2 id="ğŸŒŸBean-Scopes-ï¼ˆä½œç”¨åŸŸï¼‰"><a href="#ğŸŒŸBean-Scopes-ï¼ˆä½œç”¨åŸŸï¼‰" class="headerlink" title="ğŸŒŸBean Scopes  ï¼ˆä½œç”¨åŸŸï¼‰"></a>ğŸŒŸBean Scopes  ï¼ˆä½œç”¨åŸŸï¼‰</h2><p>å…³é”®è¯: singletonã€prototypeã€requestã€sessionã€applicationã€websocket ã€cglib public</p><!--You can control not only the various dependencies and configuration values that are to be plugged into an object that is created from a particular bean definition but also control the scope of the objects created from a particular bean definition--><p>æ‚¨ä¸ä»…å¯ä»¥æ§åˆ¶è¦æ’å…¥åˆ°ç”±ç‰¹å®šbeanå®šä¹‰åˆ›å»ºçš„å¯¹è±¡ä¸­çš„å„ç§ä¾èµ–é¡¹å’Œé…ç½®å€¼ï¼Œè¿˜å¯ä»¥æ§åˆ¶ç”±ç‰¹å®šbeanå®šä¹‰åˆ›å»ºçš„å¯¹è±¡çš„èŒƒå›´</p><table><thead><tr><th style="text-align:left">Scope</th><th style="text-align:left">Description</th></tr></thead><tbody><tr><td style="text-align:left"><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-factory-scopes-singleton" target="_blank" rel="noopener">singleton</a></td><td style="text-align:left">(Default) Scopes a single bean definition to a single object instance for each Spring IoC container.</td></tr><tr><td style="text-align:left"><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-factory-scopes-prototype" target="_blank" rel="noopener">prototype</a></td><td style="text-align:left">Scopes a single bean definition to any number of object instances.</td></tr><tr><td style="text-align:left"><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-factory-scopes-request" target="_blank" rel="noopener">request</a></td><td style="text-align:left">Scopes a single bean definition to the lifecycle of a single HTTP request. That is, each HTTP request has its own instance of a bean created off the back of a single bean definition. Only valid in the context of a web-aware Spring <code>ApplicationContext</code>.</td></tr><tr><td style="text-align:left"><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-factory-scopes-session" target="_blank" rel="noopener">session</a></td><td style="text-align:left">Scopes a single bean definition to the lifecycle of an HTTP <code>Session</code>. Only valid in the context of a web-aware Spring <code>ApplicationContext</code>.</td></tr><tr><td style="text-align:left"><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-factory-scopes-application" target="_blank" rel="noopener">application</a></td><td style="text-align:left">Scopes a single bean definition to the lifecycle of a <code>ServletContext</code>. Only valid in the context of a web-aware Spring <code>ApplicationContext</code>.</td></tr><tr><td style="text-align:left"><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/web.html#websocket-stomp-websocket-scope" target="_blank" rel="noopener">websocket</a></td><td style="text-align:left">Scopes a single bean definition to the lifecycle of a <code>WebSocket</code>. Only valid in the context of a web-aware Spring <code>ApplicationContext</code>.</td></tr></tbody></table><h3 id="The-Singleton-Scope"><a href="#The-Singleton-Scope" class="headerlink" title="The Singleton Scope"></a>The Singleton Scope</h3><!--To put it another way, when you define a bean definition and it is scoped as a singleton, the Spring IoC container creates exactly one instance of the object defined by that bean definition.--> <!--This single instance is stored in a cache of such singleton beans, and all subsequent requests and references for that named bean return the cached object--><p>æ¢å¥è¯è¯´ï¼Œå½“æ‚¨å®šä¹‰ä¸€ä¸ªbeanå®šä¹‰å¹¶å°†å…¶å®šä¹‰ä¸ºä¸€ä¸ªå•ä¾‹å¯¹è±¡æ—¶ï¼ŒSpring IoCå®¹å™¨åªåˆ›å»ºè¯¥beanå®šä¹‰å®šä¹‰çš„å¯¹è±¡çš„ä¸€ä¸ªå®ä¾‹ã€‚</p><p>æ­¤å•ä¸€å®ä¾‹å­˜å‚¨åœ¨æ­¤ç±»å•ä¾‹beançš„ç¼“å­˜ä¸­ï¼Œè¯¥æŒ‡å®šbeançš„æ‰€æœ‰åç»­è¯·æ±‚å’Œå¼•ç”¨éƒ½å°†è¿”å›ç¼“å­˜çš„å¯¹è±¡</p><!--Springâ€™s concept of a singleton bean differs from the singleton pattern as defined in the Gang of Four (GoF) patterns book.--> <!--The GoF singleton hard-codes the scope of an object such that one and only one instance of a particular class is created per ClassLoader--><p>Springçš„å•ä¾‹beanæ¦‚å¿µä¸Gang of Four(GoF)æ¨¡å¼ä¹¦ä¸­å®šä¹‰çš„å•ä¾‹æ¨¡å¼ä¸åŒã€‚</p><p>å•ä¾‹å¯¹è±¡å¯¹å¯¹è±¡çš„ä½œç”¨åŸŸè¿›è¡Œç¡¬ç¼–ç ï¼Œè¿™æ ·æ¯ä¸ªç±»è£…å…¥å™¨åªèƒ½åˆ›å»ºä¸€ä¸ªç‰¹å®šç±»çš„å®ä¾‹</p><h3 id="The-Prototype-Scope"><a href="#The-Prototype-Scope" class="headerlink" title="The Prototype Scope"></a>The Prototype Scope</h3><!--As a rule, you should use the prototype scope for all stateful beans and the singleton scope for stateless beans.--><!--In some respects, the Spring containerâ€™s role in regard to a prototype-scoped bean is a replacement for the Java `new` operator.--> <p>é€šå¸¸ï¼Œæ‚¨åº”è¯¥ä¸ºæ‰€æœ‰æœ‰çŠ¶æ€beanä½¿ç”¨åŸå‹èŒƒå›´ï¼Œä¸ºæ— çŠ¶æ€beanä½¿ç”¨å•ä¾‹èŒƒå›´ã€‚</p><p>åœ¨æŸäº›æ–¹é¢ï¼ŒSpringå®¹å™¨åœ¨åŸå‹ä½œç”¨åŸŸbeanæ–¹é¢çš„ä½œç”¨æ˜¯æ›¿ä»£Javaâ€œnewâ€æ“ä½œç¬¦ã€‚</p><h3 id="Singleton-Beans-with-Prototype-bean-Dependencies"><a href="#Singleton-Beans-with-Prototype-bean-Dependencies" class="headerlink" title="Singleton Beans with Prototype-bean Dependencies"></a><del>Singleton Beans with Prototype-bean Dependencies</del></h3><h3 id="Request-Session-Application-and-WebSocket-Scopes"><a href="#Request-Session-Application-and-WebSocket-Scopes" class="headerlink" title="Request, Session, Application, and WebSocket Scopes"></a>Request, Session, Application, and WebSocket Scopes</h3><h4 id="Request-scope"><a href="#Request-scope" class="headerlink" title="Request scope"></a>Request scope</h4><!--You can change the internal state of the instance that is created as much as you want, because other instances created from the same `loginAction` bean definition do not see these changes in state.--> <p>æ‚¨å¯ä»¥éšæ„æ›´æ”¹åˆ›å»ºçš„å®ä¾‹çš„å†…éƒ¨çŠ¶æ€ï¼Œå› ä¸ºä»ç›¸åŒçš„â€œloginActionâ€beanå®šä¹‰åˆ›å»ºçš„å…¶ä»–å®ä¾‹åœ¨çŠ¶æ€ä¸­çœ‹ä¸åˆ°è¿™äº›æ›´æ”¹ã€‚</p><h4 id="Session-Scope"><a href="#Session-Scope" class="headerlink" title="Session Scope"></a>Session Scope</h4> <!--As with request-scoped beans, you can change the internal state of the instance that is created as much as you want, knowing that other HTTP `Session` instances that are also using instances created from the same `userPreferences` bean definition do not see these changes in state, because they are particular to an individual HTTP `Session`.--><p>ä¸è¯·æ±‚èŒƒå›´å†…beanä¸€æ ·,ä½ å¯ä»¥æ”¹å˜å†…éƒ¨çŠ¶æ€çš„å®ä¾‹åˆ›å»ºå°½å¯èƒ½å¤šçš„ä½ æƒ³è¦çš„,çŸ¥é“å…¶ä»–HTTPä¼šè¯çš„å®ä¾‹ä¹Ÿä½¿ç”¨ç›¸åŒçš„å®ä¾‹åˆ›å»ºçš„userPreferences beanå®šä¹‰çœ‹ä¸åˆ°è¿™äº›å˜åŒ–çŠ¶æ€,å› ä¸ºä»–ä»¬æ˜¯ç‰¹å®šçš„ä¸€ä¸ªå•ç‹¬çš„HTTPä¼šè¯çš„ã€‚</p><h4 id="Application-Scope"><a href="#Application-Scope" class="headerlink" title="Application Scope"></a>Application Scope</h4><!--This is somewhat similar to a Spring singleton bean but differs in two important ways: It is a singleton per `ServletContext`, not per Spring 'ApplicationContext' (for which there may be several in any given web application), and it is actually exposed and therefore visible as a `ServletContext` attribute.--><p>è¿™æœ‰ç‚¹ç±»ä¼¼äºspringå•ä¾‹bean,ä½†åœ¨ä¸¤ä¸ªé‡è¦æ–¹é¢ä¸åŒ: å®ƒæ˜¯ä¸€ä¸ªå•ä¾‹æ¯ServletContext,ä¸æ˜¯æ¯ä¸ªspring ApplicationContextçš„(å¯èƒ½æœ‰å‡ ä¸ªåœ¨ä»»ä½•ç»™å®šçš„webåº”ç”¨ç¨‹åº),å®ƒå®é™…ä¸Šæ˜¯æš´éœ²,å› æ­¤å¯è§â€œServletContextâ€å±æ€§ã€‚</p><h4 id="Scoped-Beans-as-Dependencies"><a href="#Scoped-Beans-as-Dependencies" class="headerlink" title="Scoped Beans as Dependencies"></a>Scoped Beans as Dependencies</h4><!--The Spring IoC container manages not only the instantiation of your objects (beans), but also the wiring up of collaborators (or dependencies). If you want to inject (for example) an HTTP request-scoped bean into another bean of a longer-lived scope, you may choose to inject an AOP proxy in place of the scoped bean.--><p>Spring IoCå®¹å™¨ä¸ä»…ç®¡ç†å¯¹è±¡(bean)çš„å®ä¾‹åŒ–ï¼Œè¿˜ç®¡ç†åä½œè€…(æˆ–ä¾èµ–é¡¹)çš„è¿æ¥ã€‚å¦‚æœæ‚¨æƒ³å°†(ä¾‹å¦‚)ä¸€ä¸ªHTTPè¯·æ±‚ä½œç”¨åŸŸçš„beanæ³¨å…¥åˆ°å¦ä¸€ä¸ªæ›´é•¿çš„ä½œç”¨åŸŸçš„beanä¸­ï¼Œæ‚¨å¯ä»¥é€‰æ‹©æ³¨å…¥ä¸€ä¸ªAOPä»£ç†æ¥ä»£æ›¿ä½œç”¨åŸŸçš„beanã€‚</p><p>Choosing the Type of Proxy to Create</p><blockquote><p>CGLIB proxies intercept only public method calls! Do not call non-public methods on such a proxy. They are not delegated to the actual scoped target object.</p></blockquote><h3 id="Custom-Scopes"><a href="#Custom-Scopes" class="headerlink" title="Custom Scopes"></a><del>Custom Scopes</del></h3><h2 id="ğŸŒŸCustomizing-the-Nature-of-a-Bean-beanæ‰©å±•ç‚¹"><a href="#ğŸŒŸCustomizing-the-Nature-of-a-Bean-beanæ‰©å±•ç‚¹" class="headerlink" title="ğŸŒŸCustomizing the Nature of a Bean(beanæ‰©å±•ç‚¹)"></a>ğŸŒŸCustomizing the Nature of a Bean(beanæ‰©å±•ç‚¹)</h2><p>å…³é”®è¯: lifecycle callback; aware; </p><p>The Spring Framework provides a number of interfaces you can use to customize the nature of a bean. This section groups them as follows:</p><ul><li><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-factory-lifecycle" target="_blank" rel="noopener">Lifecycle Callbacks</a></li><li><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-factory-aware" target="_blank" rel="noopener"><code>ApplicationContextAware</code> and <code>BeanNameAware</code></a></li><li><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#aware-list" target="_blank" rel="noopener">Other <code>Aware</code> Interfaces</a></li></ul><h3 id="Lifecycle-Callbacks-ç”Ÿå‘½å‘¨æœŸå›è°ƒ"><a href="#Lifecycle-Callbacks-ç”Ÿå‘½å‘¨æœŸå›è°ƒ" class="headerlink" title="Lifecycle Callbacks (ç”Ÿå‘½å‘¨æœŸå›è°ƒ)"></a>Lifecycle Callbacks (ç”Ÿå‘½å‘¨æœŸå›è°ƒ)</h3><!--Internally, the Spring Framework uses `BeanPostProcessor` implementations to process any callback interfaces it can find and call the appropriate methods. If you need custom features or other lifecycle behavior Spring does not by default offer, you can implement a `BeanPostProcessor` yourself. For more information, see [Container Extension Points](https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-factory-extension).--><p>åœ¨å†…éƒ¨ï¼ŒSpringæ¡†æ¶ä½¿ç”¨â€œBeanPostProcessorâ€å®ç°æ¥å¤„ç†å®ƒèƒ½æ‰¾åˆ°å¹¶è°ƒç”¨é€‚å½“æ–¹æ³•çš„ä»»ä½•å›è°ƒæ¥å£ã€‚å¦‚æœæ‚¨éœ€è¦è‡ªå®šä¹‰ç‰¹æ€§æˆ–Springé»˜è®¤ä¸æä¾›çš„å…¶ä»–ç”Ÿå‘½å‘¨æœŸè¡Œä¸ºï¼Œæ‚¨å¯ä»¥è‡ªå·±å®ç°ä¸€ä¸ªâ€œBeanPostProcessorâ€ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<a href="https://docs.spring.io/spring-framework/docs/current/spring-framereference/core.html #beans-factory-extension" target="_blank" rel="noopener">å®¹å™¨æ‰©å±•ç‚¹</a>ã€‚</p><ul><li>spring æ¥å£ è€¦åˆ  <code>InitializingBean</code>ï¼Œ<code>DisposableBean</code></li><li>JSR-250 @PostConstruct æˆ– init-method   @PreDestroyæˆ– destroy-method</li><li><code>Lifecycle</code></li></ul><h4 id="Initialization-Callbacks"><a href="#Initialization-Callbacks" class="headerlink" title="Initialization Callbacks"></a>Initialization Callbacks</h4><pre><code>public class AnotherExampleBean implements InitializingBean {    @Override    public void afterPropertiesSet() {        // do some initialization work    }}</code></pre><h4 id="Destruction-Callbacks"><a href="#Destruction-Callbacks" class="headerlink" title="Destruction Callbacks"></a>Destruction Callbacks</h4><pre><code>public class AnotherExampleBean implements DisposableBean {    @Override    public void destroy() {        // do some destruction work (like releasing pooled connections)    }}</code></pre><h4 id="Default-Initialization-and-Destroy-Methods"><a href="#Default-Initialization-and-Destroy-Methods" class="headerlink" title="Default Initialization and Destroy Methods"></a>Default Initialization and Destroy Methods</h4><ul><li>default-init-method</li><li>default-destroy-method</li></ul><h4 id="Combining-Lifecycle-Mechanisms"><a href="#Combining-Lifecycle-Mechanisms" class="headerlink" title="Combining Lifecycle Mechanisms"></a>Combining Lifecycle Mechanisms</h4><p>As of Spring 2.5, you have three options for controlling bean lifecycle behavior:</p><ul><li>The <a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-factory-lifecycle-initializingbean" target="_blank" rel="noopener"><code>InitializingBean</code></a> and <a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-factory-lifecycle-disposablebean" target="_blank" rel="noopener"><code>DisposableBean</code></a> callback interfaces</li><li>Custom <code>init()</code> and <code>destroy()</code> methods</li><li>The <a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-postconstruct-and-predestroy-annotations" target="_blank" rel="noopener"><code>@PostConstruct</code> and <code>@PreDestroy</code> annotations</a>. You can combine these mechanisms to control a given bean.</li></ul><h4 id="Startup-and-Shutdown-Callbacks"><a href="#Startup-and-Shutdown-Callbacks" class="headerlink" title="Startup and Shutdown Callbacks"></a>Startup and Shutdown Callbacks</h4><h5 id="Lifecycle"><a href="#Lifecycle" class="headerlink" title="Lifecycle"></a>Lifecycle</h5><pre><code class="java">public interface Lifecycle {    void start();    void stop();    boolean isRunning();}</code></pre><h5 id="LifecycleProcessor"><a href="#LifecycleProcessor" class="headerlink" title="LifecycleProcessor"></a>LifecycleProcessor</h5><pre><code class="java">public interface LifecycleProcessor extends Lifecycle {    void onRefresh();    void onClose();}</code></pre><h5 id="Phased"><a href="#Phased" class="headerlink" title="Phased"></a>Phased</h5><!--The order of startup and shutdown invocations can be important. If a â€œdepends-onâ€ relationship exists between any two objects, the dependent side starts after its dependency, and it stops before its dependency. However, at times, the direct dependencies are unknown. You may only know that objects of a certain type should start prior to objects of another type.--><p>å¯åŠ¨å’Œå…³é—­è°ƒç”¨çš„é¡ºåºå¯èƒ½å¾ˆé‡è¦ã€‚å¦‚æœä»»ä½•ä¸¤ä¸ªå¯¹è±¡ä¹‹é—´å­˜åœ¨â€œä¾èµ–å…³ç³»â€ï¼Œä¾èµ–æ–¹åœ¨ä¾èµ–åå¼€å§‹ï¼Œåœ¨ä¾èµ–å‰åœæ­¢ã€‚ç„¶è€Œï¼Œæœ‰æ—¶ï¼Œç›´æ¥ä¾èµ–å…³ç³»æ˜¯æœªçŸ¥çš„ã€‚æ‚¨å¯èƒ½åªçŸ¥é“æŸç§ç±»å‹çš„å¯¹è±¡åº”è¯¥å…ˆäºå¦ä¸€ç§ç±»å‹çš„å¯¹è±¡å¯åŠ¨ã€‚</p><pre><code class="java">public interface Phased {    int getPhase();}</code></pre><h4 id="Shutting-Down-the-Spring-IoC-Container-Gracefully-in-Non-Web-Applications"><a href="#Shutting-Down-the-Spring-IoC-Container-Gracefully-in-Non-Web-Applications" class="headerlink" title="Shutting Down the Spring IoC Container Gracefully in Non-Web Applications"></a>Shutting Down the Spring IoC Container Gracefully in Non-Web Applications</h4><!--If you use Springâ€™s IoC container in a non-web application environment (for example, in a rich client desktop environment), register a shutdown hook with the JVM. Doing so ensures a graceful shutdown and calls the relevant destroy methods on your singleton beans so that all resources are released. You must still configure and implement these destroy callbacks correctly.--><p>å¦‚æœæ‚¨åœ¨éwebåº”ç”¨ç¨‹åºç¯å¢ƒ(ä¾‹å¦‚ï¼Œåœ¨å®¢æˆ·æœºæ¡Œé¢ç¯å¢ƒä¸­)ä¸­ä½¿ç”¨Springçš„IoCå®¹å™¨ï¼Œè¯·å‘JVMæ³¨å†Œä¸€ä¸ªå…³é—­æŒ‚é’©ã€‚è¿™æ ·åšå¯ä»¥ç¡®ä¿ä¼˜é›…åœ°å…³é—­å¹¶è°ƒç”¨å•ä¾‹beanä¸Šçš„ç›¸å…³é”€æ¯æ–¹æ³•ï¼Œä»¥ä¾¿é‡Šæ”¾æ‰€æœ‰èµ„æºã€‚æ‚¨ä»ç„¶å¿…é¡»æ­£ç¡®é…ç½®å’Œå®ç°è¿™äº›é”€æ¯å›è°ƒã€‚</p><p>registerShutdownHook()</p><h3 id="ApplicationContextAware-and-BeanNameAware"><a href="#ApplicationContextAware-and-BeanNameAware" class="headerlink" title="ApplicationContextAware and BeanNameAware"></a><code>ApplicationContextAware</code> and <code>BeanNameAware</code></h3><h4 id="ApplicationContextAware"><a href="#ApplicationContextAware" class="headerlink" title="ApplicationContextAware"></a>ApplicationContextAware</h4><pre><code class="java">public interface ApplicationContextAware {    void setApplicationContext(ApplicationContext applicationContext) throws BeansException;}</code></pre><h4 id="BeanNameAware"><a href="#BeanNameAware" class="headerlink" title="BeanNameAware"></a>BeanNameAware</h4><pre><code class="java">public interface BeanNameAware {    void setBeanName(String name) throws BeansException;}</code></pre><h3 id="Other-Aware-Interfaces"><a href="#Other-Aware-Interfaces" class="headerlink" title="Other Aware Interfaces"></a>Other <code>Aware</code> Interfaces</h3><table><thead><tr><th style="text-align:left">Name</th><th style="text-align:left">Injected Dependency</th><th style="text-align:left">Explained inâ€¦</th></tr></thead><tbody><tr><td style="text-align:left"><code>ApplicationContextAware</code></td><td style="text-align:left">Declaring <code>ApplicationContext</code>.</td><td style="text-align:left"><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-factory-aware" target="_blank" rel="noopener"><code>ApplicationContextAware</code> and <code>BeanNameAware</code></a></td></tr><tr><td style="text-align:left"><code>ApplicationEventPublisherAware</code></td><td style="text-align:left">Event publisher of the enclosing <code>ApplicationContext</code>.</td><td style="text-align:left"><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#context-introduction" target="_blank" rel="noopener">Additional Capabilities of the <code>ApplicationContext</code></a></td></tr><tr><td style="text-align:left"><code>BeanClassLoaderAware</code></td><td style="text-align:left">Class loader used to load the bean classes.</td><td style="text-align:left"><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-factory-class" target="_blank" rel="noopener">Instantiating Beans</a></td></tr><tr><td style="text-align:left"><code>BeanFactoryAware</code></td><td style="text-align:left">Declaring <code>BeanFactory</code>.</td><td style="text-align:left"><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-factory-aware" target="_blank" rel="noopener"><code>ApplicationContextAware</code> and <code>BeanNameAware</code></a></td></tr><tr><td style="text-align:left"><code>BeanNameAware</code></td><td style="text-align:left">Name of the declaring bean.</td><td style="text-align:left"><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-factory-aware" target="_blank" rel="noopener"><code>ApplicationContextAware</code> and <code>BeanNameAware</code></a></td></tr><tr><td style="text-align:left"><code>BootstrapContextAware</code></td><td style="text-align:left">Resource adapter <code>BootstrapContext</code> the container runs in. Typically available only in JCA-aware <code>ApplicationContext</code> instances.</td><td style="text-align:left"><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/integration.html#cci" target="_blank" rel="noopener">JCA CCI</a></td></tr><tr><td style="text-align:left"><code>LoadTimeWeaverAware</code></td><td style="text-align:left">Defined weaver for processing class definition at load time.</td><td style="text-align:left"><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#aop-aj-ltw" target="_blank" rel="noopener">Load-time Weaving with AspectJ in the Spring Framework</a></td></tr><tr><td style="text-align:left"><code>MessageSourceAware</code></td><td style="text-align:left">Configured strategy for resolving messages (with support for parametrization and internationalization).</td><td style="text-align:left"><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#context-introduction" target="_blank" rel="noopener">Additional Capabilities of the <code>ApplicationContext</code></a></td></tr><tr><td style="text-align:left"><code>NotificationPublisherAware</code></td><td style="text-align:left">Spring JMX notification publisher.</td><td style="text-align:left"><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/integration.html#jmx-notifications" target="_blank" rel="noopener">Notifications</a></td></tr><tr><td style="text-align:left"><code>ResourceLoaderAware</code></td><td style="text-align:left">Configured loader for low-level access to resources.</td><td style="text-align:left"><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#resources" target="_blank" rel="noopener">Resources</a></td></tr><tr><td style="text-align:left"><code>ServletConfigAware</code></td><td style="text-align:left">Current <code>ServletConfig</code> the container runs in. Valid only in a web-aware Spring <code>ApplicationContext</code>.</td><td style="text-align:left"><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/web.html#mvc" target="_blank" rel="noopener">Spring MVC</a></td></tr><tr><td style="text-align:left"><code>ServletContextAware</code></td><td style="text-align:left">Current <code>ServletContext</code> the container runs in. Valid only in a web-aware Spring <code>ApplicationContext</code>.</td><td style="text-align:left"><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/web.html#mvc" target="_blank" rel="noopener">Spring MVC</a></td></tr></tbody></table><!--Note again that using these interfaces ties your code to the Spring API and does not follow the Inversion of Control style. As a result, we recommend them for infrastructure beans that require programmatic access to the container.--><p>å†æ¬¡æ³¨æ„ï¼Œä½¿ç”¨è¿™äº›æ¥å£å°†æ‚¨çš„ä»£ç ç»‘å®šåˆ°Spring APIï¼Œå¹¶ä¸”ä¸éµå¾ªæ§åˆ¶åè½¬æ ·å¼ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å»ºè®®å°†å®ƒä»¬ç”¨äºéœ€è¦å¯¹å®¹å™¨è¿›è¡Œç¼–ç¨‹è®¿é—®çš„åŸºç¡€è®¾æ–½beanã€‚</p><h2 id="Bean-Definition-Inheritance-å®šä¹‰ç»§æ‰¿"><a href="#Bean-Definition-Inheritance-å®šä¹‰ç»§æ‰¿" class="headerlink" title="Bean Definition Inheritance (å®šä¹‰ç»§æ‰¿)"></a><del>Bean Definition Inheritance (å®šä¹‰ç»§æ‰¿)</del></h2><h2 id="ğŸŒŸContainer-Extension-Points-ï¼ˆå®¹å™¨æ‰©å±•ç‚¹ï¼‰"><a href="#ğŸŒŸContainer-Extension-Points-ï¼ˆå®¹å™¨æ‰©å±•ç‚¹ï¼‰" class="headerlink" title="ğŸŒŸContainer Extension Points ï¼ˆå®¹å™¨æ‰©å±•ç‚¹ï¼‰"></a>ğŸŒŸContainer Extension Points ï¼ˆå®¹å™¨æ‰©å±•ç‚¹ï¼‰</h2><p>å…³é”®è¯ : bean; beanPostProcessor;Metadata ;BeanFactoryPostProcessor;FactoryBean; scoped per-container</p><h3 id="Customizing-Beans-by-Using-a-BeanPostProcessor"><a href="#Customizing-Beans-by-Using-a-BeanPostProcessor" class="headerlink" title="Customizing Beans by Using a BeanPostProcessor"></a>Customizing Beans by Using a BeanPostProcessor</h3><p>//ä¸€èˆ¬ç”¨äºè‡ªå®šä¹‰æ„é€ bean, å¤„ç†æ³¨è§£ (é€šç”¨æ³¨è§£ å’Œ è‡ªå®šä¹‰æ³¨è§£)</p><!--The `BeanPostProcessor` interface defines callback methods that you can implement to provide your own (or override the containerâ€™s default) instantiation logic, dependency resolution logic, and so forth.--> <!--If you want to implement some custom logic after the Spring container finishes instantiating, configuring, and initializing a bean, you can plug in one or more custom `BeanPostProcessor` implementations.--><!--You can configure multiple `BeanPostProcessor` instances, and you can control the order in which these `BeanPostProcessor` instances execute by setting the `order` property. You can set this property only if the `BeanPostProcessor` implements the `Ordered` interface.--> <p>BeanPostProcessoræ¥å£å®šä¹‰äº†å›è°ƒæ–¹æ³•ï¼Œæ‚¨å¯ä»¥å®ç°è¿™äº›å›è°ƒæ–¹æ³•æ¥æä¾›è‡ªå·±çš„(æˆ–è¦†ç›–å®¹å™¨çš„é»˜è®¤)å®ä¾‹åŒ–é€»è¾‘ã€ä¾èµ–é¡¹è§£æé€»è¾‘ç­‰ç­‰ã€‚</p><p>å¦‚æœå¸Œæœ›åœ¨Springå®¹å™¨å®Œæˆå®ä¾‹åŒ–ã€é…ç½®å’Œåˆå§‹åŒ–beanä¹‹åå®ç°ä¸€äº›è‡ªå®šä¹‰é€»è¾‘ï¼Œå¯ä»¥æ’å…¥ä¸€ä¸ªæˆ–å¤šä¸ªè‡ªå®šä¹‰BeanPostProcessorå®ç°ã€‚</p><p>æ‚¨å¯ä»¥é…ç½®å¤šä¸ªBeanPostProcessorå®ä¾‹ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡è®¾ç½®orderå±æ€§æ¥æ§åˆ¶è¿™äº›BeanPostProcessorå®ä¾‹çš„æ‰§è¡Œé¡ºåºã€‚åªæœ‰åœ¨BeanPostProcessorå®ç°æœ‰åºæ¥å£æ—¶æ‰èƒ½è®¾ç½®æ­¤å±æ€§ã€‚</p><!--the `org.springframework.beans.factory.config.BeanPostProcessor` interface consists of exactly two callback methods--><!--When such a class is registered as a post-processor with the container, for each bean instance that is created by the container, the post-processor gets a callback from the container both before container initialization methods (such as `InitializingBean.afterPropertiesSet()` or any declared `init` method) are called, and after any bean initialization callbacks.--><!--The post-processor can take any action with the bean instance, including ignoring the callback completely. A bean post-processor typically checks for callback interfaces, or it may wrap a bean with a proxy. Some Spring AOP infrastructure classes are implemented as bean post-processors in order to provide proxy-wrapping logic.--><p>org.springframework.beans.factory.configã€‚BeanPostProcessoræ¥å£æ­£å¥½ç”±ä¸¤ä¸ªå›è°ƒæ–¹æ³•ç»„æˆã€‚</p><p>å½“è¿™æ ·ä¸€ä¸ªç±»æ³¨å†Œä¸ºåå¤„ç†å™¨çš„å®¹å™¨,æ¯ä¸ªå®¹å™¨åˆ›å»ºbeanå®ä¾‹,åå¤„ç†å™¨ä»å®¹å™¨ä¹‹å‰å¾—åˆ°ä¸€ä¸ªå›è°ƒå®¹å™¨åˆå§‹åŒ–æ–¹æ³•(å¦‚InitializingBean.afterPropertiesSet()æˆ–ä»»ä½•å®£å¸ƒinitæ–¹æ³•),ä»»ä½•beanåˆå§‹åŒ–åå›è°ƒã€‚</p><p>åå¤„ç†å™¨å¯ä»¥å¯¹beanå®ä¾‹é‡‡å–ä»»ä½•æ“ä½œï¼ŒåŒ…æ‹¬å®Œå…¨å¿½ç•¥å›è°ƒã€‚beanåå¤„ç†å™¨é€šå¸¸æ£€æŸ¥å›è°ƒæ¥å£ï¼Œæˆ–è€…ä½¿ç”¨ä»£ç†åŒ…è£…beanã€‚ä¸ºäº†æä¾›ä»£ç†åŒ…è£…é€»</p><p><code>BeanPostProcessor</code> instances and AOP auto-proxying</p><!--Classes that implement the `BeanPostProcessor` interface are special and are treated differently by the container.--> <!--All `BeanPostProcessor` instances and beans that they directly reference are instantiated on startup, as part of the special startup phase of the `ApplicationContext`.--> <!--Next, all `BeanPostProcessor` instances are registered in a sorted fashion and applied to all further beans in the container. Because AOP auto-proxying is implemented as a `BeanPostProcessor` itself, neither `BeanPostProcessor` instances nor the beans they directly reference are eligible for auto-proxying and, thus, do not have aspects woven into them.--><!--For any such bean, you should see an informational log message: `Bean someBean is not eligible for getting processed by all BeanPostProcessor interfaces (for example: not eligible for auto-proxying)`.--><p>å®ç°â€œBeanPostProcessorâ€æ¥å£çš„ç±»æ˜¯ç‰¹æ®Šçš„ï¼Œå®¹å™¨ä¼šä»¥ä¸åŒçš„æ–¹å¼å¯¹å¾…å®ƒä»¬ã€‚</p><p>å®ƒä»¬ç›´æ¥å¼•ç”¨çš„æ‰€æœ‰â€œBeanPostProcessorâ€å®ä¾‹å’Œbeanåœ¨å¯åŠ¨æ—¶å®ä¾‹åŒ–ï¼Œä½œä¸ºâ€œApplicationContextâ€çš„ç‰¹æ®Šå¯åŠ¨é˜¶æ®µçš„ä¸€éƒ¨åˆ†ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œä»¥æ’åºçš„æ–¹å¼æ³¨å†Œæ‰€æœ‰â€™ BeanPostProcessor â€˜å®ä¾‹ï¼Œå¹¶å°†å…¶åº”ç”¨äºå®¹å™¨ä¸­æ‰€æœ‰åç»­çš„beanã€‚å› ä¸ºAOPè‡ªåŠ¨ä»£ç†æ˜¯ä½œä¸ºâ€œBeanPostProcessorâ€æœ¬èº«å®ç°çš„ï¼Œæ‰€ä»¥æ— è®ºæ˜¯â€œBeanPostProcessorâ€å®ä¾‹è¿˜æ˜¯å®ƒä»¬ç›´æ¥å¼•ç”¨çš„beanéƒ½æ²¡æœ‰èµ„æ ¼è¿›è¡Œè‡ªåŠ¨ä»£ç†ï¼Œå› æ­¤æ²¡æœ‰å°†æ–¹é¢èå…¥åˆ°å®ƒä»¬ä¹‹ä¸­ã€‚</p><p>å¯¹äºä»»ä½•è¿™æ ·çš„beanï¼Œæ‚¨åº”è¯¥çœ‹åˆ°ä¸€æ¡ä¿¡æ¯æ—¥å¿—æ¶ˆæ¯:â€œbean someBeanä¸é€‚åˆè¢«æ‰€æœ‰BeanPostProcessoræ¥å£å¤„ç†(ä¾‹å¦‚: not eligible for auto-proxying)â€ã€‚</p><pre><code class="java">public interface BeanPostProcessor {   @Nullable   default Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException {      return bean;   }   @Nullable   default Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException {      return bean;   }}</code></pre><h3 id="Customizing-Configuration-Metadata-with-a-BeanFactoryPostProcessor"><a href="#Customizing-Configuration-Metadata-with-a-BeanFactoryPostProcessor" class="headerlink" title="Customizing Configuration Metadata with a BeanFactoryPostProcessor"></a>Customizing Configuration Metadata with a BeanFactoryPostProcessor</h3><p>//ä¸€èˆ¬åº”ç”¨ç”¨äºé…ç½®æ–‡ä»¶çš„è§£æ , å ä½ç¬¦çš„æ›¿æ¢ </p><!--The semantics of this interface are similar to those of the `BeanPostProcessor`, with one major difference: `BeanFactoryPostProcessor` operates on the bean configuration metadata.--> <!--That is, the Spring IoC container lets a `BeanFactoryPostProcessor` read the configuration metadata and potentially change it *before* the container instantiates any beans other than `BeanFactoryPostProcessor` instances.--><!--You can configure multiple `BeanFactoryPostProcessor` instances, and you can control the order in which these `BeanFactoryPostProcessor` instances run by setting the `order` property. However, you can only set this property if the `BeanFactoryPostProcessor` implements the `Ordered` interface.--><p>è¿™ä¸ªæ¥å£çš„è¯­ä¹‰ä¸â€œBeanPostProcessorâ€çš„è¯­ä¹‰ç±»ä¼¼ï¼Œä½†æœ‰ä¸€ä¸ªä¸»è¦åŒºåˆ«:â€œBeanFactoryPostProcessorâ€æ“ä½œbeané…ç½®å…ƒæ•°æ®ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼ŒSpring IoCå®¹å™¨å…è®¸â€œBeanFactoryPostProcessorâ€è¯»å–é…ç½®å…ƒæ•°æ®ï¼Œå¹¶å¯èƒ½åœ¨å®¹å™¨å®ä¾‹åŒ–é™¤â€œBeanFactoryPostProcessorâ€å®ä¾‹ä¹‹å¤–çš„ä»»ä½•beanä¹‹å‰æ›´æ”¹å®ƒã€‚</p><p>æ‚¨å¯ä»¥é…ç½®å¤šä¸ªâ€™ BeanFactoryPostProcessor â€˜å®ä¾‹ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡è®¾ç½®â€™ order â€˜å±æ€§æ¥æ§åˆ¶è¿™äº›â€™ BeanFactoryPostProcessor â€˜å®ä¾‹çš„è¿è¡Œé¡ºåºã€‚ä½†æ˜¯ï¼Œåªæœ‰åœ¨â€™ BeanFactoryPostProcessor â€˜å®ç°â€™ Ordered â€˜æ¥å£æ—¶æ‰èƒ½è®¾ç½®æ­¤å±æ€§ã€‚</p><pre><code class="java">@FunctionalInterfacepublic interface BeanFactoryPostProcessor {   /**    * Modify the application context&#39;s internal bean factory after its standard    * initialization. All bean definitions will have been loaded, but no beans    * will have been instantiated yet. This allows for overriding or adding    * properties even to eager-initializing beans.    * @param beanFactory the bean factory used by the application context    * @throws org.springframework.beans.BeansException in case of errors    */   void postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory) throws BeansException;}</code></pre><p>Spring includes a number of predefined bean factory post-processors, such as <code>PropertyOverrideConfigurer</code> and <code>PropertySourcesPlaceholderConfigurer</code>. </p><h4 id="PropertySourcesPlaceholderConfigurer"><a href="#PropertySourcesPlaceholderConfigurer" class="headerlink" title="PropertySourcesPlaceholderConfigurer"></a>PropertySourcesPlaceholderConfigurer</h4><!--At runtime, a `PropertySourcesPlaceholderConfigurer` is applied to the metadata that replaces some properties of the DataSource.--><!--The `PropertySourcesPlaceholderConfigurer` not only looks for properties in the `Properties` file you specify. By default, if it cannot find a property in the specified properties files, it checks against Spring `Environment` properties and regular Java `System` properties.--><p>åœ¨è¿è¡Œæ—¶ï¼Œâ€™ PropertySourcesPlaceholderConfigurer â€˜åº”ç”¨äºæ›¿ä»£æ•°æ®æºçš„æŸäº›å±æ€§çš„å…ƒæ•°æ®ã€‚</p><p>â€˜ PropertySourcesPlaceholderConfigurer â€˜ä¸ä»…åœ¨æ‚¨æŒ‡å®šçš„â€™ properties â€˜æ–‡ä»¶ä¸­æŸ¥æ‰¾å±æ€§ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœåœ¨æŒ‡å®šçš„å±æ€§æ–‡ä»¶ä¸­æ‰¾ä¸åˆ°å±æ€§ï¼Œå®ƒä¼šæ£€æŸ¥Springçš„â€œEnvironmentâ€å±æ€§å’Œå¸¸è§„çš„Javaâ€œSystemâ€å±æ€§ã€‚</p><h4 id="PropertyOverrideConfigurer"><a href="#PropertyOverrideConfigurer" class="headerlink" title="PropertyOverrideConfigurer"></a>PropertyOverrideConfigurer</h4><!--The `PropertyOverrideConfigurer`, another bean factory post-processor, resembles the `PropertySourcesPlaceholderConfigurer`, but unlike the latter, the original definitions can have default values or no values at all for bean properties.--> <!--If an overriding `Properties` file does not have an entry for a certain bean property, the default context definition is used.--><p>å¦ä¸€ä¸ªbeanå·¥å‚åå¤„ç†å™¨â€™ PropertyOverrideConfigurer â€˜ç±»ä¼¼äºâ€™ PropertySourcesPlaceholderConfigurer â€˜ï¼Œä½†ä¸åè€…ä¸åŒï¼ŒåŸå§‹å®šä¹‰å¯ä»¥æœ‰ç¼ºçœå€¼ï¼Œä¹Ÿå¯ä»¥æ²¡æœ‰beanå±æ€§çš„å€¼ã€‚</p><p>å¦‚æœè¦†ç›–çš„â€œå±æ€§â€æ–‡ä»¶æ²¡æœ‰æŸä¸ªbeanå±æ€§çš„æ¡ç›®ï¼Œåˆ™ä½¿ç”¨é»˜è®¤çš„ä¸Šä¸‹æ–‡å®šä¹‰ã€‚</p><h3 id="Customizing-Instantiation-Logic-with-a-FactoryBean"><a href="#Customizing-Instantiation-Logic-with-a-FactoryBean" class="headerlink" title="Customizing Instantiation Logic with a FactoryBean"></a>Customizing Instantiation Logic with a FactoryBean</h3><!--The FactoryBean interface is a point of pluggability into the Spring IoC containerâ€™s instantiation logic.--> <!--If you have complex initialization code that is better expressed in Java as opposed to a (potentially) verbose amount of XML, you can create your own FactoryBean, write the complex initialization inside that class, and then plug your custom FactoryBean into the container.--><p>FactoryBeanæ¥å£æ˜¯ä¸€ä¸ªå¯æ’å…¥Spring IoCå®¹å™¨å®ä¾‹åŒ–é€»è¾‘çš„ç‚¹ã€‚</p><p>å¦‚æœæ‚¨æœ‰å¤æ‚çš„åˆå§‹åŒ–ä»£ç ï¼Œç”¨Javaè¡¨ç¤ºæ¯”(å¯èƒ½çš„)å†—é•¿çš„XMLæ›´å¥½ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥åˆ›å»ºè‡ªå·±çš„FactoryBeanï¼Œåœ¨è¯¥ç±»ä¸­ç¼–å†™å¤æ‚çš„åˆå§‹åŒ–ï¼Œç„¶åå°†å®šåˆ¶çš„FactoryBeanæ’å…¥å®¹å™¨ä¸­ã€‚</p><p>The <code>FactoryBean</code> interface provides three methods:</p><ul><li><code>Object getObject()</code>: Returns an instance of the object this factory creates. The instance can possibly be shared, depending on whether this factory returns singletons or prototypes.</li><li><code>boolean isSingleton()</code>: Returns <code>true</code> if this <code>FactoryBean</code> returns singletons or <code>false</code> otherwise.</li><li><code>Class getObjectType()</code>: Returns the object type returned by the <code>getObject()</code> method or <code>null</code> if the type is not known in advance.</li></ul><!--When you need to ask a container for an actual `FactoryBean` instance itself instead of the bean it produces, preface the beanâ€™s `id` with the ampersand symbol (`&`) when calling the `getBean()` method of the `ApplicationContext`.--><p>å½“æ‚¨éœ€è¦å‘å®¹å™¨è¯·æ±‚å®é™…çš„â€œFactoryBeanâ€å®ä¾‹æœ¬èº«è€Œä¸æ˜¯å®ƒæ‰€ç”Ÿæˆçš„beanæ—¶ï¼Œ</p><p>åœ¨è°ƒç”¨â€œApplicationContextâ€çš„â€œgetBean()â€æ–¹æ³•æ—¶ï¼Œåœ¨beançš„â€œidâ€å‰é¢åŠ ä¸Šä¸ç¬¦å·(â€œ&amp;â€)ã€‚</p><h2 id="ğŸŒŸAnnotation-based-Container-Configuration-ï¼ˆåŸºäºæ³¨é‡Šçš„å®¹å™¨é…ç½®ï¼‰"><a href="#ğŸŒŸAnnotation-based-Container-Configuration-ï¼ˆåŸºäºæ³¨é‡Šçš„å®¹å™¨é…ç½®ï¼‰" class="headerlink" title="ğŸŒŸAnnotation-based Container Configuration ï¼ˆåŸºäºæ³¨é‡Šçš„å®¹å™¨é…ç½®ï¼‰"></a>ğŸŒŸAnnotation-based Container Configuration ï¼ˆåŸºäºæ³¨é‡Šçš„å®¹å™¨é…ç½®ï¼‰</h2><p>ğŸ”‘å…³é”®è¯: configuration metadata; @Autowired ;@Order;@Primary;@Qulifier;@Resources;BeanPostProcessor</p><p>ğŸ•™Timeline:</p><ul><li>Spring 2.0 @required</li><li>Spring 2.5   @Autowired ,also JSR-250 annotations, such as <code>@PostConstruct</code> and <code>@PreDestroy</code>. </li><li>Spring 3.0  JSR-330 (Dependency Injection for Java) annotations contained in the <code>javax.inject</code> package such as <code>@Inject</code> and <code>@Named</code>. </li></ul><p>how to provide a lot of the configuration metadata through source-level annotations.</p><p>å¦‚ä½•é€šè¿‡æºçº§åˆ«çš„æ³¨è§£æä¾›è®¸å¤šé…ç½®å…ƒæ•°æ®ã€‚</p><p>can also be implicitly registered by including the following tag in an XML-based Spring configuration</p><pre><code class="xml">&lt;beans xmlns:context=&quot;http://www.springframework.org/schema/context&quot;       ...&gt;    &lt;context:annotation-config/&gt;&lt;/beans&gt;</code></pre><p>The implicitly registered post-processors include</p><ul><li><a href="https://docs.spring.io/spring-framework/docs/5.2.1.RELEASE/javadoc-api/org/springframework/beans/factory/annotation/AutowiredAnnotationBeanPostProcessor.html" target="_blank" rel="noopener"><code>AutowiredAnnotationBeanPostProcessor</code></a></li><li><a href="https://docs.spring.io/spring-framework/docs/5.2.1.RELEASE/javadoc-api/org/springframework/context/annotation/CommonAnnotationBeanPostProcessor.html" target="_blank" rel="noopener"><code>CommonAnnotationBeanPostProcessor</code></a></li><li><a href="https://docs.spring.io/spring-framework/docs/5.2.1.RELEASE/javadoc-api/org/springframework/orm/jpa/support/PersistenceAnnotationBeanPostProcessor.html" target="_blank" rel="noopener"><code>PersistenceAnnotationBeanPostProcessor</code></a></li><li><a href="https://docs.spring.io/spring-framework/docs/5.2.1.RELEASE/javadoc-api/org/springframework/beans/factory/annotation/RequiredAnnotationBeanPostProcessor.html" target="_blank" rel="noopener"><code>RequiredAnnotationBeanPostProcessor</code></a></li></ul><!--Annotation injection is performed before XML injection. Thus, the XML configuration overrides the annotations for properties wired through both approaches.--><p>æ³¨è§£æ³¨å…¥åœ¨XMLæ³¨å…¥ä¹‹å‰æ‰§è¡Œã€‚ å› æ­¤ï¼ŒXMLé…ç½®å°†è¦†ç›–é€šè¿‡ä¸¤ç§æ–¹æ³•è¿æ¥çš„å±æ€§çš„æ³¨é‡Šã€‚</p><h3 id="Required"><a href="#Required" class="headerlink" title="@Required"></a>@Required</h3><!--The `@Required` annotation is formally deprecated(å¼ƒç”¨) as of Spring Framework 5.1, in favor of using constructor injection for required settings (or a custom implementation of `InitializingBean.afterPropertiesSet()` along with bean property setter methods).--><p>ä»Spring Framework 5.1å¼€å§‹ï¼Œæ­£å¼å¼ƒç”¨äº†@Requiredæ‰¹æ³¨ï¼ˆå¼ƒç”¨ï¼‰ï¼Œä»¥ä¾¿ä½¿ç”¨æ„é€ å‡½æ•°æ³¨å…¥è¿›è¡Œå¿…éœ€çš„è®¾ç½®ï¼ˆæˆ–InitializingBean.afterPropertiesSetï¼ˆï¼‰çš„è‡ªå®šä¹‰å®ç°ä»¥åŠbeanå±æ€§è®¾ç½®å™¨æ–¹æ³•ï¼‰ã€‚</p><h3 id="Using-Autowired"><a href="#Using-Autowired" class="headerlink" title="Using @Autowired"></a>Using @Autowired</h3><ul><li>apply the <code>@Autowired</code> annotation to constructors</li><li>apply the <code>@Autowired</code> annotation to <em>traditional</em> setter methods</li><li>apply the annotation to methods with arbitrary names and multiple arguments</li><li>apply <code>@Autowired</code> to fields as well and even mix it with constructors</li></ul><!--As of Spring Framework 4.3, an `@Autowired` annotation on such a constructor is no longer necessary if the target bean defines only one constructor to begin with. However, if several constructors are available, at least one must be annotated with `@Autowired` in order to instruct the container which one to use.--><p>ä»Spring Framework 4.3å¼€å§‹ï¼Œå¦‚æœç›®æ ‡beanä»…å®šä¹‰ä¸€ä¸ªæ„é€ å‡½æ•°ä½œä¸ºå¼€å§‹ï¼Œåˆ™ä¸å†éœ€è¦åœ¨æ­¤ç±»æ„é€ å‡½æ•°ä¸Šä½¿ç”¨@Autowiredæ‰¹æ³¨ã€‚ </p><p>ä½†æ˜¯ï¼Œå¦‚æœæœ‰å‡ ä¸ªæ„é€ å‡½æ•°å¯ç”¨ï¼Œåˆ™è‡³å°‘ä¸€ä¸ªå¿…é¡»ç”¨@Autowiredæ³¨é‡Šï¼Œä»¥æŒ‡ç¤ºå®¹å™¨ä½¿ç”¨å“ªä¸ªæ„é€ å‡½æ•°ã€‚</p><p>âš ï¸Ps:  è‡ªåŠ¨è£…é…æ³¨æ„ no type match found ,éœ€è¦ç¡®ä¿ç±»å‹å”¯ä¸€</p><h4 id="Order"><a href="#Order" class="headerlink" title="@Order"></a>@<strong>Order</strong></h4><!--You can declare the `@Order` annotation at the target class level and on `@Bean` methods, potentially for individual bean definitions (in case of multiple definitions that use the same bean class). `@Order` values may influence priorities at injection points, but be aware that they do not influence singleton startup order, which is an orthogonal concern determined by dependency relationships and `@DependsOn` declarations.--><!--Note that the standard `javax.annotation.Priority` annotation is not available at the `@Bean` level, since it cannot be declared on methods. Its semantics can be modeled through `@Order` values in combination with `@Primary` on a single bean for each type.--><p>æ‚¨å¯ä»¥åœ¨ç›®æ ‡ç±»çº§åˆ«å’Œ@Beanæ–¹æ³•ä¸Šå£°æ˜@Orderæ‰¹æ³¨ï¼Œè¿™å¯èƒ½é€‚ç”¨äºå•ä¸ªbeanå®šä¹‰ï¼ˆå¦‚æœä½¿ç”¨åŒä¸€beanç±»çš„å¤šä¸ªå®šä¹‰ï¼‰ã€‚ @Orderå€¼å¯èƒ½ä¼šå½±å“æ³¨å…¥ç‚¹çš„ä¼˜å…ˆçº§ï¼Œä½†è¯·æ³¨æ„å®ƒä»¬ä¸ä¼šå½±å“å•ä¾‹å¯åŠ¨é¡ºåºï¼Œè¿™æ˜¯ç”±ä¾èµ–å…³ç³»å’Œ@DependsOnå£°æ˜ç¡®å®šçš„æ­£äº¤å…³æ³¨ç‚¹ ã€‚</p><p>æ³¨æ„ï¼Œæ ‡å‡†javax.annotation.Priorityæ³¨é‡Šåœ¨@Beançº§åˆ«ä¸å¯ç”¨ï¼Œå› ä¸ºæ— æ³•åœ¨æ–¹æ³•ä¸Šå£°æ˜å®ƒã€‚ å®ƒçš„è¯­ä¹‰å¯ä»¥é€šè¿‡@Orderå€¼ä¸@Primaryç»“åˆåœ¨æ¯ç§ç±»å‹çš„å•ä¸ªbeanä¸Šè¿›è¡Œå»ºæ¨¡ã€‚</p><h4 id="Java8-amp-spring-5-0"><a href="#Java8-amp-spring-5-0" class="headerlink" title="Java8 &amp; spring 5.0"></a><strong>Java8 &amp; spring 5.0</strong></h4><p>express the non-required nature of a particular dependency through Java 8â€™s <code>java.util.Optional</code></p><p>As of Spring Framework 5.0, you can also use a <code>@Nullable</code> annotation (of any kind in any packageâ€‰â€”â€‰for example, <code>javax.annotation.Nullable</code> from JSR-305)</p><!--the `@Autowired`, `@Inject`, `@Value`, and `@Resource` annotations are handled by Spring `BeanPostProcessor` implementations.--> <!--This means that you cannot apply these annotations within your own `BeanPostProcessor` or `BeanFactoryPostProcessor` types (if any).--><p>Spring BeanPostProcessorå®ç°å¤„ç†@ Autowiredï¼Œ@ Injectï¼Œ@ Valueå’Œ@Resourceæ‰¹æ³¨ã€‚</p><p>  è¿™æ„å‘³ç€æ‚¨ä¸èƒ½åœ¨è‡ªå·±çš„BeanPostProcessoræˆ–BeanFactoryPostProcessorç±»å‹ï¼ˆå¦‚æœæœ‰ï¼‰ä¸­åº”ç”¨è¿™äº›æ³¨é‡Šã€‚</p><h3 id="Fine-tuning-å¾®è°ƒ-Annotation-based-Autowiring-with-Primary"><a href="#Fine-tuning-å¾®è°ƒ-Annotation-based-Autowiring-with-Primary" class="headerlink" title="Fine-tuning(å¾®è°ƒ) Annotation-based Autowiring with @Primary"></a>Fine-tuning(å¾®è°ƒ) Annotation-based Autowiring with @Primary</h3><p>å½“å¯ä»¥ç¡®å®šä¸€ä¸ªä¸»è¦å€™é€‰è€…æ—¶ï¼Œ@ Primaryæ˜¯åœ¨å‡ ç§æƒ…å†µä¸‹æŒ‰ç±»å‹ä½¿ç”¨è‡ªåŠ¨è£…é…çš„æœ‰æ•ˆæ–¹æ³•ã€‚</p><h3 id="Fine-tuning-Annotation-based-Autowiring-with-Qualifiers"><a href="#Fine-tuning-Annotation-based-Autowiring-with-Qualifiers" class="headerlink" title="Fine-tuning Annotation-based Autowiring with Qualifiers"></a>Fine-tuning Annotation-based Autowiring with Qualifiers</h3><!--That said, if you intend to express annotation-driven injection by name, do not primarily use `@Autowired`, even if it is capable of selecting by bean name among type-matching candidates.--> <!--Instead, use the JSR-250 `@Resource` annotation, which is semantically defined to identify a specific target component by its unique name, with the declared type being irrelevant for the matching process.--><p>å°±æ˜¯è¯´ï¼Œå¦‚æœæ‚¨æ‰“ç®—æŒ‰åç§°è¡¨ç¤ºæ³¨é‡Šé©±åŠ¨çš„æ³¨å…¥ï¼Œåˆ™å³ä½¿å®ƒèƒ½å¤Ÿåœ¨ç±»å‹åŒ¹é…çš„å€™é€‰å¯¹è±¡ä¸­æŒ‰beanåç§°è¿›è¡Œé€‰æ‹©ï¼Œä¹Ÿä¸è¦ä¸»è¦ä½¿ç”¨<code>@ Autowired</code>ã€‚</p><p>ç›¸åï¼Œè¯·ä½¿ç”¨JSR-250<code>@ Resource</code>æ³¨é‡Šï¼Œè¯¥æ³¨é‡Šåœ¨è¯­ä¹‰ä¸Šå®šä¹‰ä¸ºé€šè¿‡å…¶å”¯ä¸€åç§°æ ‡è¯†ç‰¹å®šç›®æ ‡ç»„ä»¶ï¼Œè€Œå£°æ˜çš„ç±»å‹ä¸åŒ¹é…è¿‡ç¨‹æ— å…³ã€‚</p><h3 id="Using-Generics-as-Autowiring-Qualifiers"><a href="#Using-Generics-as-Autowiring-Qualifiers" class="headerlink" title="Using Generics as Autowiring Qualifiers"></a>Using Generics as Autowiring Qualifiers</h3><!--In addition to the @Qualifier annotation, you can use Java generic types as an implicit form of qualification--><p>é™¤äº†@Qualifieræ‰¹æ³¨ä¹‹å¤–ï¼Œæ‚¨è¿˜å¯ä»¥ä½¿ç”¨Javaæ³›å‹ç±»å‹ä½œä¸ºèµ„æ ¼çš„éšå¼å½¢å¼</p><h3 id="Using-CustomAutowireConfigurer"><a href="#Using-CustomAutowireConfigurer" class="headerlink" title="Using CustomAutowireConfigurer"></a>Using <code>CustomAutowireConfigurer</code></h3><!--[`CustomAutowireConfigurer`](https://docs.spring.io/spring-framework/docs/5.2.0.RELEASE/javadoc-api/org/springframework/beans/factory/annotation/CustomAutowireConfigurer.html) is a `BeanFactoryPostProcessor` that lets you register your own custom qualifier annotation types, even if they are not annotated with Springâ€™s `@Qualifier` annotation.--><p>CustomAutowireConfigureræ˜¯BeanFactoryPostProcessorï¼Œå³ä½¿æ‚¨æ²¡æœ‰ä½¿ç”¨Springçš„@Qualifieræ‰¹æ³¨è¿›è¡Œæ‰¹æ³¨ï¼Œä¹Ÿå¯ä»¥è®©æ‚¨æ³¨å†Œè‡ªå·±çš„è‡ªå®šä¹‰æ‰¹æ³¨æ‰¹æ³¨ç±»å‹ã€‚</p><p>@see org.springframework.beans.factory.annotation.CustomAutowireConfigurer</p><h3 id="Injection-with-Resource-JSR-250-amp-name"><a href="#Injection-with-Resource-JSR-250-amp-name" class="headerlink" title="Injection with @Resource (JSR-250 &amp; name)"></a>Injection with @Resource (JSR-250 &amp; name)</h3><!--Spring also supports injection by using the JSR-250 `@Resource` annotation (`javax.annotation.Resource`) on fields or bean property setter methods.--><!--`@Resource` takes a name attribute. By default, Spring interprets that value as the bean name to be injected.--> <p>Springè¿˜é€šè¿‡åœ¨å­—æ®µæˆ–beanå±æ€§è®¾ç½®å™¨æ–¹æ³•ä¸Šä½¿ç”¨JSR-250<code>@ Resource</code>æ‰¹æ³¨ï¼ˆjavax.annotation.Resource`ï¼‰æ”¯æŒæ³¨å…¥ã€‚</p><p>@Resourceå…·æœ‰åç§°å±æ€§ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpringå°†è¯¥å€¼è§£é‡Šä¸ºè¦æ³¨å…¥çš„Beanåç§°ã€‚</p><h3 id="Using-Value"><a href="#Using-Value" class="headerlink" title="Using @Value"></a>Using <code>@Value</code></h3><!--A default lenient embedded value resolver is provided by Spring. It will try to resolve the property value and if it cannot be resolved, the property name (for example `${catalog.name}`) will be injected as the value.--> <!--If you want to maintain strict control over nonexistent values, you should declare a `PropertySourcesPlaceholderConfigurer` bean--><p>Springæä¾›äº†ä¸€ä¸ªé»˜è®¤çš„å®½æ¾å†…åµŒå€¼è§£æå™¨ã€‚ å®ƒå°†å°è¯•è§£æå±æ€§å€¼ï¼Œå¦‚æœæ— æ³•è§£æï¼Œåˆ™å°†å±æ€§åç§°ï¼ˆä¾‹å¦‚$ {catalog.name}ï¼‰ä½œä¸ºå€¼æ³¨å…¥ã€‚ </p><p>å¦‚æœè¦ä¸¥æ ¼æ§åˆ¶ä¸å­˜åœ¨çš„å€¼ï¼Œåˆ™åº”å£°æ˜ä¸€ä¸ªPropertySourcesPlaceholderConfigurer bean</p><!--Using the above configuration ensures Spring initialization failure if any ${} placeholder could not be resolved. It is also possible to use methods like setPlaceholderPrefix, setPlaceholderSuffix, or setValueSeparator to customize placeholders.--><p>å¦‚æœæ— æ³•è§£æä»»ä½•$ {}å ä½ç¬¦ï¼Œåˆ™ä½¿ç”¨ä¸Šè¿°é…ç½®å¯ç¡®ä¿Springåˆå§‹åŒ–å¤±è´¥ã€‚ ä¹Ÿå¯ä»¥ä½¿ç”¨setPlaceholderPrefixï¼ŒsetPlaceholderSuffixæˆ–setValueSeparatorä¹‹ç±»çš„æ–¹æ³•æ¥è‡ªå®šä¹‰å ä½ç¬¦ã€‚</p><!--When configuring a `PropertySourcesPlaceholderConfigurer` using JavaConfig, the `@Bean` method must be `static`.--><!--Spring Boot configures by default a PropertySourcesPlaceholderConfigurer bean that will get properties from application.properties and application.yml files.--><p>å½“ä½¿ç”¨JavaConfigé…ç½®<code>PropertySourcesPlaceholderConfigurer</code>æ—¶ï¼Œ@Beanæ–¹æ³•å¿…é¡»æ˜¯é™æ€çš„ã€‚</p><p>Spring Booté»˜è®¤é…ç½®ä¸€ä¸ªPropertySourcesPlaceholderConfigurer beanï¼Œå®ƒå°†ä»application.propertieså’Œapplication.ymlæ–‡ä»¶è·å–å±æ€§ã€‚</p><!--A Spring `BeanPostProcessor` uses a `ConversionService` behind the scene to handle the process for converting the String value in `@Value` to the target type. If you want to provide conversion support for your own custom type, you can provide your own `ConversionService` bean instance--><p>Spring  BeanPostProcessorä½¿ç”¨ConversionServiceæ¥å¤„ç†å°†@Valueä¸­çš„Stringå€¼è½¬æ¢ä¸ºç›®æ ‡ç±»å‹çš„è¿‡ç¨‹ã€‚ å¦‚æœè¦ä¸ºè‡ªå·±çš„è‡ªå®šä¹‰ç±»å‹æä¾›è½¬æ¢æ”¯æŒï¼Œåˆ™å¯ä»¥æä¾›è‡ªå·±çš„<code>ConversionService</code> beanå®ä¾‹</p><p><strong>ç›¸å…³ç±»</strong>:</p><p>@see org.springframework.core.convert.ConversionService</p><p>@see org.springframework.context.support.PropertySourcesPlaceholderConfigurer</p><h3 id="Using-PostConstruct-and-PreDestroy-JSR-250"><a href="#Using-PostConstruct-and-PreDestroy-JSR-250" class="headerlink" title="Using @PostConstruct and @PreDestroy (JSR-250)"></a>Using <code>@PostConstruct</code> and <code>@PreDestroy</code> (JSR-250)</h3><p>The <code>CommonAnnotationBeanPostProcessor</code> not only recognizes the <code>@Resource</code> annotation but also the JSR-250 lifecycle annotations: <code>javax.annotation.PostConstruct</code> and <code>javax.annotation.PreDestroy</code>.</p><h2 id="ğŸŒŸClasspath-Scanning-and-Managed-Components"><a href="#ğŸŒŸClasspath-Scanning-and-Managed-Components" class="headerlink" title="ğŸŒŸClasspath Scanning and Managed Components"></a>ğŸŒŸClasspath Scanning and Managed Components</h2><p>ğŸ”‘å…³é”®è¯: @Component ;Stereotype Annotations; @ComponentScan; spring-context-indexer</p><!--Starting with Spring 3.0, many features provided by the Spring JavaConfig project are part of the core Spring Framework. This allows you to define beans using Java rather than using the traditional XML files. Take a look at the `@Configuration`, `@Bean`, `@Import`, and `@DependsOn` annotations for examples of how to use these new features.--><p>ä»Spring 3.0å¼€å§‹ï¼ŒSpring JavaConfigé¡¹ç›®æä¾›çš„è®¸å¤šåŠŸèƒ½æ˜¯æ ¸å¿ƒSpring Frameworkçš„ä¸€éƒ¨åˆ†ã€‚è¿™ä½¿æ‚¨å¯ä»¥ä½¿ç”¨Javaè€Œä¸æ˜¯ä½¿ç”¨ä¼ ç»Ÿçš„XMLæ–‡ä»¶æ¥å®šä¹‰beanã€‚è¯·çœ‹ä¸€ä¸‹@ Configurationï¼Œ@ Beanï¼Œ@ Importå’Œ@DependsOnæ³¨é‡Šï¼Œä»¥è·å–æœ‰å…³å¦‚ä½•ä½¿ç”¨è¿™äº›æ–°åŠŸèƒ½çš„ç¤ºä¾‹ã€‚</p><h3 id="Component-and-Further-Stereotype-Annotations-æ¨¡å¼æ³¨è§£"><a href="#Component-and-Further-Stereotype-Annotations-æ¨¡å¼æ³¨è§£" class="headerlink" title="@Component and Further Stereotype Annotations (æ¨¡å¼æ³¨è§£)"></a><code>@Component</code> and Further Stereotype Annotations (æ¨¡å¼æ³¨è§£)</h3><!--Starting with Spring 3.0, many features provided by the Spring JavaConfig project are part of the core Spring Framework. This allows you to define beans using Java rather than using the traditional XML files. Take a look at the `@Configuration`, `@Bean`, `@Import`, and `@DependsOn` annotations for examples of how to use these new features.--><p>ä»Spring 3.0å¼€å§‹ï¼ŒSpring JavaConfigé¡¹ç›®æä¾›çš„è®¸å¤šåŠŸèƒ½æ˜¯æ ¸å¿ƒSpring Frameworkçš„ä¸€éƒ¨åˆ†ã€‚è¿™ä½¿æ‚¨å¯ä»¥ä½¿ç”¨Javaè€Œä¸æ˜¯ä½¿ç”¨ä¼ ç»Ÿçš„XMLæ–‡ä»¶æ¥å®šä¹‰beanã€‚è¯·çœ‹ä¸€ä¸‹@ Configurationï¼Œ@ Beanï¼Œ@ Importå’Œ@DependsOnæ³¨é‡Šï¼Œä»¥è·å–æœ‰å…³å¦‚ä½•ä½¿ç”¨è¿™äº›æ–°åŠŸèƒ½çš„ç¤ºä¾‹ã€‚</p><!--The @Repository annotation is a marker for any class that fulfills the role or stereotype of a repository (also known as Data Access Object or DAO). Among the uses of this marker is the automatic translation of exceptions, as described in Exception Translation.--><!--Spring provides further stereotype annotations: @Component, @Service, and @Controller. @Component is a generic stereotype for any Spring-managed component. @Repository, @Service, and @Controller are specializations of @Component for more specific use cases (in the persistence, service, and presentation layers, respectively).--> <!--Therefore, you can annotate your component classes with @Component, but, by annotating them with @Repository, @Service, or @Controller instead, your classes are more properly suited for processing by tools or associating with aspects. For example, these stereotype annotations make ideal targets for pointcuts. @Repository, @Service, and @Controller can also carry additional semantics in future releases of the Spring Framework.--> <!--Thus, if you are choosing between using @Component or @Service for your service layer, @Service is clearly the better choice. Similarly, as stated earlier, @Repository is already supported as a marker for automatic exception translation in your persistence layer.--><p>@Repositoryæ‰¹æ³¨æ˜¯å®ç°å­˜å‚¨åº“çš„è§’è‰²æˆ–æ„é€ å‹ï¼ˆä¹Ÿç§°ä¸ºæ•°æ®è®¿é—®å¯¹è±¡æˆ–DAOï¼‰çš„ä»»ä½•ç±»çš„æ ‡è®°ã€‚è¯¥æ ‡è®°çš„ç”¨é€”åŒ…æ‹¬è‡ªåŠ¨ç¿»è¯‘å¼‚å¸¸ï¼Œå¦‚â€œå¼‚å¸¸ç¿»è¯‘â€ä¸­æ‰€è¿°ã€‚</p><p>Springæä¾›äº†è¿›ä¸€æ­¥çš„æ„é€ å‹æ³¨é‡Šï¼š@ Componentï¼Œ@ Serviceå’Œ@Controllerã€‚ @Componentæ˜¯ä»»ä½•Springæ‰˜ç®¡ç»„ä»¶çš„é€šç”¨æ„é€ å‹ã€‚ @ Repositoryï¼Œ@ Serviceå’Œ@Controlleræ˜¯@Componentçš„ç‰¹åŒ–ï¼Œç”¨äºæ›´ç‰¹å®šçš„ç”¨ä¾‹ï¼ˆåˆ†åˆ«åœ¨æŒä¹…å±‚ï¼ŒæœåŠ¡å±‚å’Œè¡¨ç¤ºå±‚ä¸­ï¼‰ã€‚</p><p>å› æ­¤ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨@Componentæ¥æ³¨é‡Šç»„ä»¶ç±»ï¼Œä½†æ˜¯é€šè¿‡ä½¿ç”¨@ Repositoryï¼Œ@ Serviceæˆ–@Controlleræ¥æ³¨é‡Šç»„ä»¶ç±»ï¼Œæ‚¨çš„ç±»æ›´é€‚åˆé€šè¿‡å·¥å…·è¿›è¡Œå¤„ç†æˆ–ä¸æ–¹é¢ç›¸å…³è”ã€‚ä¾‹å¦‚ï¼Œè¿™äº›æ„é€ å‹æ³¨é‡Šæˆä¸ºåˆ‡å…¥ç‚¹çš„ç†æƒ³ç›®æ ‡ã€‚ @ Repositoryï¼Œ@ Serviceå’Œ@Controlleråœ¨Springæ¡†æ¶çš„å°†æ¥ç‰ˆæœ¬ä¸­ä¹Ÿå¯ä»¥å¸¦æœ‰å…¶ä»–è¯­ä¹‰ã€‚</p><p>å› æ­¤ï¼Œå¦‚æœåœ¨æœåŠ¡å±‚ä½¿ç”¨@Componentæˆ–@Serviceä¹‹é—´è¿›è¡Œé€‰æ‹©ï¼Œåˆ™@Serviceæ˜¾ç„¶æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚åŒæ ·ï¼Œå¦‚å‰æ‰€è¿°ï¼Œ@ Repositoryå·²è¢«æ”¯æŒä½œä¸ºæŒä¹…å±‚ä¸­è‡ªåŠ¨å¼‚å¸¸è½¬æ¢çš„æ ‡è®°ã€‚</p><h3 id="Using-Meta-annotations-and-Composed-Annotations-å…ƒæ³¨è§£"><a href="#Using-Meta-annotations-and-Composed-Annotations-å…ƒæ³¨è§£" class="headerlink" title="Using Meta-annotations and Composed Annotations(å…ƒæ³¨è§£)"></a>Using Meta-annotations and Composed Annotations(å…ƒæ³¨è§£)</h3><!--Many of the annotations provided by Spring can be used as meta-annotations in your own code. A meta-annotation is an annotation that can be applied to another annotation.For example, the @Service annotation mentioned earlier is meta-annotated with @Component--><p>Springæä¾›çš„è®¸å¤šæ³¨é‡Šéƒ½å¯ä»¥åœ¨æ‚¨è‡ªå·±çš„ä»£ç ä¸­ç”¨ä½œå…ƒæ³¨é‡Šã€‚ å…ƒæ³¨é‡Šæ˜¯å¯ä»¥åº”ç”¨äºå¦ä¸€ä¸ªæ³¨é‡Šçš„æ³¨é‡Šã€‚ ä¾‹å¦‚ï¼Œå‰é¢æåˆ°çš„@Serviceæ³¨é‡Šä½¿ç”¨@Componentè¿›è¡Œå…ƒæ³¨é‡Šã€‚</p><h3 id="Automatically-Detecting-Classes-and-Registering-Bean-Definitions-è‡ªåŠ¨æ£€æµ‹ç±»å¹¶æ³¨å†ŒBeanå®šä¹‰"><a href="#Automatically-Detecting-Classes-and-Registering-Bean-Definitions-è‡ªåŠ¨æ£€æµ‹ç±»å¹¶æ³¨å†ŒBeanå®šä¹‰" class="headerlink" title="Automatically Detecting Classes and Registering Bean Definitions(è‡ªåŠ¨æ£€æµ‹ç±»å¹¶æ³¨å†ŒBeanå®šä¹‰)"></a>Automatically Detecting Classes and Registering Bean Definitions(è‡ªåŠ¨æ£€æµ‹ç±»å¹¶æ³¨å†ŒBeanå®šä¹‰)</h3><!--To autodetect these classes and register the corresponding beans, you need to add @ComponentScan to your @Configuration class, where the basePackages attribute is a common parent package for the two classes.--><p>è¦è‡ªåŠ¨æ£€æµ‹è¿™äº›ç±»å¹¶æ³¨å†Œç›¸åº”çš„beanï¼Œæ‚¨éœ€è¦å°†@ComponentScanæ·»åŠ åˆ°@Configurationç±»ä¸­ï¼Œå…¶ä¸­basePackageså±æ€§æ˜¯è¿™ä¸¤ä¸ªç±»çš„å…¬å…±çˆ¶åŒ…ã€‚ ï¼ˆæˆ–è€…ï¼Œæ‚¨å¯ä»¥æŒ‡å®šä¸€ä¸ªé€—å·åˆ†éš”ï¼Œåˆ†å·åˆ†éš”æˆ–ç©ºæ ¼åˆ†éš”çš„åˆ—è¡¨ï¼Œå…¶ä¸­åŒ…æ‹¬æ¯ä¸ªç±»çš„çˆ¶åŒ…ã€‚ï¼‰</p><p>The use of <code>&lt;context:component-scan&gt;</code> implicitly enables the functionality of <code>&lt;context:annotation-config&gt;</code>. There is usually no need to include the <code>&lt;context:annotation-config&gt;</code> element when using <code>&lt;context:component-scan&gt;</code>.</p><h3 id="Using-Filters-to-Customize-Scanning"><a href="#Using-Filters-to-Customize-Scanning" class="headerlink" title="Using Filters to Customize Scanning"></a>Using Filters to Customize Scanning</h3><p>Add them as <code>includeFilters</code> or <code>excludeFilters</code> attributes of the <code>@ComponentScan</code> annotation (or as <code>or</code> child elements of the <code></code> element in XML configuration). Each filter element requires the <code>type</code> and <code>expression</code> attributes. </p><p>Filter Type</p><ul><li><p>annotation (default)</p></li><li><p>assignable</p></li><li><p>aspectj</p></li><li><p>regex</p></li><li><p>custom</p></li></ul><h3 id="Defining-Bean-Metadata-within-Components-åœ¨ç»„ä»¶ä¸­å®šä¹‰Beanå…ƒæ•°æ®"><a href="#Defining-Bean-Metadata-within-Components-åœ¨ç»„ä»¶ä¸­å®šä¹‰Beanå…ƒæ•°æ®" class="headerlink" title="Defining Bean Metadata within Components(åœ¨ç»„ä»¶ä¸­å®šä¹‰Beanå…ƒæ•°æ®)"></a>Defining Bean Metadata within Components(åœ¨ç»„ä»¶ä¸­å®šä¹‰Beanå…ƒæ•°æ®)</h3><!--You may declare @Bean methods as static, allowing for them to be called without creating their containing configuration class as an instance. This makes particular sense when defining post-processor beans (for example, of type BeanFactoryPostProcessor or BeanPostProcessor), since such beans get initialized early in the container lifecycle and should avoid triggering other parts of the configuration at that point.--><p>æ‚¨å¯ä»¥å°†@Beanæ–¹æ³•å£°æ˜ä¸ºé™æ€æ–¹æ³•ï¼Œä»è€Œå…è®¸åœ¨ä¸å°†å…¶åŒ…å«é…ç½®ç±»åˆ›å»ºä¸ºå®ä¾‹çš„æƒ…å†µä¸‹è°ƒç”¨å®ƒä»¬ã€‚åœ¨å®šä¹‰åå¤„ç†å™¨Beanï¼ˆä¾‹å¦‚BeanFactoryPostProcessoræˆ–BeanPostProcessorç±»å‹ï¼‰æ—¶ï¼Œè¿™ç‰¹åˆ«æœ‰æ„ä¹‰ï¼Œå› ä¸ºæ­¤ç±»Beanåœ¨å®¹å™¨ç”Ÿå‘½å‘¨æœŸçš„æ—©æœŸè¿›è¡Œäº†åˆå§‹åŒ–ï¼Œå¹¶ä¸”åº”é¿å…åœ¨é‚£æ—¶è§¦å‘é…ç½®çš„å…¶ä»–éƒ¨åˆ†ã€‚</p><!--Calls to static @Bean methods never get intercepted by the container, not even within @Configuration classes (as described earlier in this section), due to technical limitations: CGLIB subclassing can override only non-static methods. As a consequence, a direct call to another @Bean method has standard Java semantics, resulting in an independent instance being returned straight from the factory method itself.--><p>ç”±äºæŠ€æœ¯é™åˆ¶ï¼Œå¯¹é™æ€@Beanæ–¹æ³•çš„è°ƒç”¨æ°¸è¿œä¸ä¼šè¢«å®¹å™¨æ‹¦æˆªï¼Œå³ä½¿åœ¨@Configurationç±»ä¸­ä¹Ÿæ˜¯å¦‚æ­¤ï¼ˆå¦‚æœ¬èŠ‚å‰é¢æ‰€è¿°ï¼‰ï¼Œç”±äºæŠ€æœ¯é™åˆ¶ï¼šCGLIBå­ç±»åªèƒ½è¦†ç›–éé™æ€æ–¹æ³•ã€‚ç»“æœï¼Œç›´æ¥è°ƒç”¨å¦ä¸€ä¸ª@Beanæ–¹æ³•å…·æœ‰æ ‡å‡†çš„Javaè¯­ä¹‰ï¼Œä»è€Œå¯¼è‡´ç›´æ¥ä»å·¥å‚æ–¹æ³•æœ¬èº«ç›´æ¥è¿”å›ä¸€ä¸ªç‹¬ç«‹çš„å®ä¾‹ã€‚</p><!--The Java language visibility of @Bean methods does not have an immediate impact on the resulting bean definition in Springâ€™s container. You can freely declare your factory methods as you see fit in non-@Configuration classes and also for static methods anywhere. However, regular @Bean methods in @Configuration classes need to be overridableâ€‰â€”â€‰that is, they must not be declared as private or final.--><p>@Beanæ–¹æ³•çš„Javaè¯­è¨€å¯è§æ€§ä¸ä¼šå¯¹Springå®¹å™¨ä¸­çš„æœ€ç»ˆbean definition äº§ç”Ÿç›´æ¥å½±å“ã€‚æ‚¨å¯ä»¥åœ¨é@Configurationç±»ä¸­è‡ªç”±å£°æ˜è‡ªå·±çš„å·¥å‚æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹å£°æ˜é™æ€æ–¹æ³•ã€‚ä½†æ˜¯ï¼Œ@ Configurationç±»ä¸­çš„å¸¸è§„@Beanæ–¹æ³•å¿…é¡»æ˜¯å¯é‡å†™çš„â€”å³ï¼Œä¸å¾—å°†å®ƒä»¬å£°æ˜ä¸ºprivateæˆ–finalã€‚</p><h3 id="Naming-Autodetected-Components-å‘½åè‡ªåŠ¨æ£€æµ‹çš„ç»„ä»¶"><a href="#Naming-Autodetected-Components-å‘½åè‡ªåŠ¨æ£€æµ‹çš„ç»„ä»¶" class="headerlink" title="Naming Autodetected Components(å‘½åè‡ªåŠ¨æ£€æµ‹çš„ç»„ä»¶)"></a>Naming Autodetected Components(å‘½åè‡ªåŠ¨æ£€æµ‹çš„ç»„ä»¶)</h3><!--When a component is autodetected as part of the scanning process, its bean name is generated by the `BeanNameGenerator` strategy known to that scanne--> <!--If you do not want to rely on the default bean-naming strategy, you can provide a custom bean-naming strategy. First, implement the `BeanNameGenerator` interface, and be sure to include a default no-arg constructor.--> <p>å½“åœ¨æ‰«æè¿‡ç¨‹ä¸­è‡ªåŠ¨æ£€æµ‹åˆ°ç»„ä»¶æ—¶ï¼Œå…¶beanåç§°ç”±è¯¥scanneå·²çŸ¥çš„<code>BeanNameGenerator</code>ç­–ç•¥ç”Ÿæˆã€‚</p><p>  å¦‚æœæ‚¨ä¸æƒ³ä¾èµ–é»˜è®¤çš„Beanå‘½åç­–ç•¥ï¼Œåˆ™å¯ä»¥æä¾›è‡ªå®šä¹‰Beanå‘½åç­–ç•¥ã€‚ é¦–å…ˆï¼Œå®ç°<code>BeanNameGenerator</code> æ¥å£ï¼Œå¹¶ç¡®ä¿åŒ…å«é»˜è®¤çš„æ— å‚æ•°æ„é€ å‡½æ•°ã€‚</p><h4 id="Providing-a-Scope-for-Autodetected-Components-æä¾›è‡ªåŠ¨æ£€æµ‹ç»„ä»¶çš„ä½œç”¨åŸŸ"><a href="#Providing-a-Scope-for-Autodetected-Components-æä¾›è‡ªåŠ¨æ£€æµ‹ç»„ä»¶çš„ä½œç”¨åŸŸ" class="headerlink" title="Providing a Scope for Autodetected Components(æä¾›è‡ªåŠ¨æ£€æµ‹ç»„ä»¶çš„ä½œç”¨åŸŸ)"></a>Providing a Scope for Autodetected Components(æä¾›è‡ªåŠ¨æ£€æµ‹ç»„ä»¶çš„ä½œç”¨åŸŸ)</h4><!--To provide a custom strategy for scope resolution rather than relying on the annotation-based approach, you can implement the ScopeMetadataResolver interface.Be sure to include a default no-arg constructor.--> <p>è¦æä¾›ç”¨äºèŒƒå›´è§£æçš„è‡ªå®šä¹‰ç­–ç•¥ï¼Œè€Œä¸æ˜¯ä¾èµ–äºåŸºäºæ³¨é‡Šçš„æ–¹æ³•ï¼Œå¯ä»¥å®ç°ScopeMetadataResolveræ¥å£ã€‚<br>ç¡®ä¿åŒ…æ‹¬é»˜è®¤çš„æ— å‚æ•°æ„é€ å‡½æ•°ã€‚</p><h4 id="Providing-Qualifier-Metadata-with-Annotations"><a href="#Providing-Qualifier-Metadata-with-Annotations" class="headerlink" title="Providing Qualifier Metadata with Annotations"></a>P<del>roviding Qualifier Metadata with Annotations</del></h4><h4 id="Generating-an-Index-of-Candidate-Components-ç”Ÿæˆå€™é€‰ç»„ä»¶çš„ç´¢å¼•"><a href="#Generating-an-Index-of-Candidate-Components-ç”Ÿæˆå€™é€‰ç»„ä»¶çš„ç´¢å¼•" class="headerlink" title="Generating an Index of Candidate Components(ç”Ÿæˆå€™é€‰ç»„ä»¶çš„ç´¢å¼•)"></a>Generating an Index of Candidate Components(ç”Ÿæˆå€™é€‰ç»„ä»¶çš„ç´¢å¼•)</h4><p>While classpath scanning is very fast, it is possible to improve the startup performance of large applications by creating a static list of candidates at compilation time. In this mode, all modules that are target of component scan must use this mechanism.</p><p>åŠ å¿«æ‰«æé€Ÿåº¦</p><h2 id="ğŸŒŸUsing-JSR-330-Standard-Annotations"><a href="#ğŸŒŸUsing-JSR-330-Standard-Annotations" class="headerlink" title="ğŸŒŸUsing JSR 330 Standard Annotations"></a>ğŸŒŸUsing JSR 330 Standard Annotations</h2><p>ğŸ”‘å…³é”®è¯: javax.inject ; @Inject; @Named</p><h3 id="Dependency-Injection-with-Inject-and-Named"><a href="#Dependency-Injection-with-Inject-and-Named" class="headerlink" title="Dependency Injection with @Inject and @Named"></a>Dependency Injection with <code>@Inject</code> and <code>@Named</code></h3><p>If you would like to use a qualified name for the dependency that should be injected, you should use the <code>@Named</code> annotation</p><p>å¦‚æœæ‚¨æƒ³å¯¹æ³¨å…¥çš„ä¾èµ–é¡¹ä½¿ç”¨é™å®šåç§°ï¼Œåˆ™åº”ä½¿ç”¨@Namedæ³¨è§£</p><h3 id="Named-and-ManagedBean-Standard-Equivalents-to-the-Component-Annotation-Componentæ³¨è§£çš„æ¯”è¾ƒ"><a href="#Named-and-ManagedBean-Standard-Equivalents-to-the-Component-Annotation-Componentæ³¨è§£çš„æ¯”è¾ƒ" class="headerlink" title="@Named and @ManagedBean: Standard Equivalents to the @Component Annotation(@Componentæ³¨è§£çš„æ¯”è¾ƒ)"></a>@Named and @ManagedBean: Standard Equivalents to the @Component Annotation(@Componentæ³¨è§£çš„æ¯”è¾ƒ)</h3><!--In contrast to @Component, the JSR-330 @Named and the JSR-250 ManagedBean annotations are not composable.--> <!--You should use Springâ€™s stereotype model for building custom component annotations.--><p>ä¸@Componentç›¸åï¼ŒJSR-330 @Namedå’ŒJSR-250 ManagedBeanæ³¨é‡Šæ˜¯ä¸å¯ç»„åˆçš„ã€‚</p><p>æ‚¨åº”è¯¥ä½¿ç”¨Springçš„åŸå‹æ¨¡å‹æ¥æ„å»ºè‡ªå®šä¹‰ç»„ä»¶æ³¨é‡Šã€‚</p><h3 id="Limitations-of-JSR-330-Standard-Annotations"><a href="#Limitations-of-JSR-330-Standard-Annotations" class="headerlink" title="Limitations of JSR-330 Standard Annotations"></a>Limitations of JSR-330 Standard Annotations</h3><table><thead><tr><th style="text-align:left">Spring</th><th style="text-align:left">javax.inject.*</th><th style="text-align:left">javax.inject restrictions / comments</th></tr></thead><tbody><tr><td style="text-align:left">@Autowired</td><td style="text-align:left">@Inject</td><td style="text-align:left"><code>@Inject</code> has no â€˜requiredâ€™ attribute. Can be used with Java 8â€™s <code>Optional</code> instead.</td></tr><tr><td style="text-align:left">@Component</td><td style="text-align:left">@Named / @ManagedBean</td><td style="text-align:left">JSR-330 does not provide a composable model, only a way to identify named components.</td></tr><tr><td style="text-align:left">@Scope(â€œsingletonâ€)</td><td style="text-align:left">@Singleton</td><td style="text-align:left">The JSR-330 default scope is like Springâ€™s <code>prototype</code>. However, in order to keep it consistent with Springâ€™s general defaults, a JSR-330 bean declared in the Spring container is a <code>singleton</code> by default. In order to use a scope other than <code>singleton</code>, you should use Springâ€™s <code>@Scope</code> annotation. <code>javax.inject</code> also provides a <a href="https://download.oracle.com/javaee/6/api/javax/inject/Scope.html" target="_blank" rel="noopener">@Scope</a> annotation. Nevertheless, this one is only intended to be used for creating your own annotations.</td></tr><tr><td style="text-align:left">@Qualifier</td><td style="text-align:left">@Qualifier / @Named</td><td style="text-align:left"><code>javax.inject.Qualifier</code> is just a meta-annotation for building custom qualifiers. Concrete <code>String</code> qualifiers (like Springâ€™s <code>@Qualifier</code> with a value) can be associated through <code>javax.inject.Named</code>.</td></tr><tr><td style="text-align:left">@Value</td><td style="text-align:left">-</td><td style="text-align:left">no equivalent</td></tr><tr><td style="text-align:left">@Required</td><td style="text-align:left">-</td><td style="text-align:left">no equivalent</td></tr><tr><td style="text-align:left">@Lazy</td><td style="text-align:left">-</td><td style="text-align:left">no equivalent</td></tr><tr><td style="text-align:left">ObjectFactory</td><td style="text-align:left">Provider</td><td style="text-align:left"><code>javax.inject.Provider</code> is a direct alternative to Springâ€™s <code>ObjectFactory</code>, only with a shorter <code>get()</code> method name. It can also be used in combination with Springâ€™s <code>@Autowired</code> or with non-annotated constructors and setter methods.</td></tr></tbody></table><h2 id="ğŸŒŸJava-based-Container-Configuration-åŸºäºJavaçš„å®¹å™¨é…ç½®"><a href="#ğŸŒŸJava-based-Container-Configuration-åŸºäºJavaçš„å®¹å™¨é…ç½®" class="headerlink" title="ğŸŒŸJava-based Container Configuration(åŸºäºJavaçš„å®¹å™¨é…ç½®)"></a>ğŸŒŸJava-based Container Configuration(åŸºäºJavaçš„å®¹å™¨é…ç½®)</h2><p>ğŸ”‘å…³é”®è¯: @Bean; @Configuration;AnnotationConfigApplicationContext;lite vs full;@Import; @ImportResource;@Condition</p><p>This section covers how to use annotations in your Java code to configure the Spring container. It includes the following topics:</p><ul><li><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-java-basic-concepts" target="_blank" rel="noopener">Basic Concepts: <code>@Bean</code> and <code>@Configuration</code></a></li><li><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-java-instantiating-container" target="_blank" rel="noopener">Instantiating the Spring Container by Using <code>AnnotationConfigApplicationContext</code></a></li><li><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-java-bean-annotation" target="_blank" rel="noopener">Using the <code>@Bean</code> Annotation</a></li><li><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-java-configuration-annotation" target="_blank" rel="noopener">Using the <code>@Configuration</code> annotation</a></li><li><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-java-composing-configuration-classes" target="_blank" rel="noopener">Composing Java-based Configurations</a></li><li><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-definition-profiles" target="_blank" rel="noopener">Bean Definition Profiles</a></li><li><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-property-source-abstraction" target="_blank" rel="noopener"><code>PropertySource</code> Abstraction</a></li><li><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-using-propertysource" target="_blank" rel="noopener">Using <code>@PropertySource</code></a></li><li><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-placeholder-resolution-in-statements" target="_blank" rel="noopener">Placeholder Resolution in Statements</a></li></ul><h3 id="Basic-Concepts-Bean-and-Configuration"><a href="#Basic-Concepts-Bean-and-Configuration" class="headerlink" title="Basic Concepts: @Bean and @Configuration"></a>Basic Concepts: <code>@Bean</code> and <code>@Configuration</code></h3><!--Annotating a class with `@Configuration` indicates that its primary purpose is as a source of bean definitions. Furthermore, `@Configuration` classes let inter-bean dependencies be defined by calling other `@Bean` methods in the same class.--><p>@Configuration: ç”¨@Configurationæ³¨é‡Šç±»è¡¨ç¤ºè¯¥ç±»çš„ä¸»è¦ç›®çš„æ˜¯ä½œä¸ºBeanå®šä¹‰çš„æ¥æºã€‚ æ­¤å¤–ï¼Œ@Configurationç±»å…è®¸é€šè¿‡è°ƒç”¨åŒä¸€ç±»ä¸­çš„å…¶ä»–@Beanæ–¹æ³• æ¥å®šä¹‰Beané—´çš„ä¾èµ–å…³ç³»ã€‚</p><p>@Bean : Indicates that a method produces a bean to be managed by the Spring container.</p><p><strong>Full @Configuration vs â€œliteâ€ @Bean mode?</strong></p><p>åœ¨<code>lite @Bean mode</code>æ¨¡å¼ä¸‹ï¼Œ <code>@Bean</code>æ–¹æ³•ä¸ä¼šè¢«CGLIBä»£ç† ,æ‰€ä»¥å°½é‡ä½¿ç”¨Full @Configurationæ¨¡å¼</p><h3 id="Instantiating-the-Spring-Container-by-Using-AnnotationConfigApplicationContext"><a href="#Instantiating-the-Spring-Container-by-Using-AnnotationConfigApplicationContext" class="headerlink" title="Instantiating the Spring Container by Using AnnotationConfigApplicationContext"></a>Instantiating the Spring Container <strong>by</strong> Using AnnotationConfigApplicationContext</h3><!--This versatile `ApplicationContext` implementation is capable of accepting not only `@Configuration` classes as input but also plain `@Component` classes and classes annotated with JSR-330 metadata.--><p>è¿™ç§é€šç”¨çš„ApplicationContextå®ç°ä¸ä»…èƒ½å¤Ÿæ¥å—@Configurationç±»ä½œä¸ºè¾“å…¥ï¼Œ</p><p>è€Œä¸”è¿˜å¯ä»¥æ¥å—æ™®é€šçš„@Componentç±»å’Œå¸¦æœ‰JSR-330å…ƒæ•°æ®æ³¨é‡Šçš„ç±»ã€‚</p><p><strong>scan &amp; register</strong></p><pre><code class="java">package org.springframework.context.annotation;/** * Common interface for annotation config application contexts, * defining {@link #register} and {@link #scan} methods. * * @author Juergen Hoeller * @since 4.1 */public interface AnnotationConfigRegistry {   /**    * Register one or more annotated classes to be processed.    * &lt;p&gt;Calls to {@code register} are idempotent; adding the same    * annotated class more than once has no additional effect.    * @param annotatedClasses one or more annotated classes,    * e.g. {@link Configuration @Configuration} classes    */   void register(Class&lt;?&gt;... annotatedClasses);   /**    * Perform a scan within the specified base packages.    * @param basePackages the packages to check for annotated classes    */   void scan(String... basePackages);}</code></pre><p>more details: @see org.springframework.context.annotation.AnnotationConfigApplicationContext</p><p><strong>Support for Web Applications with <code>AnnotationConfigWebApplicationContext</code></strong></p><h3 id="Using-the-Bean-Annotation"><a href="#Using-the-Bean-Annotation" class="headerlink" title="Using the @Bean Annotation"></a>Using the <code>@Bean</code> Annotation</h3><ul><li>Declaring a Bean</li><li>Bean Dependencies</li><li>Receiving Lifecycle Callbacks</li><li>Specifying Bean Scope</li><li>Customizing Bean Naming</li><li>Bean Aliasing</li><li>Bean Description</li></ul><p>@see org.springframework.context.annotation.Bean</p><h3 id="Using-the-Configuration-annotation"><a href="#Using-the-Configuration-annotation" class="headerlink" title="Using the @Configuration annotation"></a>Using the <code>@Configuration</code> annotation</h3><p><strong>Injecting Inter-bean Dependencies(æ³¨å…¥beané—´çš„ä¾èµ–å…³ç³»)</strong></p><p><strong>Lookup Method Injection</strong></p><p><strong>Further Information About How Java-based Configuration Works Internally</strong></p><!--This is where the magic comes in: All `@Configuration` classes are subclassed at startup-time with `CGLIB`.In the subclass, the child method checks the container first for any cached (scoped) beans before it calls the parent method and creates a new instance--><h3 id="Composing-Java-based-Configurations"><a href="#Composing-Java-based-Configurations" class="headerlink" title="Composing Java-based Configurations"></a>Composing Java-based Configurations</h3><h3 id="Using-the-Import-Annotation"><a href="#Using-the-Import-Annotation" class="headerlink" title="Using the @Import Annotation"></a>Using the <code>@Import</code> Annotation</h3><!--As of Spring Framework 4.2, `@Import` also supports references to regular component classes, analogous to the `AnnotationConfigApplicationContext.register` method.--> <!--This is particularly useful if you want to avoid component scanning, by using a few configuration classes as entry points to explicitly define all your components.--><p>ä»Spring Framework 4.2å¼€å§‹ï¼Œ@ Importè¿˜æ”¯æŒå¯¹å¸¸è§„ç»„ä»¶ç±»çš„å¼•ç”¨ï¼Œç±»ä¼¼äºAnnotationConfigApplicationContext.registeræ–¹æ³•ã€‚ </p><p>å¦‚æœè¦é€šè¿‡ä½¿ç”¨ä¸€äº›é…ç½®ç±»ä½œä¸ºå…¥å£ç‚¹æ¥æ˜¾å¼å®šä¹‰æ‰€æœ‰ç»„ä»¶ï¼Œä»è€Œé¿å…ç»„ä»¶æ‰«æï¼Œåˆ™æ­¤åŠŸèƒ½ç‰¹åˆ«æœ‰ç”¨ã€‚</p><h3 id="Conditionally-Include-Configuration-Classes-or-Bean-Methods"><a href="#Conditionally-Include-Configuration-Classes-or-Bean-Methods" class="headerlink" title="Conditionally Include @Configuration Classes or @Bean Methods"></a>Conditionally Include <code>@Configuration</code> Classes or <code>@Bean</code> Methods</h3><p>The <code>@Profile</code> annotation is actually implemented by using a much more flexible annotation called <a href="https://docs.spring.io/spring-framework/docs/5.2.1.RELEASE/javadoc-api/org/springframework/context/annotation/Conditional.html" target="_blank" rel="noopener"><code>@Conditional</code></a>. </p><p>The <code>@Conditional</code> annotation indicates specific <code>org.springframework.context.annotation.Condition</code> implementations that should be consulted before a <code>@Bean</code> is registered.</p><p><strong>@Profile</strong></p><pre><code class="java">@Target({ElementType.TYPE, ElementType.METHOD})@Retention(RetentionPolicy.RUNTIME)@Documented@Conditional(ProfileCondition.class)public @interface Profile {    /**     * The set of profiles for which the annotated component should be registered.     */    String[] value();}</code></pre><p><strong>ProfileCondition</strong></p><pre><code class="java">class ProfileCondition implements Condition {  @Override  public boolean matches(ConditionContext context, AnnotatedTypeMetadata metadata) {    MultiValueMap&lt;String, Object&gt; attrs = metadata.getAllAnnotationAttributes(Profile.class.getName());    if (attrs != null) {      for (Object value : attrs.get(&quot;value&quot;)) {        if (context.getEnvironment().acceptsProfiles(Profiles.of((String[]) value))) {          return true;        }      }      return false;    }    return true;  }}</code></pre><p><strong>Condition</strong></p><pre><code class="java">@FunctionalInterfacepublic interface Condition {   /**    * Determine if the condition matches.    * @param context the condition context    * @param metadata metadata of the {@link org.springframework.core.type.AnnotationMetadata class}    * or {@link org.springframework.core.type.MethodMetadata method} being checked    * @return {@code true} if the condition matches and the component can be registered,    * or {@code false} to veto the annotated component&#39;s registration    */   boolean matches(ConditionContext context, AnnotatedTypeMetadata metadata);}</code></pre><h3 id="Combining-Java-and-XML-Configuration"><a href="#Combining-Java-and-XML-Configuration" class="headerlink" title="Combining Java and XML Configuration"></a>Combining Java and XML Configuration</h3><p>Springâ€™s <code>@Configuration</code> class support does not aim to be a 100% complete replacement for Spring XML.</p><h4 id="XML-centric-Use-of-Configuration-Classes"><a href="#XML-centric-Use-of-Configuration-Classes" class="headerlink" title="XML-centric Use of @Configuration Classes"></a>XML-centric Use of <code>@Configuration</code> Classes</h4><p><strong>Declaring @Configuration classes as plain Spring &lt;bean/ &gt; elements</strong></p><pre><code class="xml">&lt;!-- enable processing of annotations such as @Autowired and @Configuration --&gt;&lt;context:annotation-config/&gt;&lt;bean class=&quot;com.acme.AppConfig&quot;/&gt;</code></pre><p>&lt;context:annotation-config /&gt; <strong>ä»…èƒ½å¤Ÿåœ¨å·²ç»åœ¨å·²ç»æ³¨å†Œè¿‡çš„beanä¸Šé¢èµ·ä½œç”¨,æ‰€ä»¥éœ€è¦æ‰‹åŠ¨æ³¨å†Œ</strong></p><p>Using &lt;context:component-scan/ &gt; to pick up @Configuration classes**</p><pre><code class="xml">&lt;!-- picks up and registers AppConfig as a bean definition --&gt; &lt;context:component-scan base-package=&quot;com.acme&quot;/&gt;</code></pre><h4 id="ConfigurationClass-centric-Use-of-XML-with-ImportResource"><a href="#ConfigurationClass-centric-Use-of-XML-with-ImportResource" class="headerlink" title="@ConfigurationClass-centric Use of XML with@ImportResource"></a>@Configuration<code>Class-centric Use of XML with</code>@ImportResource</h4><p><strong>@ImportResource</strong></p><pre><code class="java">@Retention(RetentionPolicy.RUNTIME)@Target(ElementType.TYPE)@Documentedpublic @interface ImportResource {    /**     * Alias for {@link #locations}.     * @see #locations     * @see #reader     */    @AliasFor(&quot;locations&quot;)    String[] value() default {};    /**     * Resource locations from which to import.     * &lt;p&gt;Supports resource-loading prefixes such as {@code classpath:},     * {@code file:}, etc.     * &lt;p&gt;Consult the Javadoc for {@link #reader} for details on how resources     * will be processed.     * @since 4.2     * @see #value     * @see #reader     */    @AliasFor(&quot;value&quot;)    String[] locations() default {};    /**     * {@link BeanDefinitionReader} implementation to use when processing     * resources specified via the {@link #value} attribute.     * &lt;p&gt;By default, the reader will be adapted to the resource path specified:     * {@code &quot;.groovy&quot;} files will be processed with a     * {@link org.springframework.beans.factory.groovy.GroovyBeanDefinitionReader GroovyBeanDefinitionReader};     * whereas, all other resources will be processed with an     * {@link org.springframework.beans.factory.xml.XmlBeanDefinitionReader XmlBeanDefinitionReader}.     * @see #value     */    Class&lt;? extends BeanDefinitionReader&gt; reader() default BeanDefinitionReader.class;}</code></pre><h2 id="ğŸŒŸEnvironment-Abstraction-ï¼ˆç¯å¢ƒæŠ½è±¡ï¼‰"><a href="#ğŸŒŸEnvironment-Abstraction-ï¼ˆç¯å¢ƒæŠ½è±¡ï¼‰" class="headerlink" title="ğŸŒŸEnvironment Abstraction ï¼ˆç¯å¢ƒæŠ½è±¡ï¼‰"></a>ğŸŒŸEnvironment Abstraction ï¼ˆç¯å¢ƒæŠ½è±¡ï¼‰</h2><p>ğŸ”‘å…³é”®è¯: Environment; profiles; properties;PropertySources;PropertySourcesPlaceholderConfigurer</p><p>The <a href="https://docs.spring.io/spring-framework/docs/5.2.0.RELEASE/javadoc-api/org/springframework/core/env/Environment.html" target="_blank" rel="noopener"><code>Environment</code></a> interface is an abstraction integrated in the container that models two key aspects of the application environment: <a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-definition-profiles" target="_blank" rel="noopener">profiles</a> and <a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-property-source-abstraction" target="_blank" rel="noopener">properties</a>.</p><p>Environmentæ¥å£æ˜¯é›†æˆåœ¨å®¹å™¨ä¸­çš„æŠ½è±¡ï¼Œå®ƒå¯¹åº”ç”¨ç¨‹åºç¯å¢ƒçš„ä¸¤ä¸ªå…³é”®æ–¹é¢è¿›è¡Œå»ºæ¨¡ï¼šprofileså’Œproperties</p><p>A profile is a named, logical group of bean definitions to be registered with the container only if the given profile is active. Beans may be assigned to a profile whether defined in XML or with annotations. </p><p>The role of the <code>Environment</code> object with relation to profiles is in determining which profiles (if any) are currently active, and which profiles (if any) should be active by default.</p><p>Properties play an important role in almost all applications and may originate from a variety of sources: properties files, JVM system properties, system environment variables, JNDI, servlet context parameters, ad-hoc <code>Properties</code> objects, <code>Map</code> objects, and so on.</p><p> The role of the <code>Environment</code> object with relation to properties is to provide the user with a convenient service interface for configuring property sources and resolving properties from them.</p><h3 id="Bean-Definition-Profiles"><a href="#Bean-Definition-Profiles" class="headerlink" title="Bean Definition Profiles"></a>Bean Definition Profiles</h3><h4 id="Using-Profile"><a href="#Using-Profile" class="headerlink" title="Using @Profile"></a>Using <code>@Profile</code></h4><h4 id="XML-Bean-Definition-Profiles"><a href="#XML-Bean-Definition-Profiles" class="headerlink" title="XML Bean Definition Profiles"></a>XML Bean Definition Profiles</h4><h4 id="Activating-a-Profile"><a href="#Activating-a-Profile" class="headerlink" title="Activating a Profile"></a>Activating a Profile</h4><p>spring.profiles.active</p><h4 id="Default-Profile"><a href="#Default-Profile" class="headerlink" title="Default Profile"></a>Default Profile</h4><p>default</p><h3 id="PropertySource-Abstraction"><a href="#PropertySource-Abstraction" class="headerlink" title="PropertySource Abstraction"></a><code>PropertySource</code> Abstraction</h3><p>For a common <code>StandardServletEnvironment</code>, the full hierarchy is as follows, with the highest-precedence entries at the top:</p><ul><li>ServletConfig parameters (if applicableâ€‰â€”â€‰for example, in case of a <code>DispatcherServlet</code> context)</li><li>ServletContext parameters (web.xml context-param entries)</li><li>JNDI environment variables (<code>java:comp/env/</code> entries)</li><li>JVM system properties (<code>-D</code> command-line arguments)</li><li>JVM system environment (operating system environment variables)</li></ul><pre><code class="java">ConfigurableApplicationContext ctx = new GenericApplicationContext();MutablePropertySources sources = ctx.getEnvironment().getPropertySources();</code></pre><h3 id="Using-PropertySource"><a href="#Using-PropertySource" class="headerlink" title="Using @PropertySource"></a>Using <code>@PropertySource</code></h3><p>The <a href="https://docs.spring.io/spring-framework/docs/5.2.1.RELEASE/javadoc-api/org/springframework/context/annotation/PropertySource.html" target="_blank" rel="noopener"><code>@PropertySource</code></a> annotation provides a convenient and declarative mechanism for adding a <code>PropertySource</code> to Springâ€™s <code>Environment</code>.</p><h3 id="Placeholder-Resolution-in-Statements"><a href="#Placeholder-Resolution-in-Statements" class="headerlink" title="Placeholder Resolution in Statements"></a>Placeholder Resolution in Statements</h3><p>Historically, the value of placeholders in elements could be resolved only against JVM system properties or environment variables. This is no longer the case.</p><p>Because the <code>Environment</code> abstraction is integrated throughout the container, it is easy to route resolution of placeholders through it. </p><p>This means that you may configure the resolution process in any way you like.</p><p> You can change the precedence of searching through system properties and environment variables or remove them entirely.</p><p>@See org.springframework.context.support.PropertySourcesPlaceholderConfigurer</p><h2 id="ğŸŒŸRegistering-a-LoadTimeWeaver"><a href="#ğŸŒŸRegistering-a-LoadTimeWeaver" class="headerlink" title="ğŸŒŸRegistering a LoadTimeWeaver"></a><del>ğŸŒŸRegistering a <code>LoadTimeWeaver</code></del></h2><p>weaving(ç¼–ç»‡ ç¼–è¯‘æ—¶ã€åŠ è½½æ—¶ã€è¿è¡Œæ—¶) è¿™é‡Œæ˜¯ç±»åŠ è½½æ—¶</p><p>The <code>LoadTimeWeaver</code> is used by Spring to dynamically transform classes as they are loaded into the Java virtual machine (JVM).</p><p>@See <a href="https://www.cnblogs.com/wade-luffy/p/6073702.html" target="_blank" rel="noopener">https://www.cnblogs.com/wade-luffy/p/6073702.html</a></p><h2 id="ğŸŒŸAdditional-Capabilities-of-the-ApplicationContext-BeanFactoryçš„æ‰©å±•"><a href="#ğŸŒŸAdditional-Capabilities-of-the-ApplicationContext-BeanFactoryçš„æ‰©å±•" class="headerlink" title="ğŸŒŸAdditional Capabilities of the ApplicationContext (BeanFactoryçš„æ‰©å±•)"></a>ğŸŒŸAdditional Capabilities of the <code>ApplicationContext</code> (BeanFactoryçš„æ‰©å±•)</h2><p>ğŸ”‘å…³é”®è¯:BeanFactory;ResourceLoader;MessageSource;ResourceBundleMessageSource;Environment;EventPublisher;</p><p>@EventListener;ContextLoaderListener;</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g949aex83ij31d80fotac.jpg" alt="image-20191120093906082"></p><p>To enhance <code>BeanFactory</code> functionality in a more framework-oriented style, the context package also provides the following functionality:</p><ul><li>Access to messages in i18n-style, through the <code>MessageSource</code> interface.</li><li>Access to resources, such as URLs and files, through the <code>ResourceLoader</code> interface.</li><li>Event publication, namely to beans that implement the <code>ApplicationListener</code> interface, through the use of the <code>ApplicationEventPublisher</code> interface.</li><li>Loading of multiple (hierarchical) contexts, letting each be focused on one particular layer, such as the web layer of an application, through the <code>HierarchicalBeanFactory</code> interface.</li></ul><h3 id="Internationalization-using-MessageSource"><a href="#Internationalization-using-MessageSource" class="headerlink" title="Internationalization using MessageSource"></a>Internationalization using <code>MessageSource</code></h3><h3 id="Standard-and-Custom-Events"><a href="#Standard-and-Custom-Events" class="headerlink" title="Standard and Custom Events"></a>Standard and Custom Events</h3><table><thead><tr><th style="text-align:left">Event</th><th style="text-align:left">Explanation</th></tr></thead><tbody><tr><td style="text-align:left"><code>ContextRefreshedEvent</code></td><td style="text-align:left">Published when the <code>ApplicationContext</code> is initialized or refreshed (for example, by using the <code>refresh()</code> method on the <code>ConfigurableApplicationContext</code> interface). Here, â€œinitializedâ€ means that all beans are loaded, post-processor beans are detected and activated, singletons are pre-instantiated, and the <code>ApplicationContext</code> object is ready for use. As long as the context has not been closed, a refresh can be triggered multiple times, provided that the chosen <code>ApplicationContext</code> actually supports such â€œhotâ€ refreshes. For example, <code>XmlWebApplicationContext</code> supports hot refreshes, but <code>GenericApplicationContext</code> does not.</td></tr><tr><td style="text-align:left"><code>ContextStartedEvent</code></td><td style="text-align:left">Published when the <code>ApplicationContext</code> is started by using the <code>start()</code> method on the <code>ConfigurableApplicationContext</code> interface. Here, â€œstartedâ€ means that all <code>Lifecycle</code> beans receive an explicit start signal. Typically, this signal is used to restart beans after an explicit stop, but it may also be used to start components that have not been configured for autostart (for example, components that have not already started on initialization).</td></tr><tr><td style="text-align:left"><code>ContextStoppedEvent</code></td><td style="text-align:left">Published when the <code>ApplicationContext</code> is stopped by using the <code>stop()</code> method on the <code>ConfigurableApplicationContext</code> interface. Here, â€œstoppedâ€ means that all <code>Lifecycle</code> beans receive an explicit stop signal. A stopped context may be restarted through a <code>start()</code> call.</td></tr><tr><td style="text-align:left"><code>ContextClosedEvent</code></td><td style="text-align:left">Published when the <code>ApplicationContext</code> is being closed by using the <code>close()</code> method on the <code>ConfigurableApplicationContext</code> interface or via a JVM shutdown hook. Here, â€œclosedâ€ means that all singleton beans will be destroyed. Once the context is closed, it reaches its end of life and cannot be refreshed or restarted.</td></tr><tr><td style="text-align:left"><code>RequestHandledEvent</code></td><td style="text-align:left">A web-specific event telling all beans that an HTTP request has been serviced. This event is published after the request is complete. This event is only applicable to web applications that use Springâ€™s <code>DispatcherServlet</code>.</td></tr><tr><td style="text-align:left"><code>ServletRequestHandledEvent</code></td><td style="text-align:left">A subclass of <code>RequestHandledEvent</code> that adds Servlet-specific context information.</td></tr></tbody></table><h4 id="Annotation-based-Event-Listeners"><a href="#Annotation-based-Event-Listeners" class="headerlink" title="Annotation-based Event Listeners"></a>Annotation-based Event Listeners</h4><p> As of Spring 4.2, the event infrastructure has been significantly improved and offers an <a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#context-functionality-events-annotation" target="_blank" rel="noopener">annotation-based model</a> as well as the ability to publish any arbitrary event (that is, an object that does not necessarily extend from <code>ApplicationEvent</code>). When such an object is published, we wrap it in an event for you.</p><h4 id="Asynchronous-Listeners"><a href="#Asynchronous-Listeners" class="headerlink" title="Asynchronous Listeners"></a>Asynchronous Listeners</h4><p>Be aware of the following limitations when using asynchronous events:</p><ul><li>If an asynchronous event listener throws an <code>Exception</code>, it is not propagated to the caller. See <code>AsyncUncaughtExceptionHandler</code> for more details.</li><li>Asynchronous event listener methods cannot publish a subsequent event by returning a value. If you need to publish another event as the result of the processing, inject an <a href="https://docs.spring.io/spring-framework/docs/5.2.1.RELEASE/javadoc-api/org/springframework/aop/interceptor/AsyncUncaughtExceptionHandler.html" target="_blank" rel="noopener"><code>ApplicationEventPublisher</code></a> to publish the event manually.</li></ul><h4 id="Ordering-Listeners"><a href="#Ordering-Listeners" class="headerlink" title="Ordering Listeners"></a>Ordering Listeners</h4><p>@Order</p><h4 id="Generic-Events"><a href="#Generic-Events" class="headerlink" title="Generic Events"></a><del>Generic Events</del></h4><p>@see org.springframework.core.ResolvableTypeProvider</p><h3 id="Convenient-Access-to-Low-level-Resources"><a href="#Convenient-Access-to-Low-level-Resources" class="headerlink" title="Convenient Access to Low-level Resources"></a>Convenient Access to Low-level Resources</h3><p>An application context is a <code>ResourceLoader</code>, which can be used to load <code>Resource</code> objects. A <code>Resource</code> is essentially a more feature rich version of the JDK <code>java.net.URL</code> class</p><h3 id="Convenient-ApplicationContext-Instantiation-for-Web-Applications"><a href="#Convenient-ApplicationContext-Instantiation-for-Web-Applications" class="headerlink" title="Convenient ApplicationContext Instantiation for Web Applications"></a>Convenient ApplicationContext Instantiation for Web Applications</h3><p>You can register an <code>ApplicationContext</code> by using the <code>ContextLoaderListener</code></p><pre><code class="xml">&lt;context-param&gt;    &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;    &lt;param-value&gt;/WEB-INF/daoContext.xml /WEB-INF/applicationContext.xml&lt;/param-value&gt;&lt;/context-param&gt;&lt;listener&gt;    &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;&lt;/listener&gt;</code></pre><h3 id="Deploying-a-Spring-ApplicationContext-as-a-Java-EE-RAR-File"><a href="#Deploying-a-Spring-ApplicationContext-as-a-Java-EE-RAR-File" class="headerlink" title="Deploying a Spring ApplicationContext as a Java EE RAR File"></a>Deploying a Spring <code>ApplicationContext</code> as a Java EE RAR File</h3><p>Such RAR deployment units are usually self-contained. They do not expose components to the outside world, not even to other modules of the same application. </p><h2 id="ğŸŒŸThe-BeanFactory"><a href="#ğŸŒŸThe-BeanFactory" class="headerlink" title="ğŸŒŸThe BeanFactory"></a>ğŸŒŸThe <code>BeanFactory</code></h2><p>ğŸ”‘å…³é”®è¯: DefaultListableBeanFactory ; extensions</p><p>Note that the core <code>BeanFactory</code> API level and its <code>DefaultListableBeanFactory</code> implementation do not make assumptions about the configuration format or any component annotations to be used. All of these flavors come in through extensions (such as <code>XmlBeanDefinitionReader</code> and <code>AutowiredAnnotationBeanPostProcessor</code>) and operate on shared <code>BeanDefinition</code> objects as a core metadata representation.</p><p> This is the essence of what makes Springâ€™s container so flexible and extensible.</p><h3 id="BeanFactory-or-ApplicationContext"><a href="#BeanFactory-or-ApplicationContext" class="headerlink" title="BeanFactory or ApplicationContext?"></a><code>BeanFactory</code> or <code>ApplicationContext</code>?</h3><p>For many extended container features, such as annotation processing and AOP proxying, the <a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-factory-extension-bpp" target="_blank" rel="noopener"><code>BeanPostProcessor</code> extension point</a> is essential. </p><p>If you use only a plain <code>DefaultListableBeanFactory</code>, such post-processors do not get detected and activated by default. This situation could be confusing, because nothing is actually wrong with your bean configuration. </p><p>Rather, in such a scenario, the container needs to be fully bootstrapped through additional setup.</p><p>The following table lists features provided by the <code>BeanFactory</code> and <code>ApplicationContext</code> interfaces and implementations.</p><table><thead><tr><th style="text-align:left">Feature</th><th style="text-align:left"><code>BeanFactory</code></th><th style="text-align:left"><code>ApplicationContext</code></th></tr></thead><tbody><tr><td style="text-align:left">Bean instantiation/wiring</td><td style="text-align:left">Yes</td><td style="text-align:left">Yes</td></tr><tr><td style="text-align:left">Integrated lifecycle management</td><td style="text-align:left">No</td><td style="text-align:left">Yes</td></tr><tr><td style="text-align:left">Automatic <code>BeanPostProcessor</code> registration</td><td style="text-align:left">No</td><td style="text-align:left">Yes</td></tr><tr><td style="text-align:left">Automatic <code>BeanFactoryPostProcessor</code> registration</td><td style="text-align:left">No</td><td style="text-align:left">Yes</td></tr><tr><td style="text-align:left">Convenient <code>MessageSource</code> access (for internalization)</td><td style="text-align:left">No</td><td style="text-align:left">Yes</td></tr><tr><td style="text-align:left">Built-in <code>ApplicationEvent</code> publication mechanism</td><td style="text-align:left">No</td><td style="text-align:left">Yes</td></tr></tbody></table><h2 id="æ€»è§ˆ"><a href="#æ€»è§ˆ" class="headerlink" title="æ€»è§ˆ"></a>æ€»è§ˆ</h2><p>é¡¶çº§æ¥å£</p><ul><li>BeanFactory <ul><li>bean (beanDefined); </li><li>çŠ¶æ€(ä½œç”¨åŸŸ)/è¡Œä¸º(å›è°ƒ,bean extends)/å…³ç³»(ä¾èµ–) </li><li>contains extension (BPF/BBPF/FactoryBean)</li></ul></li><li>ApplicationContext <ul><li>Messagesource</li><li>Event</li><li>layer (AOP /web /auto registration )</li></ul></li></ul><p> Core (core/asm/cglib/util) </p><ul><li>Env</li><li>IO</li><li>Type : Core support package for type introspection.(å†…çœ)</li><li><p>@AliasFor / @Order</p><p>Annotaion(2.5 / 3.0/ 4.0/ 5.0)</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> spring </tag>
            
            <tag> doc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JDK_Packages_java_nio</title>
      <link href="/2019/09/26/JDK-Packages-java-nio/"/>
      <url>/2019/09/26/JDK-Packages-java-nio/</url>
      
        <content type="html"><![CDATA[<blockquote><p>å¹´å°‘é£é›…é²œè¡£æ€’é©¬  ä¹Ÿä¸è¿‡ä¸€åˆ¹é‚£                 â€”ã€Šçº¢æ˜­æ„¿ã€‹</p></blockquote><p>ä»JDK4 å¼€å§‹ ,NIOæ˜¯New I/Oçš„ç®€ç§°ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š</p><ul><li>ä¸ºæ‰€æœ‰çš„åŸå§‹ç±»å‹æä¾›ï¼ˆBufferï¼‰ç¼“å­˜æ”¯æŒï¼›(IOä¹Ÿæœ‰BufferInputStream)</li><li>å¢åŠ é€šé“ï¼ˆchannelï¼‰å¯¹è±¡ï¼Œä½œä¸ºæ–°çš„åŸå§‹ I/O æŠ½è±¡ï¼›</li><li>æä¾›äº†åŸºäº Selector çš„å¼‚æ­¥ç½‘ç»œ I/Oã€‚(çº¿ç¨‹æ¨¡å‹)</li><li>ä½¿ç”¨ java.nio.charset.Charset ä½œä¸ºå­—ç¬¦é›†ç¼–ç è§£ç è§£å†³æ–¹æ¡ˆï¼›</li><li>æ”¯æŒé”å’Œå†…å­˜æ˜ å°„(MappedByteBuffer)æ–‡ä»¶çš„æ–‡ä»¶è®¿é—®æ¥å£ï¼›</li></ul><p>å‚è€ƒèµ„æ–™:</p><p><a href="http://tutorials.jenkov.com/java-nio/index.html" target="_blank" rel="noopener">http://tutorials.jenkov.com/java-nio/index.html</a></p><p><a href="https://ifeve.com/overview/" target="_blank" rel="noopener">https://ifeve.com/overview/</a></p><p><a href="https://docs.oracle.com/javase/8/docs/api/java/nio/package-summary.html" target="_blank" rel="noopener">https://docs.oracle.com/javase/8/docs/api/java/nio/package-summary.html</a></p><p><a href="https://cloud.tencent.com/developer/information/ä½¿ç”¨ByteBuffer" target="_blank" rel="noopener">https://cloud.tencent.com/developer/information/%E4%BD%BF%E7%94%A8ByteBuffer</a></p><a id="more"></a><h3 id="Overivew"><a href="#Overivew" class="headerlink" title="Overivew"></a>Overivew</h3><p>Java NIO (New IO) is an alternative IO API for Java (from Java 1.4), meaning alternative to the standard <a href="http://tutorials.jenkov.com/java-io/index.html" target="_blank" rel="noopener">Java IO</a> and <a href="http://tutorials.jenkov.com/java-networking/index.html" target="_blank" rel="noopener">Java Networking</a> APIâ€™s. Java NIO offers a different way of working with IO than the standard IO APIâ€™s.</p><p>Java NIO consist of the following core components:</p><ul><li>Channels</li><li>Buffers</li><li>Selectors</li></ul><h3 id="Buffer"><a href="#Buffer" class="headerlink" title="Buffer"></a>Buffer</h3><h4 id="buffer-api"><a href="#buffer-api" class="headerlink" title="buffer api"></a>buffer api</h4><h5 id="filed"><a href="#filed" class="headerlink" title="filed"></a>filed</h5><ul><li>capacityï¼šå®¹é‡ï¼Œè¡¨ç¤ºbufferçš„æœ€å¤§æ•°æ®å®¹é‡ï¼Œç¼“å†²åŒºå®¹é‡ä¸èƒ½ä¸ºè´Ÿï¼Œåˆ›å»ºåä¸èƒ½æ›´æ”¹</li><li>limitï¼šé™åˆ¶ï¼ŒæŒ‰ç…§ç´¢å¼•æ¥ï¼Œlimitä¹‹åçš„æ•°æ®ä¸å¯è¯»å†™ï¼Œå³åªæœ‰åœ¨limitèŒƒå›´å†…çš„æ•°æ®æˆ‘ä»¬æ‰å¯ä»¥è¯»å†™æ“ä½œã€‚</li><li>positionï¼šä½ç½®ï¼Œä¸‹ä¸€ä¸ªè¦è¯»å–æˆ–å†™å…¥çš„ç´¢å¼•ä½ç½®ã€‚è¯¥ä½ç½®ä¸èƒ½å¤§äºlimitçš„é™åˆ¶ã€‚</li><li>markï¼šæ ‡è®°ï¼Œæ ‡è®°åçš„ç´¢å¼•ä½ç½®ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡resetæ–¹æ³•æ¢å¤positionåˆ°è¯¥ä½ç½®ï¼Œè¯¥markçš„ä½ç½®è¦å°äºæˆ–ç­‰äºposition</li></ul><pre><code class="java">// Invariants: mark &lt;= position &lt;= limit &lt;= capacityprivate int mark = -1;private int position = 0;private int limit;private int capacity;</code></pre><h5 id="method"><a href="#method" class="headerlink" title="method"></a>method</h5><ul><li><p>clear : Clears this buffer.  The position is set to zero, the limit is set to the capacity, and the mark is discarded.</p><p>  å°†positionç½®ä¸º0ï¼Œå¹¶ä¸æ¸…é™¤bufferå†…å®¹ã€‚ </p><p>  <img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g7f35bshboj30pa0iawf3.jpg" alt="img" style="zoom:33%;"></p></li><li><p>flip(ç¿»è½¬ write-&gt;read) : Flips this buffer.  The limit is set to the current position and then the position is set to zero.  If the mark is defined then it is  discarded.</p><p>  å†™å®Œæ•°æ®(put)ï¼Œéœ€è¦å¼€å§‹è¯»çš„æ—¶å€™ï¼Œå°†postionå¤ä½åˆ°0ï¼Œå¹¶å°†limitè®¾ä¸ºå½“å‰postionã€‚ </p></li></ul><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g7f34btvf6j30oy0ic74v.jpg" alt="img" style="zoom:33%;"></p><ul><li>Rewind(å€’å¸¦,å’Œflipç›¸æ¯”å°‘äº†å¯¹limitçš„æ“ä½œ) :  Rewinds this buffer.  The position is set to zero and the mark is discarded.</li><li>Remaining\hasRemaining : Returns the number of elements between the current position and the limit.</li></ul><h5 id="source"><a href="#source" class="headerlink" title="source"></a>source</h5><pre><code class="java">                        /**     * Clears this buffer.  The position is set to zero, the limit is set to     * the capacity, and the mark is discarded.     *     * &lt;p&gt; Invoke this method before using a sequence of channel-read or     * &lt;i&gt;put&lt;/i&gt; operations to fill this buffer.  For example:     *     * &lt;blockquote&gt;&lt;pre&gt;     * buf.clear();     // Prepare buffer for reading     * in.read(buf);    // Read data&lt;/pre&gt;&lt;/blockquote&gt;     *     * &lt;p&gt; This method does not actually erase the data in the buffer, but it     * is named as if it did because it will most often be used in situations     * in which that might as well be the case. &lt;/p&gt;     *     * @return  This buffer     */    public final Buffer clear() {        position = 0;        limit = capacity;        mark = -1;        return this;    }    /**     * Flips this buffer.  The limit is set to the current position and then     * the position is set to zero.  If the mark is defined then it is     * discarded.     *     * &lt;p&gt; After a sequence of channel-read or &lt;i&gt;put&lt;/i&gt; operations, invoke     * this method to prepare for a sequence of channel-write or relative     * &lt;i&gt;get&lt;/i&gt; operations.  For example:     *     * &lt;blockquote&gt;&lt;pre&gt;     * buf.put(magic);    // Prepend header     * in.read(buf);      // Read data into rest of buffer     * buf.flip();        // Flip buffer     * out.write(buf);    // Write header + data to channel&lt;/pre&gt;&lt;/blockquote&gt;     *     * &lt;p&gt; This method is often used in conjunction with the {@link     * java.nio.ByteBuffer#compact compact} method when transferring data from     * one place to another.  &lt;/p&gt;     *     * @return  This buffer     */    public final Buffer flip() {        limit = position;        position = 0;        mark = -1;        return this;    }    /**     * Rewinds this buffer.  The position is set to zero and the mark is     * discarded.     *     * &lt;p&gt; Invoke this method before a sequence of channel-write or &lt;i&gt;get&lt;/i&gt;     * operations, assuming that the limit has already been set     * appropriately.  For example:     *     * &lt;blockquote&gt;&lt;pre&gt;     * out.write(buf);    // Write remaining data     * buf.rewind();      // Rewind buffer     * buf.get(array);    // Copy data into array&lt;/pre&gt;&lt;/blockquote&gt;     *     * @return  This buffer     */    public final Buffer rewind() {        position = 0;        mark = -1;        return this;    }    /**     * Returns the number of elements between the current position and the     * limit.     *     * @return  The number of elements remaining in this buffer     */    public final int remaining() {        return limit - position;    }    /**     * Tells whether there are any elements between the current position and     * the limit.     *     * @return  &lt;tt&gt;true&lt;/tt&gt; if, and only if, there is at least one element     *          remaining in this buffer     */    public final boolean hasRemaining() {        return position &lt; limit;    }</code></pre><h4 id="buffer-extends"><a href="#buffer-extends" class="headerlink" title="buffer extends"></a>buffer extends</h4><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g7cpyddkurj31ps0s0adh.jpg" alt="image-20190924145529968"></p><p>Here is a list of the core <code>Buffer</code> implementations in Java NIO:</p><ul><li>ByteBuffer</li><li>CharBuffer</li><li>DoubleBuffer</li><li>FloatBuffer</li><li>IntBuffer</li><li>LongBuffer</li><li>ShortBuffer</li></ul><p>These <code>Buffer</code>â€˜s cover the basic data types that you can send via IO: byte, short, int, long, float, double and characters.</p><h4 id="ByteBuffer"><a href="#ByteBuffer" class="headerlink" title="ByteBuffer"></a>ByteBuffer</h4><p>ByteBufferæœ€æ ¸å¿ƒçš„æ–¹æ³•æ˜¯put(byte)å’Œget()ã€‚åˆ†åˆ«æ˜¯å¾€ByteBufferé‡Œå†™ä¸€ä¸ªå­—èŠ‚ï¼Œå’Œè¯»ä¸€ä¸ªå­—èŠ‚ã€‚</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒByteBufferçš„è¯»å†™æ¨¡å¼æ˜¯åˆ†å¼€çš„ï¼Œæ­£å¸¸çš„åº”ç”¨åœºæ™¯æ˜¯ï¼šå¾€ByteBufferé‡Œå†™ä¸€äº›æ•°æ®ï¼Œç„¶åflip()ï¼Œç„¶åå†è¯»å‡ºæ¥ã€‚</p><h5 id="allocate"><a href="#allocate" class="headerlink" title="allocate"></a>allocate</h5><pre><code class="java">                    public static ByteBuffer allocateDirect(int capacity) {        return new DirectByteBuffer(capacity);    }    public static ByteBuffer allocate(int capacity) {        if (capacity &lt; 0)            throw new IllegalArgumentException();        return new HeapByteBuffer(capacity, capacity);    }</code></pre><h5 id="HeapByteBuffer"><a href="#HeapByteBuffer" class="headerlink" title="HeapByteBuffer"></a>HeapByteBuffer</h5><p>é—´æ¥çš„ByteBufferæ˜¯åœ¨JVMçš„å †ä¸Šé¢çš„ã€‚é—´æ¥ç¼“å†²åŒºå°±æ˜¯æˆ‘ä»¬é€šå¸¸è¯´çš„å †ç¼“å†²åŒºã€‚</p><pre><code class="java">class HeapByteBuffer extends ByteBuffer {}</code></pre><h5 id="DirectByteBuffer"><a href="#DirectByteBuffer" class="headerlink" title="DirectByteBuffer"></a>DirectByteBuffer</h5><p>ç›´æ¥å°±æ˜¯æŒ‡MappedByteBufferï¼Œç›´æ¥ä½¿ç”¨å†…å­˜æ˜ å°„ï¼ˆjavaçš„è¯å°±æ„å‘³ç€åœ¨JVMä¹‹å¤–åˆ†é…è™šæ‹Ÿåœ°å€ç©ºé—´ï¼‰ï¼›</p><pre><code class="java">class DirectByteBuffer extends MappedByteBuffer implements DirectBuffer {}</code></pre><p>èµ„æ–™:</p><blockquote><p><a href="https://cloud.tencent.com/developer/article/1428920" target="_blank" rel="noopener">https://cloud.tencent.com/developer/article/1428920</a>  MappedByteBuffer VS FileChannel ï¼Œå­°å¼ºå­°å¼±</p><p><a href="https://cloud.tencent.com/developer/article/1152616" target="_blank" rel="noopener">https://cloud.tencent.com/developer/article/1152616</a>   å †å¤–å†…å­˜ ä¹‹ DirectByteBuffer è¯¦è§£</p></blockquote><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g7hmmyw3xnj30er047wes.jpg" alt="img"></p><h6 id="MappedByteBuffer"><a href="#MappedByteBuffer" class="headerlink" title="MappedByteBuffer"></a>MappedByteBuffer</h6><ul><li><p>load : ä¼šæ•´ä¸ªæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­ã€‚</p></li><li><p>isLoaded : åˆ¤æ–­ä¸€ä¸ªè¢«æ˜ å°„çš„æ–‡ä»¶æ˜¯å¦å®Œå…¨åŠ è½½å†…å­˜äº†</p></li><li><p>force :è¯¥æ–¹æ³•ä¼šå¼ºåˆ¶å°†æ­¤ç¼“å†²åŒºä¸Šçš„ä»»ä½•æ›´æ”¹å†™å…¥æ˜ å°„åˆ°æ°¸ä¹…ç£ç›˜å­˜å‚¨å™¨ä¸Šã€‚</p></li></ul><pre><code class="java">public abstract class MappedByteBuffer extends ByteBuffer {    public final MappedByteBuffer load( )    public final boolean isLoaded( )    public final MappedByteBuffer force( )}</code></pre><p><a href="https://cloud.tencent.com/developer/article/1130046" target="_blank" rel="noopener">https://cloud.tencent.com/developer/article/1130046</a></p><h3 id="Channels"><a href="#Channels" class="headerlink" title="Channels"></a>Channels</h3><p>Typically, all IO in NIO starts with a <code>Channel</code>. A <code>Channel</code> is a bit like a stream. From the <code>Channel</code> data can be read into a <code>Buffer</code>. Data can also be written from a <code>Buffer</code> into a <code>Channel</code>. Here is an illustration of that:</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g7cpybgjbdj309e06fjre.jpg" alt="Java NIO: Channels and Buffers"></p><p>â€‹            <strong>Java NIO: Channels read data into Buffers, and Buffers write data into Channels</strong></p><p>Java NIO Channels are similar to streams with a few differences:</p><ul><li>You can both read and write to a Channels. Streams are typically one-way (read or write).</li><li>Channels can be read and written asynchronously.</li><li>Channels always read to, or write from, a Buffer.</li></ul><h4 id="Channel-Implementations"><a href="#Channel-Implementations" class="headerlink" title="Channel Implementations"></a>Channel Implementations</h4><p>Here are the most important Channel implementations in Java NIO:</p><ul><li><p>FileChannel  : reads data from and to files.</p><p>  **public abstract long transferTo(long position,long count,WritableByteChannel target)</p><pre><code>                       throws IOException**</code></pre><p>  This method is potentially much more efficient than a simple loop that reads from this channel and writes to the target channel. Many operating systems can transfer bytes directly from the filesystem cache to the target channel without actually copying them.</p></li><li><p>DatagramChannel : can read and write data over the network via UDP.</p></li><li><p>SocketChannel : can read and write data over the network via TCP.</p></li><li><p>ServerSocketChannel : allows you to listen for incoming TCP connections, like a web server does. For each incoming connection a <code>SocketChannel</code> is created.</p></li></ul><h4 id="Selectors"><a href="#Selectors" class="headerlink" title="Selectors"></a>Selectors</h4><h5 id="Why-Use-a-Selector"><a href="#Why-Use-a-Selector" class="headerlink" title="Why Use a Selector?"></a>Why Use a Selector?</h5><p>A <code>Selector</code> allows a single thread to handle multiple <code>Channel</code>â€˜s. This is handy if your application has many connections (Channels) open, but only has low traffic on each connection. For instance, in a chat server.</p><p>Here is an illustration of a thread using a <code>Selector</code> to handle 3 <code>Channel</code>â€˜s:</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g7cpycvhlgj30bc08zdg0.jpg" alt="Java NIO: Selectors"></p><p>â€‹                                 <strong>Java NIO: A Thread uses a Selector to handle 3 Channelâ€™s</strong></p><p>To use a <code>Selector</code> you register the <code>Channel</code>â€˜s with it. Then you call itâ€™s <code>select()</code> method. This method will block until there is an event ready for one of the registered channels. Once the method returns, the thread can then process these events. Examples of events are incoming connection, data received etc.</p><h5 id="full-demo"><a href="#full-demo" class="headerlink" title="full demo"></a>full demo</h5><h6 id="Server-demo"><a href="#Server-demo" class="headerlink" title="Server  demo"></a>Server  demo</h6><pre><code class="java">package nio;import org.springframework.util.StringUtils;import java.io.Closeable;import java.io.IOException;import java.net.InetSocketAddress;import java.nio.ByteBuffer;import java.nio.channels.SelectionKey;import java.nio.channels.Selector;import java.nio.channels.ServerSocketChannel;import java.nio.channels.SocketChannel;import java.util.Iterator;/** * @author zhengyumin * @description NioæœåŠ¡ç«¯ ä½¿ç”¨selectoræ¥æ”¶æ¶ˆæ¯ * @date 2019-09-25 1:22 AM */public class NioServer implements Closeable{    private Selector selector;    private ServerSocketChannel serverSocketChannel;    private int port;    private String hostname;    public NioServer(int port) {        this.port = port;    }    public NioServer(int port, String hostname) {        this.port = port;        this.hostname = hostname;    }    public static NioServer port(int port) {        return new NioServer(port);    }    public NioServer start() {        System.out.println(&quot;starting....&quot;);        try {            startServer();            //å¼€å¯selector å¹¶ç›‘å¬            startSelector();        } catch (Exception e) {            e.printStackTrace();        }        return this;    }    @Override    public void close() {        try {            System.out.println(&quot;closing....&quot;);            selector.close();            serverSocketChannel.close();        } catch (IOException e) {            e.printStackTrace();        }    }    private void startSelector() throws IOException {        selector = Selector.open();        serverSocketChannel.register(selector, SelectionKey.OP_ACCEPT);        System.out.println(&quot;startSelector succ&quot;);        while (true) {            int readyChannels = selector.selectNow();            if (readyChannels == 0) {                continue;//                    return;            }            Iterator&lt;SelectionKey&gt; keyIterator = selector.selectedKeys().iterator();            while (keyIterator.hasNext()) {                SelectionKey key = keyIterator.next();                if (key.isAcceptable()) {                    // a connection was accepted by a ServerSocketChannel.                    connectEven(key, selector);                } else if (key.isConnectable()) {                    // a connection was established with a remote server.                    System.out.println(&quot;a connection was established with a remote server.&quot;);                } else if (key.isReadable()) {                    // a channel is ready for reading                    readData(key);                } else if (key.isWritable()) {                    // a channel is ready for writing                    System.out.println(&quot;a channel is ready for writing&quot;);                }                keyIterator.remove();            }        }    }    private void startServer() throws Exception {        //å¼€å¯æœåŠ¡å™¨        serverSocketChannel = ServerSocketChannel.open();        serverSocketChannel.socket().bind(StringUtils.isEmpty(hostname) ?                new InetSocketAddress(port) : new InetSocketAddress(hostname, port));        serverSocketChannel.configureBlocking(false);        System.out.println(&quot;startServer succ&quot;);    }    private void connectEven(SelectionKey key, Selector selector) {        try {            ServerSocketChannel server = (ServerSocketChannel) key.channel();            SocketChannel channel = server.accept();            channel.configureBlocking(false);            //è·å¾—è¿œç¨‹è¿æ¥çš„IPåœ°å€            System.out.println(&quot;å·²æœ‰è¿æ¥ï¼Œè¿æ¥çš„ipåœ°å€æ˜¯&quot; + channel.socket().getInetAddress());            channel.register(selector, SelectionKey.OP_READ);        } catch (IOException e) {            e.printStackTrace();        }    }    /**     * æ•°æ®è¯»å–å¤„ç†     *     * @param key     */    private void readData(SelectionKey key) {        SocketChannel socketChannel = (SocketChannel) key.channel();        ByteBuffer buf = ByteBuffer.allocate(1024);        try {            int readSize = socketChannel.read(buf);            if (readSize &gt; 0) {                byte[] data = buf.array();                String msg = new String(data, &quot;UTF-8&quot;).trim();                System.out.println(msg);            }        } catch (IOException e) {            e.printStackTrace();        }    }    public static void main(String[] args) {        try(NioServer nioServer =  NioServer.port(9999)) {            nioServer.start();        }catch (Exception e){            e.printStackTrace();        }    }     }</code></pre><h6 id="Client-demo"><a href="#Client-demo" class="headerlink" title="Client demo"></a>Client demo</h6><pre><code class="java">package nio;import java.io.IOException;import java.net.InetSocketAddress;import java.nio.ByteBuffer;import java.nio.channels.SocketChannel;/** * @author zhengyumin * @description nioå®¢æˆ·ç«¯demo * @date 2019-09-25 11:36 AM */public class NioClientDemo {    public static void main(String[] args) throws IOException {        SocketChannel socketChannel = SocketChannel.open();        socketChannel.connect(new InetSocketAddress(9999));        String newData = &quot;New String to write to file...&quot; + System.currentTimeMillis();        ByteBuffer buf = ByteBuffer.allocate(48);        buf.clear();        buf.put(newData.getBytes());        buf.flip();        while(buf.hasRemaining()) {            socketChannel.write(buf);        }    }}</code></pre><h4 id="Pipe-todo"><a href="#Pipe-todo" class="headerlink" title="Pipe(todo)"></a>Pipe(todo)</h4><p>â€‹    </p><h3 id="Charset-todo"><a href="#Charset-todo" class="headerlink" title="Charset(todo)"></a>Charset(todo)</h3><h3 id="File"><a href="#File" class="headerlink" title="File"></a>File</h3><h4 id="Path-Todo"><a href="#Path-Todo" class="headerlink" title="Path(Todo)"></a>Path(Todo)</h4><h4 id="Files-todo"><a href="#Files-todo" class="headerlink" title="Files(todo)"></a>Files(todo)</h4><h3 id="Java-NIO-vs-IO"><a href="#Java-NIO-vs-IO" class="headerlink" title="Java NIO vs. IO"></a>Java NIO vs. IO</h3><p>When studying both the Java NIO and IO APIâ€™s, a question quickly pops into mind:</p><p><strong>When should I use IO and when should I use NIO?</strong></p><h4 id="Main-Differences-Betwen-Java-NIO-and-IO"><a href="#Main-Differences-Betwen-Java-NIO-and-IO" class="headerlink" title="Main Differences Betwen Java NIO and IO"></a>Main Differences Betwen Java NIO and IO</h4><p>The table below summarizes the main differences between Java NIO and IO. I will get into more detail about each difference in the sections following the table.</p><table><thead><tr><th><strong>IO</strong></th><th><strong>NIO</strong></th><th>Diff</th></tr></thead><tbody><tr><td>Stream oriented</td><td>Buffer oriented</td><td>Cache</td></tr><tr><td>Blocking IO</td><td>Non blocking IO</td><td>Threads</td></tr><tr><td></td><td>Selectors</td></tr></tbody></table><h4 id="How-NIO-and-IO-Influences-Application-Design"><a href="#How-NIO-and-IO-Influences-Application-Design" class="headerlink" title="How NIO and IO Influences Application Design"></a>How NIO and IO Influences Application Design</h4><p>Whether you choose NIO or IO as your IO toolkit may impact the following aspects of your application design:</p><ol><li>The API calls to the NIO or IO classes.</li><li>The processing of data.</li><li>The number of thread used to process the data.</li></ol><h5 id="The-API-calls-to-the-NIO-or-IO-classes"><a href="#The-API-calls-to-the-NIO-or-IO-classes" class="headerlink" title="The API calls to the NIO or IO classes."></a>The API calls to the NIO or IO classes.</h5><p>Of course the API calls when using NIO look different than when using IO. This is no surprise. Rather than just read the data byte for byte from e.g. an <code>InputStream</code>, the data must first be read into a buffer, and then be processed from there.</p><h5 id="The-processing-of-data"><a href="#The-processing-of-data" class="headerlink" title="The processing of data."></a>The processing of data.</h5><table><thead><tr><th><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g7cpydvocgj309i092t8p.jpg" alt="Java IO: Reading data from a blocking stream."></th></tr></thead><tbody><tr><td><strong>Java IO: Reading data from a blocking stream.</strong></td></tr></tbody></table><table><thead><tr><th><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g7cpybzkgvj30bp09074b.jpg" alt="Java NIO: Reading data from a channel until all needed data is in buffer."></th></tr></thead><tbody><tr><td><strong>Java NIO: Reading data from a channel until all needed data is in buffer.</strong></td></tr></tbody></table><h4 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h4><p>NIO allows you to manage multiple channels (network connections or files) using only a single (or few) threads, but the cost is that parsing the data might be somewhat more complicated than when reading data from a blocking stream.</p><p>If you need to manage thousands of open connections simultanously, which each only send a little data, for instance a chat server, implementing the server in NIO is probably an advantage. Similarly, if you need to keep a lot of open connections to other computers, e.g. in a P2P network, using a single thread to manage all of your outbound connections might be an advantage. This one thread, multiple connections design is illustrated in this diagram:</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g7cpycfkpej3085070jrh.jpg" alt="Java NIO: A single thread managing multiple connections."></p><p>â€‹                            <strong>Java NIO: A single thread managing multiple connections.</strong></p><p>If you have fewer connections with very high bandwidth, sending a lot of data at a time, perhaps a classic IO server implementation might be the best fit. This diagram illustrates a classic IO server design:</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g7couh9zd6j30dw07n0sx.jpg" alt="Java IO: A classic IO server design - one connection handled by one thread."></p><p>â€‹                       <strong>Java IO: A classic IO server design - one connection handled by one thread.</strong></p>]]></content>
      
      
      <categories>
          
          <category> jdk </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jdk </tag>
            
            <tag> packages </tag>
            
            <tag> nio </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JDK_Packages_java_io</title>
      <link href="/2019/09/23/JDK-Packages-java-io/"/>
      <url>/2019/09/23/JDK-Packages-java-io/</url>
      
        <content type="html"><![CDATA[<blockquote><p>è‹¥é€¢æ–°é›ªåˆéœ æ»¡æœˆå½“ç©º ä¸‹é¢æµè½¬ç€äº®é“¶ è€Œä½ å¸¦ç¬‘åœ°æƒ³æˆ‘èµ°æ¥ æœˆè‰²å’Œé›ªè‰²ä¹‹é—´ ä½ æ˜¯ç¬¬ä¸‰ç§ç»è‰²    â€”ä½™å…‰ä¸­ã€Šç»è‰²ã€‹</p></blockquote><p><a href="https://docs.oracle.com/javase/8/docs/api/java/io/package-summary.html" target="_blank" rel="noopener">https://docs.oracle.com/javase/8/docs/api/java/io/package-summary.html</a></p><p>å®˜æ–¹ä»‹ç»</p><pre><code>Provides for system input and output through data streams, serialization and the file system.</code></pre><p>é€šè¿‡æ•°æ®æµã€åºåˆ—åŒ–å’Œæ–‡ä»¶ç³»ç»Ÿæä¾›ç³»ç»Ÿè¾“å…¥å’Œè¾“å‡ºã€‚</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>â€‹    åˆ›å»ºä¸€ä¸ªå¥½çš„I/Oç³»ç»Ÿä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹ï¼Œéš¾åº¦ä¼¼ä¹æ¥è‡ªäºéœ€è¦è¦†ç›–æ‰€æœ‰çš„å¯èƒ½æ€§ã€‚</p><p>å› ä¸ºä¸ä»…å­˜åœ¨å„ç§I/Oæºç«¯ï¼ˆæ–‡ä»¶ã€æ§åˆ¶å°ã€ç½‘ç»œè¿æ¥ç­‰ï¼‰ï¼Œè¿˜éœ€è¦ä»¥å¤šç§ä¸åŒçš„æ–¹å¼ä¸è¿™äº›I/Oæºç«¯ï¼ˆé¡ºåºã€å›é€€ã€éšæœºã€ç¼“å†²ã€äºŒè¿›åˆ¶ã€æŒ‰å­—ç¬¦ã€æŒ‰è¡Œã€æŒ‰å­—ï¼‰è¿›è¡Œé€šä¿¡ã€‚Javaç±»åº“çš„è®¾è®¡è€…é€šè¿‡åˆ›å»ºå¤§é‡çš„ç±»æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p>ä»ä¸‹é¢ä¸‰ä¸ªä¸»é¢˜æ¥è®¨è®ºè¿™ä¸ªè¯é¢˜</p><ul><li>data streams</li><li>serialization</li><li>File system</li></ul><h2 id="æ¥å£æ€»è§ˆ"><a href="#æ¥å£æ€»è§ˆ" class="headerlink" title="æ¥å£æ€»è§ˆ"></a>æ¥å£æ€»è§ˆ</h2><table><thead><tr><th style="text-align:left">Interface</th><th style="text-align:left">Description</th></tr></thead><tbody><tr><td style="text-align:left"><a href="https://docs.oracle.com/javase/8/docs/api/java/io/Closeable.html" target="_blank" rel="noopener">Closeable</a></td><td style="text-align:left">A <code>Closeable</code> is a source or destination of data that can be closed.</td></tr><tr><td style="text-align:left"><a href="https://docs.oracle.com/javase/8/docs/api/java/io/DataInput.html" target="_blank" rel="noopener">DataInput</a></td><td style="text-align:left">The <code>DataInput</code> interface provides for reading bytes from a binary stream and reconstructing from them data in any of the Java primitive types.</td></tr><tr><td style="text-align:left"><a href="https://docs.oracle.com/javase/8/docs/api/java/io/DataOutput.html" target="_blank" rel="noopener">DataOutput</a></td><td style="text-align:left">The <code>DataOutput</code> interface provides for converting data from any of the Java primitive types to a series of bytes and writing these bytes to a binary stream.</td></tr><tr><td style="text-align:left"><a href="https://docs.oracle.com/javase/8/docs/api/java/io/Externalizable.html" target="_blank" rel="noopener">Externalizable</a></td><td style="text-align:left">Only the identity of the class of an Externalizable instance is written in the serialization stream and it is the responsibility of the class to save and restore the contents of its instances.</td></tr><tr><td style="text-align:left"><a href="https://docs.oracle.com/javase/8/docs/api/java/io/FileFilter.html" target="_blank" rel="noopener">FileFilter</a></td><td style="text-align:left">A filter for abstract pathnames.</td></tr><tr><td style="text-align:left"><a href="https://docs.oracle.com/javase/8/docs/api/java/io/FilenameFilter.html" target="_blank" rel="noopener">FilenameFilter</a></td><td style="text-align:left">Instances of classes that implement this interface are used to filter filenames.</td></tr><tr><td style="text-align:left"><a href="https://docs.oracle.com/javase/8/docs/api/java/io/Flushable.html" target="_blank" rel="noopener">Flushable</a></td><td style="text-align:left">A <code>Flushable</code> is a destination of data that can be flushed.</td></tr><tr><td style="text-align:left"><a href="https://docs.oracle.com/javase/8/docs/api/java/io/ObjectInput.html" target="_blank" rel="noopener">ObjectInput</a></td><td style="text-align:left">ObjectInput extends the DataInput interface to include the reading of objects.</td></tr><tr><td style="text-align:left"><a href="https://docs.oracle.com/javase/8/docs/api/java/io/ObjectInputValidation.html" target="_blank" rel="noopener">ObjectInputValidation</a></td><td style="text-align:left">Callback interface to allow validation of objects within a graph.</td></tr><tr><td style="text-align:left"><a href="https://docs.oracle.com/javase/8/docs/api/java/io/ObjectOutput.html" target="_blank" rel="noopener">ObjectOutput</a></td><td style="text-align:left">ObjectOutput extends the DataOutput interface to include writing of objects.</td></tr><tr><td style="text-align:left"><a href="https://docs.oracle.com/javase/8/docs/api/java/io/ObjectStreamConstants.html" target="_blank" rel="noopener">ObjectStreamConstants</a></td><td style="text-align:left">Constants written into the Object Serialization Stream.</td></tr><tr><td style="text-align:left"><a href="https://docs.oracle.com/javase/8/docs/api/java/io/Serializable.html" target="_blank" rel="noopener">Serializable</a></td><td style="text-align:left">Serializability of a class is enabled by the class implementing the java.io.Serializable interface.</td></tr></tbody></table><h2 id="data-streams"><a href="#data-streams" class="headerlink" title="data streams"></a>data streams</h2><p>æ•´ä½“ç»“æ„</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g79ikws9ewj30kx0mego6.jpg" alt="I/OÃ¦Â•Â´Ã¤Â½Â“Ã§Â»Â“Ã¦ÂÂ„Ã¥Â›Â¾"></p><h3 id="æ“ä½œç±»å‹"><a href="#æ“ä½œç±»å‹" class="headerlink" title="æ“ä½œç±»å‹"></a>æ“ä½œç±»å‹</h3><ul><li>æ–‡ä»¶ï¼ˆfileï¼‰ï¼šFileInputStreamã€FileOutputStreamã€FileReaderã€FileWriter</li><li>æ•°ç»„ï¼ˆ[]ï¼‰ï¼š<ul><li>2.1ã€å­—èŠ‚æ•°ç»„ï¼ˆbyte[]ï¼‰ï¼šByteArrayInputStreamã€ByteArrayOutputStream</li><li>2.2ã€å­—ç¬¦æ•°ç»„ï¼ˆchar[]ï¼‰ï¼šCharArrayReaderã€CharArrayWriter</li></ul></li><li>ç®¡é“æ“ä½œï¼šPipedInputStreamã€PipedOutputStreamã€PipedReaderã€PipedWriter</li><li>åŸºæœ¬æ•°æ®ç±»å‹ï¼šDataInputStreamã€DataOutputStream</li><li>ç¼“å†²æ“ä½œï¼šBufferedInputStreamã€BufferedOutputStreamã€BufferedReaderã€BufferedWriter</li><li>æ‰“å°ï¼šPrintStreamã€PrintWriter</li><li>å¯¹è±¡åºåˆ—åŒ–ååºåˆ—åŒ–ï¼šObjectInputStreamã€ObjectOutputStream</li><li>è½¬æ¢ï¼šInputStreamReaderã€OutputStreWriter</li><li><del>å­—ç¬¦ä¸²ï¼ˆStringï¼‰</del><strong>Java8ä¸­å·²åºŸå¼ƒ</strong>ï¼š<del>StringBufferInputStreamã€StringBufferOutputStreamã€StringReaderã€StringWriter</del></li></ul><h3 id="ä¼ è¾“ç±»å‹"><a href="#ä¼ è¾“ç±»å‹" class="headerlink" title="ä¼ è¾“ç±»å‹"></a>ä¼ è¾“ç±»å‹</h3><h4 id="å­—èŠ‚æµ-byte"><a href="#å­—èŠ‚æµ-byte" class="headerlink" title="å­—èŠ‚æµ  byte"></a>å­—èŠ‚æµ  byte</h4><p>InputStreamã€OutputStream</p><h5 id="InputStream-ç±»"><a href="#InputStream-ç±»" class="headerlink" title="InputStream ç±»"></a><strong>InputStream ç±»</strong></h5><h6 id="inputStreamæ–¹æ³•"><a href="#inputStreamæ–¹æ³•" class="headerlink" title="inputStreamæ–¹æ³•"></a>inputStreamæ–¹æ³•</h6><table><thead><tr><th style="text-align:left">æ–¹æ³•</th><th>æ–¹æ³•ä»‹ç»</th></tr></thead><tbody><tr><td style="text-align:left">public abstract int read()</td><td>è¯»å–æ•°æ®</td></tr><tr><td style="text-align:left">public int read(byte b[])</td><td>å°†è¯»å–åˆ°çš„æ•°æ®æ”¾åœ¨ byte æ•°ç»„ä¸­ï¼Œè¯¥æ–¹æ³•å®é™…ä¸Šæ˜¯æ ¹æ®ä¸‹é¢çš„æ–¹æ³•å®ç°çš„ï¼Œoff ä¸º 0ï¼Œlen ä¸ºæ•°ç»„çš„é•¿åº¦</td></tr><tr><td style="text-align:left">public int read(byte b[], int off, int len)</td><td>ä»ç¬¬ off ä½ç½®è¯»å– len é•¿åº¦å­—èŠ‚çš„æ•°æ®æ”¾åˆ° byte æ•°ç»„ä¸­ï¼Œæµæ˜¯ä»¥ -1 æ¥åˆ¤æ–­æ˜¯å¦è¯»å–ç»“æŸçš„ï¼ˆæ³¨æ„è¿™é‡Œè¯»å–çš„è™½ç„¶æ˜¯ä¸€ä¸ªå­—èŠ‚ï¼Œä½†æ˜¯è¿”å›çš„å´æ˜¯ int ç±»å‹ 4 ä¸ªå­—èŠ‚ï¼Œè¿™é‡Œå½“ç„¶æ˜¯æœ‰åŸå› ï¼Œè¿™é‡Œå°±ä¸å†ç»†è¯´äº†ï¼Œæ¨èè¿™ç¯‡æ–‡ç« ï¼Œ<a href="https://blog.csdn.net/congwiny/article/details/18922847" target="_blank" rel="noopener">é“¾æ¥</a>ï¼‰</td></tr><tr><td style="text-align:left">public long skip(long n)</td><td>è·³è¿‡æŒ‡å®šä¸ªæ•°çš„å­—èŠ‚ä¸è¯»å–ï¼Œæƒ³æƒ³çœ‹ç”µå½±è·³è¿‡ç‰‡å¤´ç‰‡å°¾</td></tr><tr><td style="text-align:left">public int available()</td><td>è¿”å›å¯è¯»çš„å­—èŠ‚æ•°é‡</td></tr><tr><td style="text-align:left">public void close()</td><td>è¯»å–å®Œï¼Œå…³é—­æµï¼Œé‡Šæ”¾èµ„æº</td></tr><tr><td style="text-align:left">public synchronized void mark(int readlimit)</td><td>æ ‡è®°è¯»å–ä½ç½®ï¼Œä¸‹æ¬¡è¿˜å¯ä»¥ä»è¿™é‡Œå¼€å§‹è¯»å–ï¼Œä½¿ç”¨å‰è¦çœ‹å½“å‰æµæ˜¯å¦æ”¯æŒï¼Œå¯ä»¥ä½¿ç”¨ markSupport() æ–¹æ³•åˆ¤æ–­</td></tr><tr><td style="text-align:left">public synchronized void reset()</td><td>é‡ç½®è¯»å–ä½ç½®ä¸ºä¸Šæ¬¡ mark æ ‡è®°çš„ä½ç½®</td></tr><tr><td style="text-align:left">public boolean markSupported()</td><td>åˆ¤æ–­å½“å‰æµæ˜¯å¦æ”¯æŒæ ‡è®°æµï¼Œå’Œä¸Šé¢ä¸¤ä¸ªæ–¹æ³•é…å¥—ä½¿ç”¨</td></tr></tbody></table><h6 id="inputStream-ä½“ç³»"><a href="#inputStream-ä½“ç³»" class="headerlink" title="inputStream ä½“ç³»"></a>inputStream ä½“ç³»</h6><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g79ikx5gccj31r00p4n0m.jpg" alt="image-20190922173230599"></p><h6 id="æºç å®ç°"><a href="#æºç å®ç°" class="headerlink" title="æºç å®ç°"></a>æºç å®ç°</h6><p>InputStream æŠ½è±¡ç±»,æ‰€æœ‰å­ç±»å®ç°å¦‚ä¸‹</p><ul><li>ByteArrayInputStream  å­—èŠ‚æ•°ç»„è¾“å…¥æµ</li><li>PipedInputStream ç®¡é“æµ ç”¨äºçº¿ç¨‹é—´é€šä¿¡</li><li>FileInputStream æ–‡ä»¶ç³»ç»ŸIO</li><li>FilterInputStream  è£…é¥°å™¨æ¨¡å¼<ul><li>BufferedInputStream   å¸¦ç¼“å†²æ± çš„è¾“å…¥æµ</li><li>DataInputStream  åŸºæœ¬æ•°æ®ç±»å‹çš„è¾“å…¥æµ</li><li>PushbackInputStream   </li></ul></li><li>ObjectInputStream</li></ul><h5 id="OutputStream-ç±»"><a href="#OutputStream-ç±»" class="headerlink" title="OutputStream ç±»"></a><strong>OutputStream ç±»</strong></h5><p>PrintStream -&gt;System.out </p><table><thead><tr><th>æ–¹æ³•</th><th>æ–¹æ³•ä»‹ç»</th></tr></thead><tbody><tr><td>public abstract void write(int b)</td><td>å†™å…¥ä¸€ä¸ªå­—èŠ‚ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œçš„å‚æ•°æ˜¯ä¸€ä¸ª int ç±»å‹ï¼Œå¯¹åº”ä¸Šé¢çš„è¯»æ–¹æ³•ï¼Œint ç±»å‹çš„ 32 ä½ï¼Œåªæœ‰ä½ 8 ä½æ‰å†™å…¥ï¼Œé«˜ 24 ä½å°†èˆå¼ƒã€‚</td></tr><tr><td>public void write(byte b[])</td><td>å°†æ•°ç»„ä¸­çš„æ‰€æœ‰å­—èŠ‚å†™å…¥ï¼Œå’Œä¸Šé¢å¯¹åº”çš„ read() æ–¹æ³•ç±»ä¼¼ï¼Œå®é™…è°ƒç”¨çš„ä¹Ÿæ˜¯ä¸‹é¢çš„æ–¹æ³•ã€‚</td></tr><tr><td>public void write(byte b[], int off, int len)</td><td>å°† byte æ•°ç»„ä» off ä½ç½®å¼€å§‹ï¼Œlen é•¿åº¦çš„å­—èŠ‚å†™å…¥</td></tr><tr><td>public void flush()</td><td>å¼ºåˆ¶åˆ·æ–°ï¼Œå°†ç¼“å†²ä¸­çš„æ•°æ®å†™å…¥</td></tr><tr><td>public void close()</td><td>å…³é—­è¾“å‡ºæµï¼Œæµè¢«å…³é—­åå°±ä¸èƒ½å†è¾“å‡ºæ•°æ®äº†</td></tr></tbody></table><h4 id="å­—ç¬¦æµ-char"><a href="#å­—ç¬¦æµ-char" class="headerlink" title="å­—ç¬¦æµ  char"></a>å­—ç¬¦æµ  char</h4><p>åŒºåˆ«</p><p>1.å®ç°æ¥å£</p><p>2.ä¸ºä»€ä¹ˆæœ‰lock </p><p>å…¶ä¸­</p><p>InputStreamReaderï¼Œå­—èŠ‚æµé€šå‘å­—ç¬¦æµçš„æ¡¥æ¢ï¼šå®ƒä½¿ç”¨æŒ‡å®šçš„charset(nio)è¯»å–å­—èŠ‚å¹¶å°†å…¶è§£ç ä¸ºå­—ç¬¦ã€‚åŠŸèƒ½æ˜¯ä¾èµ–äºStreamDecoderå®Œæˆçš„ã€‚</p><p>Readerã€Writer</p><h5 id="Reader-ç±»"><a href="#Reader-ç±»" class="headerlink" title="Reader ç±»"></a><strong>Reader ç±»</strong></h5><table><thead><tr><th>æ–¹æ³•</th><th>æ–¹æ³•ä»‹ç»</th></tr></thead><tbody><tr><td>public int read(java.nio.CharBuffer target)</td><td>è¯»å–å­—èŠ‚åˆ°å­—ç¬¦ç¼“å­˜ä¸­</td></tr><tr><td>public int read()</td><td>è¯»å–å•ä¸ªå­—ç¬¦</td></tr><tr><td>public int read(char cbuf[])</td><td>è¯»å–å­—ç¬¦åˆ°æŒ‡å®šçš„ char æ•°ç»„ä¸­</td></tr><tr><td>abstract public int read(char cbuf[], int off, int len)</td><td>ä» off ä½ç½®è¯»å– len é•¿åº¦çš„å­—ç¬¦åˆ° char æ•°ç»„ä¸­</td></tr><tr><td>public long skip(long n)</td><td>è·³è¿‡æŒ‡å®šé•¿åº¦çš„å­—ç¬¦æ•°é‡</td></tr><tr><td>public boolean ready()</td><td>å’Œä¸Šé¢çš„ available() æ–¹æ³•ç±»ä¼¼</td></tr><tr><td>public boolean markSupported()</td><td>åˆ¤æ–­å½“å‰æµæ˜¯å¦æ”¯æŒæ ‡è®°æµ</td></tr><tr><td>public void mark(int readAheadLimit)</td><td>æ ‡è®°è¯»å–ä½ç½®ï¼Œä¸‹æ¬¡è¿˜å¯ä»¥ä»è¿™é‡Œå¼€å§‹è¯»å–ï¼Œä½¿ç”¨å‰è¦çœ‹å½“å‰æµæ˜¯å¦æ”¯æŒï¼Œå¯ä»¥ä½¿ç”¨ markSupport() æ–¹æ³•åˆ¤æ–­</td></tr><tr><td>public void reset()</td><td>é‡ç½®è¯»å–ä½ç½®ä¸ºä¸Šæ¬¡ mark æ ‡è®°çš„ä½ç½®</td></tr><tr><td>abstract public void close()</td><td>å…³é—­æµé‡Šæ”¾ç›¸å…³èµ„æº</td></tr></tbody></table><h5 id="Writer-ç±»"><a href="#Writer-ç±»" class="headerlink" title="Writer ç±»"></a><strong>Writer ç±»</strong></h5><table><thead><tr><th>æ–¹æ³•</th><th>æ–¹æ³•ä»‹ç»</th></tr></thead><tbody><tr><td>public void write(int c)</td><td>å†™å…¥ä¸€ä¸ªå­—ç¬¦</td></tr><tr><td>public void write(char cbuf[])</td><td>å†™å…¥ä¸€ä¸ªå­—ç¬¦æ•°ç»„</td></tr><tr><td>abstract public void write(char cbuf[], int off, int len)</td><td>ä»å­—ç¬¦æ•°ç»„çš„ off ä½ç½®å†™å…¥ len æ•°é‡çš„å­—ç¬¦</td></tr><tr><td>public void write(String str)</td><td>å†™å…¥ä¸€ä¸ªå­—ç¬¦ä¸²</td></tr><tr><td>public void write(String str, int off, int len)</td><td>ä»å­—ç¬¦ä¸²çš„ off ä½ç½®å†™å…¥ len æ•°é‡çš„å­—ç¬¦</td></tr><tr><td>public Writer append(CharSequence csq)</td><td>è¿½åŠ å¸å…¥ä¸€ä¸ªå­—ç¬¦åºåˆ—</td></tr><tr><td>public Writer append(CharSequence csq, int start, int end)</td><td>è¿½åŠ å†™å…¥ä¸€ä¸ªå­—ç¬¦åºåˆ—çš„ä¸€éƒ¨åˆ†ï¼Œä» start ä½ç½®å¼€å§‹ï¼Œend ä½ç½®ç»“æŸ</td></tr><tr><td>public Writer append(char c)</td><td>è¿½åŠ å†™å…¥ä¸€ä¸ª 16 ä½çš„å­—ç¬¦</td></tr><tr><td>abstract public void flush()</td><td>å¼ºåˆ¶åˆ·æ–°ï¼Œå°†ç¼“å†²ä¸­çš„æ•°æ®å†™å…¥</td></tr><tr><td>abstract public void close()</td><td>å…³é—­è¾“å‡ºæµï¼Œæµè¢«å…³é—­åå°±ä¸èƒ½å†è¾“å‡ºæ•°æ®äº†</td></tr></tbody></table><p>å‚è€ƒé“¾æ¥:</p><blockquote><p>@link: <a href="https://blog.csdn.net/panweiwei1994/article/details/78046000" target="_blank" rel="noopener">https://blog.csdn.net/panweiwei1994/article/details/78046000</a></p><p>@link <a href="https://www.jianshu.com/p/715659e4775f" target="_blank" rel="noopener">https://www.jianshu.com/p/715659e4775f</a></p></blockquote><h2 id="serialization"><a href="#serialization" class="headerlink" title="serialization"></a>serialization</h2><p>â€‹    Javaåºåˆ—åŒ–æ˜¯æŒ‡æŠŠJavaå¯¹è±¡ä¿å­˜ä¸ºäºŒè¿›åˆ¶å­—èŠ‚ç çš„è¿‡ç¨‹ï¼ŒJavaååºåˆ—åŒ–æ˜¯æŒ‡æŠŠäºŒè¿›åˆ¶ç é‡æ–°è½¬æ¢æˆJavaå¯¹è±¡çš„è¿‡ç¨‹ã€‚</p><p>ä¸ºä»€ä¹ˆéœ€è¦</p><ul><li>æŒä¹…åŒ–</li><li>ç½‘ç»œä¼ è¾“</li></ul><h3 id="Serializable"><a href="#Serializable" class="headerlink" title="Serializable"></a>Serializable</h3><p><a href="https://docs.oracle.com/javase/8/docs/api/java/io/Serializable.html" target="_blank" rel="noopener">https://docs.oracle.com/javase/8/docs/api/java/io/Serializable.html</a></p><p>Serializability of a class is enabled by the class implementing the java.io.Serializable interface.</p><p>é€šè¿‡å®ç°æ¥å£,å¼€å¯å¯åºåˆ—åŒ–</p><h4 id="serialVersionUID"><a href="#serialVersionUID" class="headerlink" title="serialVersionUID"></a>serialVersionUID</h4><p>å¦‚æœå¯åºåˆ—åŒ–çš„ç±»æœªæ˜ç¡®å£°æ˜serialVersionUIDï¼Œåˆ™åºåˆ—åŒ–è¿è¡Œæ—¶å°†æ ¹æ®è¯¥ç±»çš„å„ä¸ªæ–¹é¢ï¼Œä¸ºè¯¥ç±»è®¡ç®—é»˜è®¤çš„serialVersionUIDå€¼ï¼Œå¦‚Javaï¼ˆTMï¼‰å¯¹è±¡åºåˆ—åŒ–è§„èŒƒä¸­æ‰€è¿°ã€‚</p><p>ä½†æ˜¯ï¼Œ<em>å¼ºçƒˆå»ºè®®</em>æ‰€æœ‰å¯åºåˆ—åŒ–çš„ç±»æ˜¾å¼å£°æ˜serialVersionUIDå€¼ï¼Œå› ä¸ºé»˜è®¤çš„serialVersionUIDè®¡ç®—å¯¹ç±»è¯¦ç»†ä¿¡æ¯é«˜åº¦æ•æ„Ÿï¼Œç±»è¯¦ç»†ä¿¡æ¯å¯èƒ½ä¼šå› ç¼–è¯‘å™¨çš„å®ç°è€Œæœ‰æ‰€ä¸åŒï¼Œå› æ­¤å¯èƒ½å¯¼è‡´æ„å¤–æƒ…å†µ <code>InvalidClassException</code>åœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­ã€‚å› æ­¤ï¼Œä¸ºäº†ä¿è¯ä¸åŒJavaç¼–è¯‘å™¨å®ç°ä¹‹é—´çš„serialVersionUIDå€¼ä¸€è‡´ï¼Œå¯åºåˆ—åŒ–çš„ç±»å¿…é¡»å£°æ˜ä¸€ä¸ªæ˜¾å¼çš„serialVersionUIDå€¼ã€‚</p><p>è¿˜å¼ºçƒˆå»ºè®®æ˜¾å¼serialVersionUIDå£°æ˜<code>private</code>åœ¨å¯èƒ½çš„æƒ…å†µä¸‹ä½¿ç”¨ä¿®é¥°ç¬¦ï¼Œå› ä¸ºæ­¤ç±»å£°æ˜ä»…é€‚ç”¨äºç«‹å³å£°æ˜çš„ç±»-serialVersionUIDå­—æ®µä½œä¸ºç»§æ‰¿æˆå‘˜ä¸èµ·ä½œç”¨ã€‚æ•°ç»„ç±»æ— æ³•å£°æ˜æ˜¾å¼çš„serialVersionUIDï¼Œå› æ­¤å®ƒä»¬å§‹ç»ˆå…·æœ‰é»˜è®¤çš„è®¡ç®—å€¼ï¼Œä½†æ˜¯å¯¹äºæ•°ç»„ç±»ï¼Œæ— éœ€åŒ¹é…serialVersionUIDå€¼ã€‚</p><h3 id="ObjectStreamClass-åºåˆ—åŒ–æè¿°ç¬¦"><a href="#ObjectStreamClass-åºåˆ—åŒ–æè¿°ç¬¦" class="headerlink" title="ObjectStreamClass (åºåˆ—åŒ–æè¿°ç¬¦)"></a>ObjectStreamClass (åºåˆ—åŒ–æè¿°ç¬¦)</h3><p>å®˜æ–¹æ–‡æ¡£å¯¹è¿™ä¸ªç±»çš„ä»‹ç»å¦‚ä¸‹</p><p><a href="https://docs.oracle.com/javase/8/docs/api/java/io/ObjectStreamClass.html" target="_blank" rel="noopener">https://docs.oracle.com/javase/8/docs/api/java/io/ObjectStreamClass.html</a></p><p>Serializationâ€™s descriptor for classes. It contains the name and serialVersionUID of the class. The ObjectStreamClass for a specific class loaded in this Java VM can be found/created using the lookup method.</p><p>å¯ä»¥çœ‹åˆ°ObjectStreamClassè¿™ä¸ªæ˜¯ç±»çš„åºåˆ—åŒ–æè¿°ç¬¦ï¼Œè¿™ä¸ªç±»å¯ä»¥æè¿°éœ€è¦è¢«åºåˆ—åŒ–çš„ç±»çš„å…ƒæ•°æ®ï¼ŒåŒ…æ‹¬è¢«åºåˆ—åŒ–çš„ç±»çš„åå­—ä»¥åŠåºåˆ—å·ã€‚å¯ä»¥é€šè¿‡lookup()æ–¹æ³•æ¥æŸ¥æ‰¾/åˆ›å»ºåœ¨è¿™ä¸ªJVMä¸­åŠ è½½çš„ç‰¹å®šçš„ObjectStreamClasså¯¹è±¡</p><h3 id="ObjectOutputStream-åºåˆ—åŒ–"><a href="#ObjectOutputStream-åºåˆ—åŒ–" class="headerlink" title="ObjectOutputStream (åºåˆ—åŒ–)"></a>ObjectOutputStream (åºåˆ—åŒ–)</h3><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g79fkji2phj313o0iiq4m.jpg" alt="image-20190923142345325" style="zoom:50%;"></p><h4 id="ObjectOutput"><a href="#ObjectOutput" class="headerlink" title="ObjectOutput"></a>ObjectOutput</h4><p>â€‹    DataOutput includes methods for output of primitive types, ObjectOutput extends that interface to include objects, arrays, and Strings.</p><pre><code class="java">public interface ObjectOutput extends DataOutput, AutoCloseable {    /**     * Write an object to the underlying storage or stream.  The     * class that implements this interface defines how the object is     * written.     *     * @param obj the object to be written     * @exception IOException Any of the usual Input/Output related exceptions.     */    public void writeObject(Object obj)      throws IOException;    /**     * Writes a byte. This method will block until the byte is actually     * written.     * @param b the byte     * @exception IOException If an I/O error has occurred.     */    public void write(int b) throws IOException;    /**     * Writes an array of bytes. This method will block until the bytes     * are actually written.     * @param b the data to be written     * @exception IOException If an I/O error has occurred.     */    public void write(byte b[]) throws IOException;    /**     * Writes a sub array of bytes.     * @param b the data to be written     * @param off       the start offset in the data     * @param len       the number of bytes that are written     * @exception IOException If an I/O error has occurred.     */    public void write(byte b[], int off, int len) throws IOException;    /**     * Flushes the stream. This will write any buffered     * output bytes.     * @exception IOException If an I/O error has occurred.     */    public void flush() throws IOException;    /**     * Closes the stream. This method must be called     * to release any resources associated with the     * stream.     * @exception IOException If an I/O error has occurred.     */    public void close() throws IOException;}</code></pre><h4 id="ObjectStreamConstants"><a href="#ObjectStreamConstants" class="headerlink" title="ObjectStreamConstants"></a>ObjectStreamConstants</h4><p>â€‹    Constants written into the Object Serialization Stream.</p><p>æ›´å¤šç»†èŠ‚ <a href="https://docs.oracle.com/javase/8/docs/api/java/io/ObjectStreamConstants.html" target="_blank" rel="noopener">https://docs.oracle.com/javase/8/docs/api/java/io/ObjectStreamConstants.html</a></p><h4 id="ObjectOutputStream"><a href="#ObjectOutputStream" class="headerlink" title="ObjectOutputStream"></a>ObjectOutputStream</h4><h5 id="æ„é€ å‡½æ•°"><a href="#æ„é€ å‡½æ•°" class="headerlink" title="æ„é€ å‡½æ•°"></a>æ„é€ å‡½æ•°</h5><pre><code>public class ObjectOutputStream    extends OutputStream implements ObjectOutput, ObjectStreamConstants{        public ObjectOutputStream(OutputStream out) throws IOException {        verifySubclass();        bout = new BlockDataOutputStream(out);        handles = new HandleTable(10, (float) 3.00);        subs = new ReplaceTable(10, (float) 3.00);        enableOverride = false;        writeStreamHeader();        bout.setBlockDataMode(true);        if (extendedDebugInfo) {            debugInfoStack = new DebugTraceInfoStack();        } else {            debugInfoStack = null;        }    }    ...}</code></pre><p>æ„é€ å‡½æ•°ä¸­é¦–å…ˆä¼šæŠŠboutå¯¹ç»‘å®šåˆ°åº•å±‚çš„å­—èŠ‚æ•°æ®å®¹å™¨ï¼Œæ¥ç€ä¼šè°ƒç”¨writeStreamHeader()æ–¹æ³•</p><p>,ä¼šå¾€åº•å±‚å­—èŠ‚å®¹å™¨ä¸­å†™å…¥è¡¨ç¤ºåºåˆ—åŒ–çš„Magic Numberä»¥åŠç‰ˆæœ¬å·</p><h5 id="writeObject"><a href="#writeObject" class="headerlink" title="writeObject"></a>writeObject</h5><pre><code class="java">      public final void writeObject(Object obj) throws IOException {        if (enableOverride) {            writeObjectOverride(obj);            return;        }        try {            writeObject0(obj, false);        } catch (IOException ex) {            if (depth == 0) {                writeFatalException(ex);            }            throw ex;        }    }/** * Underlying writeObject/writeUnshared implementation. */private void writeObject0(Object obj, boolean unshared)    throws IOException{    boolean oldMode = bout.setBlockDataMode(false);    depth++;    try {        // handle previously written and non-replaceable objects        int h;        if ((obj = subs.lookup(obj)) == null) {            writeNull();            return;        } else if (!unshared &amp;&amp; (h = handles.lookup(obj)) != -1) {            writeHandle(h);            return;        } else if (obj instanceof Class) {            writeClass((Class) obj, unshared);            return;        } else if (obj instanceof ObjectStreamClass) {            writeClassDesc((ObjectStreamClass) obj, unshared);            return;        }        // check for replacement object        Object orig = obj;        Class&lt;?&gt; cl = obj.getClass();        ObjectStreamClass desc;        for (;;) {            // REMIND: skip this check for strings/arrays?            Class&lt;?&gt; repCl;            desc = ObjectStreamClass.lookup(cl, true);            if (!desc.hasWriteReplaceMethod() ||                (obj = desc.invokeWriteReplace(obj)) == null ||                (repCl = obj.getClass()) == cl)            {                break;            }            cl = repCl;        }        if (enableReplace) {            Object rep = replaceObject(obj);            if (rep != obj &amp;&amp; rep != null) {                cl = rep.getClass();                desc = ObjectStreamClass.lookup(cl, true);            }            obj = rep;        }        // if object replaced, run through original checks a second time        if (obj != orig) {            subs.assign(orig, obj);            if (obj == null) {                writeNull();                return;            } else if (!unshared &amp;&amp; (h = handles.lookup(obj)) != -1) {                writeHandle(h);                return;            } else if (obj instanceof Class) {                writeClass((Class) obj, unshared);                return;            } else if (obj instanceof ObjectStreamClass) {                writeClassDesc((ObjectStreamClass) obj, unshared);                return;            }        }        // remaining cases        if (obj instanceof String) {            writeString((String) obj, unshared);        } else if (cl.isArray()) {            writeArray(obj, desc, unshared);        } else if (obj instanceof Enum) {            writeEnum((Enum&lt;?&gt;) obj, desc, unshared);        } else if (obj instanceof Serializable) {            writeOrdinaryObject(obj, desc, unshared);        } else {            if (extendedDebugInfo) {                throw new NotSerializableException(                    cl.getName() + &quot;\n&quot; + debugInfoStack.toString());            } else {                throw new NotSerializableException(cl.getName());            }        }    } finally {        depth--;        bout.setBlockDataMode(oldMode);    }}</code></pre><p>  è¿™ä¸ªæ–¹æ³•ä¸»è¦å°±æ˜¯ åˆ›å»ºæè¿°clçš„ObjectStreamClasså¯¹è±¡,ç„¶åæ ¹æ®æ˜¯å¦å®ç°æ¥å£è°ƒç”¨writeOrdinaryObjectæ–¹æ³•</p><h5 id="writeOrdinaryObject"><a href="#writeOrdinaryObject" class="headerlink" title="writeOrdinaryObject"></a>writeOrdinaryObject</h5><pre><code class="java">/** * Writes representation of a &quot;ordinary&quot; (i.e., not a String, Class, * ObjectStreamClass, array, or enum constant) serializable object to the * stream. */private void writeOrdinaryObject(Object obj,                                 ObjectStreamClass desc,                                 boolean unshared)    throws IOException{    if (extendedDebugInfo) {        debugInfoStack.push(            (depth == 1 ? &quot;root &quot; : &quot;&quot;) + &quot;object (class \&quot;&quot; +            obj.getClass().getName() + &quot;\&quot;, &quot; + obj.toString() + &quot;)&quot;);    }    try {        desc.checkSerialize();       // å†™å…¥Objectæ ‡å¿—ä½        bout.writeByte(TC_OBJECT);        // å†™å…¥ç±»å…ƒæ•°æ®        writeClassDesc(desc, false);        handles.assign(unshared ? null : obj);        if (desc.isExternalizable() &amp;&amp; !desc.isProxy()) {            writeExternalData((Externalizable) obj);        } else {           // å†™å…¥è¢«åºåˆ—åŒ–çš„å¯¹è±¡çš„å®ä¾‹æ•°æ®            writeSerialData(obj, desc);        }    } finally {        if (extendedDebugInfo) {            debugInfoStack.pop();        }    }}</code></pre><h5 id="writeSerialData"><a href="#writeSerialData" class="headerlink" title="writeSerialData"></a>writeSerialData</h5><pre><code class="java">/** * Writes instance data for each serializable class of given object, from * superclass to subclass. */private void writeSerialData(Object obj, ObjectStreamClass desc)    throws IOException{    ObjectStreamClass.ClassDataSlot[] slots = desc.getClassDataLayout();    for (int i = 0; i &lt; slots.length; i++) {        ObjectStreamClass slotDesc = slots[i].desc;        if (slotDesc.hasWriteObjectMethod()) {            PutFieldImpl oldPut = curPut;            curPut = null;            SerialCallbackContext oldContext = curContext;            if (extendedDebugInfo) {                debugInfoStack.push(                    &quot;custom writeObject data (class \&quot;&quot; +                    slotDesc.getName() + &quot;\&quot;)&quot;);            }            try {                curContext = new SerialCallbackContext(obj, slotDesc);                bout.setBlockDataMode(true);                slotDesc.invokeWriteObject(obj, this);                bout.setBlockDataMode(false);                bout.writeByte(TC_ENDBLOCKDATA);            } finally {                curContext.setUsed();                curContext = oldContext;                if (extendedDebugInfo) {                    debugInfoStack.pop();                }            }            curPut = oldPut;        } else {            defaultWriteFields(obj, slotDesc);        }    }}</code></pre><p>â€‹    åœ¨è¿™ä¸ªæ–¹æ³•ä¸­é¦–å…ˆä¼šè°ƒç”¨getClassDataSlot()æ–¹æ³•è·å–è¢«åºåˆ—åŒ–å¯¹è±¡çš„æ•°æ®çš„å¸ƒå±€, éœ€è¦æ³¨æ„çš„æ˜¯è¿™ä¸ªæ–¹æ³•ä¼šæŠŠä»çˆ¶ç±»ç»§æ‰¿çš„æ•°æ®ä¸€å¹¶è¿”å›ï¼Œå¹¶ä¸”è¡¨ç¤ºä»çˆ¶ç±»ç»§æ‰¿çš„æ•°æ®çš„ClassDataSlotå¯¹è±¡åœ¨æ•°ç»„çš„æœ€å‰é¢ã€‚</p><p>â€‹    ç„¶åæ ¹æ®slotDesc.hasWriteObjectMethod() , å¯¹äºæ²¡æœ‰è‡ªå®šä¹‰writeObject()æ–¹æ³•çš„å¯¹è±¡æ¥è¯´ï¼Œæ¥ä¸‹æ¥ä¼šè°ƒç”¨defaultWriteFields()æ–¹æ³•å†™å…¥æ•°æ®</p><h5 id="defaultWriteFields"><a href="#defaultWriteFields" class="headerlink" title="defaultWriteFields"></a>defaultWriteFields</h5><pre><code class="java">/** * Fetches and writes values of serializable fields of given object to * stream.  The given class descriptor specifies which field values to * write, and in which order they should be written. */private void defaultWriteFields(Object obj, ObjectStreamClass desc)    throws IOException{    Class&lt;?&gt; cl = desc.forClass();    if (cl != null &amp;&amp; obj != null &amp;&amp; !cl.isInstance(obj)) {        throw new ClassCastException();    }    desc.checkDefaultSerialize();    int primDataSize = desc.getPrimDataSize();    if (primVals == null || primVals.length &lt; primDataSize) {        primVals = new byte[primDataSize];    }    // è·å–å¯¹åº”ç±»ä¸­çš„åŸºæœ¬æ•°æ®ç±»å‹çš„æ•°æ®å¹¶ä¿å­˜åœ¨primValså­—èŠ‚æ•°ç»„ä¸­    desc.getPrimFieldValues(obj, primVals);    // æŠŠåŸºæœ¬æ•°æ®ç±»å‹çš„æ•°æ®å†™å…¥åº•å±‚å­—èŠ‚å®¹å™¨ä¸­    bout.write(primVals, 0, primDataSize, false);        // è·å–å¯¹åº”ç±»çš„æ‰€æœ‰çš„å­—æ®µå¯¹è±¡    ObjectStreamField[] fields = desc.getFields(false);    Object[] objVals = new Object[desc.getNumObjFields()];    int numPrimFields = fields.length - objVals.length;    // æŠŠå¯¹åº”ç±»çš„Objectç±»å‹(éåŸå§‹ç±»å‹)çš„å¯¹è±¡ä¿å­˜åˆ°objValsæ•°ç»„ä¸­    desc.getObjFieldValues(obj, objVals);    for (int i = 0; i &lt; objVals.length; i++) {        if (extendedDebugInfo) {            debugInfoStack.push(                &quot;field (class \&quot;&quot; + desc.getName() + &quot;\&quot;, name: \&quot;&quot; +                fields[numPrimFields + i].getName() + &quot;\&quot;, type: \&quot;&quot; +                fields[numPrimFields + i].getType() + &quot;\&quot;)&quot;);        }        try {            // å¯¹æ‰€æœ‰Objectç±»å‹çš„å­—æ®µé€’å½’è°ƒç”¨writeObject0()æ–¹æ³•å†™å…¥å¯¹åº”çš„æ•°æ®            writeObject0(objVals[i],                         fields[numPrimFields + i].isUnshared());        } finally {            if (extendedDebugInfo) {                debugInfoStack.pop();            }        }    }}</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸­ä¼šåšä¸‹é¢å‡ ä»¶äº‹æƒ…:</p><ul><li>è·å–å¯¹åº”ç±»çš„åŸºæœ¬ç±»å‹çš„å­—æ®µçš„æ•°æ®ï¼Œå¹¶å†™å…¥åˆ°åº•å±‚çš„å­—èŠ‚å®¹å™¨ä¸­ã€‚</li><li>è·å–å¯¹åº”ç±»çš„Objectç±»å‹(éåŸºæœ¬ç±»å‹)çš„å­—æ®µæˆå‘˜ï¼Œé€’å½’è°ƒç”¨writeObject0()æ–¹æ³•å†™å…¥ç›¸åº”çš„æ•°æ®ã€‚</li></ul><p>ä»ä¸Šé¢å¯¹å†™å…¥æ•°æ®çš„åˆ†æå¯ä»¥çŸ¥é“ï¼Œå†™å…¥æ•°æ®æ˜¯æ˜¯æŒ‰ç…§å…ˆçˆ¶ç±»åå­ç±»çš„é¡ºåºæ¥å†™çš„ã€‚</p><h5 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h5><p><strong>1. staticå’Œtransientå­—æ®µä¸èƒ½è¢«åºåˆ—åŒ–ã€‚</strong></p><p>åºåˆ—åŒ–çš„æ—¶å€™æ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯æ¥è‡ªäºObejctStreamClasså¯¹è±¡ï¼Œåœ¨ç”ŸæˆObjectStreamClassçš„æ„é€ å‡½æ•°ä¸­ä¼šè°ƒç”¨fields = getSerialFields(cl);</p><p>â€‹    int mask = Modifier.STATIC | Modifier.TRANSIENT;</p><p><strong>2. å¦‚ä½•å®ç°è‡ªå®šä¹‰åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Ÿ</strong></p><p>â€‹    åœ¨ObejctStreamClassçš„æ„é€ å‡½æ•°ä¸­ä¼šæŸ¥æ‰¾è¢«åºåˆ—åŒ–ç±»ä¸­æœ‰æ²¡æœ‰å®šä¹‰ä¸ºvoid writeObject(ObjectOutputStream oos) çš„å‡½æ•°ï¼Œå¦‚æœæ‰¾åˆ°çš„è¯ï¼Œåˆ™ä¼šæŠŠæ‰¾åˆ°çš„æ–¹æ³•èµ‹å€¼ç»™writeObjectMethodè¿™ä¸ªå˜é‡ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°çš„è¯åˆ™ä¸ºnullã€‚</p><h3 id="ObjectInputStream-ååºåˆ—åŒ–"><a href="#ObjectInputStream-ååºåˆ—åŒ–" class="headerlink" title="ObjectInputStream (ååºåˆ—åŒ–)"></a>ObjectInputStream (ååºåˆ—åŒ–)</h3><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g79fjqic29j30yi0hw0ua.jpg" alt="image-20190923142258452" style="zoom:50%;"></p><p>ååºåˆ—åŒ–è¿‡ç¨‹å°±æ˜¯æŒ‰ç…§å‰é¢ä»‹ç»çš„åºåˆ—åŒ–ç®—æ³•æ¥è§£æäºŒè¿›åˆ¶æ•°æ®ã€‚</p><p>æœ‰ä¸€ä¸ªéœ€è¦æ³¨æ„çš„é—®é¢˜å°±æ˜¯ï¼Œå¦‚æœå­ç±»å®ç°äº†Serializableæ¥å£ï¼Œä½†æ˜¯çˆ¶ç±»æ²¡æœ‰å®ç°Serializableæ¥å£ï¼Œè¿™ä¸ªæ—¶å€™è¿›è¡Œååºåˆ—åŒ–ä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µï¼Ÿ</p><p>ç­”ï¼šå¦‚æœçˆ¶ç±»æœ‰é»˜è®¤æ„é€ å‡½æ•°çš„è¯ï¼Œå³ä½¿æ²¡æœ‰å®ç°Serializableæ¥å£ä¹Ÿä¸ä¼šæœ‰é—®é¢˜ï¼Œååºåˆ—åŒ–çš„æ—¶å€™ä¼šè°ƒç”¨é»˜è®¤æ„é€ å‡½æ•°è¿›è¡Œåˆå§‹åŒ–ï¼Œå¦åˆ™çš„è¯ååºåˆ—åŒ–çš„æ—¶å€™ä¼šæŠ›å‡º.InvalidClassException:å¼‚å¸¸ï¼Œå¼‚å¸¸åŸå› ä¸ºno valid constructorã€‚</p><h3 id="åºåˆ—åŒ–æ€§èƒ½"><a href="#åºåˆ—åŒ–æ€§èƒ½" class="headerlink" title="åºåˆ—åŒ–æ€§èƒ½"></a>åºåˆ—åŒ–æ€§èƒ½</h3><p><a href="https://blog.csdn.net/qq_31457665/article/details/82587942" target="_blank" rel="noopener">https://blog.csdn.net/qq_31457665/article/details/82587942</a></p><p>å‚è€ƒé“¾æ¥:</p><blockquote><p>@link : <a href="https://mp.weixin.qq.com/s/1D-CtyvAXOYO8mH66HHJJQ" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/1D-CtyvAXOYO8mH66HHJJQ</a></p></blockquote><h2 id="file-system"><a href="#file-system" class="headerlink" title="file system"></a>file system</h2><h3 id="File"><a href="#File" class="headerlink" title="File"></a>File</h3><h4 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h4><p>from <a href="https://docs.oracle.com/javase/8/docs/api/java/io/File.html" target="_blank" rel="noopener">https://docs.oracle.com/javase/8/docs/api/java/io/File.html</a></p><blockquote><p>An abstract representation of file and directory pathnames.</p><p>User interfaces and operating systems use system-dependent <em>pathname strings</em> to name files and directories. This class presents an abstract, system-independent view of hierarchical pathnames. An <em>abstract pathname</em> has two components:</p><ol><li>An optional system-dependent <em>prefix</em> string, such as a disk-drive specifier, <code>&quot;/&quot;</code> for the UNIX root directory, or <code>&quot;\\\\&quot;</code> for a Microsoft Windows UNC pathname, and</li><li>A sequence of zero or more string <em>names</em>.</li></ol></blockquote><p>æ–‡ä»¶å’Œç›®å½•è·¯å¾„åçš„æŠ½è±¡è¡¨ç¤ºå½¢å¼ã€‚ æˆ‘ä»¬çŸ¥é“,å¯¹äºä¸åŒçš„æ“ä½œç³»ç»Ÿ,æ–‡ä»¶è·¯å¾„çš„æè¿°æ˜¯ä¸åŒçš„ æ¯”å¦‚ </p><ul><li>windowså¹³å°ï¼šç”¨\ </li><li>linuxå¹³å°ï¼šç”¨/ </li></ul><p>Fileæ˜¯Javaä¸ºäº†è¿™ä¸€æ¦‚å¿µæä¾›çš„æŠ½è±¡æè¿°,ä¸ç³»ç»Ÿæ— å…³çš„è§†å›¾ </p><p><strong>æŠ½è±¡è·¯å¾„å</strong>æœ‰ä¸¤ä¸ªç»„ä»¶: </p><p>1.å¯é€‰çš„ä¸ç³»ç»Ÿæœ‰å…³çš„<strong>å‰ç¼€</strong>  å­—ç¬¦ä¸²   æ¯”å¦‚ç›˜ç¬¦ï¼Œâ€/â€œ è¡¨ç¤º UNIX ä¸­çš„æ ¹ç›®å½•,â€\\â€œ è¡¨ç¤º Microsoft Windows UNC è·¯å¾„å </p><p>2.é›¶ä¸ªæˆ–è€…å¤šä¸ª  å­—ç¬¦ä¸²  åç§° åºåˆ— </p><p><strong>æœ€åä¸€ä¸ªåç§°å¯ä»¥æ˜¯ç›®å½•,ä¹Ÿå¯ä»¥æ˜¯æ–‡ä»¶åç§°,é‚£ä¹ˆFile å¹¶ä¸ä¸€å®šå°±æ˜¯ä¸€ä¸ªæ–‡ä»¶,ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªæ–‡ä»¶è·¯å¾„,ä¹Ÿå°±æ˜¯ç›®å½•</strong></p><h4 id="File-APIåˆ†ç±»"><a href="#File-APIåˆ†ç±»" class="headerlink" title="File APIåˆ†ç±»"></a><strong>File APIåˆ†ç±»</strong></h4><ul><li>æ–‡ä»¶è‡ªèº«å±æ€§è¯»å–</li><li>åˆ›å»ºæ–‡ä»¶/ç›®å½•åŸºæœ¬æ“ä½œ</li><li>æ–‡ä»¶/ç›®å½• åˆ—è¡¨è¯»å–</li><li>æ–‡ä»¶æƒé™è®¿é—®ä»¥åŠæ–‡ä»¶ä¿¡æ¯è®¾ç½®</li><li>å…¶ä»–</li></ul><h3 id="FileSystem"><a href="#FileSystem" class="headerlink" title="FileSystem"></a>FileSystem</h3><p>Fileä¸­æœ‰ä¸€ä¸ªå˜é‡fs  ç±»å‹ä¸ºFileSystem </p><pre><code>private static final FileSystem fs = DefaultFileSystem.getFileSystem();</code></pre><p>â€‹    æ“ä½œç³»ç»Ÿæœ‰å„è‡ªçš„æ–‡ä»¶ç³»ç»Ÿï¼Œè¿™äº›æ–‡ä»¶ç³»ç»Ÿåˆå­˜åœ¨å¾ˆå¤šå·®å¼‚ï¼Œè€ŒJava å› ä¸ºæ˜¯è·¨å¹³å°çš„ï¼Œæ‰€ä»¥å®ƒå¿…é¡»è¦ç»Ÿä¸€å¤„ç†è¿™äº›ä¸åŒå¹³å°æ–‡ä»¶ç³»ç»Ÿä¹‹é—´çš„å·®å¼‚ï¼Œæ‰èƒ½å¾€ä¸Šæä¾›ç»Ÿä¸€çš„å…¥å£ã€‚ </p><p>è¯´ç™½äº†åˆæ˜¯æ¥å£æ¥å®ç°ç»Ÿä¸€,ä¸åŒçš„æ“ä½œç³»ç»Ÿå®ç°è¿™ä¸ªæ¥å£,å°±å¯ä»¥æä¾›ç»Ÿä¸€çš„è¡¨ç°å½¢å¼ </p><p>FileSystemæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»,ä¸åŒç³»ç»Ÿä¼šæœ‰ä¸åŒçš„å®ç° </p><h3 id="java-nio-file"><a href="#java-nio-file" class="headerlink" title="java.nio.file"></a>java.nio.file</h3><p>åœ¨1.7ä¸­é‡æ„äº†æ–‡ä»¶ç³»ç»Ÿ</p><pre><code>public Path toPath() {    Path result = filePath;    if (result == null) {        synchronized (this) {            result = filePath;            if (result == null) {                result = FileSystems.getDefault().getPath(path);                filePath = result;            }        }    }    return result;}</code></pre><p>Nio fileä¸­è§£å†³äº†ä¸€äº›é—®é¢˜,å’Œæ‰©å±•</p><blockquote><p>Interoperability with <code>java.nio.file</code> package</p><p>The <a href="https://docs.oracle.com/javase/8/docs/api/java/nio/file/package-summary.html" target="_blank" rel="noopener"><code>java.nio.file</code></a> package defines interfaces and classes for the Java virtual machine to access files, file attributes, and file systems. This API may be used to overcome many of the limitations of the <code>java.io.File</code> class. The <a href="https://docs.oracle.com/javase/8/docs/api/java/io/File.html#toPath--" target="_blank" rel="noopener"><code>toPath</code></a> method may be used to obtain a <a href="https://docs.oracle.com/javase/8/docs/api/java/nio/file/Path.html" target="_blank" rel="noopener"><code>Path</code></a> that uses the abstract path represented by a <code>File</code> object to locate a file. The resulting <code>Path</code> may be used with the <a href="https://docs.oracle.com/javase/8/docs/api/java/nio/file/Files.html" target="_blank" rel="noopener"><code>Files</code></a> class to provide more efficient and extensive access to additional file operations, file attributes, and I/O exceptions to help diagnose errors when an operation on a file fails.</p></blockquote><p>å‚è€ƒé“¾æ¥:</p><blockquote><p>@Link:<a href="https://cloud.tencent.com/developer/article/1333744" target="_blank" rel="noopener">https://cloud.tencent.com/developer/article/1333744</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> jdk </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jdk </tag>
            
            <tag> packages </tag>
            
            <tag> io </tag>
            
            <tag> serialization </tag>
            
            <tag> file </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JDK_Class</title>
      <link href="/2019/08/31/JDK-Class/"/>
      <url>/2019/08/31/JDK-Class/</url>
      
        <content type="html"><![CDATA[<blockquote><p>æˆ‘æœ€åçš„ç¥ç¦æ˜¯è¦ç»™é‚£äº›äººâ€”â€”ä»–ä»¬çŸ¥é“æˆ‘ä¸å®Œç¾å´è¿˜çˆ±ç€æˆ‘ â€”â€”ã€Šæµè¤é›†ã€‹</p></blockquote><p>å…³äºClass ä½ æƒ³çŸ¥é“çš„æˆ‘è¿™é‡Œéƒ½æœ‰ğŸ˜Š</p><ul><li>â˜•ï¸ JDK Classç±»åˆ†æ</li><li>ğŸ“ƒ classæ–‡ä»¶æ„æˆåˆ†æ</li><li>ğŸ”§ å­—èŠ‚ç å·¥å…·ä»‹ç»</li><li>â• ç±»åŠ è½½</li></ul><a id="more"></a><h3 id="JDKä¸­çš„Classç±»"><a href="#JDKä¸­çš„Classç±»" class="headerlink" title="JDKä¸­çš„Classç±»"></a>JDKä¸­çš„Classç±»</h3><p><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html" target="_blank" rel="noopener">https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html</a></p><p>å…ˆæ¥çœ‹çœ‹JDKä¸­å¯¹Classç±»çš„ä»‹ç»</p><blockquote><p>Instances of the class <code>Class</code> represent classes and interfaces in a running Java application. An enum is a kind of class and an annotation is a kind of interface. Every array also belongs to a class that is reflected as a <code>Class</code> object that is shared by all arrays with the same element type and number of dimensions. The primitive Java types (<code>boolean</code>, <code>byte</code>, <code>char</code>, <code>short</code>, <code>int</code>, <code>long</code>, <code>float</code>, and <code>double</code>), and the keyword <code>void</code> are also represented as <code>Class</code>objects.</p><p><code>Class</code> has no public constructor. Instead <code>Class</code> objects are constructed automatically by the Java Virtual Machine as classes are loaded and by calls to the <code>defineClass</code> method in the class loader.</p></blockquote><p>ç±»çš„å®ä¾‹è¡¨ç¤ºè¿è¡Œä¸­çš„Javaåº”ç”¨ç¨‹åºä¸­çš„ç±»å’Œæ¥å£ã€‚æšä¸¾æ˜¯ä¸€ç§ç±»ï¼Œæ³¨è§£æ˜¯ä¸€ç§æ¥å£ã€‚æ¯ä¸ªæ•°ç»„ä¹Ÿå±äºä¸€ä¸ªç±»ï¼Œè¿™ä¸ªç±»åæ˜ ä¸ºä¸€ä¸ªç±»å¯¹è±¡ï¼Œç”±å…·æœ‰ç›¸åŒå…ƒç´ ç±»å‹å’Œç»´æ•°çš„æ‰€æœ‰æ•°ç»„å…±äº«ã€‚åŸå§‹Javaç±»å‹(booleanã€byteã€charã€shortã€intã€longã€floatå’Œdouble)å’Œå…³é”®å­—voidä¹Ÿè¡¨ç¤ºä¸ºç±»å¯¹è±¡ã€‚</p><p>ç±»æ²¡æœ‰å…¬å…±æ„é€ å‡½æ•°ã€‚ç›¸åï¼Œç±»å¯¹è±¡æ˜¯åœ¨ç±»è£…å…¥æ—¶ç”±Javaè™šæ‹Ÿæœºè‡ªåŠ¨æ„é€ çš„ï¼Œå¹¶é€šè¿‡è°ƒç”¨ç±»è£…å…¥å™¨ä¸­çš„defineClassæ–¹æ³•æ„é€ çš„ã€‚</p><p>ç±»çš„æˆå‘˜ åŒ…å« (Declaredå‰ç¼€å¯ä»¥è·å¾—å…¬å¼€çš„ç±»)  </p><ul><li>getFields  å­—æ®µ </li><li>getMethods æ–¹æ³•</li><li>getConstructors  æ„é€ å‡½æ•°</li><li>getClasses  å†…éƒ¨ç±»</li><li>getAnnotations  æ³¨è§£</li><li>getSuperclass  çˆ¶ç±»</li><li>getInterfaces   æ¥å£</li></ul><p>æ›´å¤šç»†èŠ‚å¯ä»¥æŸ¥çœ‹ JLS ç¬¬8ç« </p><p>getFields åˆ†æ</p><pre><code class="java">////// java.lang.reflect.Field handling////// Returns an array of &quot;root&quot; fields. These Field objects must NOT// be propagated to the outside world, but must instead be copied// via ReflectionFactory.copyField.private Field[] privateGetDeclaredFields(boolean publicOnly) {    checkInitted();    Field[] res;    ReflectionData&lt;T&gt; rd = reflectionData();    if (rd != null) {        res = publicOnly ? rd.declaredPublicFields : rd.declaredFields;        if (res != null) return res;    }    // No cached value available; request value from VM    res = Reflection.filterFields(this, getDeclaredFields0(publicOnly));    if (rd != null) {        if (publicOnly) {            rd.declaredPublicFields = res;        } else {            rd.declaredFields = res;        }    }    return res;}</code></pre><p>ä»ç¼“å­˜ä¸­è·å–, å¦‚æœä¸ºç©ºåˆ™ä»VMè·å– , å…¶ä¸­ reflectionData åå°„ç¼“å­˜Bo  (useCaches é»˜è®¤ä¸ºtrue)</p><pre><code class="java">private volatile transient SoftReference&lt;ReflectionData&lt;T&gt;&gt; reflectionData;// Incremented by the VM on each call to JVM TI RedefineClasses()// that redefines this class or a superclass.private volatile transient int classRedefinedCount = 0;// Lazily create and cache ReflectionDataprivate ReflectionData&lt;T&gt; reflectionData() {    SoftReference&lt;ReflectionData&lt;T&gt;&gt; reflectionData = this.reflectionData;    int classRedefinedCount = this.classRedefinedCount;    ReflectionData&lt;T&gt; rd;    if (useCaches &amp;&amp;        reflectionData != null &amp;&amp;        (rd = reflectionData.get()) != null &amp;&amp;        rd.redefinedCount == classRedefinedCount) {        return rd;    }    // else no SoftReference or cleared SoftReference or stale ReflectionData    // -&gt; create and replace new instance    return newReflectionData(reflectionData, classRedefinedCount);}private ReflectionData&lt;T&gt; newReflectionData(SoftReference&lt;ReflectionData&lt;T&gt;&gt; oldReflectionData,int classRedefinedCount) {        if (!useCaches) return null;        while (true) {            ReflectionData&lt;T&gt; rd = new ReflectionData&lt;&gt;(classRedefinedCount);            // try to CAS it...            if (Atomic.casReflectionData(this, oldReflectionData, new SoftReference&lt;&gt;(rd))) {                return rd;            }            // else retry            oldReflectionData = this.reflectionData;            classRedefinedCount = this.classRedefinedCount;            if (oldReflectionData != null &amp;&amp;                (rd = oldReflectionData.get()) != null &amp;&amp;                rd.redefinedCount == classRedefinedCount) {                return rd;            }        }    }</code></pre><p>ç®€å•æ€»ç»“ Classçš„æˆå‘˜ å­—æ®µ æ–¹æ³• å’Œæ„é€ å‡½æ•°  é€šå¸¸ä¸åå°„ä¸€èµ·ä½¿ç”¨</p><h3 id="Classæ–‡ä»¶çš„æ„æˆ"><a href="#Classæ–‡ä»¶çš„æ„æˆ" class="headerlink" title="Classæ–‡ä»¶çš„æ„æˆ"></a>Classæ–‡ä»¶çš„æ„æˆ</h3><p>é€šè¿‡javac xxx å¯ä»¥ç”Ÿæˆ xxx.class æ–‡ä»¶</p><p>å­—èŠ‚ç ç»“æ„</p><table><thead><tr><th style="text-align:center">ç±»å‹</th><th style="text-align:center">åç§°</th><th style="text-align:center">è¯´æ˜</th><th style="text-align:center">é•¿åº¦</th></tr></thead><tbody><tr><td style="text-align:center">u4</td><td style="text-align:center">magic</td><td style="text-align:center">é­”æ•°ï¼Œè¯†åˆ«Classæ–‡ä»¶æ ¼å¼</td><td style="text-align:center">4ä¸ªå­—èŠ‚</td></tr><tr><td style="text-align:center">u2</td><td style="text-align:center">minor_version</td><td style="text-align:center">å‰¯ç‰ˆæœ¬å·</td><td style="text-align:center">2ä¸ªå­—èŠ‚</td></tr><tr><td style="text-align:center">u2</td><td style="text-align:center">major_version</td><td style="text-align:center">ä¸»ç‰ˆæœ¬å·</td><td style="text-align:center">2ä¸ªå­—èŠ‚</td></tr><tr><td style="text-align:center">u2</td><td style="text-align:center">constant_pool_count</td><td style="text-align:center">å¸¸é‡æ± è®¡ç®—å™¨</td><td style="text-align:center">2ä¸ªå­—èŠ‚</td></tr><tr><td style="text-align:center">cp_info</td><td style="text-align:center">constant_pool</td><td style="text-align:center">å¸¸é‡æ± </td><td style="text-align:center">nä¸ªå­—èŠ‚</td></tr><tr><td style="text-align:center">u2</td><td style="text-align:center">access_flags</td><td style="text-align:center">è®¿é—®æ ‡å¿—</td><td style="text-align:center">2ä¸ªå­—èŠ‚</td></tr><tr><td style="text-align:center">u2</td><td style="text-align:center">this_class</td><td style="text-align:center">ç±»ç´¢å¼•</td><td style="text-align:center">2ä¸ªå­—èŠ‚</td></tr><tr><td style="text-align:center">u2</td><td style="text-align:center">super_class</td><td style="text-align:center">çˆ¶ç±»ç´¢å¼•</td><td style="text-align:center">2ä¸ªå­—èŠ‚</td></tr><tr><td style="text-align:center">u2</td><td style="text-align:center">interfaces_count</td><td style="text-align:center">æ¥å£è®¡æ•°å™¨</td><td style="text-align:center">2ä¸ªå­—èŠ‚</td></tr><tr><td style="text-align:center">u2</td><td style="text-align:center">interfaces</td><td style="text-align:center">æ¥å£ç´¢å¼•é›†åˆ</td><td style="text-align:center">2ä¸ªå­—èŠ‚</td></tr><tr><td style="text-align:center">u2</td><td style="text-align:center">fields_count</td><td style="text-align:center">å­—æ®µä¸ªæ•°</td><td style="text-align:center">2ä¸ªå­—èŠ‚</td></tr><tr><td style="text-align:center">field_info</td><td style="text-align:center">fields</td><td style="text-align:center">å­—æ®µé›†åˆ</td><td style="text-align:center">nä¸ªå­—èŠ‚</td></tr><tr><td style="text-align:center">u2</td><td style="text-align:center">methods_count</td><td style="text-align:center">æ–¹æ³•è®¡æ•°å™¨</td><td style="text-align:center">2ä¸ªå­—èŠ‚</td></tr><tr><td style="text-align:center">method_info</td><td style="text-align:center">methods</td><td style="text-align:center">æ–¹æ³•é›†åˆ</td><td style="text-align:center">nä¸ªå­—èŠ‚</td></tr><tr><td style="text-align:center">u2</td><td style="text-align:center">attributes_count</td><td style="text-align:center">é™„åŠ å±æ€§è®¡æ•°å™¨</td><td style="text-align:center">2ä¸ªå­—èŠ‚</td></tr><tr><td style="text-align:center">attribute_info</td><td style="text-align:center">attributes</td><td style="text-align:center">é™„åŠ å±æ€§é›†åˆ</td><td style="text-align:center">nä¸ªå­—èŠ‚</td></tr></tbody></table><p>è¿™æ˜¯ä¸€å¼ Javaå­—èŠ‚ç æ€»çš„ç»“æ„è¡¨ï¼Œæˆ‘ä»¬æŒ‰ç…§ä¸Šé¢çš„é¡ºåºé€ä¸€è¿›è¡Œè§£è¯»å°±å¯ä»¥äº†ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥è¯´æ˜ä¸€ä¸‹ï¼šclassæ–‡ä»¶åªæœ‰ä¸¤ç§æ•°æ®ç±»å‹ï¼š<code>æ— ç¬¦å·æ•°</code>å’Œ<code>è¡¨</code>ã€‚å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p><table><thead><tr><th style="text-align:center">æ•°æ®ç±»å‹</th><th style="text-align:center">å®šä¹‰</th><th style="text-align:center">è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:center">æ— ç¬¦å·æ•°</td><td style="text-align:center">æ— ç¬¦å·æ•°å¯ä»¥ç”¨æ¥æè¿°æ•°å­—ã€ç´¢å¼•å¼•ç”¨ã€æ•°é‡å€¼æˆ–æŒ‰ç…§utf-8ç¼–ç æ„æˆçš„å­—ç¬¦ä¸²å€¼ã€‚</td><td style="text-align:center">å…¶ä¸­æ— ç¬¦å·æ•°å±äºåŸºæœ¬çš„æ•°æ®ç±»å‹ã€‚ä»¥u1ã€u2ã€u4ã€u8æ¥åˆ†åˆ«ä»£è¡¨1ä¸ªå­—èŠ‚ã€2ä¸ªå­—èŠ‚ã€4ä¸ªå­—èŠ‚å’Œ8ä¸ªå­—èŠ‚</td></tr><tr><td style="text-align:center">è¡¨</td><td style="text-align:center">è¡¨æ˜¯ç”±å¤šä¸ªæ— ç¬¦å·æ•°æˆ–å…¶ä»–è¡¨æ„æˆçš„å¤åˆæ•°æ®ç»“æ„ã€‚</td><td style="text-align:center">æ‰€æœ‰çš„è¡¨éƒ½ä»¥â€œ_infoâ€ç»“å°¾ã€‚ ç”±äºè¡¨æ²¡æœ‰å›ºå®šé•¿åº¦ï¼Œæ‰€ä»¥é€šå¸¸ä¼šåœ¨å…¶å‰é¢åŠ ä¸Šä¸ªæ•°è¯´æ˜ã€‚</td></tr></tbody></table><p>å®é™…ä¸Šæ•´ä¸ªclassæ–‡ä»¶å°±æ˜¯ä¸€å¼ è¡¨ï¼Œå…¶ç»“æ„å°±æ˜¯ä¸Šé¢çš„è¡¨ä¸€äº†ã€‚</p><p>æ›´å¤šç»†èŠ‚å‚è€ƒ<a href="https://www.jianshu.com/p/2c106b682cfb" target="_blank" rel="noopener">https://www.jianshu.com/p/2c106b682cfb</a></p><h3 id="æ“çºµå­—èŠ‚ç "><a href="#æ“çºµå­—èŠ‚ç " class="headerlink" title="æ“çºµå­—èŠ‚ç "></a>æ“çºµå­—èŠ‚ç </h3><p>Javassist ã€ ASM ã€ cglib</p><p>æ›´å¤šå‚è€ƒ <a href="https://blog.csdn.net/Mary881225/article/details/64132547" target="_blank" rel="noopener">https://blog.csdn.net/Mary881225/article/details/64132547</a></p><h3 id="ç±»åŠ è½½"><a href="#ç±»åŠ è½½" class="headerlink" title="ç±»åŠ è½½"></a>ç±»åŠ è½½</h3><h4 id="Class-æ˜¯ä»€ä¹ˆæ—¶å€™åŠ è½½è¿›æ¥çš„"><a href="#Class-æ˜¯ä»€ä¹ˆæ—¶å€™åŠ è½½è¿›æ¥çš„" class="headerlink" title="Class æ˜¯ä»€ä¹ˆæ—¶å€™åŠ è½½è¿›æ¥çš„"></a>Class æ˜¯ä»€ä¹ˆæ—¶å€™åŠ è½½è¿›æ¥çš„</h4><h5 id="ç±»åŠ è½½çš„æ—¶æœº"><a href="#ç±»åŠ è½½çš„æ—¶æœº" class="headerlink" title="ç±»åŠ è½½çš„æ—¶æœº"></a>ç±»åŠ è½½çš„æ—¶æœº</h5><ul><li>JVMå¯åŠ¨çš„æ—¶å€™,ä¼šä½¿ç”¨ ClassLoader åŠ è½½ javaè‡ªèº«ç›¸å…³çš„ç±»</li><li>è‡ªå®šä¹‰ç±»ä½¿ç”¨çš„æ—¶å€™åŠ è½½</li></ul><h5 id="ç±»è£…è½½çš„è¿‡ç¨‹"><a href="#ç±»è£…è½½çš„è¿‡ç¨‹" class="headerlink" title="ç±»è£…è½½çš„è¿‡ç¨‹"></a>ç±»è£…è½½çš„è¿‡ç¨‹</h5><p>åŠ è½½ ã€é“¾æ¥(éªŒè¯ã€å‡†å¤‡ã€è§£æ)ã€åˆå§‹åŒ–</p><p>JvmæŠŠclassæ–‡ä»¶å­—èŠ‚ç åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå¹¶å°†è¿™äº›é™æ€æ•°æ®è£…æ¢æˆè¿è¡Œæ—¶æ•°æ®åŒºä¸­æ–¹æ³•åŒºçš„ç±»å‹æ•°æ®ï¼Œåœ¨è¿è¡Œæ—¶æ•°æ®åŒºå †ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¿™ä¸ªç±»</p><ul><li>ç±»åŠ è½½ï¼šJvmæŠŠclassæ–‡ä»¶å­—èŠ‚ç åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå¹¶å°†è¿™äº›é™æ€æ•°æ®è£…æ¢æˆè¿è¡Œæ—¶æ•°æ®åŒºä¸­æ–¹æ³•åŒºçš„ç±»å‹æ•°æ®ï¼Œåœ¨è¿è¡Œæ—¶æ•°æ®åŒºå †ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¿™ä¸ªç±»çš„java.lang.Classå¯¹è±¡ï¼Œä½œä¸ºæ–¹æ³•åŒºç±»æ•°æ®çš„è®¿é—®å…¥å£ã€‚</li><li>é“¾æ¥ï¼šæ‰§è¡Œä¸‹é¢çš„æ ¡éªŒã€å‡†å¤‡å’Œè§£ææ­¥éª¤ï¼Œå…¶ä¸­è§£ææ­¥éª¤æ˜¯å¯é€‰çš„ã€‚</li><li>åˆå§‹åŒ–ï¼šæ‰§è¡Œç±»å˜é‡èµ‹å€¼å’Œé™æ€ä»£ç å—ã€‚</li></ul><h4 id="ä½ çŸ¥é“Class-forName-å’Œ-ClassLoder-loadClassçš„åŒºåˆ«å—"><a href="#ä½ çŸ¥é“Class-forName-å’Œ-ClassLoder-loadClassçš„åŒºåˆ«å—" class="headerlink" title="ä½ çŸ¥é“Class.forName  å’Œ ClassLoder.loadClassçš„åŒºåˆ«å—?"></a>ä½ çŸ¥é“Class.forName  å’Œ ClassLoder.loadClassçš„åŒºåˆ«å—?</h4><pre><code class="java">class MyClass {    static {//é™æ€å—          System.err.println(&quot;static block run&quot;);    }    static String init(){        return &quot;init&quot;;    }}/** * é™æ€ä»£ç å—çš„æ‰§è¡Œæ˜¯å¤„åœ¨ç±»åŠ è½½çš„æœ€åä¸€ä¸ªé˜¶æ®µâ€œåˆå§‹åŒ–â€ * * åŠ è½½ ã€éªŒè¯ã€å‡†å¤‡ã€è§£æã€åˆå§‹åŒ– */public class StaticInitDemo {    public static void main(String[] args) {        System.out.println(&quot;run MyClass.class&quot;);        Class c = MyClass.class;        System.out.println(&quot;run ClassLoader.loadClass&quot;);        try {          Thread.currentThread().getContextClassLoader().loadClass(&quot;com.practical.MyClass&quot;);        } catch (ClassNotFoundException e) {            e.printStackTrace();        }        System.out.println(&quot;run Class forName&quot;);        try {            Class.forName(&quot;com.practical.MyClass&quot;);        } catch (ClassNotFoundException e) {            e.printStackTrace();        }    }}</code></pre><p>ä¸Šè¿°ä»£ç è¿è¡Œç»“æœä¸º</p><pre><code>run MyClass.classrun ClassLoader.loadClassrun Class forNamestatic block run</code></pre><h5 id="Class-forName"><a href="#Class-forName" class="headerlink" title="Class.forName"></a>Class.forName</h5><pre><code class="java">@CallerSensitivepublic static Class&lt;?&gt; forName(String className)            throws ClassNotFoundException {    Class&lt;?&gt; caller = Reflection.getCallerClass();    return forName0(className, true, ClassLoader.getClassLoader(caller), caller);}</code></pre><h5 id="ClassLoader"><a href="#ClassLoader" class="headerlink" title="ClassLoader"></a>ClassLoader</h5><pre><code class="java">public Class&lt;?&gt; loadClass(String name) throws ClassNotFoundException {    return loadClass(name, false);} protected Class&lt;?&gt; loadClass(String name, boolean resolve)        throws ClassNotFoundException    {        synchronized (getClassLoadingLock(name)) {            // First, check if the class has already been loaded            Class&lt;?&gt; c = findLoadedClass(name);            if (c == null) {                long t0 = System.nanoTime();                try {                    if (parent != null) {                        c = parent.loadClass(name, false);                    } else {                        c = findBootstrapClassOrNull(name);                    }                } catch (ClassNotFoundException e) {                    // ClassNotFoundException thrown if class not found                    // from the non-null parent class loader                }                if (c == null) {                    // If still not found, then invoke findClass in order                    // to find the class.                    long t1 = System.nanoTime();                    c = findClass(name);                    // this is the defining class loader; record the stats                    sun.misc.PerfCounter.getParentDelegationTime().addTime(t1 - t0);                    sun.misc.PerfCounter.getFindClassTime().addElapsedTimeFrom(t1);                    sun.misc.PerfCounter.getFindClasses().increment();                }            }            if (resolve) {                resolveClass(c);            }            return c;        }    }</code></pre><p>ç»“è®º:</p><p>Class.forNameå¾—åˆ°çš„classæ˜¯å·²ç»åˆå§‹åŒ–å®Œæˆçš„ï¼Œè¯¥æ–¹æ³•é€‚åˆé‚£äº›åœ¨ç±»åŠ è½½æ—¶éœ€è¦åˆå§‹åŒ–ä¸€äº›ä¸œè¥¿çš„æƒ…å†µã€‚æ¯”å¦‚ï¼ŒåŠ è½½æ•°æ®åº“é©±åŠ¨ã€‚</p><p>Classloder.loaderClasså¾—åˆ°çš„classæ˜¯è¿˜æ²¡æœ‰é“¾æ¥çš„ï¼Œè¯¥æ–¹æ³•é€‚åˆåœ¨ç±»åŠ è½½æ—¶ä¸éœ€è¦ä¸€äº›åˆå§‹åŒ–çš„æƒ…å†µã€‚</p><h4 id="ClassNotFoundException-and-NoClassDefFoundError-LinkageError"><a href="#ClassNotFoundException-and-NoClassDefFoundError-LinkageError" class="headerlink" title="ClassNotFoundException and  NoClassDefFoundError(LinkageError)"></a>ClassNotFoundException and  NoClassDefFoundError(LinkageError)</h4><p>ClassNotFoundException å‘ç”Ÿåœ¨ç±»åŠ è½½æ—¶å€™</p><p>NoclassDefFoundError å‘ç”Ÿåœ¨åœ¨é“¾æ¥æ—¶å€™</p>]]></content>
      
      
      <categories>
          
          <category> jdk </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jdk </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JDK_Thread</title>
      <link href="/2019/08/31/JDK-Thread/"/>
      <url>/2019/08/31/JDK-Thread/</url>
      
        <content type="html"><![CDATA[<blockquote><p>æˆ‘çš„å¿ƒæ˜¯æ—·é‡çš„é¸Ÿ åœ¨ä½ çœ¼é‡Œæ‰¾åˆ°äº†å®ƒçš„å¤©ç©º  â€”â€”å›­ä¸é›†</p></blockquote><h2 id="prefer"><a href="#prefer" class="headerlink" title="prefer"></a>prefer</h2><p>åœ¨ <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Thread.html#method.detail" target="_blank" rel="noopener">https://docs.oracle.com/javase/8/docs/api/java/lang/Thread.html#method.detail</a> ä¸­æœ‰è¿™æ ·ä¸€å¥</p><p>There are two ways to create a new thread of execution.</p><ul><li>Extends Thread</li><li>Implement Runnable</li></ul><p>ç„¶åæƒ³èµ·ç»å¸¸å¯ä»¥çœ‹ç½‘ä¸Šé—®çš„ çº¿ç¨‹æœ‰å‡ ç§åˆ›å»ºæ–¹å¼? Thread å’ŒRunnable æœ‰ä»€ä¹ˆåŒºåˆ«? </p><a id="more"></a><h2 id="Javaä¸osçº¿ç¨‹"><a href="#Javaä¸osçº¿ç¨‹" class="headerlink" title="Javaä¸osçº¿ç¨‹"></a>Javaä¸osçº¿ç¨‹</h2><h3 id="osçº¿ç¨‹"><a href="#osçº¿ç¨‹" class="headerlink" title="osçº¿ç¨‹"></a>osçº¿ç¨‹</h3><p>æˆ‘ä»¬çŸ¥é“ï¼Œjavaçš„ä¸€ä¸ªçº¿ç¨‹å®é™…ä¸Šæ˜¯å¯¹åº”äº†æ“ä½œç³»ç»Ÿçš„ä¸€ä¸ªçº¿ç¨‹ï¼›</p><p>è€Œæ“ä½œç³»ç»Ÿå®ç°çº¿ç¨‹æœ‰ä¸‰ç§æ–¹å¼ï¼š</p><ul><li>å†…æ ¸çº¿ç¨‹å®ç° (java 1.2åå®ç°)</li><li>ç”¨æˆ·çº¿ç¨‹å®ç°</li><li>ç”¨æˆ·çº¿ç¨‹åŠ è½»é‡çº§è¿›ç¨‹æ··åˆå®ç°</li></ul><p>å…·ä½“è¯¦ç»†å®ç°æ–¹å¼å°±ä¸å…·ä½“è®²äº†ï¼Œå‚è§ Â«æ·±å…¥ç†è§£ JAVAè™šæ‹ŸæœºÂ»ç¬¬äºŒç‰ˆ ç¬¬12ç«  Javaå†…å­˜æ¨¡å‹ä¸çº¿ç¨‹ï¼ˆ378é¡µï¼‰</p><h3 id="Javaçº¿ç¨‹"><a href="#Javaçº¿ç¨‹" class="headerlink" title="Javaçº¿ç¨‹"></a>Javaçº¿ç¨‹</h3><p>Javaçº¿ç¨‹åœ¨JDK1.2ä¹‹å‰ï¼Œæ˜¯åŸºäºç”¨æˆ·çº¿ç¨‹å®ç°çš„ã€‚è€Œåœ¨JDK1.2ä¸­ï¼Œçº¿ç¨‹æ¨¡å‹æ›¿æ¢ä¸ºåŸºäºæ“ä½œç³»ç»ŸåŸç”Ÿçº¿ç¨‹æ¨¡å‹æ¥å®ç°ã€‚</p><p>è€Œåœ¨ç›®å‰çš„JDKç‰ˆæœ¬ä¸­ï¼Œæ“ä½œç³»ç»Ÿæ”¯æŒæ€æ ·çš„çº¿ç¨‹æ¨¡å‹ï¼Œåœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå†³å®šäº†Javaè™šæ‹Ÿæœºçš„çº¿ç¨‹æ˜¯æ€æ ·æ˜ å°„çš„ï¼Œè¿™ç‚¹åœ¨ä¸åŒçš„å¹³å°ä¸Šæ²¡æ³•è¾¾æˆä¸€è‡´ã€‚</p><p>å¯¹äºSun JDKæ¥è¯´ï¼Œå®ƒçš„Windowsç‰ˆæœ¬å’ŒLinuxç‰ˆæœ¬éƒ½æ˜¯ä½¿ç”¨ä¸€å¯¹ä¸€çš„çº¿ç¨‹æ¨¡å‹å®ç°çš„ï¼Œä¸€æ¡Javaçº¿ç¨‹æ˜ å°„åˆ°ä¸€æ¡è½»é‡çº§è¿›ç¨‹ä¹‹ä¸­ã€‚</p><h2 id="Thread"><a href="#Thread" class="headerlink" title="Thread"></a>Thread</h2><p>å…ˆæ¥çœ‹çœ‹ä¸¤ç§æ–¹å¼çš„å®ç°</p><h3 id="code-example"><a href="#code-example" class="headerlink" title="code example"></a>code example</h3><pre><code class="java">/** * çº¿ç¨‹åˆ›å»ºexample */public static void threadCreateExample() {   //1.extend   class DemoThread extends Thread{       @Override       public void run() {           System.out.println(&quot;extend&quot;);       }    }    new DemoThread().start();   //2.runnable    new Thread(() -&gt; System.out.println(&quot;impl&quot;)).start();}</code></pre><p>å…ˆæ¥çœ‹çœ‹ Thread æ„é€ æ–¹æ³•åšäº†ä»€ä¹ˆ,å†æ¥çœ‹çœ‹ ä¸ç®¡å“ªç§æœ€åçš„å¯åŠ¨éƒ½æ˜¯è°ƒç”¨çš„startæ–¹æ³•</p><h3 id="source"><a href="#source" class="headerlink" title="source"></a>source</h3><h4 id="Thread-init"><a href="#Thread-init" class="headerlink" title="Thread#init"></a>Thread#init</h4><pre><code class="java">    /**     * Allocates a new {@code Thread} object. This constructor has the same     * effect as {@linkplain #Thread(ThreadGroup,Runnable,String) Thread}     * {@code (null, null, gname)}, where {@code gname} is a newly generated     * name. Automatically generated names are of the form     * {@code &quot;Thread-&quot;+}&lt;i&gt;n&lt;/i&gt;, where &lt;i&gt;n&lt;/i&gt; is an integer.     */    public Thread() {        init(null, null, &quot;Thread-&quot; + nextThreadNum(), 0);    }    /**     * Allocates a new {@code Thread} object. This constructor has the same     * effect as {@linkplain #Thread(ThreadGroup,Runnable,String) Thread}     * {@code (null, target, gname)}, where {@code gname} is a newly generated     * name. Automatically generated names are of the form     * {@code &quot;Thread-&quot;+}&lt;i&gt;n&lt;/i&gt;, where &lt;i&gt;n&lt;/i&gt; is an integer.     *     * @param  target     *         the object whose {@code run} method is invoked when this thread     *         is started. If {@code null}, this classes {@code run} method does     *         nothing.     */    public Thread(Runnable target) {        init(null, target, &quot;Thread-&quot; + nextThreadNum(), 0);    }/** * Initializes a Thread. * * @param g the Thread group * @param target the object whose run() method gets called * @param name the name of the new Thread * @param stackSize the desired stack size for the new thread, or *        zero to indicate that this parameter is to be ignored. * @param acc the AccessControlContext to inherit, or *            AccessController.getContext() if null * @param inheritThreadLocals if {@code true}, inherit initial values for *            inheritable thread-locals from the constructing thread */private void init(ThreadGroup g, Runnable target, String name,                  long stackSize, AccessControlContext acc,                  boolean inheritThreadLocals) {    if (name == null) {        throw new NullPointerException(&quot;name cannot be null&quot;);    }    this.name = name;    Thread parent = currentThread();    SecurityManager security = System.getSecurityManager();    if (g == null) {        /* Determine if it&#39;s an applet or not */        /* If there is a security manager, ask the security manager           what to do. */        if (security != null) {            g = security.getThreadGroup();        }        /* If the security doesn&#39;t have a strong opinion of the matter           use the parent thread group. */        if (g == null) {            g = parent.getThreadGroup();        }    }    /* checkAccess regardless of whether or not threadgroup is       explicitly passed in. */    g.checkAccess();    /*     * Do we have the required permissions?     */    if (security != null) {        if (isCCLOverridden(getClass())) {            security.checkPermission(SUBCLASS_IMPLEMENTATION_PERMISSION);        }    }    g.addUnstarted();    this.group = g;    this.daemon = parent.isDaemon();    this.priority = parent.getPriority();    if (security == null || isCCLOverridden(parent.getClass()))        this.contextClassLoader = parent.getContextClassLoader();    else        this.contextClassLoader = parent.contextClassLoader;    this.inheritedAccessControlContext =            acc != null ? acc : AccessController.getContext();    this.target = target;    setPriority(priority);    if (inheritThreadLocals &amp;&amp; parent.inheritableThreadLocals != null)        this.inheritableThreadLocals =            ThreadLocal.createInheritedMap(parent.inheritableThreadLocals);    /* Stash the specified stack size in case the VM cares */    this.stackSize = stackSize;    /* Set thread ID */    tid = nextThreadID();}</code></pre><h4 id="Thread-start"><a href="#Thread-start" class="headerlink" title="Thread#start"></a>Thread#start</h4><p>è°ƒç”¨startå‘ç”Ÿäº†ä»€ä¹ˆ?</p><p>ä½¿è¯¥çº¿ç¨‹å¼€å§‹æ‰§è¡Œ;Javaè™šæ‹Ÿæœºè°ƒç”¨è¿™ä¸ªçº¿ç¨‹çš„runæ–¹æ³•ã€‚</p><p>ç»“æœæ˜¯ä¸¤ä¸ªçº¿ç¨‹å¹¶å‘åœ°è¿è¡Œ:å½“å‰çº¿ç¨‹(ä»å¯¹startæ–¹æ³•çš„è°ƒç”¨è¿”å›)å’Œå¦ä¸€ä¸ªçº¿ç¨‹(æ‰§è¡Œå…¶runæ–¹æ³•)ã€‚</p><pre><code class="java">/** * Causes this thread to begin execution; the Java Virtual Machine * calls the &lt;code&gt;run&lt;/code&gt; method of this thread. * &lt;p&gt; * The result is that two threads are running concurrently: the * current thread (which returns from the call to the * &lt;code&gt;start&lt;/code&gt; method) and the other thread (which executes its * &lt;code&gt;run&lt;/code&gt; method). * &lt;p&gt; * It is never legal to start a thread more than once. * In particular, a thread may not be restarted once it has completed * execution. * * @exception  IllegalThreadStateException  if the thread was already *               started. * @see        #run() * @see        #stop() */public synchronized void start() {    /**     * This method is not invoked for the main method thread or &quot;system&quot;     * group threads created/set up by the VM. Any new functionality added     * to this method in the future may have to also be added to the VM.     *     * A zero status value corresponds to state &quot;NEW&quot;.     */    if (threadStatus != 0)        throw new IllegalThreadStateException();    /* Notify the group that this thread is about to be started     * so that it can be added to the group&#39;s list of threads     * and the group&#39;s unstarted count can be decremented. */    group.add(this);    boolean started = false;    try {        start0();        started = true;    } finally {        try {            if (!started) {                group.threadStartFailed(this);            }        } catch (Throwable ignore) {            /* do nothing. If start0 threw a Throwable then              it will be passed up the call stack */        }    }}private native void start0();</code></pre><h4 id="native-start0"><a href="#native-start0" class="headerlink" title="native#start0"></a>native#start0</h4><p>start0 æ˜¯nativeæ–¹æ³•</p><p>åœ¨Thread.cä¸­å¯ä»¥çœ‹åˆ°start0 æ˜¯è°ƒç”¨çš„JVM_StartThread </p><pre><code class="c++">static JNINativeMethod methods[] = {    {&quot;start0&quot;,           &quot;()V&quot;,        (void *)&amp;JVM_StartThread},    {&quot;stop0&quot;,            &quot;(&quot; OBJ &quot;)V&quot;, (void *)&amp;JVM_StopThread},    {&quot;isAlive&quot;,          &quot;()Z&quot;,        (void *)&amp;JVM_IsThreadAlive},    {&quot;suspend0&quot;,         &quot;()V&quot;,        (void *)&amp;JVM_SuspendThread},    {&quot;resume0&quot;,          &quot;()V&quot;,        (void *)&amp;JVM_ResumeThread},    {&quot;setPriority0&quot;,     &quot;(I)V&quot;,       (void *)&amp;JVM_SetThreadPriority},    {&quot;yield&quot;,            &quot;()V&quot;,        (void *)&amp;JVM_Yield},    {&quot;sleep&quot;,            &quot;(J)V&quot;,       (void *)&amp;JVM_Sleep},    {&quot;currentThread&quot;,    &quot;()&quot; THD,     (void *)&amp;JVM_CurrentThread},    {&quot;countStackFrames&quot;, &quot;()I&quot;,        (void *)&amp;JVM_CountStackFrames},    {&quot;interrupt0&quot;,       &quot;()V&quot;,        (void *)&amp;JVM_Interrupt},    {&quot;isInterrupted&quot;,    &quot;(Z)Z&quot;,       (void *)&amp;JVM_IsInterrupted},    {&quot;holdsLock&quot;,        &quot;(&quot; OBJ &quot;)Z&quot;, (void *)&amp;JVM_HoldsLock},    {&quot;getThreads&quot;,        &quot;()[&quot; THD,   (void *)&amp;JVM_GetAllThreads},    {&quot;dumpThreads&quot;,      &quot;([&quot; THD &quot;)[[&quot; STE, (void *)&amp;JVM_DumpThreads},    {&quot;setNativeName&quot;,    &quot;(&quot; STR &quot;)V&quot;, (void *)&amp;JVM_SetNativeThreadName},};</code></pre><p>åœ¨jvm.cppä¸­</p><pre><code class="c++">JVM_ENTRY(void, JVM_StartThread(JNIEnv* env, jobject jthread))  JVMWrapper(&quot;JVM_StartThread&quot;);  JavaThread *native_thread = NULL;  bool throw_illegal_thread_state = false;  {    MutexLocker mu(Threads_lock);    // Since JDK 5 the java.lang.Thread threadStatus is used to prevent    // re-starting an already started thread, so we should usually find    // that the JavaThread is null.         //However for a JNI attached thread    // there is a small window between the Thread object being created    // (with its JavaThread set) and the update to its threadStatus, so we    // have to check for this    if (java_lang_Thread::thread(JNIHandles::resolve_non_null(jthread)) != NULL) {      throw_illegal_thread_state = true;    } else {      // We could also check the stillborn flag to see if this thread was already stopped, but      // for historical reasons we let the thread detect that itself when it starts running      jlong size =             java_lang_Thread::stackSize(JNIHandles::resolve_non_null(jthread));      // Allocate the C++ Thread structure and create the native thread.  The      // stack size retrieved from java is signed, but the constructor takes      // size_t (an unsigned type), so avoid passing negative values which would      // result in really large stacks.      size_t sz = size &gt; 0 ? (size_t) size : 0;      native_thread = new JavaThread(&amp;thread_entry, sz);    //Look Here      // At this point it may be possible that no osthread was created for the      // JavaThread due to lack of memory. Check for this situation and throw      // an exception if necessary. Eventually we may want to change this so      // that we only grab the lock if the thread was created successfully -      // then we can also do this check and throw the exception in the      // JavaThread constructor.      if (native_thread-&gt;osthread() != NULL) {        // Note: the current thread is not being used within &quot;prepare&quot;.        native_thread-&gt;prepare(jthread);      }    }  }  if (throw_illegal_thread_state) {    THROW(vmSymbols::java_lang_IllegalThreadStateException());  }  assert(native_thread != NULL, &quot;Starting null thread?&quot;);  if (native_thread-&gt;osthread() == NULL) {    // No one should hold a reference to the &#39;native_thread&#39;.    delete native_thread;    if (JvmtiExport::should_post_resource_exhausted()) {      JvmtiExport::post_resource_exhausted(        JVMTI_RESOURCE_EXHAUSTED_OOM_ERROR | JVMTI_RESOURCE_EXHAUSTED_THREADS,        &quot;unable to create new native thread&quot;);    }    THROW_MSG(vmSymbols::java_lang_OutOfMemoryError(),              &quot;unable to create new native thread&quot;);  }  Thread::start(native_thread);JVM_END</code></pre><p>å…¶ä¸­ native_thread = new JavaThread(&amp;thread_entry, sz);    //Look Here </p><pre><code class="c++">static void thread_entry(JavaThread* thread, TRAPS) {  HandleMark hm(THREAD);  Handle obj(THREAD, thread-&gt;threadObj());  JavaValue result(T_VOID);  JavaCalls::call_virtual(&amp;result,                          obj,                          KlassHandle(THREAD, SystemDictionary::Thread_klass()),                          vmSymbols::run_method_name(),    //LOOk Here                          vmSymbols::void_method_signature(),                          THREAD);}</code></pre><p>å…¶ä¸­ void_method_signature åœ¨vmSymbols.hppä¸­ (runæ€ä¹ˆè·‘çš„å®åœ¨æ‰¾ä¸åˆ°(Â´;ï¸µ;`) )</p><p>template(run_method_name,â€runâ€)   </p><p>ç®€å•æ€»ç»“: å°±æ˜¯åœ¨è™šæ‹Ÿæœºä¸­å¯åŠ¨ä¸ªçº¿ç¨‹ (å±è”½äº†å¹³å°æ— å…³) ,åˆ†é…å†…å­˜,çº¿ç¨‹id, è®¾ç½®çŠ¶æ€ã€‚ ç„¶åå›è°ƒjavaä¸­çš„runæ–¹æ³•</p><p>è€Œrunnableå…¶å®å°±åªæ˜¯çº¿ç¨‹ä¸­çš„ä¸€ä¸ªå¯¹è±¡targer</p><pre><code class="java">/** * If this thread was constructed using a separate * &lt;code&gt;Runnable&lt;/code&gt; run object, then that * &lt;code&gt;Runnable&lt;/code&gt; object&#39;s &lt;code&gt;run&lt;/code&gt; method is called; * otherwise, this method does nothing and returns. * &lt;p&gt; * Subclasses of &lt;code&gt;Thread&lt;/code&gt; should override this method. * * @see     #start() * @see     #stop() * @see     #Thread(ThreadGroup, Runnable, String) */@Overridepublic void run() {    if (target != null) {        target.run();    }}</code></pre><p>è¿™ä¹Ÿæ˜¯Thread ç»§æ‰¿æ–¹å¼ä¸ºä»€ä¹ˆè¦é‡å†™runçš„åŸå› </p><blockquote><p>å‚è€ƒ <a href="https://www.linuxidc.com/Linux/2016-03/128997.htm" target="_blank" rel="noopener">https://www.linuxidc.com/Linux/2016-03/128997.htm</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> jdk </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jdk </tag>
            
            <tag> jvm </tag>
            
            <tag> hotspot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVM_mainæ–¹æ³•åˆ†æ</title>
      <link href="/2019/08/29/JVM-main%E6%96%B9%E6%B3%95%E5%88%86%E6%9E%90/"/>
      <url>/2019/08/29/JVM-main%E6%96%B9%E6%B3%95%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<blockquote><p>çºµç„¶ä¼¤å¿ƒ ä¹Ÿä¸è¦æ„çœ‰ä¸å±• å› ä¸ºä½ ä¸çŸ¥é“è°ä¼šçˆ±ä¸Šä½ çš„ç¬‘å®¹ â€”â€”é£é¸Ÿé›†</p></blockquote><p>å¯åŠ¨ä¸€ä¸ªæœ€ç®€å•çš„Java mainç¨‹åºæ—¶ï¼Œæœ‰å¤šå°‘ä¸ªçº¿ç¨‹è¢«åˆ›å»º? æœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥çœ‹åˆ°å½“å‰è¿è¡Œçš„çº¿ç¨‹?</p><ul><li>javaçº¿ç¨‹</li><li>å¦‚ä½•æŸ¥çœ‹çº¿ç¨‹çŠ¶æ€</li><li>çº¿ç¨‹ç±»å‹</li></ul><a id="more"></a><h4 id="javaçº¿ç¨‹"><a href="#javaçº¿ç¨‹" class="headerlink" title="javaçº¿ç¨‹"></a>javaçº¿ç¨‹</h4><p>åœ¨javaä¸­ï¼Œå¯åŠ¨ä¸€ä¸ªç®€å•çš„mainç¨‹åºï¼Œå¹¶ä¸æ˜¯åªæ˜¯å•å•åˆ›å»ºäº†ä¸€ä¸ªmainçº¿ç¨‹è€Œå·²ï¼ŒJVMä¼šè‡ªåŠ¨åˆ›å»ºä¸€äº›è¾…åŠ©ç”¨çš„çº¿ç¨‹ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š</p><h5 id="Reference-Handler-2"><a href="#Reference-Handler-2" class="headerlink" title="Reference Handler #2"></a>Reference Handler #2</h5><p>VMåœ¨åˆ›å»ºmainçº¿ç¨‹åå°±åˆ›å»ºReference Handlerçº¿ç¨‹ï¼Œå…¶ä¼˜å…ˆçº§æœ€é«˜ï¼Œä¸º10ï¼Œå®ƒä¸»è¦ç”¨äºå¤„ç†å¼•ç”¨å¯¹è±¡æœ¬èº«ï¼ˆè½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨ï¼‰çš„åƒåœ¾å›æ”¶é—®é¢˜ã€‚</p><h5 id="Finalizer-3"><a href="#Finalizer-3" class="headerlink" title="Finalizer #3"></a>Finalizer #3</h5><p>è¿™ä¸ªçº¿ç¨‹ä¹Ÿæ˜¯åœ¨mainçº¿ç¨‹ä¹‹ååˆ›å»ºçš„ï¼Œå…¶ä¼˜å…ˆçº§ä¸º10ï¼Œä¸»è¦ç”¨äºåœ¨åƒåœ¾æ”¶é›†å‰ï¼Œè°ƒç”¨å¯¹è±¡çš„finalize()æ–¹æ³•ï¼›å…³äºFinalizerçº¿ç¨‹çš„å‡ ç‚¹ï¼š</p><p>ã€€ã€€1)åªæœ‰å½“å¼€å§‹ä¸€è½®åƒåœ¾æ”¶é›†æ—¶ï¼Œæ‰ä¼šå¼€å§‹è°ƒç”¨finalize()æ–¹æ³•ï¼›å› æ­¤å¹¶ä¸æ˜¯æ‰€æœ‰å¯¹è±¡çš„finalize()æ–¹æ³•éƒ½ä¼šè¢«æ‰§è¡Œï¼›</p><p>ã€€ã€€2)è¯¥çº¿ç¨‹ä¹Ÿæ˜¯daemonçº¿ç¨‹ï¼Œå› æ­¤å¦‚æœè™šæ‹Ÿæœºä¸­æ²¡æœ‰å…¶ä»–édaemonçº¿ç¨‹ï¼Œä¸ç®¡è¯¥çº¿ç¨‹æœ‰æ²¡æœ‰æ‰§è¡Œå®Œfinalize()æ–¹æ³•ï¼ŒJVMä¹Ÿä¼šé€€å‡ºï¼›</p><p>ã€€ã€€3) JVMåœ¨åƒåœ¾æ”¶é›†æ—¶ä¼šå°†å¤±å»å¼•ç”¨çš„å¯¹è±¡åŒ…è£…æˆFinalizerå¯¹è±¡ï¼ˆReferenceçš„å®ç°ï¼‰ï¼Œå¹¶æ”¾å…¥ReferenceQueueï¼Œç”±Finalizerçº¿ç¨‹æ¥å¤„ç†ï¼›æœ€åå°†è¯¥Finalizerå¯¹è±¡çš„å¼•ç”¨ç½®ä¸ºnullï¼Œç”±åƒåœ¾æ”¶é›†å™¨æ¥å›æ”¶ï¼›</p><p>ã€€ã€€4) JVMä¸ºä»€ä¹ˆè¦å•ç‹¬ç”¨ä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œfinalize()æ–¹æ³•å‘¢ï¼Ÿå¦‚æœJVMçš„åƒåœ¾æ”¶é›†çº¿ç¨‹è‡ªå·±æ¥åšï¼Œå¾ˆæœ‰å¯èƒ½ç”±äºåœ¨finalize()æ–¹æ³•ä¸­è¯¯æ“ä½œå¯¼è‡´GCçº¿ç¨‹åœæ­¢æˆ–ä¸å¯æ§ï¼Œè¿™å¯¹GCçº¿ç¨‹æ¥è¯´æ˜¯ä¸€ç§ç¾éš¾ï¼›</p><h5 id="Signal-Dispatcher-4"><a href="#Signal-Dispatcher-4" class="headerlink" title="Signal Dispatcher #4"></a>Signal Dispatcher #4</h5><p>å‰é¢æˆ‘ä»¬æåˆ°ç¬¬ä¸€ä¸ªAttach Listenerçº¿ç¨‹çš„èŒè´£æ˜¯æ¥æ”¶å¤–éƒ¨jvmå‘½ä»¤ï¼Œå½“å‘½ä»¤æ¥æ”¶æˆåŠŸåï¼Œä¼šäº¤ç»™signal dispatherçº¿ç¨‹å»è¿›è¡Œåˆ†å‘åˆ°å„ä¸ªä¸åŒçš„æ¨¡å—å¤„ç†å‘½ä»¤ï¼Œå¹¶ä¸”è¿”å›å¤„ç†ç»“æœã€‚signal dispatherçº¿ç¨‹ä¹Ÿæ˜¯åœ¨ç¬¬ä¸€æ¬¡æ¥æ”¶å¤–éƒ¨jvmå‘½ä»¤æ—¶ï¼Œè¿›è¡Œåˆå§‹åŒ–å·¥ä½œã€‚</p><h5 id="Monitor-Ctrl-Break-5"><a href="#Monitor-Ctrl-Break-5" class="headerlink" title="Monitor Ctrl-Break #5"></a>Monitor Ctrl-Break #5</h5><p>Monitoring Thread Activity With Thread Dumps Thread dumps, or â€œthread stack traces,â€ reveal information about an applicationâ€™s activity that can help you diagnose problems and better optimize application and JVM performance; for example, thread dumps can show the occurrence of â€œdeadlockâ€ conditions, which can seriously impact application performance. You can create a thread dump by invoking a control break (usually by pressing Ctrl-Break or Ctrl-\ or SIGQUIT on linux). This section provides information on working with thread dumps. It includes information on these subjects: 1.Lock Information in Thread Dumps 2.Detecting Deadlocks</p><h5 id="Attach-Listener"><a href="#Attach-Listener" class="headerlink" title="Attach Listener"></a>Attach Listener</h5><p>Attach Listenerçº¿ç¨‹æ˜¯è´Ÿè´£æ¥æ”¶åˆ°å¤–éƒ¨çš„å‘½ä»¤ï¼Œè€Œå¯¹è¯¥å‘½ä»¤è¿›è¡Œæ‰§è¡Œçš„å¹¶ä¸”å§ç»“æœè¿”å›ç»™å‘é€è€…ã€‚é€šå¸¸æˆ‘ä»¬ä¼šç”¨ä¸€äº›å‘½ä»¤å»è¦æ±‚jvmç»™æˆ‘ä»¬ä¸€äº›å é¦ˆä¿¡ æ¯ï¼Œå¦‚ï¼šjava -versionã€jmapã€jstackç­‰ç­‰ã€‚å¦‚æœè¯¥çº¿ç¨‹åœ¨jvmå¯åŠ¨çš„æ—¶å€™æ²¡æœ‰åˆå§‹åŒ–ï¼Œé‚£ä¹ˆï¼Œåˆ™ä¼šåœ¨ç”¨æˆ·ç¬¬ä¸€æ¬¡æ‰§è¡Œjvmå‘½ä»¤æ—¶ï¼Œå¾—åˆ°å¯åŠ¨ã€‚</p><p>ä»¥ä¸Šæ˜¯è¢«åˆ›å»ºçš„javaçº¿ç¨‹ </p><h4 id="ThreadMXBeanæŸ¥çœ‹"><a href="#ThreadMXBeanæŸ¥çœ‹" class="headerlink" title="ThreadMXBeanæŸ¥çœ‹"></a>ThreadMXBeanæŸ¥çœ‹</h4><p>å¦‚ä¸‹ä»£ç  </p><pre><code class="java"> public class MainThreadInfoDemo {    public static void main(String[] args) {//        threadCreateExample();        dumpThreadInfo();    }    public static void dumpThreadInfo() {        Arrays.stream(ManagementFactory.getThreadMXBean().dumpAllThreads(false, false)).                forEach(threadInfo -&gt; System.out.println(&quot;[&quot; + threadInfo.getThreadId() + &quot;]&quot; + threadInfo.getThreadName())                );    }    /**     * çº¿ç¨‹åˆ›å»ºexample     */    public static void threadCreateExample() {        class DemoThread extends Thread {            @Override            public void run() {                System.out.println(&quot;extend&quot;);                while (true) {                }            }        }        new DemoThread().start();        new Thread(() -&gt; { System.out.println(&quot;impl&quot;);while (true) { } }).start();    }}</code></pre><p>T</p><p>è¿è¡Œç»“æœå¦‚ä¸‹:</p><pre><code>[5]Monitor Ctrl-Break[4]Signal Dispatcher[3]Finalizer[2]Reference Handler[1]main</code></pre><p>æŠŠthreadCreateExampleæ³¨é‡Šå»æ‰,è¿è¡Œæ–¹æ³•åå‘ç°:</p><pre><code>[12]Thread-1[11]Thread-0[5]Monitor Ctrl-Break[4]Signal Dispatcher[3]Finalizer[2]Reference Handler[1]main</code></pre><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹ä¸ºä»€ä¹ˆidæ˜¯ä»11å¼€å§‹ ?</p><h4 id="jstackæŸ¥çœ‹"><a href="#jstackæŸ¥çœ‹" class="headerlink" title="jstackæŸ¥çœ‹"></a>jstackæŸ¥çœ‹</h4><h5 id="Jstack-æ–‡ä»¶"><a href="#Jstack-æ–‡ä»¶" class="headerlink" title="Jstack æ–‡ä»¶"></a>Jstack æ–‡ä»¶</h5><p>ç”¨jstack æŸ¥çœ‹(æ²¡æœ‰è¿è¡ŒthreadCreateExampleæ–¹æ³•)</p><pre><code>2019-08-29 11:44:28Full thread dump Java HotSpot(TM) 64-Bit Server VM (25.161-b12 mixed mode):&quot;Attach Listener&quot; #11 daemon prio=9 os_prio=31 tid=0x00007fcf2582d000 nid=0x5603 waiting on condition [0x0000000000000000]   java.lang.Thread.State: RUNNABLE   Locked ownable synchronizers:    - None&quot;Service Thread&quot; #10 daemon prio=9 os_prio=31 tid=0x00007fcf25093800 nid=0x3d03 runnable [0x0000000000000000]   java.lang.Thread.State: RUNNABLE   Locked ownable synchronizers:    - None&quot;C1 CompilerThread3&quot; #9 daemon prio=9 os_prio=31 tid=0x00007fcf25802800 nid=0x3b03 waiting on condition [0x0000000000000000]   java.lang.Thread.State: RUNNABLE   Locked ownable synchronizers:    - None&quot;C2 CompilerThread2&quot; #8 daemon prio=9 os_prio=31 tid=0x00007fcf24874000 nid=0x3f03 waiting on condition [0x0000000000000000]   java.lang.Thread.State: RUNNABLE   Locked ownable synchronizers:    - None&quot;C2 CompilerThread1&quot; #7 daemon prio=9 os_prio=31 tid=0x00007fcf24025000 nid=0x4103 waiting on condition [0x0000000000000000]   java.lang.Thread.State: RUNNABLE   Locked ownable synchronizers:    - None&quot;C2 CompilerThread0&quot; #6 daemon prio=9 os_prio=31 tid=0x00007fcf25801800 nid=0x3803 waiting on condition [0x0000000000000000]   java.lang.Thread.State: RUNNABLE   Locked ownable synchronizers:    - None&quot;Monitor Ctrl-Break&quot; #5 daemon prio=5 os_prio=31 tid=0x00007fcf229b1000 nid=0x3703 runnable [0x000070000feff000]   java.lang.Thread.State: RUNNABLE    at java.net.SocketInputStream.socketRead0(Native Method)    at java.net.SocketInputStream.socketRead(SocketInputStream.java:116)    at java.net.SocketInputStream.read(SocketInputStream.java:171)    at java.net.SocketInputStream.read(SocketInputStream.java:141)    at sun.nio.cs.StreamDecoder.readBytes(StreamDecoder.java:284)    at sun.nio.cs.StreamDecoder.implRead(StreamDecoder.java:326)    at sun.nio.cs.StreamDecoder.read(StreamDecoder.java:178)    - locked &lt;0x000000076af13bc8&gt; (a java.io.InputStreamReader)    at java.io.InputStreamReader.read(InputStreamReader.java:184)    at java.io.BufferedReader.fill(BufferedReader.java:161)    at java.io.BufferedReader.readLine(BufferedReader.java:324)    - locked &lt;0x000000076af13bc8&gt; (a java.io.InputStreamReader)    at java.io.BufferedReader.readLine(BufferedReader.java:389)    at com.intellij.rt.execution.application.AppMainV2$1.run(AppMainV2.java:64)   Locked ownable synchronizers:    - None&quot;Signal Dispatcher&quot; #4 daemon prio=9 os_prio=31 tid=0x00007fcf22022800 nid=0x3603 runnable [0x0000000000000000]   java.lang.Thread.State: RUNNABLE   Locked ownable synchronizers:    - None&quot;Finalizer&quot; #3 daemon prio=8 os_prio=31 tid=0x00007fcf2280c800 nid=0x4a03 in Object.wait() [0x000070000fcf9000]   java.lang.Thread.State: WAITING (on object monitor)    at java.lang.Object.wait(Native Method)    - waiting on &lt;0x000000076ab08ec0&gt; (a java.lang.ref.ReferenceQueue$Lock)    at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:143)    - locked &lt;0x000000076ab08ec0&gt; (a java.lang.ref.ReferenceQueue$Lock)    at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:164)    at java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:209)   Locked ownable synchronizers:    - None&quot;Reference Handler&quot; #2 daemon prio=10 os_prio=31 tid=0x00007fcf22016000 nid=0x4b03 in Object.wait() [0x000070000fbf6000]   java.lang.Thread.State: WAITING (on object monitor)    at java.lang.Object.wait(Native Method)    - waiting on &lt;0x000000076ab06b68&gt; (a java.lang.ref.Reference$Lock)    at java.lang.Object.wait(Object.java:502)    at java.lang.ref.Reference.tryHandlePending(Reference.java:191)    - locked &lt;0x000000076ab06b68&gt; (a java.lang.ref.Reference$Lock)    at java.lang.ref.Reference$ReferenceHandler.run(Reference.java:153)   Locked ownable synchronizers:    - None&quot;main&quot; #1 prio=5 os_prio=31 tid=0x00007fcf25004800 nid=0x1803 waiting on condition [0x000070000f1d8000]   java.lang.Thread.State: WAITING (parking)    at sun.misc.Unsafe.park(Native Method)    - parking to wait for  &lt;0x000000076ae01da0&gt; (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)    at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)    at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2039)    at lang.ThreadDemo.main(ThreadDemo.java:27)   Locked ownable synchronizers:    - None&quot;VM Thread&quot; os_prio=31 tid=0x00007fcf25015000 nid=0x4d03 runnable &quot;GC task thread#0 (ParallelGC)&quot; os_prio=31 tid=0x00007fcf26000800 nid=0x1f07 runnable &quot;GC task thread#1 (ParallelGC)&quot; os_prio=31 tid=0x00007fcf24000800 nid=0x2a03 runnable &quot;GC task thread#2 (ParallelGC)&quot; os_prio=31 tid=0x00007fcf22000800 nid=0x5303 runnable &quot;GC task thread#3 (ParallelGC)&quot; os_prio=31 tid=0x00007fcf25010000 nid=0x2b03 runnable &quot;GC task thread#4 (ParallelGC)&quot; os_prio=31 tid=0x00007fcf22014000 nid=0x5103 runnable &quot;GC task thread#5 (ParallelGC)&quot; os_prio=31 tid=0x00007fcf24001000 nid=0x5003 runnable &quot;GC task thread#6 (ParallelGC)&quot; os_prio=31 tid=0x00007fcf22014800 nid=0x2e03 runnable &quot;GC task thread#7 (ParallelGC)&quot; os_prio=31 tid=0x00007fcf22015000 nid=0x4e03 runnable &quot;VM Periodic Task Thread&quot; os_prio=31 tid=0x00007fcf250c5000 nid=0x5503 waiting on condition JNI global references: 33</code></pre><p>å¯ä»¥å‘ç° å…¶ä¸­ 6-10ä¸º:</p><ul><li>â€œC2 CompilerThread0â€ #6</li><li>â€œC2 CompilerThread1â€ #7</li><li>â€œC2 CompilerThread2â€ #8</li><li>â€œC1 CompilerThread3â€ #9</li><li>â€œService Threadâ€ #10</li></ul><p>ä¸ºä»€ä¹ˆè¿™äº›åœ¨dumpThreadInfo æ²¡æœ‰æ‰“å°å‡ºæ¥?</p><h5 id="vmå†…éƒ¨çº¿ç¨‹-VM-internal-JavaThreads"><a href="#vmå†…éƒ¨çº¿ç¨‹-VM-internal-JavaThreads" class="headerlink" title="vmå†…éƒ¨çº¿ç¨‹(VM internal JavaThreads)"></a>vmå†…éƒ¨çº¿ç¨‹(VM internal JavaThreads)</h5><p> åœ¨/src/share/vm/prims/jvm.cppä¸­ </p><pre><code class="c++">// Returns an array of all live Thread objects (VM internal JavaThreads,// jvmti agent threads, and JNI attaching threads  are skipped)// See CR 6404306 regarding JNI attaching threadsJVM_ENTRY(jobjectArray, JVM_GetAllThreads(JNIEnv *env, jclass dummy))  ResourceMark rm(THREAD);  ThreadsListEnumerator tle(THREAD, false, false);  JvmtiVMObjectAllocEventCollector oam;  int num_threads = tle.num_threads();  objArrayOop r = oopFactory::new_objArray(SystemDictionary::Thread_klass(), num_threads, CHECK_NULL);  objArrayHandle threads_ah(THREAD, r);  for (int i = 0; i &lt; num_threads; i++) {    Handle h = tle.get_threadObj(i);    threads_ah-&gt;obj_at_put(i, h());  }</code></pre><p>å…¶ä¸­ç®€å•ç¿»è¯‘ä¸€ä¸‹æ–¹æ³•çš„æ³¨é‡Š<br>è¿”å›æ‰€æœ‰æ´»åŠ¨çº¿ç¨‹å¯¹è±¡çš„æ•°ç»„(è·³è¿‡VMå†…éƒ¨JavaThreadsã€jvmtiä»£ç†çº¿ç¨‹å’ŒJNIé™„åŠ çº¿ç¨‹)ï¼Œè¯·å‚é˜…CR 6404306å…³äºJNIé™„åŠ çº¿ç¨‹çš„ä¿¡æ¯</p><p>å¯ä»¥çŸ¥é“ä¸ä¼šæ‰“å°VMå†…éƒ¨çš„JavaThreads</p><p>å¦å¤–çš„ JVMè‡ªèº«çš„çº¿ç¨‹(åˆå§‹åŒ–çš„æ—¶å€™åˆ›å»ºçš„,éjavaçº¿ç¨‹ æ²¡æœ‰prio=5)</p><ul><li>VM Thread</li><li>GC task thread#0-7 (8æ ¸)</li><li>VM Periodic Task Thread</li></ul><p>Thread.getAllStackTraces å…¶å®ä¹Ÿæ˜¯ private static native Thread[] getThreads();</p><p><a href="http://ifeve.com/jvm-thread/ï¼Œå¯ä»¥å–è¿™ä¸ªåœ°å€æŸ¥çœ‹æ›´å¤šçº¿ç¨‹çš„ä¿¡æ¯" target="_blank" rel="noopener">http://ifeve.com/jvm-thread/ï¼Œå¯ä»¥å–è¿™ä¸ªåœ°å€æŸ¥çœ‹æ›´å¤šçº¿ç¨‹çš„ä¿¡æ¯</a></p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> jvm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JDK_ReentrantLock</title>
      <link href="/2019/08/24/JDK-ReentrantLock/"/>
      <url>/2019/08/24/JDK-ReentrantLock/</url>
      
        <content type="html"><![CDATA[<p>é€šè¿‡ReentrantLock  , ç±»æ¥åˆ†æJUCåŒ…çš„åŸºçŸ³ AbstractQueuedSynchronizer(åç»­ç®€ç§° AQS)</p><ul><li>ReentrantLock skeleton</li><li>AQS  skeleton</li><li>Lock ã€unlock</li><li>Condition</li></ul><a id="more"></a><h3 id="å¯é‡å…¥é”-ReentrantLock-skeleton"><a href="#å¯é‡å…¥é”-ReentrantLock-skeleton" class="headerlink" title="å¯é‡å…¥é”(ReentrantLock skeleton)"></a>å¯é‡å…¥é”(ReentrantLock skeleton)</h3><h4 id="ç±»å…³ç³»å›¾-Class-Diagrams"><a href="#ç±»å…³ç³»å›¾-Class-Diagrams" class="headerlink" title="ç±»å…³ç³»å›¾(Class Diagrams)"></a>ç±»å…³ç³»å›¾(Class Diagrams)</h4><p>â€‹    ä»ä¸‹å›¾çš„ç±»å›¾æ¥çœ‹,<code>ReentrantLock</code>  ç±»å®ç°äº†<code>Lock</code> æ¥å£, éé˜»å¡å¼,è¶…æ—¶æ”¯æŒ.</p><p>â€‹    æ›´å¤šç»†èŠ‚å‚è€ƒ <a href="https://zyumin.github.io/2019/08/10/JDK-The-Concurrent-Framework/#Locks-é”" target="_blank" rel="noopener">JDK-The-Concurrent-Framework</a></p><p><img src="http://ww2.sinaimg.cn/large/006y8mN6gy1g69g1omdxdj31c80pwgnw.jpg" width="70%" height="70%"></p><h4 id="æ¡†æ¶ç»†èŠ‚-skeleton"><a href="#æ¡†æ¶ç»†èŠ‚-skeleton" class="headerlink" title="æ¡†æ¶ç»†èŠ‚(skeleton)"></a>æ¡†æ¶ç»†èŠ‚(skeleton)</h4><p>#### </p><p><img src="http://ww4.sinaimg.cn/large/006y8mN6gy1g69k0z6ir1j30u00y8tfp.jpg" width="70%" height="70%"></p><h5 id="é”çš„å®ç°-Lock-implement"><a href="#é”çš„å®ç°-Lock-implement" class="headerlink" title="é”çš„å®ç°(Lock implement)"></a>é”çš„å®ç°(Lock implement)</h5><p>çœ‹ReentrantLockçš„æºç æˆ‘ä»¬å¯ä»¥å‘ç°,å®ç°Lockæ¥å£çš„ç±» éƒ½ç”±Sync å¤„ç†, Sync ç±»æ˜¯extends AbstractQueuedSynchronizer. Sync æœ‰ä¸¤ä¸ªå®ç°,éåˆ«æ˜¯å…¬å¹³å’Œéå…¬å¹³é”</p><h5 id="æ‰©å±•åŠŸèƒ½-extended-capabilities"><a href="#æ‰©å±•åŠŸèƒ½-extended-capabilities" class="headerlink" title="æ‰©å±•åŠŸèƒ½(extended capabilities)"></a>æ‰©å±•åŠŸèƒ½(extended capabilities)</h5><p>é™¤äº†å®ç°Lock çš„æ–¹æ³•å¤–,  è¿˜å…·æœ‰æ‰©å±•åŠŸèƒ½ã€‚è·å–ç­‰å¾…é˜Ÿåˆ—,å½“å‰çº¿ç¨‹æ˜¯å¦è·å¾—é”ç­‰ç›‘æ§</p><p>æºç :</p><pre><code class="java">public class ReentrantLock implements Lock, java.io.Serializable {    private final Sync sync;    abstract static class Sync extends AbstractQueuedSynchronizer {      ...        }        static final class NonfairSync extends Sync{}        static final class FairSync extends Sync{}        public ReentrantLock() {        sync = new NonfairSync();    }    public ReentrantLock(boolean fair) {        sync = fair ? new FairSync() : new NonfairSync();    }    public void lock() {        sync.lock();    }    public void unlock() {        sync.release(1);    }    ...}</code></pre><h3 id="æŠ½è±¡åŒæ­¥é˜Ÿåˆ—-AQS"><a href="#æŠ½è±¡åŒæ­¥é˜Ÿåˆ—-AQS" class="headerlink" title="æŠ½è±¡åŒæ­¥é˜Ÿåˆ—(AQS )"></a>æŠ½è±¡åŒæ­¥é˜Ÿåˆ—(AQS )</h3><h4 id="Class-Diagrams"><a href="#Class-Diagrams" class="headerlink" title="Class Diagrams"></a>Class Diagrams</h4><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g6aynej1qtj30u10u0n0j.jpg" alt="image-20190823192643197"></p><p>æˆ‘ä»¬éœ€è¦å…³æ³¨çš„æ˜¯è“è‰²åœˆåœˆé‡Œçš„, AQS å…¶å®åº•å±‚ç”¨çš„æ˜¯volatile çš„NodeèŠ‚ç‚¹ å’Œ CAS çš„æ“ä½œ, å®ç°é˜»å¡é˜Ÿåˆ—çš„è¯­ä¹‰.  </p><h4 id="AQS-skeleton"><a href="#AQS-skeleton" class="headerlink" title="AQS skeleton"></a>AQS skeleton</h4><p>ç®€å•æ¥è¯´, AQSçš„å®ç°å¯ä»¥ä» åŒå‘èŠ‚ç‚¹ã€ä»¥åŠç»´æŠ¤è¿™äº›èŠ‚ç‚¹çš„æ–¹æ³• è¿™ä¸¤ä¸ªæ–¹æ³•å»å½’ç±» ( è¿™é‡Œå…ˆä¸è€ƒè™‘Condition)</p><h5 id="é˜Ÿåˆ—èŠ‚ç‚¹-Node"><a href="#é˜Ÿåˆ—èŠ‚ç‚¹-Node" class="headerlink" title="é˜Ÿåˆ—èŠ‚ç‚¹(Node)"></a>é˜Ÿåˆ—èŠ‚ç‚¹(Node)</h5><h6 id="æ•°æ®ç»“æ„-struct"><a href="#æ•°æ®ç»“æ„-struct" class="headerlink" title="æ•°æ®ç»“æ„(struct)"></a>æ•°æ®ç»“æ„(struct)</h6><p>æ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨,æ³¨æ„nextWaiter æ˜¯ç”¨äºconditionçš„Node</p><pre><code class="java">        /**         * Link to predecessor node that current node/thread relies on         * for checking waitStatus. Assigned during enqueuing, and nulled         * out (for sake of GC) only upon dequeuing.  Also, upon         * cancellation of a predecessor, we short-circuit while         * finding a non-cancelled one, which will always exist         * because the head node is never cancelled: A node becomes         * head only as a result of successful acquire. A         * cancelled thread never succeeds in acquiring, and a thread only         * cancels itself, not any other node.         */        volatile Node prev;        /**         * Link to the successor node that the current node/thread         * unparks upon release. Assigned during enqueuing, adjusted         * when bypassing cancelled predecessors, and nulled out (for         * sake of GC) when dequeued.  The enq operation does not         * assign next field of a predecessor until after attachment,         * so seeing a null next field does not necessarily mean that         * node is at end of queue. However, if a next field appears         * to be null, we can scan prev&#39;s from the tail to         * double-check.  The next field of cancelled nodes is set to         * point to the node itself instead of null, to make life         * easier for isOnSyncQueue.         */        volatile Node next;        /**         * Link to next node waiting on condition, or the special         * value SHARED.  Because condition queues are accessed only         * when holding in exclusive mode, we just need a simple         * linked queue to hold nodes while they are waiting on         * conditions. They are then transferred to the queue to         * re-acquire. And because conditions can only be exclusive,         * we save a field by using special value to indicate shared         * mode.         */        Node nextWaiter;        /**         * The thread that enqueued this node.  Initialized on         * construction and nulled out after use.         */        volatile Thread thread;</code></pre><h6 id="æ¨¡å¼-mode"><a href="#æ¨¡å¼-mode" class="headerlink" title="æ¨¡å¼(mode)"></a>æ¨¡å¼(mode)</h6><p>â€‹       å…±äº«é”( ä¾‹å¦‚: è¯»é” )è¿˜æ˜¯æ’æ–¥é” </p><pre><code class="java">        /** Marker to indicate a node is waiting in shared mode */        static final Node SHARED = new Node();        /** Marker to indicate a node is waiting in exclusive mode */        static final Node EXCLUSIVE = null;        /**         * Returns true if node is waiting in shared mode.         */        final boolean isShared() {            return nextWaiter == SHARED;        }</code></pre><h6 id="çŠ¶æ€-waitStatus"><a href="#çŠ¶æ€-waitStatus" class="headerlink" title="çŠ¶æ€(waitStatus)"></a>çŠ¶æ€(waitStatus)</h6><p> çŠ¶æ€ç›¸å…³ç»†èŠ‚å¦‚ä¸‹ </p><pre><code class="java">        /** waitStatus value to indicate thread has cancelled */        static final int CANCELLED =  1;        /** waitStatus value to indicate successor&#39;s thread needs unparking */        static final int SIGNAL    = -1;        /** waitStatus value to indicate thread is waiting on condition */        static final int CONDITION = -2;        /**         * waitStatus value to indicate the next acquireShared should         * unconditionally propagate         */        static final int PROPAGATE = -3;                /**         * Status field, taking on only the values:         *   SIGNAL:     The successor of this node is (or will soon be)         *               blocked (via park), so the current node must         *               unpark its successor when it releases or         *               cancels. To avoid races, acquire methods must         *               first indicate they need a signal,         *               then retry the atomic acquire, and then,         *               on failure, block.         *   CANCELLED:  This node is cancelled due to timeout or interrupt.         *               Nodes never leave this state. In particular,         *               a thread with cancelled node never again blocks.         *   CONDITION:  This node is currently on a condition queue.         *               It will not be used as a sync queue node         *               until transferred, at which time the status         *               will be set to 0. (Use of this value here has         *               nothing to do with the other uses of the         *               field, but simplifies mechanics.)         *   PROPAGATE:  A releaseShared should be propagated to other         *               nodes. This is set (for head node only) in         *               doReleaseShared to ensure propagation         *               continues, even if other operations have         *               since intervened.         *   0:          None of the above         *         * The values are arranged numerically to simplify use.         * Non-negative values mean that a node doesn&#39;t need to         * signal. So, most code doesn&#39;t need to check for particular         * values, just for sign.         *         * The field is initialized to 0 for normal sync nodes, and         * CONDITION for condition nodes.  It is modified using CAS         * (or when possible, unconditional volatile writes).         */        volatile int waitStatus;</code></pre><h5 id="é˜Ÿåˆ—èŠ‚ç‚¹çš„ç›¸å…³æ“ä½œ-Node-operation"><a href="#é˜Ÿåˆ—èŠ‚ç‚¹çš„ç›¸å…³æ“ä½œ-Node-operation" class="headerlink" title="é˜Ÿåˆ—èŠ‚ç‚¹çš„ç›¸å…³æ“ä½œ(Node operation)"></a>é˜Ÿåˆ—èŠ‚ç‚¹çš„ç›¸å…³æ“ä½œ(Node operation)</h5><h6 id="CAS"><a href="#CAS" class="headerlink" title="CAS"></a>CAS</h6><p> å¯¹èŠ‚ç‚¹çš„casæ“ä½œ</p><pre><code class="java">    /**     * Setup to support compareAndSet. We need to natively implement     * this here: For the sake of permitting future enhancements, we     * cannot explicitly subclass AtomicInteger, which would be     * efficient and useful otherwise. So, as the lesser of evils, we     * natively implement using hotspot intrinsics API. And while we     * are at it, we do the same for other CASable fields (which could     * otherwise be done with atomic field updaters).     */    private static final Unsafe unsafe = Unsafe.getUnsafe();    private static final long stateOffset;    private static final long headOffset;    private static final long tailOffset;    private static final long waitStatusOffset;    private static final long nextOffset;    static {        try {            stateOffset = unsafe.objectFieldOffset                (AbstractQueuedSynchronizer.class.getDeclaredField(&quot;state&quot;));            headOffset = unsafe.objectFieldOffset                (AbstractQueuedSynchronizer.class.getDeclaredField(&quot;head&quot;));            tailOffset = unsafe.objectFieldOffset                (AbstractQueuedSynchronizer.class.getDeclaredField(&quot;tail&quot;));            waitStatusOffset = unsafe.objectFieldOffset                (Node.class.getDeclaredField(&quot;waitStatus&quot;));            nextOffset = unsafe.objectFieldOffset                (Node.class.getDeclaredField(&quot;next&quot;));        } catch (Exception ex) { throw new Error(ex); }    }    /**     * CAS head field. Used only by enq.     */    private final boolean compareAndSetHead(Node update) {        return unsafe.compareAndSwapObject(this, headOffset, null, update);    }    /**     * CAS tail field. Used only by enq.     */    private final boolean compareAndSetTail(Node expect, Node update) {        return unsafe.compareAndSwapObject(this, tailOffset, expect, update);    }    /**     * CAS waitStatus field of a node.     */    private static final boolean compareAndSetWaitStatus(Node node,int expect,int update) {        return unsafe.compareAndSwapInt(node, waitStatusOffset,expect, update);    }    /**     * CAS next field of a node.     */    private static final boolean compareAndSetNext(Node node,Node expect, Node update) {        return unsafe.compareAndSwapObject(node, nextOffset, expect, update);    }</code></pre><p>state</p><p> é˜Ÿåˆ—çŠ¶æ€, ä¾‹å¦‚, <code>ReentrantLock</code> ä¸­ç”¨äºè®°å½•é‡å…¥æ¬¡æ•°</p><pre><code class="java">/** * Atomically sets synchronization state to the given updated * value if the current state value equals the expected value. * This operation has memory semantics of a {@code volatile} read * and write. * * @param expect the expected value * @param update the new value * @return {@code true} if successful. False return indicates that the actual *         value was not equal to the expected value. */protected final boolean compareAndSetState(int expect, int update) {    // See below for intrinsics setup to support this    return unsafe.compareAndSwapInt(this, stateOffset, expect, update);}    /**     * The synchronization state.     */    private volatile int state;</code></pre><h6 id="UnsupportedOperationException-method"><a href="#UnsupportedOperationException-method" class="headerlink" title="UnsupportedOperationException method"></a>UnsupportedOperationException method</h6><p>å­ç±»éœ€è¦å®ç°çš„æ–¹æ³•, UnsupportedOperationException method</p><p>To use this class as the basis of a synchronizer, redefine the following methods, as applicable, by inspecting and/or modifying the synchronization state using <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/AbstractQueuedSynchronizer.html#getState--" target="_blank" rel="noopener"><code>getState()</code></a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/AbstractQueuedSynchronizer.html#setState-int-" target="_blank" rel="noopener"><code>setState(int)</code></a> and/or <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/AbstractQueuedSynchronizer.html#compareAndSetState-int-int-" target="_blank" rel="noopener"><code>compareAndSetState(int, int)</code></a>:</p><ul><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/AbstractQueuedSynchronizer.html#tryAcquire-int-" target="_blank" rel="noopener"><code>tryAcquire(int)</code></a></li><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/AbstractQueuedSynchronizer.html#tryRelease-int-" target="_blank" rel="noopener"><code>tryRelease(int)</code></a></li><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/AbstractQueuedSynchronizer.html#tryAcquireShared-int-" target="_blank" rel="noopener"><code>tryAcquireShared(int)</code></a></li><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/AbstractQueuedSynchronizer.html#tryReleaseShared-int-" target="_blank" rel="noopener"><code>tryReleaseShared(int)</code></a></li><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/AbstractQueuedSynchronizer.html#isHeldExclusively--" target="_blank" rel="noopener"><code>isHeldExclusively()</code></a></li></ul><p>Each of these methods by default throws <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/UnsupportedOperationException.html" target="_blank" rel="noopener"><code>UnsupportedOperationException</code></a><em>only</em><code>final</code></p><p>You may also find the inherited methods from <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/AbstractOwnableSynchronizer.html" target="_blank" rel="noopener"><code>AbstractOwnableSynchronizer</code></a> useful to keep track of the thread owning an exclusive synchronizer. You are encouraged to use them â€“ this enables monitoring and diagnostic tools to assist users in determining which threads hold locks.</p><h5 id="Condition"><a href="#Condition" class="headerlink" title="Condition"></a>Condition</h5><p>æ¡ä»¶é˜Ÿåˆ—ç›¸å…³,ä¸‹æ–‡åˆ†æ</p><h5 id="AQS-impl-example"><a href="#AQS-impl-example" class="headerlink" title="AQS impl example"></a>AQS impl example</h5><p>ReentrantLockä¸­çš„å®ç°,  é‡ç‚¹çœ‹çœ‹tryAcquire tryReleaseçš„å®ç°,  è¿™é‡Œä»¥Syncçš„å®ç°NonfairSync (é»˜è®¤çš„éå…¬å¹³é”,æ³¨æ„éå…¬å¹³ä½“ç° ä¸èƒ½ä¿è¯FIFO,ä¼šé€ æˆçº¿ç¨‹é¥¥é¥¿, ä½†æ˜¯å¥½å¤„æ˜¯å‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢)åˆ†æ</p><p>Sync:</p><pre><code class="java">abstract static class Sync extends AbstractQueuedSynchronizer {        //æŠ½è±¡æ–¹æ³• ç•™ç»™å­ç±»å®ç°        abstract void lock();        // å°è¯•åŠ é”,åˆå§‹åŒ–æˆ–è€…é‡å…¥å¯ä»¥åŠ é”æˆåŠŸ        final boolean nonfairTryAcquire(int acquires) {            final Thread current = Thread.currentThread();            int c = getState();            if (c == 0) {                if (compareAndSetState(0, acquires)) {                    setExclusiveOwnerThread(current);                    return true;                }            }            else if (current == getExclusiveOwnerThread()) {                int nextc = c + acquires;                if (nextc &lt; 0) // overflow                    throw new Error(&quot;Maximum lock count exceeded&quot;);                setState(nextc);                return true;            }            return false;        }        //å°è¯•é‡Šæ”¾é”        protected final boolean tryRelease(int releases) {            int c = getState() - releases;            if (Thread.currentThread() != getExclusiveOwnerThread())                throw new IllegalMonitorStateException();            boolean free = false;            if (c == 0) {                free = true;                setExclusiveOwnerThread(null);            }            setState(c);            return free;        }        //å½“å‰çº¿ç¨‹æ˜¯å¦æŒæœ‰é”        protected final boolean isHeldExclusively() {            // While we must in general read state before owner,            // we don&#39;t need to do so to check if current thread is owner            return getExclusiveOwnerThread() == Thread.currentThread();        }                   ...}</code></pre><p>NonfairSync :</p><pre><code class="java">static final class NonfairSync extends Sync {    private static final long serialVersionUID = 7316153563782823691L;    /**     * Performs lock.  Try immediate barge, backing up to normal     * acquire on failure.     */    final void lock() {        if (compareAndSetState(0, 1))            setExclusiveOwnerThread(Thread.currentThread());        else            acquire(1);    }    protected final boolean tryAcquire(int acquires) {        return nonfairTryAcquire(acquires);    }}</code></pre><h3 id="åŠ é”-è§£é”åˆ†æ-lock-unlock"><a href="#åŠ é”-è§£é”åˆ†æ-lock-unlock" class="headerlink" title="åŠ é”/è§£é”åˆ†æ (lock /unlock)"></a>åŠ é”/è§£é”åˆ†æ (lock /unlock)</h3><p>æˆ‘ä»¬ä»<code>java.util.concurrent.locks.ReentrantLock.NonfairSync#lock</code>å…¥æ‰‹ , æ¥çœ‹çœ‹è¯­è¨€å±‚é¢æ€ä¹ˆå®ç°åŒæ­¥è¯­ä¹‰( æ³¨æ„,å®ç°è¿‡ç¨‹æ²¡æœ‰ç”¨åˆ°åŒæ­¥è¯­ä¹‰,æ‰€ä»¥æˆ‘ä»¬è¦é‡ç‚¹å…³æ³¨volidate,cas ä»¥åŠé¡ºåºç­‰)</p><pre><code class="java">/** * Performs lock.  Try immediate barge, backing up to normal * acquire on failure. */final void lock() {    //CASè®¾ç½®state,æˆåŠŸåˆ™è·å–é”,å¹¶è®¾ç½®å½“å‰å æœ‰é”çš„çº¿ç¨‹    if (compareAndSetState(0, 1))        setExclusiveOwnerThread(Thread.currentThread());    else   //å¦åˆ™è¿›è¡Œè·å–é”çš„æ“ä½œ(é˜»å¡ã€å…¥é˜Ÿç­‰)        acquire(1);}</code></pre><p>å¦‚æœCASè·å–å¤±è´¥, è°ƒç”¨<code>java.util.concurrent.locks.AbstractQueuedSynchronizer#acquire</code></p><pre><code class="java"> /**  * Acquires in exclusive mode, ignoring interrupts.  Implemented  * by invoking at least once {@link #tryAcquire},  * returning on success.  Otherwise the thread is queued, possibly  * repeatedly blocking and unblocking, invoking {@link  * #tryAcquire} until success.  This method can be used  * to implement method {@link Lock#lock}.  *  * @param arg the acquire argument.  This value is conveyed to  *  {@link #tryAcquire} but is otherwise uninterpreted and  *  can represent anything you like.  */public final void acquire(int arg) {    //è·å–å¤±è´¥ , å¹¶ä¸”è¿”å›acquireQueued è¿”å›true(é˜»å¡çŠ¶æ€è¢«ä¸­æ–­)     if (!tryAcquire(arg) &amp;&amp;        acquireQueued(addWaiter(Node.EXCLUSIVE), arg))        //å›æ”¾ä¸­æ–­        selfInterrupt();}</code></pre><p>ä¸‹é¢, ä¾æ¬¡åˆ†æä¸‹é¢ä¸‰ä¸ªæ–¹æ³•:</p><ul><li>tryAcquire</li><li>addWaiter</li><li>acquireQueued</li></ul><h4 id="tryAcquire"><a href="#tryAcquire" class="headerlink" title="tryAcquire"></a>tryAcquire</h4><p>åœ¨é˜»å¡ä¹‹å‰, å†æ¬¡(æ³¨æ„åœ¨ä¸€å¼€å§‹lockæ–¹æ³•ä¸­å°±å°è¯•è¿‡ä¸€æ¬¡, å¯èƒ½æ˜¯ä½œè€…æœ‰æ„ä¸ºä¹‹,æˆ–æ˜¯â€¦)å°è¯•è·å–</p><pre><code class="java">  protected final boolean tryAcquire(int acquires) {      return nonfairTryAcquire(acquires);  }  final boolean nonfairTryAcquire(int acquires) {      final Thread current = Thread.currentThread();      int c = getState();      //å¦‚æœå½“å‰stateä¸º0, å†æ¬¡å°è¯•è·å–      if (c == 0) {    if (compareAndSetState(0, acquires)) {        setExclusiveOwnerThread(current);        return true;    }      }      //åˆ¤æ–­æ˜¯å¦é‡å…¥çº¿ç¨‹      else if (current == getExclusiveOwnerThread()) {    //è¿™é‡Œæ“ä½œæ— éœ€åŠ é”, æ˜¯çº¿ç¨‹å®‰å…¨çš„,å…¶ä»–çº¿ç¨‹æ˜¯è¿›ä¸åˆ°è¿™é‡Œ    int nextc = c + acquires;    //æœ€å¤§å¯é‡å…¥æ¬¡æ•°æ˜¯Integer.MAX    if (nextc &lt; 0) // overflow        throw new Error(&quot;Maximum lock count exceeded&quot;);    setState(nextc);    return true;      }      return false;  }</code></pre><h4 id="addWaiter"><a href="#addWaiter" class="headerlink" title="addWaiter"></a>addWaiter</h4><p> å› ä¸ºç¬¬ä¸€æ¬¡CASå°è¯•é€»è¾‘å’Œenqæ–¹æ³•ä¸­ä¸€è‡´, æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å…³æ³¨enqä¸­çš„æ“ä½œå³å¯</p><pre><code class="java">/** * Creates and enqueues node for current thread and given mode. * * @param mode Node.EXCLUSIVE for exclusive, Node.SHARED for shared * @return the new node */private Node addWaiter(Node mode) {    //æ³¨æ„è¿™é‡Œå…¥å‚modeæ˜¯EXCLUSIVE , å³ä¸Šé¢Nodeä¸­çš„mode    Node node = new Node(Thread.currentThread(), mode);    // Try the fast path of enq; backup to full enq on failure    Node pred = tail;    //å½“tailé˜Ÿåˆ—ä¸ä¸ºç©ºçš„æ—¶å€™,è¯´æ˜å·²ç»åˆå§‹åŒ–è¿‡äº†, ç›´æ¥è¿›è¡Œä¸€æ¬¡CASæ“ä½œ    if (pred != null) {        node.prev = pred;        if (compareAndSetTail(pred, node)) {            pred.next = node;            return node;        }    }    //å¦åˆ™è¿›å…¥enq    enq(node);    return node;}  /**   * Inserts node into queue, initializing if necessary. See picture above.   * @param node the node to insert   * @return node&#39;s predecessor   */  private Node enq(final Node node) {    for (;;) {      Node t = tail;      //åˆå§‹åŒ–é˜Ÿåˆ—      if (t == null) { // Must initialize        if (compareAndSetHead(new Node()))          tail = head;      } else {        //éåŸå­æ“ä½œ, ä¼šå‡ºç° &quot;é˜Ÿåˆ—åœ¨prevæ–¹å‘ä¸€è‡´ï¼Œnextæ–¹å‘ä¸ä¸€è‡´&quot;        node.prev = t;        if (compareAndSetTail(t, node)) {          t.next = node;          return t;        }      }    }  }</code></pre><p>æ³¨æ„è¿™é‡Œ, åœ¨æ’å…¥è¿‡ç¨‹ä¸­ï¼Œä¼šå‡ºç°â€œnode.prevæŒ‡å‘æ—§çš„å°¾èŠ‚ç‚¹ï¼Œä½†æ—§çš„å°¾èŠ‚ç‚¹.nextä¸ºnullæœªæŒ‡å‘nodeï¼ˆå°½ç®¡ï¼Œå°¾æŒ‡é’ˆæŒ‡å‘nodeï¼‰â€çš„çŠ¶æ€ï¼Œå³â€œ<strong>é˜Ÿåˆ—åœ¨prevæ–¹å‘ä¸€è‡´ï¼Œnextæ–¹å‘ä¸ä¸€è‡´</strong>â€</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g6aync8atgj30nq0b5q3c.jpg" alt="AQS@enqÃ¥Â¼Â±Ã¤Â¸Â€Ã¨Â‡Â´Ã§ÂŠÂ¶Ã¦Â€Â"></p><h4 id="acquireQueued"><a href="#acquireQueued" class="headerlink" title="acquireQueued"></a>acquireQueued</h4><p>ç»è¿‡ä¸Šè¿°æ“ä½œ, åªæ˜¯æ’å…¥äº†é˜Ÿåˆ—, çŠ¶æ€å¹¶æœªå˜æ›´, æ‰€ä»¥è¿™é‡Œè¦åšçš„å°±æ˜¯çŠ¶æ€çš„ç»´æŠ¤</p><pre><code class="java">/** * Acquires in exclusive uninterruptible mode for thread already in * queue. Used by condition wait methods as well as acquire. * * @param node the node * @param arg the acquire argument * @return {@code true} if interrupted while waiting */final boolean acquireQueued(final Node node, int arg) {    boolean failed = true;    try {        boolean interrupted = false;        for (;;) {            final Node p = node.predecessor();            //å¦‚æœå½“å‰èŠ‚ç‚¹çš„å‰ç»§èŠ‚ç‚¹æ˜¯å¤´èŠ‚ç‚¹,æ‰å¼€å§‹å°è¯•è·å–é”,è·å–æˆåŠŸåˆ™è¿”å›            if (p == head &amp;&amp; tryAcquire(arg)) {                //Head ä¸€å¼€å§‹ä¸ºç©ºèŠ‚ç‚¹                setHead(node);                p.next = null; // help GC                failed = false;                return interrupted;            }            //å¦åˆ™,é˜»å¡æˆ–å¤„ç†ä¸­æ–­            if (shouldParkAfterFailedAcquire(p, node) &amp;&amp;                parkAndCheckInterrupt())                interrupted = true;        }    } finally {        if (failed)            cancelAcquire(node);    }}</code></pre><p>â€‹    å¦‚æœè·å–å¤±è´¥,  AQS.shouldParkAfterFailedAcquire()åˆ¤æ–­æ˜¯å¦éœ€è¦é˜»å¡ç­‰å¾…ï¼Œå¦‚æœéœ€è¦ï¼Œåˆ™é€šè¿‡AQS#parkAndCheckInterrupt()é˜»å¡ç­‰å¾…ï¼Œç›´åˆ°è¢«å”¤é†’æˆ–è¢«ä¸­æ–­ã€‚</p><h6 id="shouldParkAfterFailedAcquire"><a href="#shouldParkAfterFailedAcquire" class="headerlink" title="shouldParkAfterFailedAcquire"></a>shouldParkAfterFailedAcquire</h6><p>â€‹    è¯·æ±‚è·å–é”å¤±è´¥åå¤„ç†, æ˜¯å¦éœ€è¦é˜»å¡åˆ¤æ–­,ä»¥åŠé˜Ÿåˆ—çŠ¶æ€çš„ç»´æŠ¤</p><pre><code class="java">  /**   * Checks and updates status for a node that failed to acquire.   * Returns true if thread should block. This is the main signal   * control in all acquire loops.  Requires that pred == node.prev.   *   * @param pred node&#39;s predecessor holding status   * @param node the node   * @return {@code true} if thread should block   */  private static boolean shouldParkAfterFailedAcquire(Node pred, Node node) {    int ws = pred.waitStatus;    if (ws == Node.SIGNAL)      /*       * This node has already set status asking a release       * to signal it, so it can safely park.       */      return true;    //å¦‚æœå‰ç»§èŠ‚ç‚¹çš„çŠ¶æ€å¤§äº0,åˆ™ä»£è¡¨æ˜¯å–æ¶ˆçŠ¶æ€,éœ€è¦ç»´æŠ¤é˜Ÿåˆ—èŠ‚ç‚¹çš„çŠ¶æ€    if (ws &gt; 0) {      /*       * Predecessor was cancelled. Skip over predecessors and       * indicate retry.       */      //å› ä¸ºå½“å‰nodeä¸ºå°¾èŠ‚ç‚¹,éå†é˜Ÿåˆ—, æ‰¾åˆ°æœªè¢«å–æ¶ˆçš„èŠ‚ç‚¹      do {        node.prev = pred = pred.prev;      } while (pred.waitStatus &gt; 0);      //éåŸå­æ“ä½œ, ä¼šå‡ºç° &quot;é˜Ÿåˆ—åœ¨prevæ–¹å‘ä¸€è‡´ï¼Œnextæ–¹å‘ä¸ä¸€è‡´&quot;      pred.next = node;    } else {      /*       * waitStatus must be 0 or PROPAGATE.  Indicate that we       * need a signal, but don&#39;t park yet.  Caller will need to       * retry to make sure it cannot acquire before parking.       */      //CASä¿®æ”¹wsçš„çŠ¶æ€,ç›´åˆ°wsçš„çŠ¶æ€ä¿®æ”¹æˆåŠŸ,æ‰è¿”å›trueéœ€è¦é˜»å¡      compareAndSetWaitStatus(pred, ws, Node.SIGNAL);    }    return false;  }</code></pre><p>æ³¨æ„è¿™é‡Œ, åœ¨æ’å…¥è¿‡ç¨‹ä¸­ï¼Œä¼šå‡ºç°â€œnode.prevæŒ‡å‘éCACELLEDçš„nodeï¼ŒéCACELLEDçš„node.nextæŒ‡å‘nodeï¼ˆCACELLEDï¼‰â€çš„çŠ¶æ€ï¼Œå³â€œ<strong>é˜Ÿåˆ—åœ¨prevæ–¹å‘ä¸€è‡´ï¼Œnextæ–¹å‘ä¸ä¸€è‡´</strong>â€</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g6aynd2ovpj31cm0jkab7.jpg" alt="image-20190824131725953"></p><h6 id="parkAndCheckInterrupt"><a href="#parkAndCheckInterrupt" class="headerlink" title="parkAndCheckInterrupt"></a>parkAndCheckInterrupt</h6><pre><code class="java">  /**   * Convenience method to park and then check if interrupted   *   * @return {@code true} if interrupted   */  private final boolean parkAndCheckInterrupt() {    LockSupport.park(this);    return Thread.interrupted();  }</code></pre><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><h5 id="é˜Ÿåˆ—çŠ¶æ€"><a href="#é˜Ÿåˆ—çŠ¶æ€" class="headerlink" title="é˜Ÿåˆ—çŠ¶æ€"></a>é˜Ÿåˆ—çŠ¶æ€</h5><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g6ayndml1ij318w0j8q3z.jpg" alt="image-20190824114533939"></p><ul><li>é™¤äº†å¤´èŠ‚ç‚¹ï¼Œå‰©ä½™èŠ‚ç‚¹éƒ½è¢«é˜»å¡ï¼Œçº¿ç¨‹å¤„äº<code>WAITING</code>çŠ¶æ€ã€‚</li><li>é™¤äº†å°¾èŠ‚ç‚¹ï¼Œå‰©ä½™èŠ‚ç‚¹éƒ½æ»¡è¶³<code>waitStatus==SIGNAL</code>ï¼Œè¡¨ç¤ºé‡Šæ”¾åéœ€è¦å”¤é†’åç»§èŠ‚ç‚¹ã€‚</li></ul><p>tips:unlockçš„å¯ä»¥æŒ‰ç…§ä»¥ä¸Šåˆ†æ</p><h5 id="ä¸€è‡´æ€§é—®é¢˜"><a href="#ä¸€è‡´æ€§é—®é¢˜" class="headerlink" title="ä¸€è‡´æ€§é—®é¢˜"></a>ä¸€è‡´æ€§é—®é¢˜</h5><p>â€‹    ä¸ºä»€ä¹ˆè¦ä»å°¾èŠ‚ç‚¹å‘å‰éå†ï¼Œè€Œä¸èƒ½ä»nodeå‘åéå†ï¼Ÿè¿™æ˜¯å› ä¸ºï¼ŒAQSä¸­çš„ç­‰å¾…é˜Ÿåˆ—åŸºäºä¸€ä¸ªå¼±ä¸€è‡´æ€§åŒå‘é“¾è¡¨å®ç°ï¼Œå…è®¸æŸäº›æ—¶åˆ»ä¸‹ï¼Œ<strong>é˜Ÿåˆ—åœ¨prevæ–¹å‘ä¸€è‡´ï¼Œnextæ–¹å‘ä¸ä¸€è‡´</strong>ã€‚ (ä¸Šè¿°å·²ç»åˆ†æäº†,è¿™é‡Œåšä¸ªæ€»ç»“)</p><blockquote><p>ç†æƒ³æƒ…å†µä¸‹ï¼Œé˜Ÿåˆ—æ¯æ—¶æ¯åˆ»éƒ½å¤„äºä¸€è‡´çš„çŠ¶æ€ï¼ˆå¼ºä¸€è‡´æ€§æ¨¡å‹ï¼‰ï¼Œä»nodeå‘åéå†æ‰¾ç¬¬ä¸€ä¸ªæœªå–æ¶ˆèŠ‚ç‚¹æ˜¯æ›´é«˜æ•ˆçš„åšæ³•ã€‚ç„¶è€Œï¼Œç»´æŠ¤ä¸€è‡´æ€§é€šå¸¸éœ€è¦ç‰ºç‰²éƒ¨åˆ†æ€§èƒ½ï¼Œä¸ºäº†è¿›ä¸€æ­¥çš„æå‡æ€§èƒ½ï¼Œè„‘æ´å¤§å¼€çš„ç¥ç‰›ä»¬æƒ³å‡ºäº†å„ç§é«˜æ€§èƒ½çš„å¼±ä¸€è‡´æ€§æ¨¡å‹ã€‚å°½ç®¡æ¨¡å‹å…è®¸äº†æ›´å¤šå¼±ä¸€è‡´çŠ¶æ€ï¼Œä½†æ‰€æœ‰å¼±ä¸€è‡´çŠ¶æ€éƒ½åœ¨æ§åˆ¶ä¹‹ä¸‹ï¼Œä¸ä¼šå‡ºç°ä¸€è‡´æ€§é—®é¢˜ã€‚</p></blockquote><h5 id="å¯è§æ€§é—®é¢˜"><a href="#å¯è§æ€§é—®é¢˜" class="headerlink" title="å¯è§æ€§é—®é¢˜"></a>å¯è§æ€§é—®é¢˜</h5><p>æˆ‘ä»¬ä»¥tryReleaseä¸ºä¾‹å­, çœ‹volidateçš„ç”¨æ³•(å¯¹ç…§tryAcquireåˆ†ætryRelease)</p><pre><code class="java">protected final boolean tryRelease(int releases) {    int c = getState() - releases;    if (Thread.currentThread() != getExclusiveOwnerThread())        throw new IllegalMonitorStateException();    boolean free = false;    if (c == 0) {        free = true;        //å…ˆå†™exclusiveOwnerThread C        setExclusiveOwnerThread(null);    }    //å†å†™state D    setState(c);    return free;}//final boolean nonfairTryAcquire(int acquires) {    final Thread current = Thread.currentThread();    //å…ˆè¯»state  A    int c = getState();    if (c == 0) {      if (compareAndSetState(0, acquires)) {        setExclusiveOwnerThread(current);        return true;      }    }    //å†è¯»exclusiveOwnerThread B    else if (current == getExclusiveOwnerThread()) {      int nextc = c + acquires;      if (nextc &lt; 0) // overflow        throw new Error(&quot;Maximum lock count exceeded&quot;);      setState(nextc);      return true;    }    return false;  }</code></pre><p>æ ¸å¿ƒæ˜¯ä¸‰æ¡Happens-Beforeè§„åˆ™ï¼š</p><ul><li><code>ç¨‹åºé¡ºåºè§„åˆ™</code>ï¼šå¦‚æœç¨‹åºä¸­æ“ä½œAåœ¨æ“ä½œBä¹‹å‰ï¼Œé‚£ä¹ˆåœ¨çº¿ç¨‹ä¸­æ“ä½œAå°†åœ¨æ“ä½œBä¹‹å‰æ‰§è¡Œã€‚</li><li><code>ä¼ é€’æ€§</code>ï¼šå¦‚æœæ“ä½œAåœ¨æ“ä½œBä¹‹å‰æ‰§è¡Œï¼Œå¹¶ä¸”æ“ä½œBåœ¨æ“ä½œCä¹‹å‰æ‰§è¡Œï¼Œé‚£ä¹ˆæ“ä½œAå¿…é¡»åœ¨æ“ä½œCä¹‹å‰æ‰§è¡Œã€‚</li><li><code>volatileå˜é‡è§„åˆ™</code>ï¼šå¯¹volatileå˜é‡çš„å†™å…¥æ“ä½œå¿…é¡»åœ¨å¯¹è¯¥å˜é‡çš„è¯»æ“ä½œä¹‹å‰æ‰§è¡Œã€‚</li></ul><p>ä¸‹é¢åˆ†æä¸ºä»€ä¹ˆCå’ŒDè¦æŒ‰ç…§è¿™æ ·çš„é¡ºåº</p><p>æ ¹æ®h-bè§„åˆ™å¯è§æ€§åˆ†æ:</p><ul><li>A-&gt;B</li><li>C-&gt;D</li><li>D-&gt;A</li><li>C-&gt;B</li></ul><p>æ¨å‡º:</p><p><strong>C(å†™exclusiveOwnerThread)-&gt;D(å†™state)-&gt;A(è¯»state)-&gt;B(è¯»exclusiveOwnerThread)</strong></p><p><strong>ä¿è¯æ‰€æœ‰å†™å¯¹æ‰€æœ‰è¯»å¯è§</strong></p><hr><p>å¦åˆ™, å‡è®¾Cå’ŒDæ“ä½œäº’æ¢ä¸‹</p><ul><li>A(è¯»state)-&gt;B(è¯»ex)</li><li>C(å†™state)-&gt;D(å†™ex)</li><li>C-&gt;A</li><li>D-&gt;B</li></ul><p>æ¨å‡º:</p><ul><li>C-&gt;D-&gt;B</li><li>C-&gt;A-&gt;B</li></ul><p><strong>D(å†™ex)å’ŒA(è¯»state)æ²¡æœ‰h-bå…³ç³»</strong></p><h3 id="æ¡ä»¶åˆ†æ-Condition"><a href="#æ¡ä»¶åˆ†æ-Condition" class="headerlink" title="æ¡ä»¶åˆ†æ(Condition)"></a>æ¡ä»¶åˆ†æ(Condition)</h3><p>Lockæ¥å£å¯¹æ ‡å†…ç½®é”ï¼Œè€ŒConditionæ¥å£å¯¹æ ‡å†…ç½®æ¡ä»¶é˜Ÿåˆ—ã€‚Conditionä¸»è¦æä¾›äº†awaitã€signalä¸¤ç§è¯­ä¹‰ï¼Œå’Œä¸¤ç§è¯­ä¹‰çš„è¡ç”Ÿå“ã€‚</p><h4 id="ç±»å…³ç³»å›¾-Class-Diagrams-1"><a href="#ç±»å…³ç³»å›¾-Class-Diagrams-1" class="headerlink" title="ç±»å…³ç³»å›¾(Class Diagrams)"></a>ç±»å…³ç³»å›¾(Class Diagrams)</h4><p>ä¸AQS skeletonç±»ä¼¼,ä¹Ÿæ˜¯ç»´æŠ¤äº†ä¸€ä¸ªæ¡ä»¶é˜Ÿåˆ—,ä¸‹é¢ä»¥awaitå’Œsignal()åˆ†æ</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g6aynfh4hvj30u0101gqh.jpg" alt="image-20190824151905654"></p><h4 id="await"><a href="#await" class="headerlink" title="await"></a>await</h4><p>å¯ä»¥å…ˆç®€å•ç†è§£æ²¡æœ‰ä¸­æ–­ç‰ˆæœ¬çš„,åªæ˜¯è®¾ç½®ä¸­æ–­æ ‡è®°,ä¸ä¼šæŠ›å‡ºå¼‚å¸¸</p><pre><code class="java">public final void awaitUninterruptibly() {    Node node = addConditionWaiter();    int savedState = fullyRelease(node);    boolean interrupted = false;    while (!isOnSyncQueue(node)) {        LockSupport.park(this);        if (Thread.interrupted())            interrupted = true;    }    if (acquireQueued(node, savedState) || interrupted)        selfInterrupt();}</code></pre><p>æ³¨æ„è°ƒç”¨await,ä¼šé‡Šæ”¾å½“å‰çº¿ç¨‹æŒæœ‰çš„Lock,çŸ¥é“è¢«é€šçŸ¥æˆ–ä¸­æ–­(signal)</p><pre><code class="java">public final void await() throws InterruptedException {    if (Thread.interrupted())        throw new InterruptedException();    // åˆ›å»ºç­‰å¾…èŠ‚ç‚¹å¹¶æ”¾å…¥é˜Ÿå°¾    Node node = addConditionWaiter();    //é‡Šæ”¾é”å¹¶ä¿å­˜é‡Šæ”¾å‰çš„çŠ¶æ€(é‡Šæ”¾çš„æ˜¯Lock,å¦åˆ™å¤–éƒ¨æ— æ³•è·å–)        int savedState = fullyRelease(node);    /***** æ— é”çŠ¶æ€å¼€å§‹ *****/    int interruptMode = 0;    //å¦‚æœä¸åœ¨AQSçš„åŒæ­¥é˜Ÿåˆ—ä¸­(signalä¸­å…¥é˜Ÿ), é˜»å¡,ç›´åˆ°æ”¶åˆ°ä¿¡å·æˆ–è¢«ä¸­æ–­    while (!isOnSyncQueue(node)) {        LockSupport.park(this);        //ç°åœ¨nodeçš„æ˜¯AQSæ¡ä»¶é˜Ÿåˆ—ä¸Šçš„èŠ‚ç‚¹,åç»­çš„æ“ä½œ ä¸#lockæ–¹æ³•çš„ç±»ä¼¼        if ((interruptMode = checkInterruptWhileWaiting(node)) != 0)            break;    }                        //æ¢å¤ç”³è¯·é”çŠ¶æ€,å¹¶æ›´æ–°ä¸­æ–­çŠ¶æ€    if (acquireQueued(node, savedState) &amp;&amp; interruptMode != THROW_IE)        interruptMode = REINTERRUPT;     /***** æ— é”çŠ¶æ€ç»“æŸ *****/    //æ¸…ç†å·²è¢«å–æ¶ˆçš„èŠ‚ç‚¹,åˆ™è¡¨ç¤ºåœ¨doSignalä¸­æ²¡æœ‰å®Œæˆ =nullçš„æ“ä½œ    if (node.nextWaiter != null) // clean up if cancelled        unlinkCancelledWaiters();    //å¦‚æœä¹‹å‰å‘ç”Ÿä¸­æ–­,åˆ™æ›´å…·ä¸­æ–­æ¨¡å¼é‡æ”¾ä¸­æ–­    if (interruptMode != 0)        reportInterruptAfterWait(interruptMode);}</code></pre><p>ConditionObject#await()åŒReentrantLock#lockInterruptibly()ä¸€æ ·ï¼Œéƒ½æ˜¯å¯ä¸­æ–­çš„ï¼šè°ƒç”¨ConditionObject#await()åï¼Œå½“å‰çº¿ç¨‹å°†ä¿æŒé˜»å¡ï¼Œç›´åˆ°æ”¶åˆ°ä¿¡å·æˆ–è¢«ä¸­æ–­ã€‚</p><h5 id="addConditionWaiter"><a href="#addConditionWaiter" class="headerlink" title="addConditionWaiter"></a>addConditionWaiter</h5><p>java.util.concurrent.locks.AbstractQueuedSynchronizer.ConditionObject#addConditionWaiter</p><p>åˆ›å»ºèŠ‚ç‚¹, å¹¶æ”¾å…¥å°¾éƒ¨</p><pre><code class="java">/** * Adds a new waiter to wait queue. * @return its new wait node */private Node addConditionWaiter() {    Node t = lastWaiter;    // If lastWaiter is cancelled, clean out.    // ç»´æŠ¤é˜Ÿåˆ—çŠ¶æ€    if (t != null &amp;&amp; t.waitStatus != Node.CONDITION) {        unlinkCancelledWaiters();        t = lastWaiter;    }    Node node = new Node(Thread.currentThread(), Node.CONDITION);    //é˜Ÿåˆ—æ˜¯å¦ä¸ºç©º,åˆå§‹åŒ–å¤´èŠ‚ç‚¹    if (t == null)        firstWaiter = node;    else        t.nextWaiter = node;    lastWaiter = node;    return node;}</code></pre><p>éœ€è¦æé†’ä¸€ä¸‹ï¼Œå°½ç®¡æ­¤å¤„æ²¡æœ‰ä»»ä½•çº¿ç¨‹å®‰å…¨çš„ä¿æŠ¤ï¼Œä½†å®é™…ä½¿ç”¨æ—¶ä¸ä¼šå‡ºç°ä»»ä½•çº¿ç¨‹å®‰å…¨é—®é¢˜â€”â€”å› ä¸º<strong>æ¡ä»¶é˜Ÿåˆ—çš„ä½¿ç”¨è¦æ±‚æˆ‘ä»¬åœ¨è°ƒç”¨awaitæˆ–signalæ—¶æŒæœ‰ä¸è¯¥æ¡ä»¶é˜Ÿåˆ—å”¯ä¸€ç›¸å…³çš„é”</strong>ã€‚(å’ŒAQSä¸­çš„é˜Ÿåˆ—çš„æ“ä½œç›¸æ¯”,æ²¡æœ‰CASæ“ä½œ)</p><p>åˆ°è¿™é‡Œï¼Œå¾—åˆ°ä¸¤ä¸ªReentrantLockä¸ConditionObjectåœ¨å®ç°ä¸Šçš„é‡è¦åŒºåˆ«ï¼š</p><ul><li><p>ReentrantLockåˆ›å»ºçš„èŠ‚ç‚¹ï¼Œåˆå§‹çŠ¶æ€ä¸º0ï¼›è€ŒConditionObjectåˆ›å»ºçš„èŠ‚ç‚¹ï¼Œåˆå§‹çŠ¶æ€ä¸º<code>CONDITION==-2</code>ã€‚</p></li><li><p>ReentrantLockä½¿ç”¨AQSå†…ç½®çš„ç­‰å¾…é˜Ÿåˆ—ï¼Œç”±AQSç»´æŠ¤ï¼›è€Œæ¯ä¸ªConditionObjectéƒ½ç»´æŠ¤è‡ªå·±çš„ç­‰å¾…é˜Ÿåˆ—ã€‚</p></li></ul><h5 id="fullyRelease-é‡Šæ”¾Lock"><a href="#fullyRelease-é‡Šæ”¾Lock" class="headerlink" title="fullyRelease(é‡Šæ”¾Lock)"></a>fullyRelease(é‡Šæ”¾Lock)</h5><p>java.util.concurrent.locks.AbstractQueuedSynchronizer#fullyRelease</p><p>é‡Šæ”¾é”å¹¶ä¿å­˜é‡Šæ”¾å‰çš„çŠ¶æ€,é‡å…¥æ¬¡æ•° (é‡Šæ”¾çš„æ˜¯Lock,å¦åˆ™å¤–éƒ¨æ— æ³•è·å–)</p><pre><code class="java">/** * Invokes release with current state value; returns saved state. * Cancels node and throws exception on failure. * @param node the condition node for this wait * @return previous sync state */final long fullyRelease(Node node) {    boolean failed = true;    try {        long savedState = getState();        if (release(savedState)) {            failed = false;            return savedState;        } else {            //å¿…é¡»åœ¨Lockä¹‹åæ‰èƒ½è°ƒç”¨wait(),ä¸unlock()åŒç†            throw new IllegalMonitorStateException();        }    } finally {        if (failed)            node.waitStatus = Node.CANCELLED;    }}</code></pre><p>releaseå¯ä»¥çœ‹ä¹‹å‰çš„tryreleaseåˆ†æ,AQS#fullyRelease()è¿”å›åï¼Œè°ƒç”¨ConditionObject#await()çš„çº¿ç¨‹å°±é‡Šæ”¾äº†é”(è¿™é‡Œå¿…é¡»é‡Šæ”¾é”, å¦åˆ™å°±ä¼šå‡ºç°å…¶ä»–è°ƒç”¨Lockçš„åœ°æ–¹æ— æ³•è·å–é”,é˜»å¡)</p><h5 id="isOnSyncQueue-é˜»å¡"><a href="#isOnSyncQueue-é˜»å¡" class="headerlink" title="isOnSyncQueue(é˜»å¡)"></a>isOnSyncQueue(é˜»å¡)</h5><p>java.util.concurrent.locks.AbstractQueuedSynchronizer#isOnSyncQueue</p><p>é˜»å¡ï¼Œç›´åˆ°æ”¶åˆ°ä¿¡å·æˆ–è¢«ä¸­æ–­</p><pre><code class="java">// Internal support methods for Conditions/** * Returns true if a node, always one that was initially placed on * a condition queue, is now waiting to reacquire on sync queue. * @param node the node * @return true if is reacquiring */final boolean isOnSyncQueue(Node node) {    //å¦‚æœæ˜¯å¤´èŠ‚ç‚¹ æˆ–è€…å½“å‰èŠ‚ç‚¹æ˜¯CONDITION    if (node.waitStatus == Node.CONDITION || node.prev == null)        return false;    if (node.next != null) // If has successor, it must be on queue        return true;    /*     * node.prev can be non-null, but not yet on queue because     * the CAS to place it on queue can fail. So we have to     * traverse from tail to make sure it actually made it.  It     * will always be near the tail in calls to this method, and     * unless the CAS failed (which is unlikely), it will be     * there, so we hardly ever traverse much.     */    return findNodeFromTail(node);}    /**     * Returns true if node is on sync queue by searching backwards from tail.     * Called only when needed by isOnSyncQueue.     * @return true if present     */    private boolean findNodeFromTail(Node node) {        Node t = tail;        for (;;) {            if (t == node)                return true;            if (t == null)                return false;            t = t.prev;        }    }</code></pre><p><strong>å…ˆ è·³è½¬åˆ° signal çš„åˆ†æ</strong></p><p>AQS#isOnSyncQueue()åˆ¤æ–­èŠ‚ç‚¹nodeæ˜¯å¦å·²ç»è¢«æ”¾å…¥äº†AQSå†…éƒ¨çš„ç­‰å¾…é˜Ÿåˆ—ï¼Œæ˜¯çš„è¯è¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚ä¸»è¦åˆ†å‡ ç§æƒ…å†µï¼š</p><ul><li>å¦‚æœ<code>node.waitStatus == CONDITION</code>ï¼Œåˆ™ä¸€å®šæœªæ”¾å…¥ã€‚å› ä¸ºAQS#transferForSignal()6è¡Œè¿˜æ²¡æ¥å¾—åŠæ‰§è¡Œã€‚</li><li>å¦‚æœ<code>node.prev == null</code>ï¼Œåˆ™ä¸€å®šæœªæ”¾å…¥ã€‚å› ä¸ºAQS#transferForSignal()6è¡Œæ‰§è¡Œå®Œä½†9è¡Œæœªæ‰§è¡Œå®Œã€‚</li><li>å¦‚æœ<code>node.next != null</code>ï¼Œåˆ™ä¸€å®šå·²æ”¾å…¥ã€‚å› ä¸ºå·²ç»æœ‰äº†åç»§èŠ‚ç‚¹ï¼Œåˆ™nodeæœ¬èº«è‚¯å®šå·²ç»å®Œæˆå…¥é˜Ÿï¼ˆConditionObjectå†…éƒ¨çš„ç­‰å¾…ä½¿ç”¨çš„åç»§æŒ‡é’ˆä¸º<code>nextWaiter</code>ï¼‰ã€‚</li><li>å¦åˆ™ï¼Œè¯´æ˜æ»¡è¶³<code>node.waitStatus != CONDITION &amp;&amp; node.prev != null &amp;&amp; node.next == null</code>ï¼Œè¯¥çŠ¶æ€æ— æ³•ç¡®å®šnodeå¤„äºâ€œæœªæ”¾å…¥â€è¿˜æ˜¯â€œå·²æ”¾å…¥â€çš„çŠ¶æ€ã€‚å›å¿†AQS#enq()å¯çŸ¥ï¼Œ<code>node.prev != null</code>æ—¶ï¼Œå¯èƒ½æ­£åœ¨å°è¯•CASæ’å…¥nodeï¼Œæ— æ³•ç¡®å®šæ˜¯åœ¨æ’å…¥å‰è¿˜æ˜¯æ’å…¥åï¼Œä¹Ÿæ— æ³•ç¡®å®šæ˜¯å¦æ’å…¥æˆåŠŸã€‚AQS#findNodeFromTail()ä»å°¾èŠ‚ç‚¹å¼€å§‹éå†ï¼Œå¦‚æœèƒ½å¤Ÿéå†åˆ°nodeï¼Œåˆ™ä¸€å®šå·²æ”¾å…¥ï¼ˆå½“ç„¶ï¼Œnextæ–¹å‘ä¸ä¸€å®šæ»¡è¶³ä¸€è‡´æ€§ï¼‰ï¼›å¦åˆ™ï¼Œå½“å‰æ—¶åˆ»è¿˜æœªæ’å…¥æˆ–æœªæ’å…¥æˆåŠŸï¼Œå³ä¸€å®šæœªæ”¾å…¥ã€‚</li></ul><h5 id="checkInterruptWhileWaiting-æ£€æŸ¥æ˜¯å¦è¢«ä¸­æ–­"><a href="#checkInterruptWhileWaiting-æ£€æŸ¥æ˜¯å¦è¢«ä¸­æ–­" class="headerlink" title="checkInterruptWhileWaiting (æ£€æŸ¥æ˜¯å¦è¢«ä¸­æ–­)"></a>checkInterruptWhileWaiting (æ£€æŸ¥æ˜¯å¦è¢«ä¸­æ–­)</h5><p>åˆ¤æ–­æ˜¯è¢«ä¸­æ–­(å› ä¸ºawaitæ˜¯å…è®¸ä¸­æ–­çš„,æ‰€ä»¥éœ€è¦æ³¨æ„catchä¸­æ–­å¼‚å¸¸çš„å¤„ç†)è¿˜æ˜¯è¢«å”¤é†’</p><p>java.util.concurrent.locks.AbstractQueuedSynchronizer.ConditionObject#checkInterruptWhileWaiting</p><ul><li>è¿”å›THROW_IE å¦‚æœä¸­æ–­å‘ç”Ÿåœ¨singnalledä¹‹å‰ ,æŠ›å‡ºå¼‚å¸¸</li><li>è¿”å›REINTERRUPT å¦‚æœä¸­æ–­å‘ç”Ÿåœ¨signalledä¹‹å , åªæ˜¯ç®€å•è®¾ç½®çŠ¶æ€</li><li>è¿”å›0 å¦‚æœæœªå‘ç”Ÿè¿‡ä¸­æ–­</li></ul><pre><code class="java">/** * Checks for interrupt, returning THROW_IE if interrupted * before signalled, REINTERRUPT if after signalled, or * 0 if not interrupted. */private int checkInterruptWhileWaiting(Node node) {    //æ˜¯å¦å‘ç”Ÿäº†ä¸­æ–­,å¦åˆ™è¿”å›0    return Thread.interrupted() ?        (transferAfterCancelledWait(node) ? THROW_IE : REINTERRUPT) :        0;} final boolean transferAfterCancelledWait(Node node) {        //å‘ç”Ÿåœ¨ä¸­æ–­ä¹‹å‰        if (compareAndSetWaitStatus(node, Node.CONDITION, 0)) {            enq(node);            return true;        }        /*         * If we lost out to a signal(), then we can&#39;t proceed         * until it finishes its enq().  Cancelling during an         * incomplete transfer is both rare and transient, so just         * spin.         */        while (!isOnSyncQueue(node))            Thread.yield();        return false;    }</code></pre><p>é¦–å…ˆï¼Œæ ¹æ®<code>Thread.interrupted()</code>åˆ¤æ–­æ˜¯å¦å‘ç”Ÿäº†ä¸­æ–­ã€‚<em>å¦‚æœæœªå‘ç”Ÿä¸­æ–­</em>ï¼Œåˆ™<code>Thread.interrupted()</code>è¿”å›falseï¼Œ<em>ConditionObject#checkInterruptWhileWaiting()æœ€ç»ˆè¿”å›0</em>ã€‚</p><p>å¦åˆ™ï¼Œç»§ç»­è°ƒç”¨AQS#transferAfterCancelledWait()åˆ¤æ–­å‘ç”Ÿä¸­æ–­çš„æ—¶æœºã€‚<em>å¦‚æœæ˜¯åœ¨æ”¶åˆ°ä¿¡å·å‰å‘ç”Ÿäº†ä¸­æ–­</em>ï¼ŒAQS#transferForSignal()6è¡Œè¿˜æ²¡æ¥å¾—åŠæ‰§è¡Œï¼Œå¿…ç„¶æ»¡è¶³<code>node.waitStatus == CONDITION</code>ï¼Œåˆ™CASè®¾ç½®node.waitStatuså¹¶å°†nodeå…¥é˜Ÿï¼ˆç­‰å¾…åé¢è°ƒç”¨AQS#acquireQueued()ç«äº‰é”ï¼‰ï¼Œç„¶åè¿”å›trueï¼Œ<em>ConditionObject#checkInterruptWhileWaiting()æœ€ç»ˆè¿”å›THROW_IE == -1</em>ã€‚</p><p>å¦åˆ™ï¼Œä¸€å®šæ˜¯<em>åœ¨æ”¶åˆ°ä¿¡å·åå‘ç”Ÿäº†ä¸­æ–­</em>ï¼Œä½†å¯èƒ½AQS#transferForSignal()6è¡Œæ‰§è¡Œå®Œä½†9è¡Œæœªæ‰§è¡Œå®Œï¼Œå³nodeæœªå®Œæˆå…¥é˜Ÿï¼Œå› æ­¤ï¼Œ21-22è¡Œç©ºç­‰å¾…è‡³nodeå®Œæˆå…¥é˜Ÿï¼Œç„¶åè¿”å›falseï¼Œ<em>ConditionObject#checkInterruptWhileWaiting()æœ€ç»ˆè¿”å›REINTERRUPT == 1</em>ã€‚</p><p>ç»ˆäºè·³å‡ºäº†å¾ªç¯ï¼Œè¦é‡æ–°ç”³è¯·é”äº†ã€‚(ä¸#lockæ–¹æ³•ç±»ä¼¼çš„å°±ä¸é‡å¤åˆ†æ)</p><h6 id="ä¿¡å·å‰ä¸­æ–­çš„ç‰¹æ®Šæƒ…å†µ"><a href="#ä¿¡å·å‰ä¸­æ–­çš„ç‰¹æ®Šæƒ…å†µ" class="headerlink" title="ä¿¡å·å‰ä¸­æ–­çš„ç‰¹æ®Šæƒ…å†µ"></a>ä¿¡å·å‰ä¸­æ–­çš„ç‰¹æ®Šæƒ…å†µ</h6><p><strong>ä¿¡å·å‰ä¸­æ–­ä¼šå¯¼è‡´nodeåŒæ—¶å¤„äºAQSä¸ConditionObjectä¸¤æ–¹çš„ç­‰å¾…é˜Ÿåˆ—ä¸­</strong>ï¼ˆä½¿ç”¨ä¸åŒçš„æŒ‡é’ˆè¿æ¥èŠ‚ç‚¹ï¼‰ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g6ayngc1x4j30rj0h1wfi.jpg" alt="AQSÃ¤Â¸ÂConditionObjectÃ¥Â…Â±Ã¤ÂºÂ«Ã¨ÂŠÂ‚Ã§Â‚Â¹"></p><p>è€Œå¦å¤–ä¸¤ç§æƒ…å†µä¸‹ï¼ŒèŠ‚ç‚¹éƒ½è¢«è¿å…¥äº†AQSå†…éƒ¨ç­‰å¾…é˜Ÿåˆ—ã€‚</p><p>å› æ­¤ï¼Œåªè¦ConditionObjectå†…éƒ¨ç­‰å¾…é˜Ÿåˆ—ä¸­çš„èŠ‚ç‚¹æ»¡è¶³<code>node.waitStatus == SIGNAL</code>æˆ–<code>node.waitStatus == 0</code>ï¼Œå°±å¯ä»¥åˆ¤æ–­å…¶åŒæ—¶ä½äºäºAQSä¸ConditionObjectä¸¤æ–¹çš„ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼Œä¹Ÿå°±èƒ½æ–­å®šè¯¥èŠ‚ç‚¹å±äºä¿¡å·å‰ä¸­æ–­å”¤é†’ã€‚</p><blockquote><p>ä¿¡å·å‰ä¸­æ–­å”¤é†’çš„èŠ‚ç‚¹æ˜¯æ— æ•ˆçš„ï¼Œéœ€è¦è¢«æ¸…ç†ï¼Œå¯ä»¥ç”¨è¯¥æ¡ä»¶æ‰¾å‡ºè¿™éƒ¨åˆ†èŠ‚ç‚¹ã€‚è¯¥ç»“è®ºå°†åœ¨åˆ†æConditionObject#unlinkCancelledWaiters()æ—¶æ´¾ä¸Šç”¨åœºã€‚</p></blockquote><h5 id="unlinkCancelledWaiters"><a href="#unlinkCancelledWaiters" class="headerlink" title="unlinkCancelledWaiters"></a>unlinkCancelledWaiters</h5><p>java.util.concurrent.locks.AbstractQueuedSynchronizer.ConditionObject#unlinkCancelledWaiters</p><p>å®é™…ä¸Šï¼ŒConditionObject#unlinkCancelledWaiters()ç”¨äºæ¸…ç†ConditionObjectå†…éƒ¨ç­‰å¾…é˜Ÿåˆ—ä¸­çš„éCONDITIONèŠ‚ç‚¹ã€‚å…·ä½“æ¥è¯´ï¼š</p><ul><li>å¦‚æœConditionObject#await()æ—¶ï¼ˆæ›´ç¡®åˆ‡çš„è¯´ï¼ŒAQS#fullyRelease()å®Œå…¨é‡Šæ”¾é”æ—¶ï¼‰å¤±è´¥ï¼ŒèŠ‚ç‚¹è½¬ä¸ºCANCELLEDçŠ¶æ€ï¼Œéœ€è¦è¢«æ¸…ç†ã€‚</li><li>åˆ†æAQS#transferAfterCancelledWait()æœ‰ä¸€ä¸ªç»“è®ºï¼Œ<strong>ä¿¡å·å‰ä¸­æ–­ä¼šå¯¼è‡´nodeåŒæ—¶å¤„äºAQSä¸ConditionObjectä¸¤æ–¹çš„ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼ˆä½¿ç”¨ä¸åŒçš„æŒ‡é’ˆè¿æ¥èŠ‚ç‚¹ï¼‰</strong>ã€‚è¿™äº›èŠ‚ç‚¹å°†éšç€AQS#acquireQueued()çš„æ‰§è¡Œè½¬ä¸ºSIGNALæˆ–0çŠ¶æ€ã€‚ä½†ç”±äºConditionObject#await()åœ¨æ”¶åˆ°ä¿¡å·å‰ï¼ˆæ›´ç¡®åˆ‡çš„è¯´ï¼Œåœ¨AQS#fullyRelease()å®Œå…¨é‡Šæ”¾é”åã€æ”¶åˆ°ä¿¡å·å‰ï¼‰è¢«ä¸­æ–­ï¼Œå› æ­¤ä¸Šè¿°èŠ‚ç‚¹ä¹Ÿæ˜¯æ— æ•ˆçš„ï¼Œéœ€è¦è¢«æ¸…ç†ã€‚</li></ul><p>è€Œè¢«ä¿¡å·å”¤é†’æˆ–ä¿¡å·åä¸­æ–­å”¤é†’çš„èŠ‚ç‚¹ï¼Œå°†é¦–å…ˆç§»å‡ºConditionObjectå†…éƒ¨ç­‰å¾…é˜Ÿåˆ—ï¼Œå†è¿›è¡ŒçŠ¶æ€è½¬æ¢ã€‚</p><p>ç»¼ä¸Šï¼Œåªéœ€è¦æ¸…ç†ConditionObjectå†…éƒ¨ç­‰å¾…é˜Ÿåˆ—ä¸­çš„éCONDITIONèŠ‚ç‚¹</p><pre><code class="java">/** * Unlinks cancelled waiter nodes from condition queue. * Called only while holding lock. This is called when * cancellation occurred during condition wait, and upon * insertion of a new waiter when lastWaiter is seen to have * been cancelled. This method is needed to avoid garbage * retention in the absence of signals. So even though it may * require a full traversal, it comes into play only when * timeouts or cancellations occur in the absence of * signals. It traverses all nodes rather than stopping at a * particular target to unlink all pointers to garbage nodes * without requiring many re-traversals during cancellation * storms. */private void unlinkCancelledWaiters() {    //å½“å‰èŠ‚ç‚¹    Node t = firstWaiter;    //ä¸Šä¸€ä¸ªèŠ‚ç‚¹    Node trail = null;    while (t != null) {        //ä¸‹ä¸€ä¸ªèŠ‚ç‚¹        Node next = t.nextWaiter;        //ä¸æ˜¯CONDITION,ç§»é™¤å½“å‰èŠ‚ç‚¹(å°±æ˜¯æŠŠä¸Šä¸ªèŠ‚ç‚¹çš„nextWaiteræ‰§è¡Œä¸‹ä¸ªèŠ‚ç‚¹)        if (t.waitStatus != Node.CONDITION) {            t.nextWaiter = null;            //å¦‚æœtrailä¸ºç©º,è¯´æ˜æ˜¯å¤´èŠ‚ç‚¹,ç›´æ¥æ›¿æ¢firstWaiter            if (trail == null)                firstWaiter = next;            else   //å¦åˆ™æŠŠä¸Šä¸€ä¸ªèŠ‚ç‚¹æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹                trail.nextWaiter = next;            //è®¾ç½®å°¾èŠ‚ç‚¹            if (next == null)                lastWaiter = trail;        }        else  //ä¿ç•™å½“å‰èŠ‚ç‚¹ä¸ºä¸Šä¸ªèŠ‚ç‚¹            trail = t;        //ç§»åŠ¨å½“å‰èŠ‚ç‚¹,å¼€å§‹ä¸‹ä¸€è½®        t = next;    }}</code></pre><h5 id="reportInterruptAfterWait"><a href="#reportInterruptAfterWait" class="headerlink" title="reportInterruptAfterWait"></a>reportInterruptAfterWait</h5><p>java.util.concurrent.locks.AbstractQueuedSynchronizer.ConditionObject#reportInterruptAfterWait</p><pre><code class="java">/** * Throws InterruptedException, reinterrupts current thread, or * does nothing, depending on mode. */private void reportInterruptAfterWait(int interruptMode)    throws InterruptedException {    if (interruptMode == THROW_IE)        throw new InterruptedException();    else if (interruptMode == REINTERRUPT)        selfInterrupt();}</code></pre><h4 id="signal"><a href="#signal" class="headerlink" title="signal"></a>signal</h4><p>å”¤é†’ä¸€ä¸ªç­‰å¾…åœ¨Conditonä¸Šçš„çº¿ç¨‹,è¯¥çº¿ç¨‹ä»ç­‰å¾…æ–¹æ³•è¿”å›å‰å¿…é¡»è·å¾—ä¸Conditionç›¸å…³è”çš„é”</p><pre><code class="java">    /**     * Moves the longest-waiting thread, if one exists, from the     * wait queue for this condition to the wait queue for the     * owning lock.     *     * @throws IllegalMonitorStateException if {@link #isHeldExclusively}     *     returns {@code false}     */    public final void signal() {      if (!isHeldExclusively())        throw new IllegalMonitorStateException();      Node first = firstWaiter;      //è¡¨ç¤ºæœ‰èŠ‚ç‚¹è¿›å…¥äº†æ¡ä»¶é˜Ÿåˆ—å†…éƒ¨çš„ç­‰å¾…é˜Ÿåˆ—ï¼Œéœ€è¦è¢«å”¤é†’      if (first != null)        doSignal(first);    }    /**     * Removes and transfers nodes until hit non-cancelled one or     * null. Split out from signal in part to encourage compilers     * to inline the case of no waiters.     * @param first (non-null) the first node on condition queue     */    private void doSignal(Node first) {      do {        //firstWaiteråç§»ä¸€ä½        if ((firstWaiter = first.nextWaiter) == null)          lastWaiter = null;        first.nextWaiter = null;      //è¯•å°†æ¡ä»¶é˜Ÿåˆ—å†…éƒ¨çš„ç­‰å¾…èŠ‚ç‚¹è½¬æ¢ä¸ºAQSå†…éƒ¨çš„ç­‰å¾…èŠ‚ç‚¹ï¼Œå¦‚æœå½“å‰èŠ‚ç‚¹è½¬æ¢å¤±è´¥ï¼Œå°±ç»§ç»­å°è¯•ä¸‹ä¸€èŠ‚ç‚¹      } while (!transferForSignal(first) &amp;&amp;(first = firstWaiter) != null);    }</code></pre><h5 id="transferForSignal"><a href="#transferForSignal" class="headerlink" title="transferForSignal"></a>transferForSignal</h5><pre><code class="java">/** * Transfers a node from a condition queue onto sync queue. * Returns true if successful. * @param node the node * @return true if successfully transferred (else the node was * cancelled before signal) */final boolean transferForSignal(Node node) {    /*     * If cannot change waitStatus, the node has been cancelled.     */    if (!compareAndSetWaitStatus(node, Node.CONDITION, 0))        return false;    /*     * Splice onto queue and try to set waitStatus of predecessor to     * indicate that thread is (probably) waiting. If cancelled or     * attempt to set waitStatus fails, wake up to resync (in which     * case the waitStatus can be transiently and harmlessly wrong).     */    //å…¥é˜Ÿï¼Œè¿”å›æ—§çš„é˜Ÿå°¾èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯æ–°èŠ‚ç‚¹nodeçš„å‰ç»§èŠ‚ç‚¹ã€‚    Node p = enq(node);    //åªæœ‰æ­£åœ¨æ‰§è¡ŒAQS#acquireQueued()çš„çº¿ç¨‹T1èƒ½å¤Ÿä¸æ­£åœ¨æ‰§è¡Œåˆ°è¿™é‡Œçš„çº¿ç¨‹T2å‘ç”Ÿç«äº‰ã€‚    int ws = p.waitStatus;    if (ws &gt; 0 || !compareAndSetWaitStatus(p, ws, Node.SIGNAL))        LockSupport.unpark(node.thread);    return true;}</code></pre><p>å›åˆ°ConditionObject#doSignal()ä¸ConditionObject#signal()ï¼ŒæˆåŠŸç»“æŸã€‚å¯¹äºç”¨æˆ·è€Œè¨€ï¼Œçº¿ç¨‹æ­¤æ—¶å·²ç»è¢«å”¤é†’ï¼Œå°½ç®¡å…¶å¤§æ¦‚ç‡è¿˜åœ¨AQSå†…éƒ¨é˜»å¡æ’é˜Ÿï¼Œç­‰å¾…<strong>é‡æ–°</strong>è·å¾—é”ã€‚</p><p>å®é™…ä¸Šï¼Œ<em>å°±ç®—å»æ‰10-12è¡Œä¹Ÿæ˜¯æ»¡è¶³æ­£ç¡®æ€§è¦æ±‚çš„</em>ã€‚å› ä¸ºçº¿ç¨‹T2é‡Šæ”¾é”åï¼Œä¾ç„¶ä¼šå°†ä»é˜Ÿå¤´å¼€å§‹çš„ç¬¬ä¸€ä¸ªéå–æ¶ˆèŠ‚ç‚¹å”¤é†’ï¼Œè¯¥èŠ‚ç‚¹ä¼šç»§ç»­ConditionObject#await()ä¸­çš„å·¥ä½œ</p><h4 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>awaitå¯ä»¥ç®€å•è®¤ä¸ºæ˜¯ç”¨äºç»´æŠ¤ConditionObjecté˜Ÿåˆ—,å¯ä»¥åˆ†ä¸ºé˜»å¡å‰å’Œé˜»å¡åæ“ä½œ</p><p> é˜»å¡å‰: æ’å…¥å†…éƒ¨ç­‰å¾…é˜Ÿåˆ—</p><p> é˜»å¡å: æ ¹æ®æ˜¯å¦ä¸­æ–­(ä¸€è‡´æ€§é—®é¢˜),æ¥ç»´æŠ¤çŠ¶æ€</p><p>signalå¯ä»¥ç®€å•çš„è®¤ä¸º å°†ConditionObjecté˜Ÿåˆ—ä¸­çš„èŠ‚ç‚¹ç§»åŠ¨åˆ°AQSé˜Ÿåˆ—</p>]]></content>
      
      
      <categories>
          
          <category> jdk </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jdk </tag>
            
            <tag> juc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVM_Synchronized</title>
      <link href="/2019/08/17/JVM-Synchronized/"/>
      <url>/2019/08/17/JVM-Synchronized/</url>
      
        <content type="html"><![CDATA[<h2 id="JVM-Synchronized"><a href="#JVM-Synchronized" class="headerlink" title="JVM_Synchronized"></a>JVM_Synchronized</h2><p><img src="http://ww3.sinaimg.cn/large/006tNc79gy1g6696x82ypj31800t04qp.jpg" alt=""></p><p>æµ…è°ˆä¸‹jvmå¯¹Synchronizedçš„ä¼˜åŒ–</p><ul><li>å¯¹è±¡çš„åˆ†å¸ƒ</li><li>é”å‡çº§</li><li>é”ä¼˜åŒ–</li></ul><a id="more"></a><h3 id="Javaå¯¹è±¡çš„ç»„æˆ"><a href="#Javaå¯¹è±¡çš„ç»„æˆ" class="headerlink" title="Javaå¯¹è±¡çš„ç»„æˆ"></a>Javaå¯¹è±¡çš„ç»„æˆ</h3><p>åœ¨HotSpotè™šæ‹Ÿæœºä¸­,å¯¹è±¡åœ¨å†…å­˜ä¸­å­˜å‚¨çš„å¸ƒå±€å¯ä»¥åˆ†ä¸º3å—åŒºåŸŸ : å¯¹è±¡å¤´(Header)ã€å®ä¾‹æ•°æ®(Instance Data)ã€å¡«å……(Padding)</p><h4 id="Header-å¯¹è±¡å¤´"><a href="#Header-å¯¹è±¡å¤´" class="headerlink" title="Header (å¯¹è±¡å¤´)"></a>Header (å¯¹è±¡å¤´)</h4><p>Javaå¯¹è±¡çš„å¯¹è±¡å¤´ç”± mark word å’Œ  klass pointer ã€Array length</p><p>mark word: å­˜å‚¨äº†åŒæ­¥çŠ¶æ€ã€æ ‡è¯†ã€hashcodeã€GCçŠ¶æ€ç­‰ç­‰ã€‚</p><p>klass pointer:å­˜å‚¨å¯¹è±¡çš„ç±»å‹æŒ‡é’ˆï¼Œè¯¥æŒ‡é’ˆæŒ‡å‘å®ƒçš„ç±»å…ƒæ•°æ®</p><p>Array length: æ•°ç»„çš„é•¿åº¦(å¦‚æœå½“å‰å¯¹è±¡æ˜¯æ•°ç»„)</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœåº”ç”¨çš„å¯¹è±¡è¿‡å¤šï¼Œä½¿ç”¨64ä½çš„æŒ‡é’ˆå°†æµªè´¹å¤§é‡å†…å­˜ã€‚64ä½çš„JVMæ¯”32ä½çš„JVMå¤šè€—è´¹50%çš„å†…å­˜ã€‚</p><p>æˆ‘ä»¬ç°åœ¨ä½¿ç”¨çš„64ä½ JVMä¼šé»˜è®¤ä½¿ç”¨é€‰é¡¹ +UseCompressedOops å¼€å¯æŒ‡é’ˆå‹ç¼©ï¼Œå°†æŒ‡é’ˆå‹ç¼©è‡³32ä½ã€‚</p><h5 id="mark-wordå­˜å‚¨ç»“æ„"><a href="#mark-wordå­˜å‚¨ç»“æ„" class="headerlink" title="mark wordå­˜å‚¨ç»“æ„"></a>mark wordå­˜å‚¨ç»“æ„</h5><p>ä»¥64ä½æ“ä½œç³»ç»Ÿä¸ºä¾‹ï¼Œå¯¹è±¡å¤´å­˜å‚¨å†…å®¹å›¾ä¾‹ã€‚(åœ¨è¿è¡ŒæœŸé—´,Mark Wordé‡Œçš„å­˜å‚¨æ•°æ®ä¼šéšç€é”æ ‡è®°ä½çš„å˜åŒ–è€Œå˜åŒ–)</p><p><img src="http://ww3.sinaimg.cn/large/006tNc79gy1g62ri4y207j31d20h2diu.jpg" alt="img"></p><p>ç®€å•ä»‹ç»ä¸€ä¸‹å„éƒ¨åˆ†çš„å«ä¹‰</p><p>lock:  é”çŠ¶æ€æ ‡è®°ä½ï¼Œè¯¥æ ‡è®°çš„å€¼ä¸åŒï¼Œæ•´ä¸ªmark wordè¡¨ç¤ºçš„å«ä¹‰ä¸åŒã€‚</p><p>biased_lockï¼šåå‘é”æ ‡è®°ï¼Œä¸º1æ—¶è¡¨ç¤ºå¯¹è±¡å¯ç”¨åå‘é”ï¼Œä¸º0æ—¶è¡¨ç¤ºå¯¹è±¡æ²¡æœ‰åå‘é”ã€‚</p><table><thead><tr><th>biased_lock</th><th>Lock</th><th>çŠ¶æ€</th></tr></thead><tbody><tr><td>0</td><td>01</td><td>æ— é”</td></tr><tr><td>1</td><td>01</td><td>åå‘é”</td></tr><tr><td>0</td><td>00</td><td>è½»é‡çº§é”</td></tr><tr><td>0</td><td>10</td><td>é‡é‡çº§é”</td></tr><tr><td>0</td><td>11</td><td>GCæ ‡è®°</td></tr></tbody></table><p>ageï¼šJava GCæ ‡è®°ä½å¯¹è±¡å¹´é¾„ã€‚</p><p>identity_hashcodeï¼šå¯¹è±¡æ ‡è¯†Hashç ï¼Œé‡‡ç”¨å»¶è¿ŸåŠ è½½æŠ€æœ¯ã€‚å½“å¯¹è±¡ä½¿ç”¨HashCode()è®¡ç®—åï¼Œå¹¶ä¼šå°†ç»“æœå†™åˆ°è¯¥å¯¹è±¡å¤´ä¸­ã€‚å½“å¯¹è±¡è¢«é”å®šæ—¶ï¼Œè¯¥å€¼ä¼šç§»åŠ¨åˆ°çº¿ç¨‹Monitorä¸­ã€‚</p><p>threadï¼šæŒæœ‰åå‘é”çš„çº¿ç¨‹IDå’Œå…¶ä»–ä¿¡æ¯ã€‚è¿™ä¸ªçº¿ç¨‹IDå¹¶ä¸æ˜¯JVMåˆ†é…çš„çº¿ç¨‹IDå·ï¼Œå’ŒJava Threadä¸­çš„IDæ˜¯ä¸¤ä¸ªæ¦‚å¿µã€‚</p><p>epochï¼šåå‘æ—¶é—´æˆ³ã€‚</p><p>ptr_to_lock_recordï¼šæŒ‡å‘æ ˆä¸­é”è®°å½•çš„æŒ‡é’ˆã€‚</p><p>ptr_to_heavyweight_monitorï¼šæŒ‡å‘çº¿ç¨‹Monitorçš„æŒ‡é’ˆã€‚</p><h3 id="é”å‡çº§ä¸å¯¹æ¯”"><a href="#é”å‡çº§ä¸å¯¹æ¯”" class="headerlink" title="é”å‡çº§ä¸å¯¹æ¯”"></a>é”å‡çº§ä¸å¯¹æ¯”</h3><p>Java SE 1.6ä¸ºäº†å‡å°‘è·å¾—é”å’Œé‡Šæ”¾é”å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—,å¼•å…¥â€œåå‘é”â€ å’Œ â€œè½»é‡çº§é”â€ </p><p>é”ä¸€å…±æœ‰4ç§çŠ¶æ€,çº§åˆ«ä»ä½åˆ°é«˜ä¾æ¬¡æ˜¯:æ— é”çŠ¶æ€ã€åå‘é”çŠ¶æ€ã€è½»é‡çº§é”çŠ¶æ€å’Œé‡é‡çº§é”çŠ¶æ€.</p><p>é”å¯ä»¥å‡çº§ä½†ä¸èƒ½é™çº§(ä¸ºäº†è·å¾—é”å’Œé‡Šæ”¾é”çš„æ•ˆç‡)</p><h4 id="JOLå·¥å…·"><a href="#JOLå·¥å…·" class="headerlink" title="JOLå·¥å…·"></a>JOLå·¥å…·</h4><p>å€ŸåŠ©jolå·¥å…·æ‰“å°å¯¹è±¡å®ä¾‹åˆ†å¸ƒ</p><pre><code class="xml">&lt;dependency&gt;  &lt;groupId&gt;org.openjdk.jol&lt;/groupId&gt;  &lt;artifactId&gt;jol-core&lt;/artifactId&gt;  &lt;version&gt;0.8&lt;/version&gt;&lt;/dependency&gt;</code></pre><h4 id="æ— é”"><a href="#æ— é”" class="headerlink" title="æ— é”"></a>æ— é”</h4><p>é¦–å…ˆå…ˆæ¥çœ‹çœ‹æ— é”çŠ¶æ€ä¸‹çš„å¯¹è±¡å®ä¾‹æ•°æ®åˆ†å¸ƒ,ç®€å•çš„ä¸€ä¸ªClasså¯¹è±¡</p><pre><code class="java">public class ObjectLayoutDemo {    public static class A {        boolean flag = false;    }    public static void main(String[] args) throws InterruptedException {        A a = new A();        System.out.println(ClassLayout.parseInstance(a).toPrintable());        // æ‰‹åŠ¨è°ƒç”¨hashCode è§¦å‘æ‡’åŠ è½½        System.out.println(Integer.toBinaryString(a.hashCode()));        System.out.println(ClassLayout.parseInstance(a).toPrintable());    }}</code></pre><p>çœ‹çœ‹è¾“å‡ºç»“æœ</p><p><img src="http://ww2.sinaimg.cn/large/006tNc79gy1g62s3w1yhzj31ks0980un.jpg" alt="img"></p><p>è“è‰²éƒ¨åˆ†:lock </p><p>çº¢è‰²éƒ¨åˆ†:hashcode</p><p>ç»¿è‰²éƒ¨åˆ†:è¢«æŒ‡é’ˆå‹ç¼©ä¸º32ä½çš„klass pointer</p><h4 id="åå‘é”"><a href="#åå‘é”" class="headerlink" title="åå‘é”"></a>åå‘é”</h4><p>å¼•å…¥åå‘é”æ˜¯ä¸ºäº†åœ¨æ— å¤šçº¿ç¨‹ç«äº‰çš„æƒ…å†µä¸‹å°½é‡å‡å°‘ä¸å¿…è¦çš„è½»é‡çº§é”æ‰§è¡Œè·¯å¾„ï¼Œå› ä¸ºè½»é‡çº§é”çš„è·å–åŠé‡Šæ”¾ä¾èµ–å¤šæ¬¡CASåŸå­æŒ‡ä»¤ï¼Œè€Œåå‘é”åªéœ€è¦åœ¨ç½®æ¢ThreadIDçš„æ—¶å€™ä¾èµ–ä¸€æ¬¡CASåŸå­æŒ‡ä»¤ï¼ˆç”±äºä¸€æ—¦å‡ºç°å¤šçº¿ç¨‹ç«äº‰çš„æƒ…å†µå°±å¿…é¡»æ’¤é”€åå‘é”ï¼Œæ‰€ä»¥åå‘é”çš„æ’¤é”€æ“ä½œçš„æ€§èƒ½æŸè€—å¿…é¡»å°äºèŠ‚çœä¸‹æ¥çš„CASåŸå­æŒ‡ä»¤çš„æ€§èƒ½æ¶ˆè€—ï¼‰</p><h5 id="ä»æ— é”çŠ¶æ€åˆ°åå‘é”"><a href="#ä»æ— é”çŠ¶æ€åˆ°åå‘é”" class="headerlink" title="ä»æ— é”çŠ¶æ€åˆ°åå‘é”"></a>ä»æ— é”çŠ¶æ€åˆ°åå‘é”</h5><p>å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥å—å¹¶è·å–é”æ—¶,ä¼šåœ¨å¯¹è±¡å¤´å’Œæ ˆå¸§ä¸­çš„é”è®°å½•é‡Œå­˜å‚¨åå‘çš„çº¿ç¨‹ID,ä»¥åè¯¥çº¿ç¨‹åœ¨è¿›å…¥å’Œé€€å‡ºåŒæ­¥å—æ—¶,ä¸éœ€è¦CASæ“ä½œæ¥åŠ é”å’Œè§£é” , åªéœ€è¦æµ‹è¯•ä¸€ä¸‹å¯¹è±¡å¤´çš„Mark Wordæ˜¯å¦å­˜å‚¨ç€æŒ‡å‘å½“å‰çº¿ç¨‹çš„åå‘é”</p><p>ä»¥åè¯¥çº¿ç¨‹è¿›å…¥åŒæ­¥å—æ—¶ï¼Œä¸éœ€è¦CASè¿›è¡ŒåŠ é”ï¼Œåªä¼šå¾€å½“å‰çº¿ç¨‹çš„æ ˆä¸­æ·»åŠ ä¸€æ¡Displaced Mark Wordä¸ºç©ºçš„Lock Recordä¸­ï¼Œç”¨æ¥ç»Ÿè®¡é‡å…¥çš„æ¬¡æ•°.</p><p>é€€å‡ºåŒæ­¥å—é‡Šæ”¾åå‘é”æ—¶ï¼Œåˆ™ä¾æ¬¡åˆ é™¤å¯¹åº”Lock Recordï¼Œä½†æ˜¯ä¸ä¼šä¿®æ”¹å¯¹è±¡å¤´ä¸­çš„Thread Idï¼›</p><h5 id="åå‘é”çš„æ’¤é”€"><a href="#åå‘é”çš„æ’¤é”€" class="headerlink" title="åå‘é”çš„æ’¤é”€"></a>åå‘é”çš„æ’¤é”€</h5><p>åå‘é”åªæœ‰é‡åˆ°å…¶ä»–çº¿ç¨‹å°è¯•ç«äº‰åå‘é”æ—¶ï¼ŒæŒæœ‰åå‘é”çš„çº¿ç¨‹æ‰ä¼šé‡Šæ”¾é”ï¼Œçº¿ç¨‹ä¸ä¼šä¸»åŠ¨å»é‡Šæ”¾åå‘é”ã€‚åå‘é”çš„æ’¤é”€ï¼Œéœ€è¦ç­‰å¾…å…¨å±€å®‰å…¨ç‚¹ï¼ˆåœ¨è¿™ä¸ªæ—¶é—´ç‚¹ä¸Šæ²¡æœ‰å­—èŠ‚ç æ­£åœ¨æ‰§è¡Œï¼‰ï¼Œå®ƒä¼šé¦–å…ˆæš‚åœæ‹¥æœ‰åå‘é”çš„çº¿ç¨‹ï¼Œåˆ¤æ–­é”å¯¹è±¡æ˜¯å¦å¤„äºè¢«é”å®šçŠ¶æ€ï¼Œæ’¤é”€åå‘é”åæ¢å¤åˆ°æœªé”å®šï¼ˆæ ‡å¿—ä½ä¸ºâ€œ01â€ï¼‰æˆ–è½»é‡çº§é”ï¼ˆæ ‡å¿—ä½ä¸ºâ€œ00â€ï¼‰çš„çŠ¶æ€ã€‚</p><h5 id="é€‚ç”¨åœºæ™¯"><a href="#é€‚ç”¨åœºæ™¯" class="headerlink" title="é€‚ç”¨åœºæ™¯"></a>é€‚ç”¨åœºæ™¯</h5><p>åªæœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥å—</p><p>ä¸‹å›¾æ˜¾ç¤ºçš„</p><p>çº¿ç¨‹1æ¼”ç¤ºäº†åå‘é”åˆå§‹åŒ–çš„æµç¨‹</p><p>çº¿ç¨‹2æ¼”ç¤ºäº†åå‘é”çš„æ’¤é”€çš„æµç¨‹</p><p><img src="http://ww3.sinaimg.cn/large/006y8mN6gy1g686ckc6u2j30to0x4tap.jpg" width="70%" height="70%"></p><h5 id="åå‘é”å¯¹è±¡å¤´"><a href="#åå‘é”å¯¹è±¡å¤´" class="headerlink" title="åå‘é”å¯¹è±¡å¤´"></a>åå‘é”å¯¹è±¡å¤´</h5><pre><code class="java">public class BiasedLockDemo {    public static void main(String[] args) throws InterruptedException {        Thread.sleep(5000);        ObjectLayoutDemo.A a = new ObjectLayoutDemo.A();        System.out.println(ClassLayout.parseInstance(a).toPrintable());        Thread thread1 = new Thread(() -&gt; {            synchronized (a){                System.out.println(&quot;thread1 locking&quot;);                System.out.println(ClassLayout.parseInstance(a).toPrintable());            }        });        Thread thread2 = new Thread(() -&gt; {            synchronized (a){                //å¼€å§‹æ’¤é”€ï¼Œ ç›´æ¥return æ¨¡æ‹Ÿåå‘é”æ’¤é”€åˆ°æœªé”å®š                return;            }        });        thread1.start();        //è®©thread1æ‰§è¡Œå®ŒåŒæ­¥ä»£ç å—ä¸­æ–¹æ³•ã€‚        thread1.join();        System.out.println(&quot;thread1&#39;s state:&quot; + thread1.isAlive());        thread2.start();        System.out.println(&quot;after thread2:&quot;+ClassLayout.parseInstance(a).toPrintable());    }}</code></pre><p>ç»“æœ</p><p><img src="http://ww2.sinaimg.cn/large/006tNc79gy1g65dr635fgj31x20p8n38.jpg" alt="image-20190819225819224"></p><p>åˆ†æ</p><p>è¿™é‡Œæ³¨æ„åå‘é”æ˜¯åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨å‡ ç§’é’Ÿä¹‹åæ‰æ¿€æ´»çš„,æ‰€ä»¥sleep</p><p>ç¬¬ä¸€æ¬¡æ‰“å°,å¯ä»¥çœ‹åˆ°åå‘é”æ˜¯å¼€å¯çš„.</p><p>ç¬¬äºŒæ¬¡æ‰“å°,å¯ä»¥çœ‹åˆ°è®°å½•äº†çº¿ç¨‹ID. </p><p>ç¬¬ä¸‰æ¬¡åå‘é”æ’¤é”€</p><h4 id="è½»é‡çº§é”"><a href="#è½»é‡çº§é”" class="headerlink" title="è½»é‡çº§é”"></a>è½»é‡çº§é”</h4><p>è½»é‡çº§é”æ‰€é€‚åº”çš„åœºæ™¯æ˜¯çº¿ç¨‹äº¤æ›¿æ‰§è¡ŒåŒæ­¥å—çš„æƒ…å†µ</p><pre><code class="java">public class LightLockDemo {    public static void main(String[] args) throws InterruptedException {        Thread.sleep(5000);        ObjectLayoutDemo.A a = new ObjectLayoutDemo.A();        Thread thread1 = new Thread(){            @Override            public void run() {                synchronized (a){                    System.out.println(&quot;thread1 locking&quot;);                    System.out.println(ClassLayout.parseInstance(a).toPrintable());                }            }        };        Thread thread2 = new Thread(){            @Override            public void run() {                synchronized (a){                    System.out.println(&quot;thread2 locking&quot;);                    System.out.println(ClassLayout.parseInstance(a).toPrintable());                }            }        };        thread1.start();        //è®©thread1æ‰§è¡Œå®ŒåŒæ­¥ä»£ç å—ä¸­æ–¹æ³•,å¹¶é€€å‡ºçº¿ç¨‹        thread1.join();        System.out.println(&quot;thread1&#39;s state:&quot; + thread1.isAlive());        thread2.start();    }}</code></pre><p>ç»“æœ</p><p><img src="http://ww3.sinaimg.cn/large/006y8mN6gy1g6741i6togj31m80hw78j.jpg" alt="image-20190820110735105"></p><p>åˆ†æ</p><p>ç¬¬ä¸€æ¬¡æ˜¯åå‘é”</p><p>ç¬¬äºŒæ¬¡æ’¤é”€åå‘é”, å‡çº§ä¸ºè½»é‡çº§é”</p><p>æ³¨æ„ ä¸¤æ¬¡æ‰§è¡Œ æŒ‡å‘æ ˆçš„æŒ‡é’ˆ ä¹Ÿä¸ä¸€è‡´äº†</p><h4 id="é‡é‡çº§é”"><a href="#é‡é‡çº§é”" class="headerlink" title="é‡é‡çº§é”"></a>é‡é‡çº§é”</h4><p><em>è½»é‡çº§é”å‡çº§é‡é‡çº§</em></p><p>çº¿ç¨‹1é¦–å…ˆå°è¯• CASå°†å¯¹è±¡å¤´ä¸­çš„Mark Wordæ›¿æ¢ä¸ºæŒ‡å‘é”çš„æŒ‡é’ˆ.(åœ¨æ‰§è¡ŒåŒæ­¥å—å‰,JVMä¼šå…ˆåœ¨å½“å‰çº¿ç¨‹çš„æ ˆå¸§ä¸­åˆ›å»ºç”¨äºå­˜å‚¨é”è®°å½•çš„ç©ºé—´,å¹¶å°†å¯¹è±¡å¤´ä¸­çš„Mark Wordå¤åˆ¶åˆ°æ‰€è®°å½•ä¸­, Displaced Mark Word)</p><p>çº¿ç¨‹2 CAS åŒæ ·å°è¯•,è·å–å¤±è´¥,å°è¯•è‡ªæ—‹è·å–(æˆåŠŸ,è¯´æ˜çº¿ç¨‹1é€€å‡ºäº†åŒæ­¥å—)å¤±è´¥å‡çº§ä¸º é‡é‡çº§é”,é˜»å¡ç­‰å¾…å”¤é†’</p><p><em>é‡é‡çº§é”è§£é”</em></p><p>çº¿ç¨‹1 è§£é”CAS å°†Displace Mark Wordæ›¿æ¢å›å¯¹è±¡å¤´, å¤±è´¥,å¯¹è±¡å¤´å·²è¢«çº¿ç¨‹2ä¿®æ”¹(è†¨èƒ€ä¸ºé‡é‡çº§é”),é‡Šæ”¾é”å¹¶å”¤é†’ç­‰å¾…çš„çº¿ç¨‹(åŒæ—¶æ¸…é™¤æŒ‡å‘æ ˆçš„æŒ‡é’ˆ)</p><p><img src="http://ww3.sinaimg.cn/large/006y8mN6gy1g6741n0890j30ty0teang.jpg" width="70%" height="70%"></p><p>example</p><pre><code class="java">public static void main(String[] args) throws InterruptedException {    Thread.sleep(5000);    ObjectLayoutDemo.A a = new ObjectLayoutDemo.A();    Thread thread1 = new Thread(() -&gt; {        synchronized (a) {            System.out.println(&quot;thread1 locking&quot;);            System.out.println(ClassLayout.parseInstance(a).toPrintable());            try {                //è®©çº¿ç¨‹æ™šç‚¹å„¿æ­»äº¡ï¼Œé€ æˆé”çš„ç«äº‰                Thread.sleep(2000);            } catch (InterruptedException e) {                e.printStackTrace();            }        }    });    Thread thread2 = new Thread(() -&gt; {        synchronized (a) {            System.out.println(&quot;thread2 locking&quot;);            System.out.println(ClassLayout.parseInstance(a).toPrintable());        }    });    thread1.start();    //æ¨¡æ‹Ÿaä»è½»é‡çº§é”åˆ°é‡é‡çº§é”åˆ°è½¬å˜    Thread.sleep(1000);    thread2.start();}</code></pre><p>ç»“æœ</p><p><img src="http://ww2.sinaimg.cn/large/006y8mN6gy1g6741rqho3j31nc0g0djm.jpg" alt="image-20190820110339698"></p><p>åˆ†æ</p><p>ç¬¬ä¸€æ¬¡æ‰“å°æ˜¯è½»é‡çº§é”</p><p>ç¬¬äºŒæ¬¡æ‰“å°ä¸ºé‡é‡çº§é”</p><p>æ³¨æ„ ä¸¤æ¬¡æ‰§è¡Œçš„çº¿ç¨‹IDä¹Ÿä¸ä¸€è‡´äº†</p><h4 id="é‡é‡çº§é”ã€è½»é‡çº§é”å’Œåå‘é”ä¹‹é—´è½¬æ¢"><a href="#é‡é‡çº§é”ã€è½»é‡çº§é”å’Œåå‘é”ä¹‹é—´è½¬æ¢" class="headerlink" title="é‡é‡çº§é”ã€è½»é‡çº§é”å’Œåå‘é”ä¹‹é—´è½¬æ¢"></a>é‡é‡çº§é”ã€è½»é‡çº§é”å’Œåå‘é”ä¹‹é—´è½¬æ¢</h4><p><img src="http://ww2.sinaimg.cn/large/006y8mN6gy1g6741wij92j30wy0fkack.jpg" width="70%" height="70%"></p><h4 id="é‡é‡çº§é”ã€è½»é‡çº§é”å’Œåå‘é”ä¹‹é—´å¯¹æ¯”"><a href="#é‡é‡çº§é”ã€è½»é‡çº§é”å’Œåå‘é”ä¹‹é—´å¯¹æ¯”" class="headerlink" title="é‡é‡çº§é”ã€è½»é‡çº§é”å’Œåå‘é”ä¹‹é—´å¯¹æ¯”"></a>é‡é‡çº§é”ã€è½»é‡çº§é”å’Œåå‘é”ä¹‹é—´å¯¹æ¯”</h4><table><thead><tr><th>é”</th><th style="text-align:left">ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>åå‘é”</td><td style="text-align:left">åŠ é”å’Œè§£é”ä¸éœ€è¦é¢å¤–çš„æ¶ˆè€—ï¼Œå’Œæ‰§è¡ŒéåŒæ­¥æ–¹æ³•æ¯”ä»…å­˜åœ¨çº³ç§’çº§çš„å·®è·ã€‚</td><td>å¦‚æœçº¿ç¨‹é—´å­˜åœ¨é”ç«äº‰ï¼Œä¼šå¸¦æ¥é¢å¤–çš„é”æ’¤é”€çš„æ¶ˆè€—ã€‚</td><td>é€‚ç”¨äºåªæœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥å—åœºæ™¯ã€‚</td></tr><tr><td>è½»é‡çº§é”</td><td style="text-align:left">ç«äº‰çš„çº¿ç¨‹ä¸ä¼šé˜»å¡ï¼Œæé«˜äº†ç¨‹åºçš„å“åº”é€Ÿåº¦ã€‚</td><td>å¦‚æœå§‹ç»ˆå¾—ä¸åˆ°é”ç«äº‰çš„çº¿ç¨‹ä½¿ç”¨è‡ªæ—‹ä¼šæ¶ˆè€—CPUã€‚</td><td>è¿½æ±‚å“åº”æ—¶é—´ã€‚åŒæ­¥å—æ‰§è¡Œé€Ÿåº¦éå¸¸å¿«ã€‚</td></tr><tr><td>é‡é‡çº§é”</td><td style="text-align:left">çº¿ç¨‹ç«äº‰ä¸ä½¿ç”¨è‡ªæ—‹ï¼Œä¸ä¼šæ¶ˆè€—CPUã€‚</td><td>çº¿ç¨‹é˜»å¡ï¼Œå“åº”æ—¶é—´ç¼“æ…¢ã€‚</td><td>è¿½æ±‚ååé‡ã€‚åŒæ­¥å—æ‰§è¡Œé€Ÿåº¦è¾ƒé•¿ã€‚</td></tr></tbody></table><h3 id="é”ä¼˜åŒ–"><a href="#é”ä¼˜åŒ–" class="headerlink" title="é”ä¼˜åŒ–"></a>é”ä¼˜åŒ–</h3><h4 id="jvmå±‚é¢"><a href="#jvmå±‚é¢" class="headerlink" title="jvmå±‚é¢"></a>jvmå±‚é¢</h4><h5 id="é€‚åº”å¼è‡ªæ—‹"><a href="#é€‚åº”å¼è‡ªæ—‹" class="headerlink" title="é€‚åº”å¼è‡ªæ—‹"></a>é€‚åº”å¼è‡ªæ—‹</h5><p>é€‚åº”æ€§è‡ªæ—‹ï¼Œç®€å•æ¥è¯´å°±æ˜¯çº¿ç¨‹å¦‚æœè‡ªæ—‹æˆåŠŸäº†ï¼Œåˆ™ä¸‹æ¬¡è‡ªæ—‹çš„æ¬¡æ•°ä¼šæ›´å¤šï¼Œå¦‚æœè‡ªæ—‹å¤±è´¥äº†ï¼Œåˆ™è‡ªæ—‹çš„æ¬¡æ•°å°±ä¼šå‡å°‘ã€‚</p><h5 id="é”æ¶ˆé™¤"><a href="#é”æ¶ˆé™¤" class="headerlink" title="é”æ¶ˆé™¤"></a>é”æ¶ˆé™¤</h5><p>é”æ¶ˆé™¤æ˜¯æŒ‡è™šæ‹Ÿæœºå³æ—¶ç¼–è¯‘å™¨åœ¨è¿è¡Œæ—¶ï¼Œå¯¹ä¸€äº›ä»£ç ä¸Šè¦æ±‚åŒæ­¥ï¼Œä½†æ˜¯è¢«æ£€æµ‹åˆ°ä¸å¯èƒ½å­˜åœ¨å…±äº«æ•°æ®ç«äº‰çš„é”è¿›è¡Œæ¶ˆé™¤ã€‚</p><pre><code>-server -XX:+DoEscapeAnalysis -XX:+EliminateLocks</code></pre><h5 id="é”ç²—åŒ–"><a href="#é”ç²—åŒ–" class="headerlink" title="é”ç²—åŒ–"></a>é”ç²—åŒ–</h5><p>å¦‚æœä¸€ç³»åˆ—çš„è¿ç»­æ“ä½œéƒ½å¯¹åŒä¸€ä¸ªå¯¹è±¡åå¤åŠ é”å’Œè§£é”ï¼Œç”šè‡³åŠ é”æ“ä½œæ˜¯å‡ºç°åœ¨å¾ªç¯ä½“ä¸­çš„ï¼Œé‚£å³ä½¿æ²¡æœ‰çº¿ç¨‹ç«äº‰ï¼Œé¢‘ç¹åœ°è¿›è¡Œäº’æ–¥åŒæ­¥æ“ä½œä¹Ÿä¼šå¯¼è‡´ä¸å¿…è¦çš„æ€§èƒ½æŸè€—ã€‚</p><h4 id="è¯­è¨€ç¼–ç¨‹"><a href="#è¯­è¨€ç¼–ç¨‹" class="headerlink" title="è¯­è¨€ç¼–ç¨‹"></a>è¯­è¨€ç¼–ç¨‹</h4><h5 id="å‡å°‘é”æŒæœ‰çš„æ—¶é—´"><a href="#å‡å°‘é”æŒæœ‰çš„æ—¶é—´" class="headerlink" title="å‡å°‘é”æŒæœ‰çš„æ—¶é—´"></a>å‡å°‘é”æŒæœ‰çš„æ—¶é—´</h5><p>åªå¯¹éœ€è¦åŒæ­¥ä»£ç åŠ é”</p><h5 id="é”åˆ†ç¦»"><a href="#é”åˆ†ç¦»" class="headerlink" title="é”åˆ†ç¦»"></a>é”åˆ†ç¦»</h5><p>ReadWriteLock</p><h5 id="å‡å°é”çš„åŠ›åº¦"><a href="#å‡å°é”çš„åŠ›åº¦" class="headerlink" title="å‡å°é”çš„åŠ›åº¦"></a>å‡å°é”çš„åŠ›åº¦</h5><p>ConcurrentHashMap</p><blockquote><p>link:<a href="https://houbb.github.io/2018/10/08/jvm-30-lock-optimize" target="_blank" rel="noopener">https://houbb.github.io/2018/10/08/jvm-30-lock-optimize</a></p><p>link:<a href="https://www.cnblogs.com/paddix/p/5405678.html" target="_blank" rel="noopener">https://www.cnblogs.com/paddix/p/5405678.html</a></p><p>link : <a href="https://www.cnblogs.com/LemonFive/p/11246086.html" target="_blank" rel="noopener">https://www.cnblogs.com/LemonFive/p/11246086.html</a></p><p>link:<a href="https://researcher.watson.ibm.com/researcher/files/us-bacon/Bacon98ThinSlides.pdf" target="_blank" rel="noopener">https://researcher.watson.ibm.com/researcher/files/us-bacon/Bacon98ThinSlides.pdf</a></p><p>æ·±å…¥ç†è§£javaè™šæ‹Ÿæœº</p><p>javaå¹¶å‘ç¼–ç¨‹è‰ºæœ¯</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jvm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Overview_Java Virtual Machine</title>
      <link href="/2019/08/11/Overview-Java-Virtual-Machine/"/>
      <url>/2019/08/11/Overview-Java-Virtual-Machine/</url>
      
        <content type="html"><![CDATA[<p>æ¥æ˜“æ¥å»éš¾å» æ•°åè½½çš„äººä¸–æ¸¸</p><p>åˆ†æ˜“åˆ†èšéš¾èš çˆ±ä¸æ¨çš„åƒå¤æ„</p><p>äºæ˜¯ä¸æ„¿èµ°çš„ä½  è¦å‘Šåˆ«å·²ä¸è§çš„æˆ‘</p><p>è‡³ä»Šä¸–é—´äººæœ‰éšçº¦çš„è€³è¯­</p><p>æ»šæ»šçº¢å°˜ä»å­˜éšçº¦çš„è€³è¯­ è·Ÿéšæˆ‘çš„ä¼ è¯´</p><a id="more"></a><p>åŸºäºå®˜ç½‘æŒ‡å¯¼æ–‡æ¡£æ•´ç† <a href="https://docs.oracle.com/en/java/javase/12/vm/java-virtual-machine-technology-overview.html#GUID-982B244A-9B01-479A-8651-CB6475019281" target="_blank" rel="noopener">è¯¦æƒ…ğŸ”</a></p><p>æ›´å¤šèµ„æ–™ğŸ’¾:</p><blockquote><p><a href="https://docs.oracle.com/javase/specs/index.html" target="_blank" rel="noopener">ç›¸å…³è§„èŒƒ</a></p><p><a href="https://docs.oracle.com/en/java/javase/12/gctuning/introduction-garbage-collection-tuning.html#GUID-326EB4CF-8C8C-4267-8355-21AB04F0D304" target="_blank" rel="noopener">HotSpot GC</a></p><p>ä¹¦ç±: ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœº â€”å‘¨å¿—æ˜ã€‹</p></blockquote><h2 id="è™šæ‹Ÿæœºè§„èŒƒ"><a href="#è™šæ‹Ÿæœºè§„èŒƒ" class="headerlink" title="è™šæ‹Ÿæœºè§„èŒƒ"></a>è™šæ‹Ÿæœºè§„èŒƒ</h2><p>æŒ‡ä»¤é›†(è™šæ‹ŸæœºæŒ‡ä»¤é›†)ã€è¿è¡Œå†…å­˜æ•°æ®åŒºåŸŸ(è™šæ‹Ÿæœºç»“æ„)   </p><p>ç¼–è¯‘ </p><p>Classæ–‡ä»¶æ ¼å¼</p><p>ç±»åŠ è½½</p><blockquote><p><a href="https://docs.oracle.com/en/java/javase/12/vm/java-virtual-machine-technology-overview.html#GUID-982B244A-9B01-479A-8651-CB6475019281" target="_blank" rel="noopener">Spec-Java-Virtual-Machine</a></p></blockquote><h2 id="å†…å­˜ä¸çº¿ç¨‹æ¨¡å‹"><a href="#å†…å­˜ä¸çº¿ç¨‹æ¨¡å‹" class="headerlink" title="å†…å­˜ä¸çº¿ç¨‹æ¨¡å‹"></a>å†…å­˜ä¸çº¿ç¨‹æ¨¡å‹</h2><p>Memory model JSR133</p><p>å±è”½ç¯å¢ƒæ— å…³</p><blockquote><p><a href="https://zyumin.github.io/2019/06/14/Spec-JSR133/" target="_blank" rel="noopener">Spec-JSR133</a></p></blockquote><h2 id="hotspot"><a href="#hotspot" class="headerlink" title="hotspot"></a>hotspot</h2><p><strong>Rapid memory allocation and garbage collection</strong></p><p>Java HotSpot technology provides rapid memory allocation for objects and fast, efficient, state-of-the-art garbage collectors.</p><p>Java HotSpotæŠ€æœ¯ä¸ºå¯¹è±¡æä¾›äº†å¿«é€Ÿçš„å†…å­˜åˆ†é…å’Œå¿«é€Ÿã€é«˜æ•ˆã€æœ€å…ˆè¿›çš„åƒåœ¾æ”¶é›†å™¨ã€‚</p><p><strong>Adaptive compiler</strong>:</p><p>A standard interpreter is used to launch the applications. When the application runs, the code is analyzed to detect performance bottlenecks, or <em>hot spots</em>. The Java HotSpot VM compiles the performance-critical portions of the code for a boost in performance, but does not compile the seldom-used code (most of the application). The Java HotSpot VM uses the adaptive compiler to decide how to optimize compiled code with techniques such as inlining.</p><p>â€‹    ä½¿ç”¨æ ‡å‡†è§£é‡Šå™¨å¯åŠ¨åº”ç”¨ç¨‹åºã€‚å½“åº”ç”¨ç¨‹åºè¿è¡Œæ—¶ï¼Œåˆ†æä»£ç ä»¥æ£€æµ‹æ€§èƒ½ç“¶é¢ˆæˆ–çƒ­ç‚¹ã€‚Java HotSpot VMç¼–è¯‘ä»£ç çš„æ€§èƒ½å…³é”®éƒ¨åˆ†ï¼Œä»¥æé«˜æ€§èƒ½ï¼Œä½†æ˜¯ä¸ç¼–è¯‘å¾ˆå°‘ä½¿ç”¨çš„ä»£ç (åº”ç”¨ç¨‹åºçš„å¤§éƒ¨åˆ†)ã€‚Java HotSpot VMä½¿ç”¨è‡ªé€‚åº”ç¼–è¯‘å™¨æ¥å†³å®šå¦‚ä½•ä½¿ç”¨å†…è”ç­‰æŠ€æœ¯æ¥ä¼˜åŒ–ç¼–è¯‘åçš„ä»£ç ã€‚</p><blockquote><p><a href="https://zyumin.github.io/2019/06/19/JVM-Garbage-Collection/" target="_blank" rel="noopener">JVM-Garbage-Collection</a></p><p><a href="https://zyumin.github.io/2019/06/05/Note_%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/" target="_blank" rel="noopener">Note_æ·±å…¥ç†è§£javaè™šæ‹Ÿæœº</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jvm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JDK_Packages_java_lang</title>
      <link href="/2019/08/11/JDK-Packages-java-lang/"/>
      <url>/2019/08/11/JDK-Packages-java-lang/</url>
      
        <content type="html"><![CDATA[<blockquote><p>é‡‘é£ç‰éœ²ä¸€ç›¸é€¢ï¼Œä¾¿èƒœå´äººé—´æ— æ•°                                         â€”â€”ç§¦è§‚ã€Šé¹Šæ¡¥ä»™ã€‹</p></blockquote><p>è¯­è¨€åŸºç¡€åŒ…,langåŒ…å«Base, AutoBoxing ,Utils, VM ,Throwble</p><p>æ³¨è§£ã€å­—èŠ‚ç å¢å¼ºã€åŠ¨æ€è¯­è¨€æ”¯æŒã€åå°„ã€ç®¡ç†ç­‰</p><p>ç›¸å…³èµ„æ–™:</p><ul><li>è™šæ‹Ÿæœºè§„èŒƒ</li><li>JLS   java language spec</li></ul><a id="more"></a><h2 id="java-lang"><a href="#java-lang" class="headerlink" title="java.lang"></a>java.lang</h2><p>Provides classes that are fundamental to the design of the Java programming language.</p><p>æä¾›Javaç¼–ç¨‹è¯­è¨€è®¾è®¡çš„åŸºç¡€ç±»ã€‚</p><h3 id="Base"><a href="#Base" class="headerlink" title="Base"></a>Base</h3><p>Provides classes that are fundamental to the design of the Java programming language. The most important classes are <code>Object</code> ,<code>Class</code></p><p>æä¾›Javaç¼–ç¨‹è¯­è¨€è®¾è®¡çš„åŸºç¡€ç±»ã€‚æœ€é‡è¦çš„ç±»æ˜¯Objectï¼Œå®ƒæ˜¯ç±»å±‚æ¬¡ç»“æ„çš„æ ¹ï¼Œç±»çš„å®ä¾‹è¡¨ç¤ºè¿è¡Œæ—¶çš„ç±»ã€‚</p><p>Classåç»­å’ŒClassLoaderä¸€èµ·åˆ†æ</p><p>1 Byte =  8bit</p><p>1 Char =  2Byte </p><p>1 Integer = 4Byte </p><h3 id="AutoBoxing"><a href="#AutoBoxing" class="headerlink" title="AutoBoxing"></a>AutoBoxing</h3><p>Frequently it is necessary to represent a value of primitive type as if it were an object. The wrapper classes <code>Boolean</code>, <code>Character</code>, <code>Integer</code>, <code>Long</code>, <code>Float</code>, and <code>Double</code> serve this purpose. An object of type <code>Double</code>, for example, contains a field whose type is double, representing that value in such a way that a reference to it can be stored in a variable of reference type. These classes also provide a number of methods for converting among primitive values, as well as supporting such standard methods as equals and hashCode. The <code>Void</code> class is a non-instantiable class that holds a reference to a <code>Class</code> object representing the type void.</p><p>é€šå¸¸æœ‰å¿…è¦å°†åŸºå…ƒç±»å‹çš„å€¼è¡¨ç¤ºä¸ºå¯¹è±¡ã€‚åŒ…è£…å™¨ç±»Booleanã€Characterã€Integerã€Longã€Floatå’ŒDoubleç”¨äºæ­¤ç›®çš„ã€‚ä¾‹å¦‚ï¼ŒDoubleç±»å‹çš„å¯¹è±¡åŒ…å«ä¸€ä¸ªç±»å‹ä¸ºDoubleçš„å­—æ®µï¼Œä»¥ä¸€ç§å¼•ç”¨å¯ä»¥å­˜å‚¨åœ¨å¼•ç”¨ç±»å‹å˜é‡ä¸­çš„æ–¹å¼è¡¨ç¤ºè¯¥å€¼ã€‚è¿™äº›ç±»è¿˜æä¾›äº†è®¸å¤šæ–¹æ³•æ¥åœ¨åŸºæœ¬å€¼ä¹‹é—´è¿›è¡Œè½¬æ¢ï¼Œå¹¶æ”¯æŒequalså’ŒhashCodeç­‰æ ‡å‡†æ–¹æ³•ã€‚Voidç±»æ˜¯ä¸€ä¸ªä¸å¯å®ä¾‹åŒ–çš„ç±»ï¼Œå®ƒæŒæœ‰å¯¹è¡¨ç¤ºç±»å‹Voidçš„ç±»å¯¹è±¡çš„å¼•ç”¨ã€‚</p><p>æ³¨æ„IntegerCache </p><h3 id="Utils-Math-String"><a href="#Utils-Math-String" class="headerlink" title="Utils (Math,String)"></a>Utils (Math,String)</h3><p>The class <code>Math</code> provides commonly used mathematical functions such as sine, cosine, and square root. The classes <code>String</code>, <code>StringBuffer</code>, and <code>StringBuilder</code> similarly provide commonly used operations on character strings.</p><h4 id="Math-amp-StrictMath"><a href="#Math-amp-StrictMath" class="headerlink" title="Math &amp; StrictMath"></a>Math &amp; StrictMath</h4><p>ç±»Mathæä¾›å¸¸ç”¨çš„æ•°å­¦å‡½æ•°ï¼Œå¦‚æ­£å¼¦ã€ä½™å¼¦å’Œå¹³æ–¹æ ¹ã€‚Stringã€StringBufferå’ŒStringBuilderç±»åŒæ ·æä¾›äº†å¯¹å­—ç¬¦ä¸²çš„å¸¸ç”¨æ“ä½œã€‚</p><h4 id="String-amp-StringBuffer-synchronized-amp-StringBuilder"><a href="#String-amp-StringBuffer-synchronized-amp-StringBuilder" class="headerlink" title="String &amp; StringBuffer(synchronized) &amp; StringBuilder"></a>String &amp; StringBuffer(synchronized) &amp; StringBuilder</h4><p>Stringcoding</p><p>regex</p><p>StringJoiner</p><p>Formatter</p><p>Locale</p><p>AbstractStringBuilder</p><p>â¬…ï¸â¬…ï¸â¬…ï¸â¬…ï¸â¬…ï¸</p><h3 id="VM"><a href="#VM" class="headerlink" title="VM"></a>VM</h3><p>Classes <code>ClassLoader</code>,<code>Thread</code>, <code>Process</code>, <code>ProcessBuilder</code>, <code>Runtime</code>, <code>SecurityManager</code>, and <code>System</code> provide â€œsystem operationsâ€ that manage the dynamic loading of classes, creation of external processes, host environment inquiries such as the time of day, and enforcement of security policies.</p><p>ç±»ClassLoaderã€Processã€ProcessBuilderã€Runtimeã€SecurityManagerå’ŒSystemæä¾›â€œç³»ç»Ÿæ“ä½œâ€ï¼Œ</p><p>ç®¡ç†ç±»çš„åŠ¨æ€åŠ è½½ã€åˆ›å»ºå¤–éƒ¨è¿›ç¨‹ã€ä¸»æœºç¯å¢ƒæŸ¥è¯¢(å¦‚ä¸€å¤©çš„æ—¶é—´)å’Œå®‰å…¨ç­–ç•¥çš„æ‰§è¡Œã€‚</p><h4 id="Class-amp-ClassLoader"><a href="#Class-amp-ClassLoader" class="headerlink" title="Class &amp; ClassLoader"></a>Class &amp; ClassLoader</h4><blockquote><p>link: JDK_CLass  &amp;&amp; JDK_ClassLoader</p></blockquote><h4 id="Process-amp-Thread-amp-Runnable"><a href="#Process-amp-Thread-amp-Runnable" class="headerlink" title="Process &amp; Thread &amp; Runnable"></a>Process &amp; Thread &amp; Runnable</h4><p>Process <a href="https://zhuanlan.zhihu.com/p/44957705" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/44957705</a></p><blockquote><p>link:  JDK_Thread</p></blockquote><h4 id="System"><a href="#System" class="headerlink" title="System"></a>System</h4><p>The <code>System</code>Among the facilities provided by the <code>System</code> class are standard input, standard output, and error output streams; access to externally defined properties and environment variables; a means of loading files and libraries; and a utility method for quickly copying a portion of an array.</p><p>java.lang.System#initializeSystemClass</p><p>ç›¸å…³æ–¹æ³•å’Œç±» </p><p>â€‹    SecurityManager </p><p>â€‹    Runtime </p><p>â€‹        Shutdown  java.lang.System#exit</p><p>â€‹        Process</p><p>â€‹        ClassLoader java.lang.System#load</p><p>â€‹        java.lang.System#gc</p><p>â€‹        </p><p>java.lang.System#currentTimeMillis</p><p>java.lang.System#nanoTime</p><p>java.lang.System#arraycopy</p><p>java.lang.System#getenv</p><p>java.lang.System#getProperties            </p><h3 id="Throwable"><a href="#Throwable" class="headerlink" title="Throwable"></a>Throwable</h3><p>Class <code>Throwable</code> encompasses objects that may be thrown by the <code>throw</code> statement. Subclasses of <code>Throwable</code> represent errors and exceptions.</p><p>ç±»å¯æŠ›å‡ºæ€§åŒ…å«ç”±æŠ›å‡ºè¯­å¥æŠ›å‡ºçš„å¯¹è±¡ã€‚Throwableçš„å­ç±»è¡¨ç¤ºé”™è¯¯(Error)å’Œå¼‚å¸¸(Exception å¼ºåˆ¶éœ€è¦å¤„ç†\ è¿è¡Œæ—¶å¼‚å¸¸RuntimeException)ã€‚</p><p>é€šè¿‡ä¸€ä¸ªJDKçš„ä¾‹å­æ¥çœ‹çœ‹ Throwableçš„ä½¿ç”¨</p><pre><code class="java">public class Junk {      public static void main(String args[]) {          try {              a();          } catch(HighLevelException e) {              e.printStackTrace();          }      }      static void a() throws HighLevelException {          try {              b();          } catch(MidLevelException e) {              throw new HighLevelException(e);          }      }      static void b() throws MidLevelException {          c();      }      static void c() throws MidLevelException {          try {              d();          } catch(LowLevelException e) {              throw new MidLevelException(e);          }      }      static void d() throws LowLevelException {         e();      }      static void e() throws LowLevelException {          throw new LowLevelException();      }  }  class HighLevelException extends Exception {      HighLevelException(Throwable cause) { super(cause); }  }  class MidLevelException extends Exception {      MidLevelException(Throwable cause)  { super(cause); }  }  class LowLevelException extends Exception {  }</code></pre><p>è¿è¡Œç»“æœå¦‚ä¸‹</p><pre><code class="java">lang.Throwble.HighLevelException: lang.Throwble.MidLevelException: lang.Throwble.LowLevelException     at lang.Throwble.Junk.a(Junk.java:15)     at lang.Throwble.Junk.main(Junk.java:6)Caused by: lang.Throwble.MidLevelException: lang.Throwble.LowLevelException     at lang.Throwble.Junk.c(Junk.java:25)     at lang.Throwble.Junk.b(Junk.java:19)     at lang.Throwble.Junk.a(Junk.java:13)     ... 1 moreCaused by: lang.Throwble.LowLevelException     at lang.Throwble.Junk.e(Junk.java:32)     at lang.Throwble.Junk.d(Junk.java:29)     at lang.Throwble.Junk.c(Junk.java:23)     ... 3 more</code></pre><p>é€šè¿‡è§‚å¯Ÿè¿™ä¸ªç»“æœ, å’Œåˆ†æ æˆ‘ä»¬æ¥çœ‹çœ‹Throwableéƒ½æœ‰å“ªäº›æˆå‘˜</p><pre><code class="java">private void printStackTrace(PrintStreamOrWriter s) {    // Guard against malicious overrides of Throwable.equals by    // using a Set with identity equality semantics.    //  IdentityHashMap æ¯”è¾ƒçš„æ˜¯åœ°å€å€¼ int h = System.identityHashCode(x);    Set&lt;Throwable&gt; dejaVu =        Collections.newSetFromMap(new IdentityHashMap&lt;Throwable, Boolean&gt;());    dejaVu.add(this);    synchronized (s.lock()) {        // Print our stack trace        s.println(this);        StackTraceElement[] trace = getOurStackTrace();        for (StackTraceElement traceElement : trace)            s.println(&quot;\tat &quot; + traceElement);        // Print suppressed exceptions, if any        for (Throwable se : getSuppressed())            se.printEnclosedStackTrace(s, trace, SUPPRESSED_CAPTION, &quot;\t&quot;, dejaVu);        // Print cause, if any        Throwable ourCause = getCause();        if (ourCause != null)            ourCause.printEnclosedStackTrace(s, trace, CAUSE_CAPTION, &quot;&quot;, dejaVu);    }}</code></pre><p> s.println(this);</p><pre><code class="java">public String toString() {    String s = getClass().getName();    String message = getLocalizedMessage();    return (message != null) ? (s + &quot;: &quot; + message) : s;}</code></pre><p>å¯ä»¥çœ‹åˆ°å…¶å®å°±æ˜¯  </p><ul><li>ç±»ååŠ Message</li><li>å †æ ˆä¿¡æ¯StackTraceElement</li><li>ourCause  Caused by:ä¸Šå±‚å¼‚å¸¸</li></ul><h2 id="java-lang-annotation"><a href="#java-lang-annotation" class="headerlink" title="java.lang.annotation"></a>java.lang.annotation</h2><p>Provides library support for the Java programming language annotation facility.</p><p>ä¸ºJavaç¼–ç¨‹è¯­è¨€æ³¨è§£å·¥å…·æä¾›åº“æ”¯æŒã€‚</p><pre><code class="java">/* * More information about annotation types can be found in section 9.6 of * &lt;cite&gt;The Java&amp;trade; Language Specification&lt;/cite&gt;. */</code></pre><p>æ³¨è§£ï¼ˆAnnotationï¼‰ï¼Œä¹Ÿå«ï¼ˆmetadataï¼‰å…ƒæ•°æ®ã€‚ä¸€ç§ä»£ç çº§åˆ«çš„è¯´æ˜ã€‚å®ƒæ˜¯JDK1.5åŠä»¥åç‰ˆæœ¬å¼•å…¥çš„ä¸€ä¸ªç‰¹æ€§ï¼Œä¸ç±»ã€æ¥å£ã€æšä¸¾æ˜¯åœ¨åŒä¸€ä¸ªå±‚æ¬¡ã€‚å®ƒå¯ä»¥å£°æ˜åœ¨åŒ…ã€ç±»ã€å­—æ®µã€æ–¹æ³•ã€å±€éƒ¨å˜é‡ã€æ–¹æ³•å‚æ•°ç­‰çš„å‰é¢ï¼Œç”¨æ¥å¯¹è¿™äº›å…ƒç´ è¿›è¡Œè¯´æ˜ï¼Œæ³¨é‡Šã€‚è¿™äº›ä¿¡æ¯è¢«å­˜å‚¨åœ¨Annotationçš„â€œname=valueâ€ç»“æ„å¯¹ä¸­ã€‚</p><p>å¤§è‡´å¯åˆ†ä¸ºä¸‰ç±»ï¼š</p><ul><li><p>ç¼–å†™æ–‡æ¡£ï¼šé€šè¿‡ä»£ç é‡Œæ ‡è¯†çš„å…ƒæ•°æ®ç”Ÿæˆæ–‡æ¡£ã€‚</p></li><li><p>ä»£ç åˆ†æï¼šé€šè¿‡ä»£ç é‡Œæ ‡è¯†çš„å…ƒæ•°æ®å¯¹ä»£ç è¿›è¡Œåˆ†æã€‚</p></li><li><p>ç¼–è¯‘æ£€æŸ¥ï¼šé€šè¿‡ä»£ç é‡Œæ ‡è¯†çš„å…ƒæ•°æ®è®©ç¼–è¯‘å™¨èƒ½å®ç°åŸºæœ¬çš„ç¼–è¯‘æ£€æŸ¥</p></li></ul><p>â€‹    </p><h3 id="å†…ç½®æ³¨è§£"><a href="#å†…ç½®æ³¨è§£" class="headerlink" title="å†…ç½®æ³¨è§£"></a>å†…ç½®æ³¨è§£</h3><p>å†…ç½®æ³¨è§£åˆ†ä¸ºä¸‰ç±»ï¼š</p><ul><li>@Override</li><li>@Deprecated</li><li>@SuppressWarnings</li></ul><h3 id="å…ƒæ³¨è§£"><a href="#å…ƒæ³¨è§£" class="headerlink" title="å…ƒæ³¨è§£"></a>å…ƒæ³¨è§£</h3><p>å…ƒæ³¨è§£å°±æ˜¯å®šä¹‰æ³¨è§£çš„æ³¨è§£ï¼Œç”± java API æä¾›ï¼Œåˆ†åˆ«æœ‰å››ä¸ªå…ƒæ³¨è§£ï¼š</p><ul><li><p>@Target </p><p>  ç”¨äºæè¿°æ³¨è§£çš„ä½¿ç”¨èŒƒå›´ã€‚ä¿®é¥°çš„å¯¹è±¡èŒƒå›´ï¼špackagesã€typesï¼ˆç±»ã€æ¥å£ã€æšä¸¾ã€Annotationç±»å‹ï¼‰ã€ç±»å‹æˆå‘˜ï¼ˆæ–¹æ³•ã€æ„é€ æ–¹æ³•ã€æˆå‘˜å˜é‡ã€æšä¸¾å€¼ï¼‰ã€æ–¹æ³•å‚æ•°å’Œæœ¬åœ°å˜é‡ï¼ˆå¦‚ catch å‚æ•°ï¼‰ã€‚</p><p>  å®ƒçš„å€¼åœ¨æšä¸¾ç±» ElemenetType ä¸­ï¼š</p><ul><li>CONSTRUCTORï¼š ç”¨äºæè¿°æ„é€ å™¨</li><li>FIELD ï¼š ç”¨äºæè¿°åŸŸ</li><li>LOCAL_VARIABLEï¼š ç”¨äºæè¿°å±€éƒ¨å˜é‡</li><li>METHOD ï¼š ç”¨äºæè¿°æ–¹æ³•</li><li>PACKAGE ï¼š ç”¨äºæè¿°åŒ…</li><li>PARAMETER ï¼š ç”¨äºæè¿°å‚æ•°</li><li>TYPE ï¼š ç”¨äºæè¿°ç±»ã€æ¥å£(åŒ…æ‹¬æ³¨è§£ç±»å‹) æˆ–enumå£°æ˜</li></ul></li><li><p>@Retention</p><p>  è¡¨ç¤ºéœ€è¦åœ¨ä»€ä¹ˆçº§åˆ«ä¿å­˜è¯¥æ³¨é‡Šä¿¡æ¯ï¼Œç”¨äºæè¿°æ³¨è§£çš„ç”Ÿå‘½å‘¨æœŸï¼ˆå³ï¼šè¢«æè¿°çš„æ³¨è§£åœ¨ä»€ä¹ˆèŒƒå›´å†…æœ‰æ•ˆï¼‰ï¼Œå®šä¹‰äº†è¯¥Annotationè¢«ä¿ç•™çš„æ—¶é—´é•¿çŸ­ï¼šæŸäº›Annotationä»…å‡ºç°åœ¨æºä»£ç ä¸­ï¼Œè€Œè¢«ç¼–è¯‘å™¨ä¸¢å¼ƒï¼›è€Œå¦ä¸€äº›å´è¢«ç¼–è¯‘åœ¨classæ–‡ä»¶ä¸­ï¼›ç¼–è¯‘åœ¨classæ–‡ä»¶ä¸­çš„Annotationå¯èƒ½ä¼šè¢«è™šæ‹Ÿæœºå¿½ç•¥ï¼Œè€Œå¦ä¸€äº›åœ¨classè¢«è£…è½½æ—¶å°†è¢«è¯»å–ã€‚</p><p>  RetentionPoicyå–å€¼ï¼š</p><ul><li>SOURCE ï¼š åœ¨æºæ–‡ä»¶ä¸­æœ‰æ•ˆï¼ˆå³æºæ–‡ä»¶ä¿ç•™ï¼‰</li><li>CLASS ï¼š åœ¨classæ–‡ä»¶ä¸­æœ‰æ•ˆï¼ˆå³classä¿ç•™ï¼‰</li><li>RUNTIME ï¼š åœ¨è¿è¡Œæ—¶æœ‰æ•ˆï¼ˆå³è¿è¡Œæ—¶ä¿ç•™ï¼‰</li></ul></li><li><p>@Documented</p><p>  ç”¨äºæè¿°å…¶å®ƒç±»å‹çš„annotationåº”è¯¥è¢«ä½œä¸ºè¢«æ ‡æ³¨çš„ç¨‹åºæˆå‘˜çš„å…¬å…±APIï¼ŒDocumented æ˜¯ä¸€ä¸ªæ ‡è®°æ³¨è§£ï¼Œæ²¡æœ‰æˆå‘˜ã€‚å°†æ­¤æ³¨è§£åŒ…å«åœ¨ javadoc ä¸­ ï¼Œå®ƒä»£è¡¨ç€æ­¤æ³¨è§£ä¼šè¢«javadocå·¥å…·æå–æˆæ–‡æ¡£ã€‚åœ¨docæ–‡æ¡£ä¸­çš„å†…å®¹ä¼šå› ä¸ºæ­¤æ³¨è§£çš„ä¿¡æ¯å†…å®¹ä¸åŒè€Œä¸åŒã€‚</p></li><li><p>@Inherited</p><p>  å…è®¸å­ç±»ç»§æ‰¿çˆ¶ç±»ä¸­çš„æ³¨è§£ï¼Œæ˜¯ä¸€ä¸ªæ ‡è®°æ³¨è§£ï¼Œ@Inheritedé˜è¿°äº†æŸä¸ªè¢«æ ‡æ³¨çš„ç±»å‹æ˜¯è¢«ç»§æ‰¿çš„ã€‚å¦‚æœä¸€ä¸ªä½¿ç”¨äº†@Inheritedä¿®é¥°çš„annotationç±»å‹è¢«ç”¨äºä¸€ä¸ªclassï¼Œåˆ™è¿™ä¸ªannotationå°†è¢«ç”¨äºè¯¥classçš„å­ç±»ã€‚</p></li></ul><p>@link : <a href="https://www.jianshu.com/p/d124f24e685c" target="_blank" rel="noopener">https://www.jianshu.com/p/d124f24e685c</a></p><h2 id="java-lang-instrument"><a href="#java-lang-instrument" class="headerlink" title="java.lang.instrument"></a>java.lang.instrument</h2><p>Provides services that allow Java programming language agents to instrument programs running on the JVM.</p><p>æä¾›å…è®¸Javaç¼–ç¨‹è¯­è¨€ä»£ç†å¯¹è¿è¡Œåœ¨JVMä¸Šçš„ç¨‹åºè¿›è¡Œå¢å¼ºçš„æœåŠ¡ã€‚</p><p>JPDAä½“ç³»æ¦‚è§ˆ</p><ul><li>JPDA å®šä¹‰äº†ä¸€å¥—å¦‚ä½•å¼€å‘è°ƒè¯•å·¥å…·çš„æ¥å£å’Œè§„èŒƒã€‚</li><li>JPDA ç”±ä¸‰ä¸ªç‹¬ç«‹çš„æ¨¡å— JVMTIã€JDWPã€JDI ç»„æˆã€‚<ul><li>è°ƒè¯•è€…é€šè¿‡ JDI å‘é€æ¥å—è°ƒè¯•å‘½ä»¤ã€‚</li><li>JDWP å®šä¹‰è°ƒè¯•è€…å’Œè¢«è°ƒè¯•è€…äº¤æµæ•°æ®çš„æ ¼å¼ã€‚</li><li>JVMTI å¯ä»¥æ§åˆ¶å½“å‰è™šæ‹Ÿæœºè¿è¡ŒçŠ¶æ€ã€‚</li></ul></li></ul><p><a href="https://www.ibm.com/developerworks/cn/java/j-lo-jpda2/index.html?ca=drs-" target="_blank" rel="noopener">https://www.ibm.com/developerworks/cn/java/j-lo-jpda2/index.html?ca=drs-</a></p><p><a href="https://www.cnblogs.com/yelao/p/9841810.html" target="_blank" rel="noopener">https://www.cnblogs.com/yelao/p/9841810.html</a></p><p>class</p><p>java.lang.instrument.ClassFileTransformer</p><p>java.lang.instrument.Instrumentation</p><p>java.lang.instrument.ClassDefinition</p><h2 id="java-lang-invoke"><a href="#java-lang-invoke" class="headerlink" title="java.lang.invoke"></a>java.lang.invoke</h2><p>The java.lang.invoke package contains dynamic language support provided directly by the Java core class libraries and virtual machine.</p><p>åŒ…å«Javaæ ¸å¿ƒç±»åº“å’Œè™šæ‹Ÿæœºç›´æ¥æä¾›çš„åŠ¨æ€è¯­è¨€æ”¯æŒã€‚</p><p>java7åœ¨JSR 292ä¸­å¢åŠ äº†å¯¹åŠ¨æ€ç±»å‹è¯­è¨€çš„æ”¯æŒï¼Œä½¿Javaä¹Ÿå¯ä»¥åƒCè¯­è¨€é‚£æ ·å°†æ–¹æ³•ä½œä¸ºå‚æ•°ä¼ é€’ï¼Œå…¶å®ç°åœ¨lava.lang.invokeåŒ…ä¸­ã€‚MethodHandleä½œç”¨ç±»ä¼¼äºåå°„ä¸­çš„Methodç±»ï¼Œä½†å®ƒæ¯”Methodç±»è¦æ›´åŠ çµæ´»å’Œè½»é‡çº§ã€‚é€šè¿‡MethodHandleè¿›è¡Œæ–¹æ³•è°ƒç”¨ä¸€èˆ¬éœ€è¦ä»¥ä¸‹å‡ æ­¥ï¼š</p><ol><li>åˆ›å»ºMethodTypeå¯¹è±¡ï¼ŒæŒ‡å®šæ–¹æ³•çš„ç­¾åï¼›</li><li>åœ¨MethodHandles.Lookupä¸­æŸ¥æ‰¾ç±»å‹ä¸ºMethodTypeçš„MethodHandleï¼›</li><li>ä¼ å…¥æ–¹æ³•å‚æ•°å¹¶è°ƒç”¨MethodHandle.invokeæˆ–è€…MethodHandle.invokeExactæ–¹æ³•ã€‚</li></ol><p>InvokeDynamic</p><p><a href="https://www.cnblogs.com/sheeva/p/6344388.html" target="_blank" rel="noopener">https://www.cnblogs.com/sheeva/p/6344388.html</a></p><p>åœ¨çœ‹javaè™šæ‹Ÿæœºå­—èŠ‚ç æ‰§è¡Œå¼•æ“çš„æ—¶å€™ï¼Œé‡Œé¢æåˆ°äº†javaè™šæ‹Ÿæœºé‡Œè°ƒç”¨æ–¹æ³•çš„å­—èŠ‚ç æŒ‡ä»¤æœ‰5ç§ï¼š</p><ul><li>invokestaticã€€ã€€//è°ƒç”¨é™æ€æ–¹æ³•</li><li>invokespecialã€€ã€€//è°ƒç”¨ç§æœ‰æ–¹æ³•ã€å®ä¾‹æ„é€ å™¨æ–¹æ³•ã€çˆ¶ç±»æ–¹æ³•</li><li>invokevirtualã€€ã€€//è°ƒç”¨å®ä¾‹æ–¹æ³•</li><li>invokeinterfaceã€€ã€€//è°ƒç”¨æ¥å£æ–¹æ³•ï¼Œä¼šåœ¨è¿è¡Œæ—¶å†ç¡®å®šä¸€ä¸ªå®ç°æ­¤æ¥å£çš„å¯¹è±¡</li><li><strong>invokedynamic</strong>ã€€ã€€//å…ˆåœ¨è¿è¡Œæ—¶åŠ¨æ€è§£æå‡ºè°ƒç”¨ç‚¹é™å®šç¬¦æ‰€å¼•ç”¨çš„æ–¹æ³•ï¼Œç„¶åå†æ‰§è¡Œè¯¥æ–¹æ³•ï¼Œåœ¨æ­¤ä¹‹å‰çš„4æ¡è°ƒç”¨æŒ‡ä»¤ï¼Œåˆ†æ´¾é€»è¾‘æ˜¯å›ºåŒ–åœ¨javaè™šæ‹Ÿæœºå†…éƒ¨çš„ï¼Œè€ŒinvokedynamicæŒ‡ä»¤çš„åˆ†æ´¾é€»è¾‘æ˜¯ç”±ç”¨æˆ·æ‰€è®¾å®šçš„å¼•å¯¼æ–¹æ³•å†³å®šçš„ã€‚</li></ul><p>CallSite</p><p>ä»è¯­è¨€çš„é™æ€ç±»å‹å’ŒåŠ¨æ€ç±»å‹è¯´èµ·ï¼š</p><ul><li>é™æ€ç±»å‹å°±æ˜¯æ¯ä¸ªå˜é‡åœ¨åˆå§‹åŒ–çš„æ—¶å€™å°±è¦å£°æ˜å”¯ä¸€çš„ç±»å‹å¹¶ä¸”ä¸èƒ½æ”¹å˜ã€‚</li><li>åŠ¨æ€ç±»å‹å°±æ˜¯è¯´å˜é‡æ²¡æœ‰å›ºå®šç±»å‹ï¼Œå˜é‡çš„ç±»å‹å–å†³äºå®ƒé‡Œé¢å…ƒç´ çš„ç±»å‹ã€‚</li></ul><p>javaè¯­è¨€æ˜¯é™æ€ç±»å‹çš„ã€‚æœ‰äººå¯èƒ½ä¼šæåˆ°æ³›å‹ï¼Œjavaçš„æ³›å‹æ˜¯æ“¦é™¤å¼çš„ï¼Œä¹Ÿå°±æ˜¯è¯´è™½ç„¶åœ¨ç¼–å†™javaæºç æ—¶çœ‹èµ·æ¥å¥½åƒä¸èƒ½ç¡®å®šå˜é‡ç±»å‹ï¼Œä½†æ˜¯åœ¨javaç¼–è¯‘ä¸ºå­—èŠ‚ç çš„è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸€ä¸ªå˜é‡éƒ½æ˜¯æœ‰ç¡®å®šçš„ç±»å‹çš„ã€‚</p><p>æ‰€ä»¥ä»javaè¯­è¨€çš„è§’åº¦ï¼Œä¹‹å‰çš„4æ¡æ–¹æ³•è°ƒç”¨æŒ‡ä»¤æ˜¯å®Œå…¨å¤Ÿç”¨çš„ï¼Œä½†æ˜¯è¦çŸ¥é“ï¼Œjvmä¸åªæ˜¯è·¨å¹³å°çš„ï¼Œè¿˜æ˜¯è·¨è¯­è¨€çš„ï¼Œå½“æœ‰äººåœ¨jvmä¸Šè¯•å›¾å¼€å‘åŠ¨æ€ç±»å‹è¯­è¨€çš„æ—¶å€™ï¼Œé—®é¢˜å°±æ¥äº†ï¼š</p><p>jvmå¤§å¤šæ•°æŒ‡ä»¤éƒ½æ˜¯ç±»å‹æ— å…³çš„ï¼Œä½†æ˜¯åœ¨æ–¹æ³•è°ƒç”¨çš„æ—¶å€™ï¼Œå´ä¸æ˜¯è¿™æ ·ï¼Œæ¯ä¸ªæ–¹æ³•è°ƒç”¨åœ¨ç¼–è¯‘é˜¶æ®µå°±å¿…é¡»æŒ‡æ˜æ–¹æ³•å‚æ•°å’Œè¿”å›å€¼ç±»å‹ï¼Œä½†æ˜¯åŠ¨æ€ç±»å‹è¯­è¨€çš„æ–¹æ³•å‚æ•°ï¼Œç›´åˆ°è¿è¡Œæ—¶åˆ»æ‰èƒ½çŸ¥é“ç±»å‹å•Šï¼Œå› æ­¤jdkå°±åšäº†è¿™æ ·ä¸€ä¸ªâ€œè¡¥ä¸â€ï¼šç”¨invokedynamicè°ƒç”¨æ–¹æ³•çš„æ—¶å€™ï¼Œä¼šè½¬åˆ°bootstrapæ–¹æ³•ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•é‡Œå¯ä»¥åŠ¨æ€è·å–å‚æ•°ç±»å‹ï¼Œç„¶åæ ¹æ®å‚æ•°ç±»å‹åˆ†æ´¾åˆé€‚çš„æ–¹æ³•ä½œä¸ºCallSite(åŠ¨æ€è°ƒç”¨ç‚¹)ï¼Œæœ€åçœŸå®è°ƒç”¨çš„å°±æ˜¯CallSizeé‡Œçš„æ–¹æ³•ã€‚å¦‚æ­¤ä¾¿èƒ½åœ¨jvmä¸Šå®ç°åŠ¨æ€ç±»å‹è¯­è¨€çš„æ–¹æ³•è°ƒç”¨äº†ã€‚</p><h2 id="java-lang-management"><a href="#java-lang-management" class="headerlink" title="java.lang.management"></a>java.lang.management</h2><p>Provides the management interfaces for monitoring and management of the Java virtual machine and other components in the Java runtime.</p><p>æä¾›ç”¨äºç›‘è§†å’Œç®¡ç†Javaè™šæ‹Ÿæœºå’ŒJavaè¿è¡Œæ—¶ä¸­çš„å…¶ä»–ç»„ä»¶çš„ç®¡ç†æ¥å£ã€‚</p><p><a href="https://docs.oracle.com/javase/8/docs/api/javax/management/package-summary.html" target="_blank" rel="noopener">JMX</a> Instrumentation Specification</p><p>è®¿é—®MXBeansçš„æ–¹æ³•</p><p><strong>1.ç›´æ¥è®¿é—®MXBeanæ¥å£</strong></p><p><strong>2.é€šè¿‡MBeanServeré—´æ¥è®¿é—®MXBeanæ¥å£</strong></p><p>jmxè§„èŒƒ</p><p> <a href="https://docs.oracle.com/javase/8/docs/api/javax/management/package-summary.html" target="_blank" rel="noopener">https://docs.oracle.com/javase/8/docs/api/javax/management/package-summary.html</a></p><p>ManagementFactory</p><p>å®ç°-&gt; sumåŒ…ä¸­ ?  ğŸ˜ª</p><h2 id="java-lang-ref"><a href="#java-lang-ref" class="headerlink" title="java.lang.ref"></a>java.lang.ref</h2><p>Provides reference-object classes, which support a limited degree of interaction with the garbage collector.</p><p>æä¾›å¼•ç”¨å¯¹è±¡ç±»ï¼Œè¯¥ç±»æ”¯æŒä¸åƒåœ¾æ”¶é›†å™¨è¿›è¡Œæœ‰é™ç¨‹åº¦çš„äº¤äº’ã€‚</p><p><strong>è¡¨ 1. å¼•ç”¨ç±»å‹ç‰¹æ€§æ€»ç»“</strong></p><table><thead><tr><th><strong>å¼•ç”¨ç±»å‹</strong></th><th><strong>å–å¾—ç›®æ ‡å¯¹è±¡æ–¹å¼</strong></th><th><strong>åƒåœ¾å›æ”¶æ¡ä»¶</strong></th><th><strong>æ˜¯å¦å¯èƒ½å†…å­˜æ³„æ¼</strong></th></tr></thead><tbody><tr><td>å¼ºå¼•ç”¨</td><td>ç›´æ¥è°ƒç”¨</td><td>ä¸å›æ”¶</td><td>å¯èƒ½</td></tr><tr><td>è½¯å¼•ç”¨</td><td>é€šè¿‡ get() æ–¹æ³•</td><td>è§†å†…å­˜æƒ…å†µå›æ”¶</td><td>ä¸å¯èƒ½</td></tr><tr><td>å¼±å¼•ç”¨</td><td>é€šè¿‡ get() æ–¹æ³•</td><td>æ°¸è¿œå›æ”¶</td><td>ä¸å¯èƒ½</td></tr><tr><td>è™šå¼•ç”¨</td><td>æ— æ³•å–å¾—</td><td>ä¸å›æ”¶</td><td>å¯èƒ½</td></tr></tbody></table><p><strong>è¡¨ 2ï¼šå„ä¸ªå¼•ç”¨åœ¨ GC åæ˜¯å¦è¢«å›æ”¶ï¼Ÿ</strong></p><table><thead><tr><th><strong>ç±»å‹</strong></th><th><strong>GC åæ˜¯å¦å›æ”¶</strong></th><th><strong>ç¤ºä¾‹ä»£ç </strong></th><th><strong>è¿è¡Œç»“æœ</strong></th></tr></thead><tbody><tr><td>StrongReference</td><td>ä¸å›æ”¶</td><td>è§æ¸…å• 3</td><td>name:10</td></tr><tr><td>SoftReference</td><td>ä¸å›æ”¶</td><td>è§æ¸…å• 4</td><td>name:10</td></tr><tr><td>WeakReference</td><td>å›æ”¶</td><td>è§æ¸…å• 5</td><td>name:10</td></tr><tr><td>PhantomReference</td><td>N/A</td><td>N/A</td><td>N/A</td></tr></tbody></table><p><a href="https://www.cnblogs.com/rollenholt/archive/2011/09/21/2183077.html" target="_blank" rel="noopener">https://www.cnblogs.com/rollenholt/archive/2011/09/21/2183077.html</a></p><h2 id="java-lang-reflect"><a href="#java-lang-reflect" class="headerlink" title="java.lang.reflect"></a>java.lang.reflect</h2><p>Provides classes and interfaces for obtaining reflective information about classes and objects.</p><p>æä¾›ç”¨äºè·å–æœ‰å…³ç±»å’Œå¯¹è±¡çš„åå°„ä¿¡æ¯çš„ç±»å’Œæ¥å£ã€‚</p><p>Constructã€Fieldã€Method</p><p>Fastjson </p><p>Proxy </p><p><a href="https://www.cnblogs.com/xrq730/p/4918762.html" target="_blank" rel="noopener">https://www.cnblogs.com/xrq730/p/4918762.html</a></p>]]></content>
      
      
      <categories>
          
          <category> jdk </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jdk </tag>
            
            <tag> packages </tag>
            
            <tag> lang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JDK_Packages_java_utils</title>
      <link href="/2019/08/11/JDK-Packages-java-utils/"/>
      <url>/2019/08/11/JDK-Packages-java-utils/</url>
      
        <content type="html"><![CDATA[<p>utilsåŒ…éœ€è¦å…³æ³¨çš„ä¸»è¦æœ‰</p><p>â€‹    é›†åˆæ¡†æ¶ã€å¹¶å‘åŒ…ã€å‡½æ•°å¼ç¼–ç¨‹ã€è§‚å¯Ÿè€…æ¨¡å¼@see PropertyChangeSupport</p><a id="more"></a><h3 id="java-util-é›†åˆæ¡†æ¶"><a href="#java-util-é›†åˆæ¡†æ¶" class="headerlink" title="java.util(é›†åˆæ¡†æ¶)"></a>java.util(é›†åˆæ¡†æ¶)</h3><p>Contains the collections framework, legacy collection classes, event model, date and time facilities, internationalization, and miscellaneous utility classes (a string tokenizer, a random-number generator, and a bit array).</p><p>åŒ…å«é›†åˆæ¡†æ¶ã€é—ç•™é›†åˆç±»ã€äº‹ä»¶æ¨¡å‹ã€æ—¥æœŸå’Œæ—¶é—´å·¥å…·ã€å›½é™…åŒ–å’Œæ‚é¡¹å®ç”¨ç¨‹åºç±»(å­—ç¬¦ä¸²è®°å·èµ‹äºˆå™¨ã€éšæœºæ•°ç”Ÿæˆå™¨å’Œä½æ•°ç»„)ã€‚</p><blockquote><p><a href="https://zyumin.github.io/2019/07/29/JDK-The-Collections-Framework/" target="_blank" rel="noopener">JDK-The-Collections-Framework</a></p></blockquote><h3 id="java-util-concurrent-å¹¶å‘åŒ…-ã€-åŸå­ç±»ã€é”"><a href="#java-util-concurrent-å¹¶å‘åŒ…-ã€-åŸå­ç±»ã€é”" class="headerlink" title="java.util.concurrent (å¹¶å‘åŒ… ã€ åŸå­ç±»ã€é”)"></a>java.util.concurrent (å¹¶å‘åŒ… ã€ åŸå­ç±»ã€é”)</h3><p>Utility classes commonly useful in concurrent programming.</p><p>java.util.concurrent.atomic     A small toolkit of classes that support lock-free thread-safe programming on single variables.</p><p>java.util.concurrent.locks     Interfaces and classes providing a framework for locking and waiting for conditions that is distinct from built-in synchronization and monitors.</p><blockquote><p> <a href="https://zyumin.github.io/2019/08/10/JDK-The-Concurrent-Framework/" target="_blank" rel="noopener">JDK-The-Concurrent-Framework</a></p></blockquote><h3 id="java-util-function-å‡½æ•°å¼ç¼–ç¨‹"><a href="#java-util-function-å‡½æ•°å¼ç¼–ç¨‹" class="headerlink" title="java.util.function    (å‡½æ•°å¼ç¼–ç¨‹)"></a>java.util.function    (å‡½æ•°å¼ç¼–ç¨‹)</h3><p>Functional interfaces provide target types for lambda expressions and method references.</p><p>There are several basic function shapes,</p><p> including <a href="https://docs.oracle.com/javase/8/docs/api/java/util/function/Function.html" target="_blank" rel="noopener"><code>Function</code></a> (unary function from <code>T</code> to <code>R</code>),</p><p> <a href="https://docs.oracle.com/javase/8/docs/api/java/util/function/Consumer.html" target="_blank" rel="noopener"><code>Consumer</code></a> (unary function from <code>T</code> to <code>void</code>),</p><p> <a href="https://docs.oracle.com/javase/8/docs/api/java/util/function/Predicate.html" target="_blank" rel="noopener"><code>Predicate</code></a> (unary function from <code>T</code> to <code>boolean</code>),</p><p> and <a href="https://docs.oracle.com/javase/8/docs/api/java/util/function/Supplier.html" target="_blank" rel="noopener"><code>Supplier</code></a> (nilary function to <code>R</code>).</p><h3 id="java-util-stream-æµå¼ç¼–ç¨‹"><a href="#java-util-stream-æµå¼ç¼–ç¨‹" class="headerlink" title="java.util.stream(æµå¼ç¼–ç¨‹)"></a>java.util.stream(æµå¼ç¼–ç¨‹)</h3><p>Classes to support functional-style operations on streams of elements, such as map-reduce transformations on collections.</p><p>ç±»æ¥æ”¯æŒå…ƒç´ æµä¸Šçš„å‡½æ•°å¼æ“ä½œï¼Œä¾‹å¦‚é›†åˆä¸Šçš„æ˜ å°„-reduceè½¬æ¢ã€‚</p><p>java.util.stream.Stream</p><h3 id="java-util-logging-æ—¥å¿—"><a href="#java-util-logging-æ—¥å¿—" class="headerlink" title="java.util.logging(æ—¥å¿—)"></a>java.util.logging(æ—¥å¿—)</h3><p>Provides the classes and interfaces of the JavaTM 2 platformâ€™s core logging facilities.</p><h3 id="java-util-prefs"><a href="#java-util-prefs" class="headerlink" title="java.util.prefs"></a>java.util.prefs</h3><p>This package allows applications to store and retrieve user and system preference and configuration data.</p><p>è¿™ä¸ªåŒ…å…è®¸åº”ç”¨ç¨‹åºå­˜å‚¨å’Œæ£€ç´¢ç”¨æˆ·å’Œç³»ç»Ÿé¦–é€‰é¡¹ä»¥åŠé…ç½®æ•°æ®ã€‚</p><h3 id="java-util-regex"><a href="#java-util-regex" class="headerlink" title="java.util.regex"></a>java.util.regex</h3><p>Classes for matching character sequences against patterns specified by regular expressions.</p><p>ç”¨äºæ ¹æ®æ­£åˆ™è¡¨è¾¾å¼æŒ‡å®šçš„æ¨¡å¼åŒ¹é…å­—ç¬¦åºåˆ—çš„ç±»ã€‚</p><h3 id="java-util-spi"><a href="#java-util-spi" class="headerlink" title="java.util.spi"></a>java.util.spi</h3><p>Service provider classes for the classes in the java.util package.</p><p>ç”¨äºjavaä¸­çš„ç±»çš„æœåŠ¡æä¾›ç¨‹åºç±»</p><h3 id="java-util-zip-è¯»å†™zip"><a href="#java-util-zip-è¯»å†™zip" class="headerlink" title="java.util.zip(è¯»å†™zip)"></a>java.util.zip(è¯»å†™zip)</h3><p>Provides classes for reading and writing the standard ZIP and GZIP file formats.</p><h3 id="java-util-jar-jaråŒ…å·¥å…·"><a href="#java-util-jar-jaråŒ…å·¥å…·" class="headerlink" title="java.util.jar(jaråŒ…å·¥å…·)"></a>java.util.jar(jaråŒ…å·¥å…·)</h3><p>Provides classes for reading and writing the JAR (Java ARchive) file format, which is based on the standard ZIP file format with an optional manifest file.</p>]]></content>
      
      
      <categories>
          
          <category> jdk </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jdk </tag>
            
            <tag> packages </tag>
            
            <tag> utils </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JDK_The Concurrent Framework</title>
      <link href="/2019/08/10/JDK-The-Concurrent-Framework/"/>
      <url>/2019/08/10/JDK-The-Concurrent-Framework/</url>
      
        <content type="html"><![CDATA[<p><img src="http://ww4.sinaimg.cn/large/006tNc79gy1g5utotuddmj30f409gjrs.jpg" alt="img"></p><a id="more"></a><h3 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h3><p><img src="http://ww4.sinaimg.cn/large/006y8mN6gy1g6740ptmguj30lw0g0acz.jpg" alt="image-20190820172914051"></p><p>CASå®ç° ã€volatileè¯­æ„  -&gt; AQS(AbstractQueuedSynchronizer)</p><h3 id="java-util-concurrent"><a href="#java-util-concurrent" class="headerlink" title="java.util.concurrent"></a>java.util.concurrent</h3><p>Utility classes commonly useful in concurrent programming.This package includes a few small standardized extensible frameworks, as well as some classes that provide useful functionality and are otherwise tedious or difficult to implement.</p><p>å®ç”¨ç¨‹åºç±»é€šå¸¸ç”¨äºå¹¶å‘ç¼–ç¨‹ã€‚è¿™ä¸ªåŒ…, åŒ…æ‹¬ä¸€äº›å°å‹çš„æ ‡å‡†åŒ–å¯æ‰©å±•æ¡†æ¶ï¼Œä»¥åŠä¸€äº›æä¾›æœ‰ç”¨åŠŸèƒ½çš„ç±»ï¼Œé€šå¸¸è¿™äº›ç±»æ˜¯å•è°ƒä¹å‘³æˆ–éš¾ä»¥å®ç°çš„ã€‚</p><h4 id="Executors"><a href="#Executors" class="headerlink" title="Executors"></a>Executors</h4><p><img src="http://ww4.sinaimg.cn/large/006tNc79gy1g62o7n38t1j324d0u0gt9.jpg" alt="image-20190817144324388"></p><p><strong>Interfaces</strong></p><h5 id="Executor"><a href="#Executor" class="headerlink" title="Executor"></a>Executor</h5><p> <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Executor.html" target="_blank" rel="noopener"><code>Executor</code></a> is a simple standardized interface for defining custom thread-like subsystems, including thread pools, asynchronous I/O, and lightweight task frameworks. </p><p>Depending on which concrete Executor class is being used, tasks may execute in a newly created thread, an existing task-execution thread, or the thread calling <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Executor.html#execute-java.lang.Runnable-" target="_blank" rel="noopener"><code>execute</code></a>, and may execute sequentially or concurrently.</p><pre><code class="java">public interface Executor {    void execute(Runnable command);}</code></pre><h5 id="ExecutorService"><a href="#ExecutorService" class="headerlink" title="ExecutorService"></a>ExecutorService</h5><p><img src="http://ww2.sinaimg.cn/large/006tNc79gy1g62obzhq7nj31ds0sujwc.jpg" alt="image-20190817144736755"></p><p><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ExecutorService.html" target="_blank" rel="noopener"><code>ExecutorService</code></a> provides a more complete asynchronous task execution framework. An ExecutorService manages queuing and scheduling of tasks, and allows controlled shutdown. </p><pre><code class="java">public interface ExecutorService extends Executor {   void shutdown();   List&lt;Runnable&gt; shutdownNow();   boolean isShutdown();   boolean isTerminated();   boolean awaitTermination(long timeout, TimeUnit unit)        throws InterruptedException;   &lt;T&gt; Future&lt;T&gt; submit(Callable&lt;T&gt; task);   &lt;T&gt; Future&lt;T&gt; submit(Runnable task, T result);   Future&lt;?&gt; submit(Runnable task);   &lt;T&gt; List&lt;Future&lt;T&gt;&gt; invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks)        throws InterruptedException;   &lt;T&gt; List&lt;Future&lt;T&gt;&gt; invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks,                                  long timeout, TimeUnit unit)        throws InterruptedException;   &lt;T&gt; T invokeAny(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks)        throws InterruptedException, ExecutionException;   &lt;T&gt; T invokeAny(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks,long timeout, TimeUnit unit)        throws InterruptedException, ExecutionException, TimeoutException;}</code></pre><p>ä¸åŒäºsubmit</p><p>æ–¹æ³•invokeAny,invokeAllå…·æœ‰é˜»å¡æ€§ã€‚</p><ul><li>invokeAnyå–å¾—ç¬¬ä¸€ä¸ªæ–¹æ³•çš„è¿”å›å€¼,å½“ç¬¬ä¸€ä¸ªä»»åŠ¡ç»“æŸåï¼Œä¼šè°ƒç”¨interruptæ–¹æ³•ä¸­æ–­å…¶å®ƒä»»åŠ¡ã€‚</li><li>invokeAllç­‰çº¿ç¨‹ä»»åŠ¡æ‰§è¡Œå®Œæ¯•å,å–å¾—å…¨éƒ¨ä»»åŠ¡çš„ç»“æœå€¼ã€‚</li></ul><h5 id="ScheduledExecutorService"><a href="#ScheduledExecutorService" class="headerlink" title="ScheduledExecutorService"></a>ScheduledExecutorService</h5><p>The <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ScheduledExecutorService.html" target="_blank" rel="noopener"><code>ScheduledExecutorService</code></a> subinterface and associated interfaces add support for delayed and periodic task execution. </p><pre><code class="java">public interface ScheduledExecutorService extends ExecutorService {   public ScheduledFuture&lt;?&gt; schedule(Runnable command,long delay, TimeUnit unit);   public &lt;V&gt; ScheduledFuture&lt;V&gt; schedule(Callable&lt;V&gt; callable,long delay, TimeUnit unit);   public ScheduledFuture&lt;?&gt; scheduleAtFixedRate(Runnable command,                                                  long initialDelay,                                                  long period,                                                  TimeUnit unit);  public ScheduledFuture&lt;?&gt; scheduleWithFixedDelay(Runnable command,                                                     long initialDelay,                                                     long delay,                                                     TimeUnit unit);}</code></pre><h5 id="Callable"><a href="#Callable" class="headerlink" title="Callable"></a>Callable</h5><p> ExecutorServices provide methods arranging asynchronous execution of any function expressed as <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Callable.html" target="_blank" rel="noopener"><code>Callable</code></a>, the result-bearing analog of <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Runnable.html" target="_blank" rel="noopener"><code>Runnable</code></a></p><pre><code class="java">@FunctionalInterfacepublic interface Callable&lt;V&gt; {    /**     * Computes a result, or throws an exception if unable to do so.     *     * @return computed result     * @throws Exception if unable to compute a result     */    V call() throws Exception;}</code></pre><h5 id="Future"><a href="#Future" class="headerlink" title="Future"></a>Future</h5><p>A <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Future.html" target="_blank" rel="noopener"><code>Future</code></a> returns the results of a function, allows determination of whether execution has completed, and provides a means to cancel execution.</p><pre><code class="java">public interface Future&lt;V&gt; {    boolean cancel(boolean mayInterruptIfRunning);    boolean isCancelled();    boolean isDone();     V get() throws InterruptedException, ExecutionException;    V get(long timeout, TimeUnit unit)        throws InterruptedException, ExecutionException, TimeoutException;}</code></pre><h5 id="RunnableFuture"><a href="#RunnableFuture" class="headerlink" title="RunnableFuture"></a>RunnableFuture</h5><p>A <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/RunnableFuture.html" target="_blank" rel="noopener"><code>RunnableFuture</code></a> is a <code>Future</code> that possesses a <code>run</code> method that upon execution, sets its results.</p><pre><code class="java">public interface RunnableFuture&lt;V&gt; extends Runnable, Future&lt;V&gt; {    /**     * Sets this Future to the result of its computation     * unless it has been cancelled.     */    void run();}</code></pre><h5 id="ThreadFactory"><a href="#ThreadFactory" class="headerlink" title="ThreadFactory"></a>ThreadFactory</h5><pre><code class="java">public interface ThreadFactory {    /**     * Constructs a new {@code Thread}.  Implementations may also initialize     * priority, name, daemon status, {@code ThreadGroup}, etc.     *     * @param r a runnable to be executed by new thread instance     * @return constructed thread, or {@code null} if the request to     *         create a thread is rejected     */    Thread newThread(Runnable r);}</code></pre><p>æ„é€ æ–°çš„çº¿ç¨‹,åˆå§‹åŒ– ä¼˜å…ˆçº§ ã€åå­— ç­‰</p><p><strong>Implementations</strong> </p><h5 id="ThreadPoolExecutor-amp-ScheduledThreadPoolExecutor"><a href="#ThreadPoolExecutor-amp-ScheduledThreadPoolExecutor" class="headerlink" title="ThreadPoolExecutor &amp; ScheduledThreadPoolExecutor"></a>ThreadPoolExecutor &amp; ScheduledThreadPoolExecutor</h5><pre><code class="java">public class ThreadPoolExecutor extends AbstractExecutorService {     /**     * The main pool control state, ctl, is an atomic integer packing     * two conceptual fields     *   workerCount, indicating the effective number of threads     *   runState,    indicating whether running, shutting down etc     */    private final class Worker extends AbstractQueuedSynchronizer implements Runnable{...}    public static class xxx implements rejectedExecution{...}    implements Executor{..}    implements ExecutorService{..}    ...}</code></pre><p>â€‹    è¿™ä¸ªç±»å¾ˆæœ‰æ„æ€å‘€,åŒ…å«äº†è¿è¡ŒçŠ¶æ€,workeræ•°é‡çš„è®¡ç®—,  Workerçš„å®ç°,æ‹’ç»ç­–ç•¥çš„å®ç°,Executorçš„å®ç°,å¦å¤–æ³¨æ„æ„é€ å‡½æ•°,æ³¨æ„ç†è§£å„ä¸ªå‚æ•°çš„å«ä¹‰âš ï¸</p><pre><code class="java">public class ScheduledThreadPoolExecutor extends ThreadPoolExecutor        implements ScheduledExecutorService {    /*     * This class specializes ThreadPoolExecutor implementation by     *     * 1. Using a custom task type, ScheduledFutureTask for     *    tasks, even those that don&#39;t require scheduling (i.e.,     *    those submitted using ExecutorService execute, not     *    ScheduledExecutorService methods) which are treated as     *    delayed tasks with a delay of zero.     *     * 2. Using a custom queue (DelayedWorkQueue), a variant of     *    unbounded DelayQueue. The lack of capacity constraint and     *    the fact that corePoolSize and maximumPoolSize are     *    effectively identical simplifies some execution mechanics     *    (see delayedExecute) compared to ThreadPoolExecutor.     *     * 3. Supporting optional run-after-shutdown parameters, which     *    leads to overrides of shutdown methods to remove and cancel     *    tasks that should NOT be run after shutdown, as well as     *    different recheck logic when task (re)submission overlaps     *    with a shutdown.     *     * 4. Task decoration methods to allow interception and     *    instrumentation, which are needed because subclasses cannot     *    otherwise override submit methods to get this effect. These     *    don&#39;t have any impact on pool control logic though.     */     ...}</code></pre><p>â€‹    ä¸ThreadPoolExecutorä¸åŒçš„æ˜¯,ä½¿ç”¨çš„æ˜¯task,å»¶è¿Ÿé˜Ÿåˆ—,é‡å†™äº†onshutdown</p><h5 id="Executors-1"><a href="#Executors-1" class="headerlink" title="Executors"></a>Executors</h5><p>The <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Executors.html" target="_blank" rel="noopener"><code>Executors</code></a> class provides factory methods for the most common kinds and configurations of Executors, as well as a few utility methods for using them. </p><p>ç±»ä¼¼äºCollections, Executorsç±»ä¸ºæœ€å¸¸è§çš„executorç±»å‹å’Œé…ç½®æä¾›å·¥å‚æ–¹æ³•ï¼Œä»¥åŠä¸€äº›ä½¿ç”¨å®ƒä»¬çš„å®ç”¨ç¨‹åºæ–¹æ³•ã€‚</p><h5 id="FutureTask-amp-ExecutorCompletionService"><a href="#FutureTask-amp-ExecutorCompletionService" class="headerlink" title="FutureTask &amp; ExecutorCompletionService"></a>FutureTask &amp; ExecutorCompletionService</h5><p>Other utilities based on <code>Executors</code> include the concrete class <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/FutureTask.html" target="_blank" rel="noopener"><code>FutureTask</code></a> providing a common extensible implementation of Futures, and <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ExecutorCompletionService.html" target="_blank" rel="noopener"><code>ExecutorCompletionService</code></a>, that assists in coordinating the processing of groups of asynchronous tasks.</p><p>åŸºäºexecutorçš„å…¶ä»–å®ç”¨ç¨‹åºåŒ…æ‹¬æä¾›futureå…¬å…±å¯æ‰©å±•å®ç°çš„å…·ä½“ç±»FutureTaskå’ŒExecutorCompletionServiceï¼Œåè€…å¸®åŠ©åè°ƒå¼‚æ­¥ä»»åŠ¡ç»„çš„å¤„ç†ã€‚</p><h5 id="ForkJoinPool-amp-ForkJoinTask-amp-ForkJoinWorkerThread-since-1-7"><a href="#ForkJoinPool-amp-ForkJoinTask-amp-ForkJoinWorkerThread-since-1-7" class="headerlink" title="ForkJoinPool &amp; ForkJoinTask &amp; ForkJoinWorkerThread(@since 1.7)"></a>ForkJoinPool &amp; ForkJoinTask &amp; ForkJoinWorkerThread(@since 1.7)</h5><p>ForkJoinPoolçš„ä¼˜åŠ¿åœ¨äºï¼Œå¯ä»¥å……åˆ†åˆ©ç”¨å¤šcpuï¼Œå¤šæ ¸cpuçš„ä¼˜åŠ¿ï¼ŒæŠŠä¸€ä¸ªä»»åŠ¡æ‹†åˆ†æˆå¤šä¸ªâ€œå°ä»»åŠ¡â€ï¼ŒæŠŠå¤šä¸ªâ€œå°ä»»åŠ¡â€æ”¾åˆ°å¤šä¸ªå¤„ç†å™¨æ ¸å¿ƒä¸Šå¹¶è¡Œæ‰§è¡Œï¼›å½“å¤šä¸ªâ€œå°ä»»åŠ¡â€æ‰§è¡Œå®Œæˆä¹‹åï¼Œå†å°†è¿™äº›æ‰§è¡Œç»“æœåˆå¹¶èµ·æ¥å³å¯ã€‚</p><p><img src="http://ww4.sinaimg.cn/large/006tNc79gy1g5utn9m71kj317y0tutgr.jpg" alt="image-20190810194656530"></p><h4 id="Queues"><a href="#Queues" class="headerlink" title="Queues"></a>Queues</h4><p><img src="http://ww3.sinaimg.cn/large/006tNc79gy1g62ogwi8q8j32fw0gm0v5.jpg" alt="image-20190817145220963"></p><h5 id="BlockingQueue"><a href="#BlockingQueue" class="headerlink" title="BlockingQueue"></a>BlockingQueue</h5><p>A <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Queue.html" target="_blank" rel="noopener"><code>Queue</code></a> that additionally supports operations that wait for the queue to become non-empty when retrieving an element, and wait for space to become available in the queue when storing an element.</p><p><code>BlockingQueue</code> methods come in four forms, with different ways of handling operations that cannot be satisfied immediately, but may be satisfied at some point in the future: </p><p>one throws an exception, </p><p>the second returns a special value (either <code>null</code> or <code>false</code>, depending on the operation),</p><p>the third blocks the current thread indefinitely until the operation can succeed, </p><p>and the fourth blocks for only a given maximum time limit before giving up. </p><p>These methods are summarized in the following table:</p><table><thead><tr><th style="text-align:left"></th><th style="text-align:left"><em>Throws exception</em></th><th style="text-align:left"><em>Special value</em></th><th style="text-align:left"><em>Blocks</em></th><th style="text-align:left"><em>Times out</em></th></tr></thead><tbody><tr><td style="text-align:left"><strong>Insert</strong></td><td style="text-align:left"><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/BlockingQueue.html#add-E-" target="_blank" rel="noopener"><code>add(e)</code></a></td><td style="text-align:left"><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/BlockingQueue.html#offer-E-" target="_blank" rel="noopener"><code>offer(e)</code></a></td><td style="text-align:left"><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/BlockingQueue.html#put-E-" target="_blank" rel="noopener"><code>put(e)</code></a></td><td style="text-align:left"><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/BlockingQueue.html#offer-E-long-java.util.concurrent.TimeUnit-" target="_blank" rel="noopener"><code>offer(e, time, unit)</code></a></td></tr><tr><td style="text-align:left"><strong>Remove</strong></td><td style="text-align:left"><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/BlockingQueue.html#remove-java.lang.Object-" target="_blank" rel="noopener"><code>remove()</code></a></td><td style="text-align:left"><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/BlockingQueue.html#poll-long-java.util.concurrent.TimeUnit-" target="_blank" rel="noopener"><code>poll()</code></a></td><td style="text-align:left"><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/BlockingQueue.html#take--" target="_blank" rel="noopener"><code>take()</code></a></td><td style="text-align:left"><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/BlockingQueue.html#poll-long-java.util.concurrent.TimeUnit-" target="_blank" rel="noopener"><code>poll(time, unit)</code></a></td></tr><tr><td style="text-align:left"><strong>Examine</strong></td><td style="text-align:left"><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Queue.html#element--" target="_blank" rel="noopener"><code>element()</code></a></td><td style="text-align:left"><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Queue.html#peek--" target="_blank" rel="noopener"><code>peek()</code></a></td><td style="text-align:left"><em>not applicable</em></td><td style="text-align:left"><em>not applicable</em></td></tr></tbody></table><pre><code class="java">public interface BlockingQueue&lt;E&gt; extends Queue&lt;E&gt; {    /*     * imple Queue     */    boolean add(E e);    boolean offer(E e);    /*     * imple Collection     */    boolean remove(Object o);    public boolean contains(Object o);    /*     * BlockingQueue methods  put take      */    void put(E e) throws InterruptedException;    boolean offer(E e, long timeout, TimeUnit unit)        throws InterruptedException;    /*     * Retrieves and removes the head of this queue     */    E take() throws InterruptedException;    E poll(long timeout, TimeUnit unit)        throws InterruptedException;}</code></pre><p>â€‹    å®ç°äº†Queueæ¥å£ , è€ŒQueueæ¥å£åˆå®ç°äº†Collection,  è€ŒBlockingQueue æ–°å¢çš„æœ‰é˜»å¡å¼çš„ putå’Œtake ,</p><p>æä¾›é˜»å¡è¶…æ—¶æœºåˆ¶çš„, offerã€poll(æ‰©å±•äº†Queueçš„æ–¹æ³•)</p><h5 id="BlockingDeque-since-1-6-amp-TransferQueue-since-1-7"><a href="#BlockingDeque-since-1-6-amp-TransferQueue-since-1-7" class="headerlink" title="BlockingDeque(@since 1.6) &amp; TransferQueue(@since 1.7)"></a>BlockingDeque(@since 1.6) &amp; TransferQueue(@since 1.7)</h5><p>BlockingDequeä¸BlockingQueueç±»ä¼¼</p><p>LinkedBlockingDeque</p><p>The <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/BlockingDeque.html" target="_blank" rel="noopener"><code>BlockingDeque</code></a> interface extends <code>BlockingQueue</code> to support both FIFO and LIFO (stack-based) operations.</p><pre><code class="java">public interface BlockingDeque&lt;E&gt; extends BlockingQueue&lt;E&gt;, Deque&lt;E&gt; {    ...    void putFirst(E e) throws InterruptedException;    void putLast(E e) throws InterruptedException;    E takeFirst() throws InterruptedException;    E takeLast() throws InterruptedException;    ...}</code></pre><p>TransferQueue </p><p> <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/LinkedTransferQueue.html" target="_blank" rel="noopener"><code>LinkedTransferQueue</code></a> introduce a synchronous <code>transfer</code> method (along with related features) in which a producer may optionally block awaiting its consumer</p><blockquote><p>TransferQueueæ˜¯ä¸€ä¸ªèªæ˜çš„é˜Ÿåˆ—ï¼Œå®ƒæ˜¯ConcurrentLinkedQueue, SynchronousQueue (åœ¨å…¬å¹³æ¨¡å¼ä¸‹), æ— ç•Œçš„LinkedBlockingQueuesç­‰çš„è¶…é›†ã€‚</p></blockquote><p>ğŸŒŸè¿™æ˜¯ä¸ªå¾ˆå‰å®³çš„é˜Ÿåˆ—~ åªæœ‰åœ¨æ¶ˆè´¹è€…ç­‰å¾…çš„æƒ…å†µä¸‹æ‰ä¼šç”Ÿäº§,  è§£å†³æ¶ˆè´¹è€…å’Œç”Ÿäº§è€…é€Ÿåº¦ä¸åŒ¹é…çš„é—®é¢˜, ä¾‹å¦‚ out of memory .</p><p>@see <a href="https://segmentfault.com/a/1190000011266361" target="_blank" rel="noopener">https://segmentfault.com/a/1190000011266361</a></p><p><strong>Implementations.</strong> </p><p>Five implementations in <code>java.util.concurrent</code> support the extended <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/BlockingQueue.html" target="_blank" rel="noopener"><code>BlockingQueue</code></a> interface, that defines blocking versions of put and take: <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/LinkedBlockingQueue.html" target="_blank" rel="noopener"><code>LinkedBlockingQueue</code></a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ArrayBlockingQueue.html" target="_blank" rel="noopener"><code>ArrayBlockingQueue</code></a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/SynchronousQueue.html" target="_blank" rel="noopener"><code>SynchronousQueue</code></a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/PriorityBlockingQueue.html" target="_blank" rel="noopener"><code>PriorityBlockingQueue</code></a>, and <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/DelayQueue.html" target="_blank" rel="noopener"><code>DelayQueue</code></a>. The different classes cover the most common usage contexts for producer-consumer, messaging, parallel tasking, and related concurrent designs.</p><h5 id="LinkedBlockingQueue"><a href="#LinkedBlockingQueue" class="headerlink" title="LinkedBlockingQueue"></a>LinkedBlockingQueue</h5><p>æœ‰é™é˜»å¡é˜Ÿåˆ—,åº•å±‚å­˜å‚¨é“¾è¡¨ç»“æ„, å¯ä»¥ä¸æŒ‡å®šå¤§å°, é»˜è®¤Integer.MAX_VALUE</p><h5 id="ArrayBlockingQueue"><a href="#ArrayBlockingQueue" class="headerlink" title="ArrayBlockingQueue"></a>ArrayBlockingQueue</h5><p>æœ‰é™é˜»å¡é˜Ÿåˆ—,åº•å±‚å­˜å‚¨æ˜¯æ•°ç»„,éœ€è¦æŒ‡å®šå¤§å°åˆå§‹åŒ– , å¦ä¸€ä¸ªæ˜¯å¯ä»¥æŒ‡å®šReentrantLockå…¬å¹³é”æˆ–è€…éå…¬å¹³é”</p><h5 id="SynchronousQueue"><a href="#SynchronousQueue" class="headerlink" title="SynchronousQueue"></a>SynchronousQueue</h5><p>æ˜¯ä¸€ä¸ªç©ºé˜Ÿåˆ—,ç”¨äºä¼ é€’æ•°æ®</p><p>SynchronousQueueä½¿ç”¨ä¸¤ä¸ªé˜Ÿåˆ—ï¼ˆä¸€ä¸ªç”¨äºæ­£åœ¨ç­‰å¾…çš„ç”Ÿäº§è€…ã€å¦ä¸€ä¸ªç”¨äºæ­£åœ¨ç­‰å¾…çš„æ¶ˆè´¹è€…ï¼‰å’Œä¸€ä¸ªç”¨æ¥ä¿æŠ¤ä¸¤ä¸ªé˜Ÿåˆ—çš„é”ã€‚è€ŒLinkedTransferQueueä½¿ç”¨CASæ“ä½œå®ç°ä¸€ä¸ªéé˜»å¡çš„æ–¹æ³•ï¼Œè¿™æ˜¯é¿å…åºåˆ—åŒ–å¤„ç†ä»»åŠ¡çš„å…³é”®ã€‚</p><p>@see <a href="https://segmentfault.com/a/1190000011207824" target="_blank" rel="noopener">https://segmentfault.com/a/1190000011207824</a></p><h5 id="PriorityBlockingQueue"><a href="#PriorityBlockingQueue" class="headerlink" title="PriorityBlockingQueue"></a>PriorityBlockingQueue</h5><p>ä¼˜å…ˆçº§é˜Ÿåˆ—, å®ç°ä¸Šä½¿ç”¨äº†æ•°ç»„, é»˜è®¤åˆå§‹åŒ–å¤§å°æ˜¯ DEFAULT_INITIAL_CAPACITY = 11</p><p>ä½¿ç”¨PriorityQueue,ç”¨äºSerializable</p><h5 id="DelayQueue"><a href="#DelayQueue" class="headerlink" title="DelayQueue."></a>DelayQueue.</h5><p>å»¶è¿Ÿé˜Ÿåˆ—,å®ç°ä¸Šä½¿ç”¨äº†PriorityQueue,é»˜è®¤åˆå§‹åŒ–å¤§å°æ˜¯ DEFAULT_INITIAL_CAPACITY = 11(æ²¡æœ‰å®ç°java.io.Serializable)</p><h4 id="Timing"><a href="#Timing" class="headerlink" title="Timing"></a>Timing</h4><p>â€‹    The <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/TimeUnit.html" target="_blank" rel="noopener"><code>TimeUnit</code></a> class provides multiple granularities (including nanoseconds) for specifying and controlling time-out based operations. Most classes in the package contain operations based on time-outs in addition to indefinite waits. In all cases that time-outs are used, the time-out specifies the minimum time that the method should wait before indicating that it timed-out. Implementations make a â€œbest effortâ€ to detect time-outs as soon as possible after they occur. However, an indefinite amount of time may elapse between a time-out being detected and a thread actually executing again after that time-out. All methods that accept timeout parameters treat values less than or equal to zero to mean not to wait at all. To wait â€œforeverâ€, you can use a value of <code>Long.MAX_VALUE</code>.</p><p>TimeUnitç±»æä¾›äº†å¤šä¸ªç²’åº¦(åŒ…æ‹¬çº³ç§’)ï¼Œç”¨äºæŒ‡å®šå’Œæ§åˆ¶åŸºäºè¶…æ—¶çš„æ“ä½œã€‚</p><p>åŒ…ä¸­çš„å¤§å¤šæ•°ç±»é™¤äº†ä¸ç¡®å®šçš„ç­‰å¾…ä¹‹å¤–ï¼Œè¿˜åŒ…å«åŸºäºè¶…æ—¶çš„æ“ä½œã€‚åœ¨æ‰€æœ‰ä½¿ç”¨è¶…æ—¶çš„æƒ…å†µä¸‹ï¼Œè¶…æ—¶æŒ‡å®šæ–¹æ³•åœ¨æŒ‡ç¤ºè¶…æ—¶ä¹‹å‰åº”è¯¥ç­‰å¾…çš„æœ€å°æ—¶é—´ã€‚å®ç°ä¼šåœ¨è¶…æ—¶å‘ç”Ÿåâ€œå°½æœ€å¤§åŠªåŠ›â€å°½å¿«æ£€æµ‹è¶…æ—¶ã€‚ç„¶è€Œï¼Œåœ¨æ£€æµ‹åˆ°è¶…æ—¶ä¸å®é™…åœ¨è¶…æ—¶ä¹‹åå†æ¬¡æ‰§è¡Œçš„çº¿ç¨‹ä¹‹é—´å¯èƒ½ä¼šç»è¿‡ä¸€æ®µä¸ç¡®å®šçš„æ—¶é—´ã€‚</p><p>æ‰€æœ‰æ¥å—è¶…æ—¶å‚æ•°çš„æ–¹æ³•éƒ½å°†å°äºæˆ–ç­‰äºé›¶çš„å€¼è§†ä¸ºæ ¹æœ¬ä¸ç­‰å¾…ã€‚è¦ç­‰å¾…â€œæ°¸è¿œâ€ï¼Œå¯ä»¥ä½¿ç”¨Long.MAX_VALUEå€¼ã€‚</p><pre><code class="java">public enum TimeUnit {    /**     * Time unit representing one thousandth of a microsecond     */    NANOSECONDS {        public long toNanos(long d)   { return d; }        public long toMicros(long d)  { return d/(C1/C0); }        public long toMillis(long d)  { return d/(C2/C0); }        public long toSeconds(long d) { return d/(C3/C0); }        public long toMinutes(long d) { return d/(C4/C0); }        public long toHours(long d)   { return d/(C5/C0); }        public long toDays(long d)    { return d/(C6/C0); }        public long convert(long d, TimeUnit u) { return u.toNanos(d); }        int excessNanos(long d, long m) { return (int)(d - (m*C2)); }    },           MICROSECONDS {    ...    },    ...            public long convert(long sourceDuration, TimeUnit sourceUnit) {        throw new AbstractMethodError();    }    abstract int excessNanos(long d, long m);        public void timedWait(Object obj, long timeout)            throws InterruptedException {        if (timeout &gt; 0) {            long ms = toMillis(timeout);            int ns = excessNanos(timeout, ms);            obj.wait(ms, ns);        }    }    public void timedJoin(Thread thread, long timeout)            throws InterruptedException {        if (timeout &gt; 0) {            long ms = toMillis(timeout);            int ns = excessNanos(timeout, ms);            thread.join(ms, ns);        }    }    public void sleep(long timeout) throws InterruptedException {        if (timeout &gt; 0) {            long ms = toMillis(timeout);            int ns = excessNanos(timeout, ms);            Thread.sleep(ms, ns);        }    }}</code></pre><h4 id="Synchronizers"><a href="#Synchronizers" class="headerlink" title="Synchronizers"></a>Synchronizers</h4><p><img src="http://ww1.sinaimg.cn/large/006tNc79gy1g62op94yg7j31pe0nqdiy.jpg" alt="image-20190817150022024"></p><p>Five classes aid common special-purpose synchronization idioms.</p><ul><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Semaphore.html" target="_blank" rel="noopener"><code>Semaphore</code></a> is a classic concurrency tool.</li><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CountDownLatch.html" target="_blank" rel="noopener"><code>CountDownLatch</code></a> is a very simple yet very common utility for blocking until a given number of signals, events, or conditions hold.</li><li>A <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CyclicBarrier.html" target="_blank" rel="noopener"><code>CyclicBarrier</code></a> is a resettable multiway synchronization point useful in some styles of parallel programming.</li><li>A <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Phaser.html" target="_blank" rel="noopener"><code>Phaser</code></a> provides a more flexible form of barrier that may be used to control phased computation among multiple threads.</li><li>An <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Exchanger.html" target="_blank" rel="noopener"><code>Exchanger</code></a> allows two threads to exchange objects at a rendezvous point, and is useful in several pipeline designs.</li></ul><h5 id="Semaphore"><a href="#Semaphore" class="headerlink" title="Semaphore"></a>Semaphore</h5><p>A counting semaphore. Conceptually, a semaphore maintains a set of permits. Each acquire() blocks if necessary until a permit is available, and then takes it. Each release() adds a permit, potentially releasing a blocking acquirer. However, no actual permit objects are used; the Semaphore just keeps a count of the number available and acts accordingly.<br>Semaphores are often used to restrict the number of threads than can access some (physical or logical) resource.</p><p>è®¡æ•°ä¿¡å·é‡ã€‚ä»æ¦‚å¿µä¸Šè®²ï¼Œä¿¡å·é‡ç»´æŠ¤ä¸€ç»„è®¸å¯è¯ã€‚</p><p>å¦‚æœæœ‰å¿…è¦ï¼Œæ¯ä¸ªacquire()å—éƒ½ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°è·å¾—è®¸å¯è¯ä¸ºæ­¢ï¼Œç„¶åè·å–è®¸å¯è¯ã€‚</p><p>æ¯ä¸ªrelease()éƒ½ä¼šæ·»åŠ ä¸€ä¸ªè®¸å¯è¯ï¼Œæ½œåœ¨åœ°é‡Šæ”¾ä¸€ä¸ªé˜»å¡çš„æ”¶è´­è€…ã€‚</p><p>ä½†æ˜¯ï¼Œæ²¡æœ‰ä½¿ç”¨å®é™…çš„è®¸å¯è¯å¯¹è±¡;ä¿¡å·é‡åªä¿ç•™å¯ç”¨æ•°é‡çš„è®¡æ•°ï¼Œå¹¶ç›¸åº”åœ°æ‰§è¡Œæ“ä½œã€‚</p><p>ä¿¡å·é‡é€šå¸¸ç”¨äºé™åˆ¶èƒ½å¤Ÿè®¿é—®æŸäº›(ç‰©ç†æˆ–é€»è¾‘)èµ„æºçš„çº¿ç¨‹æ•°ã€‚</p><pre><code class="java">public class Semaphore implements java.io.Serializable {  private final Sync sync;    /**     * Synchronization implementation for semaphore.  Uses AQS state     * to represent permits. Subclassed into fair and nonfair     * versions.     */  abstract static class Sync extends AbstractQueuedSynchronizer {     ...     final int nonfairTryAcquireShared(int acquires) {         for (;;) {              int available = getState();              int remaining = available - acquires;              if (remaining &lt; 0 ||compareAndSetState(available, remaining))                    return remaining;         }      }  }      static final class NonfairSync extends Sync {       ...           protected int tryAcquireShared(int acquires) {           return nonfairTryAcquireShared(acquires);       }  }  static final class FairSync extends Sync {      ...      protected int tryAcquireShared(int acquires) {            for (;;) {                if (hasQueuedPredecessors())                    return -1;                int available = getState();                int remaining = available - acquires;                if (remaining &lt; 0 ||compareAndSetState(available, remaining))                    return remaining;            }        }  }  public Semaphore(int permits) {       sync = new NonfairSync(permits);  }  public Semaphore(int permits, boolean fair) {       sync = fair ? new FairSync(permits) : new NonfairSync(permits);  }  public void acquire(int permits) throws InterruptedException {        if (permits &lt; 0) throw new IllegalArgumentException();        sync.acquireSharedInterruptibly(permits);  }  public void release(int permits) {        if (permits &lt; 0) throw new IllegalArgumentException();        sync.releaseShared(permits);  }  ...}</code></pre><p>åŸºäºAbstractQueuedSynchronizer å®ç°,ä¸»è¦æœ‰acquire å’Œ releaseæ–¹æ³•</p><h5 id="CountDownLatch"><a href="#CountDownLatch" class="headerlink" title="CountDownLatch"></a>CountDownLatch</h5><p>A synchronization aid that allows one or more threads to wait until a set of operations being performed in other threads completes.</p><p>ä¸€ç§åŒæ­¥è¾…åŠ©ï¼Œå…è®¸ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ç­‰å¾…ï¼Œç›´åˆ°åœ¨å…¶ä»–çº¿ç¨‹ä¸­æ‰§è¡Œçš„ä¸€ç»„æ“ä½œå®Œæˆã€‚</p><pre><code class="java">public class CountDownLatch {    /**     * Synchronization control For CountDownLatch.     * Uses AQS state to represent count.     */    private static final class Sync extends AbstractQueuedSynchronizer {        private static final long serialVersionUID = 4982264981922014374L;        Sync(int count) {            setState(count);        }        int getCount() {            return getState();        }        protected int tryAcquireShared(int acquires) {            return (getState() == 0) ? 1 : -1;        }        protected boolean tryReleaseShared(int releases) {            // Decrement count; signal when transition to zero            for (;;) {                int c = getState();                if (c == 0)                    return false;                int nextc = c-1;                if (compareAndSetState(c, nextc))                    return nextc == 0;            }        }    }    private final Sync sync;    public CountDownLatch(int count) {        if (count &lt; 0) throw new IllegalArgumentException(&quot;count &lt; 0&quot;);        this.sync = new Sync(count);    }    public void await() throws InterruptedException {        sync.acquireSharedInterruptibly(1);    }    public boolean await(long timeout, TimeUnit unit)        throws InterruptedException {        return sync.tryAcquireSharedNanos(1, unit.toNanos(timeout));    }    public void countDown() {        sync.releaseShared(1);    }    public long getCount() {        return sync.getCount();    }}</code></pre><h5 id="CyclicBarrier"><a href="#CyclicBarrier" class="headerlink" title="CyclicBarrier"></a>CyclicBarrier</h5><p>ä¸ CountDownLatch ç±»ä¼¼, æœ€å¤§çš„ä¸åŒç‚¹åœ¨äºè°ƒç”¨æ—¶ç‚¹æ˜¯å¦é˜»å¡ ,æ³¨æ„å®ç°ä¹Ÿæ˜¯ä¸åŒçš„</p><p>ä»ä½¿ç”¨åœºæ™¯ä¸Šæ¥è¯´ï¼ŒCyclicBarrieræ˜¯è®©å¤šä¸ªçº¿ç¨‹äº’ç›¸ç­‰å¾…æŸä¸€äº‹ä»¶çš„å‘ç”Ÿï¼Œç„¶ååŒæ—¶è¢«å”¤é†’ã€‚è€Œä¸Šæ–‡è®²çš„CountDownLatchæ˜¯è®©æŸä¸€çº¿ç¨‹ç­‰å¾…å¤šä¸ªçº¿ç¨‹çš„çŠ¶æ€ï¼Œç„¶åè¯¥çº¿ç¨‹è¢«å”¤é†’ã€‚</p><table><thead><tr><th style="text-align:left">CountDownLatch</th><th>CyclicBarrier</th></tr></thead><tbody><tr><td style="text-align:left">å‡è®¡æ•°æ–¹å¼</td><td>ReentrantLock</td></tr><tr><td style="text-align:left">è®¡æ•°ä¸º0æ—¶ï¼Œæ— æ³•é‡ç½®</td><td>è®¡æ•°ç½®ä¸º0,é‡æ–°å¼€å§‹</td></tr><tr><td style="text-align:left">è°ƒç”¨countDown()æ–¹æ³•è®¡æ•°å‡ä¸€ï¼Œè°ƒç”¨await()æ–¹æ³•åªè¿›è¡Œé˜»å¡ï¼Œå¯¹è®¡æ•°æ²¡ä»»ä½•å½±å“</td><td>è°ƒç”¨await()æ–¹æ³•è®¡æ•°countå‡1ï¼Œå‡1åçš„å€¼ä¸ç­‰äºæ„é€ æ–¹æ³•çš„å€¼ï¼Œåˆ™çº¿ç¨‹é˜»å¡,å¦åˆ™æ‰§è¡ŒbarrierCommand</td></tr></tbody></table><pre><code class="java">public class CyclicBarrier {    public CyclicBarrier(int parties, Runnable barrierAction) {        if (parties &lt;= 0) throw new IllegalArgumentException();        this.parties = parties;        this.count = parties;        this.barrierCommand = barrierAction;    }    public CyclicBarrier(int parties) {        this(parties, null);    }    public int await() throws InterruptedException, BrokenBarrierException {        try {            return dowait(false, 0L);        } catch (TimeoutException toe) {            throw new Error(toe); // cannot happen        }    }    public boolean isBroken() {        final ReentrantLock lock = this.lock;        lock.lock();        try {            return generation.broken;        } finally {            lock.unlock();        }    }    public void reset() {        final ReentrantLock lock = this.lock;        lock.lock();        try {            breakBarrier();   // break the current generation            nextGeneration(); // start a new generation        } finally {            lock.unlock();        }    }    public int getNumberWaiting() {        final ReentrantLock lock = this.lock;        lock.lock();        try {            return parties - count;        } finally {            lock.unlock();        }    }        ...}</code></pre><p>â€‹    </p><h5 id="Phaser-since-1-7"><a href="#Phaser-since-1-7" class="headerlink" title="Phaser(@since 1.7)"></a>Phaser(@since 1.7)</h5><p>A reusable synchronization barrier, similar in functionality to <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CyclicBarrier.html" target="_blank" rel="noopener"><code>CyclicBarrier</code></a> and <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CountDownLatch.html" target="_blank" rel="noopener"><code>CountDownLatch</code></a> but supporting more flexible usage.</p><p><strong>Registration</strong> </p><p><strong>Synchronization</strong></p><p><strong>Termination</strong> </p><p><strong>Tiering</strong> (åˆ†å±‚)</p><p><strong>Monitoring</strong></p><p>CountDownLatchå’ŒCyclicBarrieréƒ½æ˜¯JDK 1.5å¼•å…¥çš„ï¼Œè€ŒPhaseræ˜¯JDK 1.7å¼•å…¥çš„ã€‚Phaserçš„åŠŸèƒ½ä¸CountDownLatchå’ŒCyclicBarrieræœ‰éƒ¨åˆ†é‡å ï¼ŒåŒæ—¶ä¹Ÿæä¾›äº†æ›´ä¸°å¯Œçš„è¯­ä¹‰å’Œæ›´çµæ´»çš„ç”¨æ³•ã€‚</p><p>Phaseré¡¾åæ€ä¹‰ï¼Œä¸é˜¶æ®µç›¸å…³ã€‚Phaseræ¯”è¾ƒé€‚åˆè¿™æ ·ä¸€ç§åœºæ™¯ï¼Œä¸€ç§ä»»åŠ¡å¯ä»¥åˆ†ä¸ºå¤šä¸ªé˜¶æ®µï¼Œç°å¸Œæœ›å¤šä¸ªçº¿ç¨‹å»å¤„ç†è¯¥æ‰¹ä»»åŠ¡ï¼Œå¯¹äºæ¯ä¸ªé˜¶æ®µï¼Œå¤šä¸ªçº¿ç¨‹å¯ä»¥å¹¶å‘è¿›è¡Œï¼Œä½†æ˜¯å¸Œæœ›ä¿è¯åªæœ‰å‰é¢ä¸€ä¸ªé˜¶æ®µçš„ä»»åŠ¡å®Œæˆä¹‹åæ‰èƒ½å¼€å§‹åé¢çš„ä»»åŠ¡ã€‚</p><p>è¿™ç§åœºæ™¯å¯ä»¥ä½¿ç”¨å¤šä¸ªCyclicBarrieræ¥å®ç°ï¼Œæ¯ä¸ªCyclicBarrierè´Ÿè´£ç­‰å¾…ä¸€ä¸ªé˜¶æ®µçš„ä»»åŠ¡å…¨éƒ¨å®Œæˆã€‚ä½†æ˜¯ä½¿ç”¨CyclicBarrierçš„ç¼ºç‚¹åœ¨äºï¼Œéœ€è¦æ˜ç¡®çŸ¥é“æ€»å…±æœ‰å¤šå°‘ä¸ªé˜¶æ®µï¼ŒåŒæ—¶å¹¶è¡Œçš„ä»»åŠ¡æ•°éœ€è¦æå‰é¢„å®šä¹‰å¥½ï¼Œä¸”æ— æ³•åŠ¨æ€ä¿®æ”¹ã€‚è€ŒPhaserå¯åŒæ—¶è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜ã€‚</p><blockquote><p>@see <a href="http://www.jasongj.com/java/thread_communication/" target="_blank" rel="noopener">http://www.jasongj.com/java/thread_communication/</a></p></blockquote><h5 id="Exchanger"><a href="#Exchanger" class="headerlink" title="Exchanger"></a>Exchanger</h5><p>A ==synchronization== point at which threads can pair and swap elements within pairs. </p><p>Each thread presents some object on entry to the <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Exchanger.html#exchange-V-" target="_blank" rel="noopener"><code>exchange</code></a> method, matches with a partner thread, and receives its partnerâ€™s object on return. </p><p>An Exchanger may be viewed as a bidirectional form of a <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/SynchronousQueue.html" target="_blank" rel="noopener"><code>SynchronousQueue</code></a>. </p><p>Exchangers may be useful in applications such as genetic algorithms and pipeline designs.</p><p>åœ¨ä»¥ä¸Šçš„æè¿°ä¸­ï¼Œæœ‰å‡ ä¸ªè¦ç‚¹ï¼š</p><ul><li>æ­¤ç±»æä¾›å¯¹å¤–çš„æ“ä½œæ˜¯åŒæ­¥çš„ï¼›</li><li>ç”¨äºæˆå¯¹å‡ºç°çš„çº¿ç¨‹ä¹‹é—´äº¤æ¢æ•°æ®ï¼›</li><li>å¯ä»¥è§†ä½œåŒå‘çš„åŒæ­¥é˜Ÿåˆ—ï¼›</li><li>å¯åº”ç”¨äºåŸºå› ç®—æ³•ã€æµæ°´çº¿è®¾è®¡ç­‰åœºæ™¯ã€‚</li></ul><pre><code class="java">public class Exchanger&lt;V&gt; {    @sun.misc.Contended static final class Node {        int index;              // Arena index        int bound;              // Last recorded value of Exchanger.bound        int collides;           // Number of CAS failures at current bound        int hash;               // Pseudo-random for spins        Object item;            // This thread&#39;s current item        volatile Object match;  // Item provided by releasing thread        volatile Thread parked; // Set to this thread when parked, else null    }    static final class Participant extends ThreadLocal&lt;Node&gt; {        public Node initialValue() { return new Node(); }    }    public Exchanger() {        participant = new Participant();    }    public V exchange(V x) throws InterruptedException {        Object v;        Object item = (x == null) ? NULL_ITEM : x; // translate null args        if ((arena != null ||             (v = slotExchange(item, false, 0L)) == null) &amp;&amp;            ((Thread.interrupted() || // disambiguates null return              (v = arenaExchange(item, false, 0L)) == null)))            throw new InterruptedException();        return (v == NULL_ITEM) ? null : (V)v;    }    public V exchange(V x, long timeout, TimeUnit unit)        throws InterruptedException, TimeoutException {        Object v;        Object item = (x == null) ? NULL_ITEM : x;        long ns = unit.toNanos(timeout);        if ((arena != null ||             (v = slotExchange(item, true, ns)) == null) &amp;&amp;            ((Thread.interrupted() ||              (v = arenaExchange(item, true, ns)) == null)))            throw new InterruptedException();        if (v == TIMED_OUT)            throw new TimeoutException();        return (v == NULL_ITEM) ? null : (V)v;    }}</code></pre><p>æœ‰ç‚¹ç±»ä¼¼äºç”Ÿäº§è€…/æ¶ˆè´¹è€… </p><blockquote><p>@see <a href="https://blog.csdn.net/coslay/article/details/45242581" target="_blank" rel="noopener">https://blog.csdn.net/coslay/article/details/45242581</a></p></blockquote><h4 id="Concurrent-Collections"><a href="#Concurrent-Collections" class="headerlink" title="Concurrent Collections"></a>Concurrent Collections</h4><p>ç”¨äºå¹¶å‘è®¿é—®çš„é›†åˆ(Listã€Mapã€Set)</p><p>Besides Queues, this package supplies Collection implementations designed for use in multithreaded contexts: <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ConcurrentHashMap.html" target="_blank" rel="noopener"><code>ConcurrentHashMap</code></a><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ConcurrentSkipListMap.html" target="_blank" rel="noopener"><code>ConcurrentSkipListMap</code></a><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ConcurrentSkipListSet.html" target="_blank" rel="noopener"><code>ConcurrentSkipListSet</code></a><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CopyOnWriteArrayList.html" target="_blank" rel="noopener"><code>CopyOnWriteArrayList</code></a><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CopyOnWriteArraySet.html" target="_blank" rel="noopener"><code>CopyOnWriteArraySet</code></a>    </p><p>When many threads are expected to access a given collection, a <code>ConcurrentHashMap</code> is normally preferable to a synchronized <code>HashMap</code>, and a <code>ConcurrentSkipListMap</code> is normally preferable to a synchronized <code>TreeMap</code>. A <code>CopyOnWriteArrayList</code> is preferable to a synchronized <code>ArrayList</code>when the expected number of reads and traversals greatly outnumber the number of updates to a list.</p><p>ä¸synchronizedå°è£…çš„ç±»ä¸åŒ, Concurrentå¼€å¤´çš„æ”¯æŒå¹¶å‘è®¿é—®</p><p>The â€œConcurrentâ€ prefix used with some classes in this package is a shorthand indicating several differences from similar â€œsynchronizedâ€ classes. </p><p>For example <code>java.util.Hashtable</code> and <code>Collections.synchronizedMap(new HashMap())</code> are synchronized. But <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ConcurrentHashMap.html" target="_blank" rel="noopener"><code>ConcurrentHashMap</code></a> is â€œconcurrentâ€. A concurrent collection is thread-safe, but not governed by a single exclusion lock. In the particular case of ConcurrentHashMap, it safely permits any number of concurrent reads as well as a tunable number of concurrent writes. </p><p>â€œSynchronizedâ€ classes can be useful when you need to prevent all access to a collection via a single lock, at the expense of poorer scalability. In other cases in which multiple threads are expected to access a common collection, â€œconcurrentâ€ versions are normally preferable. And unsynchronized collections are preferable when either collections are unshared, or are accessible only when holding other locks.</p><p>æä¾›å¼±ä¸€è‡´çš„éå†,è€Œä¸æ˜¯å¿«é€Ÿå¤±è´¥</p><p>Most concurrent Collection implementations (including most Queues) also differ from the usual <code>java.util</code> conventions in that their <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Iterator.html" target="_blank" rel="noopener">Iterators</a> and <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Spliterator.html" target="_blank" rel="noopener">Spliterators</a> provide <em>weakly consistent</em> rather than fast-fail traversal:</p><ul><li>they may proceed concurrently with other operations</li><li>they will never throw <a href="https://docs.oracle.com/javase/8/docs/api/java/util/ConcurrentModificationException.html" target="_blank" rel="noopener"><code>ConcurrentModificationException</code></a></li><li>they are guaranteed to traverse elements as they existed upon construction exactly once, and may (but are not guaranteed to) reflect any modifications subsequent to construction.</li></ul><h5 id="ConcurrentHashMap"><a href="#ConcurrentHashMap" class="headerlink" title="ConcurrentHashMap"></a>ConcurrentHashMap</h5><h5 id="ConcurrentSkipListMap"><a href="#ConcurrentSkipListMap" class="headerlink" title="ConcurrentSkipListMap"></a>ConcurrentSkipListMap</h5><h5 id="ConcurrentSkipListSet"><a href="#ConcurrentSkipListSet" class="headerlink" title="ConcurrentSkipListSet"></a>ConcurrentSkipListSet</h5><h5 id="CopyOnWriteArrayList"><a href="#CopyOnWriteArrayList" class="headerlink" title="CopyOnWriteArrayList"></a>CopyOnWriteArrayList</h5><h5 id="CopyOnWriteArraySet"><a href="#CopyOnWriteArraySet" class="headerlink" title="CopyOnWriteArraySet"></a>CopyOnWriteArraySet</h5><h4 id="Memory-Consistency-Properties-å†…å­˜ä¸€è‡´æ€§"><a href="#Memory-Consistency-Properties-å†…å­˜ä¸€è‡´æ€§" class="headerlink" title="Memory Consistency Properties (å†…å­˜ä¸€è‡´æ€§)"></a>Memory Consistency Properties (å†…å­˜ä¸€è‡´æ€§)</h4><p>Javaè¯­è¨€è§„èŒƒç¬¬17ç« å®šä¹‰äº†å†…å­˜æ“ä½œä¸Šçš„<em>happens-before</em>å…³ç³»ï¼Œæ¯”å¦‚å…±äº«å˜é‡çš„è¯»å†™ã€‚åªæœ‰å½“å†™æ“ä½œå‘ç”Ÿæ—¶(åœ¨è¯»æ“ä½œä¹‹å‰)ï¼Œä¸€ä¸ªçº¿ç¨‹çš„å†™æ“ä½œçš„ç»“æœæ‰ä¿è¯å¯¹å¦ä¸€ä¸ªçº¿ç¨‹çš„è¯»æ“ä½œå¯è§ã€‚åŒæ­¥å’Œvolatileæ„é€ ï¼Œä»¥åŠThread.start()å’ŒThread.join()æ–¹æ³•ï¼Œå¯ä»¥å½¢æˆhappens-beforeå…³ç³»ã€‚</p><p><a href="https://docs.oracle.com/javase/specs/jls/se7/html/jls-17.html#jls-17.4.5" target="_blank" rel="noopener">Chapter 17 of the Java Language Specification</a> defines the <em>happens-before</em> relation on memory operations such as reads and writes of shared variables. The results of a write by one thread are guaranteed to be visible to a read by another thread only if the write operation <em>happens-before</em>  the read operation. The synchronized  and volatile constructs, as well as the Thread.start() and Thread.join() methods, can form <em>happens-before</em>  relationships. In particular:</p><ul><li>Each action in a thread <em>happens-before</em> every action in that thread that comes later in the programâ€™s order.</li><li>An unlock (<code>synchronized</code> block or method exit) of a monitor <em>happens-before</em> every subsequent lock (<code>synchronized</code> block or method entry) of that same monitor. And because the <em>happens-before</em> relation is transitive, all actions of a thread prior to unlocking <em>happen-before</em> all actions subsequent to any thread locking that monitor.</li><li>A write to a <code>volatile</code> field <em>happens-before</em> every subsequent read of that same field. Writes and reads of <code>volatile</code> fields have similar memory consistency effects as entering and exiting monitors, but do <em>not</em> entail mutual exclusion locking.</li><li>A call to <code>start</code> on a thread <em>happens-before</em> any action in the started thread.</li><li>All actions in a thread <em>happen-before</em> any other thread successfully returns from a <code>join</code> on that thread.</li></ul><p>åœ¨jucä¸­,æ‰€æœ‰classesçš„ <em>happens-before</em> å…³ç³»</p><p>The methods of all classes in <code>java.util.concurrent</code></p><ul><li>Actions in a thread prior to placing an object into any concurrent collection <em>happen-before</em> actions subsequent to the access or removal of that element from the collection in another thread.</li><li>Actions in a thread prior to the submission of a <code>Runnable</code> to an <code>Executor</code> <em>happen-before</em> its execution begins. Similarly for <code>Callables</code> submitted to an <code>ExecutorService</code>.</li><li>Actions taken by the asynchronous computation represented by a <code>Future</code> <em>happen-before</em> actions subsequent to the retrieval of the result via <code>Future.get()</code> in another thread.</li><li>Actions prior to â€œreleasingâ€ synchronizer methods such as <code>Lock.unlock</code>, <code>Semaphore.release</code>, and <code>CountDownLatch.countDown</code> <em>happen-before</em> actions subsequent to a successful â€œacquiringâ€ method such as <code>Lock.lock</code>, <code>Semaphore.acquire</code>,<code>Condition.await</code>, and <code>CountDownLatch.await</code> on the same synchronizer object in another thread.</li><li>For each pair of threads that successfully exchange objects via an <code>Exchanger</code>, actions prior to the <code>exchange()</code> in each thread <em>happen-before</em> those subsequent to the corresponding <code>exchange()</code> in another thread.</li><li>Actions prior to calling <code>CyclicBarrier.await</code> and <code>Phaser.awaitAdvance</code> (as well as its variants) <em>happen-before</em> actions performed by the barrier action, and actions performed by the barrier action <em>happen-before</em> actions subsequent to a successful return from the corresponding <code>await</code> in other threads.</li></ul><h3 id="java-util-concurrent-atomic"><a href="#java-util-concurrent-atomic" class="headerlink" title="java.util.concurrent.atomic"></a>java.util.concurrent.atomic</h3><p>â€‹    </p><p>ä¸€ä¸ªæ”¯æŒå•å˜é‡æ— é”çº¿ç¨‹å®‰å…¨ç¼–ç¨‹çš„ç±»çš„å°å·¥å…·åŒ…ã€‚æœ¬è´¨ä¸Šï¼Œè¿™ä¸ªåŒ…ä¸­çš„ç±»å°†volatileå€¼ã€å­—æ®µå’Œæ•°ç»„å…ƒç´ çš„æ¦‚å¿µæ‰©å±•åˆ°é‚£äº›è¿˜æä¾› <em>compareAndSet</em> çš„åŸå­æ¡ä»¶æ›´æ–°æ“ä½œçš„ç±»</p><p>A small toolkit of classes that support lock-free thread-safe programming on single variables.</p><p>In essence, the classes in this package extend the notion of <code>volatile</code>  values, fields, and array elements to those that also provide an atomic conditional update operation of the form:</p><pre><code> boolean compareAndSet(expectedValue, updateValue);</code></pre><p>This method (which varies in argument types across different classes) atomically sets a variable to the <code>updateValue</code> if it currently holds the <code>expectedValue</code>, reporting <code>true</code> on success. </p><p>The classes in this package also contain methods to get and unconditionally set values, as well as a weaker conditional atomic update operation <code>weakCompareAndSet</code> described below.</p><p>The memory effects for accesses and updates of atomics generally follow the rules for volatiles, as stated in <a href="https://docs.oracle.com/javase/specs/jls/se7/html/jls-17.html#jls-17.4" target="_blank" rel="noopener">The Java Language Specification (17.4 Memory Model)</a>:</p><ul><li><code>get</code> has the memory effects of reading a <code>volatile</code> variable.</li><li><code>set</code> has the memory effects of writing (assigning) a <code>volatile</code> variable.</li><li><code>lazySet</code> has the memory effects of writing (assigning) a <code>volatile</code> variable except that it permits reorderings with subsequent (but not previous) memory actions that do not themselves impose reordering constraints with ordinary non-<code>volatile</code> writes. Among other usage contexts, <code>lazySet</code> may apply when nulling out, for the sake of garbage collection, a reference that is never accessed again.</li><li><code>weakCompareAndSet</code> atomically reads and conditionally writes a variable but does <em>not</em> create any happens-before orderings, so provides no guarantees with respect to previous or subsequent reads and writes of any variables other than the target of the <code>weakCompareAndSet</code>.</li><li><code>compareAndSet</code> and all other read-and-update operations such as <code>getAndIncrement</code> have the memory effects of both reading and writing <code>volatile</code> variables.</li></ul><h4 id="Atomic-Values"><a href="#Atomic-Values" class="headerlink" title="Atomic Values"></a>Atomic Values</h4><p>Instances of classes <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/atomic/AtomicBoolean.html" target="_blank" rel="noopener"><code>AtomicBoolean</code></a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/atomic/AtomicInteger.html" target="_blank" rel="noopener"><code>AtomicInteger</code></a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/atomic/AtomicLong.html" target="_blank" rel="noopener"><code>AtomicLong</code></a>, and <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/atomic/AtomicReference.html" target="_blank" rel="noopener"><code>AtomicReference</code></a> each provide access and updates to a single variable of the corresponding type. Each class also provides appropriate utility methods for that type. For example, classes <code>AtomicLong</code> and <code>AtomicInteger</code> provide atomic increment methods. </p><pre><code class="java">public class AtomicInteger extends Number implements java.io.Serializable {    private volatile int value;    /**     * Creates a new AtomicInteger with the given initial value.     *     * @param initialValue the initial value     */    public AtomicInteger(int initialValue) {        value = initialValue;    }    /**     * Creates a new AtomicInteger with initial value {@code 0}.     */    public AtomicInteger() {    }}</code></pre><h4 id="Atomic-Fields"><a href="#Atomic-Fields" class="headerlink" title="Atomic Fields"></a>Atomic Fields</h4><p>In addition to classes representing single values, this package contains <em>Updater</em> classes that can be used to obtain <code>compareAndSet</code> operations on any selected <code>volatile</code> field of any selected class. <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/atomic/AtomicReferenceFieldUpdater.html" target="_blank" rel="noopener"><code>AtomicReferenceFieldUpdater</code></a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/atomic/AtomicIntegerFieldUpdater.html" target="_blank" rel="noopener"><code>AtomicIntegerFieldUpdater</code></a>, and <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/atomic/AtomicLongFieldUpdater.html" target="_blank" rel="noopener"><code>AtomicLongFieldUpdater</code></a> are reflection-based utilities that provide access to the associated field types. These are mainly of use in atomic data structures in which several <code>volatile</code> fields of the same node (for example, the links of a tree node) are independently subject to atomic updates. These classes enable greater flexibility in how and when to use atomic updates, at the expense of more awkward reflection-based setup, less convenient usage, and weaker guarantees.</p><h4 id="Atomic-Arrays"><a href="#Atomic-Arrays" class="headerlink" title="Atomic Arrays"></a>Atomic Arrays</h4><p>The <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/atomic/AtomicIntegerArray.html" target="_blank" rel="noopener"><code>AtomicIntegerArray</code></a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/atomic/AtomicLongArray.html" target="_blank" rel="noopener"><code>AtomicLongArray</code></a>, and <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/atomic/AtomicReferenceArray.html" target="_blank" rel="noopener"><code>AtomicReferenceArray</code></a> classes further extend atomic operation support to arrays of these types. These classes are also notable in providing <code>volatile</code> access semantics for their array elements, which is not supported for ordinary arrays.</p><h4 id="Class-Summary"><a href="#Class-Summary" class="headerlink" title="Class Summary"></a>Class Summary</h4><table><thead><tr><th style="text-align:left">Class</th><th style="text-align:left">Description</th></tr></thead><tbody><tr><td style="text-align:left"><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/atomic/AtomicBoolean.html" target="_blank" rel="noopener">AtomicBoolean</a></td><td style="text-align:left">A <code>boolean</code> value that may be updated atomically.</td></tr><tr><td style="text-align:left"><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/atomic/AtomicInteger.html" target="_blank" rel="noopener">AtomicInteger</a></td><td style="text-align:left">An <code>int</code> value that may be updated atomically.</td></tr><tr><td style="text-align:left"><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/atomic/AtomicIntegerArray.html" target="_blank" rel="noopener">AtomicIntegerArray</a></td><td style="text-align:left">An <code>int</code> array in which elements may be updated atomically.</td></tr><tr><td style="text-align:left"><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/atomic/AtomicIntegerFieldUpdater.html" target="_blank" rel="noopener">AtomicIntegerFieldUpdater</a><t></t></td><td style="text-align:left">A reflection-based utility that enables atomic updates to designated <code>volatile int</code> fields of designated classes.</td></tr><tr><td style="text-align:left"><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/atomic/AtomicLong.html" target="_blank" rel="noopener">AtomicLong</a></td><td style="text-align:left">A <code>long</code> value that may be updated atomically.</td></tr><tr><td style="text-align:left"><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/atomic/AtomicLongArray.html" target="_blank" rel="noopener">AtomicLongArray</a></td><td style="text-align:left">A <code>long</code> array in which elements may be updated atomically.</td></tr><tr><td style="text-align:left"><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/atomic/AtomicLongFieldUpdater.html" target="_blank" rel="noopener">AtomicLongFieldUpdater</a><t></t></td><td style="text-align:left">A reflection-based utility that enables atomic updates to designated <code>volatile long</code> fields of designated classes.</td></tr><tr><td style="text-align:left"><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/atomic/AtomicMarkableReference.html" target="_blank" rel="noopener">AtomicMarkableReference</a><v></v></td><td style="text-align:left">An <code>AtomicMarkableReference</code> maintains an object reference along with a mark bit, that can be updated atomically.</td></tr><tr><td style="text-align:left"><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/atomic/AtomicReference.html" target="_blank" rel="noopener">AtomicReference</a><v></v></td><td style="text-align:left">An object reference that may be updated atomically.</td></tr><tr><td style="text-align:left"><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/atomic/AtomicReferenceArray.html" target="_blank" rel="noopener">AtomicReferenceArray</a><e></e></td><td style="text-align:left">An array of object references in which elements may be updated atomically.</td></tr><tr><td style="text-align:left"><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/atomic/AtomicReferenceFieldUpdater.html" target="_blank" rel="noopener">AtomicReferenceFieldUpdater</a>&lt;T,V&gt;</td><td style="text-align:left">A reflection-based utility that enables atomic updates to designated <code>volatile</code> reference fields of designated classes.</td></tr><tr><td style="text-align:left"><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/atomic/AtomicStampedReference.html" target="_blank" rel="noopener">AtomicStampedReference</a><v></v></td><td style="text-align:left">An <code>AtomicStampedReference</code> maintains an object reference along with an integer â€œstampâ€, that can be updated atomically.</td></tr><tr><td style="text-align:left"><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/atomic/DoubleAccumulator.html" target="_blank" rel="noopener">DoubleAccumulator</a></td><td style="text-align:left">One or more variables that together maintain a running <code>double</code> value updated using a supplied function.</td></tr><tr><td style="text-align:left"><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/atomic/DoubleAdder.html" target="_blank" rel="noopener">DoubleAdder</a></td><td style="text-align:left">One or more variables that together maintain an initially zero <code>double</code> sum.</td></tr><tr><td style="text-align:left"><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/atomic/LongAccumulator.html" target="_blank" rel="noopener">LongAccumulator</a></td><td style="text-align:left">One or more variables that together maintain a running <code>long</code> value updated using a supplied function.</td></tr><tr><td style="text-align:left"><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/atomic/LongAdder.html" target="_blank" rel="noopener">LongAdder</a></td><td style="text-align:left">One or more variables that together maintain an initially zero <code>long</code> sum.</td></tr></tbody></table><h4 id="Designed"><a href="#Designed" class="headerlink" title="Designed"></a>Designed</h4><p>åŸå­ç±»ä¸»è¦è®¾è®¡ä¸ºç”¨äºå®ç°éé˜»å¡æ•°æ®ç»“æ„å’Œç›¸å…³åŸºç¡€ç»“æ„ç±»çš„æ„å»ºå—ã€‚è¯¥<code>compareAndSet</code>æ–¹æ³•ä¸æ˜¯é”å®šçš„ä¸€èˆ¬æ›¿ä»£æ–¹æ³•ã€‚ä»…å½“å¯¹è±¡çš„å…³é”®æ›´æ–°ä»…é™äº<em>å•ä¸ª</em>å˜é‡æ—¶ï¼Œå®ƒæ‰é€‚ç”¨ã€‚</p><p>åŸå­ç±»ä¸æ˜¯é€šç”¨æ›¿æ¢ <code>java.lang.Integer</code>å’Œç›¸å…³ç±»ã€‚ä»–ä»¬<em>æ²¡æœ‰</em> å®šä¹‰æ–¹æ³•ï¼Œå¦‚<code>equals</code>ï¼Œ<code>hashCode</code>å’Œ <code>compareTo</code>ã€‚ï¼ˆå› ä¸ºé¢„æœŸåŸå­å˜é‡ä¼šå‘ç”Ÿå˜å¼‚ï¼Œæ‰€ä»¥å®ƒä»¬å¯¹äºæ•£åˆ—è¡¨é”®çš„é€‰æ‹©å¾ˆå·®ã€‚ï¼‰æ­¤å¤–ï¼Œåªä¸ºé‚£äº›åœ¨é¢„æœŸåº”ç”¨ç¨‹åºä¸­å¸¸ç”¨çš„ç±»å‹æä¾›ç±»ã€‚ä¾‹å¦‚ï¼Œæ²¡æœ‰ç”¨äºè¡¨ç¤ºçš„åŸå­ç±»<code>byte</code>ã€‚åœ¨æ‚¨æƒ³è¦è¿™æ ·åšçš„ä¸å¸¸è§çš„æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨a <code>AtomicInteger</code>æ¥ä¿å­˜ <code>byte</code>å€¼ï¼Œå¹¶é€‚å½“åœ°è¿›è¡ŒæŠ•å°„ã€‚æ‚¨è¿˜å¯ä»¥ä½¿ç”¨<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Float.html#floatToRawIntBits-float-" target="_blank" rel="noopener"><code>Float.floatToRawIntBits(float)</code></a>å’Œ <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Float.html#intBitsToFloat-int-" target="_blank" rel="noopener"><code>Float.intBitsToFloat(int)</code></a>è½¬æ¢ä½¿ç”¨æµ®ç‚¹æ•° ï¼Œå¹¶ä½¿ç”¨<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Double.html#doubleToRawLongBits-double-" target="_blank" rel="noopener"><code>Double.doubleToRawLongBits(double)</code></a>å’Œ <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Double.html#longBitsToDouble-long-" target="_blank" rel="noopener"><code>Double.longBitsToDouble(long)</code></a>è½¬æ¢åŠ å€ã€‚</p><p>åŸæ–‡  : </p><blockquote><p>Atomic classes are designed primarily as building blocks for implementing non-blocking data structures and related infrastructure classes. The <code>compareAndSet</code> method is not a general replacement for locking. It applies only when critical updates for an object are confined to a <em>single</em> variable.</p><p>Atomic classes are not general purpose replacements for <code>java.lang.Integer</code> and related classes. They do <em>not</em> define methods such as <code>equals</code>, <code>hashCode</code> and <code>compareTo</code>. (Because atomic variables are expected to be mutated, they are poor choices for hash table keys.) Additionally, classes are provided only for those types that are commonly useful in intended applications. For example, there is no atomic class for representing <code>byte</code>. In those infrequent cases where you would like to do so, you can use an <code>AtomicInteger</code>to hold <code>byte</code> values, and cast appropriately. You can also hold floats using <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Float.html#floatToRawIntBits-float-" target="_blank" rel="noopener"><code>Float.floatToRawIntBits(float)</code></a> and <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Float.html#intBitsToFloat-int-" target="_blank" rel="noopener"><code>Float.intBitsToFloat(int)</code></a> conversions, and doubles using <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Double.html#doubleToRawLongBits-double-" target="_blank" rel="noopener"><code>Double.doubleToRawLongBits(double)</code></a> and <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Double.html#longBitsToDouble-long-" target="_blank" rel="noopener"><code>Double.longBitsToDouble(long)</code></a>conversions.</p></blockquote><p><strong><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/atomic/package-summary.html" target="_blank" rel="noopener">https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/atomic/package-summary.html</a></strong></p><h3 id="java-util-concurrent-locks"><a href="#java-util-concurrent-locks" class="headerlink" title="java.util.concurrent.locks"></a>java.util.concurrent.locks</h3><p><img src="http://ww3.sinaimg.cn/large/006tNc79gy1g62ox5893vj32f50u0q7l.jpg" alt="image-20190817150757762"></p><p>æ³¨æ„ConditionObject (ä¸çŸ¥é“ä¸ºå•¥æ²¡æœ‰æ˜¾ç¤ºä¸ºAbstractQueuedSynchronizer inner class)</p><p>æ¥å£å’Œç±»æä¾›äº†ä¸€ä¸ªæ¡†æ¶ï¼Œç”¨äºé”å®šå’Œç­‰å¾…,ä¸å†…ç½®åŒæ­¥å’Œç›‘è§†å™¨ä¸åŒçš„æ¡ä»¶ã€‚è¯¥æ¡†æ¶å…è®¸åœ¨ä½¿ç”¨é”å’Œæ¡ä»¶æ–¹é¢å…·æœ‰æ›´å¤§çš„çµæ´»æ€§ï¼Œä½†ä»£ä»·æ˜¯è¯­æ³•æ›´åŠ ç¬¨æ‹™ã€‚</p><p>Interfaces and classes providing a framework for locking and waiting for conditions that is distinct from built-in synchronization and monitors. The framework permits much greater flexibility in the use of locks and conditions, at the expense of more awkward syntax.</p><h4 id="Locks-é”"><a href="#Locks-é”" class="headerlink" title="Locks(é”)"></a>Locks(é”)</h4><p>The <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/Lock.html" target="_blank" rel="noopener"><code>Lock</code></a> interface supports locking disciplines that differ in semantics (reentrant, fair, etc), and that can be used in non-block-structured contexts including hand-over-hand and lock reordering algorithms. The main implementation is <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/ReentrantLock.html" target="_blank" rel="noopener"><code>ReentrantLock</code></a>.</p><p>The <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/ReadWriteLock.html" target="_blank" rel="noopener"><code>ReadWriteLock</code></a> interface similarly defines locks that may be shared among readers but are exclusive to writers. Only a single implementation, <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/ReentrantReadWriteLock.html" target="_blank" rel="noopener"><code>ReentrantReadWriteLock</code></a>, is provided, since it covers most standard usage contexts. But programmers may create their own implementations to cover nonstandard requirements.</p><p>Lockæ¥å£æ”¯æŒè¯­ä¹‰ä¸åŒçš„é”å®šè§„åˆ™(å¯é‡å…¥ã€å…¬å¹³ç­‰)ï¼Œå¹¶ä¸”å¯ä»¥åœ¨éå—ç»“æ„ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨ï¼ŒåŒ…æ‹¬æ‰‹åŠ¨å’Œé”é‡æ’åºç®—æ³•ã€‚ä¸»è¦å®ç°æ˜¯ReentrantLockã€‚</p><p>ReadWriteLockæ¥å£ä¹Ÿç±»ä¼¼åœ°å®šä¹‰äº†é”ï¼Œè¿™äº›é”å¯ä»¥åœ¨readersä¹‹é—´å…±äº«ï¼Œä½†åªèƒ½ç”±writersä½¿ç”¨ã€‚åªæä¾›äº†ä¸€ä¸ªå®ç°ReentrantReadWriteLockï¼Œå› ä¸ºå®ƒæ¶µç›–äº†å¤§å¤šæ•°æ ‡å‡†ä½¿ç”¨ä¸Šä¸‹æ–‡ã€‚ä½†æ˜¯ç¨‹åºå‘˜å¯ä»¥åˆ›å»ºä»–ä»¬è‡ªå·±çš„å®ç°æ¥æ»¡è¶³éæ ‡å‡†éœ€æ±‚ã€‚</p><h5 id="Lock"><a href="#Lock" class="headerlink" title="Lock"></a>Lock</h5><h6 id="Lockä¸synchronizedçš„å¼‚åŒ"><a href="#Lockä¸synchronizedçš„å¼‚åŒ" class="headerlink" title="Lockä¸synchronizedçš„å¼‚åŒ"></a>Lockä¸synchronizedçš„å¼‚åŒ</h6><ul><li>å†…å­˜è¯­ä¹‰ç›¸åŒ</li></ul><p><em>Memory Synchronization</em></p><p>All <code>Lock</code> implementations <em>must</em> enforce the same memory synchronization semantics as provided by the built-in monitor lock, as described in <a href="https://docs.oracle.com/javase/specs/jls/se7/html/jls-17.html#jls-17.4" target="_blank" rel="noopener">The Java Language Specification (17.4 Memory Model)</a>:</p><ul><li>A successful <code>lock</code> operation has the same memory synchronization effects as a successful <em>Lock</em> action.</li><li>A successful <code>unlock</code> operation has the same memory synchronization effects as a successful <em>Unlock</em> action.</li></ul><p>Unsuccessful locking and unlocking operations, and reentrant locking/unlocking operations, do not require any memory synchronization effects.</p><ul><li><p>synchronizationæ˜¯å…³é”®å­—(å¯é‡å…¥,éå…¬å¹³é”,é”çš„æ˜¯å¯¹è±¡Object), Lockæ˜¯æ¥å£</p></li><li><p>synchronization ä½¿ç”¨ç®€å•,æ— éœ€æ‰‹åŠ¨é‡Šæ”¾é”,é¿å…é”™è¯¯</p><p>  When locking and unlocking occur in different scopes, care must be taken to ensure that all code that is executed while the lock is held is protected by try-finally or try-catch to ensure that the lock is released when necessary.</p></li><li><p>Lock æ›´åŠ çµæ´»,  æ”¯æŒéé˜»å¡è·å– ,å¯ä¸­æ–­è·å–,å’Œå¯è¶…æ—¶è·å–.</p><p>  <code>Lock</code> implementations provide additional functionality over the use of <code>synchronized</code> methods and statements by providing a non-blocking attempt to acquire a lock (<a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/Lock.html#tryLock--" target="_blank" rel="noopener"><code>tryLock()</code></a>), an attempt to acquire the lock that can be interrupted (<a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/Lock.html#lockInterruptibly--" target="_blank" rel="noopener"><code>lockInterruptibly()</code></a>, and an attempt to acquire the lock that can timeout (<a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/Lock.html#tryLock-long-java.util.concurrent.TimeUnit-" target="_blank" rel="noopener"><code>tryLock(long, TimeUnit)</code></a>).</p></li></ul><h6 id="Implementation-Considerations"><a href="#Implementation-Considerations" class="headerlink" title="Implementation Considerations"></a>Implementation Considerations</h6><p>ä¸‰ç§å½¢å¼çš„é”è·å–(å¯ä¸­æ–­ã€ä¸å¯ä¸­æ–­å’Œå®šæ—¶)åœ¨æ€§èƒ½ç‰¹å¾ã€é¡ºåºä¿è¯æˆ–å…¶ä»–å®ç°è´¨é‡æ–¹é¢å¯èƒ½æœ‰æ‰€ä¸åŒã€‚</p><p>æ­¤å¤–ï¼Œä¸­æ–­æ­£åœ¨è¿›è¡Œçš„é”è·å–çš„åŠŸèƒ½å¯èƒ½åœ¨ç»™å®šçš„é”ç±»ä¸­ä¸å¯ç”¨ã€‚å› æ­¤ï¼Œå®ç°ä¸éœ€è¦ä¸ºæ‰€æœ‰ä¸‰ç§å½¢å¼çš„é”è·å–å®šä¹‰å®Œå…¨ç›¸åŒçš„ä¿è¯æˆ–è¯­ä¹‰ï¼Œä¹Ÿä¸éœ€è¦æ”¯æŒä¸­æ–­æ­£åœ¨è¿›è¡Œçš„é”è·å–ã€‚</p><p>éœ€è¦ä¸€ä¸ªå®ç°æ¥æ¸…æ¥šåœ°è®°å½•æ¯ç§é”å®šæ–¹æ³•æä¾›çš„è¯­ä¹‰å’Œä¿è¯ã€‚å®ƒè¿˜å¿…é¡»éµå®ˆè¿™ä¸ªæ¥å£ä¸­å®šä¹‰çš„ä¸­æ–­è¯­ä¹‰ï¼Œåªè¦æ”¯æŒé”è·å–ä¸­æ–­:è¦ä¹ˆå®Œå…¨æ”¯æŒï¼Œè¦ä¹ˆåªæ”¯æŒæ–¹æ³•å…¥å£ã€‚</p><p>ç”±äºä¸­æ–­é€šå¸¸æ„å‘³ç€å–æ¶ˆï¼Œå¹¶ä¸”å¯¹ä¸­æ–­çš„æ£€æŸ¥é€šå¸¸ä¸é¢‘ç¹ï¼Œå› æ­¤å®ç°æ›´å€¾å‘äºå“åº”ä¸­æ–­è€Œä¸æ˜¯æ­£å¸¸çš„æ–¹æ³•è¿”å›ã€‚å³ä½¿å¯ä»¥æ˜¾ç¤ºåœ¨å¦ä¸€ä¸ªæ“ä½œä¹‹åå‘ç”Ÿçš„ä¸­æ–­å¯èƒ½å·²ç»è§£é™¤äº†çº¿ç¨‹é˜»å¡ï¼Œè¿™ä¹Ÿæ˜¯æ­£ç¡®çš„ã€‚å®ç°åº”è¯¥è®°å½•è¿™ç§è¡Œä¸ºã€‚</p><blockquote><p>The three forms of lock acquisition (interruptible, non-interruptible, and timed) may differ in their performance characteristics, ordering guarantees, or other implementation qualities. </p><p>Further, the ability to interrupt the <em>ongoing</em> acquisition of a lock may not be available in a given <code>Lock</code> class. Consequently, an implementation is not required to define exactly the same guarantees or semantics for all three forms of lock acquisition, nor is it required to support interruption of an ongoing lock acquisition. </p><p>An implementation is required to clearly document the semantics and guarantees provided by each of the locking methods. It must also obey the interruption semantics as defined in this interface, to the extent that interruption of lock acquisition is supported: which is either totally, or only on method entry.</p><p>As interruption generally implies cancellation, and checks for interruption are often infrequent, an implementation can favor responding to an interrupt over normal method return. This is true even if it can be shown that the interrupt occurred after another action may have unblocked the thread. An implementation should document this behavior.</p></blockquote><pre><code class="java">public interface Lock {    void lock();    void lockInterruptibly() throws InterruptedException;    boolean tryLock();    boolean tryLock(long time, TimeUnit unit) throws InterruptedException;    void unlock();    Condition newCondition();}</code></pre><h5 id="ReentrantLock"><a href="#ReentrantLock" class="headerlink" title="ReentrantLock"></a>ReentrantLock</h5><p>Lockçš„æ ‡å‡†å®ç°, ä¸€ç§å¯é‡å…¥äº’æ–¥é”ï¼Œå…·æœ‰ä¸ä½¿ç”¨åŒæ­¥æ–¹æ³•å’Œè¯­å¥è®¿é—®çš„éšå¼ç›‘è§†å™¨é”ç›¸åŒçš„åŸºæœ¬è¡Œä¸ºå’Œè¯­ä¹‰ï¼Œä½†å…·æœ‰æ‰©å±•åŠŸèƒ½ã€‚(è·å–ç­‰å¾…é˜Ÿåˆ—,å½“å‰çº¿ç¨‹æ˜¯å¦è·å¾—é”ç­‰ç›‘æ§,è§ <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/AbstractOwnableSynchronizer.html" target="_blank" rel="noopener"><code>AbstractOwnableSynchronizer</code></a>)</p><p>ReentrantLockå½’æœ€åä¸€ä¸ªæˆåŠŸé”å®šçš„çº¿ç¨‹æ‰€æœ‰ï¼Œä½†è¿˜æ²¡æœ‰è§£é”å®ƒã€‚å½“é”ä¸å±äºå…¶ä»–çº¿ç¨‹æ—¶ï¼Œè°ƒç”¨é”çš„çº¿ç¨‹å°†è¿”å›å¹¶æˆåŠŸè·å–é”ã€‚å¦‚æœå½“å‰çº¿ç¨‹å·²ç»æ‹¥æœ‰é”ï¼Œè¯¥æ–¹æ³•å°†ç«‹å³è¿”å›ã€‚å¯ä»¥ä½¿ç”¨isHeldByCurrentThread()å’ŒgetHoldCount()æ–¹æ³•æ£€æŸ¥è¿™ä¸€ç‚¹ã€‚</p><blockquote><p>A reentrant mutual exclusion Lock with the same basic behavior and semantics as the implicit monitor lock accessed using synchronized methods and statements, but with extended capabilities.</p><p>A ReentrantLock is owned by the thread last successfully locking, but not yet unlocking it. A thread invoking lock will return, successfully acquiring the lock, when the lock is not owned by another thread. The method will return immediately if the current thread already owns the lock. This can be checked using methods isHeldByCurrentThread(), and getHoldCount().</p></blockquote><pre><code class="java">public class ReentrantLock implements Lock, java.io.Serializable {    private final Sync sync;    abstract static class Sync extends AbstractQueuedSynchronizer {        }        static final class NonfairSync extends Sync{}        static final class FairSync extends Sync{}        public ReentrantLock() {        sync = new NonfairSync();    }    public ReentrantLock(boolean fair) {        sync = fair ? new FairSync() : new NonfairSync();    }    public int getHoldCount() {        return sync.getHoldCount();    }    protected Thread getOwner() {        return sync.getOwner();    }    public boolean hasWaiters(Condition condition) {        if (condition == null)            throw new NullPointerException();        if (!(condition instanceof AbstractQueuedSynchronizer.ConditionObject))            throw new IllegalArgumentException(&quot;not owner&quot;);        return sync.hasWaiters((AbstractQueuedSynchronizer.ConditionObject)condition);    }    /**     * è·å–é˜Ÿåˆ—çš„ç›‘æ§,çœç•¥äº†è·å–waittingçš„      */     protected Collection&lt;Thread&gt; getQueuedThreads() {        return sync.getQueuedThreads();    }    public final int getQueueLength() {        return sync.getQueueLength();    }    public final boolean hasQueuedThread(Thread thread) {        return sync.isQueued(thread);    }    public final int getQueueLength() {        return sync.getQueueLength();    }    protected Collection&lt;Thread&gt; getQueuedThreads() {        return sync.getQueuedThreads();    }    ...}</code></pre><h5 id="ReadWriteLock"><a href="#ReadWriteLock" class="headerlink" title="ReadWriteLock"></a>ReadWriteLock</h5><p>è¯»å†™é”ç»´æŠ¤ä¸€å¯¹å…³è”çš„é”ï¼Œä¸€ä¸ªç”¨äºåªè¯»æ“ä½œï¼Œå¦ä¸€ä¸ªç”¨äºå†™æ“ä½œã€‚è¯»é”å¯ä»¥ç”±å¤šä¸ªè¯»çº¿ç¨‹åŒæ—¶æŒæœ‰ï¼Œåªè¦æ²¡æœ‰å†™çº¿ç¨‹ã€‚å†™é”æ˜¯ç‹¬å çš„ã€‚</p><p>A <code>ReadWriteLock</code> maintains a pair of associated <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/Lock.html" target="_blank" rel="noopener"><code>locks</code></a>, one for read-only operations and one for writing. The <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/ReadWriteLock.html#readLock--" target="_blank" rel="noopener"><code>read lock</code></a> may be held simultaneously by multiple reader threads, so long as there are no writers. The <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/ReadWriteLock.html#writeLock--" target="_blank" rel="noopener"><code>write lock</code></a> is exclusive.</p><pre><code class="java">public interface ReadWriteLock {    /**     * Returns the lock used for reading.     *     * @return the lock used for reading     */    Lock readLock();    /**     * Returns the lock used for writing.     *     * @return the lock used for writing     */    Lock writeLock();}</code></pre><h5 id="ReentrantReadWriteLock"><a href="#ReentrantReadWriteLock" class="headerlink" title="ReentrantReadWriteLock"></a>ReentrantReadWriteLock</h5><p>å¯é‡å…¥è¯»å†™é”, <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/ReadWriteLock.html" target="_blank" rel="noopener"><code>ReadWriteLock</code></a> å®ç°,ç±»ä¼¼<a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/ReentrantLock.html" target="_blank" rel="noopener"><code>ReentrantLock</code></a>.</p><p>This class has the following properties:</p><ul><li><strong>Acquisition order</strong>  è¯·æ±‚é¡ºåº(å…¬å¹³ã€éå…¬å¹³)</li><li><strong>Reentrancy</strong>  å¯é‡å…¥</li><li><strong>Lock downgrading</strong> é”é™çº§<ul><li>å¯é‡å…¥æ€§è¿˜å…è®¸ä»å†™é”é™çº§ä¸ºè¯»é”ï¼Œæ–¹æ³•æ˜¯è·å–å†™é”ï¼Œç„¶åæ˜¯è¯»é”ï¼Œç„¶åé‡Šæ”¾å†™é”ã€‚</li></ul></li><li><strong>Interruption of lock acquisition</strong> å¯ä¸­æ–­é”</li><li><strong>Condition support</strong> </li><li><strong>Instrumentation</strong>  ç›‘æ§</li></ul><pre><code class="java">/* * This lock supports a maximum of 65535 recursive write locks and 65535 read locks. */public class ReentrantReadWriteLock implements ReadWriteLock, java.io.Serializable {    /** Inner class providing readlock */    private final ReentrantReadWriteLock.ReadLock readerLock;    /** Inner class providing writelock */    private final ReentrantReadWriteLock.WriteLock writerLock;    /** Performs all synchronization mechanics */    final Sync sync;    /**     * Creates a new {@code ReentrantReadWriteLock} with     * default (nonfair) ordering properties.     */    public ReentrantReadWriteLock() {        this(false);    }    /**     * Creates a new {@code ReentrantReadWriteLock} with     * the given fairness policy.     *     * @param fair {@code true} if this lock should use a fair ordering policy     */    public ReentrantReadWriteLock(boolean fair) {        sync = fair ? new FairSync() : new NonfairSync();        readerLock = new ReadLock(this);        writerLock = new WriteLock(this);    }                /*                 * ReadWriteLock impl                 */    public ReentrantReadWriteLock.WriteLock writeLock() { return writerLock; }    public ReentrantReadWriteLock.ReadLock  readLock()  { return readerLock; }    /**     * Synchronization implementation for ReentrantReadWriteLock.     * Subclassed into fair and nonfair versions.     */    abstract static class Sync extends AbstractQueuedSynchronizer {        static final int SHARED_SHIFT   = 16;        static final int SHARED_UNIT    = (1 &lt;&lt; SHARED_SHIFT);        static final int MAX_COUNT      = (1 &lt;&lt; SHARED_SHIFT) - 1;        static final int EXCLUSIVE_MASK = (1 &lt;&lt; SHARED_SHIFT) - 1;       ...    }    static final long getThreadId(Thread thread) {        return UNSAFE.getLongVolatile(thread, TID_OFFSET);    }    ...    public static class ReadLock implements Lock, java.io.Serializable {       ...    }    public static class WriteLock implements Lock, java.io.Serializable {       ...    }}</code></pre><h4 id="Conditions-ç›‘è§†å™¨"><a href="#Conditions-ç›‘è§†å™¨" class="headerlink" title="Conditions(ç›‘è§†å™¨)"></a>Conditions(ç›‘è§†å™¨)</h4><p>æ¡ä»¶å°†å¯¹è±¡ç›‘è§†æ–¹æ³•(waitã€notifyå’ŒnotifyAll) åˆ†è§£ä¸ºä¸åŒçš„å¯¹è±¡ï¼Œé€šè¿‡å°†å®ƒä»¬ä¸ä»»æ„é”å®ç°ç›¸ç»“åˆï¼Œä»è€Œå®ç°æ¯ä¸ªå¯¹è±¡å…·æœ‰å¤šä¸ªç­‰å¾…é›†çš„æ•ˆæœã€‚é”æ›¿æ¢åŒæ­¥æ–¹æ³•å’Œè¯­å¥çš„ä½¿ç”¨ï¼Œæ¡ä»¶æ›¿æ¢å¯¹è±¡ç›‘è§†å™¨æ–¹æ³•çš„ä½¿ç”¨ã€‚</p><p><code>Condition</code> factors out the <code>Object</code> monitor methods (<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html#wait--" target="_blank" rel="noopener"><code>wait</code></a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html#notify--" target="_blank" rel="noopener"><code>notify</code></a> and <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html#notifyAll--" target="_blank" rel="noopener"><code>notifyAll</code></a>) into distinct objects to give the effect of having multiple wait-sets per object, by combining them with the use of arbitrary <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/Lock.html" target="_blank" rel="noopener"><code>Lock</code></a> implementations. </p><p>Where a <code>Lock</code> replaces the use of <code>synchronized</code> methods and statements, </p><p>a <code>Condition</code> replaces the use of the Object monitor methods.</p><pre><code class="java">public interface Condition {    void await() throws InterruptedException;    /*     * Causes the current thread to wait until it is signalled.     */    void awaitUninterruptibly();    long awaitNanos(long nanosTimeout) throws InterruptedException;    boolean await(long time, TimeUnit unit) throws InterruptedException;    boolean awaitUntil(Date deadline) throws InterruptedException;    void signal();    void signalAll();}</code></pre><p>ä¸»è¦å®ç° : java.util.concurrent.locks.AbstractQueuedSynchronizer.ConditionObject</p><h4 id="AbstractQueuedSynchronizers-é˜»å¡é˜Ÿåˆ—"><a href="#AbstractQueuedSynchronizers-é˜»å¡é˜Ÿåˆ—" class="headerlink" title="AbstractQueuedSynchronizers(é˜»å¡é˜Ÿåˆ—)"></a>AbstractQueuedSynchronizers(é˜»å¡é˜Ÿåˆ—)</h4><h5 id="AbstractQueuedSynchronizer"><a href="#AbstractQueuedSynchronizer" class="headerlink" title="AbstractQueuedSynchronizer"></a>AbstractQueuedSynchronizer</h5><p>AbstractQueuedSynchronizerç±»æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„è¶…ç±»ï¼Œç”¨äºå®šä¹‰ä¾èµ–äºæ’é˜Ÿé˜»å¡çº¿ç¨‹çš„é”å’Œå…¶ä»–åŒæ­¥å™¨ã€‚</p><h6 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h6><p>To use this class as the basis of a synchronizer, redefine the following methods, as applicable, by inspecting and/or modifying the synchronization state using <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/AbstractQueuedSynchronizer.html#getState--" target="_blank" rel="noopener"><code>getState()</code></a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/AbstractQueuedSynchronizer.html#setState-int-" target="_blank" rel="noopener"><code>setState(int)</code></a> and/or <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/AbstractQueuedSynchronizer.html#compareAndSetState-int-int-" target="_blank" rel="noopener"><code>compareAndSetState(int, int)</code></a>:</p><ul><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/AbstractQueuedSynchronizer.html#tryAcquire-int-" target="_blank" rel="noopener"><code>tryAcquire(int)</code></a></li><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/AbstractQueuedSynchronizer.html#tryRelease-int-" target="_blank" rel="noopener"><code>tryRelease(int)</code></a></li><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/AbstractQueuedSynchronizer.html#tryAcquireShared-int-" target="_blank" rel="noopener"><code>tryAcquireShared(int)</code></a></li><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/AbstractQueuedSynchronizer.html#tryReleaseShared-int-" target="_blank" rel="noopener"><code>tryReleaseShared(int)</code></a></li><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/AbstractQueuedSynchronizer.html#isHeldExclusively--" target="_blank" rel="noopener"><code>isHeldExclusively()</code></a></li></ul><p>Each of these methods by default throws <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/UnsupportedOperationException.html" target="_blank" rel="noopener"><code>UnsupportedOperationException</code></a><em>only</em><code>final</code></p><p>You may also find the inherited methods from <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/AbstractOwnableSynchronizer.html" target="_blank" rel="noopener"><code>AbstractOwnableSynchronizer</code></a> useful to keep track of the thread owning an exclusive synchronizer. You are encouraged to use them â€“ this enables monitoring and diagnostic tools to assist users in determining which threads hold locks.</p><pre><code class="java">public abstract class AbstractQueuedSynchronizer extends AbstractOwnableSynchronizer    implements java.io.Serializable {    public class ConditionObject implements Condition, java.io.Serializable {        /** First node of condition queue. */        private transient Node firstWaiter;        /** Last node of condition queue. */        private transient Node lastWaiter;                    /**         * Adds a new waiter to wait queue.         * @return its new wait node         */        private Node addConditionWaiter() {            Node t = lastWaiter;            // If lastWaiter is cancelled, clean out.            if (t != null &amp;&amp; t.waitStatus != Node.CONDITION) {                unlinkCancelledWaiters();                t = lastWaiter;            }            Node node = new Node(Thread.currentThread(), Node.CONDITION);            if (t == null)                firstWaiter = node;            else                t.nextWaiter = node;            lastWaiter = node;            return node;        }                    }    static final class Node {        /** Marker to indicate a node is waiting in shared mode */        static final Node SHARED = new Node();        /** Marker to indicate a node is waiting in exclusive mode */        static final Node EXCLUSIVE = null;        /** waitStatus value to indicate thread has cancelled */        static final int CANCELLED =  1;        /** waitStatus value to indicate successor&#39;s thread needs unparking */        static final int SIGNAL    = -1;        /** waitStatus value to indicate thread is waiting on condition */        static final int CONDITION = -2;        /**         * waitStatus value to indicate the next acquireShared should         * unconditionally propagate         */        static final int PROPAGATE = -3;        volatile int waitStatus;        volatile Node prev;        volatile Node next;        volatile Thread thread;        Node nextWaiter;        final boolean isShared() {            return nextWaiter == SHARED;        }    }        public final void acquire(int arg) {        if (!tryAcquire(arg) &amp;&amp; acquireQueued(addWaiter(Node.EXCLUSIVE), arg))            selfInterrupt();    }            public final void acquireShared(int arg) {        if (tryAcquireShared(arg) &lt; 0)            doAcquireShared(arg);    }    public final boolean tryAcquireSharedNanos(int arg, long nanosTimeout)            throws InterruptedException {        if (Thread.interrupted())            throw new InterruptedException();        return tryAcquireShared(arg) &gt;= 0 ||            doAcquireSharedNanos(arg, nanosTimeout);    }        public final boolean release(int arg) {        if (tryRelease(arg)) {            Node h = head;            if (h != null &amp;&amp; h.waitStatus != 0)                unparkSuccessor(h);            return true;        }        return false;    }    public final boolean releaseShared(int arg) {        if (tryReleaseShared(arg)) {            doReleaseShared();            return true;        }        return false;    }   }</code></pre><p>è¿™ä¸ªç±»æ¯”è¾ƒå…³é”®, å¤æ‚åº¦å¤ªé«˜äº†,æ¶‰åŠçš„ç»†èŠ‚å¤ªå¤š,å¦å•ç‹¬åˆ†æ</p><h5 id="AbstractQueuedLongSynchronizer"><a href="#AbstractQueuedLongSynchronizer" class="headerlink" title="AbstractQueuedLongSynchronizer"></a>AbstractQueuedLongSynchronizer</h5><p>AbstractQueuedLongSynchronizerç±»æä¾›äº†ç›¸åŒçš„åŠŸèƒ½ï¼Œä½†æ˜¯æ‰©å±•äº†å¯¹64ä½åŒæ­¥çŠ¶æ€çš„æ”¯æŒã€‚</p><h5 id="AbstractOwnableSynchronizer"><a href="#AbstractOwnableSynchronizer" class="headerlink" title="AbstractOwnableSynchronizer"></a>AbstractOwnableSynchronizer</h5><p>å®ƒä»¬éƒ½æ‰©å±•äº†AbstractOwnableSynchronizerç±»ï¼Œè¿™æ˜¯ä¸€ä¸ªç®€å•çš„ç±»ï¼Œå¸®åŠ©è®°å½•å½“å‰æŒæœ‰ç‹¬å åŒæ­¥çš„çº¿ç¨‹ã€‚</p><pre><code class="java">public abstract class AbstractOwnableSynchronizer    implements java.io.Serializable {    /** Use serial ID even though all fields transient. */    private static final long serialVersionUID = 3737899427754241961L;    /**     * Empty constructor for use by subclasses.     */    protected AbstractOwnableSynchronizer() { }    /**     * The current owner of exclusive mode synchronization.     */    private transient Thread exclusiveOwnerThread;    /**     * Sets the thread that currently owns exclusive access.     * A {@code null} argument indicates that no thread owns access.     * This method does not otherwise impose any synchronization or     * {@code volatile} field accesses.     * @param thread the owner thread     */    protected final void setExclusiveOwnerThread(Thread thread) {        exclusiveOwnerThread = thread;    }    /**     * Returns the thread last set by {@code setExclusiveOwnerThread},     * or {@code null} if never set.  This method does not otherwise     * impose any synchronization or {@code volatile} field accesses.     * @return the owner thread     */    protected final Thread getExclusiveOwnerThread() {        return exclusiveOwnerThread;    }}</code></pre><h4 id="LockSupports"><a href="#LockSupports" class="headerlink" title="LockSupports"></a>LockSupports</h4><p>The <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/LockSupport.html" target="_blank" rel="noopener"><code>LockSupport</code></a> class provides lower-level blocking and unblocking support that is useful for those developers implementing their own customized lock classes.</p><p>LockSupportç±»æä¾›äº†è¾ƒä½çº§åˆ«çš„é˜»å¡å’Œè§£é™¤é˜»å¡æ”¯æŒï¼Œè¿™å¯¹äºå®ç°è‡ªå®šä¹‰é”ç±»çš„å¼€å‘äººå‘˜éå¸¸æœ‰ç”¨ã€‚</p><h3 id="RecordğŸ“"><a href="#RecordğŸ“" class="headerlink" title="RecordğŸ“"></a>RecordğŸ“</h3><ul><li><p>TimeUnit ä¸ºå•¥ä¸éƒ½æŠ½è±¡æ–¹æ³•?è€Œæ˜¯æœ‰äº›éœ€è¦å®ç°,æœ‰äº›éœ€è¦æŠ½è±¡?</p></li><li><p>java.util.concurrent.Semaphore.Sync#nonfairTryAcquireShared å’Œjava.util.concurrent.Semaphore.Sync#reducePermits ä¸ºå•¥éœ€è¦é‡å¤å®ç°?</p></li><li><p>java.util.concurrent.locks.ReentrantReadWriteLock.ReadLock#newCondition ?</p><pre><code>  /**   * Throws {@code UnsupportedOperationException} because   * {@code ReadLocks} do not support conditions.   *   * @throws UnsupportedOperationException always   */</code></pre></li></ul>]]></content>
      
      
      <categories>
          
          <category> jdk </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jdk </tag>
            
            <tag> juc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JDK_The Collections Framework</title>
      <link href="/2019/07/29/JDK-The-Collections-Framework/"/>
      <url>/2019/07/29/JDK-The-Collections-Framework/</url>
      
        <content type="html"><![CDATA[<p><img src="http://ww4.sinaimg.cn/large/006tNc79gy1g5gqxyicllj30qo0f0gn7.jpg" alt="img"></p><a id="more"></a><h2 id="preface"><a href="#preface" class="headerlink" title="preface"></a>preface</h2><p>â€‹    </p><h3 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h3><p>æœ€è¿‘æœ‰ä¸ªäºŒè´§åœ¨çº¿ä¸Šä½¿ç”¨Collections#sort()çš„æ—¶å€™æŠ¥äº†ä¸ªé”™, java.lang.IllegalArgumentException: Comparison method violates its general contract!  è¿è¡Œçš„JDKç¯å¢ƒæ˜¯1.7</p><p><img src="http://ww4.sinaimg.cn/large/006tNc79gy1g5grfa3sfgj30vq0s60v2.jpg" alt="image-20190729155205469"></p><p> æœ¬ç€åšçˆ±çš„ç²¾ç¥,çœ‹äº†çœ‹ä¹‹å‰ä¹Ÿé‡åˆ°ç±»ä¼¼çš„é—®é¢˜.å°±å†³å®šæ€»ç»“ä¸‹,å…¶å®è¿™ä¸ªæ˜¯JDK1.6åˆ°1.7çš„å…¼å®¹é—®é¢˜.åœ¨<a href="https://www.oracle.com/technetwork/java/javase/compatibility-417013.html#incompatibilities" target="_blank" rel="noopener">https://www.oracle.com/technetwork/java/javase/compatibility-417013.html#incompatibilities</a> ä¸­å¯ä»¥å‘ç°</p><pre><code>Area: API: UtilitiesSynopsis: Updated sort behavior for Arrays and Collections may throw an IllegalArgumentExceptionDescription: The sorting algorithm used by java.util.Arrays.sort and (indirectly) by java.util.Collections.sort has been replaced. The new sort implementation may throw an IllegalArgumentException if it detects a Comparable that violates the Comparable contract. The previous implementation silently ignored such a situation.If the previous behavior is desired, you can use the new system property, java.util.Arrays.useLegacyMergeSort, to restore previous mergesort behavior.Nature of Incompatibility: behavioralRFE: 6804124</code></pre><p>â€‹    å¦‚æœè¿æ³•äº†æ¯”è¾ƒçš„çº¦æŸæ–°çš„æ’åºç®—æ³•ä¹Ÿè®¸ä¼šæŠ›å‡ºllegalArgumentExceptionå¼‚å¸¸ã€‚JDK6ä¸­çš„å®ç°åˆ™å¿½ç•¥äº†è¿™ç§æƒ…å†µ</p><h3 id="æ ¹æœ¬åŸå› "><a href="#æ ¹æœ¬åŸå› " class="headerlink" title="æ ¹æœ¬åŸå› "></a>æ ¹æœ¬åŸå› </h3><p>å®ç°Comparableæ¥å£åï¼Œè¦æ»¡è¶³ä¸€ä¸‹ä¸‰ä¸ªç‰¹æ€§ï¼š</p><ul><li>è‡ªåæ€§ï¼šx,y çš„æ¯”è¾ƒç»“æœå’Œ y,x çš„æ¯”è¾ƒç»“æœç›¸åã€‚ sgn(compare(x, y)) == -sgn(compare(y, x))</li><li>ä¼ é€’æ€§ï¼šx&gt;y, y&gt;z, åˆ™ x&gt;zã€‚((compare(x, y)&gt;0) &amp;&amp; (compare(y, z)&gt;0)) implies compare(x, z)&gt;0</li><li>å¯¹ç§°æ€§ï¼šx=y,åˆ™ x,z æ¯”è¾ƒç»“æœå’Œ yï¼Œz æ¯”è¾ƒç»“æœç›¸åŒã€‚    compare(x, y) == 0 implies that sgn(compare(x, z)) == sgn(compare(y, z)) for all z</li></ul><p>â€‹    å¼€å¤´çš„é‚£ä¸ªå°æœ‹å‹å®ç°ç±»ä¼¼å¦‚ä¸‹,æ˜æ˜¾æ²¡æœ‰æ»¡è¶³è‡ªåæ€§</p><pre><code>return x &gt; y ? 1 : -1;</code></pre><p>å½“x == yæ—¶ï¼Œsgn(compare(x, y))  = -1ï¼Œ-sgn(compare(y, x)) = 1ï¼Œè¿™è¿èƒŒäº†sgn(compare(x, y)) == -sgn(compare(y, x))çº¦æŸï¼Œæ‰€ä»¥åœ¨JDK7ä¸­æŠ›å‡ºäº†å¼‚å¸¸ã€‚</p><h3 id="åç»­"><a href="#åç»­" class="headerlink" title="åç»­"></a>åç»­</h3><p>è¿™é‡Œè´´ä¸ªå¯ä»¥é‡ç°è¯¥é”™è¯¯çš„ä»£ç </p><pre><code class="java">import java.util.Arrays;import java.util.List;import java.util.function.Consumer;/** * * Collections sort è¦æ»¡è¶³è‡ªåæ€§å¦åˆ™ä¼šæœ‰æ¦‚ç‡å‡ºé”™ï¼Œåœ¨1.7ä¸­ä¼šæœ‰é—®é¢˜ * @author zhengyumin * @create 2019-07-18 10:24 */public class CollectionSort {    public static void main(String[] args) {        List&lt;Integer&gt; list = Arrays.asList(0, 0, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,0, 0, 0, 1, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 2, 1, 0, 0, 0, 2, 30, 0, 3);        list.sort((o1, o2) -&gt; o1 &gt; o2 ? 1 : -1);        list.stream().forEach((Consumer) o -&gt; System.out.println(o));    }}</code></pre><p>ä¸Šé¢æè¿°çš„åªæ˜¯é›†åˆæ¡†æ¶ä¸­çš„ä¸€ä¸ªé—®é¢˜. å¥½äº†,å›åˆ°æˆ‘ä»¬ä»Šå¤©çš„ä¸»é¢˜The Collections Framework.</p><p>ç›¸å…³èµ„æ–™å¯ä»¥å‚è€ƒ:<a href="https://docs.oracle.com/javase/8/docs/technotes/guides/collections/index.html" target="_blank" rel="noopener">https://docs.oracle.com/javase/8/docs/technotes/guides/collections/index.html</a></p><h2 id="The-Collections-Framework"><a href="#The-Collections-Framework" class="headerlink" title="The Collections Framework"></a>The Collections Framework</h2><h3 id="API-Enhancements-å„ç‰ˆæœ¬APIå¢å¼ºå˜åŒ–"><a href="#API-Enhancements-å„ç‰ˆæœ¬APIå¢å¼ºå˜åŒ–" class="headerlink" title="API Enhancements(å„ç‰ˆæœ¬APIå¢å¼ºå˜åŒ–)"></a>API Enhancements(å„ç‰ˆæœ¬APIå¢å¼ºå˜åŒ–)</h3><ul><li><p><strong>API Enhancements in Java SE 8</strong> - An annotated list of API changes between release 7 and 8.</p><ul><li>Support for Lambda Expressions, Streams, and Aggregate Operations</li><li>Performance Improvement for HashMaps with Key Collisions</li></ul></li><li><p><strong>API Enhancements in Java SE 7</strong> - An annotated list of API changes between release 6 and 7.</p><ul><li>New Interface, TransferQueue</li><li>Improved Hash Function</li></ul></li><li><p><strong>API Enhancements in Java SE 6</strong> - An annotated list of API changes between release 5.0 and 6.</p><ul><li>These new collection interfaces are provided:<ul><li><code>Deque</code></li><li><code>BlockingDeque</code></li><li><code>NavigableSet</code> </li><li><code>NavigableMap</code> </li><li><code>ConcurrentNavigableMap</code></li></ul></li></ul></li><li><p><strong>API Enhancements in J2SE 5.0</strong> - An annotated list of API changes between release 1.4 and 5.0.</p><ul><li>Three new collection interfaces are provided:<ul><li><code>Queue</code> </li><li><code>BlockingQueue</code> </li><li><code>ConcurrentMap</code></li></ul></li><li>Three new generic algorithms and one comparator converter were added to the <code>Collections</code> utility class:<ul><li><code>frequency(Collection&lt;?&gt; c, Object o)</code> </li><li><code>disjoint(Collection&lt;?&gt; c1, Collection&lt;?&gt; c2)</code> </li><li><code>addAll(Collection&lt;? super T&gt; c, T... a)</code> </li><li><code>Comparator&lt;T&gt; reverseOrder(Comparator&lt;T&gt; cmp)</code> </li></ul></li></ul></li><li><p><strong>API Enhancements in J2SDK 1.4</strong> - An annotated list of API changes between release 1.3 and 1.4.</p><ul><li><p>The <code>Collections</code> utility class has several new methods:</p><ul><li><code>rotate(List list, int distance)</code> </li><li><code>replaceAll(List list, Object oldVal, Object newVal)</code></li><li><code>indexOfSubList(List source, List target)</code> </li><li><code>lastIndexOfSubList(List source, List target)</code></li><li><code>swap(List list, int i, int j)</code> </li><li><code>list(Enumeration e)</code> </li></ul></li><li><p>New interface <code>RandomAccess</code> is a marker interface that allows <code>List</code> implementations to indicate that they support fast (generally constant time) random access.</p></li><li><p>New class <code>LinkedHashMap</code> provides an insertion-ordered <code>Map</code> implementation that runs nearly as fast as <code>HashMap</code>. </p></li><li><p>New class <code>IdentityHashMap</code> is an identity-based Map implementation based on a hash table. </p></li></ul></li></ul><h3 id="Introduction-to-Collections-é›†åˆä»‹ç»"><a href="#Introduction-to-Collections-é›†åˆä»‹ç»" class="headerlink" title="Introduction to Collections (é›†åˆä»‹ç»)"></a>Introduction to Collections (é›†åˆä»‹ç»)</h3><p>â€‹    ä¸ºä»€ä¹ˆéœ€è¦é›†åˆæ¡†æ¶?é›†åˆæ¡†æ¶çš„ç»„æˆ?</p><h4 id="What-Is-a-Collections-Framework"><a href="#What-Is-a-Collections-Framework" class="headerlink" title="What Is a Collections Framework?"></a>What Is a Collections Framework?</h4><p>A <em>collections framework</em> is a unified architecture for representing and manipulating collections. All collections frameworks contain the following:</p><ul><li><strong>Interfaces:</strong> These are abstract data types that represent collections. Interfaces allow collections to be manipulated independently of the details of their representation. In object-oriented languages, interfaces generally form a hierarchy.</li><li><strong>Implementations:</strong> These are the concrete implementations of the collection interfaces. In essence, they are reusable data structures.</li><li><strong>Algorithms:</strong> These are the methods that perform useful computations, such as searching and sorting, on objects that implement collection interfaces. The algorithms are said to be <em>polymorphic</em>: that is, the same method can be used on many different implementations of the appropriate collection interface. In essence, algorithms are reusable functionality.</li></ul><p>æ‰€æœ‰é›†åˆæ¡†æ¶éƒ½åŒ…å«å¦‚ä¸‹: æ¥å£ã€å®ç°ã€ç®—æ³•</p><p>more details , The collections framework consists of:</p><ul><li><strong>Collection interfaces</strong> (æ¥å£). Represent different types of collections, such as sets, lists, and maps. These interfaces form the basis of the framework.<ul><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Collection.html" target="_blank" rel="noopener"><strong>Collection</strong></a> - A group of objects. No assumptions are made about the order of the collection (if any) or whether it can contain duplicate elements.</li><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Set.html" target="_blank" rel="noopener"><strong>Set</strong></a> - The familiar set abstraction. No duplicate elements permitted. May or may not be ordered. Extends the <code>Collection</code> interface.</li><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/List.html" target="_blank" rel="noopener"><strong>List</strong></a> - Ordered collection, also known as a <em>sequence</em>. Duplicates are generally permitted. Allows positional access. Extends the <code>Collection</code> interface.</li><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Queue.html" target="_blank" rel="noopener"><strong>Queue</strong></a> - A collection designed for holding elements before processing. Besides basic <code>Collection</code> operations, queues provide additional insertion, extraction, and inspection operations.</li><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Deque.html" target="_blank" rel="noopener"><strong>Deque</strong></a> - A <em>double ended queue</em>, supporting element insertion and removal at both ends. Extends the <code>Queue</code> interface.</li><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Map.html" target="_blank" rel="noopener"><strong>Map</strong></a> - A mapping from keys to values. Each key can map to one value.</li><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/SortedSet.html" target="_blank" rel="noopener"><strong>SortedSet</strong></a> - A set whose elements are automatically sorted, either in their <em>natural ordering</em> (see the <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Comparable.html" target="_blank" rel="noopener"><code>Comparable</code></a> interface) or by a <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Comparator.html" target="_blank" rel="noopener"><code>Comparator</code></a> object provided when a <code>SortedSet</code> instance is created. Extends the <code>Set</code> interface.</li><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/SortedMap.html" target="_blank" rel="noopener"><strong>SortedMap</strong></a> - A map whose mappings are automatically sorted by key, either using the <em>natural ordering</em> of the keys or by a comparator provided when a <code>SortedMap</code> instance is created. Extends the <code>Map</code> interface.</li><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/NavigableSet.html" target="_blank" rel="noopener"><strong>NavigableSet</strong></a> - A <code>SortedSet</code> extended with navigation methods reporting closest matches for given search targets. A <code>NavigableSet</code> may be accessed and traversed in either ascending or descending order.</li><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/NavigableMap.html" target="_blank" rel="noopener"><strong>NavigableMap</strong></a> - A <code>SortedMap</code> extended with navigation methods returning the closest matches for given search targets. A <code>NavigableMap</code> can be accessed and traversed in either ascending or descending key order.</li><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/BlockingQueue.html" target="_blank" rel="noopener"><strong>BlockingQueue</strong></a> - A <code>Queue</code> with operations that wait for the queue to become nonempty when retrieving an element and that wait for space to become available in the queue when storing an element. (This interface is part of the <code>java.util.concurrent</code> package.)</li><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/TransferQueue.html" target="_blank" rel="noopener"><strong>TransferQueue</strong></a> - A <code>BlockingQueue</code> in which producers can wait for consumers to receive elements. (This interface is part of the <code>java.util.concurrent</code> package.)</li><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/BlockingDeque.html" target="_blank" rel="noopener"><strong>BlockingDeque</strong></a> - A <code>Deque</code> with operations that wait for the deque to become nonempty when retrieving an element and wait for space to become available in the deque when storing an element. Extends both the <code>Deque</code> and <code>BlockingQueue</code> interfaces. (This interface is part of the <code>java.util.concurrent</code> package.)</li><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ConcurrentMap.html" target="_blank" rel="noopener"><strong>ConcurrentMap</strong></a> - A <code>Map</code> with atomic <code>putIfAbsent</code>, <code>remove</code>, and <code>replace</code> methods. (This interface is part of the <code>java.util.concurrent</code> package.)</li><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ConcurrentNavigableMap.html" target="_blank" rel="noopener"><strong>ConcurrentNavigableMap</strong></a> - A <code>ConcurrentMap</code> that is also a <code>NavigableMap</code>.</li></ul></li><li><strong>General-purpose implementations</strong> (é€šå¸¸å®ç°). Primary implementations of the collection interfaces.<ul><li><strong>HashSet</strong> - Hash table implementation of the <code>Set</code> interface. The best all-around implementation of the <code>Set</code> interface.</li><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/TreeSet.html" target="_blank" rel="noopener"><strong>TreeSet</strong></a> - Red-black tree implementation of the <code>NavigableSet</code> interface.</li><li><strong>LinkedHashSet</strong> - Hash table and linked list implementation of the <code>Set</code> interface. An insertion-ordered <code>Set</code> implementation that runs nearly as fast as <code>HashSet</code>.</li><li><strong>ArrayList</strong> - Resizable array implementation of the <code>List</code> interface (an unsynchronized <code>Vector</code>). The best all-around implementation of the <code>List</code> interface.</li><li><strong>ArrayDeque</strong> - Efficient, resizable array implementation of the <code>Deque</code> interface.</li><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/LinkedList.html" target="_blank" rel="noopener"><strong>LinkedList</strong></a> - Doubly-linked list implementation of the <code>List</code> interface. Provides better performance than the <code>ArrayList</code> implementation if elements are frequently inserted or deleted within the list. Also implements the <code>Deque</code> interface. When accessed through the <code>Queue</code> interface, <code>LinkedList</code> acts as a FIFO queue.</li><li><strong>PriorityQueue</strong> - Heap implementation of an unbounded priority queue.</li><li><strong>HashMap</strong> - Hash table implementation of the <code>Map</code> interface (an unsynchronized <code>Hashtable</code> that supports <code>null</code> keys and values). The best all-around implementation of the <code>Map</code> interface.</li><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/TreeMap.html" target="_blank" rel="noopener"><strong>TreeMap</strong></a> Red-black tree implementation of the <code>NavigableMap</code> interface.</li><li><strong>LinkedHashMap</strong> - Hash table and linked list implementation of the <code>Map</code> interface. An insertion-ordered <code>Map</code> implementation that runs nearly as fast as <code>HashMap</code>. Also useful for building caches (see <a href="https://docs.oracle.com/javase/8/docs/api/java/util/LinkedHashMap.html#removeEldestEntry-java.util.Map.Entry-" target="_blank" rel="noopener">removeEldestEntry(Map.Entry)</a> ).</li></ul></li><li><strong>Legacy implementations</strong>. The collection classes from earlier releases, <code>Vector</code> and <code>Hashtable</code>, were retrofitted to implement the collection interfaces.<ul><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Vector.html" target="_blank" rel="noopener"><strong>Vector</strong></a> - Synchronized resizable array implementation of the <code>List</code> interface with additional legacy methods.</li><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Hashtable.html" target="_blank" rel="noopener"><strong>Hashtable</strong></a> - Synchronized hash table implementation of the <code>Map</code> interface that does not allow <code>null</code> keys or values, plus additional legacy methods.</li></ul></li><li><strong>Special-purpose implementations</strong> (ç‰¹æ®Šå®ç°). Implementations designed for use in special situations. These implementations display nonstandard performance characteristics, usage restrictions, or behavior.<ul><li><strong>WeakHashMap</strong> - An implementation of the <code>Map</code> interface that stores only <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/ref/WeakReference.html" target="_blank" rel="noopener"><em>weak references</em></a> to its keys. Storing only weak references enables key-value pairs to be garbage collected when the key is no longer referenced outside of the <code>WeakHashMap</code>. This class is the easiest way to use the power of weak references. It is useful for implementing registry-like data structures, where the utility of an entry vanishes when its key is no longer reachable by any thread.</li><li><strong>IdentityHashMap</strong> - Identity-based <code>Map</code> implementation based on a hash table. This class is useful for topology-preserving object graph transformations (such as serialization or deep copying). To perform these transformations, you must maintain an identity-based â€œnode tableâ€ that keeps track of which objects have already been seen. Identity-based maps are also used to maintain object-to-meta-information mappings in dynamic debuggers and similar systems. Finally, identity-based maps are useful in preventing â€œspoof attacksâ€ resulting from intentionally perverse equals methods. (<code>IdentityHashMap</code> never invokes the equals method on its keys.) An added benefit of this implementation is that it is fast.</li><li><strong>CopyOnWriteArrayList</strong> - A <code>List</code> implementation backed by an copy-on-write array. All mutative operations (such as <code>add</code>, <code>set</code>, and <code>remove</code>) are implemented by making a new copy of the array. No synchronization is necessary, even during iteration, and iterators are guaranteed never to throw<code>ConcurrentModificationException</code>. This implementation is well-suited to maintaining event-handler lists (where change is infrequent, and traversal is frequent and potentially time-consuming).</li><li><strong>CopyOnWriteArraySet</strong> - A <code>Set</code> implementation backed by a copy-on-write array. This implementation is similar to <code>CopyOnWriteArrayList</code>. Unlike most <code>Set</code> implementations, the <code>add</code>, <code>remove</code>, and <code>contains</code> methods require time proportional to the size of the set. This implementation is well suited to maintaining event-handler lists that must prevent duplicates.</li><li><strong>EnumSet</strong> - A high-performance <code>Set</code> implementation backed by a bit vector. All elements of each <code>EnumSet</code> instance must be elements of a single enum type.</li><li><strong>EnumMap</strong> - A high-performance <code>Map</code> implementation backed by an array. All keys in each <code>EnumMap</code> instance must be elements of a single enum type.</li></ul></li><li><strong>Concurrent implementations</strong> (å¹¶å‘å®ç°). Implementations designed for highly concurrent use.<ul><li><strong>ConcurrentLinkedQueue</strong> - An unbounded first in, first out (FIFO) queue based on linked nodes.</li><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/LinkedBlockingQueue.html" target="_blank" rel="noopener"><strong>LinkedBlockingQueue</strong></a> - An optionally bounded FIFO blocking queue backed by linked nodes.</li><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ArrayBlockingQueue.html" target="_blank" rel="noopener"><strong>ArrayBlockingQueue</strong></a> - A bounded FIFO blocking queue backed by an array.</li><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/PriorityBlockingQueue.html" target="_blank" rel="noopener"><strong>PriorityBlockingQueue</strong></a> - An unbounded blocking priority queue backed by a priority heap.</li><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/DelayQueue.html" target="_blank" rel="noopener"><strong>DelayQueue</strong></a> - A time-based scheduling queue backed by a priority heap.</li><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/SynchronousQueue.html" target="_blank" rel="noopener"><strong>SynchronousQueue</strong></a> - A simple rendezvous mechanism that uses the <code>BlockingQueue</code> interface.</li><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/LinkedBlockingDeque.html" target="_blank" rel="noopener"><strong>LinkedBlockingDeque</strong></a> - An optionally bounded FIFO blocking deque backed by linked nodes.</li><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/LinkedTransferQueue.html" target="_blank" rel="noopener"><strong>LinkedTransferQueue</strong></a> - An unbounded <code>TransferQueue</code> backed by linked nodes.</li><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ConcurrentHashMap.html" target="_blank" rel="noopener"><strong>ConcurrentHashMap</strong></a> - A highly concurrent, high-performance <code>ConcurrentMap</code> implementation based on a hash table. This implementation never blocks when performing retrievals and enables the client to select the concurrency level for updates. It is intended as a drop-in replacement for <code>Hashtable</code>. In addition to implementing <code>ConcurrentMap</code>, it supports all of the legacy methods of <code>Hashtable</code>.</li><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ConcurrentSkipListSet.html" target="_blank" rel="noopener"><strong>ConcurrentSkipListSet</strong></a> - Skips list implementation of the <code>NavigableSet</code> interface.</li><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ConcurrentSkipListMap.html" target="_blank" rel="noopener"><strong>ConcurrentSkipListMap</strong></a> - Skips list implementation of the <code>ConcurrentNavigableMap</code> interface.</li></ul></li><li><strong>Wrapper implementations</strong> . Add functionality, such as synchronization, to other implementations.<ul><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Collections.html#unmodifiableCollection-java.util.Collection-" target="_blank" rel="noopener"><strong>Collections.unmodifiableInterface</strong></a> - Returns an unmodifiable view of a specified collection that throws an <code>UnsupportedOperationException</code> if the user attempts to modify it.</li><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Collections.html#synchronizedCollection-java.util.Collection-" target="_blank" rel="noopener"><strong>Collections.synchronizedInterface</strong></a> - Returns a synchronized collection that is backed by the specified (typically unsynchronized) collection. As long as all accesses to the backing collection are through the returned collection, thread safety is guaranteed.</li><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Collections.html#checkedCollection-java.util.Collection-java.lang.Class-" target="_blank" rel="noopener"><strong>Collections.checkedInterface</strong></a> - Returns a dynamically type-safe view of the specified collection, which throws a <code>ClassCastException</code> if a client attempts to add an element of the wrong type. The generics mechanism in the language provides compile-time (static) type checking, but it is possible to bypass this mechanism. Dynamically type-safe views eliminate this possibility.</li></ul></li><li><strong>Convenience implementations</strong>. High-performance â€œmini-implementationsâ€ of the collection interfaces.<ul><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Arrays.html#asList-T...-" target="_blank" rel="noopener"><strong>Arrays.asList</strong></a> - Enables an array to be viewed as a list.</li><li><strong>emptySet, emptyList and emptyMap</strong> - Return an immutable empty set, list, or map.</li><li><strong>singleton, singletonList, and singletonMap</strong> - Return an immutable singleton set, list, or map, containing only the specified object (or key-value mapping).</li><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Collections.html#nCopies-int-T-" target="_blank" rel="noopener"><strong>nCopies</strong></a> - Returns an immutable list consisting of n copies of a specified object.</li></ul></li><li><strong>Abstract implementations</strong>. Partial implementations of the collection interfaces to facilitate custom implementations.<ul><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/AbstractCollection.html" target="_blank" rel="noopener"><strong>AbstractCollection</strong></a> - Skeletal <code>Collection</code> implementation that is neither a set nor a list (such as a â€œbagâ€ or multiset).</li><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/AbstractSet.html" target="_blank" rel="noopener"><strong>AbstractSet</strong></a> - Skeletal <code>Set</code> implementation.</li><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/AbstractList.html" target="_blank" rel="noopener"><strong>AbstractList</strong></a> - Skeletal <code>List</code> implementation backed by a random access data store (such as an array).</li><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/AbstractSequentialList.html" target="_blank" rel="noopener"><strong>AbstractSequentialList</strong></a> - Skeletal <code>List</code> implementation backed by a sequential access data store (such as a linked list).</li><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/AbstractQueue.html" target="_blank" rel="noopener"><strong>AbstractQueue</strong></a> - Skeletal <code>Queue</code> implementation.</li><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/AbstractMap.html" target="_blank" rel="noopener"><strong>AbstractMap</strong></a> - Skeletal <code>Map</code> implementation.</li></ul></li><li><strong>Algorithms</strong>. Static methods that perform useful functions on collections, such as sorting a list.<ul><li><strong>sort(List)</strong> - Sorts a list using a merge sort algorithm, which provides average case performance comparable to a high quality quicksort, guaranteed O(n<em>log n) performance (unlike quicksort), and </em>stability* (unlike quicksort). A stable sort is one that does not reorder equal elements.</li><li><strong>binarySearch(List, Object)</strong> - Searches for an element in an ordered list using the binary search algorithm.</li><li><strong>reverse(List)</strong> - Reverses the order of the elements in a list.</li><li><strong>shuffle(List)</strong> - Randomly changes the order of the elements in a list.</li><li><strong>fill(List, Object)</strong> - Overwrites every element in a list with the specified value.</li><li><strong>copy(List dest, List src)</strong> - Copies the source list into the destination list.</li><li><strong>min(Collection)</strong> - Returns the minimum element in a collection.</li><li><strong>max(Collection)</strong> - Returns the maximum element in a collection.</li><li><strong>rotate(List list, int distance)</strong> - Rotates all of the elements in the list by the specified distance.</li><li><strong>replaceAll(List list, Object oldVal, Object newVal)</strong> - Replaces all occurrences of one specified value with another.</li><li><strong>indexOfSubList(List source, List target)</strong> - Returns the index of the first sublist of source that is equal to target.</li><li><strong>lastIndexOfSubList(List source, List target)</strong> - Returns the index of the last sublist of source that is equal to target.</li><li><strong>swap(List, int, int)</strong> - Swaps the elements at the specified positions in the specified list.</li><li><strong>frequency(Collection, Object)</strong> - Counts the number of times the specified element occurs in the specified collection.</li><li><strong>disjoint(Collection, Collection)</strong> - Determines whether two collections are disjoint, in other words, whether they contain no elements in common.</li><li><strong>addAll(Collection&lt;? super T&gt;, Tâ€¦)</strong> - Adds all of the elements in the specified array to the specified collection.</li></ul></li><li><strong>Infrastructure</strong>. Interfaces that provide essential support for the collection interfaces.<ul><li>Iterators- Similar to the familiarEnumeration interface, but more powerful, and with improved method names.<ul><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Iterator.html" target="_blank" rel="noopener"><strong>Iterator</strong></a> - In addition to the functionality of the <code>Enumeration</code> interface, enables the user to remove elements from the backing collection with well-defined, useful semantics.</li><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/ListIterator.html" target="_blank" rel="noopener"><strong>ListIterator</strong></a> - Iterator for use with lists. In addition to the functionality of the <code>Iterator</code> interface, supports bidirectional iteration, element replacement, element insertion, and index retrieval.</li></ul></li><li>Ordering<ul><li><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Comparable.html" target="_blank" rel="noopener"><strong>Comparable</strong></a> - Imparts a <em>natural ordering</em> to classes that implement it. The natural ordering can be used to sort a list or maintain order in a sorted set or map. Many classes were retrofitted to implement this interface.</li><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Comparator.html" target="_blank" rel="noopener"><strong>Comparator</strong></a> - Represents an order relation, which can be used to sort a list or maintain order in a sorted set or map. Can override a typeâ€™s natural ordering or order objects of a type that does not implement the <code>Comparable</code> interface.</li></ul></li><li>Runtime exceptions<ul><li><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/UnsupportedOperationException.html" target="_blank" rel="noopener"><strong>UnsupportedOperationException</strong></a> - Thrown by collections if an unsupported optional operation is called.</li><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/ConcurrentModificationException.html" target="_blank" rel="noopener"><strong>ConcurrentModificationException</strong></a> - Thrown by iterators and list iterators if the backing collection is changed unexpectedly while the iteration is in progress. Also thrown by <em>sublist</em> views of lists if the backing list is changed unexpectedly.</li></ul></li><li>Performance<ul><li><strong>RandomAccess</strong> - Marker interface that lets <code>List</code> implementations indicate that they support fast (generally constant time) random access. This lets generic algorithms change their behavior to provide good performance when applied to either random or sequential access lists.</li></ul></li></ul></li><li><strong>Array Utilities</strong>. Utility functions for arrays of primitive types and reference objects. Not, strictly speaking, a part of the collections framework, this feature was added to the Java platform at the same time as the collections framework and relies on some of the same infrastructure.<ul><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Arrays.html" target="_blank" rel="noopener"><strong>Arrays</strong></a> - Contains static methods to sort, search, compare, hash, copy, resize, convert to <code>String</code>, and fill arrays of primitives and objects.</li></ul></li></ul><p>æ›´å¤šç»†èŠ‚:<a href="https://docs.oracle.com/javase/8/docs/technotes/guides/collections/reference.html" target="_blank" rel="noopener">https://docs.oracle.com/javase/8/docs/technotes/guides/collections/reference.html</a></p><h4 id="Benefits-of-the-Java-Collections-Framework-å®ç°é›†åˆæ¡†æ¶çš„å¥½å¤„"><a href="#Benefits-of-the-Java-Collections-Framework-å®ç°é›†åˆæ¡†æ¶çš„å¥½å¤„" class="headerlink" title="Benefits of the Java Collections Framework(å®ç°é›†åˆæ¡†æ¶çš„å¥½å¤„)"></a>Benefits of the Java Collections Framework(å®ç°é›†åˆæ¡†æ¶çš„å¥½å¤„)</h4><p>The Java Collections Framework provides the following benefits:</p><ul><li><strong>Reduces programming effort:</strong> By providing useful data structures and algorithms, the Collections Framework frees you to concentrate on the important parts of your program rather than on the low-level â€œplumbingâ€ required to make it work. By facilitating interoperability among unrelated APIs, the Java Collections Framework frees you from writing adapter objects or conversion code to connect APIs.</li><li><strong>Increases program speed and quality:</strong> This Collections Framework provides high-performance, high-quality implementations of useful data structures and algorithms. The various implementations of each interface are interchangeable, so programs can be easily tuned by switching collection implementations. Because youâ€™re freed from the drudgery of writing your own data structures, youâ€™ll have more time to devote to improving programsâ€™ quality and performance.</li><li><strong>Allows interoperability among unrelated APIs:</strong> The collection interfaces are the vernacular by which APIs pass collections back and forth. If my network administration API furnishes a collection of node names and if your GUI toolkit expects a collection of column headings, our APIs will interoperate seamlessly, even though they were written independently.</li><li><strong>Reduces effort to learn and to use new APIs:</strong> Many APIs naturally take collections on input and furnish them as output. In the past, each such API had a small sub-API devoted to manipulating its collections. There was little consistency among these ad hoc collections sub-APIs, so you had to learn each one from scratch, and it was easy to make mistakes when using them. With the advent of standard collection interfaces, the problem went away.</li><li><strong>Reduces effort to design new APIs:</strong> This is the flip side of the previous advantage. Designers and implementers donâ€™t have to reinvent the wheel each time they create an API that relies on collections; instead, they can use standard collection interfaces.</li><li><strong>Fosters software reuse:</strong> New data structures that conform to the standard collection interfaces are by nature reusable. The same goes for new algorithms that operate on objects that implement these interfaces.</li></ul><h3 id="Collection-Interfaces"><a href="#Collection-Interfaces" class="headerlink" title="Collection Interfaces"></a>Collection Interfaces</h3><p><img src="http://ww4.sinaimg.cn/large/006tNc79gy1g5gt0ie7x3g30b6042aa5.gif" alt="Two interface trees, one starting with Collection and including Set, SortedSet, List, and Queue, and the other starting with Map and including SortedMap."></p><p>ä¸»è¦åˆ†æˆä¸¤éƒ¨åˆ†,Collectionå’ŒMap</p><p>The <em>collection interfaces</em> are divided into two groups. The most basic interface, <code>java.util.Collection</code>, has the following descendants:</p><ul><li><code>java.util.Set</code></li><li><code>java.util.SortedSet</code></li><li><code>java.util.NavigableSet</code></li><li><code>java.util.Queue</code></li><li><code>java.util.concurrent.BlockingQueue</code></li><li><code>java.util.concurrent.TransferQueue</code></li><li><code>java.util.Deque</code></li><li><code>java.util.concurrent.BlockingDeque</code></li></ul><p>The other collection interfaces are based on <code>java.util.Map</code> and are not true collections. However, these interfaces contain <em>collection-view</em> operations, which enable them to be manipulated as collections. <code>Map</code> has the following offspring:</p><ul><li><code>java.util.SortedMap</code></li><li><code>java.util.NavigableMap</code></li><li><code>java.util.concurrent.ConcurrentMap</code></li><li><code>java.util.concurrent.ConcurrentNavigableMap</code></li></ul><p>ä¸“ä¸šæœ¯è¯­,  modifiableã€mutableã€variable-sizeã€sequential access</p><p>Several terms are introduced to aid in this specification:</p><ul><li>Collections that do not support modification operations (such as <code>add</code>, <code>remove</code> and <code>clear</code>) are referred to as <em>unmodifiable</em>. Collections that are not unmodifiable are <em>modifiable.</em></li><li>Collections that additionally guarantee that no change in the <code>Collection</code> object will be visible are referred to as <em>immutable</em>. Collections that are not immutable are <em>mutable</em>.</li><li>Lists that guarantee that their size remains constant even though the elements can change are referred to as <em>fixed-size</em>. Lists that are not fixed-size are referred to as <em>variable-size</em>.</li><li>Lists that support fast (generally constant time) indexed element access are known as <em>random access</em> lists. Lists that do not support fast indexed element access are known as <em>sequential access</em> lists. The <code>RandomAccess</code> marker interface enables lists to advertise the fact that they support random access. This enables generic algorithms to change their behavior to provide good performance when applied to either random or sequential access lists.</li></ul><h3 id="Collection-Implementations"><a href="#Collection-Implementations" class="headerlink" title="Collection Implementations"></a>Collection Implementations</h3><p>Classes that implement the collection interfaces typically have names in the form of &lt;<em>Implementation-style</em>&gt;&lt;<em>Interface</em>&gt;. The general purpose implementations are summarized in the following table:</p><table><thead><tr><th>Interface</th><th>Hash Table</th><th>Resizable Array</th><th>Balanced Tree</th><th>Linked List</th><th>Hash Table + Linked List</th></tr></thead><tbody><tr><td><code>Set</code></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/HashSet.html" target="_blank" rel="noopener"><code>HashSet</code></a></td><td></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/TreeSet.html" target="_blank" rel="noopener"><code>TreeSet</code></a></td><td></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/LinkedHashSet.html" target="_blank" rel="noopener"><code>LinkedHashSet</code></a></td></tr><tr><td><code>List</code></td><td></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/ArrayList.html" target="_blank" rel="noopener"><code>ArrayList</code></a></td><td></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/LinkedList.html" target="_blank" rel="noopener"><code>LinkedList</code></a></td><td></td></tr><tr><td><code>Deque</code></td><td></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/ArrayDeque.html" target="_blank" rel="noopener"><code>ArrayDeque</code></a></td><td></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/LinkedList.html" target="_blank" rel="noopener"><code>LinkedList</code></a></td><td></td></tr><tr><td><code>Map</code></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/HashMap.html" target="_blank" rel="noopener"><code>HashMap</code></a></td><td></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/TreeMap.html" target="_blank" rel="noopener"><code>TreeMap</code></a></td><td></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/LinkedHashMap.html" target="_blank" rel="noopener"><code>LinkedHashMap</code></a></td></tr></tbody></table><p>â€‹    </p><p>The general-purpose implementations support all of the <em>optional operations</em> in the collection interfaces and have no restrictions on the elements they may contain. They are unsynchronized, but the <code>Collections</code> class contains static factories called <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Collections.html#synchronizedCollection-java.util.Collection-" target="_blank" rel="noopener"><em>synchronization wrappers</em></a> that can be used to add synchronization to many unsynchronized collections. All of the new implementations have <em>fail-fast iterators</em>, which detect invalid concurrent modification, and fail quickly and cleanly (rather than behaving erratically).</p><p>â€‹    The <code>AbstractCollection</code>, <code>AbstractSet</code>, <code>AbstractList</code>, <code>AbstractSequentialList</code> and <code>AbstractMap</code> classes provide basic implementations of the core collection interfaces, to minimize the effort required to implement them. The API documentation for these classes describes precisely how each method is implemented so the implementer knows which methods must be overridden, given the performance of the basic operations of a specific implementation.</p><h3 id="Concurrent-Collections"><a href="#Concurrent-Collections" class="headerlink" title="Concurrent Collections"></a>Concurrent Collections</h3><p>Applications that use collections from more than one thread must be carefully programmed. In general, this is known as <em>concurrent programming</em>. The Java platform includes extensive support for concurrent programming. See <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/concurrency/index.html" target="_blank" rel="noopener">Java Concurrency Utilities</a> for details.</p><p>Collections are so frequently used that various concurrent friendly interfaces and implementations of collections are included in the APIs. These types go beyond the synchronization wrappers discussed previously to provide features that are frequently needed in concurrent programming.</p><h4 id="interfaces"><a href="#interfaces" class="headerlink" title="interfaces"></a>interfaces</h4><p>These concurrent-aware interfaces are available:</p><ul><li><code>BlockingQueue</code></li><li><code>TransferQueue</code></li><li><code>BlockingDeque</code></li><li><code>ConcurrentMap</code></li><li><code>ConcurrentNavigableMap</code></li></ul><h4 id="implementation"><a href="#implementation" class="headerlink" title="implementation"></a>implementation</h4><p>The following concurrent-aware implementation classes are available. See the API documentation for the correct usage of these implementations.</p><ul><li><code>LinkedBlockingQueue</code></li><li><code>ArrayBlockingQueue</code></li><li><code>PriorityBlockingQueue</code></li><li><code>DelayQueue</code></li><li><code>SynchronousQueue</code></li><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/LinkedBlockingDeque.html" target="_blank" rel="noopener"><code>LinkedBlockingDeque</code></a></li><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/LinkedTransferQueue.html" target="_blank" rel="noopener"><code>LinkedTransferQueue</code></a></li><li><code>CopyOnWriteArrayList</code></li><li><code>CopyOnWriteArraySet</code></li><li><code>ConcurrentSkipListSet</code></li><li><code>ConcurrentHashMap</code></li><li><code>ConcurrentSkipListMap</code></li></ul>]]></content>
      
      
      <categories>
          
          <category> jdk </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jdk </tag>
            
            <tag> collections </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Note_ç å†œç¿»èº«</title>
      <link href="/2019/07/10/Note-%E7%A0%81%E5%86%9C%E7%BF%BB%E8%BA%AB/"/>
      <url>/2019/07/10/Note-%E7%A0%81%E5%86%9C%E7%BF%BB%E8%BA%AB/</url>
      
        <content type="html"><![CDATA[<p><img src="http://ww4.sinaimg.cn/large/006tNc79gy1g4v6oydtusj30u016fn56.jpg" alt="image-20190710235737581"></p><a id="more"></a><p>è¿™å‡ å¤©çœ‹äº†æœ¬ä¹¦,ã€Šç å†œç¿»èº«ã€‹ åšä¸ªç¬”è®°æ€»ç»“ä¸‹</p><p>å…ˆæ¥ä¸ªæ€»è¯„ ,å¾ˆä¸é”™çš„å…¥é—¨ä¹¦,è¶£å‘³æ€§æ¯”è¾ƒå¼º, æ¶‰åŠçŸ¥è¯†èŒƒå›´æ¯”è¾ƒå¹¿</p><p>ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªè®®é¢˜:</p><ul><li>è®¡ç®—æœºåŸç†</li><li>javaå‘å±•å†å²</li><li>webå‘å±•å†å²</li><li>å…¶ä»–(ä»£ç ç®¡ç†ã€JavaScript)</li></ul><h2 id="è®¡ç®—æœºåŸç†"><a href="#è®¡ç®—æœºåŸç†" class="headerlink" title="è®¡ç®—æœºåŸç†"></a>è®¡ç®—æœºåŸç†</h2><h3 id="çº¿ç¨‹"><a href="#çº¿ç¨‹" class="headerlink" title="çº¿ç¨‹"></a>çº¿ç¨‹</h3><p>çº¿ç¨‹çŠ¶æ€ å°±ç»ª è¿è¡Œ ç­‰å¾…</p><p>é” è·å–é¡ºåºä»å¤§åˆ°å°</p><h3 id="TCP-IP"><a href="#TCP-IP" class="headerlink" title="TCP/IP"></a>TCP/IP</h3><p>ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹é“¾æ¥</p><p>çª—å£åè®®æ§åˆ¶é€Ÿç‡</p><p>ç¡®è®¤ä¼ è¾¾ã€é‡ä¼ æœºåˆ¶</p><h3 id="CPU"><a href="#CPU" class="headerlink" title="CPU"></a>CPU</h3><p>å¯„å­˜å™¨ ç¨‹åºè®¡æ•°å™¨</p><p>ç¨‹åºéƒ½æ˜¯ç”±é¡ºåºã€åˆ†æ”¯ã€å¾ªç¯ç»„æˆçš„</p><p>ç¼“å­˜ L1 L2 L3  å±€éƒ¨æ€§åŸç†</p><p>æµæ°´çº¿</p><h3 id="è¿›ç¨‹"><a href="#è¿›ç¨‹" class="headerlink" title="è¿›ç¨‹"></a>è¿›ç¨‹</h3><p>å†¯è¯ºä¾æ›¼ æå‡ºäº†å­˜å‚¨ç¨‹åº-&gt;ä¸“ç”¨è®¡ç®—æœº åˆ° é€šç”¨è®¡ç®—æœº</p><p>è¿ç®—å™¨ æ§åˆ¶å™¨ å­˜å‚¨å™¨ è¾“å…¥è®¾å¤‡ è¾“å‡ºè®¾å¤‡</p><p>å†…å­˜</p><p>å†…å­˜åˆ†é…ç®—æ³•</p><p>åœ°å€é‡å®šä½</p><p>â€‹    é™æ€é‡å®šä½(ç§»åŠ¨ç¨‹åº,éœ€è¦é‡å®šä½)</p><p>â€‹    åŠ¨æ€é‡å®šå‘ </p><p>â€‹        è®°å½•æ¯ä¸ªç¨‹åºçš„èµ·å§‹åœ°å€,å¯„å­˜å™¨(åŸºå€å¯„å­˜å™¨) </p><p>â€‹        è®°å½•ç¨‹åºå†…å­˜é•¿åº¦å¯„å­˜å™¨ é˜²æ­¢è¶Šç•Œ (ä¸¤ä¸ªå¯„å­˜å™¨å°è£…ä¸ºMMU å†…å­˜ç®¡ç†å•å…ƒ,å®Œæˆåœ°å€çš„è½¬æ¢)</p><p>åˆ†æ—¶ç³»ç»Ÿ CPUæ—¶é—´åˆ†ç‰‡</p><p>åˆ†å—è£…å…¥å†…å­˜(é¡µæ¡† Page Frame)</p><p>è™šæ‹Ÿå†…å­˜(åˆ†é¡µPage)</p><p>åˆ†æ®µ(ä»£ç æ®µ,æ•°æ®æ®µ,å †æ ˆæ®µ)+åˆ†é¡µ</p><p>çº¿ç¨‹</p><p>å…±äº«è¿›ç¨‹çš„æ‰€æœ‰èµ„æº åœ°å€ç©ºé—´ã€å…¨å±€å˜é‡ã€æ–‡ä»¶æº</p><h3 id="ç£ç›˜"><a href="#ç£ç›˜" class="headerlink" title="ç£ç›˜"></a>ç£ç›˜</h3><p>æ–‡ä»¶</p><p>æ–‡ä»¶å­˜æ”¾</p><p>â€‹    ç´¢å¼•</p><p>â€‹    é—´æ¥å—</p><p>â€‹    æ—¥å¿—æ–‡ä»¶ç³»ç»Ÿ é˜²æ­¢ç³»ç»Ÿå¥”æºƒ</p><p>ç®¡ç†ç©ºé—²å—</p><p>â€‹    ä½å›¾</p><p>æ–‡ä»¶ç³»ç»Ÿ</p><h3 id="æ•°æ®åº“"><a href="#æ•°æ®åº“" class="headerlink" title="æ•°æ®åº“"></a>æ•°æ®åº“</h3><p>é€»è¾‘å±‚ (æŸ¥è¯¢è¯­å¥è§£æã€æŸ¥è¯¢æ‰§è¡Œå¼•æ“ã€ç¼“å†²åŒºç®¡ç†ã€æˆæƒç®¡ç†ã€äº‹åŠ¡ç®¡ç†)-&gt;æ–‡ä»¶çš„å°è£…</p><h3 id="socket"><a href="#socket" class="headerlink" title="socket"></a>socket</h3><p>SocketæŠ½è±¡å±‚ å°è£… TCP UDPå’Œç”¨æˆ·çº¿ç¨‹ç›´æ¥çš„è¿æ¥</p><h3 id="ç¼–è¯‘"><a href="#ç¼–è¯‘" class="headerlink" title="ç¼–è¯‘"></a>ç¼–è¯‘</h3><p>æºç¨‹åº-&gt;è¯æ³•åˆ†æ-&gt;è¯­æ³•åˆ†æ-&gt;è¯­ä¹‰åˆ†æ-&gt;ä¸­é—´ä»£ç ç”Ÿæˆ-&gt;ä»£ç ä¼˜åŒ–-&gt;ä»£ç ç”Ÿæˆ-&gt;ç›®æ ‡ç¨‹åº</p><p>å¯¹äºŒè¿›åˆ¶ä¹¦çš„æ‰€æœ‰ä½å–å,ç„¶ååŠ ä¸€ è¡¥ç </p><p>åœ¨è®¡ç®—æœºå†…éƒ¨,æ˜¯ä½¿ç”¨è¡¥ç æ¥è¡¨ç¤ºäºŒè¿›åˆ¶çš„.å¦‚æœæ˜¯ä¸€ä¸ªæ­£æ•°,è¡¥ç å°±æ˜¯å®ƒæœ¬èº«</p><p>å¦‚æœæ˜¯ä¸€ä¸ªé™„å±,åˆ™éœ€è¦æŠŠé™¤ç¬¦å·ä½ä¹‹å¤–çš„äºŒè¿›åˆ¶æ•°æ‰§è¡Œå–ååŠ 1çš„æ“ä½œ</p><h2 id="javaå‘å±•å†å²"><a href="#javaå‘å±•å†å²" class="headerlink" title="javaå‘å±•å†å²"></a>javaå‘å±•å†å²</h2><p>æŒä¹…åŒ–</p><p>â€‹    åºåˆ—åŒ–åˆ°ç£ç›˜</p><p>â€‹    æ•°æ®åº“ JDBCæ¥å£</p><p>â€‹    EJB -&gt;è½»é‡çº§O/Ræ¡†æ¶ Hibernate ã€iBatisã€Sping JdbcTemplate</p><p>â€‹    EJB3.0 </p><p>JDBC </p><p>ç®€å•å·¥å‚</p><p>æ•°æ®é©±åŠ¨</p><p>å·¥å‚æ–¹æ³•</p><p>åˆ†å¸ƒå¼</p><p>JSP</p><p>MVC</p><p>æ¶ˆæ¯é˜Ÿåˆ—JMS</p><p>åŠ¨æ€ä»£ç†</p><p>æ³¨è§£</p><p>æ³›å‹ </p><p>æ—¥å¿—ç³»ç»Ÿ</p><p>â€‹    SLF4J APIæŠ½è±¡å±‚  LogBack</p><p>â€‹    é€‚é…å±‚</p><p>â€‹    Log4jã€JDK logging</p><h2 id="Webå‘å±•å†å²"><a href="#Webå‘å±•å†å²" class="headerlink" title="Webå‘å±•å†å²"></a>Webå‘å±•å†å²</h2><p>webèµ·æº</p><p>https</p><p>â€‹    å¯¹ç§°åŠ å¯† å…¬é’¥</p><p>â€‹    éå¯¹ç§°åŠ å¯† RSA</p><p>â€‹    å¯¹ç§°åŠ å¯†+éå¯¹ç§°åŠ å¯† (æ•ˆç‡ä½)</p><p>â€‹    ä¸­é—´äººåŠ«æŒ</p><p>â€‹    è¯ä¹¦</p><p>æˆæƒ </p><p>â€‹    sso </p><p>â€‹    token</p><p>ä»SOAåˆ°å¾®æœåŠ¡</p><p>HTTP Server</p><p>1.0</p><p>2.0 å¤šè¿›ç¨‹</p><p>3.0 selectæ¨¡å‹</p><p>4.0 epollæ¨¡å‹</p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>è™½ç„¶è¦†ç›–çš„çŸ¥è¯†å¾ˆå¹¿,ä½†å…¶å®è¿™äº›çŸ¥è¯†ç‚¹æ¯”è¾ƒé›¶æ•£,è€Œä¸”éƒ½æ¯”è¾ƒæµ…æ˜¾,éƒ½éœ€è¦æ·±å…¥äº†è§£,åªèƒ½è¯´é€‚åˆä½œä¸ºä¸€æœ¬å…¥é—¨ä¹¦ç± æˆ–è€…çŸ¥è¯†å¤§çº²ç”¨æ¥æŸ¥æ¼è¡¥ç¼º</p><h2 id="æŠ€æœ¯æ„Ÿæ‚Ÿ"><a href="#æŠ€æœ¯æ„Ÿæ‚Ÿ" class="headerlink" title="æŠ€æœ¯æ„Ÿæ‚Ÿ"></a>æŠ€æœ¯æ„Ÿæ‚Ÿ</h2><p>æœ€è¿‘æ€è€ƒäº†å¾ˆå¤š,ä¸ºæ€æ•…æˆ‘åœ¨, å¶å°”éœ€è¦ç»™è‡ªå·±ç‚¹ç©ºé—²æ—¶é—´æ€è€ƒ, è‡ªå·±åˆ°åº•æƒ³è¦ä»€ä¹ˆ,è‡ªå·±ç»å†çš„é—®é¢˜æ˜¯ä¸æ˜¯é—®é¢˜ </p><p>å¶ç„¶çœ‹åˆ°ä¸€ç¯‡æ€»ç»“çš„å¾ˆå¥½çš„æ–‡ç« , åˆ†äº«ä¸€ä¸‹</p><p><strong>1. ä¸€ä¸ªäººèµ°å¾—å¿«ï¼Œä¸€ç¾¤äººèµ°å¾—è¿œ</strong></p><p><strong>2. å½“ä½ ä¸èˆ’æœï¼Œéš¾å—æˆ–é™·äºå›°å¢ƒæ—¶ï¼Œåº”è¯¥åœä¸‹æ¥æ€è€ƒ</strong></p><p><strong>3. å­¦ä¹ èƒ½åŠ›ä¸æ€ç»´æ¨¡å¼æ˜¯ä¸€ä¸ªäººçš„æ ¸å¿ƒç«äº‰åŠ›</strong></p><p><strong>3.1 é¦–å…ˆæ‰¿è®¤è‡ªå·±çš„ä¸è¶³</strong></p><p>â€‹    Stay foolish, stay hungry.</p><p>æˆ‘ä»¬è¦æ‰¿è®¤ä¸€ä¸ªåŸºæœ¬çš„é€»è¾‘äº‹å®æ˜¯: ä»»ä½•äº‹æƒ…ä¸æ˜¯å¤©ç”Ÿå°±èƒ½ç²¾é€šï¼Œè¦é€šè¿‡è®­ç»ƒæ‰èƒ½è¾¾åˆ°ä¼˜ç§€çš„ç¨‹åº¦ã€‚å¾ˆå¤šäº‹ç‰©çš„åˆ¤æ–­èƒ½åŠ›ï¼Œè¦æ˜¯é€æ­¥å»ºç«‹çš„ã€‚åªæœ‰æ„è¯†åˆ°è‡ªå·±çš„ä¸è¶³ï¼Œæ‰èƒ½è§‰æ‚Ÿï¼Œå»å­¦ä¹ è¿›æ­¥ã€‚</p><p>ç½‘ä¸Šçœ‹åˆ°ä¸€å¼ å›¾ã€Šhow to draw a horseã€‹æ·±æœ‰æ„Ÿè§¦ï¼š</p><p><img src="http://ww4.sinaimg.cn/large/006tNc79gy1g4v6w94j6kj30u017mwh8.jpg" alt="image-20190711000446974"></p><p>è¿™ä¸ªæ¼«ç”»æ˜¾ç¤ºçš„å“²ç†ï¼šæœ‰æ—¶æœ€åä¸€æ­¥ï¼Œä½ è¦ä»˜å‡ºéå¸¸å¤šçš„åŠªåŠ›ã€‚ä»»ä½•é«˜æ°´å¹³çš„æŠ€æœ¯æˆ–æ€ç»´æ¨¡å¼ï¼Œéƒ½éœ€è¦ä»˜å‡ºåŠªåŠ›ï¼Œå¹¶éç”Ÿè€Œå¾—æ¥ã€‚</p><p><strong>3.2 æŒæ¡ä¼˜ç§€çš„å­¦ä¹ æ–¹æ³•ï¼š</strong></p><p>å¦‚ä½•è¯æ˜ä¸€ä¸ªäººæœ‰æ¯”è¾ƒä¼˜ç§€çš„å­¦ä¹ èƒ½åŠ›ï¼Ÿå­¦ä¹ åšåˆ°ç›®åˆ°ï¼Œå£åˆ°ï¼Œå¿ƒåˆ°ã€‚</p><p><strong>3.3 æŒæ¡æœç´¢ä¿¡æ¯çš„æœ‰æ•ˆæ–¹å¼</strong></p><p>å¦‚ä½•æå‡è·å–çš„ä¿¡æ¯è´¨é‡ï¼Œè¿™é‡Œæœ‰ä¸€äº›å»ºè®®ï¼š</p><ul><li><p>ç²¾ç¡®å®šä½é—®é¢˜</p></li><li><p>æ¢³ç†å‡ºå…³é”®å­—ä¸æ¦‚å¿µ</p></li><li><p>â€œå…¨ç½‘â€æœç´¢</p></li><li><p>åˆ†æç ”ç©¶</p></li><li><p>å®è·µ&amp;ç»“è®º&amp;å‡è®¾</p></li></ul><p><strong>3.4 å…·å¤‡ä¼˜ç§€çš„æ‰¹åˆ¤æ€§æ€ç»´æ¨¡å‹</strong></p><p>åœ¨ã€Šæ‰¹åˆ¤æ€§æ€ç»´å·¥å…·ã€‹ä¸€ä¹¦ä¸­ï¼Œå¯¹æ€ç»´çš„æ°´å¹³åˆ†äº†ä¸‰ä¸ªå±‚æ¬¡ï¼šè¾ƒå·®ã€ä¸­ç­‰ã€æœ€ä½³æ°´å¹³çš„æ€è€ƒï¼ˆå¦‚ä¸‹å›¾1ï¼‰ã€‚å½“å‰å¾ˆå¤šåŒå­¦å¯èƒ½åœ¨å¤šæ•°é—®é¢˜ä¸Šéƒ½å¤„äºè¾ƒå·®æ°´å¹³å±‚æ¬¡ï¼Œå¾ˆå¤šè®¤çŸ¥æ¥è‡ªç›´è§‰æˆ–è€…è‡ªæˆ‘è§†è§’ã€‚æœ€ä½³æ°´å¹³çš„æ€è€ƒè¦åšåˆ°ä¸‰ç‚¹ï¼šå…¨å±€ã€å…¬æ­£ã€å®¢è§‚ã€‚</p><p>æ–‡ç« æ¥æº:<a href="https://mp.weixin.qq.com/s/LxW4j7JOOrEGYWylP2j9Mg" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/LxW4j7JOOrEGYWylP2j9Mg</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> note </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JDK_ClassLoader</title>
      <link href="/2019/07/06/JDK-ClassLoader/"/>
      <url>/2019/07/06/JDK-ClassLoader/</url>
      
        <content type="html"><![CDATA[<p><img src="http://ww3.sinaimg.cn/large/006tNc79gy1g4u7huu80gj30x30u0dlq.jpg" alt="image-20190710033943799"></p><p>today weâ€™re  taking about classLoader </p><p>topic</p><ul><li>what is classLoader</li><li>parent classLoader</li><li>why need three classLoader</li><li>source of classLoader</li><li>more details</li></ul><p>â€‹    ok, letâ€˜s go</p><a id="more"></a><h2 id="what-is-classLoader"><a href="#what-is-classLoader" class="headerlink" title="what is classLoader"></a>what is classLoader</h2><p>é¦–å…ˆ ,ä»€ä¹ˆæ˜¯classLoader ,é¦–å…ˆçœ‹ä¸‹å®˜æ–¹è§£é‡Š</p><pre><code>A class loader is an object that is responsible for loading classes. The class ClassLoader is an abstract class. Given the binary name of a class, a class loader should attempt to locate or generate data that constitutes a definition for the class. A typical strategy is to transform the name into a file name and then read a &quot;class file&quot; of that name from a file system.</code></pre><p>ç®€å•æ¥è¯´å°±æ˜¯ç±»åŠ è½½å™¨, è´Ÿè´£æŠŠclass æ–‡ä»¶ åŠ è½½åˆ°è™šæ‹Ÿæœº(å°†classæ–‡ä»¶ä»ç¡¬ç›˜åŠ è½½åˆ°å†…å­˜çš„ä¸€ä¸ªè¿‡ç¨‹) </p><p>æ€è€ƒä¸‹, åŠ è½½æŸä¸ªclasséœ€è¦className , æ¥ä¸‹æ¥é€šè¿‡è¿™ä¸ªclassNameå»å“ªé‡ŒæŸ¥æ‰¾,æ€ä¹ˆæŸ¥æ‰¾</p><pre><code>Normally, the Java virtual machine loads classes from the local file system in a platform-dependent manner. For example, on UNIX systems, the virtual machine loads classes from the directory defined by the CLASSPATH environment variable.However, some classes may not originate from a file; they may originate from other sources, such as the network, or they could be constructed by an application. </code></pre><p>é€šå¸¸, è™šæ‹Ÿæœºæ‰€åŠ è½½çš„ç±»æ¥è‡ªæ–‡ä»¶ç³»ç»Ÿ,é€šè¿‡CLASSPATH æŒ‡å®šè·¯å¾„, å½“ç„¶ä¹Ÿå¯ä»¥æ¥è‡ªç½‘ç»œä¼ è¾“(é€šè¿‡URLæŠ½è±¡å‡ºè¿™äº›resource)</p><h2 id="parent-classLoader"><a href="#parent-classLoader" class="headerlink" title="parent classLoader"></a>parent classLoader</h2><p>parent classLoader, é€šå¸¸è¢«ç§°ä¸ºâ€œåŒäº²å§”æ´¾â€ , ä¸€ç›´è§‰å¾—è¿™ä¸ªç¿»è¯‘æœ‰ç‚¹é—®é¢˜ , åŒäº² , å…¶å®åªæœ‰ä¸€ä¸ªparent </p><pre><code>The ClassLoader class uses a delegation model to search for classes and resources. Each instance of ClassLoader has an associated parent class loader. When requested to find a class or resource, a ClassLoader instance will delegate the search for the class or resource to its parent class loader before attempting to find the class or resource itself. The virtual machine&#39;s built-in class loader, called the &quot;bootstrap class loader&quot;, does not itself have a parent but may serve as the parent of a ClassLoader instance.</code></pre><p>ClassLoaderä½¿ç”¨çš„æ˜¯è®¾è®¡æ¨¡å¼ä¸­çš„å§”æ´¾æ¨¡å¼, é€šè¿‡parentå»åŠ è½½,å¦‚æœparentä¸ºç©º,åˆ™ä¾èµ–BootstrapClassLoader, æ³¨æ„è¿™ä¸ªç±»åŠ è½½å™¨æ˜¯è™šæ‹Ÿæœºå®ç°çš„ä¸€éƒ¨åˆ†.è€Œä¸”æˆ‘ä»¬ç¨‹åºä¸­æ˜¯æ— æ³•è·å–åˆ°çš„,ä¾‹å¦‚å¦‚ä¸‹ä»£ç </p><pre><code class="java">public class ClassLoaderDemo {    public static void main(String[] args) {        System.out.println(ClassLoaderDemo.class.getClassLoader());        System.out.println(String.class.getClassLoader());        System.out.println(Integer.class.getClassLoader());    }}</code></pre><p>è¿è¡Œç»“æœå¦‚ä¸‹(åœ¨çœ‹ç»“æœä¹‹å‰,å…ˆæœ‰è‡ªå·±çš„æ€è€ƒ,ä¸åº”è¯¥ä»¥ç»“æœå¯¼å‘ä½œä¸ºæ¨è®º)</p><p><img src="http://ww4.sinaimg.cn/large/006tNc79gy1g4u25hc2arj314g06smxy.jpg" alt="image-20190710003513353"></p><p>è‡³äºä¸ºä»€ä¹ˆ,è®©æˆ‘ä»¬å…ˆæ¥äº†è§£ç±»åŠ è½½çš„å±‚çº§å…³ç³»,é€šå¸¸æˆ‘ä»¬å¸¸è§çš„classLoaderæœ‰å¦‚ä¸‹å‡ ä¸ª</p><ul><li><strong>Bootstrap ClassLoader</strong>ï¼šæœ€é¡¶å±‚çš„åŠ è½½ç±»ï¼Œä¸»è¦åŠ è½½æ ¸å¿ƒç±»åº“ï¼Œ%JRE_HOME%\libä¸‹çš„rt.jarã€resources.jarã€charsets.jarå’Œclassç­‰ï¼›</li><li><strong>Extention ClassLoader</strong>ï¼šæ‰©å±•çš„ç±»åŠ è½½å™¨ï¼ŒåŠ è½½ç›®å½•%JRE_HOME%\lib\extç›®å½•ä¸‹çš„jaråŒ…å’Œclassæ–‡ä»¶ï¼›</li><li><strong>Appclass Loader</strong>ï¼šä¹Ÿç§°ä¸ºSystemAppClassï¼ŒåŠ è½½å½“å‰åº”ç”¨çš„classpathçš„æ‰€æœ‰ç±»ï¼›</li></ul><p>ç±»å…³ç³»å›¾å¦‚ä¸‹</p><p><img src="http://ww4.sinaimg.cn/large/006tNc79gy1g4u14r8zfpj317k0ruq5f.jpg" alt="image-20190709235952338"></p><p>OK,å›åˆ°åˆšåˆšçš„é—®é¢˜,é¦–å…ˆ classLoaderä¹Ÿæ˜¯ä¸€ä¸ªclass ,æ‰€ä»¥æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç»“æœ,æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„ç±»<code>ClassLoaderDemo</code> çš„ç±»åŠ è½½å™¨æ˜¯ <code>sun.misc.Launcher$AppClassLoader@18b4aac2</code>   ($è¡¨ç¤ºå†…éƒ¨ç±»,@è¡¨ç¤ºå¯¹è±¡hashcode,ps:ç±»åç”Ÿæˆè§„åˆ™æˆ‘æ‰¾ä¸åˆ°å“ªé‡Œæœ‰, çœ‹äº†è™šæ‹Ÿæœºè§„èŒƒã€JLSéƒ½æ²¡æœ‰æ‰¾åˆ°,åº”è¯¥æ˜¯ç¼–è¯‘å™¨çš„,è®²é“ç†åº”è¯¥æ˜¯è™šæ‹Ÿæœº)</p><p>ä»ç±»åç§°æˆ‘ä»¬å¯ä»¥çŸ¥é“,  åŠ è½½æˆ‘ä»¬è‡ªå®šä¹‰ç±»çš„ç±»åŠ è½½çš„ä¸€äº›åŸºæœ¬ä¿¡æ¯,é¦–å…ˆå®ƒæ˜¯ <code>sun.misc.Launcher</code>  ç±»çš„ä¸€ä¸ªå†…éƒ¨ç±»<code>AppClassLoader</code>   ,ä¸ºäº†ç†è§£è™šæ‹Ÿæœºçš„å±‚çº§å…³ç³», æˆ‘ä»¬éœ€è¦çŸ¥é“è™šæ‹Ÿæœºçš„å¯åŠ¨è¿‡ç¨‹</p><p>è‡³äºString ã€Integer ä¸ºå•¥è·å–ä¸ºnull, è¿™æ˜¯å› ä¸ºæ˜¯BootStrapåŠ è½½çš„(è‡³äºä¸ºå•¥è·å–ä¸åˆ°,å› ä¸ºåœ¨jdkæ˜¯æ²¡æœ‰è¿™ä¸ªç±»çš„,å®‰å…¨æ€§çš„è€ƒè™‘å§å¯èƒ½)</p><h3 id="è™šæ‹Ÿæœºçš„å¯åŠ¨è¿‡ç¨‹"><a href="#è™šæ‹Ÿæœºçš„å¯åŠ¨è¿‡ç¨‹" class="headerlink" title="è™šæ‹Ÿæœºçš„å¯åŠ¨è¿‡ç¨‹"></a>è™šæ‹Ÿæœºçš„å¯åŠ¨è¿‡ç¨‹</h3><p>è¯¦ç»†å‚è€ƒ <a href="https://www.cnblogs.com/bhlsheji/p/4017816.html" target="_blank" rel="noopener">https://www.cnblogs.com/bhlsheji/p/4017816.html</a></p><p>æˆ–å‚é˜…OpenJDKä¸‹çš„sun.misc.Launcher</p><pre><code class="java">    public Launcher() {        // Create the extension class loader        ClassLoader extcl;        try {            extcl = ExtClassLoader.getExtClassLoader();        } catch (IOException e) {            throw new InternalError(                &quot;Could not create extension class loader&quot;, e);        }        // Now create the class loader to use to launch the application        try {            loader = AppClassLoader.getAppClassLoader(extcl);        } catch (IOException e) {            throw new InternalError(                &quot;Could not create application class loader&quot;, e);        }        // Also set the context class loader for the primordial thread.        Thread.currentThread().setContextClassLoader(loader);        // Finally, install a security manager if requested        String s = System.getProperty(&quot;java.security.manager&quot;);        if (s != null) {            SecurityManager sm = null;            if (&quot;&quot;.equals(s) || &quot;default&quot;.equals(s)) {                sm = new java.lang.SecurityManager();            } else {                try {                    sm = (SecurityManager)loader.loadClass(s).newInstance();                } catch (IllegalAccessException e) {                } catch (InstantiationException e) {                } catch (ClassNotFoundException e) {                } catch (ClassCastException e) {                }            }            if (sm != null) {                System.setSecurityManager(sm);            } else {                throw new InternalError(                    &quot;Could not create SecurityManager: &quot; + s);            }        }    }</code></pre><h3 id="åŒäº²å§”æ´¾çš„å¥½å¤„"><a href="#åŒäº²å§”æ´¾çš„å¥½å¤„" class="headerlink" title="åŒäº²å§”æ´¾çš„å¥½å¤„"></a>åŒäº²å§”æ´¾çš„å¥½å¤„</h3><p><strong>å¯¹äºä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½éœ€è¦ç”±åŠ è½½å®ƒçš„ç±»åŠ è½½å™¨å’Œè¿™ä¸ªç±»æœ¬èº«ä¸€åŒç¡®ç«‹å…¶åœ¨è™šæ‹Ÿæœºä¸­çš„å”¯ä¸€æ€§</strong>ï¼Œæ¯ä¸€ä¸ªç±»åŠ è½½å™¨ï¼Œéƒ½æ‹¥æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ç±»åç§°ç©ºé—´ã€‚å› æ­¤ï¼Œä½¿ç”¨åŒäº²å§”æ´¾æ¨¡å‹æ¥ç»„ç»‡ç±»åŠ è½½å™¨ä¹‹é—´çš„å…³ç³»ï¼Œæœ‰ä¸€ä¸ªæ˜¾è€Œæ˜“è§çš„å¥½å¤„ï¼š<strong>ç±»éšç€å®ƒçš„ç±»åŠ è½½å™¨ä¸€èµ·å…·å¤‡äº†ä¸€ç§å¸¦æœ‰ä¼˜å…ˆçº§çš„å±‚æ¬¡å…³ç³»</strong>ã€‚</p><p>ä¾‹å¦‚ç±»<code>java.lang.Object</code>ï¼Œå®ƒç”±å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½ã€‚åŒäº²å§”æ´¾æ¨¡å‹ä¿è¯ä»»ä½•ç±»åŠ è½½å™¨æ”¶åˆ°çš„å¯¹<code>java.lang.Object</code>çš„åŠ è½½è¯·æ±‚ï¼Œæœ€ç»ˆéƒ½æ˜¯å§”æ´¾ç»™å¤„äºæ¨¡å‹æœ€é¡¶ç«¯çš„å¯åŠ¨ç±»åŠ è½½å™¨è¿›è¡ŒåŠ è½½ï¼Œå› æ­¤<strong>Objectç±»åœ¨ç¨‹åºçš„å„ç§ç±»åŠ è½½å™¨ç¯å¢ƒä¸­éƒ½æ˜¯åŒä¸€ä¸ªç±»</strong>ã€‚</p><p>ç›¸åï¼Œå¦‚æœæ²¡æœ‰ä½¿ç”¨åŒäº²å§”æ´¾æ¨¡å‹ï¼Œç”±å„ä¸ªç±»åŠ è½½å™¨è‡ªè¡Œå»åŠ è½½çš„è¯ï¼Œå¦‚æœç”¨æˆ·è‡ªå·±ç¼–å†™äº†ä¸€ä¸ªç§°ä¸ºjava.lang.Objectçš„ç±»ï¼Œå¹¶ç”¨è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨åŠ è½½ï¼Œé‚£ç³»ç»Ÿä¸­å°†ä¼šå‡ºç°å¤šä¸ªä¸åŒçš„Objectç±»ï¼ŒJavaç±»å‹ä½“ç³»ä¸­æœ€åŸºç¡€çš„è¡Œä¸ºä¹Ÿå°±æ— æ³•ä¿è¯ï¼Œåº”ç”¨ç¨‹åºä¹Ÿå°†ä¼šå˜å¾—ä¸€ç‰‡æ··ä¹±ã€‚</p><p>æ—¢ç„¶è¿™æ ·æ˜¯ä¸æ˜¯åªè¦ä¸€ä¸ªclassLoderå°±ä¸ä¼šæœ‰ä¸Šè¿°çš„é—®é¢˜äº†?</p><h2 id="why-need-three-classLoader"><a href="#why-need-three-classLoader" class="headerlink" title="why need three classLoader"></a>why need three classLoader</h2><p>Javaä¸­æœ‰ä¸‰ç§åŸºç¡€çš„ç±»åŠ è½½å™¨ BootStrap, Extension and System<br>ä»–ä»¬éƒ½æœ‰ä¸€ä¸ªèŒèƒ½ï¼Œå°±æ˜¯ä»ä¸åŒçš„åŒ…ä¸­åŠ è½½ç±»ã€‚<br>ä½†æ˜¯ä¸€ä¸ªç±»åŠ è½½å™¨å®Œå…¨å¯ä»¥åŠ è½½æ‰€æœ‰çš„ç±»ï¼Œä¸ºä»€ä¹ˆè¦æœ‰3ç§åŸºç¡€çš„ç±»å‹çš„ç±»åŠ è½½å™¨å‘¢ï¼Ÿ</p><p>Javaä¸­æœ‰ä¸‰ç§åŸºç¡€çš„ç±»åŠ è½½å™¨ä¸»è¦ä¸ºäº†å®‰å…¨ã€‚(å¦ä¸€ä¸ªæ˜¯ä¸ºäº†æ‰©å±•,æ‰€æœ‰åº”ç”¨éƒ½éœ€è¦ç”¨åŒä¸€ä¸ªjar)<br>1.2ç‰ˆæœ¬çš„JVMä¸­ï¼Œåªæœ‰ä¸€ä¸ªç±»åŠ è½½å™¨ï¼Œå°±æ˜¯ç°åœ¨çš„â€œBootstrapâ€ç±»åŠ è½½å™¨ã€‚<br>ç±»åŠ è½½å™¨åŠ è½½ç±»çš„æ–¹å¼æ˜¯ï¼ŒåŠ è½½å™¨å…ˆè°ƒç”¨çˆ¶åŠ è½½å™¨å¯¹ç±»è¿›è¡ŒåŠ è½½ï¼Œå¦‚æœçˆ¶åŠ è½½å™¨æ‰¾ä¸åˆ°è¯¥ç±»ï¼Œæ­¤åŠ è½½å™¨æ‰ä¼šå»åŠ è½½è¯¥ç±»ã€‚<br>æœ€å…³é”®çš„æ˜¯ï¼Œ é™¤éæ˜¯åŒä¸€ä¸ªç±»åŠ è½½å™¨åŠ è½½çš„ç±» ï¼Œå¦åˆ™JVMä¸ä¼šä¿è¯åŒ…è®¿é—®çº§åˆ«ï¼ˆå¦‚æœä¸æŒ‡æ˜private/publicæˆ–protectedï¼Œåˆ™æ–¹æ³•å’Œå±æ€§å…·æœ‰åŒ…è®¿é—®çº§åˆ«ï¼‰ã€‚</p><p><img src="http://ww1.sinaimg.cn/large/006tNc79gy1g4u66v1hydj30k0064gly.jpg" alt="img"></p><p>å› æ­¤ï¼Œå‡å¦‚ç”¨æˆ·è°ƒç”¨ä»–ç¼–å†™çš„java.lang.MyClassç±»ã€‚ç†è®ºä¸Šè¯¥ç±»å¯ä»¥è®¿é—®å’Œæ”¹å˜java.langåŒ…ä¸‹å…¶ä»–ç±»çš„é»˜è®¤è®¿é—®ä¿®é¥°ç¬¦çš„å±æ€§å’Œæ–¹æ³•çš„èƒ½åŠ›ã€‚Javaè¯­è¨€æœ¬èº«å¹¶æ²¡æœ‰é˜»æ­¢è¿™ç§è¡Œä¸ºã€‚ä½†æ˜¯JVMåˆ™ä¼šé˜»æ­¢è¿™ç§è¡Œä¸ºï¼Œå› ä¸ºjavaæ ¸å¿ƒç±»åº“çš„java.langåŒ…ä¸‹çš„ç±»æ˜¯ç”±bootstrapç±»åŠ è½½å™¨åŠ è½½çš„ã€‚ä¸æ˜¯åŒä¸€ä¸ªç±»åŠ è½½å™¨åŠ è½½çš„ç±»ç­‰äºä¸å…·æœ‰åŒ…çº§åˆ«çš„è®¿é—®æƒé™ã€‚<br>ç±»åŠ è½½å™¨ä¸­çš„å…¶ä»–å®‰å…¨ç‰¹æ€§ä¹Ÿä¼šé˜»æ­¢è¿™ç§ç±»å‹ä¾µå…¥ã€‚<br>æ‰€ä»¥ä¸ºä»€ä¹ˆæœ‰ä¸‰ç§åŸºç¡€çš„ç±»åŠ è½½å™¨ï¼Ÿæ˜¯å› ä¸ºä»–ä»¬ä»£è¡¨ä¸‰ç§ä¸åŒçš„ä¿¡ä»»çº§åˆ«ã€‚æœ€å¯ä¿¡çš„çº§åˆ«æ˜¯javaæ ¸å¿ƒAPIç±»ã€‚ç„¶åæ˜¯å®‰è£…çš„æ‹“å±•ç±»ï¼Œæœ€åæ‰æ˜¯åœ¨ç±»è·¯å¾„ä¸­çš„ç±»ï¼ˆå±äºä½ æœ¬æœºçš„ç±»ï¼‰ã€‚</p><p><strong>å…¶ä»–è§£é‡Š1</strong><br>ç±»åŠ è½½ä¸»è¦çš„åº”ç”¨åœºæ™¯æ˜¯åœ¨åº”ç”¨æœåŠ¡å™¨ä¸Šã€‚<br>å¦‚æœä½ æƒ³å¯åŠ¨Tomcatã€‚è¿™è‡³å°‘éœ€è¦ä¸€ä¸ªç±»åŠ è½½å™¨æ¥è¿è¡ŒTomcatè‡ªå·±ã€‚<br>ç„¶åä½ æƒ³åœ¨Tomcatå®¹å™¨ä¸­éƒ¨ç½²é¡¹ç›®ã€‚å› æ­¤Tomcatéœ€è¦åŠ è½½å’Œåˆ†æç”šè‡³åœ¨Tomcatå¯åŠ¨å‰éƒ½ä¸å­˜åœ¨çš„ç±»ã€‚<br>ç„¶åä½ åˆæƒ³åœ¨Tomcatä¸­éƒ¨ç½²å¦å¤–ä¸€ä¸ªåº”ç”¨ã€‚ ç¬¬äºŒä¸ªåº”ç”¨å¯èƒ½ä¹Ÿä¼šç”¨åˆ°ç¬¬ä¸€ä¸ªåº”ç”¨ä½¿ç”¨çš„åº“ï¼Œä½†æ˜¯ç‰ˆæœ¬ä¸åŒã€‚<br>å› æ­¤ä½ å°±éœ€è¦æ¯ä¸ªåº”éƒ½æœ‰ç›¸äº’éš”ç¦»çš„ç±»åŠ è½½å™¨ï¼Œå¦åˆ™ç¬¬äºŒä¸ªåº”ç”¨çš„ç±»å¯èƒ½ä¼šè¦†ç›–ç¬¬ä¸€ä¸ªåº”ç”¨ä¹‹å‰åŠ è½½çš„ç±»ï¼Œä»è€Œé€ æˆä¸€äº›æ„æƒ³ä¸åˆ°çš„åæœã€‚<br>ç„¶åä½ æƒ³åœæ‰æŸä¸ªwebåº”ç”¨ã€‚è¯¥åº”ç”¨çš„ç±»åŠ è½½å™¨åº”è¯¥ä¼šè¢«é”€æ¯ï¼Œåƒåœ¾ä¹Ÿéšä¹‹è¢«å›æ”¶ï¼Œè¿™æ ·å¯ä»¥é¿å…å†…å­˜æ³„éœ²ã€‚<br>æˆ–è®¸ç±»åŠ è½½å™¨è¿˜æœ‰å…¶ä»–ç”¨é€”ï¼Œä½†è¿™æ˜¯æˆ‘å°è±¡ä¸­æœ€å¸¸è§çš„ç”¨æ³•ã€‚</p><p><strong>å…¶ä»–è§£é‡Š2</strong><br>å¤šç§ç±»åŠ è½½å™¨å¾…åŠå¯ä»¥åŒæ—¶åŠ è½½å¤šä¸ªåº”ç”¨ç¨‹åºï¼ˆä¸€ä¸ªåŠ è½½æœåŠ¡ï¼Œå¦å¤–çš„åŠ è½½å™¨ç”¨æ¥æœåŠ¡å™¨å†…éƒ¨çš„éƒ¨ç½²ï¼‰ã€‚<br>æ¯ç§åŠ è½½å™¨éƒ½æœ‰å¯¹åº”çš„å±‚çº§æ¥åŠ è½½æŸäº›ç‰¹å®šçš„ç±»ï¼Œæ¥ä¿è¯ä»–ä»¬ä¹‹é—´çš„å®‰å…¨æ€§ã€‚</p><p>å‚è€ƒ</p><blockquote><p> <a href="https://zhuanlan.zhihu.com/p/54773662?utm_source=wechat_session&amp;utm_medium=social&amp;utm_oi=557574927448846336" target="_blank" rel="noopener">ä¸ºä»€ä¹ˆJavaä¸­æœ‰ä¸‰ç§åŸºç¡€çš„ç±»åŠ è½½å™¨ï¼Ÿ</a></p><p><a href="https://docs.oracle.com/javase/tutorial/ext/index.html" target="_blank" rel="noopener"> The Extension Mechanism</a> â€” How to make custom APIs available to all applications running on the Java platform.</p></blockquote><h2 id="source-of-classLoader"><a href="#source-of-classLoader" class="headerlink" title="source of classLoader"></a>source of classLoader</h2><h3 id="ClassLoader"><a href="#ClassLoader" class="headerlink" title="ClassLoader"></a>ClassLoader</h3><pre><code class="java">protected Class&lt;?&gt; loadClass(String name, boolean resolve)        throws ClassNotFoundException{    synchronized (getClassLoadingLock(name)) {        // First, check if the class has already been loaded        Class&lt;?&gt; c = findLoadedClass(name);        if (c == null) {            long t0 = System.nanoTime();            try {                if (parent != null) {                    c = parent.loadClass(name, false);                } else {                    c = findBootstrapClassOrNull(name);                }            } catch (ClassNotFoundException e) {                // ClassNotFoundException thrown if class not found                // from the non-null parent class loader            }            if (c == null) {                // If still not found, then invoke findClass in order                // to find the class.                long t1 = System.nanoTime();                c = findClass(name);                // this is the defining class loader; record the stats                sun.misc.PerfCounter.getParentDelegationTime().addTime(t1 - t0);                sun.misc.PerfCounter.getFindClassTime().addElapsedTimeFrom(t1);                sun.misc.PerfCounter.getFindClasses().increment();            }        }        if (resolve) {            resolveClass(c);        }        return c;    }}protected Class&lt;?&gt; findClass(String name) throws ClassNotFoundException {    throw new ClassNotFoundException(name);}protected final Class&lt;?&gt; defineClass(String name, byte[] b, int off, int len,                                     ProtectionDomain protectionDomain)    throws ClassFormatError{    protectionDomain = preDefineClass(name, protectionDomain);    String source = defineClassSourceLocation(protectionDomain);    Class&lt;?&gt; c = defineClass1(name, b, off, len, protectionDomain, source);    postDefineClass(c, protectionDomain);    return c;}</code></pre><p>findClass è§URLClassLoaderå®ç°,æœ€åä¼šè°ƒç”¨defineClass</p><h3 id="URLClassLoder"><a href="#URLClassLoder" class="headerlink" title="URLClassLoder"></a>URLClassLoder</h3><pre><code class="java">protected Class&lt;?&gt; findClass(final String name)    throws ClassNotFoundException{    final Class&lt;?&gt; result;    try {        result = AccessController.doPrivileged(            new PrivilegedExceptionAction&lt;Class&lt;?&gt;&gt;() {                public Class&lt;?&gt; run() throws ClassNotFoundException {                    String path = name.replace(&#39;.&#39;, &#39;/&#39;).concat(&quot;.class&quot;);                    Resource res = ucp.getResource(path, false);                    if (res != null) {                        try {                            return defineClass(name, res);                        } catch (IOException e) {                            throw new ClassNotFoundException(name, e);                        }                    } else {                        return null;                    }                }            }, acc);    } catch (java.security.PrivilegedActionException pae) {        throw (ClassNotFoundException) pae.getException();    }    if (result == null) {        throw new ClassNotFoundException(name);    }    return result;}</code></pre><p>ç±»åŠ è½½çš„è¿‡ç¨‹  åŠ è½½ ã€éªŒè¯ã€ å‡†å¤‡ã€ é“¾æ¥ ã€åˆå§‹åŒ– ã€ä½¿ç”¨ ã€å¸è½½</p><h2 id="more-details"><a href="#more-details" class="headerlink" title="more details"></a>more details</h2><ul><li><p>security(å®‰å…¨)</p><p>  Class loaders may typically be used by security managers to indicate security domains.</p></li><li><p>Parallel(å¹¶å‘)</p><p>Class loaders that support concurrent loading of classes are known as <em>parallel capable</em> class loaders and are required to register themselves at their class initialization time by invoking the<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/ClassLoader.html#registerAsParallelCapable--" target="_blank" rel="noopener"><code>ClassLoader.registerAsParallelCapable</code></a> method. Note that the <code>ClassLoader</code> class is registered as parallel capable by default. However, its subclasses still need to register themselves if they are parallel capable.<br>In environments in which the delegation model is not strictly hierarchical, class loaders need to be parallel capable, otherwise class loading can lead to deadlocks because the loader lock is held for the duration of the class loading process (see <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/ClassLoader.html#loadClass-java.lang.String-" target="_blank" rel="noopener"><code>loadClass</code></a> methods).</p><pre><code class="java">protected Object getClassLoadingLock(String className) {    Object lock = this;    if (parallelLockMap != null) {        Object newLock = new Object();        lock = parallelLockMap.putIfAbsent(className, newLock);        if (lock == null) {            lock = newLock;        }    }    return lock;}</code></pre></li><li><p>ClassNotFoundException and  NoClassDefFoundError(LinkageError)</p></li></ul><p>è¿™ä¸ªè®®é¢˜å¤ªå¤§äº†,æŸ¥é˜…äº†å¥½å¤šèµ„æ–™â€¦</p><p>æ¶‰åŠè™šæ‹Ÿæœºç¼–è¯‘ ã€ç±»æ ¼å¼ã€ç±»åŠ è½½è¿‡ç¨‹ã€è™šæ‹Ÿæœºå¯åŠ¨è¿‡ç¨‹ã€hotspotã€openjdk</p>]]></content>
      
      
      <categories>
          
          <category> jdk </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jdk </tag>
            
            <tag> classLoader </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Overview_Elasticsearch</title>
      <link href="/2019/06/26/Overview_Elasticsearch/"/>
      <url>/2019/06/26/Overview_Elasticsearch/</url>
      
        <content type="html"><![CDATA[<p><img src="http://ww3.sinaimg.cn/large/006tNc79gy1g4eq0uiv34j30sg0sgdlr.jpg" alt="image-20190626181209162"></p><a id="more"></a><p>å›¾å…ˆæ”¾å¥½,å­—æ…¢æ…¢ç </p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><blockquote><p>Elasticsearch is a highly scalable open-source full-text search and analytics engine. It allows you to store, search, and analyze big volumes of data quickly and in near real time. It is generally used as the underlying engine/technology that powers applications that have complex search features and requirements.</p></blockquote><p>â€‹    Elasticsearchæ˜¯ä¸€ä¸ªé«˜åº¦å¯æ‰©å±•çš„å¼€æºå…¨æ–‡æœç´¢å’Œåˆ†æå¼•æ“ã€‚å®ƒå…è®¸æ‚¨å¿«é€Ÿï¼Œè¿‘å®æ—¶åœ°å­˜å‚¨ï¼Œæœç´¢å’Œåˆ†æå¤§é‡æ•°æ®ã€‚å®ƒé€šå¸¸ç”¨ä½œåº•å±‚å¼•æ“/æŠ€æœ¯ï¼Œä¸ºå…·æœ‰å¤æ‚æœç´¢åŠŸèƒ½å’Œè¦æ±‚çš„åº”ç”¨ç¨‹åºæä¾›æ”¯æŒã€‚</p><h3 id="Elastic-Stack"><a href="#Elastic-Stack" class="headerlink" title="Elastic Stack"></a>Elastic Stack</h3><p><img src="http://ww3.sinaimg.cn/large/006tNc79gy1g4fjxdjsklj31kc0u077y.jpg" alt="image-20190627112646014"></p><p>Elastic Stack æ˜¯åŸ ELK Stack åœ¨ 5.0 ç‰ˆæœ¬åŠ å…¥ Beats å¥—ä»¶åçš„æ–°ç§°å‘¼</p><ul><li>Logstashç”¨äºæ•°æ®é‡‡é›† (æ–°å¢è½»é‡çº§Beats)</li><li>Kibanaç”¨äºæ•°æ®å±•ç¤º</li></ul><h3 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h3><ul><li>æ‚¨è¿è¡Œåœ¨çº¿ç½‘ä¸Šå•†åº—ï¼Œå…è®¸æ‚¨çš„å®¢æˆ·æœç´¢æ‚¨é”€å”®çš„äº§å“ã€‚</li><li>æ‚¨è¿è¡Œä»·æ ¼è­¦æŠ¥å¹³å°ï¼Œå…è®¸ç²¾é€šä»·æ ¼çš„å®¢æˆ·æŒ‡å®šä¸€æ¡è§„åˆ™ï¼Œä¾‹å¦‚â€œæˆ‘æœ‰å…´è¶£è´­ä¹°ç‰¹å®šçš„ç”µå­äº§å“ï¼Œå¦‚æœå°å·¥å…·çš„ä»·æ ¼åœ¨ä¸‹ä¸ªæœˆå†…ä»ä»»ä½•ä¾›åº”å•†é™è‡³Xç¾å…ƒä»¥ä¸‹ï¼Œæˆ‘å¸Œæœ›æ”¶åˆ°é€šçŸ¥â€ </li><li>æ‚¨å¸Œæœ›æ”¶é›†æ—¥å¿—æˆ–äº¤æ˜“æ•°æ®ï¼Œå¹¶ä¸”å¸Œæœ›åˆ†æå’ŒæŒ–æ˜æ­¤æ•°æ®ä»¥æŸ¥æ‰¾è¶‹åŠ¿ï¼Œç»Ÿè®¡ä¿¡æ¯ï¼Œæ‘˜è¦æˆ–å¼‚å¸¸ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨Logstashï¼ˆElasticsearch / Logstash / Kibanaå †æ ˆçš„ä¸€éƒ¨åˆ†ï¼‰æ¥æ”¶é›†ï¼Œèšåˆå’Œè§£ææ•°æ®ï¼Œç„¶åè®©Logstashå°†æ­¤æ•°æ®æä¾›ç»™Elasticsearchã€‚</li><li>æ‚¨æœ‰åˆ†æ/å•†ä¸šæ™ºèƒ½éœ€æ±‚ï¼Œå¹¶å¸Œæœ›å¿«é€Ÿè°ƒæŸ¥ï¼Œåˆ†æï¼Œå¯è§†åŒ–å¹¶è¯¢é—®æœ‰å…³å¤§é‡æ•°æ®çš„ç‰¹å®šé—®é¢˜ã€‚ä½¿ç”¨Elasticsearchå­˜å‚¨æ•°æ®ï¼Œç„¶åä½¿ç”¨Kibanaï¼ˆElasticsearch / Logstash / Kibanaå †æ ˆçš„ä¸€éƒ¨åˆ†ï¼‰æ„å»ºè‡ªå®šä¹‰ä»ªè¡¨æ¿ï¼Œä»¥ä¾¿å¯è§†åŒ–æ•°æ®</li></ul><h2 id="ç‰ˆæœ¬ç‰¹å¾"><a href="#ç‰ˆæœ¬ç‰¹å¾" class="headerlink" title="ç‰ˆæœ¬ç‰¹å¾"></a>ç‰ˆæœ¬ç‰¹å¾</h2><p>Shay Banonåœ¨2010å¹´2æœˆå‘å¸ƒäº†Elasticsearchçš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬ã€‚</p><ul><li><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.0/breaking-changes-2.0.html" target="_blank" rel="noopener">2.x</a> (2015)</p><ul><li><strong>doc_values</strong>  æ’åºèšåˆæ”¯æŒ,é»˜è®¤å¼€å¯</li><li><strong>Mapping å˜åŒ–</strong> å­—æ®µåä¸è¦åŒ…å« dot ã€type ä¸é•¿äº255å­—ç¬¦ç­‰</li><li><strong>Filtered Query</strong> deprecated</li></ul></li><li><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/5.0/breaking-changes-5.0.html" target="_blank" rel="noopener">5.x</a> ( 2016) ESå®˜æ–¹åœ¨5.xæ—¶ä»£ç»Ÿä¸€äº† ELKä½“ç³»çš„ç‰ˆæœ¬å·</p><ul><li><p>æ”¯æŒLucene6ç‰ˆæœ¬ï¼Œå…¶ä¸­æœ€é‡è¦çš„ç‰¹æ€§å°±æ˜¯ Dimensional Point Fields, â€œç£ç›˜ç©ºé—´å°‘ä¸€åŠï¼›ç´¢å¼•æ—¶é—´å°‘ä¸€åŠï¼›â€ ï¼ŒMerge æ—¶é—´å’Œ JVM Heap å ç”¨éƒ½ä¼šå‡å°‘ï¼Œç´¢å¼•æœ¬èº«çš„æ€§èƒ½ä¹Ÿæå‡ã€‚</p><p>  â€œæŸ¥è¯¢æ€§èƒ½æå‡25%ï¼›IPV6ä¹Ÿæ”¯æŒäº†</p></li><li><p>ProfileAPIã€ShrinkAPIã€RolloverAPIã€ReindexAPI</p></li><li><p>Search After ,search æ¥å£çš„ä¸€ä¸ªæ–°å®ç°ï¼Œä½¿å¾—ä½ å¯ä»¥æ·±åº¦ç¿»é¡µã€‚è¿™ä¸ªå¼¥è¡¥äº† scroll å’Œ search çš„ä¸è¶³</p></li><li><p>Stringç±»å‹è¢«text/keyword ä¸¤ä¸ªç±»å‹å–ä»£,åˆ†åˆ«ä»£è¡¨åˆ†è¯å’Œéƒ¨åˆ†è¯</p></li><li><p>ç´¢å¼•çº§åˆ«è®¾ç½®ä¸èƒ½å†å†™åˆ°ymlé…ç½®æ–‡ä»¶,éœ€è¦ä¸ºæ¯ä¸ªç´¢å¼•å•ç‹¬è®¾ç½®æˆ–å†™åˆ°æ¨¡æ¿ä¸­</p></li><li><p>TaskManager,é‡å»ºç´¢å¼•ç­‰ä»»åŠ¡è¢«ç®¡ç†,å¯ä»¥è§‚å¯Ÿä»»åŠ¡çŠ¶æ€</p></li></ul></li><li><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.0/breaking-changes-6.0.html" target="_blank" rel="noopener">6.x</a> (2017)</p><ul><li>æ¯ä¸ªç´¢å¼•æ”¯æŒä¸€ä¸ª_type</li><li>é»˜è®¤ç¦ç”¨_allå­—æ®µ</li><li>ä¼˜åŒ–äº†doc_values,å ç”¨ç£ç›˜ç©ºé—´æ›´å°‘,è¯»å†™é€Ÿåº¦æ›´å¿«</li><li>æ¨¡æ¿è§„åˆ™å®šä¹‰æ–¹å¼ç”±templateæ”¹ä¸ºindex_patterns</li><li>å¢åŠ åºåˆ—ID,åŠ å¿«ç´¢å¼•æ¢å¤é€Ÿåº¦</li></ul></li><li><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/breaking-changes-7.0.html" target="_blank" rel="noopener">7.x</a>(2019) </p><ul><li><strong>æŸ¥è¯¢ç›¸å…³æ€§é€Ÿåº¦ä¼˜åŒ–</strong> Weak-ANDç®—æ³•åœ¨Term QueryæŸ¥è¯¢åœºæ™¯æœ‰3700%çš„æ€§èƒ½æå‡ã€‚</li><li>å¼•å…¥æ–°çš„é›†ç¾¤åè°ƒå­ç³»ç»Ÿ</li><li>é»˜è®¤åˆ†ç‰‡æ•°ä¸å†æ˜¯5ï¼Œè€Œæ˜¯1</li><li>å®‰è£…åŒ…è‡ªå¸¦JDKç¯å¢ƒ</li><li>é›†ç¾¤ä¸­é»˜è®¤èŠ‚ç‚¹åå­—ä¸å†éšæœºæä¾›ï¼Œæ”¹ä¸ºè·å–hostname</li><li>mappingä¸queryé˜¶æ®µä¸å†æ”¯æŒå¤štypeæ“ä½œ</li></ul></li></ul><blockquote><p><a href="https://www.elastic.co/cn/downloads/past-releases#elasticsearch" target="_blank" rel="noopener">release note</a></p><p><a href="https://www.elastic.co/cn/about/history-of-elasticsearch#group-3" target="_blank" rel="noopener">history</a></p></blockquote><h2 id="åˆè¯†Elasticsearch"><a href="#åˆè¯†Elasticsearch" class="headerlink" title="åˆè¯†Elasticsearch"></a>åˆè¯†Elasticsearch</h2><p>åŸºäºElasticsearch 6.x</p><h3 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h3><ul><li><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.0/_basic_concepts.html#_near_realtime_nrt" target="_blank" rel="noopener">Near Realtime (NRT)</a></p><p>  Elasticsearch is a near real time search platform. What this means is there is a slight latency (normally one second) from the time you index a document until the time it becomes searchable.</p><p>  Elasticsearchæ˜¯ä¸€ä¸ªè¿‘ä¹å®æ—¶çš„æœç´¢å¹³å°ã€‚è¿™æ„å‘³ç€ä»ç´¢å¼•æ–‡æ¡£åˆ°å¯æœç´¢æ–‡æ¡£çš„æ—¶é—´æœ‰ä¸€ç‚¹å»¶è¿Ÿï¼ˆé€šå¸¸æ˜¯ä¸€ç§’ï¼‰</p></li><li><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.0/_basic_concepts.html#_cluster" target="_blank" rel="noopener">Cluster</a></p><p>  A cluster is a collection of one or more nodes (servers) that together holds your entire data and provides federated indexing and search capabilities across all nodes.</p><p>  é›†ç¾¤æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªèŠ‚ç‚¹ï¼ˆæœåŠ¡å™¨ï¼‰çš„é›†åˆï¼Œå®ƒä»¬å…±åŒä¿å­˜æ‚¨çš„æ•´ä¸ªæ•°æ®ï¼Œå¹¶æä¾›è·¨æ‰€æœ‰èŠ‚ç‚¹çš„è”åˆç´¢å¼•å’Œæœç´¢åŠŸèƒ½</p></li><li><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.0/_basic_concepts.html#_node" target="_blank" rel="noopener">Node</a></p><p>  A node is a single server that is part of your cluster, stores your data, and participates in the clusterâ€™s indexing and search capabilities.</p><p>  èŠ‚ç‚¹æ˜¯ä½œä¸ºç¾¤é›†ä¸€éƒ¨åˆ†çš„å•ä¸ªæœåŠ¡å™¨ï¼Œå­˜å‚¨æ•°æ®å¹¶å‚ä¸ç¾¤é›†çš„ç´¢å¼•å’Œæœç´¢åŠŸèƒ½ã€‚</p></li><li><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.0/_basic_concepts.html#_index" target="_blank" rel="noopener">Index</a></p><p>  An index is a collection of documents that have somewhat similar characteristics</p><p>  ç´¢å¼•æ˜¯å…·æœ‰æŸäº›ç±»ä¼¼ç‰¹å¾çš„æ–‡æ¡£é›†åˆã€‚</p></li><li><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.0/_basic_concepts.html#_type" target="_blank" rel="noopener">Type</a></p><p>  A type used to be a logical category/partition of your index to allow you to store different types of documents in the same index</p><p>  ä¸€ç§ç±»å‹ï¼Œæ›¾ç»æ˜¯ç´¢å¼•çš„é€»è¾‘ç±»åˆ«/åˆ†åŒºï¼Œå…è®¸æ‚¨åœ¨åŒä¸€ç´¢å¼•ä¸­å­˜å‚¨ä¸åŒç±»å‹çš„æ–‡æ¡£. Deprecated in 6.0.0.</p></li><li><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.0/_basic_concepts.html#_document" target="_blank" rel="noopener">Document</a></p><p>  A document is a basic unit of information that can be indexed. This document is expressed in <a href="http://json.org/" target="_blank" rel="noopener">JSON</a> (JavaScript Object Notation) which is a ubiquitous internet data interchange format.Within an index/type, you can store as many documents as you want. Note that although a document physically resides in an index, a document actually must be indexed/assigned to a type inside an index.</p><p>  æ–‡æ¡£æ˜¯å¯ä»¥ç¼–åˆ¶ç´¢å¼•çš„åŸºæœ¬ä¿¡æ¯å•å…ƒã€‚è¯¥æ–‡æ¡£ä»¥JSONï¼ˆJavaScript Object Notationï¼‰è¡¨ç¤ºï¼ŒJSONæ˜¯ä¸€ç§æ™®éå­˜åœ¨çš„äº’è”ç½‘æ•°æ®äº¤æ¢æ ¼å¼ã€‚</p></li><li><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.0/_basic_concepts.html#getting-started-shards-and-replicas" target="_blank" rel="noopener">Shards &amp; Replicas</a></p><ul><li>Sharding is important for two primary reasons:<ul><li>It allows you to horizontally split/scale your content volume</li><li>It allows you to distribute and parallelize operations across shards (potentially on multiple nodes) thus increasing performance/throughput</li></ul></li><li><p>Replication is important for two primary reasons:</p><ul><li>It provides high availability in case a shard/node fails. For this reason, it is important to note that a replica shard is never allocated on the same node as the original/primary shard that it was copied from.</li><li>It allows you to scale out your search volume/throughput since searches can be executed on all replicas in parallel.</li></ul><p>åˆ†ç‰‡: æ°´å¹³æ‰©å±•ã€æé«˜å¹¶å‘åº¦</p><p>å‰¯æœ¬: é«˜å¯ç”¨(å‰¯æœ¬ä¸ä¼šåœ¨åŒä¸ªèŠ‚ç‚¹ä¸Š)ã€æé«˜å¹¶å‘åº¦</p></li></ul></li></ul><pre><code>å…³ç³»å›¾![img](http://ww3.sinaimg.cn/large/006tNc79gy1g4l8acf7qoj30ry07nq47.jpg)</code></pre><blockquote><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.0/_basic_concepts.html" target="_blank" rel="noopener">More details see</a></p></blockquote><h3 id="é›†ç¾¤å¥åº·åº¦"><a href="#é›†ç¾¤å¥åº·åº¦" class="headerlink" title="é›†ç¾¤å¥åº·åº¦"></a>é›†ç¾¤å¥åº·åº¦</h3><ul><li>Green - everything is good (cluster is fully functional)</li><li>Yellow - all data is available but some replicas are not yet allocated (cluster is fully functional)</li><li>Red - some data is not available for whatever reason (cluster is partially functional)</li></ul><h3 id="é›†ç¾¤èŠ‚ç‚¹è§’è‰²"><a href="#é›†ç¾¤èŠ‚ç‚¹è§’è‰²" class="headerlink" title="é›†ç¾¤èŠ‚ç‚¹è§’è‰²"></a>é›†ç¾¤èŠ‚ç‚¹è§’è‰²</h3><ul><li><p>ä¸»èŠ‚ç‚¹(Master node)</p><blockquote><p>The master node is responsible for lightweight cluster-wide actions such as creating or deleting an index, tracking which nodes are part of the cluster, and deciding which shards to allocate to which nodes. It is important for cluster health to have a stable master node.</p><p>Indexing and searching your data is CPU-, memory-, and I/O-intensive work which can put pressure on a nodeâ€™s resources. To ensure that your master node is stable and not under pressure, it is a good idea in a bigger cluster to split the roles between dedicated master-eligible nodes and dedicated data nodes.</p><p>To prevent data loss, it is vital to configure the <code>discovery.zen.minimum_master_nodes</code> setting (which defaults to <code>1</code>) so that each master-eligible node knows the <em>minimum number of master-eligible nodes</em> that must be visible in order to form a cluster.</p><p>This setting should be set to a <em>quorum</em> of master-eligible nodes:</p><pre><code>(master_eligible_nodes / 2) + 1</code></pre></blockquote><p>  è´Ÿè´£é›†ç¾¤å±‚é¢çš„ç›¸å…³æ“ä½œ,ç®¡ç†é›†ç¾¤å˜æ›´.ä¹Ÿå¯ä»¥ä½œä¸ºæ•°æ®èŠ‚ç‚¹,ä½†å°½å¯èƒ½åšå°‘é‡çš„å·¥ä½œ,å°½é‡åˆ†ç¦»ä¸»èŠ‚ç‚¹å’Œæ•°æ®èŠ‚ç‚¹,åŒæ—¶ä¸ºäº†é˜²æ­¢ç½‘ç»œåˆ†åŒºæ—¶å¤šä¸»çš„æƒ…å†µ(è„‘è£‚),éœ€è¦è®¾ç½®æœ‰èµ„æ ¼æˆä¸ºä¸»èŠ‚ç‚¹çš„æ•°é‡.</p></li><li><p>æ•°æ®èŠ‚ç‚¹(Data node)</p><p>  Data nodes hold the shards that contain the documents you have indexed. Data nodes handle data related operations like CRUD, search, and aggregations. These operations are I/O-, memory-, and CPU-intensive. It is important to monitor these resources and to add more data nodes if they are overloaded.</p><p>  è´Ÿè´£ä¿å­˜æ•°æ®ã€æ‰§è¡Œæ•°æ®ç›¸å…³æ“ä½œ:CRUDã€æœç´¢ã€èšåˆç­‰.  </p></li><li><p>é¢„å¤„ç†èŠ‚ç‚¹(Ingest node)</p><p>  Ingest nodes can execute pre-processing pipelines, composed of one or more ingest processors. Depending on the type of operations performed by the ingest processors and the required resources, it may make sense to have dedicated ingest nodes, that will only perform this specific task.</p><p>  5.0å¼•å…¥.é¢„å¤„ç†æ“ä½œå…è®¸åœ¨ç´¢å¼•æ–‡æ¡£ä¹‹å‰,å³å†™å…¥æ•°æ®ä¹‹å‰.é€šè¿‡äº‹å…ˆå®šä¹‰å¥½çš„ä¸€ç³»åˆ—processorså’Œpipeline,å¯¹æ•°æ®è¿›è¡ŒæŸç§è½¬æ¢ã€å¯ŒåŒ–.  æ‹¦æˆªblukå’Œindexè¯·æ±‚</p></li><li><p>åè°ƒèŠ‚ç‚¹(Coordinating node)</p><p>  If you take away the ability to be able to handle master duties, to hold data, and pre-process documents, then you are left with a <em>coordinating</em> node that can only route requests, handle the search reduce phase, and distribute bulk indexing. Essentially, coordinating only nodes behave as smart load balancers.</p><p>  åè°ƒèŠ‚ç‚¹å°†è¯·æ±‚è½¬å‘ç»™ä¿å­˜æ•°æ®çš„èŠ‚ç‚¹,æ¯ä¸ªæ•°æ®èŠ‚ç‚¹åœ¨æœ¬åœ°æ‰§è¡Œè¯·æ±‚,å¹¶å°†ç»“æœè¿”å›åè°ƒèŠ‚ç‚¹.åè°ƒèŠ‚ç‚¹æ”¶é›†å®Œæ•°æ®å,å°†æ¯ä¸ªæ•°æ®èŠ‚ç‚¹çš„ç»“æœåˆå¹¶ä¸ºå•ä¸ªå…¨å±€ç»“æœ.å¯¹ç»“æœæ‰‹æœºå’Œæ’åºçš„è¿‡ç¨‹å¯èƒ½éœ€è¦å¾ˆå¤šCPUå’Œå†…å­˜èµ„æº(åè°ƒèŠ‚ç‚¹è¿‡å¤šä¹Ÿä¼šæˆä¸ºè´Ÿæ‹…,ä¸»èŠ‚ç‚¹å¿…é¡»ç­‰å¾…å„èŠ‚ç‚¹é›†ç¾¤çŠ¶æ€æ›´æ–°)</p></li><li><p>éƒ¨è½èŠ‚ç‚¹(Tribe node)</p><p>  A tribe node, configured via the <code>tribe.*</code> settings, is a special type of coordinating only node that can connect to multiple clusters and perform search and other operations across all connected clusters.</p><p>  å…è®¸éƒ¨è½èŠ‚ç‚¹åœ¨å¤šä¸ªé›†ç¾¤é—´å……å½“è”åˆå®¢æˆ·ç«¯</p></li></ul><p>â€‹    By default a node is a master-eligible node and a data node, plus it can pre-process documents through ingest pipelines. This is very convenient for small clusters but, as the cluster grows, it becomes important to consider separating dedicated master-eligible nodes from dedicated data nodes.</p><pre><code class="yaml">node.master: true node.data: true node.ingest: true search.remote.connect: true </code></pre><blockquote><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.0/modules-node.html" target="_blank" rel="noopener">More details see</a></p></blockquote><h3 id="å†…éƒ¨æ¨¡å—ç®€ä»‹"><a href="#å†…éƒ¨æ¨¡å—ç®€ä»‹" class="headerlink" title="å†…éƒ¨æ¨¡å—ç®€ä»‹"></a>å†…éƒ¨æ¨¡å—ç®€ä»‹</h3><ul><li><p>Cluster</p><p>  Clusteræ¨¡å—æ˜¯ä¸»èŠ‚ç‚¹æ‰§è¡Œé›†ç¾¤ç®¡ç†çš„å°è£…å®ç°,ç®¡ç†é›†ç¾¤çŠ¶æ€,ç»´æŠ¤é›†ç¾¤å±‚é¢çš„é…ç½®ä¿¡æ¯.</p><p>  ä¸»è¦åŠŸèƒ½å¦‚ä¸‹:</p><ul><li>ç®¡ç†é›†ç¾¤çŠ¶æ€</li><li>è°ƒç”¨allocationæ¨¡å—æ‰§è¡Œåˆ†ç‰‡åˆ†é…,å†³ç­–å“ªäº›åˆ†ç‰‡åº”è¯¥åˆ†é…åˆ°å“ªä¸ªèŠ‚ç‚¹</li><li>åœ¨é›†ç¾¤å„èŠ‚ç‚¹ä¸­ç›´æ¥è¿ç§»åˆ†ç‰‡,ä¿æŒæ•°æ®å¹³è¡¡</li></ul></li><li><p>allocation</p><p>  å°è£…äº†åˆ†ç‰‡åˆ†é…ç›¸å…³çš„åŠŸèƒ½å’Œç­–ç•¥,åŒ…æ‹¬ä¸»åˆ†ç‰‡çš„åˆ†é…å’Œå‰¯åˆ†é…çš„åˆ†é…,æœ¬æ¨¡å—ç”±ä¸»èŠ‚ç‚¹è°ƒç”¨.</p><p>  åˆ›å»ºæ–°ç´¢å¼•ã€é›†ç¾¤å®Œå…¨é‡å¯éƒ½éœ€è¦åˆ†ç‰‡åˆ†é…çš„è¿‡ç¨‹.</p></li><li><p>Discovery</p><p>  å‘ç°æ¨¡å—è´Ÿè´£å‘ç°é›†ç¾¤ä¸­çš„èŠ‚ç‚¹,ä»¥åŠé€‰ä¸¾ä¸»èŠ‚ç‚¹.å½“èŠ‚ç‚¹åŠ å…¥æˆ–é€€å‡ºé›†ç¾¤æ—¶,ä¸»èŠ‚ç‚¹å›é‡‡å–ç›¸åº”çš„è¡ŒåŠ¨(ç±»ä¼¼Zookeeper)</p></li><li><p>gateway</p><p>  è´Ÿè´£å¯¹æ”¶åˆ°Masterå¹¿æ’­ä¸‹çœ‹æ¥å¯¹é›†ç¾¤çŠ¶æ€(cluster state)æ•°æ®æŒä¹…åŒ–å­˜å‚¨,å¹¶åœ¨é›†ç¾¤å®Œå…¨é‡å¯æ—¶æ¢å¤å®ƒä»¬</p></li><li><p>indices</p><p>  ç´¢å¼•æ¨¡å—ç®¡ç†å…¨å±€çº§çš„ç´¢å¼•è®¾ç½®,ä¸åŒ…å«ç´¢å¼•çº§çš„(ç´¢å¼•è®¾ç½®åˆ†ä¸ºå…¨å±€çº§å’Œæ¯ä¸ªç´¢å¼•çº§)</p><p>  å®ƒè¿˜å°è£…äº†ç´¢å¼•æ•°æ®æ¢å¤åŠŸèƒ½.é›†ç¾¤å¯åŠ¨é˜¶æ®µéœ€è¦ä¸»åˆ†ç‰‡æ¢å¤å’Œå‰¯åˆ†ç‰‡æ¢å¤å°±æ˜¯åœ¨è¿™ä¸ªæ¨¡å—å®ç°çš„.</p></li><li><p>HTTP</p><p>  å…è®¸é€šè¿‡HTTPçš„æ–¹å¼è®¿é—®ESçš„API,HTTPæ¨¡å—æœ¬è´¨ä¸Šæ˜¯å®Œå…¨å¼‚æ­¥çš„,è§£å†³äº†C10Ké—®é¢˜(10Ké‡çº§çš„å¹¶å‘è¿æ¥),éƒ¨åˆ†åœºæ™¯å¯ä»¥è€ƒè™‘ä½¿ç”¨HTTP keepaliveæå‡æ€§èƒ½</p></li><li><p>Transport</p><p>  ä¼ è¾“æ¨¡å—ç”¨äºé›†ç¾¤å†…èŠ‚ç‚¹ä¹‹é—´çš„å†…éƒ¨é€šä¿¡.ä¼ è¾“æœ¬è´¨ä¹Ÿæ˜¯å®Œå…¨å¼‚æ­¥çš„,ä½¿ç”¨TCPé€šä¿¡,æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¸å…¶ä»–èŠ‚ç‚¹ç»´æŒè‹¥å¹²TCPé•¿è¿æ¥.</p></li><li><p>Engine</p><p>  Engineæ¨¡å—å°è£…äº†å¯¹Luceneçš„æ“ä½œä»¥åŠtranslogçš„è°ƒç”¨,å®ƒæ˜¯å¯¹ä¸€ä¸ªåˆ†ç‰‡è¯»å†™æ“ä½œçš„æœ€ç»ˆæä¾›è€…</p></li></ul><p>Esä½¿ç”¨Guiceæ¡†æ¶(Googleå¼€å‘çš„è½»é‡çº§ä¾èµ–æ³¨å…¥æ¡†æ¶IoC)è¿›è¡Œæ¨¡å—ç”»ç®¡ç†</p><h2 id="é›†ç¾¤å¯åŠ¨æµç¨‹"><a href="#é›†ç¾¤å¯åŠ¨æµç¨‹" class="headerlink" title="é›†ç¾¤å¯åŠ¨æµç¨‹"></a>é›†ç¾¤å¯åŠ¨æµç¨‹</h2><p><img src="http://ww2.sinaimg.cn/large/006tNc79gy1g4ladwvzp1j30dg05w0t6.jpg" alt="img"></p><ul><li><p>é€‰ä¸¾ä¸»èŠ‚ç‚¹</p><p>  â€‹    é€‰ä¸»æ˜¯å¯¹Bullyç®—æ³•çš„æ”¹è¿›ï¼Œä¸»è¦æ€è·¯æ˜¯å¯¹èŠ‚ç‚¹ ID æ’åºï¼Œå–æœ€å¤§å€¼åš masterï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½è¿è¡Œè¿™ä¸ªæµç¨‹ã€‚</p><ul><li>å‚æ•°äººæ•°è¿‡åŠ</li><li>å¾—ç¥¨æ•°è¿‡åŠ</li><li><p>æ¢æµ‹èŠ‚ç‚¹ç¦»å¼€æ—¶,åˆ¤æ–­å½“å‰èŠ‚ç‚¹è¿‡åŠ</p><p>é€‰ä¸¾é›†ç¾¤å…ƒä¿¡æ¯</p><p>è¢«é€‰å‡ºçš„ Master å’Œé›†ç¾¤å…ƒä¿¡æ¯çš„æ–°æ—§ç¨‹åº¦æ²¡æœ‰å…³ç³»ã€‚å› æ­¤ä»–çš„ç¬¬ä¸€ä¸ªä»»åŠ¡æ˜¯é€‰ä¸¾å…ƒä¿¡æ¯ï¼Œ è®©å„èŠ‚ç‚¹æŠŠå…¶å„è‡ªå­˜å‚¨çš„å…ƒä¿¡æ¯å‘è¿‡æ¥ï¼Œæ ¹æ®ç‰ˆæœ¬å·ç¡®å®šæœ€æ–°çš„å…ƒä¿¡æ¯ï¼Œç„¶åæŠŠè¿™ä¸ªä¿¡æ¯å¹¿æ’­ä¸‹å»ï¼Œè¿™æ ·ï¼Œé›†ç¾¤çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½æœ‰äº†æœ€æ–°çš„å…ƒä¿¡æ¯ã€‚</p><p>å…ƒä¿¡æ¯çš„é€‰ä¸¾åŒ…æ‹¬ä¸¤ä¸ªçº§åˆ«çš„ï¼šé›†ç¾¤çº§å’Œç´¢å¼•çº§ã€‚</p></li></ul></li><li><p>allocation è¿‡ç¨‹</p><p>  é€‰ä¸¾ shard çº§å…ƒä¿¡æ¯ï¼Œæ„å»ºè·¯ç”±è¡¨ï¼Œæ˜¯åœ¨ allocation æ¨¡å—å®Œæˆçš„ã€‚åˆå§‹é˜¶æ®µï¼Œæ‰€æœ‰çš„ shard éƒ½å¤„äºUNASSIGNEDçŠ¶æ€ã€‚æ­¤æ—¶ï¼Œé¦–å…ˆè¦åšçš„æ˜¯åˆ†é…ä¸»åˆ†ç‰‡ã€‚</p></li><li><p>index recovery</p><ul><li><p>ä¸»åˆ†ç‰‡ recovery</p><p>  å¯¹äºä¸»åˆ†ç‰‡æ¥è¯´ï¼Œè¿™äº›æœªåˆ·ç›˜æ•°æ®å¯ä»¥ä» translog æ¢å¤ï¼Œæ¯æ¬¡åˆ·ç›˜å®Œæ¯•ï¼Œtranslog éƒ½ä¼šè¢«æ¸…ç©ºï¼Œå› æ­¤æŠŠ translog ä¸­çš„æ•°æ®å…¨éƒ¨é‡æ”¾ï¼Œå»ºç«‹ lucene ç´¢å¼•ï¼Œå¦‚æ­¤å®Œæˆä¸»åˆ†ç‰‡çš„ recoveryã€‚</p></li><li><p>å‰¯åˆ†ç‰‡ recovery</p><p>  å‰¯åˆ†ç‰‡éœ€è¦æ¢å¤æˆä¸ä¸»åˆ†ç‰‡ä¸€è‡´ï¼ŒåŒæ—¶ï¼Œæ¢å¤æœŸé—´å…è®¸æ–°çš„ç´¢å¼•æ“ä½œã€‚å› æ­¤åœ¨ä¸»åˆ†ç‰‡æ‰€åœ¨èŠ‚ç‚¹ï¼Œè°ƒç”¨ lucene æ¥å£æŠŠ shard åšå¿«ç…§ã€‚æ¢å¤è¿›å…¥ï¼š</p><ul><li>ç¬¬ä¸€é˜¶æ®µï¼šæŠŠ shard æ•°æ®æ‹·è´åˆ°å‰¯æœ¬èŠ‚ç‚¹ã€‚å¦‚æœä¸»å‰¯ä¸¤ shard æœ‰ç›¸åŒçš„ syncid ä¸” doc æ•°ç›¸åŒï¼Œåˆ™è·³è¿‡è¿™ä¸ªé˜¶æ®µã€‚åœ¨ç¬¬ä¸€é˜¶æ®µå®Œæ¯•å‰ï¼Œä¼šå‘å‰¯åˆ†ç‰‡é˜¶æ®µå‘é€å‘ŠçŸ¥å¯¹æ–¹å¯åŠ¨ engineï¼Œ<strong>åœ¨ç¬¬äºŒé˜¶æ®µå¼€å§‹ä¹‹å‰ï¼Œå‰¯åˆ†ç‰‡å°±å¯ä»¥æ­£å¸¸å¤„ç†å†™è¯·æ±‚äº†</strong>ã€‚</li><li>ç¬¬äºŒé˜¶æ®µï¼šå¯¹ translog åšå¿«ç…§ï¼Œè¿™ä¸ªå¿«ç…§é‡ŒåŒ…å«ä»ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å¼€å§‹çš„æ–°å¢ç´¢å¼•.</li></ul></li></ul></li></ul><p><img src="http://ww1.sinaimg.cn/large/006tNc79gy1g4laj0gvvxj30hq0wlwih.jpg" alt="img"></p><blockquote><p><a href="https://www.easyice.cn/archives/261" target="_blank" rel="noopener">More details see</a></p></blockquote><h2 id="å†™æµç¨‹"><a href="#å†™æµç¨‹" class="headerlink" title="å†™æµç¨‹"></a>å†™æµç¨‹</h2><h3 id="åŸºæœ¬æµç¨‹"><a href="#åŸºæœ¬æµç¨‹" class="headerlink" title="åŸºæœ¬æµç¨‹"></a>åŸºæœ¬æµç¨‹</h3><p><em>æ–°å»ºã€ç´¢å¼•å’Œåˆ é™¤ è¯·æ±‚éƒ½æ˜¯ å†™ æ“ä½œï¼Œ å¿…é¡»åœ¨ä¸»åˆ†ç‰‡ä¸Šé¢å®Œæˆä¹‹åæ‰èƒ½è¢«å¤åˆ¶åˆ°ç›¸å…³çš„å‰¯æœ¬</em></p><p><img src="http://ww4.sinaimg.cn/large/006tNc79gy1g4koc1e4jej30ku09dt91.jpg" alt="img"></p><h3 id="è¯¦ç»†æµç¨‹"><a href="#è¯¦ç»†æµç¨‹" class="headerlink" title="è¯¦ç»†æµç¨‹"></a>è¯¦ç»†æµç¨‹</h3><p><img src="http://ww4.sinaimg.cn/large/006tNc79gy1g4kod03zfbj318n0u0k1z.jpg" alt="img"></p><p><a href="https://www.easyice.cn/archives/180" target="_blank" rel="noopener">More details see</a></p><h2 id="è¯»æµç¨‹"><a href="#è¯»æµç¨‹" class="headerlink" title="è¯»æµç¨‹"></a>è¯»æµç¨‹</h2><h3 id="GETæµç¨‹"><a href="#GETæµç¨‹" class="headerlink" title="GETæµç¨‹"></a>GETæµç¨‹</h3><p><img src="http://ww3.sinaimg.cn/large/006tNc79gy1g4koszf6fyj30rw0aagmk.jpg" alt="img"></p><p>æ•´ä½“åˆ†ä¸ºäº”ä¸ªé˜¶æ®µ:å‡†å¤‡é›†ç¾¤ä¿¡æ¯,å†…å®¹è·¯ç”±,åè°ƒè¯·æ±‚,æ•°æ®è¯»å–,å›å¤å®¢æˆ·ç«¯ã€‚</p><p><img src="http://ww1.sinaimg.cn/large/006tNc79gy1g4kohccg9aj30za0t0dj9.jpg" alt="img"></p><h3 id="Searchæµç¨‹"><a href="#Searchæµç¨‹" class="headerlink" title="Searchæµç¨‹"></a>Searchæµç¨‹</h3><h4 id="ç´¢å¼•å’Œæœç´¢"><a href="#ç´¢å¼•å’Œæœç´¢" class="headerlink" title="ç´¢å¼•å’Œæœç´¢"></a>ç´¢å¼•å’Œæœç´¢</h4><p>ESä¸­çš„æ•°æ®å¯ä»¥åˆ†æˆä¸¤ç±» : ç²¾ç¡®å€¼å’Œå…¨æ–‡(mappingä¸­æŒ‡å®šç±»å‹)</p><ul><li>ç²¾ç¡®å€¼ , æ—¥æœŸå’Œç”¨æˆ·idã€IPåœ°å€ç­‰</li><li>å…¨æ–‡ , æŒ‡æ–‡æœ¬å†…å®¹,æ—¥å¿—æˆ–é‚®ä»¶å†…å®¹  (ä¼šç»è¿‡åˆ†æå™¨ , å­—ç¬¦è¿‡æ»¤å™¨ã€åˆ†è¯å™¨Tokenizerã€Tonkenè¿‡æ»¤å™¨ã€è¯­è¨€å¤„ç†, ç”Ÿæˆè¯Term ,ç”Ÿæˆå€’æ’å’Œæ­£æ’ç´¢å¼•)</li></ul><h4 id="æœç´¢æµç¨‹"><a href="#æœç´¢æµç¨‹" class="headerlink" title="æœç´¢æµç¨‹"></a>æœç´¢æµç¨‹</h4><p>å¢åˆ æ”¹æŸ¥æ“ä½œåªå¯¹å•ä¸ªæ–‡æ¡£è¿›è¡Œå¤„ç†,é€šå¸¸ç”± _index, _type, å’Œ _idä¸‰å…ƒç»„æ¥ç¡®å®šå”¯ä¸€æ–‡æ¡£ã€‚ä½†æœç´¢éœ€è¦ä¸€ç§æ›´å¤æ‚çš„æ¨¡å‹ï¼Œå› ä¸ºä¸çŸ¥é“æŸ¥è¯¢ä¼šå‘½ä¸­å“ªäº›æ–‡æ¡£ã€‚ä¸€ä¸ªæœç´¢è¯·æ±‚å¿…é¡»è¯¢é—®æŒ‡å®šç´¢å¼•çš„<strong>æ‰€æœ‰åˆ†ç‰‡ä¸­çš„æŸä¸ªå‰¯æœ¬</strong>æ¥è¿›è¡ŒåŒ¹é…ã€‚å‡è®¾ä¸€ä¸ªç´¢å¼•æœ‰5ä¸ªä¸»åˆ†ç‰‡ï¼Œ1ä¸ªå‰¯æœ¬åˆ†ç‰‡ï¼Œå…±10ä¸ªåˆ†ç‰‡ï¼Œä¸€æ¬¡æœç´¢è¯·æ±‚ä¼šç”±5ä¸ªåˆ†ç‰‡æ¥å…±åŒå®Œæˆï¼Œä»–ä»¬æœ‰å¯èƒ½æ˜¯ä¸»åˆ†ç‰‡ï¼Œä¹Ÿå¯èƒ½æ˜¯å‰¯åˆ†ç‰‡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>ä¸€æ¬¡æœç´¢è¯·æ±‚åªä¼šå‘½ä¸­æ‰€æœ‰å‰¯æœ¬ä¸­çš„ä¸€ä¸ª</strong>ã€‚</p><p>æ‰¾åˆ°åŒ¹é…æ–‡æ¡£ä»…ä»…å®Œæˆäº†ä¸€åŠï¼Œå¤šåˆ†ç‰‡ä¸­çš„ç»“æœå¿…é¡»ç»„åˆæˆå•ä¸ªæ’åºåˆ—è¡¨ã€‚é›†ç¾¤çš„ä»»æ„èŠ‚ç‚¹éƒ½å¯ä»¥æ¥å—æœç´¢è¯·æ±‚ï¼Œæ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚çš„èŠ‚ç‚¹æˆä¸ºåè°ƒèŠ‚ç‚¹ï¼Œåœ¨åè°ƒèŠ‚ç‚¹ï¼Œæœç´¢ä»»åŠ¡è¢«æ‰§è¡Œæˆä¸€ä¸ªä¸¤é˜¶æ®µè¿‡ç¨‹ï¼Œç§°ä¹‹ä¸º query then fetch ã€‚ çœŸæ­£æ‰§è¡Œæœç´¢ä»»åŠ¡çš„èŠ‚ç‚¹æš‚ä¸”ç§°ä¸ºæ•°æ®èŠ‚ç‚¹ã€‚</p><p>#### </p><p><img src="http://ww4.sinaimg.cn/large/006tNc79gy1g4koo5tl4tj30fq0lrmzz.jpg" alt="img"></p><h2 id="ç›¸å…³ä¼˜åŒ–"><a href="#ç›¸å…³ä¼˜åŒ–" class="headerlink" title="ç›¸å…³ä¼˜åŒ–"></a>ç›¸å…³ä¼˜åŒ–</h2><h3 id="å†™å…¥é€Ÿåº¦ä¼˜åŒ–"><a href="#å†™å…¥é€Ÿåº¦ä¼˜åŒ–" class="headerlink" title="å†™å…¥é€Ÿåº¦ä¼˜åŒ–"></a>å†™å…¥é€Ÿåº¦ä¼˜åŒ–</h3><p>ç»¼åˆæ¥è¯´æå‡å†™å…¥é€Ÿåº¦ä»ä»¥ä¸‹å‡ æ–¹é¢å…¥æ‰‹:</p><ul><li><p>åŠ å¤§translog flushé—´éš” ,ç›®çš„é™ä½iopsã€writeblock</p><p>  å…è®¸æ¥å—éƒ¨åˆ†æ•°æ®ä¸¢å¤±,å¯ä»¥è°ƒæ•´translogæŒä¹…åŒ–ç­–ç•¥çš„å‘¨æœŸæ€§å’Œå¤§å°(Es2.x å¼€å§‹,é»˜è®¤é…ç½®ä¸ºæ¯æ¬¡è¯·æ±‚éƒ½â€œflushâ€)</p><pre><code class="yaml">  index.translog.durability : async  Index.translog.sync_interval : 5s  Index.translog.flush_threshod_size : 512mb</code></pre></li><li><p>åŠ å¤§index refreshé—´éš”,é™¤äº†é™ä½I/O,æ›´é‡è¦çš„æ˜¯é™ä½äº†segment mergeé¢‘ç‡</p><p>  æ¯æ¬¡ç´¢å¼•refreshä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„Luceneæ®µ,è¿™ä¼šå¯¼è‡´é¢‘ç¹çš„segment merge(I/Oå’Œå†…å­˜å ç”¨éƒ½æ¯”è¾ƒé«˜)è¡Œä¸º</p><pre><code class="yaml">  index.refresh_interval : 1s</code></pre></li><li><p>è°ƒæ•´blukè¯·æ±‚</p><ul><li>bulkçº¿ç¨‹æ± å’Œé˜Ÿåˆ—(å»ºç«‹ç´¢å¼•å±äºè®¡ç®—å¯†é›†å‹)</li><li><p>å¹¶å‘æ‰§è¡Œbulkè¯·æ±‚(ç“¶é¢ˆåœ¨CPU)</p><p>ä¸ºé¿å…ç»™é›†ç¾¤å¸¦æ¥å†…å­˜å‹åŠ›,æ¯ä¸ªè¯·æ±‚æœ€å¥½é¿å…è¶…è¿‡å‡ åå…†å­—èŠ‚</p></li></ul></li><li><p>ä¼˜åŒ–ç£ç›˜é—´çš„ä»»åŠ¡å‡åŒ€æƒ…å†µ,å°†shardå°½é‡å‡åŒ€åˆ†å¸ƒåœ¨ç‰©ç†ä¸»æœºçš„å„ä¸ªç£ç›˜</p><ul><li>ç®€å•è½®è¯¢ : åœ¨ç³»ç»Ÿåˆå§‹åŒ–é˜¶æ®µ,ç®€å•è½®è¯¢çš„æ•ˆæœæ˜¯æœ€å‡åŒ€çš„</li><li>åŸºäºå¯ç”¨ç©ºé—´çš„åŠ¨æ€åŠ æƒè½®è¯¢ : ä»¥å¯ç”¨ç©ºé—´ä½œä¸ºæƒé‡,åœ¨ç£ç›˜ä¹‹é—´åŠ æƒè½®è¯¢</li></ul></li><li><p>ä¼˜åŒ–èŠ‚ç‚¹é—´çš„ä»»åŠ¡åˆ†å¸ƒ,å°†ä»»åŠ¡å°½é‡å‡åŒ€åœ°å‘åˆ°å„èŠ‚ç‚¹</p><p>  æ•°æ®å†™å…¥å®¢æˆ·ç«¯åº”è¯¥æŠŠbulkè¯·æ±‚è½®è¯¢å‘é€åˆ°å„ä¸ªèŠ‚ç‚¹</p></li><li><p>ä¼˜åŒ–Luceneå±‚å»ºç«‹ç´¢å¼•è¿‡ç¨‹,ç›®çš„é™ä½CPUå ç”¨ç‡åŠI/O,ä¾‹å¦‚ç¦ç”¨_allå­—æ®µ</p><ul><li>è‡ªåŠ¨ç”Ÿæˆdoc ID</li><li>è°ƒæ•´å­—æ®µMappings<ul><li>å‡å°‘å­—æ®µæ•°é‡</li><li>å‡å°‘å»ºç«‹ç´¢å¼•çš„å­—æ®µ</li><li>å‡å°‘å­—æ®µå†…å®¹</li><li>ä½¿ç”¨ä¸åŒåˆ†æå™¨(analyzer)</li></ul></li><li>è°ƒæ•´_sourceå­—æ®µ</li><li>ç¦ç”¨_allå­—æ®µ</li><li>å¯¹Analyzedå­—æ®µç¦ç”¨Norms(è¯„åˆ†)</li><li>index_optionsè®¾ç½®</li></ul></li></ul><h3 id="æœç´¢é€Ÿåº¦ä¼˜åŒ–"><a href="#æœç´¢é€Ÿåº¦ä¼˜åŒ–" class="headerlink" title="æœç´¢é€Ÿåº¦ä¼˜åŒ–"></a>æœç´¢é€Ÿåº¦ä¼˜åŒ–</h3><ul><li>ä¸ºæ–‡ä»¶ç³»ç»Ÿcacheé¢„ç•™è¶³å¤Ÿçš„å†…å­˜ (ç¬¬ä¸€æ€§èƒ½å› å­)</li><li>ä½¿ç”¨æ›´å¿«çš„ç¡¬ä»¶</li><li>æœç´¢å°½å¯èƒ½å°‘çš„å­—æ®µ</li><li>é¢„ç´¢å¼•æ•°æ®</li><li>é¢„çƒ­ (å…¨å±€é¢„çƒ­ã€æ–‡ä»¶ç³»ç»Ÿ)</li><li>å‰¯æœ¬(ARS)</li><li>å†·çƒ­åˆ†ç¦»(é€šè¿‡ç´¢å¼•åŒºåˆ†å†·ã€çƒ­æ•°æ®)</li><li>æ¨¡å‹è®¾è®¡(ä»…éœ€è¦ç´¢å¼•çš„å­—æ®µæ”¾åœ¨es,å®Œæ•´æ•°æ®æ”¾åœ¨Hbase)</li><li>åˆ†é¡µä¼˜åŒ–(ä¸å…è®¸æ·±åº¦åˆ†é¡µ,ä½¿ç”¨scroll api)</li></ul><blockquote><p>ç°åœ¨å‡è®¾ä½ æœ‰ä¸€ä¸ª2åˆ†ç‰‡ç´¢å¼•å’Œä¸¤ä¸ªèŠ‚ç‚¹ã€‚åœ¨ä¸€ç§æƒ…å†µä¸‹ï¼Œå‰¯æœ¬çš„æ•°é‡æ˜¯0ï¼Œè¿™æ„å‘³ç€æ¯ä¸ªèŠ‚ç‚¹æ‹¥æœ‰ä¸€ä¸ªåˆ†ç‰‡ã€‚åœ¨ç¬¬äºŒç§æƒ…å†µä¸‹ï¼Œå‰¯æœ¬çš„æ•°é‡æ˜¯1ï¼Œè¿™æ„å‘³ç€æ¯ä¸ªèŠ‚ç‚¹å…·æœ‰ä¸¤ä¸ªåˆ†ç‰‡ã€‚å“ªç§è®¾ç½®åœ¨æœç´¢æ€§èƒ½æ–¹é¢è¡¨ç°æœ€ä½³ï¼Ÿé€šå¸¸ï¼Œæ¯ä¸ªèŠ‚ç‚¹æ€»å…±å…·æœ‰è¾ƒå°‘åˆ†ç‰‡çš„è®¾ç½®å°†è¡¨ç°å¾—æ›´å¥½ã€‚åŸå› æ˜¯å®ƒä¸ºæ¯ä¸ªåˆ†ç‰‡æä¾›äº†æ›´å¤§çš„å¯ç”¨æ–‡ä»¶ç³»ç»Ÿç¼“å­˜ä»½é¢ï¼Œè€Œæ–‡ä»¶ç³»ç»Ÿç¼“å­˜å¯èƒ½æ˜¯Elasticsearchçš„ç¬¬ä¸€æ€§èƒ½å› å­ã€‚åŒæ—¶ï¼Œè¯·æ³¨æ„ï¼Œåœ¨å•èŠ‚ç‚¹å‘ç”Ÿæ•…éšœçš„æƒ…å†µä¸‹ï¼Œæ²¡æœ‰å‰¯æœ¬çš„è®¾ç½®ä¼šå‡ºç°æ•…éšœï¼Œå› æ­¤åœ¨ååé‡å’Œå¯ç”¨æ€§ä¹‹é—´éœ€è¦è¿›è¡Œæƒè¡¡ã€‚</p></blockquote><p>å‚è€ƒ:</p><blockquote><p><a href="https://www.easyice.cn/%e6%89%80%e6%9c%89%e6%96%87%e7%ab%a0" target="_blank" rel="noopener">ELASTICSEARCH æºç è§£æä¸ä¼˜åŒ–å®æˆ˜</a></p><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a></p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> framework </tag>
            
            <tag> elasticsearch </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>J.U.C_ConcurrentHashMap</title>
      <link href="/2019/06/24/J-U-C-ConcurrentHashMap/"/>
      <url>/2019/06/24/J-U-C-ConcurrentHashMap/</url>
      
        <content type="html"><![CDATA[<p><img src="http://ww1.sinaimg.cn/large/006tNc79gy1g4cgatpl82j30qo0k03zd.jpg" alt="img"></p><a id="more"></a><h2 id="preface"><a href="#preface" class="headerlink" title="preface"></a>preface</h2><p>â€‹    åšä¸ºåŠå…¬å®¤çš„æ¸¸æ³³å¥å°†,é±¼æ˜¯ä¸å¯èƒ½ä¸æ‘¸çš„. ä»Šå¤©åœ¨æŸ¥æ‰¾æ¥å£æ–‡æ¡£çš„æ—¶å€™,å‘ç°ä¸€äº›ä¸šåŠ¡,åƒå•†è¯¦ã€ç§’æ€,è¿™äº›æŠ—æµéƒ½æ˜¯ä½¿ç”¨çš„æœ¬åœ°ç¼“å­˜,  ç¬¬äºŒå±‚å†æ˜¯redis. </p><p>â€‹    é‚£ä¹ˆæœ¬åœ°ç¼“å­˜ä¸€èˆ¬ä¼šä½¿ç”¨çš„éƒ½æ˜¯Mapç»“æ„(ä¾‹å¦‚keyä¸ºskuId), ç°åœ¨ä½¿ç”¨æœ€å¤šçš„å°±æ˜¯Guava Cache,  ç„¶è€ŒSpring5å³å°†æ”¾å¼ƒæ‰Guava Cacheä½œä¸ºç¼“å­˜æœºåˆ¶ï¼Œè€Œæ”¹ç”¨Caffeineä½œä¸ºæ–°çš„æœ¬åœ°Cacheçš„ç»„ä»¶.(è‡³äºä¸ºå•¥,ä¸æ˜¯ä¸€ä¸¤å¥èƒ½å¤Ÿè®²æ¸…çš„ ä¸»è¦æ˜¯æ€§èƒ½,å…¶æ¬¡æ˜¯è¯­è¨€æ–¹é¢ å‡½æ•°å¼ç¼–ç¨‹) è¿™äº›å®ç°éƒ½æ˜¯åŸºäºä»Šå¤©è¦è®²çš„CHM</p><p>â€‹    PS:ä»¥ä¸‹å†…å®¹åŸºäºJDK 1.8</p><h2 id="Map-Implementations"><a href="#Map-Implementations" class="headerlink" title="Map Implementations"></a>Map Implementations</h2><p>CHMæ˜¯Map çš„ä¸€ç§å®ç°, è¿™é‡Œå†ç®€å•è¯´è¯´Mapçš„å…¶ä»–å®ç°. Mapçš„å®ç°åˆ†ä¸ºé€šç”¨å®ç°(General-Purpose Map Implementations)ï¼Œä¸“ç”¨å®ç°(Special-Purpose Map Implementations)å’Œå¹¶å‘å®ç°(Concurrent Map Implementations)ã€‚</p><p><a href="https://docs.oracle.com/javase/tutorial/collections/implementations/map.html" target="_blank" rel="noopener">More see here</a>  (Mapæ¥å£åœ¨1.8æœ‰æŒºå¤šæ”¹åŠ¨çš„,ä¾‹å¦‚complete ã€merge)</p><h3 id="General-Purpose-Map-Implementations"><a href="#General-Purpose-Map-Implementations" class="headerlink" title="General-Purpose Map Implementations"></a>General-Purpose Map Implementations</h3><blockquote><p>The three general-purpose <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Map.html" target="_blank" rel="noopener"><code>Map</code></a> implementations are <a href="https://docs.oracle.com/javase/8/docs/api/java/util/HashMap.html" target="_blank" rel="noopener"><code>HashMap</code></a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/util/TreeMap.html" target="_blank" rel="noopener"><code>TreeMap</code></a> and <a href="https://docs.oracle.com/javase/8/docs/api/java/util/LinkedHashMap.html" target="_blank" rel="noopener"><code>LinkedHashMap</code></a>.If you need <code>SortedMap</code> operations or key-ordered <code>Collection</code>-view iteration, use <code>TreeMap</code>; if you want maximum speed and donâ€™t care about iteration order, use <code>HashMap</code>; if you want near-<code>HashMap</code> performance and insertion-order iteration, use <code>LinkedHashMap</code></p></blockquote><p>TreeMap ç”¨äºæ’åº </p><p>LinkedHashMap é¢å¤–ç»´æŠ¤ä¸€ä¸ªé˜Ÿåˆ—, å¯ä»¥ç”¨å®ƒæ¥ç®€å•å®ç°ä¸€ä¸ªLRUç®—æ³•</p><h3 id="Special-Purpose-Map-Implementations"><a href="#Special-Purpose-Map-Implementations" class="headerlink" title="Special-Purpose Map Implementations"></a>Special-Purpose Map Implementations</h3><blockquote><p>There are three special-purpose Map implementations â€” <a href="https://docs.oracle.com/javase/8/docs/api/java/util/EnumMap.html" target="_blank" rel="noopener"><code>EnumMap</code></a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/util/WeakHashMap.html" target="_blank" rel="noopener"><code>WeakHashMap</code></a> and <a href="https://docs.oracle.com/javase/8/docs/api/java/util/IdentityHashMap.html" target="_blank" rel="noopener"><code>IdentityHashMap</code></a>. <code>EnumMap</code>, which is internally implemented as an <code>array</code>, is a high-performance <code>Map</code> implementation for use with enum keys. This implementation combines the richness and safety of the <code>Map</code> interface with a speed approaching that of an array. If you want to map an enum to a value, you should always use an <code>EnumMap</code> in preference to an array.</p><p><code>WeakHashMap</code> is an implementation of the <code>Map</code> interface that stores only weak references to its keys. Storing only weak references allows a key-value pair to be garbage-collected when its key is no longer referenced outside of the <code>WeakHashMap</code>. This class provides the easiest way to harness the power of weak references. It is useful for implementing â€œregistry-likeâ€ data structures, where the utility of an entry vanishes when its key is no longer reachable by any thread.</p><p><code>IdentityHashMap</code> is an identity-based <code>Map</code> implementation based on a hash table. This class is useful for topology-preserving object graph transformations, such as serialization or deep-copying. To perform such transformations, you need to maintain an identity-based â€œnode tableâ€ that keeps track of which objects have already been seen. Identity-based maps are also used to maintain object-to-meta-information mappings in dynamic debuggers and similar systems. Finally, identity-based maps are useful in thwarting â€œspoof attacksâ€ that are a result of intentionally perverse <code>equals</code> methods because <code>IdentityHashMap</code> never invokes the <code>equals</code> method on its keys. An added benefit of this implementation is that it is fast</p></blockquote><p>IdentityHashMap ä¸ç”¨è°ƒç”¨equals ,è€Œæ˜¯ä½¿ç”¨==åˆ¤æ–­</p><h3 id="Concurrent-Map-Implementations"><a href="#Concurrent-Map-Implementations" class="headerlink" title="Concurrent Map Implementations"></a>Concurrent Map Implementations</h3><blockquote><p><code>ConcurrentHashMap</code> is a highly concurrent, high-performance implementation backed up by a hash table. This implementation never blocks when performing retrievals and allows the client to select the concurrency level for updates. It is intended as a drop-in replacement for <code>Hashtable</code>: in addition to implementing <code>ConcurrentMap</code>, it supports all the legacy methods peculiar to <code>Hashtable</code>. Again, if you donâ€™t need the legacy operations, be careful to manipulate it with the <code>ConcurrentMap</code> interface.</p></blockquote><p>â€‹    CHMæ˜¯Hashtableçš„ä»£æ›¿è€…, è‡³äºåŸå› å˜›, å½“ç„¶æ˜¯æ€§èƒ½å•¦. Hashtable çš„å®ç°æ˜¯ç®€å•çš„åœ¨æ–¹æ³•ä¸Šé¢åŠ synchronized ,è¿™æ ·ä¼šå¯¼è‡´é”çš„ç«äº‰å¯¹è±¡æ˜¯å®ä¾‹æœ¬èº«.(å¦‚æœæ˜¯static æ–¹æ³• é”çš„æ˜¯æ•´ä¸ªç±»å¯¹è±¡)</p><h2 id="ConcurrentHashMap"><a href="#ConcurrentHashMap" class="headerlink" title="ConcurrentHashMap"></a>ConcurrentHashMap</h2><p>é€šå¸¸æˆ‘ä»¬åº”è¯¥ç«™åœ¨å®ç°è€…çš„è§’åº¦,è€Œä¸ä»…ä»…æ˜¯ä½¿ç”¨è€…çš„è§’åº¦, é€šè¿‡çŒœæµ‹ä½œè€…çš„æ„å›¾, æ¢ä½æ€è€ƒ,æ¢æˆæˆ‘æ¥å®ç°æˆ‘ä¼šæ€ä¹ˆåš</p><h3 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h3><pre><code class="java">/*     * Overview:     *     * The primary design goal of this hash table is to maintain     * concurrent readability (typically method get(), but also     * iterators and related methods) while minimizing update     * contention. Secondary goals are to keep space consumption about     * the same or better than java.util.HashMap, and to support high     * initial insertion rates on an empty table by many threads.     *     * This map usually acts as a binned (bucketed) hash table.  Each     * key-value mapping is held in a Node.  Most nodes are instances     * of the basic Node class with hash, key, value, and next     * fields. However, various subclasses exist: TreeNodes are     * arranged in balanced trees, not lists.  TreeBins hold the roots     * of sets of TreeNodes. ForwardingNodes are placed at the heads     * of bins during resizing. ReservationNodes are used as     * placeholders while establishing values in computeIfAbsent and     * related methods.  The types TreeBin, ForwardingNode, and     * ReservationNode do not hold normal user keys, values, or     * hashes, and are readily distinguishable during search etc     * because they have negative hash fields and null key and value     * fields. (These special nodes are either uncommon or transient,     * so the impact of carrying around some unused fields is     * insignificant.)     *     * The table is lazily initialized to a power-of-two size upon the     * first insertion.  Each bin in the table normally contains a     * list of Nodes (most often, the list has only zero or one Node).     * Table accesses require volatile/atomic reads, writes, and     * CASes.  Because there is no other way to arrange this without     * adding further indirections, we use intrinsics     * (sun.misc.Unsafe) operations.     *     * We use the top (sign) bit of Node hash fields for control     * purposes -- it is available anyway because of addressing     * constraints.  Nodes with negative hash fields are specially     * handled or ignored in map methods.     *     * Insertion (via put or its variants) of the first node in an     * empty bin is performed by just CASing it to the bin.  This is     * by far the most common case for put operations under most     * key/hash distributions.  Other update operations (insert,     * delete, and replace) require locks.  We do not want to waste     * the space required to associate a distinct lock object with     * each bin, so instead use the first node of a bin list itself as     * a lock. Locking support for these locks relies on builtin     * &quot;synchronized&quot; monitors.     *     * Using the first node of a list as a lock does not by itself     * suffice though: When a node is locked, any update must first     * validate that it is still the first node after locking it, and     * retry if not. Because new nodes are always appended to lists,     * once a node is first in a bin, it remains first until deleted     * or the bin becomes invalidated (upon resizing).     *     * The main disadvantage of per-bin locks is that other update     * operations on other nodes in a bin list protected by the same     * lock can stall, for example when user equals() or mapping     * functions take a long time.  However, statistically, under     * random hash codes, this is not a common problem.  Ideally, the     * frequency of nodes in bins follows a Poisson distribution     * (http://en.wikipedia.org/wiki/Poisson_distribution) with a     * parameter of about 0.5 on average, given the resizing threshold     * of 0.75, although with a large variance because of resizing     * granularity. Ignoring variance, the expected occurrences of     * list size k are (exp(-0.5) * pow(0.5, k) / factorial(k)). The     * first values are:     *     * 0:    0.60653066     * 1:    0.30326533     * 2:    0.07581633     * 3:    0.01263606     * 4:    0.00157952     * 5:    0.00015795     * 6:    0.00001316     * 7:    0.00000094     * 8:    0.00000006     * more: less than 1 in ten million     *     * Lock contention probability for two threads accessing distinct     * elements is roughly 1 / (8 * #elements) under random hashes.     *     * Actual hash code distributions encountered in practice     * sometimes deviate significantly from uniform randomness.  This     * includes the case when N &gt; (1&lt;&lt;30), so some keys MUST collide.     * Similarly for dumb or hostile usages in which multiple keys are     * designed to have identical hash codes or ones that differs only     * in masked-out high bits. So we use a secondary strategy that     * applies when the number of nodes in a bin exceeds a     * threshold. These TreeBins use a balanced tree to hold nodes (a     * specialized form of red-black trees), bounding search time to     * O(log N).  Each search step in a TreeBin is at least twice as     * slow as in a regular list, but given that N cannot exceed     * (1&lt;&lt;64) (before running out of addresses) this bounds search     * steps, lock hold times, etc, to reasonable constants (roughly     * 100 nodes inspected per operation worst case) so long as keys     * are Comparable (which is very common -- String, Long, etc).     * TreeBin nodes (TreeNodes) also maintain the same &quot;next&quot;     * traversal pointers as regular nodes, so can be traversed in     * iterators in the same way.     *     * The table is resized when occupancy exceeds a percentage     * threshold (nominally, 0.75, but see below).  Any thread     * noticing an overfull bin may assist in resizing after the     * initiating thread allocates and sets up the replacement array.     * However, rather than stalling, these other threads may proceed     * with insertions etc.  The use of TreeBins shields us from the     * worst case effects of overfilling while resizes are in     * progress.  Resizing proceeds by transferring bins, one by one,     * from the table to the next table. However, threads claim small     * blocks of indices to transfer (via field transferIndex) before     * doing so, reducing contention.  A generation stamp in field     * sizeCtl ensures that resizings do not overlap. Because we are     * using power-of-two expansion, the elements from each bin must     * either stay at same index, or move with a power of two     * offset. We eliminate unnecessary node creation by catching     * cases where old nodes can be reused because their next fields     * won&#39;t change.  On average, only about one-sixth of them need     * cloning when a table doubles. The nodes they replace will be     * garbage collectable as soon as they are no longer referenced by     * any reader thread that may be in the midst of concurrently     * traversing table.  Upon transfer, the old table bin contains     * only a special forwarding node (with hash field &quot;MOVED&quot;) that     * contains the next table as its key. On encountering a     * forwarding node, access and update operations restart, using     * the new table.     *     * Each bin transfer requires its bin lock, which can stall     * waiting for locks while resizing. However, because other     * threads can join in and help resize rather than contend for     * locks, average aggregate waits become shorter as resizing     * progresses.  The transfer operation must also ensure that all     * accessible bins in both the old and new table are usable by any     * traversal.  This is arranged in part by proceeding from the     * last bin (table.length - 1) up towards the first.  Upon seeing     * a forwarding node, traversals (see class Traverser) arrange to     * move to the new table without revisiting nodes.  To ensure that     * no intervening nodes are skipped even when moved out of order,     * a stack (see class TableStack) is created on first encounter of     * a forwarding node during a traversal, to maintain its place if     * later processing the current table. The need for these     * save/restore mechanics is relatively rare, but when one     * forwarding node is encountered, typically many more will be.     * So Traversers use a simple caching scheme to avoid creating so     * many new TableStack nodes. (Thanks to Peter Levart for     * suggesting use of a stack here.)     *     * The traversal scheme also applies to partial traversals of     * ranges of bins (via an alternate Traverser constructor)     * to support partitioned aggregate operations.  Also, read-only     * operations give up if ever forwarded to a null table, which     * provides support for shutdown-style clearing, which is also not     * currently implemented.     *     * Lazy table initialization minimizes footprint until first use,     * and also avoids resizings when the first operation is from a     * putAll, constructor with map argument, or deserialization.     * These cases attempt to override the initial capacity settings,     * but harmlessly fail to take effect in cases of races.     *     * The element count is maintained using a specialization of     * LongAdder. We need to incorporate a specialization rather than     * just use a LongAdder in order to access implicit     * contention-sensing that leads to creation of multiple     * CounterCells.  The counter mechanics avoid contention on     * updates but can encounter cache thrashing if read too     * frequently during concurrent access. To avoid reading so often,     * resizing under contention is attempted only upon adding to a     * bin already holding two or more nodes. Under uniform hash     * distributions, the probability of this occurring at threshold     * is around 13%, meaning that only about 1 in 8 puts check     * threshold (and after resizing, many fewer do so).     *     * TreeBins use a special form of comparison for search and     * related operations (which is the main reason we cannot use     * existing collections such as TreeMaps). TreeBins contain     * Comparable elements, but may contain others, as well as     * elements that are Comparable but not necessarily Comparable for     * the same T, so we cannot invoke compareTo among them. To handle     * this, the tree is ordered primarily by hash value, then by     * Comparable.compareTo order if applicable.  On lookup at a node,     * if elements are not comparable or compare as 0 then both left     * and right children may need to be searched in the case of tied     * hash values. (This corresponds to the full list search that     * would be necessary if all elements were non-Comparable and had     * tied hashes.) On insertion, to keep a total ordering (or as     * close as is required here) across rebalancings, we compare     * classes and identityHashCodes as tie-breakers. The red-black     * balancing code is updated from pre-jdk-collections     * (http://gee.cs.oswego.edu/dl/classes/collections/RBCell.java)     * based in turn on Cormen, Leiserson, and Rivest &quot;Introduction to     * Algorithms&quot; (CLR).     *     * TreeBins also require an additional locking mechanism.  While     * list traversal is always possible by readers even during     * updates, tree traversal is not, mainly because of tree-rotations     * that may change the root node and/or its linkages.  TreeBins     * include a simple read-write lock mechanism parasitic on the     * main bin-synchronization strategy: Structural adjustments     * associated with an insertion or removal are already bin-locked     * (and so cannot conflict with other writers) but must wait for     * ongoing readers to finish. Since there can be only one such     * waiter, we use a simple scheme using a single &quot;waiter&quot; field to     * block writers.  However, readers need never block.  If the root     * lock is held, they proceed along the slow traversal path (via     * next-pointers) until the lock becomes available or the list is     * exhausted, whichever comes first. These cases are not fast, but     * maximize aggregate expected throughput.     *     * Maintaining API and serialization compatibility with previous     * versions of this class introduces several oddities. Mainly: We     * leave untouched but unused constructor arguments refering to     * concurrencyLevel. We accept a loadFactor constructor argument,     * but apply it only to initial table capacity (which is the only     * time that we can guarantee to honor it.) We also declare an     * unused &quot;Segment&quot; class that is instantiated in minimal form     * only when serializing.     *     * Also, solely for compatibility with previous versions of this     * class, it extends AbstractMap, even though all of its methods     * are overridden, so it is just useless baggage.     *     * This file is organized to make things a little easier to follow     * while reading than they might otherwise: First the main static     * declarations and utilities, then fields, then main public     * methods (with a few factorings of multiple public methods into     * internal ones), then sizing methods, trees, traversers, and     * bulk operations.     */</code></pre><p>ä»¥ä¸Šå†…å®¹æ‘˜è‡ª java.util.concurrent.ConcurrentHashMap çš„Overview éƒ¨åˆ†,ä¸‹é¢æ˜¯åŸºäºè¿™æ®µçš„ä¸€ä¸ªç®€å•ç¿»è¯‘</p><h4 id="Design-golds"><a href="#Design-golds" class="headerlink" title="Design golds"></a>Design golds</h4><ol><li>The primary design goal of this hash table is to maintain concurrent readability (typically method get(), but also iterators and related methods) while minimizing update contention(ç«äº‰). </li><li>Secondary goals are to keep space consumption(æ¶ˆè€—) about the same or better tha java.util.HashMap, and to support high initial insertion rates on an empty table by many threads.</li></ol><h4 id="Node"><a href="#Node" class="headerlink" title="Node"></a>Node</h4><pre><code class="java">/* * This map usually acts as a binned (bucketed) hash table.  Each * key-value mapping is held in a Node.  Most nodes are instances * of the basic Node class with hash, key, value, and next * fields. However, various subclasses exist: TreeNodes are * arranged in balanced trees, not lists.  TreeBins hold the roots * of sets of TreeNodes. ForwardingNodes are placed at the heads * of bins during resizing. ReservationNodes are used as * placeholders while establishing values in computeIfAbsent and * related methods.  The types TreeBin, ForwardingNode, and * ReservationNode do not hold normal user keys, values, or * hashes, and are readily distinguishable during search etc * because they have negative hash fields and null key and value * fields. (These special nodes are either uncommon or transient, * so the impact of carrying around some unused fields is * insignificant.) */</code></pre><p>å…¶åº•å±‚å®ç°å½¢å¼ä¹Ÿæ˜¯bucketæ•°ç»„çš„å½¢å¼ï¼Œä¸”&lt;key, value&gt;å­˜å‚¨åœ¨Nodeä¸­ã€‚Nodeå­˜åœ¨ä»¥ä¸‹å­ç±»ï¼ŒåŒ…æ‹¬TreeBinã€TreeNodeã€ForwardingNodeã€ReservationNodeï¼Œåä¸‰ç§ä¸€èˆ¬æœ‰å…¶ç‰¹æ®Šç”¨é€”ã€‚</p><pre><code class="java">/* * The table is lazily initialized to a power-of-two size upon the * first insertion.  Each bin in the table normally contains a * list of Nodes (most often, the list has only zero or one Node). * Table accesses require volatile/atomic reads, writes, and * CASes.  Because there is no other way to arrange this without * adding further indirections, we use intrinsics * (sun.misc.Unsafe) operations. */</code></pre><p>ConcurrentHashMapä½¿ç”¨å»¶è¿Ÿåˆå§‹åŒ–ç­–ç•¥ï¼Œåœ¨ç¬¬ä¸€æ¬¡insertæ—¶ï¼Œæ‰åˆ†é…ä¸€ä¸ª2^nå¤§å°çš„bucketæ•°ç»„ï¼Œä¸€èˆ¬çš„bucketä¸ºlistå½¢å¼ï¼Œé€šè¿‡Nodeä¸­nextå±æ€§æ¥å®ç°é“¾è¡¨(é€šå¸¸é“¾è¡¨ä¸ºç©ºæˆ–è€…åªæœ‰ä¸€ä¸ª)ã€‚</p><p>é€šè¿‡volatie å’ŒCAS æ¥æ§åˆ¶å…¶åŸå­æ€§,åº•å±‚ä½¿ç”¨çš„æ˜¯sun.misc.Unsafe</p><h4 id="hash-conflict"><a href="#hash-conflict" class="headerlink" title="hash conflict"></a>hash conflict</h4><pre><code class="java">/* * We use the top (sign) bit of Node hash fields for control * purposes -- it is available anyway because of addressing * constraints.  Nodes with negative hash fields are specially * handled or ignored in map methods. */</code></pre><p>ä½¿ç”¨bitçš„é«˜ä½æ¥å­˜å‚¨çš„ç›®çš„æ˜¯ä¸ºäº†å‡å°‘å†²çª</p><pre><code class="java">/* * Insertion (via put or its variants) of the first node in an * empty bin is performed by just CASing it to the bin.  This is * by far the most common case for put operations under most * key/hash distributions.  Other update operations (insert, * delete, and replace) require locks.  We do not want to waste * the space required to associate a distinct lock object with * each bin, so instead use the first node of a bin list itself as * a lock. Locking support for these locks relies on builtin * &quot;synchronized&quot; monitors. * * Using the first node of a list as a lock does not by itself * suffice though: When a node is locked, any update must first * validate that it is still the first node after locking it, and * retry if not. Because new nodes are always appended to lists, * once a node is first in a bin, it remains first until deleted * or the bin becomes invalidated (upon resizing). */</code></pre><p>â€‹    å½“åœ¨ä¸€ä¸ªç©ºbinä¸­insertç¬¬ä¸€ä¸ªnodeæ—¶ï¼Œå…¶ä½¿ç”¨CASæ“ä½œæ¥åŒæ­¥ï¼Œè€Œå¯¹äºå…¶ä»–çš„updateæ“ä½œ(insert,delete, and replace)åˆ™éœ€è¦ä½¿ç”¨é”æ¥åŒæ­¥ã€‚è€Œåœ¨æ¯ä¸€ä¸ªbucketä¸­ï¼Œä¸€èˆ¬ä½¿ç”¨æ­¤binä¸­ç¬¬ä¸€ä¸ªnodeä½œä¸ºè¿™ä¸ªbinçš„é”ï¼Œé”ä½æ•´ä¸ªbucketã€‚ï¼ˆå› ä¸ºæ–°æ”¾å…¥binçš„nodeæ€»ä¼šæ·»åŠ åˆ°listçš„æœ«å°¾ï¼Œæ•…é™¤äº†deleteæ‰ç¬¬ä¸€ä¸ªèŠ‚ç‚¹æˆ–resizeæ•°ç»„ä¹‹å¤–ï¼Œè¿™ä¸ªèŠ‚ç‚¹æ€»æ˜¯æ­¤binçš„ç¬¬ä¸€ä¸ªnodeï¼Œå…·æœ‰ç¨³å®šæ€§ï¼‰ã€‚</p><pre><code class="java">/* * The main disadvantage of per-bin locks is that other update * operations on other nodes in a bin list protected by the same * lock can stall, for example when user equals() or mapping * functions take a long time.  However, statistically, under * random hash codes, this is not a common problem.  Ideally, the * frequency of nodes in bins follows a Poisson distribution * (http://en.wikipedia.org/wiki/Poisson_distribution) with a * parameter of about 0.5 on average, given the resizing threshold * of 0.75, although with a large variance because of resizing * granularity. Ignoring variance, the expected occurrences of * list size k are (exp(-0.5)  * pow(0.5, k) / factorial(k)). The * first values are: * * 0:    0.60653066 * 1:    0.30326533 * 2:    0.07581633 * 3:    0.01263606 * 4:    0.00157952 * 5:    0.00015795 * 6:    0.00001316 * 7:    0.00000094 * 8:    0.00000006 * more: less than 1 in ten million * * Lock contention probability for two threads accessing distinct * elements is roughly 1 / (8  * #elements) under random hashes. */</code></pre><p>â€‹    å½“ä½¿ç”¨é”,é”ä½binèŠ‚ç‚¹çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹çš„æ—¶å€™, æœ€å¤§çš„é—®é¢˜æ˜¯å…¶ä»–è®¿é—®è¿™ä¸ªbinéœ€è¦ç­‰å¾…(ä¾‹å¦‚equals å’Œmapping çš„è¿‡ç¨‹èŠ±è´¹äº†å¾ˆé•¿æ—¶é—´ ) ç„¶è€Œ,  å…¶å®å°±åƒä¸Šé¢æåˆ°è¿‡çš„é€šå¸¸é“¾è¡¨ä¸ºç©ºæˆ–è€…åªæœ‰ä¸€ä¸ª.  å› ä¸ºå†²çªçš„æ¦‚ç‡å¾ˆä½</p><pre><code class="java">/* * Actual hash code distributions encountered in practice * sometimes deviate significantly from uniform randomness.  This * includes the case when N &gt; (1&lt;&lt;30), so some keys MUST collide. * Similarly for dumb or hostile usages in which multiple keys are * designed to have identical hash codes or ones that differs only * in masked-out high bits. So we use a secondary strategy that * applies when the number of nodes in a bin exceeds a * threshold. These TreeBins use a balanced tree to hold nodes (a * specialized form of red-black trees), bounding search time to * O(log N).  Each search step in a TreeBin is at least twice as * slow as in a regular list, but given that N cannot exceed * (1&lt;&lt;64) (before running out of addresses) this bounds search * steps, lock hold times, etc, to reasonable constants (roughly * 100 nodes inspected per operation worst case) so long as keys * are Comparable (which is very common -- String, Long, etc). * TreeBin nodes (TreeNodes) also maintain the same &quot;next&quot; * traversal pointers as regular nodes, so can be traversed in * iterators in the same way. */</code></pre><p>åœ¨å®é™…ä½¿ç”¨ä¸­,å“ˆå¸Œç åˆ†å¸ƒæœ‰æ—¶ä¼šæ˜æ˜¾åç¦»å‡åŒ€éšæœºæ€§ã€‚åƒä¸€äº›é”™è¯¯ä½¿ç”¨,ä½¿ç”¨ç›¸åŒçš„hash codes,æˆ–ä½ä½ä¸åŒä¼šå¯¼è‡´è¯¥é—®é¢˜.ä¸ºäº†è§£å†³è¯¥é—®é¢˜,å¼•å…¥äº†çº¢é»‘æ ‘</p><h4 id="resized"><a href="#resized" class="headerlink" title="resized"></a>resized</h4><pre><code class="java">/* * The table is resized when occupancy exceeds a percentage * threshold (nominally, 0.75, but see below).  Any thread * noticing an overfull bin may assist in resizing after the * initiating thread allocates and sets up the replacement array. * However, rather than stalling, these other threads may proceed * with insertions etc.  The use of TreeBins shields us from the * worst case effects of overfilling while resizes are in * progress.  Resizing proceeds by transferring bins, one by one, * from the table to the next table. However, threads claim small * blocks of indices to transfer (via field transferIndex) before * doing so, reducing contention.  A generation stamp in field * sizeCtl ensures that resizings do not overlap. Because we are * using power-of-two expansion, the elements from each bin must * either stay at same index, or move with a power of two * offset. We eliminate unnecessary node creation by catching * cases where old nodes can be reused because their next fields * won&#39;t change.  On average, only about one-sixth of them need * cloning when a table doubles. The nodes they replace will be * garbage collectable as soon as they are no longer referenced by * any reader thread that may be in the midst of concurrently * traversing table.  Upon transfer, the old table bin contains * only a special forwarding node (with hash field &quot;MOVED&quot;) that * contains the next table as its key. On encountering a * forwarding node, access and update operations restart, using * the new table. */</code></pre><p>é‡æ–°æ‰©å®¹å½“è´Ÿè½½å› å­è¶…è¿‡0.75  , æ‰©å®¹é€šå¸¸æ˜¯power-of-two ,æ¸è¿›å¼çš„æ–¹å¼,å¤šæ¬¡æ‰©å®¹(é€šè¿‡transferIndex)  ,</p><p>ä½¿ç”¨å­—æ®µsizeCtlæ¥ç¡®ä¿ä¸ä¼šé‡å¤æ‰©å®¹. </p><p>è¿™ç§æ‰©å®¹é€šå¸¸æ˜¯ç›¸åŒçš„ç´¢å¼•,æˆ–è€…ç§»åŠ¨power-of-two ä½ç½®(1/6çš„æ¦‚ç‡éœ€è¦cloning) æ—§è¡¨åªåŒ…å«forwarding nodeï¼ˆå…·æœ‰æ•£åˆ—å­—æ®µâ€œMOVEDâ€ï¼‰åšä¸ºæ–°è¡¨çš„key</p><pre><code class="java">/* * Each bin transfer requires its bin lock, which can stall * waiting for locks while resizing. However, because other * threads can join in and help resize rather than contend for * locks, average aggregate waits become shorter as resizing * progresses.  The transfer operation must also ensure that all * accessible bins in both the old and new table are usable by any * traversal.  This is arranged in part by proceeding from the * last bin (table.length - 1) up towards the first.  Upon seeing * a forwarding node, traversals (see class Traverser) arrange to * move to the new table without revisiting nodes.  To ensure that * no intervening nodes are skipped even when moved out of order, * a stack (see class TableStack) is created on first encounter of * a forwarding node during a traversal, to maintain its place if * later processing the current table. The need for these * save/restore mechanics is relatively rare, but when one * forwarding node is encountered, typically many more will be. * So Traversers use a simple caching scheme to avoid creating so * many new TableStack nodes. (Thanks to Peter Levart for * suggesting use of a stack here.) */</code></pre><p>â€‹    è°ƒæ•´å¤§å°æ—¶,æ¯ä¸ªbinç§»åŠ¨çš„æ—¶å€™éƒ½éœ€è¦å¯¹biné”å®šã€‚ä½†æ˜¯ï¼Œå› ä¸ºå…¶ä»–çº¿ç¨‹å¯ä»¥åŠ å…¥å¹¶å¸®åŠ©è°ƒæ•´å¤§å°è€Œä¸æ˜¯äº‰ç”¨é”ï¼Œæ€»è€—æ—¶ä¼šæ›´å¤š(å¤šçº¿ç¨‹å¸®åŠ©æ‰©å®¹)ã€‚æ‰©å®¹æ—¶è¿˜å¿…é¡»ç¡®ä¿æ—§è¡¨å’Œæ–°è¡¨ä¸­çš„æ‰€æœ‰å¯è®¿é—®çš„binéƒ½å¯ä»¥è¢«ä»»ä½•éå†ä½¿ç”¨æ›´å¤šç»†èŠ‚çœ‹<code>TableStack</code>ã€ <code>Traverser</code></p><pre><code class="java">/* * The element count is maintained using a specialization of * LongAdder. We need to incorporate a specialization rather than * just use a LongAdder in order to access implicit * contention-sensing that leads to creation of multiple * CounterCells.  The counter mechanics avoid contention on * updates but can encounter cache thrashing if read too * frequently during concurrent access. To avoid reading so often, * resizing under contention is attempted only upon adding to a * bin already holding two or more nodes. Under uniform hash * distributions, the probability of this occurring at threshold * is around 13%, meaning that only about 1 in 8 puts check * threshold (and after resizing, many fewer do so). */</code></pre><p>â€‹    ä½¿ç”¨<code>LongAdder</code> æ¥ç»Ÿè®¡å…ƒç´ çš„ä¸ªæ•°</p><h4 id="TreeBins"><a href="#TreeBins" class="headerlink" title="TreeBins"></a>TreeBins</h4><pre><code class="java">/* * TreeBins use a special form of comparison for search and * related operations (which is the main reason we cannot use * existing collections such as TreeMaps). TreeBins contain * Comparable elements, but may contain others, as well as * elements that are Comparable but not necessarily Comparable for * the same T, so we cannot invoke compareTo among them. To handle * this, the tree is ordered primarily by hash value, then by * Comparable.compareTo order if applicable.  On lookup at a node, * if elements are not comparable or compare as 0 then both left * and right children may need to be searched in the case of tied * hash values. (This corresponds to the full list search that * would be necessary if all elements were non-Comparable and had * tied hashes.) On insertion, to keep a total ordering (or as * close as is required here) across rebalancings, we compare * classes and identityHashCodes as tie-breakers. The red-black * balancing code is updated from pre-jdk-collections * (http://gee.cs.oswego.edu/dl/classes/collections/RBCell.java) * based in turn on Cormen, Leiserson, and Rivest &quot;Introduction to * Algorithms&quot; (CLR). *  * TreeBins also require an additional locking mechanism.  While * list traversal is always possible by readers even during * updates, tree traversal is not, mainly because of tree-rotations * that may change the root node and/or its linkages.  TreeBins * include a simple read-write lock mechanism parasitic on the * main bin-synchronization strategy: Structural adjustments * associated with an insertion or removal are already bin-locked * (and so cannot conflict with other writers) but must wait for * ongoing readers to finish. Since there can be only one such * waiter, we use a simple scheme using a single &quot;waiter&quot; field to * block writers.  However, readers need never block.  If the root * lock is held, they proceed along the slow traversal path (via * next-pointers) until the lock becomes available or the list is * exhausted, whichever comes first. These cases are not fast, but * maximize aggregate expected throughput. */</code></pre><p>â€‹    TreeBins , On insertion, to keep a total ordering (or as close as is required here) across rebalancings, we compare classes and identityHashCodes as tie-breakers.</p><p>â€‹    TreeBinsè¿˜éœ€è¦é¢å¤–çš„é”å®šæœºåˆ¶ã€‚ å°½ç®¡åœ¨æ›´æ–°æœŸé—´readersæ€»æ˜¯å¯ä»¥è¿›è¡Œåˆ—è¡¨éå†ï¼Œä½†æ˜¯æ ‘éå†ä¸æ˜¯ï¼Œä¸»è¦æ˜¯å› ä¸ºå¯ä»¥æ”¹å˜æ ¹èŠ‚ç‚¹å’Œ/æˆ–å…¶é“¾æ¥çš„æ ‘æ—‹è½¬ã€‚ä½¿ç”¨è¯»å†™é”å®ç°,è¯»ä¸ä¼šé˜»å¡</p><h4 id="baggage"><a href="#baggage" class="headerlink" title="baggage"></a>baggage</h4><pre><code class="java">/*      * Maintaining API and serialization compatibility with previous * versions of this class introduces several oddities. Mainly: We * leave untouched but unused constructor arguments refering to * concurrencyLevel. We accept a loadFactor constructor argument, * but apply it only to initial table capacity (which is the only * time that we can guarantee to honor it.) We also declare an * unused &quot;Segment&quot; class that is instantiated in minimal form * only when serializing. * * Also, solely for compatibility with previous versions of this * class, it extends AbstractMap, even though all of its methods * are overridden, so it is just useless baggage. * */</code></pre><p>ä¸€äº›å…¼å®¹API ,  concurrencyLevel ,loadFactor,Segment (1.7çš„å®ç°åˆ†æ®µé”) , ç»§æ‰¿äº†AbstractMap,ä½†é‡å†™äº†æ‰€æœ‰æ–¹æ³•</p><h3 id="Sources-Code"><a href="#Sources-Code" class="headerlink" title="Sources Code"></a>Sources Code</h3><pre><code class="java">/*      * This file is organized to make things a little easier to follow * while reading than they might otherwise: First the main static * declarations and utilities, then fields, then main public * methods (with a few factorings of multiple public methods into * internal ones), then sizing methods, trees, traversers, and * bulk operations. */</code></pre><p>â€‹    ConcurrentHashMap çš„æºç å¯è¯»æ€§éå¸¸é«˜,æŒ‰ç…§å¦‚ä¸Šæ–¹å¼ç»„ç»‡ä»£ç </p><h4 id="main-declarations"><a href="#main-declarations" class="headerlink" title="main declarations"></a>main declarations</h4><pre><code class="java">//é»˜è®¤binæ•°ç»„çš„å¤§å°ï¼Œå¿…é¡»ä¸º2çš„næ¬¡æ–¹private static final int DEFAULT_CAPACITY = 16;            //é»˜è®¤è£…å¡«å› å­private static final float LOAD_FACTOR = 0.75f;//å½“binä¸­å¤§äº8ä¸ªnodeæ—¶ï¼Œå°†æ­¤binç”±listè½¬æ¢ä¸ºtreestatic final int TREEIFY_THRESHOLD = 8;//treeé€€åŒ–static final int UNTREEIFY_THRESHOLD = 6;//å¤§äº64ä¸ªbucketäº†ï¼Œæ‰ä¼šè€ƒè™‘treeåŒ–static final int MIN_TREEIFY_CAPACITY = 64;//to place bounds on some sizingsstatic final int NCPU = Runtime.getRuntime().availableProcessors();/** For serialization compatibility.  å…¼å®¹*/private static final ObjectStreamField[] serialPersistentFields = {   new ObjectStreamField(&quot;segments&quot;, Segment[].class),   new ObjectStreamField(&quot;segmentMask&quot;, Integer.TYPE),   new ObjectStreamField(&quot;segmentShift&quot;, Integer.TYPE)};//å…¼å®¹private static final int DEFAULT_CONCURRENCY_LEVEL = 16;/* * Encodings for Node hash fields. See above for explanation. */static final int MOVED     = -1; // hash for forwarding nodesstatic final int TREEBIN   = -2; // hash for roots of treesstatic final int RESERVED  = -3; // hash for transient reservationsstatic final int HASH_BITS = 0x7fffffff; // usable bits of normal node hash</code></pre><h4 id="Node-1"><a href="#Node-1" class="headerlink" title="Node"></a>Node</h4><pre><code class="java">static class Node&lt;K,V&gt; implements Map.Entry&lt;K,V&gt; {    final int hash;    final K key;    volatile V val;    volatile Node&lt;K,V&gt; next;    Node(int hash, K key, V val, Node&lt;K,V&gt; next) {        this.hash = hash;        this.key = key;        this.val = val;        this.next = next;    }    public final K getKey()       { return key; }    public final V getValue()     { return val; }    public final int hashCode()   { return key.hashCode() ^ val.hashCode(); }    public final String toString(){ return key + &quot;=&quot; + val; }    public final V setValue(V value) {        throw new UnsupportedOperationException();    }    public final boolean equals(Object o) {        Object k, v, u; Map.Entry&lt;?,?&gt; e;        return ((o instanceof Map.Entry) &amp;&amp;                (k = (e = (Map.Entry&lt;?,?&gt;)o).getKey()) != null &amp;&amp;                (v = e.getValue()) != null &amp;&amp;                (k == key || k.equals(key)) &amp;&amp;                (v == (u = val) || v.equals(u)));    }    /**     * Virtualized support for map.get(); overridden in subclasses.     */    Node&lt;K,V&gt; find(int h, Object k) {        Node&lt;K,V&gt; e = this;        if (k != null) {            do {                K ek;                if (e.hash == h &amp;&amp;                    ((ek = e.key) == k || (ek != null &amp;&amp; k.equals(ek))))                    return e;            } while ((e = e.next) != null);        }        return null;    }}</code></pre><h4 id="Static-utilities"><a href="#Static-utilities" class="headerlink" title="Static utilities"></a>Static utilities</h4><pre><code class="java">/** * Spreads (XORs) higher bits of hash to lower and also forces top * bit to 0. Because the table uses power-of-two masking, sets of * hashes that vary only in bits above the current mask will * always collide. (Among known examples are sets of Float keys * holding consecutive whole numbers in small tables.)  So we * apply a transform that spreads the impact of higher bits * downward. There is a tradeoff between speed, utility, and * quality of bit-spreading. Because many common sets of hashes * are already reasonably distributed (so don&#39;t benefit from * spreading), and because we use trees to handle large sets of * collisions in bins, we just XOR some shifted bits in the * cheapest possible way to reduce systematic lossage, as well as * to incorporate impact of the highest bits that would otherwise * never be used in index calculations because of table bounds. */static final int spread(int h) {    return (h ^ (h &gt;&gt;&gt; 16)) &amp; HASH_BITS;}/** * Returns a power of two table size for the given desired capacity. * See Hackers Delight, sec 3.2 */private static final int tableSizeFor(int c) {    int n = c - 1;    n |= n &gt;&gt;&gt; 1;    n |= n &gt;&gt;&gt; 2;    n |= n &gt;&gt;&gt; 4;    n |= n &gt;&gt;&gt; 8;    n |= n &gt;&gt;&gt; 16;    return (n &lt; 0) ? 1 : (n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + 1;}/** * Returns x&#39;s Class if it is of the form &quot;class C implements * Comparable&lt;C&gt;&quot;, else null. */static Class&lt;?&gt; comparableClassFor(Object x) {    if (x instanceof Comparable) {        Class&lt;?&gt; c; Type[] ts, as; Type t; ParameterizedType p;        if ((c = x.getClass()) == String.class) // bypass checks            return c;        if ((ts = c.getGenericInterfaces()) != null) {            for (int i = 0; i &lt; ts.length; ++i) {                if (((t = ts[i]) instanceof ParameterizedType) &amp;&amp;                    ((p = (ParameterizedType)t).getRawType() ==                     Comparable.class) &amp;&amp;                    (as = p.getActualTypeArguments()) != null &amp;&amp;                    as.length == 1 &amp;&amp; as[0] == c) // type arg is c                    return c;            }        }    }    return null;}/** * Returns k.compareTo(x) if x matches kc (k&#39;s screened comparable * class), else 0. */@SuppressWarnings({&quot;rawtypes&quot;,&quot;unchecked&quot;}) // for cast to Comparablestatic int compareComparables(Class&lt;?&gt; kc, Object k, Object x) {    return (x == null || x.getClass() != kc ? 0 :            ((Comparable)k).compareTo(x));}</code></pre><h4 id="Main-public-methods"><a href="#Main-public-methods" class="headerlink" title="Main public methods"></a>Main public methods</h4><h5 id="Construct"><a href="#Construct" class="headerlink" title="Construct"></a>Construct</h5><pre><code class="java">/** * Creates a new, empty map with the default initial table size (16). */public ConcurrentHashMap() {}/** * Creates a new, empty map with an initial table size * accommodating the specified number of elements without the need * to dynamically resize. */public ConcurrentHashMap(int initialCapacity) {    if (initialCapacity &lt; 0)        throw new IllegalArgumentException();    int cap = ((initialCapacity &gt;= (MAXIMUM_CAPACITY &gt;&gt;&gt; 1)) ?               MAXIMUM_CAPACITY :               tableSizeFor(initialCapacity + (initialCapacity &gt;&gt;&gt; 1) + 1));    this.sizeCtl = cap;}/** * Creates a new map with the same mappings as the given map. */public ConcurrentHashMap(Map&lt;? extends K, ? extends V&gt; m) {    this.sizeCtl = DEFAULT_CAPACITY;    putAll(m);}/** * Creates a new, empty map with an initial table size based on * the given number of elements ({@code initialCapacity}) and * initial table density ({@code loadFactor}). * * @param initialCapacity the initial capacity. The implementation * performs internal sizing to accommodate this many elements, * given the specified load factor. * @param loadFactor the load factor (table density) for * establishing the initial table size * @throws IllegalArgumentException if the initial capacity of * elements is negative or the load factor is nonpositive * * @since 1.6 */public ConcurrentHashMap(int initialCapacity, float loadFactor) {    this(initialCapacity, loadFactor, 1);}/** * Creates a new, empty map with an initial table size based on * the given number of elements ({@code initialCapacity}), table * density ({@code loadFactor}), and number of concurrently * updating threads ({@code concurrencyLevel}). * * @param initialCapacity the initial capacity. The implementation * performs internal sizing to accommodate this many elements, * given the specified load factor. * @param loadFactor the load factor (table density) for * establishing the initial table size * @param concurrencyLevel the estimated number of concurrently * updating threads. The implementation may use this value as * a sizing hint. * @throws IllegalArgumentException if the initial capacity is * negative or the load factor or concurrencyLevel are * nonpositive */public ConcurrentHashMap(int initialCapacity,                         float loadFactor, int concurrencyLevel) {    if (!(loadFactor &gt; 0.0f) || initialCapacity &lt; 0 || concurrencyLevel &lt;= 0)        throw new IllegalArgumentException();    if (initialCapacity &lt; concurrencyLevel)   // Use at least as many bins        initialCapacity = concurrencyLevel;   // as estimated threads    long size = (long)(1.0 + (long)initialCapacity / loadFactor);    int cap = (size &gt;= (long)MAXIMUM_CAPACITY) ?        MAXIMUM_CAPACITY : tableSizeFor((int)size);    this.sizeCtl = cap;}</code></pre><h5 id="Size"><a href="#Size" class="headerlink" title="Size"></a>Size</h5><pre><code class="java">public int size() {    long n = sumCount();    return ((n &lt; 0L) ? 0 :            (n &gt; (long)Integer.MAX_VALUE) ? Integer.MAX_VALUE :            (int)n);}/* ---------------- Counter support -------------- *//** * A padded cell for distributing counts.  Adapted from LongAdder * and Striped64.  See their internal docs for explanation. */@sun.misc.Contended static final class CounterCell {    volatile long value;    CounterCell(long x) { value = x; }}final long sumCount() {    CounterCell[] as = counterCells; CounterCell a;    long sum = baseCount;    if (as != null) {        for (int i = 0; i &lt; as.length; ++i) {            if ((a = as[i]) != null)                sum += a.value;        }    }    return sum;}</code></pre><h5 id="Get"><a href="#Get" class="headerlink" title="Get"></a>Get</h5><pre><code class="java">public boolean containsKey(Object key) {    return get(key) != null;}public V get(Object key) {    Node&lt;K,V&gt;[] tab;     Node&lt;K,V&gt; e, p;     int n, eh;     K ek;    //é€šè¿‡ä½è¿ç®—å–å¾—bité«˜ä½æ¥ä½¿keyåˆ†å¸ƒæ›´å‡åŒ€,å½“key=nullæ—¶ï¼Œä¼šæŠ›å‡ºç©ºæŒ‡é’ˆå¼‚å¸¸    int h = spread(key.hashCode());        //e å–å¾—binä¸­çš„first node    if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp; (e = tabAt(tab, (n - 1) &amp; h)) != null) {        if ((eh = e.hash) == h) {                                                  if ((ek = e.key) == key || (ek != null &amp;&amp; key.equals(ek)))                return e.val;        }        else if (eh &lt; 0)            return (p = e.find(h, key)) != null ? p.val : null;        //éå†é“¾è¡¨        while ((e = e.next) != null) {                  if (e.hash == h &amp;&amp; ((ek = e.key) == key || (ek != null &amp;&amp; key.equals(ek))))                return e.val;        }    }    return null;}</code></pre><h5 id="Put"><a href="#Put" class="headerlink" title="Put"></a>Put</h5><pre><code class="java">/** Implementation for put and putIfAbsent */final V putVal(K key, V value, boolean onlyIfAbsent) {    if (key == null || value == null) throw new NullPointerException();    int hash = spread(key.hashCode());    int binCount = 0;    for (Node&lt;K,V&gt;[] tab = table;;) {        Node&lt;K,V&gt; f; int n, i, fh;            //å»¶è¿Ÿåˆå§‹åŒ–        if (tab == null || (n = tab.length) == 0)            tab = initTable();                           //å½“å‘empty bin ä¸­æ·»åŠ nodeæ—¶ï¼Œå¹¶ä¸ä½¿ç”¨é”ï¼Œè€Œä½¿ç”¨CASæ“ä½œæ¥æ·»åŠ         else if ((f = tabAt(tab, i = (n - 1) &amp; hash)) == null) {            if (casTabAt(tab, i, null,                         new Node&lt;K,V&gt;(hash, key, value, null)))                break;                           }        //å¤„äºæ‰©å®¹çŠ¶æ€,å¸®åŠ©æ‰©å®¹        else if ((fh = f.hash) == MOVED)            tab = helpTransfer(tab, f);        else {            V oldVal = null;                //é”ä½binèŠ‚ç‚¹            synchronized (f) {                if (tabAt(tab, i) == f) {                    if (fh &gt;= 0) {                        binCount = 1;                        for (Node&lt;K,V&gt; e = f;; ++binCount) {                            K ek;                            if (e.hash == hash &amp;&amp;                                ((ek = e.key) == key ||                                 (ek != null &amp;&amp; key.equals(ek)))) {                                oldVal = e.val;                                if (!onlyIfAbsent)                                    e.val = value;                                break;                            }                            Node&lt;K,V&gt; pred = e;                            if ((e = e.next) == null) {                                pred.next = new Node&lt;K,V&gt;(hash, key,                                                          value, null);                                break;                            }                        }                    }                    else if (f instanceof TreeBin) {                        Node&lt;K,V&gt; p;                        binCount = 2;                        if ((p = ((TreeBin&lt;K,V&gt;)f).putTreeVal(hash, key,                                                       value)) != null) {                            oldVal = p.val;                            if (!onlyIfAbsent)                                p.val = value;                        }                    }                }            }            //å…ˆæ’å…¥å†è½¬æ¢æˆtree            if (binCount != 0) {                if (binCount &gt;= TREEIFY_THRESHOLD)                    treeifyBin(tab, i);                if (oldVal != null)                    return oldVal;                break;            }        }    }    addCount(1L, binCount);    return null;}</code></pre><p>å¯ä»¥çœ‹åˆ°ConcurrentHashMap ä¸ºäº†æé«˜æ€§èƒ½åšäº†å¾ˆå¤šäº‹æƒ…</p><ul><li>â€‹    åªæœ‰å“ˆå¸Œå†²çªæ‰ä¼šé”ä½bin,å¦åˆ™ä½¿ç”¨CAS </li><li>â€‹    å¤šçº¿ç¨‹å¸®åŠ©æ‰©å®¹</li><li>â€‹    å½“é“¾è¡¨è¿‡é•¿æ ‘åŒ–,æé«˜æŸ¥è¯¢é€Ÿåº¦,é˜²æ­¢é”ä½æ—¶é—´è¿‡é•¿    </li></ul><p>More details to continues â€¦..</p>]]></content>
      
      
      <categories>
          
          <category> jdk </category>
          
      </categories>
      
      
        <tags>
            
            <tag> juc </tag>
            
            <tag> map </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVM_Garbage Collection</title>
      <link href="/2019/06/19/JVM-Garbage-Collection/"/>
      <url>/2019/06/19/JVM-Garbage-Collection/</url>
      
        <content type="html"><![CDATA[<p><img src="http://ww2.sinaimg.cn/large/006tNc79gy1g4c1nxma40j30u00gwdig.jpg" alt="https://image.ipaiban.com/upload-ueditor-image-20190616-1560688476336071298.jpg"></p><a id="more"></a><p>åŸºäº<a href="https://docs.oracle.com/en/java/javase/12/gctuning/hotspot-virtual-machine-garbage-collection-tuning-guide.pdf" target="_blank" rel="noopener">HotSpot Virtual Machine Garbage Collection Tuning Guide</a>çš„æ•´ç†( Â´ãƒ¼`) , jDK12</p><p>Or <a href="https://docs.oracle.com/en/java/javase/12/gctuning/index.html" target="_blank" rel="noopener">https://docs.oracle.com/en/java/javase/12/gctuning/index.html</a></p><h2 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h2><blockquote><p>The <em>Java Platform, Standard Edition HotSpot Virtual Machine Garbage Collection<br>Tuning Guide</em> describes the garbage collection methods included in the Java HotSpot<br>Virtual Machine (Java HotSpot VM) and helps you determine which one is the best for<br>your needs.</p></blockquote><p>ä»‹ç»HotSpotè™šæ‹Ÿæœºåƒåœ¾å›æ”¶ç®—æ³•ã€ ä»¥åŠæ€ä¹ˆé€‰æ‹©æœ€åˆé€‚çš„ä¸€ä¸ªç®—æ³•</p><h2 id="Introduction-to-Garbage-Collection-Tuning"><a href="#Introduction-to-Garbage-Collection-Tuning" class="headerlink" title="Introduction to Garbage Collection Tuning"></a>Introduction to Garbage Collection Tuning</h2><blockquote><p>Java SE selects the most appropriate garbage collector based on the class of the computer on which the application is run.<br>However, this selection may not be optimal for every application. </p><p>Users, developers,and administrators with strict performance goals or other requirements may need to<br>explicitly select the garbage collector and tune certain parameters to achieve the<br>desired level of performance.</p></blockquote><p>é€šå¸¸éœ€è¦é€‰æ‹©åˆé€‚çš„åƒåœ¾æ”¶é›†å™¨ã€å¹¶è°ƒæ•´æŸäº›å‚æ•°ä»¥å®ç°æ‰€éœ€çš„æ€§èƒ½çº§åˆ«(ååå’Œåœé¡¿)</p><p>Topics</p><ul><li>What Is a Garbage Collector?  </li><li>Why Does the Choice of Garbage Collector Matter? </li><li>Supported Operating Systems in Documentation</li></ul><p>ç®€å•ä»‹ç»äº†</p><ul><li>ä»€ä¹ˆæ˜¯åƒåœ¾å›æ”¶ã€ä»¥åŠä½¿ç”¨ä»€ä¹ˆä¼˜åŒ–æŠ€æœ¯(åˆ†ä»£ã€å¹¶å‘ã€å‹ç¼©)</li><li>ä¸ºä»€ä¹ˆé€‰æ‹©åƒåœ¾å›æ”¶ç®—æ³•å¾ˆé‡è¦</li><li>æ”¯æŒçš„æ“ä½œç³»ç»Ÿ</li></ul><h2 id="Ergonomics"><a href="#Ergonomics" class="headerlink" title="Ergonomics"></a>Ergonomics</h2><p>ç®€å•ä»‹ç»å¦‚ä½•æé«˜æ€§èƒ½,ä»ååã€å“åº”æ—¶é—´ã€å †ç©ºé—´</p><p>Topics</p><ol><li>Garbage Collector, Heap, and Runtime Compiler Default Selections </li><li>Behavior-Based Tuning <ul><li>Maximum Pause-Time Goal </li><li>Throughput Goal  </li><li>Footprint </li></ul></li><li>Tuning Strategy </li></ol><h3 id="é»˜è®¤é…ç½®"><a href="#é»˜è®¤é…ç½®" class="headerlink" title="é»˜è®¤é…ç½®"></a>é»˜è®¤é…ç½®</h3><ul><li>Garbage-First (G1) collector </li><li>The maximum number of GC threads is limited by heap size and available CPU </li><li>resources </li><li>Initial heap size of 1/64 of physical memory </li><li>Maximum heap size of 1/4 of physical memory </li><li>Tiered compiler, using both C1 and C2 </li></ul><h3 id="åŸºäºç‰¹æ€§è°ƒæ•´"><a href="#åŸºäºç‰¹æ€§è°ƒæ•´" class="headerlink" title="åŸºäºç‰¹æ€§è°ƒæ•´"></a>åŸºäºç‰¹æ€§è°ƒæ•´</h3><ul><li><p>Maximum Pause-Time Goal</p><ul><li><p>These adjustments may cause garbage collection to occur more frequently, reducing the overall throughput of the application.</p></li><li><p>command-line option -XX:MaxGCPauseMillis=<em><nnn></nnn></em></p></li></ul></li><li><p>Throughput Goal</p><ul><li>If the throughput goal isnâ€™t being met, then one possible action for the garbage<br>  collector is to increase the size of the heap so that the time spent in the application<br>  between collection pauses can be longer.</li><li><p>command-line option -XX:GCTimeRatio=<em>nnn</em>  (The ratio of</p><p>  garbage collection time to application time is 1/ (1+<em>nnn</em>))</p></li></ul></li><li>Footprint(å ç”¨ç©ºé—´ -å †å¤§å°)<ul><li>If the throughput and maximum pause-time goals have been met, then the garbage<br>  collector reduces the size of the heap until one of the goals (invariably the throughput<br>  goal) canâ€™t be met.</li></ul></li></ul><h3 id="ç­–ç•¥"><a href="#ç­–ç•¥" class="headerlink" title="ç­–ç•¥"></a>ç­–ç•¥</h3><p>â€‹    The heap grows or shrinks to a size that supports the chosen throughput goal. Learn about heap tuning strategies such as choosing a maximum heap size, and choosing maximum pause-time goal. </p><p>â€‹    <strong>Donâ€™t choose a maximum value for the heap unless you know that you need a heap greater than the default maximum heap size</strong> </p><p>â€‹    <strong>If the heap grows to its maximum size and the throughput goal isnâ€™t being met, then</strong><br><strong>the maximum heap size is too small for the throughput goal.</strong></p><p>â€‹    <strong>If the throughput goal can be met, but pauses are too long, then select a maximum</strong><br><strong>pause-time goal</strong></p><h2 id="Garbage-Collector-Implementation"><a href="#Garbage-Collector-Implementation" class="headerlink" title="Garbage Collector Implementation"></a>Garbage Collector Implementation</h2><blockquote><p>However, when garbage collection is the principal bottleneck, itâ€™s useful to understand<br>some aspects of the implementation. Garbage collectors make assumptions about the<br>way applications use objects, and these are reflected in tunable parameters that can<br>be adjusted for improved performance without sacrificing the power of the abstraction.</p></blockquote><p>å½“åƒåœ¾æ”¶é›†æˆä¸ºè™šæ‹Ÿæœºç“¶é¢ˆçš„æ—¶å€™,äº†è§£å…¶å…·ä½“å®ç°ç»†èŠ‚å°±å¾ˆé‡è¦äº†</p><p><strong>Topics</strong> </p><ul><li>Generational Garbage Collection </li><li>Generations </li><li>Performance Considerations </li><li>Throughput and Footprint Measurement </li></ul><h3 id="åƒåœ¾å›æ”¶åˆ†ä»£ç­–ç•¥"><a href="#åƒåœ¾å›æ”¶åˆ†ä»£ç­–ç•¥" class="headerlink" title="åƒåœ¾å›æ”¶åˆ†ä»£ç­–ç•¥"></a>åƒåœ¾å›æ”¶åˆ†ä»£ç­–ç•¥</h3><p>The Java HotSpot VM incorporates a number of different garbage collection algorithms that all use a technique called generational collection.</p><p>æ¯æ¬¡éƒ½éå†æ¯ä¸ªå¯åˆ°åˆ°è¾¾å¯¹è±¡,è¿™ç§æ•ˆç‡æ˜¯ä¸å¯å–çš„,æ‰€ä»¥éœ€è¦é€‰æ‹©åˆé€‚çš„å›æ”¶ç­–ç•¥</p><p><img src="http://ww4.sinaimg.cn/large/006tNc79gy1g466cazspsj30f309w74j.jpg" alt="Description of Figure 3-1 follows"></p><p><strong><em>Typical Distribution for Lifetimes of Objects</em></strong></p><p>ä»ä¸Šå›¾å¯ä»¥å‘ç°,å¤§å¤šæ•°å¯¹è±¡éƒ½æ˜¯å¹´è½»å¯¹è±¡ (xè½´ä¸ºå½“å‰ç”Ÿå‘½å‘¨æœŸå­˜æ´»çš„å¤§å°,yè½´ä¸ºå¯¹è±¡å†…å­˜åˆ†é…åˆ†ä»£ä½ç½®)</p><h3 id="åˆ†ä»£"><a href="#åˆ†ä»£" class="headerlink" title="åˆ†ä»£"></a>åˆ†ä»£</h3><blockquote><p>To optimize for this scenario, memory is managed in generations (memory pools holding objects of different ages). Garbage collection occurs in each generation when the generation fills up.<br>The vast majority of objects are allocated in a pool dedicated to young objects (the young generation), and most objects die there.</p></blockquote><p>ä¸ºäº†è§£å†³å¯¹è±¡éƒ½æ˜¯ æœç”Ÿå¤•ç­,è¿™ç§é—®é¢˜,å¯¹å †å†…å­˜ä½¿ç”¨äº†åˆ†ä»£ç®¡ç†</p><p><img src="http://ww1.sinaimg.cn/large/006tNc79gy1g466krgf27j30co03hq2w.jpg" alt="Description of Figure 3-2 follows"></p><p><strong>Young</strong></p><p>The young generation consists of eden and two survivor spaces.</p><p>One survivor space is empty at any time, and serves as the destination of live objects in eden and the other survivor space during garbage collection; </p><p>after garbage collection, eden and the source survivor space are empty</p><p><strong>Old</strong></p><p>Objects are copied between survivor spaces in this way until theyâ€™ve<br>been copied a certain number of times or there isnâ€™t enough space left there.</p><p>These objects are copied into the old region.</p><h3 id="æ€§èƒ½æ³¨æ„äº‹é¡¹"><a href="#æ€§èƒ½æ³¨æ„äº‹é¡¹" class="headerlink" title="æ€§èƒ½æ³¨æ„äº‹é¡¹"></a>æ€§èƒ½æ³¨æ„äº‹é¡¹</h3><p>In general, choosing the size for a particular generation is a trade-off between these considerations. For example, a very large young generation may maximize throughput, but does so at the expense of footprint, promptness, and pause times.  Young generation pauses can be minimized by using a small young generation at the expense of throughput. The sizing of one generation doesnâ€™t affect the collection frequency and pause times for another generation.</p><p>å¹´è½»ä¸€ä»£è¶Šå¤§,ååè¶Šé«˜,minor gc è¶Šå°‘,æ€»gcæ—¶é—´å˜å°‘</p><p>ä½†æ˜¯åŒæ—¶ä¼šå¯¼è‡´ å†…å­˜å ç”¨å˜é«˜,å•æ¬¡éœ€è¦æ”¶é›†åƒåœ¾çš„æ—¶é—´å˜é•¿,å“åº”æ—¶é—´å˜é•¿</p><h3 id="ååå’Œå ç”¨ç©ºé—´æµ‹é‡"><a href="#ååå’Œå ç”¨ç©ºé—´æµ‹é‡" class="headerlink" title="ååå’Œå ç”¨ç©ºé—´æµ‹é‡"></a>ååå’Œå ç”¨ç©ºé—´æµ‹é‡</h3><p>The command-line option -verbose:gc prints information about the heap and garbage collection at each collection.</p><p>å¯ä»¥é€šè¿‡æ‰“å°gcæ—¥å¿—,çœ‹gcæƒ…å†µ</p><h2 id="Factors-Affecting-Garbage-Collection-Performance"><a href="#Factors-Affecting-Garbage-Collection-Performance" class="headerlink" title="Factors Affecting Garbage Collection Performance"></a>Factors Affecting Garbage Collection Performance</h2><blockquote><p>The two most important factors affecting garbage collection performance are <strong>total</strong><br><strong>available memory and proportion of the heap dedicated to the young generation.</strong></p></blockquote><p>å½±å“åƒåœ¾æ”¶é›†æ€§èƒ½çš„ä¸¤ä¸ªé‡è¦å› ç´  å †æ€»å¤§å°å’Œå¹´è½»ä»£å †å †æ¯”ä¾‹</p><p><strong>Topics</strong> </p><ul><li>Total Heap <ul><li>â€“  Heap Options Affecting Generation Size </li><li>â€“  Default Option Values for Heap Size </li><li>â€“  Conserving Dynamic Footprint by Minimizing Java Heap Size </li></ul></li><li>The Young Generation <ul><li>â€“  Young Generation Size Options </li><li>â€“  Survivor Space Sizing </li></ul></li></ul><h3 id="å †æ€»å¤§å°"><a href="#å †æ€»å¤§å°" class="headerlink" title="å †æ€»å¤§å°"></a>å †æ€»å¤§å°</h3><p>Because collections occur when generations fill up, throughput is inversely proportional to the amount of memory available.</p><p><img src="http://ww1.sinaimg.cn/large/006tNc79gy1g467ufa9uoj30fo04rwem.jpg" alt="Description of Figure 4-1 follows"></p><p><strong>Heap Options</strong></p><p>å…¶ä¸­å›¾ä¸­çš„Virtual è¡¨ç¤º -Xms å°äº -Xmx çš„éƒ¨åˆ†</p><h4 id="é»˜è®¤é…ç½®-1"><a href="#é»˜è®¤é…ç½®-1" class="headerlink" title="é»˜è®¤é…ç½®"></a>é»˜è®¤é…ç½®</h4><p><strong><em>Default Options for 64-Bit Solaris Operating System</em></strong></p><table><thead><tr><th style="text-align:left">Option</th><th style="text-align:left">Default Value</th></tr></thead><tbody><tr><td style="text-align:left"><code>-XX:MinHeapFreeRatio</code></td><td style="text-align:left">40</td></tr><tr><td style="text-align:left"><code>-XX:MaxHeapFreeRatio</code></td><td style="text-align:left">70</td></tr><tr><td style="text-align:left"><code>-Xms</code></td><td style="text-align:left">6656 KB</td></tr><tr><td style="text-align:left"><code>-Xmx</code></td><td style="text-align:left">calculated</td></tr></tbody></table><p>The following are general guidelines regarding heap sizes for server applications:</p><ul><li><p>Unless you have problems with pauses, try granting as much memory as possible to the virtual machine. The default size is often too small. </p></li><li><p>Setting -Xms and -Xmx to the same value increases predictability by removing the most important sizing decision from the virtual machine. However, the virtual machine is then unable to compensate if you make a poor choice. </p></li><li><p>In general, increase the memory as you increase the number of processors, because allocation can be made parallel. </p></li></ul><p>â€‹    </p><h4 id="åŠ¨æ€ç¼©å°å †ç©ºé—´"><a href="#åŠ¨æ€ç¼©å°å †ç©ºé—´" class="headerlink" title="åŠ¨æ€ç¼©å°å †ç©ºé—´"></a>åŠ¨æ€ç¼©å°å †ç©ºé—´</h4><p>Lowering - XX:MaxHeapFreeRatio to as low as 10% and -XX:MinHeapFreeRatio has shown to successfully reduce the heap size without too much performance degradation; </p><p>In addition, you can specify -XX:-ShrinkHeapInSteps, which immediately reduces the Java heap to the target size (specified by the parameter -XX:MaxHeapFreeRatio) </p><h3 id="å¹´è½»ä»£"><a href="#å¹´è½»ä»£" class="headerlink" title="å¹´è½»ä»£"></a>å¹´è½»ä»£</h3><blockquote><p>The bigger the young generation, the less often minor collections occur. However, for a bounded heap size, a larger young generation implies a smaller old generation, which will increase the frequency of major collections. The optimal choice depends on the lifetime distribution of the objects allocated by the application.</p></blockquote><p>å¹´è½»ä»£è¶Šå¤§,éœ€è¦minor GCçš„æ¬¡æ•°è¶Šå°‘,  major GCçš„æ¬¡æ•°è¶Šå¤š ,å®é™…ä½¿ç”¨å–å†³äºåº”ç”¨å†…å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸåˆ†å¸ƒ</p><table><thead><tr><th style="text-align:left">Option</th><th style="text-align:left">Default Value</th></tr></thead><tbody><tr><td style="text-align:left"><code>-XX:NewRatio</code></td><td style="text-align:left">2</td></tr><tr><td style="text-align:left"><code>-XX:NewSize</code></td><td style="text-align:left">1310 MB</td></tr><tr><td style="text-align:left"><code>-XX:MaxNewSize</code></td><td style="text-align:left">not limited</td></tr><tr><td style="text-align:left"><code>-XX:SurvivorRatio</code></td><td style="text-align:left">8</td></tr></tbody></table><p><strong><em>Default Option Values for Survivor Space Sizing</em></strong></p><p>The following are general guidelines for server applications:</p><ul><li>First decide on the maximum heap size that you can afford to give the virtual machine. Then, plot your performance metric against the young generation sizes to find the best setting.<ul><li>Note that the maximum heap size should always be smaller than the amount of memory installed on the machine to avoid excessive page faults and thrashing.</li></ul></li><li>If the total heap size is fixed, then increasing the young generation size requires reducing the old generation size. Keep the old generation large enough to hold all the live data used by the application at any given time, plus some amount of slack space (10 to 20% or more).</li><li>Subject to the previously stated constraint on the old generation:<ul><li>Grant plenty of memory to the young generation.</li><li>Increase the young generation size as you increase the number of processors because allocation can be parallelized.</li></ul></li></ul><p>å¥½å§,æ„Ÿè§‰è¿™ä¸ªå‡†åˆ™åœ¨è®²åºŸè¯</p><h2 id="Available-Collectors"><a href="#Available-Collectors" class="headerlink" title="Available Collectors"></a>Available Collectors</h2><p>ä»‹ç»åƒåœ¾æ”¶é›†å™¨,å’Œæ€ä¹ˆæŒ‘é€‰åˆé€‚çš„åƒåœ¾æ”¶é›†å™¨</p><p><strong>Topics</strong> </p><ul><li><p>Serial Collector </p></li><li><p>Parallel Collector </p></li><li><p>The Mostly Concurrent Collectors </p></li><li><p>Selecting a Collector </p></li></ul><p>â€‹    </p><h3 id="ä¸²è¡Œæ”¶é›†å™¨"><a href="#ä¸²è¡Œæ”¶é›†å™¨" class="headerlink" title="ä¸²è¡Œæ”¶é›†å™¨"></a>ä¸²è¡Œæ”¶é›†å™¨</h3><p>Itâ€™s best-suited to single processor machines because it canâ€™t take advantage of multiprocessor hardware, although it can be useful on multiprocessors for applications with small data sets (up to approximately 100 MB).  </p><p>æ”¶é›†è¿‡ç¨‹,ä¸ä¼šæ‰§è¡Œç”¨æˆ·çº¿ç¨‹,ä¸€èˆ¬é€‚ç”¨äºå•å¤„ç†å™¨æœºå™¨,ä¹Ÿå¯ä»¥ç”¨äºå¤šå¤„ç†å™¨çš„å°å†…å­˜åº”ç”¨(100MBå·¦å³)</p><h3 id="å¹¶è¡Œæ”¶é›†å™¨"><a href="#å¹¶è¡Œæ”¶é›†å™¨" class="headerlink" title="å¹¶è¡Œæ”¶é›†å™¨"></a>å¹¶è¡Œæ”¶é›†å™¨</h3><p>The parallel collector is also known as <em>throughput collector</em>, itâ€™s a generational collector similar to the serial collector. The primary difference between the serial and parallel collectors is that the parallel collector has multiple threads that are used to speed up garbage collection. </p><p>The parallel collector is intended for applications with medium-sized to large-sized data sets that are run on multiprocessor or multithreaded hardware. You can enable it by using the -XX:+UseParallelGC option. </p><p>ä¹Ÿç§°ä¸ºååé‡æ”¶é›†å™¨,ä¸ä¸²è¡Œç±»å‹,ä¸åŒçš„æ˜¯å¤šçº¿ç¨‹å¹¶è¡Œ</p><h3 id="å¹¶å‘æ”¶é›†å™¨"><a href="#å¹¶å‘æ”¶é›†å™¨" class="headerlink" title="å¹¶å‘æ”¶é›†å™¨"></a>å¹¶å‘æ”¶é›†å™¨</h3><ul><li><p>G1 garbage collector: This server-style collector is for multiprocessor machines with a large amount of memory. It meets garbage collection pause-time goals with high probability, while achieving high throughput. </p><p>  G1 is selected by default on certain hardware and operating system configurations, or can be explicitly enabled using-XX:+UseG1GC . </p></li><li><p>CMS collector : This collector is for applications that prefer shorter garbage collection pauses and can afford to share processor resources with the garbage collection. </p><p>  Use the option -XX:+UseConcMarkSweepGC to enable the CMS collector </p><p>  The CMS collector is deprecated as of JDK 9. </p></li></ul><p>å¹¶å‘æ”¶é›†å™¨æŒ‡åœ¨åƒåœ¾æ”¶é›†çš„è¿‡ç¨‹åŒæ—¶è¿˜å¯ä»¥æ‰§è¡Œç”¨æˆ·çº¿ç¨‹(ä¼šæœ‰çŸ­æš‚åœæ­¢)</p><h3 id="Zæ”¶é›†å™¨"><a href="#Zæ”¶é›†å™¨" class="headerlink" title="Zæ”¶é›†å™¨"></a>Zæ”¶é›†å™¨</h3><p>The Z Garbage Collector (ZGC) is a scalable low latency garbage collector. ZGC performs all expensive work concurrently, without stopping the execution of application threads. </p><p>ZGC is intended for applications which require low latency (less than 10 ms pauses) and/or use a very large heap (multi-terabytes). You can enable is by using the -XX: +UseZGC option. </p><p>ZGC is available as an experimental feature, starting with JDK 11. </p><p>é€‚ç”¨äºä½å»¶è¿Ÿ(10ms)å’Œå¤§å †çš„åº”ç”¨ç¨‹åº</p><h3 id="é€‰æ‹©æ”¶é›†å™¨"><a href="#é€‰æ‹©æ”¶é›†å™¨" class="headerlink" title="é€‰æ‹©æ”¶é›†å™¨"></a>é€‰æ‹©æ”¶é›†å™¨</h3><blockquote><p>Unless your application has rather strict pause-time requirements, first run your application and allow the VM to select a collector.If necessary, adjust the heap size to improve performance. </p></blockquote><p>é™¤éæœ‰ä¸¥æ ¼çš„çŸ­æš‚æ—¶é—´è¦æ±‚,å¦åˆ™ä½¿ç”¨é»˜è®¤çš„æ”¶é›†å™¨.(æˆ–è€…è°ƒæ•´å †å¤§å°)</p><p>If the performance still doesnâ€™t meet your goals, then use the following guidelines as a starting point for selecting a collector:</p><ul><li><p>If the application has a small data set (up to approximately 100 MB), then select the serial collector with the option -XX:+UseSerialGC. </p></li><li><p>If the application will be run on a single processor and there are no pause-time requirements, then select the serial collector with the option -XX:+UseSerialGC. </p></li><li><p>If (a) peak application performance is the first priority and (b) there are no pause- time requirements or pauses of one second or longer are acceptable, then let the VM select the collector or select the parallel collector with -XX:+UseParallelGC. </p></li><li><p>If response time is more important than overall throughput and garbage collection pauses must be kept shorter than approximately one second, then select a mostly concurrent collector with -XX:+UseG1GC or -XX:+UseConcMarkSweepGC. </p></li><li><p>If response time is a high priority, and/or you are using a very large heap, then select a fully concurrent collector with -XX:UseZGC. </p></li></ul><p>é€‰æ‹©åˆé€‚çš„åƒåœ¾æ”¶é›†å™¨åªæ˜¯ä¸€ä¸ªèµ·ç‚¹, ä»éœ€è¦é€šè¿‡è°ƒæ•´VMå‚æ•° æ¥è¾¾åˆ°éœ€è¦çš„æ€§èƒ½</p><h2 id="Collectors-Implementation"><a href="#Collectors-Implementation" class="headerlink" title="Collectors  Implementation"></a>Collectors  Implementation</h2><h3 id="The-Parallel-Collector"><a href="#The-Parallel-Collector" class="headerlink" title="The Parallel Collector"></a>The Parallel Collector</h3><blockquote><p>The parallel collector is enabled with the command-line option -XX:+UseParallelGC.<br>By default, with this option, both minor and major collections are run in parallel to<br>further reduce garbage collection overhead.</p></blockquote><p><strong>Topics</strong> </p><ul><li><p>Number of Parallel Collector Garbage Collector Threads </p></li><li><p>Arrangement of Generations in Parallel Collectors </p></li><li><p>Parallel Collector Ergonomics </p><ul><li><p>â€“  Options to Specify Parallel Collector Behaviors </p><ul><li><p>â€“  Priority of Parallel Collector Goals </p></li><li><p>â€“  Parallel Collector Generation Size Adjustments </p></li><li><p>â€“  Parallel Collector Default Heap Size </p></li></ul><p>* Specification of Parallel Collector Initial and Maximum Heap Sizes </p></li></ul></li><li><p>Excessive Parallel Collector Time and OutOfMemoryError </p></li><li><p>Parallel Collector Measurements </p></li></ul><h3 id="The-Mostly-Concurrent-Collectors"><a href="#The-Mostly-Concurrent-Collectors" class="headerlink" title="The Mostly Concurrent Collectors"></a>The Mostly Concurrent Collectors</h3><blockquote><p>On an <em>N</em> processor system, the concurrent part of the collection uses <em>K</em>/<em>N</em> of the available processors, where 1 &lt;= <em>K</em> &lt;= ceiling<em>{N/4</em>}. </p><p>In addition to the use of processors during concurrent phases, additional overhead is incurred to enable concurrency. Thus, while garbage collection pauses are typically much shorter with the concurrent collector, application throughput also tends to be slightly lower than with the other collectors. </p><p>As <em>N</em> increases, the reduction in processor resources due to concurrent garbage collection becomes smaller, and the benefit from concurrent collection increases. </p><p>Because at least one processor is used for garbage collection during the concurrent phases, the concurrent collectors donâ€™t normally provide any benefit on a uniprocessor (single-core) machine.</p></blockquote><p>åœ¨å¤šæ ¸å¤„ç†å™¨ä¸Š,åƒåœ¾æ”¶é›†çº¿ç¨‹ä¸º 1 &lt;= <em>K</em> &lt;= ceiling<em>{N/4</em>} , éšç€Nçš„å¢å¤šæ”¶ç›Šè¶Šå¤§ , åŒæ—¶æ³¨æ„åœ¨å•æ ¸ä¸Šå¹¶ä¸é€‚ç”¨</p><h4 id="Concurrent-Mark-Sweep-CMS-Collector"><a href="#Concurrent-Mark-Sweep-CMS-Collector" class="headerlink" title="Concurrent Mark Sweep (CMS) Collector"></a>Concurrent Mark Sweep (CMS) Collector</h4><blockquote><p>The Concurrent Mark Sweep (CMS) collector is designed for applications that prefer<br>shorter garbage collection pauses and that can afford to share processor resources<br>with the garbage collector while the application is running.</p></blockquote><p><strong>Topics</strong> </p><ul><li>Concurrent Mark Sweep Collector Performance and Structure </li><li>Concurrent Mode Failure </li><li>Excessive GC Time and OutOfMemoryError </li><li>Concurrent Mark Sweep Collector and Floating Garbage </li><li>Concurrent Mark Sweep Collector Pauses </li><li>Concurrent Mark Sweep Collector Concurrent Phases </li><li>Starting a Concurrent Collection Cycle </li><li>Scheduling Pauses </li><li>Concurrent Mark Sweep Collector Measurements </li></ul><h5 id="CMS-æ€§èƒ½å’Œç»“æ„"><a href="#CMS-æ€§èƒ½å’Œç»“æ„" class="headerlink" title="CMS æ€§èƒ½å’Œç»“æ„"></a>CMS æ€§èƒ½å’Œç»“æ„</h5><p><img src="https://media.licdn.com/dms/image/C4E12AQH4VHeTMCfxmA/article-cover_image-shrink_720_1280/0?e=1566432000&amp;v=beta&amp;t=ECo_SPDpBCkQlyNbEXoIgmVeTTaxLrfz7pC66OJ2mlc" alt="JVM"></p><p>æ ‡è®°å’Œæ¸…é™¤,æ›´å¤šç»†èŠ‚å‚è€ƒå¦‚ä¸‹</p><blockquote><p><a href="https://www.linkedin.com/pulse/jvm-why-cms-garbage-collector-deprecating-kunal-saxena" target="_blank" rel="noopener">why-cms-garbage-collector-deprecating</a></p><p><a href="https://juejin.im/post/5c152fefe51d45366873544a" target="_blank" rel="noopener">CMSä¸ƒä¸ªé˜¶æ®µ</a></p></blockquote><h5 id="Concurrent-Mode-Failure"><a href="#Concurrent-Mode-Failure" class="headerlink" title="Concurrent Mode Failure"></a>Concurrent Mode Failure</h5><blockquote><p>As described previously, in normal operation, the CMS collector does most of its<br>tracing and sweeping work with the application threads still running, so only brief<br>pauses are seen by the application threads. However, if the CMS collector is unable to<br>finish reclaiming the unreachable objects before the old generation fills up, or if an<br>allocation cannot be satisfied with the available free space blocks in the old<br>generation, then the application is paused and the collection is completed with all the<br>application threads stopped. </p><p>If a concurrent collection is interrupted by an explicit garbage<br>collection (System.gc()) or for a garbage collection needed to provide information<br>for diagnostic tools, then a concurrent mode interruption is reported.</p></blockquote><p>CMSåœ¨å¹¶å‘æ ‡è®°é˜¶æ®µæ”¶é›†å¤±è´¥æ—¶å€™(ç”¨æˆ·çº¿ç¨‹å¹¶å‘è¿è¡Œ,æ‰€ä»¥ä¼šäº§ç”Ÿåƒåœ¾,å¦‚æœè¿™æ—¶å€™oldåŒºæ»¡äº†,ä¼šstop the world,é€€åŒ–æˆå•çº¿ç¨‹) è‡³äºä¸ºä»€ä¹ˆç”¨å•çº¿ç¨‹,è¿™ä¸ªæ˜¯ä¸ªå†å²é—ç•™é—®é¢˜,<a href="https://www.zhihu.com/question/50398881" target="_blank" rel="noopener">ä¼ é€é—¨</a></p><p>å¦‚æœåœ¨å¹¶å‘æ ‡è®°é˜¶æ®µè¢«å…¶ä»–æ‰“æ–­(System.gc()),ä¼šè¢«æŠ¥å‘Š</p><h5 id="GCæ—¶é—´è¿‡é•¿å’ŒOutOfMemoryError"><a href="#GCæ—¶é—´è¿‡é•¿å’ŒOutOfMemoryError" class="headerlink" title="GCæ—¶é—´è¿‡é•¿å’ŒOutOfMemoryError"></a>GCæ—¶é—´è¿‡é•¿å’ŒOutOfMemoryError</h5><p>The CMS collector throws an OutOfMemoryError if too much time is being spent in<br>garbage collection: If more than 98% of the total time is spent in garbage collection<br>and less than 2% of the heap is recovered, then an OutOfMemoryError is thrown.</p><h5 id="æµ®åŠ¨åƒåœ¾"><a href="#æµ®åŠ¨åƒåœ¾" class="headerlink" title="æµ®åŠ¨åƒåœ¾"></a>æµ®åŠ¨åƒåœ¾</h5><blockquote><p>Because application threads and the garbage collector thread run concurrently during a major collection, objects that are traced by the garbage collector thread may subsequently become unreachable by the time collection process ends. Such unreachable objects that havenâ€™t yet been reclaimed are referred to as <em>floating garbage</em>.</p></blockquote><p>å› ä¸ºå­˜åœ¨åƒåœ¾æ”¶é›†çº¿ç¨‹å’Œå·¥ä½œçº¿ç¨‹å¹¶å‘æ ‡è®°çš„é˜¶æ®µ, æ‰€ä»¥åœ¨è¿™ä¸ªé˜¶æ®µ,æ–°äº§ç”Ÿçš„åƒåœ¾å°±æ— æ³•å›æ”¶,ç§°ä¹‹ä¸ºæµ®åŠ¨åƒåœ¾</p><p>CMSè§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹å¼æ˜¯é€šè¿‡è®¾ç½® å¤šå°‘æ¬¡cmsæ”¶é›†åè¿è¡Œä¸€æ¬¡å‹ç¼©</p><p>å…³äºRemake ä¸ºä»€ä¹ˆæ²¡åŠæ³•å›æ”¶æµ®åŠ¨åƒåœ¾</p><blockquote><p><strong>é‡æ–°æ ‡è®°ï¼ˆRemarkï¼‰</strong> çš„ä½œç”¨åœ¨äºï¼š<br>ä¹‹å‰åœ¨å¹¶å‘æ ‡è®°æ—¶ï¼Œå› ä¸ºæ˜¯ GC å’Œç”¨æˆ·ç¨‹åºæ˜¯å¹¶å‘æ‰§è¡Œçš„ï¼Œå¯èƒ½å¯¼è‡´ä¸€éƒ¨åˆ†å·²ç»æ ‡è®°ä¸º <strong>ä» GC Roots ä¸å¯è¾¾</strong> çš„å¯¹è±¡ï¼Œå› ä¸ºç”¨æˆ·ç¨‹åºçš„ï¼ˆå¹¶å‘ï¼‰è¿è¡Œï¼Œ<strong>åˆå¯è¾¾</strong> äº†ï¼Œ<strong>Remark</strong> çš„ä½œç”¨å°±æ˜¯å°†è¿™éƒ¨åˆ†å¯¹è±¡åˆæ ‡è®°ä¸º <strong>å¯è¾¾å¯¹è±¡</strong>ã€‚</p><p>è‡³äº â€œæµ®åŠ¨åƒåœ¾â€ï¼Œå› ä¸º <strong>CMS</strong> åœ¨ <strong>å¹¶å‘æ ‡è®°</strong> æ—¶æ˜¯å¹¶å‘çš„ï¼ŒGC çº¿ç¨‹å’Œç”¨æˆ·çº¿ç¨‹å¹¶å‘æ‰§è¡Œï¼Œè¿™ä¸ªè¿‡ç¨‹å½“ç„¶å¯èƒ½ä¼šå› ä¸ºçº¿ç¨‹çš„äº¤æ›¿æ‰§è¡Œè€Œå¯¼è‡´æ–°äº§ç”Ÿçš„åƒåœ¾ï¼ˆå³æµ®åŠ¨åƒåœ¾ï¼‰æ²¡æœ‰è¢«æ ‡è®°åˆ°ï¼›è€Œ <strong>é‡æ–°æ ‡è®°</strong> çš„ä½œç”¨åªæ˜¯ä¿®æ”¹ä¹‹å‰ <strong>å¹¶å‘æ ‡è®°</strong> æ‰€è·å¾—çš„ä¸å¯è¾¾å¯¹è±¡ï¼Œæ‰€ä»¥æ˜¯æ²¡æœ‰åŠæ³•å¤„ç† â€œæµ®åŠ¨åƒåœ¾â€ çš„ã€‚</p></blockquote><h5 id="æš‚åœ"><a href="#æš‚åœ" class="headerlink" title="æš‚åœ"></a>æš‚åœ</h5><blockquote><p>The CMS collector pauses an application twice during a concurrent collection cycle. The first pause is to mark as live the objects directly reachable from the roots (for example, object references from application thread stacks and registers, static objects, and so on) and from elsewhere in the heap (for example, the young generation). </p><p>This first pause is referred to as the <em>initial mark pause</em>. The second pause comes at the end of the concurrent tracing phase and finds objects that were missed by the concurrent tracing due to updates by the application threads of references in an object after the CMS collector had finished tracing that object. This second pause is referred to as the <em>remark pause</em>. </p></blockquote><ul><li>åˆå§‹æ ‡è®° <ul><li>åˆå§‹æ ‡è®° åªæ˜¯ç®€å•æ ‡è®°rootså¯ä»¥ç›´æ¥åˆ°è¾¾çš„å¯¹è±¡,æš‚åœæ—¶é—´çŸ­</li></ul></li><li>é‡æ–°æ ‡è®°<ul><li>é‡æ–°æ ‡è®° åœ¨å¹¶å‘æ ‡è®°é˜¶æ®µ é—æ¼çš„å¯¹è±¡,æš‚åœæ—¶é—´ä¼šåˆå§‹æ ‡è®°ä¹…</li></ul></li></ul><h5 id="å›æ”¶æ—¶æœº"><a href="#å›æ”¶æ—¶æœº" class="headerlink" title="å›æ”¶æ—¶æœº"></a>å›æ”¶æ—¶æœº</h5><blockquote><p>There are several ways to start a concurrent collection.</p><p>Based on recent history, the CMS collector maintains estimates of the time remaining<br>before the old generation will be exhausted and of the time needed for a concurrent<br>collection cycle. Using these dynamic estimates, a concurrent collection cycle is<br>started with the aim of completing the collection cycle before the old generation is<br>exhausted. These estimates are padded for safety because concurrent mode failure<br>can be very costly.</p><p>A concurrent collection also starts if the occupancy of the old generation exceeds an<br>initiating occupancy (a percentage of the old generation). The default value for this<br>initiating occupancy threshold is approximately 92%, but the value is subject to change<br>from release to release. This value can be manually adjusted using the command-line<br>option -XX:CMSInitiatingOccupancyFraction=<n>, where <n> is an integral<br>percentage (0 to 100) of the old generation size.</n></n></p></blockquote><p>æ ¹æ®æœ€è¿‘çš„å†å²è®°å½•ï¼ŒCMSæ”¶é›†å™¨ç»´æŠ¤å¯¹æ—§ä¸€ä»£ç”¨å°½ä¹‹å‰å‰©ä½™æ—¶é—´çš„ä¼°è®¡ä»¥åŠå¹¶å‘æ”¶é›†å‘¨æœŸæ‰€éœ€çš„æ—¶é—´ã€‚</p><p>OldåŒºä½¿ç”¨ç‡å æ¯” </p><h5 id="æš‚åœè°ƒåº¦"><a href="#æš‚åœè°ƒåº¦" class="headerlink" title="æš‚åœè°ƒåº¦"></a>æš‚åœè°ƒåº¦</h5><blockquote><p>The pauses for the young generation collection and the old generation collection occur independently.<br>They donâ€™t overlap, but may occur in quick succession such that the pause from one collection, immediately followed by one from the other collection, can appear to be a single, longer pause. To avoid this, the CMS collector attempts to schedule the remark pause roughly midway between the previous and next young generation pauses. This scheduling is currently not done for the initial mark pause, which is usually much shorter than the remark pause.</p></blockquote><p>å› ä¸ºoldåŒºå’ŒyoungåŒºçš„æ”¶é›†æ˜¯ç‹¬ç«‹çš„,æ‰€ä»¥å¯ä»¥åŒæ—¶å‘ç”Ÿ,è¿™æ ·ä¼šå¯¼è‡´é•¿æš‚åœ</p><p>ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜, remake pause ä¼šå®‰æ’åœ¨ä¸¤æ¬¡young gcä¸­é—´</p><h5 id="æ—¥å¿—"><a href="#æ—¥å¿—" class="headerlink" title="æ—¥å¿—"></a>æ—¥å¿—</h5><pre><code>[121,834s][info][gc] GC(657) Pause Initial Mark 191M-&gt;191M(485M) (121,831s, 121,834s) 3,433ms[121,835s][info][gc] GC(657) Concurrent Mark (121,835s)[121,889s][info][gc] GC(657) Concurrent Mark (121,835s, 121,889s) 54,330ms[121,889s][info][gc] GC(657) Concurrent Preclean (121,889s)[121,892s][info][gc] GC(657) Concurrent Preclean (121,889s, 121,892s) 2,781ms[121,892s][info][gc] GC(657) Concurrent Abortable Preclean (121,892s)[121,949s][info][gc] GC(658) Pause Young (Allocation Failure) 324M-&gt;199M(485M) (121,929s, 121,949s) 19,705ms[122,068s][info][gc] GC(659) Pause Young (Allocation Failure) 333M-&gt;200M(485M) (122,043s, 122,068s) 24,892ms[122,075s][info][gc] GC(657) Concurrent Abortable Preclean (121,892s, 122,075s) 182,989ms[122,087s][info][gc] GC(657) Pause Remark 209M-&gt;209M(485M) (122,076s, 122,087s) 11,373ms[122,087s][info][gc] GC(657) Concurrent Sweep (122,087s)[122,193s][info][gc] GC(660) Pause Young (Allocation Failure) 301M-&gt;165M(485M) (122,181s, 122,193s) 12,151ms[122,254s][info][gc] GC(657) Concurrent Sweep (122,087s, 122,254s) 166,758ms[122,254s][info][gc] GC(657) Concurrent Reset (122,254s)[122,255s][info][gc] GC(657) Concurrent Reset (122,254s, 122,255s) 0,952ms[122,297s][info][gc] GC(661) Pause Young (Allocation Failure) 259M-&gt;128M(485M) (122,291s, 122,297s) 5,797ms</code></pre><p>The output for the CMS collection (GC ID 657) is interspersed with the output from the minor collections (GC IDs 658, 659 and 660);</p><p>The initial mark pause is typically short relative to the minor collection pause time. The concurrent phases (concurrent mark, concurrent preclean, and concurrent sweep) normally last significantly longer than a minor collection pause, as indicated in the CMS collector output example</p><p>ä»gc log å¯ä»¥çœ‹åˆ°young gc æ˜¯ä¼šå¹¶å­˜çš„,åŒæ—¶cmsçš„ä¸»è¦è€—æ—¶æ˜¯  Concurrent phases</p><p>åŒæ—¶æ³¨æ„æ¯æ¬¡stop the world ç®—ä¸€æ¬¡full gc</p><h4 id="Garbage-First-Garbage-Collector"><a href="#Garbage-First-Garbage-Collector" class="headerlink" title="Garbage-First Garbage Collector"></a>Garbage-First Garbage Collector</h4><p>This section describes the Garbage-First (G1) Garbage Collector (GC).</p><p>Topics</p><ul><li><a href="https://docs.oracle.com/en/java/javase/12/gctuning/garbage-first-garbage-collector.html#GUID-0394E76A-1A8F-425E-A0D0-B48A3DC82B42" target="_blank" rel="noopener">Introduction to Garbage-First Garbage Collector</a></li><li><a href="https://docs.oracle.com/en/java/javase/12/gctuning/garbage-first-garbage-collector.html#GUID-CE6F94B6-71AF-45D5-829E-DEADD9BA929D" target="_blank" rel="noopener">Enabling G1</a></li><li>Basic Concepts<ul><li><a href="https://docs.oracle.com/en/java/javase/12/gctuning/garbage-first-garbage-collector.html#GUID-15921907-B297-43A4-8C48-DC88035BC7CF" target="_blank" rel="noopener">Heap Layout</a></li><li><a href="https://docs.oracle.com/en/java/javase/12/gctuning/garbage-first-garbage-collector.html#GUID-F1BE86FA-3EDC-4D4F-BDB4-4B044AD83180" target="_blank" rel="noopener">Garbage Collection Cycle</a></li></ul></li><li>Garbage-First Internals<ul><li><a href="https://docs.oracle.com/en/java/javase/12/gctuning/garbage-first-garbage-collector.html#GUID-572C9203-AB27-46F1-9D33-42BA4F3C6BF3" target="_blank" rel="noopener">Determining Initiating Heap Occupancy</a></li><li><a href="https://docs.oracle.com/en/java/javase/12/gctuning/garbage-first-garbage-collector.html#GUID-AC383806-7FA7-4698-8B92-4FD092B9F368" target="_blank" rel="noopener">Marking</a></li><li><a href="https://docs.oracle.com/en/java/javase/12/gctuning/garbage-first-garbage-collector.html#GUID-BE157AF6-29E7-461A-82CF-50C1978785DA" target="_blank" rel="noopener">Behavior in Very Tight Heap Situations</a></li><li><a href="https://docs.oracle.com/en/java/javase/12/gctuning/garbage-first-garbage-collector.html#GUID-572C9203-AB27-46F1-9D33-42BA4F3C6BF3" target="_blank" rel="noopener">Determining Initiating Heap Occupancy</a></li><li><a href="https://docs.oracle.com/en/java/javase/12/gctuning/garbage-first-garbage-collector.html#GUID-D74F3CC7-CC9F-45B5-B03D-510AEEAC2DAC" target="_blank" rel="noopener">Humongous Objects</a></li><li><a href="https://docs.oracle.com/en/java/javase/12/gctuning/garbage-first-garbage-collector.html#GUID-C268549C-7D95-499C-9B24-A6670B44E49C" target="_blank" rel="noopener">Young-Only Phase Generation Sizing</a></li><li><a href="https://docs.oracle.com/en/java/javase/12/gctuning/garbage-first-garbage-collector.html#GUID-6D6B18B1-063B-48FF-99E3-5AF059C43CE8" target="_blank" rel="noopener">Space-Reclamation Phase Generation Sizing</a></li></ul></li><li><a href="https://docs.oracle.com/en/java/javase/12/gctuning/garbage-first-garbage-collector.html#GUID-082C967F-2DAC-4B59-8A81-0CEC6EEB9016" target="_blank" rel="noopener">Ergonomic Defaults for G1 GC</a></li><li><a href="https://docs.oracle.com/en/java/javase/12/gctuning/garbage-first-garbage-collector.html#GUID-98E80C82-24D8-41D4-BC39-B2583F04F1FF" target="_blank" rel="noopener">Comparison to Other Collectors</a></li></ul><p>ä¸CMSç±»ä¼¼ , ä½†é•¿æ—¶é—´è¿è¡Œåå—ç¢ç‰‡åŒ–å½±å“çš„CMSï¼ŒG1ä¼šå¢é‡å¼çš„æ•´ç†/å‹ç¼©å †é‡Œçš„æ•°æ®ï¼Œé¿å…å—ç¢ç‰‡åŒ–å½±å“</p><h5 id="Region"><a href="#Region" class="headerlink" title="Region"></a>Region</h5><p>â€‹    å°†å †åˆ†ä¸ºå¤šä¸ªRegion, G1 preferentially collects regions with the least amount of live data, or â€œgarbage firstâ€,å³æ”¶é›†åƒåœ¾æœ€å¤šçš„Region ,â€incremental collectionâ€</p><h5 id="CardTable"><a href="#CardTable" class="headerlink" title="CardTable"></a>CardTable</h5><p>â€‹    å› ä¸ºG1åªå›æ”¶ä¸€éƒ¨åˆ†Region, æ‰€ä»¥å›æ”¶çš„æ—¶å€™éœ€è¦çŸ¥é“å“ªäº›å…¶ä»–Regionçš„å¯¹è±¡å¼•ç”¨ç€è‡ªå·±Regionçš„å¯¹è±¡ï¼Œå› ä¸ºé‡‡ç”¨çš„copyingç®—æ³•éœ€è¦ç§»åŠ¨å¯¹è±¡ï¼Œæ‰€ä»¥è¦æ›´æ–°å¼•ç”¨ä¸ºå¯¹è±¡çš„æ–°åœ°å€</p><p>â€‹    åœ¨æ™®é€šçš„åˆ†ä»£æ”¶é›†ä¸­ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œåˆ†ä»£æ”¶é›†ä¸­å¹´è½»ä»£æ”¶é›†éœ€è¦è€å¹´ä»£åˆ°å¹´è½»ä»£çš„å¼•ç”¨çš„è®°å½•ï¼Œé€šå¸¸å«åšremembered set(ç®€ç§°RS)</p><p> concurrent mode failureåçš„å¹¶è¡ŒåŒ–</p><p><a href="http://link.zhihu.com/?target=http%3A//openjdk.java.net/jeps/307" target="_blank" rel="noopener">JEP 307: Parallel Full GC for G1</a></p><h4 id="Garbage-First-Garbage-Collector-Tuning"><a href="#Garbage-First-Garbage-Collector-Tuning" class="headerlink" title="Garbage-First Garbage Collector Tuning"></a>Garbage-First Garbage Collector Tuning</h4><p>This section describes how to adapt Garbage-First garbage collector (G1 GC) behavior in case it does not meet your requirements.</p><p>Topics</p><ul><li><a href="https://docs.oracle.com/en/java/javase/12/gctuning/garbage-first-garbage-collector-tuning.html#GUID-0BB3B742-A985-4D5E-A9C5-433A127FE0F6" target="_blank" rel="noopener">General Recommendations for G1</a></li><li><a href="https://docs.oracle.com/en/java/javase/12/gctuning/garbage-first-garbage-collector-tuning.html#GUID-E26056D1-02A5-4367-94EF-72C66D314AF7" target="_blank" rel="noopener">Moving to G1 from Other Collectors</a></li><li>Improving G1 Performance<ul><li><a href="https://docs.oracle.com/en/java/javase/12/gctuning/garbage-first-garbage-collector-tuning.html#GUID-0DD93225-0BCF-4605-B365-E9833F5BD2FC" target="_blank" rel="noopener">Observing Full Garbage Collections</a></li><li><a href="https://docs.oracle.com/en/java/javase/12/gctuning/garbage-first-garbage-collector-tuning.html#GUID-2428DA90-B93D-48E6-B336-A849ADF1C552" target="_blank" rel="noopener">Humongous Object Fragmentation</a></li><li>Tuning for Latency<ul><li><a href="https://docs.oracle.com/en/java/javase/12/gctuning/garbage-first-garbage-collector-tuning.html#GUID-8D9B2530-E370-4B8B-8ADD-A43674FC6658" target="_blank" rel="noopener">Unusual System or Real-Time Usage</a></li><li><a href="https://docs.oracle.com/en/java/javase/12/gctuning/garbage-first-garbage-collector-tuning.html#GUID-40B64CD4-9844-4E3E-A0BB-81556AC04C74" target="_blank" rel="noopener">Reference Object Processing Takes Too Long</a></li><li><a href="https://docs.oracle.com/en/java/javase/12/gctuning/garbage-first-garbage-collector-tuning.html#GUID-5FD5BDB1-DB7D-4E31-9296-19C0A28F810C" target="_blank" rel="noopener">Young-Only Collections Within the Young-Only Phase Take Too Long</a></li><li><a href="https://docs.oracle.com/en/java/javase/12/gctuning/garbage-first-garbage-collector-tuning.html#GUID-D2B6ADCE-6766-4FF8-AA9D-B7F4F3D0F469" target="_blank" rel="noopener">Mixed Collections Take Too Long</a></li><li><a href="https://docs.oracle.com/en/java/javase/12/gctuning/garbage-first-garbage-collector-tuning.html#GUID-A0343B53-A690-4DDE-98F9-9877096DBF0F" target="_blank" rel="noopener">High Update RS and Scan RS Times</a></li></ul></li><li><a href="https://docs.oracle.com/en/java/javase/12/gctuning/garbage-first-garbage-collector-tuning.html#GUID-70E3F150-B68E-4787-BBF1-F91315AC9AB9" target="_blank" rel="noopener">Tuning for Throughput</a></li><li><a href="https://docs.oracle.com/en/java/javase/12/gctuning/garbage-first-garbage-collector-tuning.html#GUID-0770AB01-E334-4E23-B307-FD2114B16E0E" target="_blank" rel="noopener">Tuning for Heap Size</a></li><li><a href="https://docs.oracle.com/en/java/javase/12/gctuning/garbage-first-garbage-collector-tuning.html#GUID-379B3888-FE24-4C3F-9E38-26434EB04F89" target="_blank" rel="noopener">Tunable Defaults</a></li></ul></li></ul><h3 id="The-Z-Garbage-Collector"><a href="#The-Z-Garbage-Collector" class="headerlink" title="The Z Garbage Collector"></a>The Z Garbage Collector</h3><p>The Z Garbage Collector is available as an experimental feature, and is enabled with the command-line options <code>-XX:+UnlockExperimentalVMOptions -XX:+UseZGC</code>.</p><h4 id="Setting-the-Heap-Size"><a href="#Setting-the-Heap-Size" class="headerlink" title="Setting the Heap Size"></a>Setting the Heap Size</h4><p>In general, the more memory you give to ZGC the better. But at the same time, wasting memory is undesirable, so itâ€™s all about finding a balance between memory usage and how often the GC needs to run.</p><h4 id="Setting-Number-of-Concurrent-GC-Threads"><a href="#Setting-Number-of-Concurrent-GC-Threads" class="headerlink" title="Setting Number of Concurrent GC Threads"></a>Setting Number of Concurrent GC Threads</h4><p>-XX:ConcGCThreads</p><p>This option essentially dictates how much CPU-time the GC should be given. </p><h2 id="Other-Considerations"><a href="#Other-Considerations" class="headerlink" title="Other Considerations"></a>Other Considerations</h2><p>This section covers other situations that affect garbage collection.</p><p>Topics</p><ul><li><a href="https://docs.oracle.com/en/java/javase/12/gctuning/other-considerations.html#GUID-A7B0991C-661F-47BE-AEDB-74C6BDBDE181" target="_blank" rel="noopener">Finalization and Weak, Soft, and Phantom References</a></li><li><a href="https://docs.oracle.com/en/java/javase/12/gctuning/other-considerations.html#GUID-9E3E5371-20F5-4B70-A003-9D7851B115AF" target="_blank" rel="noopener">Explicit Garbage Collection</a></li><li><a href="https://docs.oracle.com/en/java/javase/12/gctuning/other-considerations.html#GUID-BFB89453-60C0-42AC-81CA-87D59B0ACE2E" target="_blank" rel="noopener">Soft References</a></li><li><a href="https://docs.oracle.com/en/java/javase/12/gctuning/other-considerations.html#GUID-B29C9153-3530-4C15-9154-E74F44E3DAD9" target="_blank" rel="noopener">Class Metadata</a></li></ul><blockquote><p>These features can create performance artifacts at the Java programming language level. An example of this is relying on finalization to close file descriptors, which makes an external resource (descriptors) dependent on garbage collection promptness. Relying on garbage collection to manage resources other than memory is almost always a bad idea.</p><p>In previous releases of Java Hotspot VM, the class metadata was allocated in the so-called permanent generation. Starting with JDK 8, the permanent generation was removed and the class metadata is allocated in native memory</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jvm </tag>
            
            <tag> gc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>J.U.C_InterruptedException</title>
      <link href="/2019/06/16/J-U-C-InterruptedException/"/>
      <url>/2019/06/16/J-U-C-InterruptedException/</url>
      
        <content type="html"><![CDATA[<p><img src="http://ww1.sinaimg.cn/large/006tNc79gy1g432asdjwvj30u00k040o.jpg" alt="https://image.ipaiban.com/upload-ueditor-image-20190608-1559957563271017590.jpg"></p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>â€‹    å‰å‡ å¤©åœ¨çœ‹JSR-133çš„æ—¶å€™å‘ç° ,Sleepå’ŒYield ,ç„¶åå¿½ç„¶æƒ³èµ·Thread çº¿ç¨‹ä¸­æœ‰å‡ ä¸ªè¢«@Deprecation çš„æ–¹æ³•,</p><p>ä¸»è¦æœ‰å¦‚ä¸‹å‡ ä¸ª<code>suspended</code>ã€<code>stop</code>  ã€ <code>resume</code> å®˜æ–¹çš„è§£é‡Šå¦‚ä¸‹:</p><blockquote><p>Why are <code>Thread.suspend</code> and <code>Thread.resume</code> deprecated?</p><p><code>Thread.suspend</code> is inherently deadlock-prone. If the target thread holds a lock on the monitor protecting a critical system resource when it is suspended, no thread can access this resource until the target thread is resumed. If the thread that would resume the target thread attempts to lock this monitor prior to calling <code>resume</code>, deadlock results. Such deadlocks typically manifest themselves as â€œfrozenâ€ processes.</p></blockquote><p>åŸå› å°±æ˜¯ä¼šæœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜(æ­»é”), <code>suspended</code> æœŸé—´è¿˜æ˜¯ä¼šå æœ‰é”,<a href="https://docs.oracle.com/javase/8/docs/technotes/guides/concurrency/threadPrimitiveDeprecation.html" target="_blank" rel="noopener">æ›´å¤šç›¸å…³</a></p><p>ç„¶åå°±çœ‹åˆ°äº†<code>InterruptedException</code>è¿™ä¸ªå¼‚å¸¸. ä¹‹å‰äº†è§£è¿‡,ä½†æ˜¯æ²¡æœ‰æ·±å…¥ç†è§£.æ‰€ä»¥å°±æ‰“ç®—å¥½å¥½äº†è§£ä¸‹è®°å½•</p><h2 id="java-lang-Thread-interrupt"><a href="#java-lang-Thread-interrupt" class="headerlink" title="java.lang.Thread#interrupt"></a>java.lang.Thread#interrupt</h2><p>é¦–å…ˆå…ˆæ¥çœ‹çœ‹çº¿ç¨‹ç›¸å…³çš„æ–¹æ³•,ä¸­æ–­çº¿ç¨‹, </p><pre><code class="java">    public void interrupt() {        if (this != Thread.currentThread())            checkAccess();        synchronized (blockerLock) {            Interruptible b = blocker;            if (b != null) {                interrupt0();           // Just to set the interrupt flag                b.interrupt(this);                return;            }        }        interrupt0();    }</code></pre><p>å½“ç„¶è¿™ä¸ªinterruptçš„ä½œç”¨åªæ˜¯æŠŠçº¿ç¨‹è®¾ç½®ä¸€ä¸ªæ ‡è®°, Just to set the interrupt flag </p><p>è‡³äºè¿™é‡Œä¸ºä»€ä¹ˆåªæ˜¯è®¾ç½®äº†ä¸€ä¸ªæ ‡è®°, åœ¨core javaä¸­æœ‰æåˆ°</p><blockquote><p>There is no language requirement that a thread which is interrupted should ter- minate. Interrupting a thread simply grabs its attention. The interrupted thread can decide how to react to the interruption. </p></blockquote><p>å³ä»€ä¹ˆæ—¶å€™ç»ˆæ­¢, åº”è¯¥ç”±è¢«ä¸­æ–­çš„çº¿ç¨‹å»å¤„ç†,æ‰€ä»¥ä½¿ç”¨è¿™ä¸ªçš„åœºæ™¯ä¸€èˆ¬é…åˆ<code>Thread.currentThread().isInterrupted()</code> æ¥åˆ¤æ–­æ ‡è®°ä½(æ³¨æ„æ ‡è®° é»˜è®¤ä¸º false),é€€å‡ºå¾ªç¯ ,ä½†æ˜¯å¦‚æœä¸­æ–­çš„æ˜¯waitã€sleep ç­‰é˜»å¡çŠ¶æ€ç­‰çº¿ç¨‹,åˆ™ä¼šæŠ›å‡ºInterruptedException</p><h2 id="InterruptedExceptionæ˜¯ä»€ä¹ˆ"><a href="#InterruptedExceptionæ˜¯ä»€ä¹ˆ" class="headerlink" title="InterruptedExceptionæ˜¯ä»€ä¹ˆ"></a>InterruptedExceptionæ˜¯ä»€ä¹ˆ</h2><p>ç›´æ¥çœ‹ç±»çš„è§£é‡Š</p><pre><code class="java">package java.lang;/** * Thrown when a thread is waiting, sleeping, or otherwise occupied, * and the thread is interrupted, either before or during the activity. * Occasionally a method may wish to test whether the current * thread has been interrupted, and if so, to immediately throw * this exception.  The following code can be used to achieve * this effect: * &lt;pre&gt; *  if (Thread.interrupted())  // Clears interrupted status! *      throw new InterruptedException(); * &lt;/pre&gt; * * @author  Frank Yellin * @see     java.lang.Object#wait() * @see     java.lang.Object#wait(long) * @see     java.lang.Object#wait(long, int) * @see     java.lang.Thread#sleep(long) * @see     java.lang.Thread#interrupt() * @see     java.lang.Thread#interrupted() * @since   JDK1.0 */publicclass InterruptedException extends Exception {    private static final long serialVersionUID = 6700697376100628473L;    /**     * Constructs an &lt;code&gt;InterruptedException&lt;/code&gt; with no detail  message.     */    public InterruptedException() {        super();    }    /**     * Constructs an &lt;code&gt;InterruptedException&lt;/code&gt; with the     * specified detail message.     *     * @param   s   the detail message.     */    public InterruptedException(String s) {        super(s);    }}</code></pre><p>ç®€å•ç›´è¯‘å°±æ˜¯è¢«ä¸­æ–­çš„å¼‚å¸¸. å¦‚æœå½“å‰çº¿ç¨‹å¤„äºé˜»å¡çŠ¶æ€,sleep ã€waitæ—¶å€™ è¢«å…¶ä»–çº¿ç¨‹ä¸­æ–­äº†,å°±ä¼šæŠ›å‡ºè¯¥å¼‚å¸¸  </p><p>ä¸‹é¢æˆ‘ä»¬å†çœ‹çœ‹waitæ–¹æ³•å¯¹å…¶ä¸­çš„è§£é‡Š</p><pre><code class="java"> /**     * Causes the current thread to wait until another thread invokes the     * {@link java.lang.Object#notify()} method or the     * {@link java.lang.Object#notifyAll()} method for this object.     * In other words, this method behaves exactly as if it simply     * performs the call {@code wait(0)}.     * &lt;p&gt;     * The current thread must own this object&#39;s monitor. The thread     * releases ownership of this monitor and waits until another thread     * notifies threads waiting on this object&#39;s monitor to wake up     * either through a call to the {@code notify} method or the     * {@code notifyAll} method. The thread then waits until it can     * re-obtain ownership of the monitor and resumes execution.     * &lt;p&gt;     * As in the one argument version, interrupts and spurious wakeups are     * possible, and this method should always be used in a loop:     * &lt;pre&gt;     *     synchronized (obj) {     *         while (&amp;lt;condition does not hold&amp;gt;)     *             obj.wait();     *         ... // Perform action appropriate to condition     *     }     * &lt;/pre&gt;     * This method should only be called by a thread that is the owner     * of this object&#39;s monitor. See the {@code notify} method for a     * description of the ways in which a thread can become the owner of     * a monitor.     *     * @throws  IllegalMonitorStateException  if the current thread is not     *               the owner of the object&#39;s monitor.     * @throws  InterruptedException if any thread interrupted the     *             current thread before or while the current thread     *             was waiting for a notification.  The &lt;i&gt;interrupted     *             status&lt;/i&gt; of the current thread is cleared when     *             this exception is thrown.     * @see        java.lang.Object#notify()     * @see        java.lang.Object#notifyAll()     */    public final void wait() throws InterruptedException {        wait(0);    }</code></pre><p>æ³¨æ„ä¸€ç‚¹,waitä¼šæŠ›å‡ºä¸¤ä¸ªå¼‚å¸¸,å…¶ä¸­ <code>IllegalMonitorStateException</code> æ˜¯å¦‚æœå½“å‰çº¿ç¨‹æ²¡æœ‰è·å–åˆ°å¯¹è±¡çš„monitor,ç„¶åä½¿ç”¨å¯¹è±¡çš„waitæ–¹æ³•æ—¶å°±ä¼šå‡ºç°</p><p>å¦ä¸€ä¸ªå°±æ˜¯æˆ‘ä»¬çš„<code>InterruptedException</code> äº† ,è¿™é‡Œçš„è§£é‡Šä¹Ÿæ˜¯å’Œä¸Šé¢ä¸€æ ·å°±ä¸åšé‡å¤èµ˜è¿°äº†.</p><p><strong>ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯æœ‰ä¸€å¥</strong></p><blockquote><p>The interrupted  status of the current thread is cleared when this exception is thrown.</p></blockquote><p>ä¹Ÿå°±æ˜¯çº¿ç¨‹ä¸­æ–­æ ‡è®°ä½ä¼šè¢«é‡ç½® ,æ‰€ä»¥å¯ä»¥çœ‹åˆ°å¦‚æœå¯¹è¿™ä¸ªå¼‚å¸¸ä¸åšå¤„ç†,é‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å¯èƒ½æ°¸è¿œéƒ½ä¸èƒ½è¢«ä¸­æ–­</p><h2 id="ä¸¾ä¸ªæ —å­"><a href="#ä¸¾ä¸ªæ —å­" class="headerlink" title="ä¸¾ä¸ªæ —å­"></a>ä¸¾ä¸ªæ —å­</h2><pre><code> å½“æˆ‘ä»¬åœ¨ä½¿ç”¨å¤šçº¿ç¨‹å¹¶å‘è°ƒåº¦çš„æ—¶å€™, (å¤šçº¿ç¨‹çš„ä½¿ç”¨åœºæ™¯ä¸€èˆ¬ç”¨åœ¨IOé˜»å¡æ¯”è¾ƒå¤šçš„æƒ…å†µ) ä¸ºäº†é˜²æ­¢çº¿ç¨‹çš„é¢‘ç¹åˆ›å»ºå¸¦æ¥çš„æŸè€—,ä¸€èˆ¬ä¼šä½¿ç”¨ `ThreadPoolExecutor`  </code></pre><pre><code class="java">public ThreadPoolExecutor(int corePoolSize,int maximumPoolSize,long keepAliveTime,TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue,ThreadFactory threadFactory) {        this(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue,             threadFactory, defaultHandler);}</code></pre><p><a href="[https://zyumin.github.io/2019/06/06/java%E5%B9%B6%E5%8F%91%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/#%E4%BD%BF%E7%94%A8](https://zyumin.github.io/2019/06/06/javaå¹¶å‘æ·±å…¥æµ…å‡º/#ä½¿ç”¨">å…³äºThreadPoolExecutorçš„ä½¿ç”¨ç»†èŠ‚</a>)</p><p>å½“å®¹å™¨é€€å‡ºçš„æ—¶å€™,é‚£ä¹ˆæˆ‘ä»¬åº”è¯¥å¦‚ä½•åœæ­¢è¿™ä¸ªçº¿ç¨‹æ± çš„ä»»åŠ¡</p><h3 id="Graceful-stop"><a href="#Graceful-stop" class="headerlink" title="Graceful stop"></a>Graceful stop</h3><p>â€‹    æ—¢ç„¶æåˆ°äº†graceful ,åœ¨å¹³æ—¶å·¥ä½œä¸­,æˆ‘ä»¬ä¸èƒ½å› ä¸ºå®¹å™¨çš„é€€å‡º,è€Œå¯¼è‡´è¿è¡Œä¸­çš„ä»»åŠ¡æ‰§è¡Œå¤±è´¥,å¼ºåˆ¶é€€å‡º,ä¸€èˆ¬ä¼šé€šè¿‡é’©å­æ–¹æ³•</p><pre><code class="java">    Runtime.getRuntime().addShutdownHook(new Thread() {    @Override    public void run() {        try {            logger.info(&quot;stop the Executor....&quot;);            shutDown();        } catch (Exception e) {            logger.error(&quot;shutDown error,msg:&quot;, e);        }    }});</code></pre><p>â€‹    åœ¨<code>ThreadPoolExecutor</code>ä¸­,æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>java.util.concurrent.ThreadPoolExecutor#shutdown</code>  æ–¹æ³•</p><p>ä½†æ˜¯å¯¹äºä¸‹é¢çš„è¿™ç§<code>Runnable</code> ,æ˜¯åœæ­¢ä¸äº†çš„</p><pre><code class="java">public class Worker implements Runnable {    @Override    public void run() {         while (true) {             dosomething();         }    }}</code></pre><h4 id="å¸¸è§çš„åšæ³•"><a href="#å¸¸è§çš„åšæ³•" class="headerlink" title="å¸¸è§çš„åšæ³•"></a>å¸¸è§çš„åšæ³•</h4><p>æ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬ä¼šé€šè¿‡è®¾ç½®ä¸€ä¸ªæ¡ä»¶å˜é‡åˆ¤æ–­</p><pre><code class="java">public class Worker implements Runnable {    private volatile boolean stopFlag =  false;    public void stop(){        stopFlag = true;    }    @Override    public void run() {        while (stopFlag) {            dosomething();        }    }}</code></pre><h4 id="æ›´ä¸ºé€šç”¨çš„åšæ³•"><a href="#æ›´ä¸ºé€šç”¨çš„åšæ³•" class="headerlink" title="æ›´ä¸ºé€šç”¨çš„åšæ³•"></a>æ›´ä¸ºé€šç”¨çš„åšæ³•</h4><p>ä½†æ˜¯è¿™ç§æ–¹å¼å¾ˆéº»çƒ¦,éœ€è¦éå†çº¿ç¨‹æ± å»è°ƒç”¨stopæ–¹æ³•,æ‰€ä»¥æ›´ä¸ºé€šç”¨çš„æ–¹æ³•æ˜¯åˆ©ç”¨interrupted æ ‡è®°æ¥å¤„ç†</p><pre><code class="java">public class Worker implements Runnable {//        private volatile boolean stopFlag =  false;//        public void stop(){//            stopFlag = true;//        }    @Override    public void run() {        while (!Thread.currentThread().isInterrupted()) {            System.out.println(&quot;i&#39;m running &quot; + Thread.currentThread().getName());        }    }}</code></pre><p>è¿™ä¸ªæ—¶å€™è°ƒç”¨ <code>java.util.concurrent.ThreadPoolExecutor#shutdown</code> ä¼šå‘ç°çº¿ç¨‹æ²¡æœ‰åœä¸‹æ¥,é‚£ä¹ˆä¸ºä»€ä¹ˆæ ‡è®°ä½æ²¡æœ‰è¢«è®¾ç½®~</p><h3 id="shutdown-å’Œ-shutdownNow"><a href="#shutdown-å’Œ-shutdownNow" class="headerlink" title="shutdown å’Œ shutdownNow"></a>shutdown å’Œ shutdownNow</h3><h4 id="shutdown"><a href="#shutdown" class="headerlink" title="shutdown"></a>shutdown</h4><p>ä¸Šé¢ä¸ºä»€ä¹ˆæ²¡æœ‰åœä¸‹æ¥,debugè¿›å…¥shutdown</p><pre><code class="java">public void shutdown() {    final ReentrantLock mainLock = this.mainLock;    mainLock.lock();    try {        checkShutdownAccess();        advanceRunState(SHUTDOWN);        interruptIdleWorkers();        onShutdown(); // hook for ScheduledThreadPoolExecutor    } finally {        mainLock.unlock();    }    tryTerminate();}</code></pre><p>å†è¿›å…¥interruptIdleWorkers,ä¼šå‘ç°éå†workerè¿›è¡Œinterrupt</p><pre><code class="java">private void interruptIdleWorkers(boolean onlyOne) {    final ReentrantLock mainLock = this.mainLock;    mainLock.lock();    try {        for (Worker w : workers) {            Thread t = w.thread;            if (!t.isInterrupted() &amp;&amp; w.tryLock()) {                try {                    t.interrupt();                } catch (SecurityException ignore) {                } finally {                    w.unlock();                }            }            if (onlyOne)                break;        }    } finally {        mainLock.unlock();    }}</code></pre><p>å‘ç° <code>w.tryLock()</code> è¿”å›false ,è¿™é‡Œå–ä¸åˆ°é”çš„åŸå› æ˜¯å› ä¸ºThreadPoolExecutor å†…éƒ¨å°è£…äº†Worker, Workeråœ¨è¿è¡Œçš„æ—¶å€™ä¼šè°ƒç”¨w.lock(); </p><pre><code class="java">final void runWorker(Worker w) {    Thread wt = Thread.currentThread();    Runnable task = w.firstTask;    w.firstTask = null;    w.unlock(); // allow interrupts    boolean completedAbruptly = true;    try {        while (task != null || (task = getTask()) != null) {            w.lock();            // If pool is stopping, ensure thread is interrupted;            // if not, ensure thread is not interrupted.  This            // requires a recheck in second case to deal with            // shutdownNow race while clearing interrupt            if ((runStateAtLeast(ctl.get(), STOP) ||                 (Thread.interrupted() &amp;&amp;                  runStateAtLeast(ctl.get(), STOP))) &amp;&amp;                !wt.isInterrupted())                wt.interrupt();            try {                beforeExecute(wt, task);                Throwable thrown = null;                try {                    task.run();                } catch (RuntimeException x) {                    thrown = x; throw x;                } catch (Error x) {                    thrown = x; throw x;                } catch (Throwable x) {                    thrown = x; throw new Error(x);                } finally {                    afterExecute(task, thrown);                }            } finally {                task = null;                w.completedTasks++;                w.unlock();            }        }        completedAbruptly = false;    } finally {        processWorkerExit(w, completedAbruptly);    }}</code></pre><p>æ‰€ä»¥,shutdownæ–¹æ³• æ˜¯ä¸ä¼šå¯¹è¿è¡Œä¸­çš„çº¿ç¨‹è®¾ç½®æ ‡è®°ä½</p><h4 id="shutdownNow"><a href="#shutdownNow" class="headerlink" title="shutdownNow"></a>shutdownNow</h4><p> <code>java.util.concurrent.ThreadPoolExecutor#shutdownNow</code>  , æ³¨æ„è¿™ä¸ªæ–¹æ³•å¹¶ä¸æ˜¯å¼ºåˆ¶é€€å‡ºå“ˆ, å®ƒå’Œ shutdownåŒºåˆ«å¦‚ä¸‹</p><ul><li>åªæ˜¯å®ƒä¼šå¯¹è¿è¡Œä¸­çš„çº¿ç¨‹è®¾ç½®ä¸­æ–­æ ‡è®°</li><li>è¿˜æœ‰ä¸å†æ‰§è¡Œç­‰å¾…é˜Ÿåˆ—çš„ä»»åŠ¡,è¿”å›æœªæ‰§è¡Œä»»åŠ¡</li></ul><pre><code class="java">public List&lt;Runnable&gt; shutdownNow() {    List&lt;Runnable&gt; tasks;    final ReentrantLock mainLock = this.mainLock;    mainLock.lock();    try {        checkShutdownAccess();        advanceRunState(STOP);        interruptWorkers();        tasks = drainQueue();    } finally {        mainLock.unlock();    }    tryTerminate();    return tasks;}/** * Drains the task queue into a new list, normally using * drainTo. But if the queue is a DelayQueue or any other kind of * queue for which poll or drainTo may fail to remove some * elements, it deletes them one by one. */private List&lt;Runnable&gt; drainQueue() {    BlockingQueue&lt;Runnable&gt; q = workQueue;    ArrayList&lt;Runnable&gt; taskList = new ArrayList&lt;Runnable&gt;();    q.drainTo(taskList);    if (!q.isEmpty()) {        for (Runnable r : q.toArray(new Runnable[0])) {            if (q.remove(r))                taskList.add(r);        }    }    return taskList;}</code></pre><p>æ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥æ„‰å¿«çš„ä½¿ç”¨<code>shutdownNow</code> å’Œ  <code>Thread.currentThread().isInterrupted()</code></p><p>æœ€åå†æé†’ä¸€æ³¢,ä¸è¦å¿˜è®°å¯¹InterruptedExceptionçš„å¤„ç†</p>]]></content>
      
      
      <categories>
          
          <category> jdk </category>
          
      </categories>
      
      
        <tags>
            
            <tag> juc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spec_JSR133</title>
      <link href="/2019/06/14/Spec-JSR133/"/>
      <url>/2019/06/14/Spec-JSR133/</url>
      
        <content type="html"><![CDATA[<p><img src="http://ww2.sinaimg.cn/large/006tNc79gy1g42sqb05mrj30qo0hnaem.jpg" alt="image-20190616103858903"></p><a id="more"></a><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>Memory Model and Thread Specification , å†…å­˜æ¨¡å‹å’Œçº¿ç¨‹è§„èŒƒ </p><p>These semantics do not describe how a multithreaded program should be executed. Rather,they describe the behaviors that multithreaded programs are allowed to exhibit</p><p>è§„èŒƒçš„æ ‡å‡†å†…å®¹å°†åˆå¹¶åˆ°<em>JavaTMè¯­è¨€è§„èŒƒ</em>ã€<em>JavaTMè™šæ‹Ÿæœºè§„èŒƒ</em>ä»¥åŠ<code>java.lang</code>åŒ…çš„ç±»è¯´æ˜ä¸­</p><p>å› ä¸ºçº¿ç¨‹çš„è¡Œä¸ºï¼Œå°¤å…¶æ˜¯æœªæ­£ç¡®åŒæ­¥æ—¶çš„è¡Œä¸ºï¼Œå¯èƒ½ä¼šè®©äººå›°æƒ‘å’Œè¿èƒŒç›´è§‰ ,æ‰€ä»¥è§„èŒƒè§„å®šäº†</p><ul><li>ç”¨äºå±è”½æ‰å„ç§ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿçš„å†…å­˜è®¿é—®å·®å¼‚ï¼Œä»¥å®ç°è®©Javaç¨‹åºåœ¨å„ç§å¹³å°ä¸‹éƒ½èƒ½è¾¾åˆ°ä¸€è‡´çš„å¹¶å‘æ•ˆæœ</li><li>è§„å®šäº†ä¸€ä¸ªçº¿ç¨‹å¦‚ä½•å’Œä½•æ—¶å¯ä»¥çœ‹åˆ°ç”±å…¶ä»–çº¿ç¨‹ä¿®æ”¹è¿‡åçš„å…±äº«å˜é‡çš„å€¼ï¼Œä»¥åŠåœ¨å¿…é¡»æ—¶å¦‚ä½•åŒæ­¥çš„è®¿é—®å…±äº«å˜é‡ã€‚</li></ul><h2 id="Locks"><a href="#Locks" class="headerlink" title="Locks"></a>Locks</h2><blockquote><p> There are multiple mechanisms for communicating between threads.most basic of these<br>methods is synchronization, which is implemented using monitors. </p><p>Each object is associated witha monitor, which a thread can lock or unlock.</p><p> Only one thread at a time may hold a lock on amonitor.</p><p> Any other threads attempting to lock that monitor are blocked until they can obtain a<br>lock on that monitor.</p><p>Other mechanisms, such as reads and writes of volatile variables and classes provided in the<br>java.util.concurrent package, provide alternative mechanisms for synchronization.</p></blockquote><p>åŒæ­¥è¯­ä¹‰çš„å®ç°  synchronized çš„å®ç°,volatile,juc åŒ…</p><h2 id="Incorrectly-Synchronized-Programs-Exhibit-Surprising-Behav-iors"><a href="#Incorrectly-Synchronized-Programs-Exhibit-Surprising-Behav-iors" class="headerlink" title="Incorrectly Synchronized Programs Exhibit Surprising Behav-iors"></a>Incorrectly Synchronized Programs Exhibit Surprising Behav-iors</h2><blockquote><p>The semantics of the Java programming language allow compilers and microprocessors to perform optimizations that can interact with incorrectly synchronized code in ways that can produce behaviors that seem paradoxical.</p><p>However,it was forbidden by the original Java memory model in the JLS and JVMS: this was one of the first indications that the original JMM needed to be replaced.</p></blockquote><p>Java çš„è¯­ä¹‰å…è®¸ç¼–è¯‘å™¨å’Œå¾®å¤„ç†å™¨è¿›è¡Œä¼˜åŒ–ã€é‡æ’ ä¼šæ”¹å˜è¯­ä¹‰,æ‰€ä»¥éœ€è¦é‡æ–°å®šä¹‰JMMå†…å­˜æ¨¡å‹</p><h2 id="Informal-Semantics"><a href="#Informal-Semantics" class="headerlink" title="Informal Semantics"></a>Informal Semantics</h2><p>There are two key ideas to understanding whether a program is correctly synchronized:</p><ol><li>Conflicting Accesses</li><li>Happens-Before Relationship</li></ol><p>There are a number of ways to induce a happens-before ordering, including: </p><ul><li><p>Each action in a thread happens-before every subsequent action in that thread. â€¢ An unlock on a monitor happens-before every subsequent lock on that monitor. â€¢ A write to a volatile field happens-before every subsequent read of that volatile. </p></li><li><p>A call to start() on a thread happens-before any actions in the started thread. </p></li><li>All actions in a thread happen-before any other thread successfully returns from a join() on that thread. </li><li>If an action a happens-before an action b, and b happens before an action c, then a happens- before c. </li></ul><blockquote><p>When a program contains two conflicting accesses that are not ordered by a happens-before relationship, it is said to contain a data race. </p></blockquote><p>ç†è§£ä¸€ä¸ªç¨‹åºæ˜¯å¦è¢«æ­£ç¡®çš„åŒæ­¥äº†ï¼Œæœ‰ä¸¤ä¸ªå…³é”®æ¦‚å¿µ: å†²çªè®¿é—®å’ŒH-B</p><blockquote><p>Sequential Consistency</p><p> As noted before, sequential consistency and/or freedom from data races still allows errors arising from<br>groups of operations that need to be perceived atomically and are not.</p><p>If we were to use sequential consistency as our memory model, many of the compiler and<br>processor optimizations that we have discussed would be illegal.</p><p>Final Fields</p></blockquote><p>é¡ºåºä¸€è‡´æ€§æ¨¡å‹ ä¹Ÿä¸èƒ½è§£å†³è¯­ä¹‰é—®é¢˜,åŒæ—¶è¿˜ä¼šè®©ä¼˜åŒ–å¤±æ•ˆ</p><h2 id="What-is-a-Memory-Model"><a href="#What-is-a-Memory-Model" class="headerlink" title="What is a Memory Model?"></a>What is a Memory Model?</h2><blockquote><p>A memory model describes, given a program and an execution trace of that program, whether<br>the execution trace is a legal execution of the program. For the Java programming language, the<br>memory model works by examining each read in an execution trace and checking that the write<br>observed by that read is valid according to certain rules.</p></blockquote><p>å†…å­˜æ¨¡å‹ æè¿°ç¨‹åºçš„æ‰§è¡Œè¡Œä¸ºæ˜¯å¦åˆæ³• å¯¹äºJava æ¥è¯´,å†…å­˜å…±äº«å‹, éœ€è¦å…³æ³¨çš„æ˜¯å½“å‰çº¿ç¨‹è¯»å–åˆ°çš„ä¿¡æ¯æ˜¯å¦æ˜¯æœ€æ–°çš„, å› ä¸ºå„ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªæœ¬åœ°ç¼“å­˜(æ ˆã€cpuç¼“å­˜),é€šè¿‡å †æ¥å…±äº«</p><p><img src="http://ww3.sinaimg.cn/large/006tNc79gy1g40xyu6xf8j30cb0amq36.jpg" alt="img"></p><h2 id="Definitions"><a href="#Definitions" class="headerlink" title="Definitions"></a>Definitions</h2><p>Shared variables/Heap memory  å…±äº«å˜é‡/å †å†…å­˜</p><p> Inter-thread Actions çº¿ç¨‹é—´çš„åŠ¨ä½œ</p><p>Program Order ç¨‹åºé¡ºåº</p><p>Intra-thread semantics çº¿ç¨‹å†…è¯­ä¹‰</p><p>Synchronization Actions  åŒæ­¥åŠ¨ä½œ</p><p>Synchronization Order  åŒæ­¥é¡ºåº</p><p>Happens-Before and Synchronizes-With Edges  Happens-Before ä¸ Synchronizes-With è¾¹ç¼˜</p><p> synchronizes-withï¼ŒåŒæ­¥åŠ¨ä½œä¸Šçš„ååºå…³ç³»ã€‚ </p><p>happens-beforeï¼ŒåŠ¨ä½œä¸Šçš„ååºå…³ç³»ã€‚</p><h2 id="Approximations-to-a-Java-Memory-Model"><a href="#Approximations-to-a-Java-Memory-Model" class="headerlink" title="Approximations to a Java Memory Model"></a>Approximations to a Java Memory Model</h2><ul><li>Sequential Consistency Memory Model</li><li>Happens-Before Memory Model</li><li>Causality<ul><li>Happens-Before is too Weak</li><li>Causality is Subtle</li></ul></li></ul><p>é¡ºåºä¸€è‡´æ€§æ¨¡å‹ çº¦æŸå¤ªå¼ºäº†,ä¸åˆ©äºä¼˜åŒ–</p><p>Happens-Before å¤ªå¼±äº†,æ‰§è¡Œç»“æœä¸å¯é¢„æµ‹ </p><p>Happens-before æ¨¡å‹æœ€è‡´å‘½çš„å¼±ç‚¹æ˜¯å…¶å…è®¸å€¼â€œå‡­ç©ºå‡ºç°(out of thin air)â€</p><h2 id="Word-Tearing"><a href="#Word-Tearing" class="headerlink" title="Word Tearing"></a>Word Tearing</h2><p>One implementation consideration for Java virtual machines is that every field and array element<br>is considered distinct; updates to one field or element must not interact with reads or updates<br>of any other field or element. In particular, two threads that update adjacent elements of a byte<br>array separately must not interfere or interact and do not need synchronization to ensure sequential<br>consistency.</p><h2 id="Non-atomic-Treatment-of-double-and-long"><a href="#Non-atomic-Treatment-of-double-and-long" class="headerlink" title="Non-atomic Treatment of double and long"></a>Non-atomic Treatment of double and long</h2><p>For efficiencyâ€™s sake, this<br>behavior is implementation specific; JavaTM virtual machines are free to perform writes to long<br>and double values atomically or in two parts.</p><p>Final Field Semantics ã€Fairnessã€Wait Sets and Notificationã€Sleep and Yieldã€Finalization</p><p>source :<a href="http://www.cs.umd.edu/~pugh/java/memoryModel/jsr133.pdf?spm=a2c4e.10696291.0.0.3c5419a4WH2pe1&amp;file=jsr133.pdf" target="_blank" rel="noopener">http://www.cs.umd.edu/~pugh/java/memoryModel/jsr133.pdf?spm=a2c4e.10696291.0.0.3c5419a4WH2pe1&amp;file=jsr133.pdf</a></p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jvm </tag>
            
            <tag> Spec </tag>
            
            <tag> thread </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Overview_JDK</title>
      <link href="/2019/06/13/Overview_JDK/"/>
      <url>/2019/06/13/Overview_JDK/</url>
      
        <content type="html"><![CDATA[<p><img src="http://ww4.sinaimg.cn/large/006tNc79gy1g3zrf66tunj30u00gvgmz.jpg" alt="img"></p><a id="more"></a><h1 id="åŸºç¡€æ¦‚å¿µ"><a href="#åŸºç¡€æ¦‚å¿µ" class="headerlink" title="åŸºç¡€æ¦‚å¿µ"></a>åŸºç¡€æ¦‚å¿µ</h1><p><img src="http://ww1.sinaimg.cn/large/006tNc79gy1g3zrgn8nvsj317s0ouagk.jpg" alt="image-20190613193823571"></p><p><a href="https://docs.oracle.com/javase/7/docs/technotes/guides/desc_jdk_structure.html" target="_blank" rel="noopener">https://docs.oracle.com/javase/7/docs/technotes/guides/desc_jdk_structure.html</a></p><p>å¹³æ—¶æ¥è§¦è¾ƒå¤šåº”è¯¥å°±æ˜¯å¦‚ä¸‹åŒ…Langã€Beansã€ioã€mathã€netã€securityã€sqlã€collections ç­‰</p><h2 id="JDK-Java-Development-ToolKit"><a href="#JDK-Java-Development-ToolKit" class="headerlink" title="JDK(Java Development ToolKit)"></a>JDK(Java Development ToolKit)</h2><p>åŒ…å«äº†Javaè¿è¡Œç¯å¢ƒï¼ˆJREï¼‰å’Œå¼€å‘å·¥å…·ï¼ˆç¼–è¯‘å™¨ï¼Œè°ƒè¯•å™¨ï¼Œjavadocç­‰ï¼‰ã€‚</p><p>javac å°†Javaä»£ç ç¼–è¯‘æˆå­—èŠ‚ç </p><h2 id="JRE-Java-Runtime-Environment"><a href="#JRE-Java-Runtime-Environment" class="headerlink" title="JRE(Java Runtime Environment)"></a>JRE(Java Runtime Environment)</h2><p>å®ƒä¸ºJavaæä¾›äº†è¿è¡Œç¯å¢ƒï¼Œå…¶ä¸­é‡è¦çš„ä¸€ç¯å°±æ˜¯é€šè¿‡JVMå°†å­—èŠ‚ç è§£é‡Šæˆå¯æ‰§è¡Œçš„æœºå™¨ç ã€‚<br> JREç”±JVMï¼ŒSEAPI (åŠ¨æ€é“¾æ¥åº“ã€javaåŒ…)</p><h2 id="JVM-Java-Virtual-Machine"><a href="#JVM-Java-Virtual-Machine" class="headerlink" title="JVM(Java Virtual Machine)"></a>JVM(Java Virtual Machine)</h2><p>Javaè™šæ‹Ÿæœºï¼Œå¯ä»¥çœ‹åšæ˜¯ä¸€å°<em>æŠ½è±¡åŒ–çš„è®¡ç®—æœº</em>ï¼Œå®ƒæœ‰ä¸€å¥—å®Œæ•´çš„ä½“ç³»æ¶æ„ï¼ŒåŒ…æ‹¬å¤„ç†å™¨ã€å †æ ˆ ã€å¯„å­˜å™¨ç­‰ã€‚<br>åœ¨è¿è¡Œæ—¶ç¯å¢ƒï¼ŒJVMä¼šå°†Javaå­—èŠ‚ç è§£é‡Šæˆæœºå™¨ç ã€‚</p><p>æœºå™¨ç å’Œå¹³å°ç›¸å…³çš„ï¼ˆä¸åŒç¡¬ä»¶ç¯å¢ƒã€ä¸åŒæ“ä½œç³»ç»Ÿï¼Œäº§ç”Ÿçš„æœºå™¨ç ä¸åŒï¼‰ï¼Œæ‰€ä»¥JVMåœ¨ä¸åŒå¹³å°æœ‰ä¸åŒçš„å®ç°ã€‚<br>ç›®å‰JDKé»˜è®¤ä½¿ç”¨çš„å®ç°æ˜¯Hotspot VMã€‚</p><h2 id="å®˜ç½‘ç»“æ„"><a href="#å®˜ç½‘ç»“æ„" class="headerlink" title="å®˜ç½‘ç»“æ„"></a>å®˜ç½‘ç»“æ„</h2><p>æœ€æ–°å®˜ç½‘æ–‡æ¡£</p><p><a href="https://docs.oracle.com/en/java/javase/12/" target="_blank" rel="noopener">https://docs.oracle.com/en/java/javase/12/</a></p><ul><li><p>Overview</p><ul><li><a href="https://www.oracle.com/technetwork/java/javase/12-relnote-issues-5211422.html" target="_blank" rel="noopener">Release Notes</a></li><li><a href="http://www.oracle.com/technetwork/java/javase/12-relnote-issues-5211422.html#NewFeature" target="_blank" rel="noopener">Whatâ€™s New</a></li><li><a href="https://www.oracle.com/pls/topic/lookup?ctx=javase12&amp;id=JSMIG-GUID-C25E2B1D-6C24-4403-8540-CFEA875B994A" target="_blank" rel="noopener">Migration Guide</a></li><li><a href="https://www.oracle.com/technetwork/java/javase/downloads/index.html" target="_blank" rel="noopener">Download the JDK</a></li><li><a href="https://www.oracle.com/pls/topic/lookup?ctx=javase12&amp;id=JSJIG-GUID-8677A77F-231A-40F7-98B9-1FD0B48C346A" target="_blank" rel="noopener">Install Guide</a></li><li><a href="https://www.oracle.com/pls/topic/lookup?ctx=javase12&amp;id=JSJIG-GUID-DCA60310-6565-4BB6-8D24-6FF07C1C4B4E" target="_blank" rel="noopener">Version String</a></li></ul></li><li><p>Tools</p><ul><li><p><a href="https://www.oracle.com/pls/topic/lookup?ctx=javase12&amp;id=JSWOR-GUID-55DE52DF-5774-4AAB-B334-E026FBAE6F34" target="_blank" rel="noopener">Tools Reference</a></p><p>1 Tools and Commands Reference<br>2 Main Tools to Create and Build Applications<br>3 Language Shell<br>4 Security Tools and Commands<br>5 Remote Method Invocation (RMI) Tools and Commands<br>6 Java Deployment Tools and Commands<br>7 Monitoring Tools and Commands<br>8 Java Accessibility Utilities and Commands<br>9 Troubleshooting Tools and Commands<br>10 Script Commands</p></li><li><p><a href="https://www.oracle.com/pls/topic/lookup?ctx=javase12&amp;id=JSHEL-GUID-630F27C8-1195-4989-9F6B-2C51D46F52C8" target="_blank" rel="noopener">JShell Userâ€™s Guide</a></p></li><li><a href="https://www.oracle.com/pls/topic/lookup?ctx=javase12&amp;id=JSJAV-GUID-7A344353-3BBF-45C4-8B28-15025DDCC643" target="_blank" rel="noopener">Javadoc Guide</a></li></ul></li><li><p>Language and Libraries</p><ul><li>Language Updates</li><li>Core Libraries</li><li>JDK HTTP Client</li><li><a href="https://docs.oracle.com/javase/tutorial/tutorialLearningPaths.html" target="_blank" rel="noopener">Java Tutorials</a></li><li>Modular JDK</li><li>Java Scripting Guide</li><li>Nashorn Userâ€™s Guide</li></ul></li><li><p>Specifications</p><ul><li><a href="https://docs.oracle.com/en/java/javase/12/docs/api/overview-summary.html" target="_blank" rel="noopener">API Documentation</a></li><li><a href="https://docs.oracle.com/javase/specs/index.html" target="_blank" rel="noopener">Language and VM</a></li><li><a href="https://docs.oracle.com/en/java/javase/12/docs/specs/security/standard-names.html" target="_blank" rel="noopener">Java Security Standard Algorithm Names</a></li><li><a href="https://docs.oracle.com/en/java/javase/12/docs/specs/jar/jar.html" target="_blank" rel="noopener">JAR</a></li><li><a href="https://docs.oracle.com/en/java/javase/12/docs/specs/jni/index.html" target="_blank" rel="noopener">Java Native Interface (JNI)</a></li><li><a href="https://docs.oracle.com/en/java/javase/12/docs/specs/jvmti.html" target="_blank" rel="noopener">JVM Tool Interface (JVM TI)</a></li><li><a href="https://docs.oracle.com/en/java/javase/12/docs/specs/serialization/index.html" target="_blank" rel="noopener">Serialization</a></li><li><a href="https://docs.oracle.com/en/java/javase/12/docs/specs/jdwp/jdwp-spec.html" target="_blank" rel="noopener">Java Debug Wire Protocol (JDWP)</a></li><li><a href="https://docs.oracle.com/en/java/javase/12/docs/specs/doc-comment-spec.html" target="_blank" rel="noopener">Standard Doclet</a></li></ul></li><li><p>Security</p><ul><li><a href="https://www.oracle.com/technetwork/java/seccodeguide-139067.html" target="_blank" rel="noopener">Secure Coding Guidelines</a></li><li><a href="https://www.oracle.com/pls/topic/lookup?ctx=javase12&amp;id=JSSEC-GUID-2EF91196-D468-4D0F-8FDC-DA2BEA165D10" target="_blank" rel="noopener">Security Guide</a></li></ul></li><li><p>HotSpot Virtual Machine</p><ul><li><a href="https://www.oracle.com/pls/topic/lookup?ctx=javase12&amp;id=JSJVM-GUID-982B244A-9B01-479A-8651-CB6475019281" target="_blank" rel="noopener">Java Virtual Machine Guide</a></li><li><a href="https://www.oracle.com/pls/topic/lookup?ctx=javase12&amp;id=JSGCT-GUID-326EB4CF-8C8C-4267-8355-21AB04F0D304" target="_blank" rel="noopener">Garbage Collection Tuning</a></li><li><a href="https://www.oracle.com/pls/topic/lookup?ctx=javase12&amp;id=JRHMG107" target="_blank" rel="noopener">JRockit to HotSpot Migration Guide</a></li></ul></li><li><p>Manage and Troubleshoot</p><ul><li><a href="https://www.oracle.com/pls/topic/lookup?ctx=javase12&amp;id=JSJMX-GUID-72DCB4C1-93F8-4F37-B46E-2C708139C8A5" target="_blank" rel="noopener">JMX Guide</a></li></ul></li><li><p>Client Technologies</p></li></ul><h2 id="OpenJDK"><a href="#OpenJDK" class="headerlink" title="OpenJDK"></a>OpenJDK</h2><p>openJDKä¸‹è½½<br><a href="http://hg.openjdk.java.net/jdk8u/jdk8u60/hotspot/archive/37240c1019fd.tar.gz" target="_blank" rel="noopener">http://hg.openjdk.java.net/jdk8u/jdk8u60/hotspot/archive/37240c1019fd.tar.gz</a><br><a href="http://hg.openjdk.java.net/jdk8u/jdk8u60/jdk/archive/tip.tar.gz" target="_blank" rel="noopener">http://hg.openjdk.java.net/jdk8u/jdk8u60/jdk/archive/tip.tar.gz</a></p><p>ä¾‹å¦‚,æˆ‘ä»¬æƒ³çœ‹<code>java.lang.Thread#sleep(long)</code>çš„å®ç°</p><pre><code class="java">/** * Causes the currently executing thread to sleep (temporarily cease * execution) for the specified number of milliseconds, subject to * the precision and accuracy of system timers and schedulers. The thread * does not lose ownership of any monitors. * * @param  millis *         the length of time to sleep in milliseconds * * @throws  IllegalArgumentException *          if the value of {@code millis} is negative * * @throws  InterruptedException *          if any thread has interrupted the current thread. The *          &lt;i&gt;interrupted status&lt;/i&gt; of the current thread is *          cleared when this exception is thrown. */public static native void sleep(long millis) throws InterruptedException;</code></pre><p>nativeæ–¹æ³•, å³æˆ‘ä»¬å¸¸è¯´çš„JNIâ€”â€”java native Interface ,è°ƒç”¨æœ¬åœ°æ¥å£,ä¸€èˆ¬æ˜¯å°†å…¶å®ƒç¼–ç¨‹è¯­è¨€(å¦‚ Cã€C++ å’Œæ±‡ç¼–è¯­è¨€ï¼‰é€šè¿‡ç¼–è¯‘ç”Ÿæˆçš„åŠ¨æ€é“¾æ¥åº“(ç¼–è¯‘è¿‡ç¨‹æ˜¯åˆ©ç”¨Cï¼C++ç¼–è¯‘å™¨å®ç°çš„ï¼Œåœ¨windowså¹³å°ä¸Šï¼Œç¼–è¯‘å’Œè¿æ¥çš„ç»“æœæ˜¯åŠ¨æ€é“¾æ¥åº“DLLæ–‡ä»¶ã€‚å½“è¦ä½¿ç”¨ç”Ÿæˆçš„åŠ¨æ€é“¾æ¥åº“æ—¶ï¼Œè°ƒç”¨è€…ç±»ä¸­éœ€è¦æ˜¾å¼è°ƒç”¨è¯¥é“¾æ¥åº“dllæ–‡ä»¶ã€‚)</p><p>è¿™äº›åŠ¨æ€é“¾æ¥åº“æ˜¯åœ¨JVMå¯åŠ¨çš„æ—¶å€™è£…è½½è¿›æ¥çš„.</p><blockquote><p><a href="https://zhuanlan.zhihu.com/p/25713880" target="_blank" rel="noopener">æ›´å¤šç›¸å…³</a> æˆ–é˜…è¯» JNIè§„èŒƒ</p></blockquote><p>å¥½äº†å›åˆ°æ­£é¢˜,é¦–å…ˆåœ¨ä¸‹è½½çš„jdkåŒ…ä¸­,ä»¥ä¸‹è·¯å¾„<code>src/share/native/java/lang/Thread.c</code></p><pre><code class="c">/* * Copyright (c) 1994, 2012, Oracle and/or its affiliates. All rights reserved. * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER. * * This code is free software; you can redistribute it and/or modify it * under the terms of the GNU General Public License version 2 only, as * published by the Free Software Foundation.  Oracle designates this * particular file as subject to the &quot;Classpath&quot; exception as provided * by Oracle in the LICENSE file that accompanied this code. * * This code is distributed in the hope that it will be useful, but WITHOUT * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License * version 2 for more details (a copy is included in the LICENSE file that * accompanied this code). * * You should have received a copy of the GNU General Public License version * 2 along with this work; if not, write to the Free Software Foundation, * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA. * * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA * or visit www.oracle.com if you need additional information or have any * questions. *//*- *      Stuff for dealing with threads. *      originally in threadruntime.c, Sun Sep 22 12:09:39 1991 */#include &quot;jni.h&quot;#include &quot;jvm.h&quot;#include &quot;java_lang_Thread.h&quot;#define THD &quot;Ljava/lang/Thread;&quot;#define OBJ &quot;Ljava/lang/Object;&quot;#define STE &quot;Ljava/lang/StackTraceElement;&quot;#define STR &quot;Ljava/lang/String;&quot;#define ARRAY_LENGTH(a) (sizeof(a)/sizeof(a[0]))static JNINativeMethod methods[] = {    {&quot;start0&quot;,           &quot;()V&quot;,        (void *)&amp;JVM_StartThread},    {&quot;stop0&quot;,            &quot;(&quot; OBJ &quot;)V&quot;, (void *)&amp;JVM_StopThread},    {&quot;isAlive&quot;,          &quot;()Z&quot;,        (void *)&amp;JVM_IsThreadAlive},    {&quot;suspend0&quot;,         &quot;()V&quot;,        (void *)&amp;JVM_SuspendThread},    {&quot;resume0&quot;,          &quot;()V&quot;,        (void *)&amp;JVM_ResumeThread},    {&quot;setPriority0&quot;,     &quot;(I)V&quot;,       (void *)&amp;JVM_SetThreadPriority},    {&quot;yield&quot;,            &quot;()V&quot;,        (void *)&amp;JVM_Yield},    {&quot;sleep&quot;,            &quot;(J)V&quot;,       (void *)&amp;JVM_Sleep},    {&quot;currentThread&quot;,    &quot;()&quot; THD,     (void *)&amp;JVM_CurrentThread},    {&quot;countStackFrames&quot;, &quot;()I&quot;,        (void *)&amp;JVM_CountStackFrames},    {&quot;interrupt0&quot;,       &quot;()V&quot;,        (void *)&amp;JVM_Interrupt},    {&quot;isInterrupted&quot;,    &quot;(Z)Z&quot;,       (void *)&amp;JVM_IsInterrupted},    {&quot;holdsLock&quot;,        &quot;(&quot; OBJ &quot;)Z&quot;, (void *)&amp;JVM_HoldsLock},    {&quot;getThreads&quot;,        &quot;()[&quot; THD,   (void *)&amp;JVM_GetAllThreads},    {&quot;dumpThreads&quot;,      &quot;([&quot; THD &quot;)[[&quot; STE, (void *)&amp;JVM_DumpThreads},    {&quot;setNativeName&quot;,    &quot;(&quot; STR &quot;)V&quot;, (void *)&amp;JVM_SetNativeThreadName},};#undef THD#undef OBJ#undef STE#undef STRJNIEXPORT void JNICALLJava_java_lang_Thread_registerNatives(JNIEnv *env, jclass cls){    (*env)-&gt;RegisterNatives(env, cls, methods, ARRAY_LENGTH(methods));}</code></pre><p>ä¸€èˆ¬ï¼Œä»jdkç›®å½•ä¸‹çš„nativeç›®å½•(å¯èƒ½è·Ÿoså¹³å°ç›¸å…³)ä¸‹æ ¹æ®åŒ…åè·¯å¾„å»æ‰¾ç›¸å…³çš„Classå.cæ–‡ä»¶(Thread.c)ï¼Œå¦‚ å³å¯æ‰¾åˆ°å¯¹åº”çš„nativeæ–¹æ³•ï¼›</p><p>å¦‚æœé—´æ¥è°ƒç”¨äº†hotspotçš„å®ç°(jvmä¼šä»¥åŠ¨æ€åº“çš„å½¢å¼è¢«åŠ è½½ï¼Œ<code>prims</code>å®šä¹‰äº†hotspotä¸å…¶ä»–æ¨¡å—çš„æ¥å£åŠå…¶å®ç°)ï¼Œé‚£ä¹ˆä»<code>hotspot/src/share/vm/prims/jvm.cpp</code>æ–‡ä»¶ä¸­å¯æ‰¾åˆ°JVM_XXXå‡½æ•°(ä¾‹å¦‚JVM_Sleep)çš„å®ç°ã€‚</p><pre><code class="c">JVM_ENTRY(void, JVM_Sleep(JNIEnv* env, jclass threadClass, jlong millis))  JVMWrapper(&quot;JVM_Sleep&quot;);  if (millis &lt; 0) {    THROW_MSG(vmSymbols::java_lang_IllegalArgumentException(), &quot;timeout value is negative&quot;);  }  if (Thread::is_interrupted (THREAD, true) &amp;&amp; !HAS_PENDING_EXCEPTION) {    THROW_MSG(vmSymbols::java_lang_InterruptedException(), &quot;sleep interrupted&quot;);  }  // Save current thread state and restore it at the end of this block.  // And set new thread state to SLEEPING.  JavaThreadSleepState jtss(thread);#ifndef USDT2  HS_DTRACE_PROBE1(hotspot, thread__sleep__begin, millis);#else /* USDT2 */  HOTSPOT_THREAD_SLEEP_BEGIN(                             millis);#endif /* USDT2 */  EventThreadSleep event;  if (millis == 0) {    // When ConvertSleepToYield is on, this matches the classic VM implementation of    // JVM_Sleep. Critical for similar threading behaviour (Win32)    // It appears that in certain GUI contexts, it may be beneficial to do a short sleep    // for SOLARIS    if (ConvertSleepToYield) {      os::yield();    } else {      ThreadState old_state = thread-&gt;osthread()-&gt;get_state();      thread-&gt;osthread()-&gt;set_state(SLEEPING);      os::sleep(thread, MinSleepInterval, false);      thread-&gt;osthread()-&gt;set_state(old_state);    }  } else {    ThreadState old_state = thread-&gt;osthread()-&gt;get_state();    thread-&gt;osthread()-&gt;set_state(SLEEPING);    if (os::sleep(thread, millis, true) == OS_INTRPT) {      // An asynchronous exception (e.g., ThreadDeathException) could have been thrown on      // us while we were sleeping. We do not overwrite those.      if (!HAS_PENDING_EXCEPTION) {        if (event.should_commit()) {          event.set_time(millis);          event.commit();        }#ifndef USDT2        HS_DTRACE_PROBE1(hotspot, thread__sleep__end,1);#else /* USDT2 */        HOTSPOT_THREAD_SLEEP_END(                                 1);#endif /* USDT2 */        // TODO-FIXME: THROW_MSG returns which means we will not call set_state()        // to properly restore the thread state.  That&#39;s likely wrong.        THROW_MSG(vmSymbols::java_lang_InterruptedException(), &quot;sleep interrupted&quot;);      }    }    thread-&gt;osthread()-&gt;set_state(old_state);  }  if (event.should_commit()) {    event.set_time(millis);    event.commit();  }#ifndef USDT2  HS_DTRACE_PROBE1(hotspot, thread__sleep__end,0);#else /* USDT2 */  HOTSPOT_THREAD_SLEEP_END(                           0);#endif /* USDT2 */JVM_END</code></pre><p>è´´ä¸ªHotspotç›®å½•ç»“æ„(openjdk/hotspot/src/share/tools/launcher/java.c,openjdk8 ä¸­ï¼Œè¿™ä¸ªå¯åŠ¨å™¨ä¸è§äº†ï¼Œè¢«æ”¾åœ¨ <code>openjdk/jdk</code> æ–‡ä»¶å¤¹ä¸‹)</p><pre><code>â”œâ”€agent                            Serviceability Agentçš„å®¢æˆ·ç«¯å®ç°â”œâ”€make                             ç”¨æ¥buildå‡ºHotSpotçš„å„ç§é…ç½®æ–‡ä»¶â”œâ”€src                              HotSpot VMçš„æºä»£ç â”‚  â”œâ”€cpu                            CPUç›¸å…³ä»£ç ï¼ˆæ±‡ç¼–å™¨ã€æ¨¡æ¿è§£é‡Šå™¨ã€adæ–‡ä»¶ã€éƒ¨åˆ†runtimeå‡½æ•°åœ¨è¿™é‡Œå®ç°ï¼‰â”‚  â”œâ”€os                             æ“ä½œç³»ç›¸å…³ä»£ç â”‚  â”œâ”€os_cpu                         æ“ä½œç³»ç»Ÿ+CPUçš„ç»„åˆç›¸å…³çš„ä»£ç â”‚  â””â”€share                          å¹³å°æ— å…³çš„å…±é€šä»£ç â”‚      â”œâ”€tools                        å·¥å…·â”‚      â”‚  â”œâ”€hsdis                      åæ±‡ç¼–æ’ä»¶â”‚      â”‚  â”œâ”€IdealGraphVisualizer       å°†serverç¼–è¯‘å™¨çš„ä¸­é—´ä»£ç å¯è§†åŒ–çš„å·¥å…·â”‚      â”‚  â”œâ”€launcher                   å¯åŠ¨ç¨‹åºâ€œjavaâ€â”‚      â”‚  â”œâ”€LogCompilation             å°†-XX:+LogCompilationè¾“å‡ºçš„æ—¥å¿—ï¼ˆhotspot.logï¼‰æ•´ç†æˆæ›´å®¹æ˜“é˜…è¯»çš„æ ¼å¼çš„å·¥å…·â”‚      â”‚  â””â”€ProjectCreator             ç”ŸæˆVisual Studioçš„projectæ–‡ä»¶çš„å·¥å…·â”‚      â””â”€vm                           HotSpot VMçš„æ ¸å¿ƒä»£ç â”‚          â”œâ”€adlc                       å¹³å°æè¿°æ–‡ä»¶ï¼ˆä¸Šé¢çš„cpuæˆ–os_cpué‡Œçš„*.adæ–‡ä»¶ï¼‰çš„ç¼–è¯‘å™¨â”‚          â”œâ”€asm                        æ±‡ç¼–å™¨æ¥å£â”‚          â”œâ”€c1                         clientç¼–è¯‘å™¨ï¼ˆåˆç§°â€œC1â€ï¼‰â”‚          â”œâ”€ci                         åŠ¨æ€ç¼–è¯‘å™¨çš„å…¬å…±æœåŠ¡/ä»åŠ¨æ€ç¼–è¯‘å™¨åˆ°VMçš„æ¥å£â”‚          â”œâ”€classfile                  ç±»æ–‡ä»¶çš„å¤„ç†ï¼ˆåŒ…æ‹¬ç±»åŠ è½½å’Œç³»ç»Ÿç¬¦å·è¡¨ç­‰ï¼‰â”‚          â”œâ”€code                       åŠ¨æ€ç”Ÿæˆçš„ä»£ç çš„ç®¡ç†â”‚          â”œâ”€compiler                   ä»VMè°ƒç”¨åŠ¨æ€ç¼–è¯‘å™¨çš„æ¥å£â”‚          â”œâ”€gc_implementation          GCçš„å®ç°â”‚          â”‚  â”œâ”€concurrentMarkSweep      Concurrent Mark Sweep GCçš„å®ç°â”‚          â”‚  â”œâ”€g1                       Garbage-First GCçš„å®ç°ï¼ˆä¸ä½¿ç”¨è€çš„åˆ†ä»£å¼GCæ¡†æ¶ï¼‰â”‚          â”‚  â”œâ”€parallelScavenge         ParallelScavenge GCçš„å®ç°ï¼ˆserver VMé»˜è®¤ï¼Œä¸ä½¿ç”¨è€çš„åˆ†ä»£å¼GCæ¡†æ¶ï¼‰â”‚          â”‚  â”œâ”€parNew                   ParNew GCçš„å®ç°â”‚          â”‚  â””â”€shared                   GCçš„å…±é€šå®ç°â”‚          â”œâ”€gc_interface               GCçš„æ¥å£â”‚          â”œâ”€interpreter                è§£é‡Šå™¨ï¼ŒåŒ…æ‹¬â€œæ¨¡æ¿è§£é‡Šå™¨â€ï¼ˆå®˜æ–¹ç‰ˆåœ¨ç”¨ï¼‰å’Œâ€œC++è§£é‡Šå™¨â€ï¼ˆå®˜æ–¹ç‰ˆä¸åœ¨ç”¨ï¼‰â”‚          â”œâ”€libadt                     ä¸€äº›æŠ½è±¡æ•°æ®ç»“æ„â”‚          â”œâ”€memory                     å†…å­˜ç®¡ç†ç›¸å…³ï¼ˆè€çš„åˆ†ä»£å¼GCæ¡†æ¶ä¹Ÿåœ¨è¿™é‡Œï¼‰â”‚          â”œâ”€oops                       HotSpot VMçš„å¯¹è±¡ç³»ç»Ÿçš„å®ç°â”‚          â”œâ”€opto                       serverç¼–è¯‘å™¨ï¼ˆåˆç§°â€œC2â€æˆ–â€œOptoâ€ï¼‰â”‚          â”œâ”€prims                      HotSpot VMçš„å¯¹å¤–æ¥å£ï¼ŒåŒ…æ‹¬éƒ¨åˆ†æ ‡å‡†åº“çš„nativeéƒ¨åˆ†å’ŒJVMTIå®ç°â”‚          â”œâ”€runtime                    è¿è¡Œæ—¶æ”¯æŒåº“ï¼ˆåŒ…æ‹¬çº¿ç¨‹ç®¡ç†ã€ç¼–è¯‘å™¨è°ƒåº¦ã€é”ã€åå°„ç­‰ï¼‰â”‚          â”œâ”€services                   ä¸»è¦æ˜¯ç”¨æ¥æ”¯æŒJMXä¹‹ç±»çš„ç®¡ç†åŠŸèƒ½çš„æ¥å£â”‚          â”œâ”€shark                      åŸºäºLLVMçš„JITç¼–è¯‘å™¨ï¼ˆå®˜æ–¹ç‰ˆé‡Œæ²¡æœ‰ä½¿ç”¨ï¼‰â”‚          â””â”€utilities                  ä¸€äº›åŸºæœ¬çš„å·¥å…·ç±»â””â”€test                             å•å…ƒæµ‹è¯•</code></pre>]]></content>
      
      
      <categories>
          
          <category> jdk </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jdk </tag>
            
            <tag> hotspot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spec_Java Virtual Machine</title>
      <link href="/2019/06/13/Spec-Java-Virtual-Machine/"/>
      <url>/2019/06/13/Spec-Java-Virtual-Machine/</url>
      
        <content type="html"><![CDATA[<p><img src="http://ww4.sinaimg.cn/large/006tNc79gy1g3znqgyeikj30hs0cgglr.jpg" alt="img"></p><a id="more"></a><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>JSR-000924 JavaTM Virtual Machine Specification<br><strong>(Close of Maintenance Review: 19 July 2004)</strong></p><blockquote><p>Memory Model (Chapter 8) - JSR 133 has changed the memory model. Chapter 8 of the Java Virtual Machine Specification, Second Edition is superseded by JSR 133. See chapter 17 of the <a href="https://jcp.org/aboutJava/communityprocess/maintenance/JLS/index2.html" target="_blank" rel="noopener">Java Language Specification, Third Edition</a> for details.</p></blockquote><p>Java SE 7 å¼€å§‹å†…å­˜æ¨¡å‹è¢«ç§»é™¤,ç›¸å…³è§„èŒƒåœ¨javaè¯­è¨€è§„èŒƒç¬¬17ç« </p><p>Java è™šæ‹Ÿæœºä¸ Java è¯­è¨€å¹¶æ²¡æœ‰å¿…ç„¶çš„è”ç³»ï¼Œå®ƒåªä¸ç‰¹å®šçš„äºŒè¿›åˆ¶æ–‡ä»¶æ ¼å¼â€”â€”Class æ–‡ä»¶<br>æ ¼å¼æ‰€å…³è”ï¼ŒClass æ–‡ä»¶ä¸­åŒ…å«äº† Java è™šæ‹ŸæœºæŒ‡ä»¤é›†(æˆ–è€…ç§°ä¸ºå­—èŠ‚ç ã€Bytecodes)å’Œç¬¦å·<br>è¡¨ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–è¾…åŠ©ä¿¡æ¯ã€‚</p><p>åŸºäºå®‰å…¨æ–¹é¢çš„è€ƒè™‘ï¼ŒJava è™šæ‹Ÿæœºè¦æ±‚åœ¨ Class æ–‡ä»¶ä¸­ä½¿ç”¨äº†è®¸å¤šå¼ºåˆ¶æ€§çš„è¯­æ³•å’Œç»“æ„åŒ–<br>çº¦æŸï¼Œä½†ä»»ä¸€é—¨åŠŸèƒ½æ€§è¯­è¨€éƒ½å¯ä»¥è¡¨ç¤ºä¸ºä¸€ä¸ªèƒ½è¢« Java è™šæ‹Ÿæœºæ¥æ”¶çš„æœ‰æ•ˆçš„ Class æ–‡ä»¶ã€‚ä½œä¸º<br>ä¸€ä¸ªé€šç”¨çš„ã€æœºå™¨æ— å…³çš„æ‰§è¡Œå¹³å°ï¼Œä»»ä½•å…¶ä»–è¯­è¨€çš„å®ç°è€…éƒ½å¯ä»¥å°† Java è™šæ‹Ÿæœºä½œä¸ºä»–ä»¬è¯­è¨€çš„<br>äº§å“äº¤ä»˜åª’ä»‹ã€‚</p><p><strong>Summary of Chapters</strong></p><p>The rest of this book is structured as follows: </p><ul><li><p>Chapter 2 gives an overview of the Java Virtual Machine architecture.  </p><p>  Java è™šæ‹Ÿæœºç»“æ„</p></li><li><p>Chapter 3 introduces compilation of code written in the Java programming language into the instruction set of the Java Virtual Machine. </p></li><li><p>Chapter 4 specifies the class file format, the hardware- and operating system- independent binary format used to represent compiled classes and interfaces. </p></li><li><p>Chapter 5 specifies the start-up of the Java Virtual Machine and the loading, linking, and initialization of classes and interfaces. </p></li><li><p>Chapter 6 specifies the instruction set of the Java Virtual Machine, presenting the instructions in alphabetical order of opcode mnemonics. </p></li><li><p>Chapter 7 gives a table of Java Virtual Machine opcode mnemonics indexed by opcode value. </p></li></ul><h2 id="The-Structure-of-the-Java-Virtual-Machine"><a href="#The-Structure-of-the-Java-Virtual-Machine" class="headerlink" title="The Structure of the Java Virtual Machine"></a>The Structure of the Java Virtual Machine</h2><p>è¿è¡Œæ—¶å†…å­˜ç»“æ„  ã€ç›¸å…³çš„åŒ…ã€  å¸§</p><h2 id="Compiling-for-the-Java-Virtual-Machine"><a href="#Compiling-for-the-Java-Virtual-Machine" class="headerlink" title="Compiling for the Java Virtual Machine"></a>Compiling for the Java Virtual Machine</h2><p>å°†javaæ–‡ä»¶ç¼–è¯‘æˆå­—èŠ‚ç , </p><p>Doubleå’ŒLong çš„å æ®ä¸¤ä¸ªä½ç½®</p><p>synchronized ä¼šåŠ å…¥monitorenter  monitorexit</p><p>å¼‚å¸¸è¡¨</p><h2 id="The-class-File-Format"><a href="#The-class-File-Format" class="headerlink" title="The class File Format"></a>The class File Format</h2><p>ç±»æ–‡ä»¶ç»“æ„ </p><h2 id="Loading-Linking-and-Initializing"><a href="#Loading-Linking-and-Initializing" class="headerlink" title="Loading, Linking, and Initializing"></a>Loading, Linking, and Initializing</h2><p>ç±»åŠ è½½ </p><h2 id="The-Java-Virtual-Machine-Instruction-Set"><a href="#The-Java-Virtual-Machine-Instruction-Set" class="headerlink" title="The Java Virtual Machine Instruction Set"></a>The Java Virtual Machine Instruction Set</h2><p>å­—èŠ‚ç æŒ‡ä»¤é›†</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è™šæ‹Ÿæœºè§„èŒƒ å¹¶ä¸åŒ…å«å¦‚ä¸‹</p><ul><li><strong>Adaptive compiler</strong>: A standard interpreter is used to launch the applications. When the application runs, the code is analyzed to detect performance bottlenecks, or <em>hot spots</em>. The Java HotSpot VM compiles the performance-critical portions of the code for a boost in performance, but does not compile the seldom-used code (most of the application). The Java HotSpot VM uses the adaptive compiler to decide how to optimize compiled code with techniques such as inlining.</li><li><strong>Rapid memory allocation and garbage collection</strong>: Java HotSpot technology provides rapid memory allocation for objects and fast, efficient, state-of-the-art garbage collectors.</li><li><strong>Thread synchronization</strong>: Java HotSpot technology provides a thread-handling capability that is designed to scale for use in large, shared-memory multiprocessor servers.</li></ul><blockquote><p><a href="https://docs.oracle.com/en/java/javase/12/vm/java-virtual-machine-technology-overview.html#GUID-982B244A-9B01-479A-8651-CB6475019281" target="_blank" rel="noopener">HotSpotå®ç°</a> </p><p><a href="https://files-cdn.cnblogs.com/files/chanshuyi/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%A7%84%E8%8C%83%EF%BC%88JavaSE7%EF%BC%89.pdf" target="_blank" rel="noopener">ä¸­æ–‡èµ„æ–™</a></p><p><a href="https://www.oracle.com/technetwork/java/whitepaper-135217.html#1" target="_blank" rel="noopener">JDK1.7ä¸­çš„ä»‹ç»</a></p><p><a href="https://www.zhihu.com/question/50398881" target="_blank" rel="noopener">jvmç›¸å…³æ¨èä¸€ä¸ªå¤§ä½¬</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jvm </tag>
            
            <tag> Spec </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>kafkaæ·±å…¥æµ…å‡º</title>
      <link href="/2019/06/12/Overview_Kafka/"/>
      <url>/2019/06/12/Overview_Kafka/</url>
      
        <content type="html"><![CDATA[<p><img src="http://ww1.sinaimg.cn/large/006tNc79gy1g3ymojzxi2j30u00u0gp5.jpg" alt="image-20190612200726343"></p><a id="more"></a><h1 id="ä¸ºä»€ä¹ˆé€‰æ‹©kafka"><a href="#ä¸ºä»€ä¹ˆé€‰æ‹©kafka" class="headerlink" title="ä¸ºä»€ä¹ˆé€‰æ‹©kafka"></a>ä¸ºä»€ä¹ˆé€‰æ‹©kafka</h1><ul><li>å¤šä¸ªç”Ÿäº§è€…</li><li>å¤šä¸ªæ¶ˆè´¹è€…</li><li>åŸºäºç£ç›˜çš„æ•°æ®å­˜å‚¨</li><li>ä¼¸ç¼©æ€§</li><li>é«˜æ€§èƒ½</li></ul><h1 id="ç¡¬ä»¶é€‰æ‹©"><a href="#ç¡¬ä»¶é€‰æ‹©" class="headerlink" title="ç¡¬ä»¶é€‰æ‹©"></a>ç¡¬ä»¶é€‰æ‹©</h1><ul><li>ç£ç›˜ååé‡</li><li>ç£ç›˜å®¹é‡</li><li>å†…å­˜</li><li>ç½‘ç»œ</li><li>CPU</li></ul><p>ç£ç›˜å®¹é‡å’Œç½‘ç»œæ˜¯ç“¶é¢ˆ</p><h1 id="é›†ç¾¤"><a href="#é›†ç¾¤" class="headerlink" title="é›†ç¾¤"></a>é›†ç¾¤</h1><p><img src="https://www.bonjourcs.com/2018/07/19/ã€Kafka-æƒå¨æŒ‡å—ã€‘-å®‰è£…-Kafka/Kafka-Cluster.png" alt="img"></p><p>Topicä¸»é¢˜:ä¸€ä¸ªä¸»é¢˜å¯ä»¥æœ‰å¤šä¸ªPartitionåˆ†åŒº</p><h1 id="ç”Ÿäº§è€…"><a href="#ç”Ÿäº§è€…" class="headerlink" title="ç”Ÿäº§è€…"></a>ç”Ÿäº§è€…</h1><p><img src="http://ww1.sinaimg.cn/large/006tNc79gy1g3ynxeh7x5j30u00x741w.jpg" alt="overview of producer components"></p><ol><li>ProducerRecordå¯¹è±¡éœ€è¦åŒ…å«ç›®æ ‡ä¸»é¢˜å’Œå†…å®¹ (å¯ä»¥æŒ‡å®šé”®å’Œåˆ†åŒº) </li><li>åœ¨å‘é€æ—¶ å…ˆåºåˆ—åŒ–æˆå­—èŠ‚æ•°ç»„  </li><li>æ•°æ®è¢«ä¼ ç»™åˆ†åŒºå™¨(æ ¹æ®é”®,å¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨è½®è¯¢ç®—æ³• éšæœº) æ·»åŠ åˆ°è®°å½•æ‰¹æ¬¡, </li><li>æœ€åç‹¬ç«‹çº¿ç¨‹è´Ÿè´£æŠŠè¿™äº›è®°å½•æ‰¹æ¬¡å‘é€åˆ°ç›¸åº”brokerä¸Š</li></ol><p>å‘é€æ–¹å¼:</p><ul><li>å¼‚æ­¥å‘é€</li><li>åŒæ­¥å‘é€</li><li>å¼‚æ­¥å›è°ƒæ–¹å¼</li></ul><p>ç¡®è®¤æ¥æ”¶ACKæœºåˆ¶</p><h1 id="æ¶ˆè´¹è€…"><a href="#æ¶ˆè´¹è€…" class="headerlink" title="æ¶ˆè´¹è€…"></a>æ¶ˆè´¹è€…</h1><p><img src="http://ww4.sinaimg.cn/large/006tNc79gy1g3ynx9cl1xj30jq0ge3zx.jpg" alt="number of consumers more than number of topic partitions"></p><p>æ¶ˆè´¹è€…ç»„å’Œæ¶ˆè´¹è€…</p><h2 id="åˆ›å»ºæ¶ˆè´¹è€…"><a href="#åˆ›å»ºæ¶ˆè´¹è€…" class="headerlink" title="åˆ›å»ºæ¶ˆè´¹è€…"></a>åˆ›å»ºæ¶ˆè´¹è€…</h2><h2 id="è®¢é˜…ä¸»é¢˜"><a href="#è®¢é˜…ä¸»é¢˜" class="headerlink" title="è®¢é˜…ä¸»é¢˜"></a>è®¢é˜…ä¸»é¢˜</h2><h2 id="è½®è¯¢-ç¾¤ç»„åè°ƒã€åˆ†åŒºå†å‡è¡¡ã€å‘é€å¿ƒè·³ã€è·å–æ•°æ®"><a href="#è½®è¯¢-ç¾¤ç»„åè°ƒã€åˆ†åŒºå†å‡è¡¡ã€å‘é€å¿ƒè·³ã€è·å–æ•°æ®" class="headerlink" title="è½®è¯¢ (ç¾¤ç»„åè°ƒã€åˆ†åŒºå†å‡è¡¡ã€å‘é€å¿ƒè·³ã€è·å–æ•°æ®)"></a>è½®è¯¢ (ç¾¤ç»„åè°ƒã€åˆ†åŒºå†å‡è¡¡ã€å‘é€å¿ƒè·³ã€è·å–æ•°æ®)</h2><p>â€‹    è½®è¯¢ä¸åªè·å–æ•°æ®é‚£ä¹ˆç®€å•,ç¬¬ä¸€æ¬¡è°ƒç”¨æ–°æ¶ˆè´¹è€…çš„pollæ–¹æ³• å®ƒä¼šè´Ÿè´£æŸ¥æ‰¾GroupCoordinator,åŠ å…¥ç¾¤ç»„,æ¥å—åˆ†é…çš„åˆ†åŒº</p><h2 id="æäº¤å’Œåç§»é‡-å†å‡è¡¡æ—¶ä¼šè¢«é‡æ–°å¤„ç†"><a href="#æäº¤å’Œåç§»é‡-å†å‡è¡¡æ—¶ä¼šè¢«é‡æ–°å¤„ç†" class="headerlink" title="æäº¤å’Œåç§»é‡(å†å‡è¡¡æ—¶ä¼šè¢«é‡æ–°å¤„ç†)"></a>æäº¤å’Œåç§»é‡(å†å‡è¡¡æ—¶ä¼šè¢«é‡æ–°å¤„ç†)</h2><p>â€‹    è‡ªåŠ¨æäº¤,ä¼šé‡å¤å¤„ç†æ¶ˆæ¯ ,æ¯éš”5s, æ¶ˆè´¹è€…ä¼šè‡ªåŠ¨ä»pollæ–¹æ³•æ¥æ”¶åˆ°æœ€å¤§åç§»é‡æäº¤ä¸Šå»</p><p>â€‹    åŒæ­¥æäº¤</p><p>â€‹    å¼‚æ­¥æäº¤</p><h2 id="å†å‡è¡¡ç›‘å¬"><a href="#å†å‡è¡¡ç›‘å¬" class="headerlink" title="å†å‡è¡¡ç›‘å¬"></a>å†å‡è¡¡ç›‘å¬</h2><h2 id="ä»ç‰¹å®šåç§»é‡å¤„å¼€å§‹å¤„ç†è®°å½•"><a href="#ä»ç‰¹å®šåç§»é‡å¤„å¼€å§‹å¤„ç†è®°å½•" class="headerlink" title="ä»ç‰¹å®šåç§»é‡å¤„å¼€å§‹å¤„ç†è®°å½•"></a>ä»ç‰¹å®šåç§»é‡å¤„å¼€å§‹å¤„ç†è®°å½•</h2><h2 id="ä¼˜é›…é€€å‡º"><a href="#ä¼˜é›…é€€å‡º" class="headerlink" title="ä¼˜é›…é€€å‡º"></a>ä¼˜é›…é€€å‡º</h2><h1 id="æ·±å…¥Kafka"><a href="#æ·±å…¥Kafka" class="headerlink" title="æ·±å…¥Kafka"></a>æ·±å…¥Kafka</h1><h2 id="é›†ç¾¤æˆå‘˜å…³ç³»"><a href="#é›†ç¾¤æˆå‘˜å…³ç³»" class="headerlink" title="é›†ç¾¤æˆå‘˜å…³ç³»"></a>é›†ç¾¤æˆå‘˜å…³ç³»</h2><p>ç”¨zookeeperæ¥ç®¡ç†é›†ç¾¤</p><h2 id="æ§åˆ¶å™¨-broker"><a href="#æ§åˆ¶å™¨-broker" class="headerlink" title="æ§åˆ¶å™¨ broker"></a>æ§åˆ¶å™¨ broker</h2><h2 id="å¤åˆ¶"><a href="#å¤åˆ¶" class="headerlink" title="å¤åˆ¶"></a>å¤åˆ¶</h2><p>â€‹    æ¯ä¸ªä¸»é¢˜è¢«åˆ†ä¸ºè‹¥å¹²ä¸ªåˆ†åŒº,æ¯ä¸ªåˆ†åŒºæœ‰å¤šä¸ªå‰¯æœ¬(æ¯ä¸ªbrokerå¯ä»¥æœ‰å¤šä¸ªå‰¯æœ¬)</p><p>â€‹    æ¯ä¸ªåˆ†åŒº éƒ½æœ‰ä¸€ä¸ªé¦–é¢†å‰¯æœ¬ æ‰€æœ‰ç”Ÿäº§è€… æ¶ˆè´¹è€…è¯·æ±‚éƒ½ä¼šç»è¿‡è¿™ä¸ªå‰¯æœ¬  å’Œä¸€ä¸ªé¦–é€‰é¦–é¢†</p><p>â€‹    è·Ÿéšè€…å‰¯æœ¬</p><h2 id="å¤„ç†è¯·æ±‚"><a href="#å¤„ç†è¯·æ±‚" class="headerlink" title="å¤„ç†è¯·æ±‚"></a>å¤„ç†è¯·æ±‚</h2><p>â€‹    ç”Ÿäº§è¯·æ±‚ å†™å…¥æˆåŠŸ   acks = 0  or 1 or all</p><p>â€‹    è·å–è¯·æ±‚ é›¶å¤åˆ¶  brokerå»¶è¿Ÿä½œå‡ºå“åº”ä»¥ä¾¿ç§¯ç´¯è¶³å¤Ÿçš„æ•°æ®</p><p>â€‹    å…¶ä»– å…ƒæ•°æ®</p><h2 id="ç‰©ç†å­˜å‚¨"><a href="#ç‰©ç†å­˜å‚¨" class="headerlink" title="ç‰©ç†å­˜å‚¨"></a>ç‰©ç†å­˜å‚¨</h2><h3 id="åˆ†åŒºåˆ†é…"><a href="#åˆ†åŒºåˆ†é…" class="headerlink" title="åˆ†åŒºåˆ†é…"></a>åˆ†åŒºåˆ†é…</h3><p>â€‹        åˆ†åŒºæ˜¯ä¸€ä¸ªåŸºæœ¬å­˜å‚¨å•å…ƒ</p><h3 id="æ–‡ä»¶ç®¡ç†"><a href="#æ–‡ä»¶ç®¡ç†" class="headerlink" title="æ–‡ä»¶ç®¡ç†"></a>æ–‡ä»¶ç®¡ç†</h3><p>â€‹        kafkaçš„æ•°æ®ä¸ä¼šä¸€ç›´ä¿ç•™,åˆ†åŒºåˆ†æˆè‹¥å¹²ä¸ªç‰‡æ®µ  </p><p>â€‹        æ´»è·ƒç‰‡æ®µæ°¸è¿œä¸ä¼šè¢«åˆ é™¤</p><h3 id="æ–‡ä»¶æ ¼å¼"><a href="#æ–‡ä»¶æ ¼å¼" class="headerlink" title="æ–‡ä»¶æ ¼å¼"></a>æ–‡ä»¶æ ¼å¼</h3><p>â€‹        æ¶ˆæ¯ã€åç§»é‡ ã€å‹ç¼©</p><h3 id="ç´¢å¼•"><a href="#ç´¢å¼•" class="headerlink" title="ç´¢å¼•"></a>ç´¢å¼•</h3><p>â€‹        æ¯ä¸ªåˆ†åŒºç»´æŠ¤ä¸€ä¸ªç´¢å¼• ç´¢å¼•æŠŠåç§»é‡æ˜ å°„åˆ°ç‰‡æ®µæ–‡ä»¶å’Œåç§»é‡åœ¨æ–‡ä»¶é‡Œçš„ä½ç½®</p><h3 id="æ¸…ç†"><a href="#æ¸…ç†" class="headerlink" title="æ¸…ç†"></a>æ¸…ç†</h3><p>â€‹        deleteå’Œcompactç­–ç•¥</p><p>â€‹        å¹²å‡€æ•°æ® æ¸…ç†è¿‡çš„</p><p>â€‹        æ±¡æµŠæ•°æ® æ¸…ç†åæ–°å†™å…¥çš„</p><h1 id="å¯é çš„æ•°æ®ä¼ é€’"><a href="#å¯é çš„æ•°æ®ä¼ é€’" class="headerlink" title="å¯é çš„æ•°æ®ä¼ é€’"></a>å¯é çš„æ•°æ®ä¼ é€’</h1><h2 id="å¯é æ€§ä¿è¯"><a href="#å¯é æ€§ä¿è¯" class="headerlink" title="å¯é æ€§ä¿è¯"></a>å¯é æ€§ä¿è¯</h2><p>ä¿è¯åˆ†åŒºé¡ºåº</p><p>åªæœ‰å½“æ¶ˆæ¯å†™å…¥æ‰€æœ‰åŒæ­¥å‰¯æœ¬.(å¯ä»¥é€‰æ‹©æ¥å—ä¸åŒç±»å‹çš„ç¡®è®¤)</p><p>åªè¦è¿˜æœ‰ä¸€ä¸ªå‰¯æœ¬æ˜¯æ´»è·ƒçš„,é‚£ä¹ˆå·²æäº¤çš„æ¶ˆæ¯å°±ä¸ä¼šä¸¢å¤±äº†</p><p>æ¶ˆè´¹è€…åªèƒ½è¯»å–å·²ç»æäº¤çš„æ¶ˆæ¯</p><h2 id="å¤åˆ¶-1"><a href="#å¤åˆ¶-1" class="headerlink" title="å¤åˆ¶"></a>å¤åˆ¶</h2><h3 id="åŒæ­¥å‰¯æœ¬"><a href="#åŒæ­¥å‰¯æœ¬" class="headerlink" title="åŒæ­¥å‰¯æœ¬"></a>åŒæ­¥å‰¯æœ¬</h3><ul><li><p>æ´»è·ƒä¼šè¯</p></li><li><p>ä»é¦–é¢†è·å–è¿‡æœ€æ–°æ¶ˆæ¯</p></li></ul><h3 id="éåŒæ­¥å‰¯æœ¬"><a href="#éåŒæ­¥å‰¯æœ¬" class="headerlink" title="éåŒæ­¥å‰¯æœ¬"></a>éåŒæ­¥å‰¯æœ¬</h3><h2 id="brokeré…ç½®"><a href="#brokeré…ç½®" class="headerlink" title="brokeré…ç½®"></a>brokeré…ç½®</h2><p>å¤åˆ¶ç³»æ•°</p><p>ä¸å®Œå…¨çš„é¦–é¢†é€‰ä¸¾</p><p>æœ€å°‘åŒæ­¥å‰¯æœ¬</p><h2 id="ç”Ÿäº§è€…-1"><a href="#ç”Ÿäº§è€…-1" class="headerlink" title="ç”Ÿäº§è€…"></a>ç”Ÿäº§è€…</h2><h2 id="æ¶ˆè´¹è€…-1"><a href="#æ¶ˆè´¹è€…-1" class="headerlink" title="æ¶ˆè´¹è€…"></a>æ¶ˆè´¹è€…</h2><p>å‚è€ƒ:</p><blockquote><p>Kafkaæƒå¨æŒ‡å—</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> framework </tag>
            
            <tag> kafka </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>redisæ·±å…¥æµ…å‡º</title>
      <link href="/2019/06/10/Overview_Redis/"/>
      <url>/2019/06/10/Overview_Redis/</url>
      
        <content type="html"><![CDATA[<p><img src="http://ww3.sinaimg.cn/large/006tNc79gy1g3x0bypob8j30u70u0kjl.jpg" alt="image-20190611102836454"></p><a id="more"></a><h2 id="åˆè¯†"><a href="#åˆè¯†" class="headerlink" title="åˆè¯†"></a>åˆè¯†</h2><p>å®˜ç½‘ä»‹ç»    </p><p>â€‹    Redis is an open source (BSD licensed), in-memory data structure store, used as a database, cache and message broker. </p><p>â€‹    It supports data structures such as strings, hashes, lists, sets, sorted sets with range queries, bitmaps, hyperloglogs, geospatial indexes with radius queries and streams.</p><p>â€‹     Redis has built-in replication, Lua scripting, LRU eviction, transactions and different levels of on-disk persistence, and provides high availability via Redis Sentinel and automatic partitioning with Redis Cluster</p><p>ç®€å•ç¿»è¯‘ä¸‹</p><p>â€‹    å†…å­˜æ•°æ®ç»“æ„å­˜å‚¨ ,è¢«å½“æˆæ•°æ®åº“ã€ç¼“å­˜ã€æ¶ˆæ¯ä»£ç†ä½¿ç”¨</p><p>â€‹    æ”¯æŒçš„æ•°æ®ç»“æ„,å­—ç¬¦ä¸² ã€å“ˆå¸Œã€åˆ—è¡¨ã€é›†åˆç­‰</p><p>â€‹    å‰¯æœ¬é›†(ä¸»ä»å¤åˆ¶)ã€Luaè„šæœ¬ã€LRUæ·˜æ±°ç­–ç•¥(Least Recently Usedã€Least Frequently Used)ã€äº‹åŠ¡(ä¸å¯å›æ»š)ã€ä¸åŒçº§åˆ«çš„ç£ç›˜æŒä¹…ã€ç”¨Sentinelä¿è¯é«˜å¯ç”¨ã€ç”¨é›†ç¾¤æ¥è‡ªåŠ¨åˆ†åŒº</p><p>â€‹    </p><p>å•çº¿ç¨‹ ã€ç®€å•ã€é«˜æ€§èƒ½çš„key-valueæ•°æ®åº“</p><h2 id="ç‰ˆæœ¬ç‰¹å¾"><a href="#ç‰ˆæœ¬ç‰¹å¾" class="headerlink" title="ç‰ˆæœ¬ç‰¹å¾"></a>ç‰ˆæœ¬ç‰¹å¾</h2><p><strong>1.Redis2.6</strong></p><p>Redis2.6åœ¨2012å¹´æ­£å¼å‘å¸ƒï¼Œç›¸å¯¹äºRedis2.4ï¼Œä¸»è¦ç‰¹æ€§å¦‚ä¸‹ï¼š</p><ul><li>æ”¯æŒLuaè„šæœ¬</li><li>é”®çš„è¿‡æœŸæ—¶é—´æ”¯æŒæ¯«ç§’</li><li>ä»èŠ‚ç‚¹æ”¯æŒåªè¯»åŠŸèƒ½</li></ul><p><strong>2.Redis2.8</strong></p><p>Redis2.8åœ¨2013å¹´11æœˆ22æ—¥æ­£å¼å‘å¸ƒï¼Œç›¸æ¯”äºRedis2.6ï¼Œä¸»è¦ç‰¹æ€§å¦‚ä¸‹ï¼š</p><ul><li>PSYNC æ·»åŠ éƒ¨åˆ†ä¸»ä»å¤åˆ¶çš„åŠŸèƒ½</li><li>Redis Sentinelç”Ÿäº§å¯ç”¨</li><li>æ–°å¢å‘½ä»¤ï¼šSCANã€SSCANã€HSCANå’ŒZSCAN</li></ul><p><strong>3.Redis3.0ï¼ˆé‡Œç¨‹ç¢‘ï¼‰</strong></p><p>Redis3.0åœ¨2015å¹´4æœˆ1æ—¥æ­£å¼å‘å¸ƒï¼Œç›¸æ¯”äºRedis2.8ä¸»è¦ç‰¹æ€§å¦‚ä¸‹ï¼š</p><ul><li><strong>Redis Clusterï¼šRedisçš„å®˜æ–¹åˆ†å¸ƒå¼å®ç°</strong>ã€‚</li><li>å…¨æ–°çš„embedded stringå¯¹è±¡ç¼–ç ç»“æœï¼Œä¼˜åŒ–å°å¯¹è±¡å†…å­˜è®¿é—®ï¼Œåœ¨ç‰¹å®šçš„å·¥ä½œè´Ÿè½½ä¸‹è½½é€Ÿåº¦å¤§å¹…æå‡</li></ul><p><strong>4.Redis3.2</strong></p><p>Redis3.2åœ¨2016å¹´5æœˆ6æ—¥æ­£å¼å‘å¸ƒï¼Œç›¸æ¯”äºRedis3.0ä¸»è¦ç‰¹å¾å¦‚ä¸‹ï¼š</p><ul><li>æ–°çš„Listç¼–ç ç±»å‹ï¼šquicklistã€‚</li></ul><p><strong>5.Redis4.0</strong></p><p>Redis4.0åœ¨2016å¹´åº•æ­£å¼å‘å¸ƒï¼Œç›¸æ¯”äºRedis3.2ä¸»è¦ç‰¹å¾å¦‚ä¸‹ï¼š <a href="http://antirez.com/news/110" target="_blank" rel="noopener">http://antirez.com/news/110</a></p><ul><li>æ¨¡å—åŒ–</li><li>PSYNC2.0ï¼šä¼˜åŒ–äº†ä¹‹å‰ç‰ˆæœ¬ä¸­ï¼Œä¸»ä»èŠ‚ç‚¹åˆ‡æ¢å¿…ç„¶å¼•èµ·å…¨é‡å¤åˆ¶çš„é—®é¢˜ã€‚</li><li>æä¾›äº†æ–°çš„ç¼“å­˜å‰”é™¤ç®—æ³•ï¼šLFUï¼ˆLast Frequently Usedï¼‰ï¼Œå¹¶å¯¹å·²æœ‰ç®—æ³•è¿›è¡Œäº†ä¼˜åŒ–ã€‚</li><li>æä¾›äº†éé˜»å¡delå’Œflushall/flushdbåŠŸèƒ½ï¼Œæœ‰æ•ˆè§£å†³åˆ é™¤äº†bigkeyå¯èƒ½é€ æˆçš„Redisé˜»å¡ã€‚</li><li>æä¾›äº†RDB-AOFæ··åˆæŒä¹…åŒ–æ ¼å¼ï¼Œå……åˆ†åˆ©ç”¨äº†AOFå’ŒRDBå„è‡ªä¼˜åŠ¿ã€‚</li></ul><p><strong>6.Redis5.0</strong></p><p>Redis5.0åœ¨2018å¹´5æœˆæ­£å¼å‘å¸ƒç›¸æ¯”äºRedis4.0ä¸»è¦ç‰¹å¾å¦‚ä¸‹ï¼š</p><ul><li>Stream data type</li></ul><p> more: <a href="https://raw.githubusercontent.com/antirez/redis/5.0/00-RELEASENOTES" target="_blank" rel="noopener">https://raw.githubusercontent.com/antirez/redis/5.0/00-RELEASENOTES</a></p><h2 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h2><h3 id="String"><a href="#String" class="headerlink" title="String"></a>String</h3><p>â€‹    Redis çš„å­—ç¬¦ä¸²æ˜¯åŠ¨æ€å­—ç¬¦ä¸²ï¼Œæ˜¯å¯ä»¥ä¿®æ”¹çš„å­—ç¬¦ä¸²ï¼Œå†…éƒ¨ç»“æ„å®ç°ä¸Šç±»ä¼¼äº Java çš„ ArrayListï¼Œé‡‡ç”¨é¢„åˆ†é…å†—ä½™ç©ºé—´çš„æ–¹å¼æ¥å‡å°‘å†…å­˜çš„é¢‘ç¹åˆ†é…ã€‚ å½“å­—ç¬¦ä¸²é•¿åº¦å°äº 1M æ—¶ï¼Œæ‰©å®¹éƒ½æ˜¯åŠ å€ç°æœ‰çš„ç©ºé—´ï¼Œå¦‚æœè¶…è¿‡ 1Mï¼Œæ‰©å®¹æ—¶ä¸€æ¬¡åªä¼šå¤šæ‰© 1M çš„ç©ºé—´ã€‚éœ€è¦æ³¨æ„çš„æ˜¯å­—ç¬¦ä¸²æœ€å¤§é•¿åº¦ä¸º 512Mã€‚</p><h3 id="Hash"><a href="#Hash" class="headerlink" title="Hash"></a>Hash</h3><p>â€‹    Redis çš„å­—å…¸ç›¸å½“äº Java è¯­è¨€é‡Œé¢çš„ HashMapï¼Œå®ƒæ˜¯æ— åºå­—å…¸ã€‚ä¸åŒçš„æ˜¯ï¼ŒRedis çš„å­—å…¸çš„å€¼åªèƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œå¦å¤–å®ƒä»¬ rehash çš„æ–¹å¼ä¸ä¸€æ ·ï¼Œå› ä¸º Java çš„ HashMap åœ¨å­—å…¸å¾ˆå¤§æ—¶ï¼Œrehash æ˜¯ä¸ªè€—æ—¶çš„æ“ä½œï¼Œéœ€è¦ä¸€æ¬¡æ€§å…¨éƒ¨ rehash(åœ¨concurrentHashMapä¸­ä¹Ÿæ˜¯æ¸è¿›å¼,è€Œä¸”æ˜¯å¤šçº¿ç¨‹)ã€‚Redis ä¸ºäº†é«˜æ€§èƒ½ï¼Œä¸èƒ½å µå¡æœåŠ¡ï¼Œæ‰€ä»¥é‡‡ç”¨äº†æ¸è¿›å¼ rehash ç­–ç•¥ã€‚(æ“ä½œçš„æ—¶å€™ä¼šè§¦å‘rehash,åŒæ—¶åå°ä¼šæœ‰ä¸ªå®šæ—¶ä»»åŠ¡åœ¨æ‰§è¡Œ)</p><p>â€‹    ç›¸æ¯”å­—ç¬¦ä¸² ,å¯ä»¥è¿›è¡Œéƒ¨åˆ†è·å–,å‡å°‘ç½‘ç»œä¼ è¾“.  ä½†hash ç»“æ„çš„å­˜å‚¨æ¶ˆè€—è¦é«˜äºå•ä¸ªå­—ç¬¦ä¸².</p><h3 id="List"><a href="#List" class="headerlink" title="List"></a>List</h3><p>â€‹    Redis çš„åˆ—è¡¨ç›¸å½“äº Java è¯­è¨€é‡Œé¢çš„ LinkedListï¼Œæ³¨æ„å®ƒæ˜¯é“¾è¡¨è€Œä¸æ˜¯æ•°ç»„ã€‚è¿™æ„å‘³ç€ list çš„æ’å…¥å’Œåˆ é™¤æ“ä½œéå¸¸å¿«ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(1)ï¼Œä½†æ˜¯ç´¢å¼•å®šä½å¾ˆæ…¢ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(n)ï¼Œè¿™ç‚¹è®©äººéå¸¸æ„å¤–ã€‚ å¸¸ç”¨äºå¼‚æ­¥é˜Ÿåˆ—ã€‚</p><p>â€‹    <img src="http://ww4.sinaimg.cn/large/006tNc79gy1g3xeyqvqyoj30zk03d3za.jpg" alt="image-20190611185500346"></p><p>åœ¨åˆ—è¡¨å…ƒç´ è¾ƒå°‘çš„æƒ…å†µä¸‹ä¼šä½¿ç”¨ä¸€å—è¿ç»­çš„å†…å­˜å­˜å‚¨ï¼Œè¿™ä¸ªç»“æ„æ˜¯ <code>ziplist</code>ï¼Œä¹Ÿå³æ˜¯å‹ç¼©åˆ—è¡¨ã€‚</p><p>â€‹    å½“æ•°æ®é‡æ¯”è¾ƒå¤šçš„æ—¶å€™æ‰ä¼šæ”¹æˆ <code>quicklist</code>ã€‚å› ä¸ºæ™®é€šçš„é“¾è¡¨éœ€è¦çš„é™„åŠ æŒ‡é’ˆç©ºé—´å¤ªå¤§ï¼Œä¼šæ¯”è¾ƒæµªè´¹ç©ºé—´ï¼Œè€Œä¸”ä¼šåŠ é‡å†…å­˜çš„ç¢ç‰‡åŒ–ã€‚æ¯”å¦‚è¿™ä¸ªåˆ—è¡¨é‡Œå­˜çš„åªæ˜¯ <code>int</code> ç±»å‹çš„æ•°æ®ï¼Œç»“æ„ä¸Šè¿˜éœ€è¦ä¸¤ä¸ªé¢å¤–çš„æŒ‡é’ˆ <code>prev</code> å’Œ <code>next</code> ã€‚æ‰€ä»¥ Redis å°†é“¾è¡¨å’Œ <code>ziplist</code> ç»“åˆèµ·æ¥ç»„æˆäº† <code>quicklist</code>ã€‚ä¹Ÿå°±æ˜¯å°†å¤šä¸ª <code>ziplist</code> ä½¿ç”¨åŒå‘æŒ‡é’ˆä¸²èµ·æ¥ä½¿ç”¨ã€‚è¿™æ ·æ—¢æ»¡è¶³äº†å¿«é€Ÿçš„æ’å…¥åˆ é™¤æ€§èƒ½ï¼Œåˆä¸ä¼šå‡ºç°å¤ªå¤§çš„ç©ºé—´å†—ä½™ã€‚</p><h3 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h3><p>â€‹    Redis çš„é›†åˆç›¸å½“äº Java è¯­è¨€é‡Œé¢çš„ HashSetï¼Œå®ƒå†…éƒ¨çš„é”®å€¼å¯¹æ˜¯æ— åºçš„å”¯ä¸€çš„ã€‚å®ƒçš„å†…éƒ¨å®ç°ç›¸å½“äºä¸€ä¸ªç‰¹æ®Šçš„å­—å…¸ï¼Œå­—å…¸ä¸­æ‰€æœ‰çš„ value éƒ½æ˜¯ä¸€ä¸ªå€¼<code>NULL</code>ã€‚</p><h3 id="Zset"><a href="#Zset" class="headerlink" title="Zset"></a>Zset</h3><p>â€‹    zset å¯èƒ½æ˜¯ Redis æä¾›çš„æœ€ä¸ºç‰¹è‰²çš„æ•°æ®ç»“æ„ã€‚å®ƒç±»ä¼¼äº Java çš„ SortedSet å’Œ HashMap çš„ç»“åˆä½“ï¼Œä¸€æ–¹é¢å®ƒæ˜¯ä¸€ä¸ª setï¼Œä¿è¯äº†å†…éƒ¨ value çš„å”¯ä¸€æ€§ï¼Œå¦ä¸€æ–¹é¢å®ƒå¯ä»¥ç»™æ¯ä¸ª value èµ‹äºˆä¸€ä¸ª scoreï¼Œä»£è¡¨è¿™ä¸ª value çš„æ’åºæƒé‡ã€‚</p><p>â€‹    æˆ‘ä»¬éœ€è¦è¿™ä¸ªé“¾è¡¨æŒ‰ç…§ score å€¼è¿›è¡Œæ’åºã€‚è¿™æ„å‘³ç€å½“æœ‰æ–°å…ƒç´ éœ€è¦æ’å…¥æ—¶ï¼Œè¦å®šä½åˆ°ç‰¹å®šä½ç½®çš„æ’å…¥ç‚¹ï¼Œè¿™æ ·æ‰å¯ä»¥ç»§ç»­ä¿è¯é“¾è¡¨æ˜¯æœ‰åºçš„ã€‚é€šå¸¸æˆ‘ä»¬ä¼šé€šè¿‡äºŒåˆ†æŸ¥æ‰¾æ¥æ‰¾åˆ°æ’å…¥ç‚¹ï¼Œä½†æ˜¯äºŒåˆ†æŸ¥æ‰¾çš„å¯¹è±¡å¿…é¡»æ˜¯æ•°ç»„ï¼Œæ‰€ä»¥ å®ƒçš„å†…éƒ¨å®ç°ç”¨çš„æ˜¯ä¸€ç§å«åšã€Œè·³è·ƒåˆ—è¡¨ã€çš„æ•°æ®ç»“æ„ã€‚</p><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><ul><li><p>ç®¡é“ï¼ˆPipeliningï¼‰</p><p>  ä¸€æ¬¡å‘é€å¤šä¸ªå‘½ä»¤ï¼Œå¯ä»¥åŒ…å«Batchå‘½ä»¤,èŠ‚çœå¾€è¿”æ—¶é—´ã€‚ </p></li><li><p>æ·˜æ±°ç­–ç•¥ LRU LFU</p><p>  Least Recently Used    æŒ‰ç…§è®¿é—®æ—¶é—´  è¿™ä¸ªå¯ä»¥ç”¨LinkHashMap ç®€å•å®ç°<br>  Least Frequently Used  æŒ‰ç…§è®¿é—®æ¬¡æ•°  éœ€è¦é¢å¤–çš„é˜Ÿåˆ—è®°å½•è®¿é—®é¢‘ç‡</p></li><li><p>Batch å‘½ä»¤</p><p>  æ‰¹é‡ç›¸åŒæŒ‡ä»¤</p></li><li><p>äº‹åŠ¡  </p><p>  Redis äº‹åŠ¡ä¿è¯äº†å…¶ä¸­çš„ä¸€è‡´æ€§ï¼ˆCï¼‰å’Œéš”ç¦»æ€§ï¼ˆIï¼‰ï¼Œä½†å¹¶ä¸ä¿è¯åŸå­æ€§ï¼ˆAï¼‰å’ŒæŒä¹…æ€§ï¼ˆDï¼‰ã€‚</p></li><li><p>åˆ†å¸ƒå¼é”</p><p>  Luaè„šæœ¬å®ç°åŸå­æ€§</p></li><li><p>TTL è¿‡æœŸåˆ é™¤ </p><p>  æƒ°æ€§ã€å¼‚æ­¥ åˆ é™¤, æ³¨æ„è¿‡æœŸæ—¶é—´è¦é‡‡ç”¨ ä¸€ä¸ªå¸¸é‡åŠ ä¸€ä¸ªéšæœºæ—¶é—´æˆ³ é˜²æ­¢å¤§æ‰¹é‡çš„keyåŒä¸€æ—¶é—´è¿‡æœŸ</p></li></ul><p>â€‹    </p><h2 id="ç®¡ç†"><a href="#ç®¡ç†" class="headerlink" title="ç®¡ç†"></a>ç®¡ç†</h2><h3 id="æŒä¹…åŒ–"><a href="#æŒä¹…åŒ–" class="headerlink" title="æŒä¹…åŒ–"></a>æŒä¹…åŒ–</h3><ul><li>å¿«ç…§RDB</li><li>AOF æŒ‡ä»¤ <ul><li>1æ¡æŒ‡ä»¤æ‰§è¡Œä¸€æ¬¡åˆ·ç›˜</li><li>1æ®µæ—¶é—´æ‰§è¡Œä¸€æ¬¡åˆ·ç›˜</li><li>1sæ‰§è¡Œä¸€æ¬¡åˆ·ç›˜</li></ul></li><li>RDBå¿«ç…§ +AOFåŒæ­¥</li></ul><p>â€‹    </p><h2 id="é›†ç¾¤"><a href="#é›†ç¾¤" class="headerlink" title="é›†ç¾¤"></a>é›†ç¾¤</h2><p>â€‹    é«˜å¯ç”¨ ä¸»ä»åŒæ­¥(RDBå¿«ç…§ +AOFåŒæ­¥) ã€raft ä¸€è‡´æ€§ç®—æ³• ã€gossip é€šä¿¡åè®®</p><p>â€‹    é«˜æ€§èƒ½ è¯»å†™åˆ†ç¦»</p><p>â€‹    åˆ†ç‰‡ æ¨ªå‘æ‰©å±• ç®—æ³•æ§½</p><p><a href="https://redis.io/topics/cluster-spec" target="_blank" rel="noopener">https://redis.io/topics/cluster-spec</a></p><p>å‚è€ƒ:</p><blockquote><p>redisæ·±åº¦å†é™©</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> redis </tag>
            
            <tag> framework </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Note_javaå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯</title>
      <link href="/2019/06/06/Note_java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%9A%84%E8%89%BA%E6%9C%AF/"/>
      <url>/2019/06/06/Note_java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%9A%84%E8%89%BA%E6%9C%AF/</url>
      
        <content type="html"><![CDATA[<p><img src="http://ww2.sinaimg.cn/large/006tNc79gy1g3rn5ridk4j30rs0czgo9.jpg" alt="image-20190606190506267"></p><a id="more"></a><h2 id="å¹¶å‘ç¼–ç¨‹çš„æŒ‘æˆ˜"><a href="#å¹¶å‘ç¼–ç¨‹çš„æŒ‘æˆ˜" class="headerlink" title="å¹¶å‘ç¼–ç¨‹çš„æŒ‘æˆ˜"></a>å¹¶å‘ç¼–ç¨‹çš„æŒ‘æˆ˜</h2><p>â€‹        </p><p>å¤šçº¿ç¨‹ä¸€å®šå¿«å—</p><p>ä¸Šä¸‹æ–‡åˆ‡æ¢<br>            ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°å’Œæ—¶é•¿<br>            å¦‚ä½•å‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢</p><p>æ­»é”</p><p>èµ„æºé™åˆ¶çš„æŒ‘æˆ˜</p><h2 id="Javaå¹¶å‘æœºåˆ¶çš„åº•å±‚å®ç°åŸç†"><a href="#Javaå¹¶å‘æœºåˆ¶çš„åº•å±‚å®ç°åŸç†" class="headerlink" title="Javaå¹¶å‘æœºåˆ¶çš„åº•å±‚å®ç°åŸç†"></a>Javaå¹¶å‘æœºåˆ¶çš„åº•å±‚å®ç°åŸç†</h2><h3 id="volatileçš„åº”ç”¨"><a href="#volatileçš„åº”ç”¨" class="headerlink" title="volatileçš„åº”ç”¨"></a>volatileçš„åº”ç”¨</h3><h4 id="cpuæœ¯è¯­"><a href="#cpuæœ¯è¯­" class="headerlink" title="cpuæœ¯è¯­"></a>cpuæœ¯è¯­</h4><p>â€‹        å†…å­˜å±éšœ</p><h4 id="lockå‰ç¼€æŒ‡ä»¤"><a href="#lockå‰ç¼€æŒ‡ä»¤" class="headerlink" title="lockå‰ç¼€æŒ‡ä»¤"></a>lockå‰ç¼€æŒ‡ä»¤</h4><p>â€‹        ç¼“å­˜å†™å›å†…å­˜<br>â€‹        å…¶ä»–å¤„ç†å™¨çš„ç¼“å­˜æ— æ•ˆ</p><h4 id="volatileä¼˜åŒ–"><a href="#volatileä¼˜åŒ–" class="headerlink" title="volatileä¼˜åŒ–"></a>volatileä¼˜åŒ–</h4><p>â€‹                é˜Ÿåˆ—é›†åˆç±»LinkedTransferQueueã€é˜Ÿåˆ—64ä½</p><h3 id="synchronnizedçš„å®ç°åŸç†ä¸åº”ç”¨"><a href="#synchronnizedçš„å®ç°åŸç†ä¸åº”ç”¨" class="headerlink" title="synchronnizedçš„å®ç°åŸç†ä¸åº”ç”¨"></a>synchronnizedçš„å®ç°åŸç†ä¸åº”ç”¨</h3><h4 id="jdk1-6çš„æ”¹è¿›"><a href="#jdk1-6çš„æ”¹è¿›" class="headerlink" title="jdk1.6çš„æ”¹è¿›"></a>jdk1.6çš„æ”¹è¿›</h4><p>â€‹        åå‘é”<br>â€‹        è½»é‡çº§é”<br>â€‹        é”çš„å­˜å‚¨ç»“æ„<br>â€‹        å‡çº§è¿‡ç¨‹</p><h4 id="å®ç°åŒæ­¥çš„åŸºç¡€"><a href="#å®ç°åŒæ­¥çš„åŸºç¡€" class="headerlink" title="å®ç°åŒæ­¥çš„åŸºç¡€"></a>å®ç°åŒæ­¥çš„åŸºç¡€</h4><p>â€‹        æ™®é€šåŒæ­¥æ–¹æ³•ï¼Œé”æ˜¯å½“å‰å®ä¾‹å¯¹è±¡<br>â€‹        é™æ€åŒæ­¥æ–¹æ³•ï¼Œé”æ˜¯å½“å‰ç±»çš„Classå¯¹è±¡<br>â€‹        åŒæ­¥æ–¹æ³•å—ï¼Œé”æ˜¯æ‹¬å·é‡Œé…ç½®çš„å¯¹è±¡</p><h4 id="å¯¹è±¡å¤´"><a href="#å¯¹è±¡å¤´" class="headerlink" title="å¯¹è±¡å¤´"></a>å¯¹è±¡å¤´</h4><h5 id="32bit"><a href="#32bit" class="headerlink" title="32bit"></a>32bit</h5><p>â€‹                    é”çŠ¶æ€<br>â€‹                    25bit å¯¹è±¡çš„hascode<br>â€‹                    4bit å¯¹è±¡çš„åˆ†ä»£å¹´é¾„<br>â€‹                    1bit æ˜¯å¦åå‘é”<br>â€‹                    2bit é”æ ‡å¿—ä½</p><h5 id="64bit"><a href="#64bit" class="headerlink" title="64bit"></a>64bit</h5><h4 id="é”çš„å‡çº§å’Œå¯¹æ¯”"><a href="#é”çš„å‡çº§å’Œå¯¹æ¯”" class="headerlink" title="é”çš„å‡çº§å’Œå¯¹æ¯”"></a>é”çš„å‡çº§å’Œå¯¹æ¯”</h4><p>â€‹        åå‘é”<br>â€‹                    åå‘é”æ ‡è¯†<br>â€‹        è½»é‡çº§é”<br>â€‹                    CASã€è‡ªæ—‹<br>â€‹        é‡é‡çº§é”<br>â€‹        è¿½æ±‚åå</p><h3 id="åŸå­æ“ä½œçš„å®ç°åŸç†"><a href="#åŸå­æ“ä½œçš„å®ç°åŸç†" class="headerlink" title="åŸå­æ“ä½œçš„å®ç°åŸç†"></a>åŸå­æ“ä½œçš„å®ç°åŸç†</h3><h4 id="æœ¯è¯­"><a href="#æœ¯è¯­" class="headerlink" title="æœ¯è¯­"></a>æœ¯è¯­</h4><p>â€‹        æ¯”è¾ƒå¹¶äº¤æ¢<br>â€‹        CPUæµæ°´çº¿<br>â€‹                    å°†ä¸€æ¡æ‰§è¡Œåˆ†æˆ5-6æ­¥å†ç”±è¿™äº›ç”µè·¯å•å…ƒåˆ†åˆ«æ‰§è¡Œ<br>â€‹        å†…å­˜é¡ºåºå†²çª</p><h4 id="å¤„ç†å™¨"><a href="#å¤„ç†å™¨" class="headerlink" title="å¤„ç†å™¨"></a>å¤„ç†å™¨</h4><h5 id="ä½¿ç”¨æ€»çº¿é”ä¿è¯åŸå­æ€§"><a href="#ä½¿ç”¨æ€»çº¿é”ä¿è¯åŸå­æ€§" class="headerlink" title="ä½¿ç”¨æ€»çº¿é”ä¿è¯åŸå­æ€§"></a>ä½¿ç”¨æ€»çº¿é”ä¿è¯åŸå­æ€§</h5><p>â€‹    æŠŠCPUå’Œå†…å­˜ä¹‹é—´çš„é€šä¿¡éƒ½é”ä½äº†</p><h5 id="ä½¿ç”¨ç¼“å­˜é”å®šæ¥ä¿è¯åŸå­æ€§"><a href="#ä½¿ç”¨ç¼“å­˜é”å®šæ¥ä¿è¯åŸå­æ€§" class="headerlink" title="ä½¿ç”¨ç¼“å­˜é”å®šæ¥ä¿è¯åŸå­æ€§"></a>ä½¿ç”¨ç¼“å­˜é”å®šæ¥ä¿è¯åŸå­æ€§</h5><p>â€‹    æŸä¸ªå†…å­˜åœ°å€çš„æ“ä½œæ˜¯åŸå­æ€§å³å¯<br>å¤±æ•ˆåœºæ™¯<br>â€‹        æ“ä½œæ•°æ®ä¸èƒ½å¤‡ç¼“å­˜åœ¨å¤„ç†å™¨å†…å­˜ï¼Œæˆ–æ“ä½œçš„æ•°æ®è·¨å¤šä¸ªç¼“å­˜è¡Œ<br>â€‹        æœ‰äº›å¤„ç†å™¨ä¸æ”¯æŒ</p><h4 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h4><h5 id="é”"><a href="#é”" class="headerlink" title="é”"></a>é”</h5><h5 id="CAS"><a href="#CAS" class="headerlink" title="CAS"></a>CAS</h5><p>â€‹            å¤„ç†å™¨æä¾›çš„CMPXCHGæŒ‡ä»¤<br>â€‹            å­˜åœ¨çš„é—®é¢˜<br>â€‹                        ABAé—®é¢˜<br>â€‹                        å¾ªç¯æ—¶é—´å¼€é”€å¤§<br>â€‹                        åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ“ä½œ</p><h2 id="Javaå†…å­˜æ¨¡å‹"><a href="#Javaå†…å­˜æ¨¡å‹" class="headerlink" title="Javaå†…å­˜æ¨¡å‹"></a>Javaå†…å­˜æ¨¡å‹</h2><h3 id="Javaå†…å­˜æ¨¡å‹çš„åŸºç¡€"><a href="#Javaå†…å­˜æ¨¡å‹çš„åŸºç¡€" class="headerlink" title="Javaå†…å­˜æ¨¡å‹çš„åŸºç¡€"></a>Javaå†…å­˜æ¨¡å‹çš„åŸºç¡€</h3><h4 id="å¹¶å‘ç¼–ç¨‹æ¨¡å‹çš„ä¸¤ä¸ªå…³é”®é—®é¢˜"><a href="#å¹¶å‘ç¼–ç¨‹æ¨¡å‹çš„ä¸¤ä¸ªå…³é”®é—®é¢˜" class="headerlink" title="å¹¶å‘ç¼–ç¨‹æ¨¡å‹çš„ä¸¤ä¸ªå…³é”®é—®é¢˜"></a>å¹¶å‘ç¼–ç¨‹æ¨¡å‹çš„ä¸¤ä¸ªå…³é”®é—®é¢˜</h4><ul><li>å¦‚ä½•é€šä¿¡â€”ä½•ç§æœºåˆ¶æ¥äº¤æ¢ä¿¡æ¯</li><li>ä½•æ—¶åŒæ­¥â€”æ§åˆ¶å‘ç”Ÿç›¸å¯¹é¡ºåºçš„æœºåˆ¶</li></ul><h4 id="çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡æœºåˆ¶"><a href="#çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡æœºåˆ¶" class="headerlink" title="çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡æœºåˆ¶"></a>çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡æœºåˆ¶</h4><ul><li>å…±äº«å†…å­˜â€”çº¿ç¨‹ä¹‹é—´å…±äº«ç¨‹åºçš„å…¬å…±çŠ¶æ€ï¼Œé€šè¿‡è¯»-å†™å†…å­˜ä¸­çš„å…¬å…±çŠ¶æ€è¿›è¡Œéšå¼é€šä¿¡</li><li>æ¶ˆæ¯ä¼ é€’â€”çº¿ç¨‹ä¹‹é—´æ²¡æœ‰å…¬å…±çŠ¶æ€ï¼Œçº¿ç¨‹ä¹‹é—´å¿…é¡»é€šè¿‡å‘ç”Ÿæ¶ˆæ¯æ¥æ˜¾å¼è¿›è¡Œé€šä¿¡</li></ul><h4 id="Javaå†…å­˜æ¨¡å‹çš„æŠ½è±¡ç»“æ„"><a href="#Javaå†…å­˜æ¨¡å‹çš„æŠ½è±¡ç»“æ„" class="headerlink" title="Javaå†…å­˜æ¨¡å‹çš„æŠ½è±¡ç»“æ„"></a>Javaå†…å­˜æ¨¡å‹çš„æŠ½è±¡ç»“æ„</h4><p>JMMå®šä¹‰äº†çº¿ç¨‹å’Œä¸»å†…å­˜ä¹‹é—´çš„æŠ½è±¡å…³ç³»,ä»æºä»£ç åˆ°æŒ‡ä»¤åºåˆ—çš„é‡æ’åº,å¤„ç†å™¨é€šè¿‡å†…å­˜å±éšœä¿è¯é¡ºåº</p><ul><li><p>ç¼–è¯‘å™¨ä¼˜åŒ–çš„é‡æ’åº<br>  ç¼–è¯‘å™¨åœ¨ä¸æ”¹å˜å•çº¿ç¨‹ç¨‹åºäºˆä»¥çš„å‰æä¸‹ï¼Œå¯ä»¥é‡æ–°å®‰æ’è¯­å¥çš„æ‰§è¡Œé¡ºåº</p></li><li><p>æŒ‡ä»¤çº§å¹¶è¡Œçš„é‡æ’åº<br>  ç°ä»£å¤„ç†å™¨é‡‡ç”¨äº†æŒ‡ä»¤çº§å¹¶è¡ŒæŠ€æœ¯æ¥å°†å¤šæ¡æŒ‡ä»¤é‡å æ‰§è¡Œ</p></li><li><p>å†…å­˜ç³»ç»Ÿçš„é‡æ’åº</p><p>  ç¼“å­˜å’Œè¯»/å†™ç¼“å†²åŒº</p></li></ul><h4 id="å¹¶å‘ç¼–ç¨‹æ¨¡å‹çš„åˆ†ç±»"><a href="#å¹¶å‘ç¼–ç¨‹æ¨¡å‹çš„åˆ†ç±»" class="headerlink" title="å¹¶å‘ç¼–ç¨‹æ¨¡å‹çš„åˆ†ç±»"></a>å¹¶å‘ç¼–ç¨‹æ¨¡å‹çš„åˆ†ç±»</h4><h5 id="å†™ç¼“å†²åŒºï¼ˆå†™è¯»çš„é¡ºåºï¼‰"><a href="#å†™ç¼“å†²åŒºï¼ˆå†™è¯»çš„é¡ºåºï¼‰" class="headerlink" title="å†™ç¼“å†²åŒºï¼ˆå†™è¯»çš„é¡ºåºï¼‰"></a>å†™ç¼“å†²åŒºï¼ˆå†™è¯»çš„é¡ºåºï¼‰</h5><p>å†™ç¼“å†²åŒºå¯ä»¥ä¿è¯æŒ‡ä»¤æµæ°´çº¿æŒç»­è¿è¡Œï¼Œå®ƒå¯ä»¥é¿å…ç”±äºå¤„ç†å™¨åœé¡¿ä¸‹æ¥ç­‰å¾…å‘å†…å­˜å†™å…¥æ•°æ®è€Œäº§ç”Ÿçš„å»¶è¿Ÿ<br>é€šè¿‡ä»¥æ‰¹å¤„ç†çš„æ–¹å¼åˆ·æ–°å†™ç¼“å†²åŒºï¼Œä»¥åŠåˆå¹¶å†™ç¼“å­˜åŒºä¸­å¯¹ä¸€å†…å­˜åœ°å€çš„å¤šæ¬¡å†™ï¼Œå‡å°‘å†…å­˜æ€»çº¿çš„å ç”¨<br>å­˜åœ¨çš„é—®é¢˜<br>        å†™ç¼“å­˜åŒºä»…å¯¹è‡ªå·±çš„å¤„ç†å™¨å¯è§ï¼Œå®ƒä¼šå¯¼è‡´å¤„ç†å™¨æ‰§è¡Œå†…å­˜æ“ä½œçš„é¡ºåºå¯èƒ½ä¼šä¸å†…å­˜å®é™…æ“ä½œé¡ºåºä¸ä¸€è‡´</p><h5 id="å†…å­˜å±éšœ"><a href="#å†…å­˜å±éšœ" class="headerlink" title="å†…å­˜å±éšœ"></a>å†…å­˜å±éšœ</h5><ul><li>LoadLoad</li><li>StoreStore</li><li>LoadStore</li><li>StoreLoad<br>  ç¡®ä¿äº†Storeçš„æ•°æ®å¯¹å…¶ä»–å¤„ç†å™¨å˜å¾—å¯è§ï¼ˆæŒ‡åˆ·æ–°åˆ°å†…å­˜ï¼‰</li></ul><h4 id="happens-beforeç®€ä»‹"><a href="#happens-beforeç®€ä»‹" class="headerlink" title="happens-beforeç®€ä»‹"></a>happens-beforeç®€ä»‹</h4><p>é˜è¿°æ“ä½œä¹‹é—´çš„å†…å­˜å¯è§æ€§<br>ä¸¤ä¸ªæ“ä½œä¹‹é—´å­˜åœ¨happens- beforeå…³ç³»ï¼Œå¹¶ä¸æ„å‘³ç€å‰ä¸€ä¸ªæ“ä½œå¿…é¡»åœ¨åä¸€ä¸ªæ“ä½œä¹‹å‰æ‰§è¡Œ</p><h3 id="é‡æ’åºï¼ˆä¸ºäº†æé«˜å¹¶è¡Œåº¦ï¼‰"><a href="#é‡æ’åºï¼ˆä¸ºäº†æé«˜å¹¶è¡Œåº¦ï¼‰" class="headerlink" title="é‡æ’åºï¼ˆä¸ºäº†æé«˜å¹¶è¡Œåº¦ï¼‰"></a>é‡æ’åºï¼ˆä¸ºäº†æé«˜å¹¶è¡Œåº¦ï¼‰</h3><h4 id="æ•°æ®ä¾èµ–æ€§"><a href="#æ•°æ®ä¾èµ–æ€§" class="headerlink" title="æ•°æ®ä¾èµ–æ€§"></a>æ•°æ®ä¾èµ–æ€§</h4><p>â€‹                ç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¸ä¼šæ”¹å˜å­˜åœ¨æ•°æ®ä¾èµ–å…³ç³»çš„ä¸¤ä¸ªæ“ä½œçš„æ‰§è¡Œé¡ºåºï¼Œå‰ææ˜¯å•ä¸ªå¤„ç†å™¨æ‰§è¡Œçš„æŒ‡ä»¤ç»­é›†å’Œå•ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œçš„æ“ä½œ</p><h4 id="as-if-serialè¯­ä¹‰"><a href="#as-if-serialè¯­ä¹‰" class="headerlink" title="as-if-serialè¯­ä¹‰"></a>as-if-serialè¯­ä¹‰</h4><p>â€‹                ä¸ç®¡æ€ä¹ˆé‡æ’åºï¼Œç¨‹åºæ‰§è¡Œç»“æœä¸èƒ½æ”¹å˜ï¼ˆå•çº¿ç¨‹ï¼‰</p><h4 id="ç¨‹åºé¡ºåºè§„åˆ™"><a href="#ç¨‹åºé¡ºåºè§„åˆ™" class="headerlink" title="ç¨‹åºé¡ºåºè§„åˆ™"></a>ç¨‹åºé¡ºåºè§„åˆ™</h4><h4 id="å¯¹å¤šçº¿ç¨‹çš„å½±å“"><a href="#å¯¹å¤šçº¿ç¨‹çš„å½±å“" class="headerlink" title="å¯¹å¤šçº¿ç¨‹çš„å½±å“"></a>å¯¹å¤šçº¿ç¨‹çš„å½±å“</h4><h3 id="é¡ºåºä¸€è‡´æ€§"><a href="#é¡ºåºä¸€è‡´æ€§" class="headerlink" title="é¡ºåºä¸€è‡´æ€§"></a>é¡ºåºä¸€è‡´æ€§</h3><h4 id="æ•°æ®ç«äº‰"><a href="#æ•°æ®ç«äº‰" class="headerlink" title="æ•°æ®ç«äº‰"></a>æ•°æ®ç«äº‰</h4><p>â€‹                åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­å†™ä¸€ä¸ªå˜é‡<br>â€‹                åœ¨å¦ä¸€ä¸ªçº¿ç¨‹è¯»åŒä¸€ä¸ªå˜é‡<br>â€‹                è€Œä¸”å†™å’Œè¯»æ²¡æœ‰é€šè¿‡åŒæ­¥æ¥æ’åº</p><h4 id="é¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹"><a href="#é¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹" class="headerlink" title="é¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹"></a>é¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹</h4><p>â€‹                ç‰¹å¾<br>â€‹                    ä¸€ä¸ªçº¿ç¨‹ä¸­æ‰€æœ‰æ“ä½œå¿…é¡»æŒ‰ç…§ç¨‹åºçš„é¡ºåºæ¥æ‰§è¡Œ<br>â€‹                    æ‰€æœ‰çº¿ç¨‹éƒ½åªèƒ½çœ‹åˆ°ä¸€ä¸ªå•ä¸€çš„æ“ä½œæ‰§è¡Œé¡ºåºï¼Œæ¯ä¸ªæ“ä½œéƒ½å¿…é¡»åŸå­æ‰§è¡Œä¸”ç«‹å³å¯¹æ‰€æœ‰çº¿ç¨‹æ‰€è§<br>â€‹                ä»»æ„æ—¶é—´ç‚¹æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è¿æ¥åˆ°å†…å­˜ï¼Œä¸²è¡ŒåŒ–</p><h4 id="åŒæ­¥ç¨‹åºçš„é¡ºåºä¸€è‡´æ€§æ•ˆæœ"><a href="#åŒæ­¥ç¨‹åºçš„é¡ºåºä¸€è‡´æ€§æ•ˆæœ" class="headerlink" title="åŒæ­¥ç¨‹åºçš„é¡ºåºä¸€è‡´æ€§æ•ˆæœ"></a>åŒæ­¥ç¨‹åºçš„é¡ºåºä¸€è‡´æ€§æ•ˆæœ</h4><p>â€‹                JMMä¸´ç•ŒåŒºå†…çš„ä»£ç å¯ä»¥é‡æ’åº</p><h4 id="æœªåŒæ­¥ç¨‹åºçš„æ‰§è¡Œç‰¹æ€§"><a href="#æœªåŒæ­¥ç¨‹åºçš„æ‰§è¡Œç‰¹æ€§" class="headerlink" title="æœªåŒæ­¥ç¨‹åºçš„æ‰§è¡Œç‰¹æ€§"></a>æœªåŒæ­¥ç¨‹åºçš„æ‰§è¡Œç‰¹æ€§</h4><p>â€‹                JMMåªæä¾›æœ€å°å®‰å…¨æ€§ï¼Œçº¿ç¨‹æ‰§è¡Œæ—¶è¯»å–åˆ°çš„å€¼ï¼Œè¦ä¹ˆæ—¶ä¹‹å‰æŸä¸ªçº¿ç¨‹å†™å…¥çš„å€¼ï¼Œè¦ä¹ˆæ—¶é»˜è®¤å€¼<br>â€‹                å·®å¼‚<br>â€‹                    JMMä¸ä¿è¯å¯¹64ä½çš„longå’Œdoubleå‹çš„å˜é‡å…·æœ‰åŸå­æ€§ï¼Œè€Œé¡ºåºä¸€è‡´æ¨¡å‹ä¿è¯æ‰€æœ‰å†…å­˜è¯»/å†™éƒ½å…·æœ‰åŸå­æ€§</p><h3 id="volatileçš„å†…å­˜è¯­ä¹‰"><a href="#volatileçš„å†…å­˜è¯­ä¹‰" class="headerlink" title="volatileçš„å†…å­˜è¯­ä¹‰"></a>volatileçš„å†…å­˜è¯­ä¹‰</h3><h4 id="ç‰¹å¾"><a href="#ç‰¹å¾" class="headerlink" title="ç‰¹å¾"></a>ç‰¹å¾</h4><p>â€‹                å¯è§æ€§<br>â€‹                åŸå­æ€§<br>â€‹                    å¤åˆæ“ä½œä¸æ”¯æŒï¼Œæ”¯æŒ64 long/double</p><h4 id="å»ºç«‹çš„happens-beforeå…³ç³»"><a href="#å»ºç«‹çš„happens-beforeå…³ç³»" class="headerlink" title="å»ºç«‹çš„happens-beforeå…³ç³»"></a>å»ºç«‹çš„happens-beforeå…³ç³»</h4><h4 id="volatileå†™-è¯»çš„å†…å­˜è¯­ä¹‰"><a href="#volatileå†™-è¯»çš„å†…å­˜è¯­ä¹‰" class="headerlink" title="volatileå†™-è¯»çš„å†…å­˜è¯­ä¹‰"></a>volatileå†™-è¯»çš„å†…å­˜è¯­ä¹‰</h4><p>â€‹                å½“å†™ä¸€ä¸ªvolatileå˜é‡æ—¶ï¼ŒJMMä¼šæŠŠè¯¥çº¿ç¨‹å¯¹åº”çš„æœ¬åœ°å†…å­˜ä¸­çš„å…±äº«å˜é‡åˆ·æ–°åˆ°ä¸»å†…å­˜<br>â€‹                å½“è¯»ä¸€ä¸ªvolatileå˜é‡æ—¶ï¼ŒJMMä¼šæŠŠè¯¥çº¿ç¨‹å¯¹åº”çš„æœ¬åœ°å†…å­˜ç½®ä¸ºæ— æ•ˆï¼Œä»ä¸»å†…å­˜ä¸­è¯»å–å…±äº«å˜é‡</p><h4 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h4><p>â€‹                ç¼–è¯‘å™¨<br>â€‹                    ç”Ÿæˆå­—èŠ‚ç æ—¶ï¼Œä¼šåœ¨æŒ‡ä»¤åºåˆ—ä¸­æ’å…¥å†…å­˜å±éšœæ¥ç¦æ­¢ç‰¹å®šç±»å‹çš„å¤„ç†å™¨é‡æ’åºï¼Œé‡‡ç”¨ä¿å®ˆçš„æ–¹å¼<br>â€‹                    åœ¨volatileè¯»åæ’å…¥å†…å­˜å±éšœ<br>â€‹                        LoadLoad<br>â€‹                        LoadStore<br>â€‹                    åœ¨volatileå†™å‰åæ’å…¥å†…å­˜å±éšœ<br>â€‹                        StoreStore å‰<br>â€‹                        StoreLoad å<br>â€‹                            ä¹Ÿå¯ä»¥è¯»å‰æ’å…¥StoreLoadï¼Œä½†è€ƒè™‘è¯»å¤šå†™å°‘æƒ…å†µ<br>â€‹                ä¼˜åŒ–<br>â€‹                    çœç•¥ä¸å¿…è¦çš„å±éšœ<br>â€‹                    ä¸åŒå¤„ç†å™¨ï¼Œå…¥x86ä»…ä¼šå¯¹å†™-è¯»æ“ä½œåšé‡æ’åº</p><p>æ—§æ¨¡å‹ä¸å…è®¸volatileå˜é‡ä¹‹é—´é‡æ’åºï¼Œä½†æ—§çš„Javaæ¨¡å‹å…è®¸volatileå˜é‡ä¸æ™®é€šå˜é‡é‡æ’åº</p><h3 id="é”çš„å†…å­˜è¯­ä¹‰"><a href="#é”çš„å†…å­˜è¯­ä¹‰" class="headerlink" title="é”çš„å†…å­˜è¯­ä¹‰"></a>é”çš„å†…å­˜è¯­ä¹‰</h3><p>é”æ˜¯javaå¹¶å‘å˜æˆä¸­æœ€é‡è¦çš„åŒæ­¥æœºåˆ¶ï¼Œé™¤äº†è®©ä¸´ç•ŒåŒºäº’æ–¥æ‰§è¡Œï¼Œè¿˜å¯ä»¥è®©é‡Šæ”¾é”çš„çº¿ç¨‹å‘è·å–åŒä¸€ä¸ªé”çš„çº¿ç¨‹å‘é€æ¶ˆæ¯<br>é‡Šæ”¾é”æ—¶ï¼Œä¼šæŠŠçº¿ç¨‹å¯¹åº”çš„æœ¬åœ°å†…å­˜ä¸­çš„å…±äº«å˜é‡åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­<br>è·å–é”æ—¶ï¼Œä¼šæŠŠçº¿ç¨‹å¯¹åº”çš„æœ¬åœ°å†…å­˜ç½®ä¸ºæ— æ•ˆ</p><h4 id="CAS-1"><a href="#CAS-1" class="headerlink" title="CAS"></a>CAS</h4><p>â€‹                åŒæ—¶å…·æœ‰volatileè¯»å’Œå†™çš„å†…å­˜è¯­ä¹‰<br>â€‹                ç¨‹åºæ ¹æ®å¤„ç†å™¨æ˜¯å¦ä¸ºcmpxchgæŒ‡ä»¤æ·»åŠ lockå‰ç¼€<br>â€‹                intelå¯¹lockå‰ç¼€çš„è§£é‡Š<br>â€‹                    ç¼“å­˜é”å®š<br>â€‹                    ç¦æ­¢æŒ‡ä»¤é‡æ’<br>â€‹                    æŠŠå†™ç¼“å†²åŒºä¸­çš„æ‰€æœ‰æ•°æ®åˆ·æ–°åˆ°å†…å­˜</p><h4 id="concurrentåŒ…çš„å®ç°"><a href="#concurrentåŒ…çš„å®ç°" class="headerlink" title="concurrentåŒ…çš„å®ç°"></a>concurrentåŒ…çš„å®ç°</h4><p>â€‹                é€šç”¨åŒ–æ¨¡å¼<br>â€‹                    å£°æ˜å…±äº«å˜é‡<br>â€‹                    ä½¿ç”¨CASçš„æ¡ä»¶æ›´æ–°æ¥å®ç°çº¿ç¨‹ä¹‹é—´çš„åŒæ­¥<br>â€‹                    é…åˆä»¥volatileè¯»/å†™ å’Œ CASæ‰€å…·æœ‰çš„volatileè¯»/å†™ è¯­ä¹‰æ¥å®ç°çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡</p><h3 id="finalåŸŸçš„å†…å­˜è¯­ä¹‰"><a href="#finalåŸŸçš„å†…å­˜è¯­ä¹‰" class="headerlink" title="finalåŸŸçš„å†…å­˜è¯­ä¹‰"></a>finalåŸŸçš„å†…å­˜è¯­ä¹‰</h3><h4 id="finalåŸŸçš„é‡æ’åºè§„åˆ™"><a href="#finalåŸŸçš„é‡æ’åºè§„åˆ™" class="headerlink" title="finalåŸŸçš„é‡æ’åºè§„åˆ™"></a>finalåŸŸçš„é‡æ’åºè§„åˆ™</h4><p>â€‹                åœ¨æ„é€ å‡½æ•°å†…å¯¹ä¸€ä¸ªfinalåŸŸçš„å†™å…¥ï¼Œä¸éšåæŠŠè¿™ä¸ªè¢«æ„é€ å¯¹è±¡çš„å¼•ç”¨èµ‹å€¼ç»™ä¸€ä¸ªå¼•ç”¨å˜é‡ï¼Œè¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´ä¸èƒ½é‡æ’åº<br>â€‹                åˆæ¬¡è¯»ä¸€ä¸ªåŒ…å«finalåŸŸçš„å¯¹è±¡çš„å¼•ç”¨ï¼Œä¸éšååˆæ¬¡è¯»å–è¿™ä¸ªfinalåŸŸï¼Œè¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´ä¸èƒ½é‡æ’åº</p><h4 id="å†™finalåŸŸçš„é‡æ’åºè§„åˆ™"><a href="#å†™finalåŸŸçš„é‡æ’åºè§„åˆ™" class="headerlink" title="å†™finalåŸŸçš„é‡æ’åºè§„åˆ™"></a>å†™finalåŸŸçš„é‡æ’åºè§„åˆ™</h4><p>â€‹                JMMç¦æ­¢ç¼–è¯‘å™¨æŠŠfinalåŸŸçš„å†™é‡æ’åºåˆ°æ„é€ å‡½æ•°ä¹‹å¤–</p><h4 id="è¯»finalåŸŸçš„é‡æ’åºè§„åˆ™"><a href="#è¯»finalåŸŸçš„é‡æ’åºè§„åˆ™" class="headerlink" title="è¯»finalåŸŸçš„é‡æ’åºè§„åˆ™"></a>è¯»finalåŸŸçš„é‡æ’åºè§„åˆ™</h4><p>â€‹                åœ¨è¯»ä¸€ä¸ªå¯¹è±¡çš„finalåŸŸä¹‹å‰ï¼Œä¸€å®šå…ˆè¯»åŒ…å«è¿™ä¸ªfinalåŸŸçš„å¯¹è±¡å¼•ç”¨</p><h4 id="finalå¼•ç”¨ä¸èƒ½ä»æ„é€ å‡½æ•°å†…â€˜æº¢å‡ºâ€™"><a href="#finalå¼•ç”¨ä¸èƒ½ä»æ„é€ å‡½æ•°å†…â€˜æº¢å‡ºâ€™" class="headerlink" title="finalå¼•ç”¨ä¸èƒ½ä»æ„é€ å‡½æ•°å†…â€˜æº¢å‡ºâ€™"></a>finalå¼•ç”¨ä¸èƒ½ä»æ„é€ å‡½æ•°å†…â€˜æº¢å‡ºâ€™</h4><h4 id="è¯­ä¹‰"><a href="#è¯­ä¹‰" class="headerlink" title="è¯­ä¹‰"></a>è¯­ä¹‰</h4><p>â€‹                å†™finalåŸŸçš„é‡æ’åºè§„åˆ™ä¼šè¦æ±‚ç¼–è¯‘å™¨åœ¨finalåŸŸå†™ä¹‹åï¼Œæ„é€ å‡½æ•°returnä¹‹å‰æ’å…¥ä¸€ä¸ªStoreStoreå±éšœ<br>â€‹                è¯»finalåŸŸçš„é‡æ’åºè§„åˆ™è¦æ±‚ç¼–è¯‘å™¨åœ¨è¯»finalåŸŸçš„æ“ä½œå‰é¢æ’å…¥ä¸€ä¸ªLoadLoad</p><h3 id="happens-before"><a href="#happens-before" class="headerlink" title="happens-before"></a>happens-before</h3><h4 id="JMMçš„è®¾è®¡"><a href="#JMMçš„è®¾è®¡" class="headerlink" title="JMMçš„è®¾è®¡"></a>JMMçš„è®¾è®¡</h4><p>â€‹                ä¸¤ä¸ªå…³é”®å› ç´ <br>â€‹                    ç¨‹åºå‘˜å¯¹å†…å­˜æ¨¡å‹å¯¹ä½¿ç”¨<br>â€‹                    ç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¯¹å†…å­˜æ¨¡å‹å¯¹å®ç°<br>â€‹                happens-beforeè¦æ±‚ç¦æ­¢å¯¹é‡æ’åº<br>â€‹                    ä¼šæ”¹å˜ç¨‹åºæ‰§è¡Œç»“æœå¯¹é‡æ’åº<br>â€‹                        JMMç¦æ­¢<br>â€‹                    ä¸ä¼šæ”¹å˜ç¨‹åºæ‰§è¡Œç»“æœçš„é‡æ’åº<br>â€‹                        JMMä¸ç¦æ­¢</p><h4 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h4><p>â€‹                as-if-serialè¯­ä¹‰ä¿è¯å•çº¿ç¨‹çš„æ‰§è¡Œç»“æœä¸è¢«æ”¹å˜ï¼Œhappens-beforeå…³ç³»ä¿è¯æ­£ç¡®åŒæ­¥çš„å¤šçº¿ç¨‹æ‰§è¡Œç»“æœä¸è¢«æ”¹å˜</p><h4 id="è§„åˆ™"><a href="#è§„åˆ™" class="headerlink" title="è§„åˆ™"></a>è§„åˆ™</h4><p>â€‹                ç¨‹åºé¡ºåºè§„åˆ™<br>â€‹                ç›‘è§†å™¨é”è§„åˆ™<br>â€‹                volatileå˜é‡è§„åˆ™<br>â€‹                ä¼ é€’æ€§<br>â€‹                startè§„åˆ™<br>â€‹                joinè§„åˆ™</p><h3 id="åŒé‡æ£€æŸ¥é”å®šä¸å»¶è¿Ÿåˆå§‹åŒ–"><a href="#åŒé‡æ£€æŸ¥é”å®šä¸å»¶è¿Ÿåˆå§‹åŒ–" class="headerlink" title="åŒé‡æ£€æŸ¥é”å®šä¸å»¶è¿Ÿåˆå§‹åŒ–"></a>åŒé‡æ£€æŸ¥é”å®šä¸å»¶è¿Ÿåˆå§‹åŒ–</h3><h4 id="é”™è¯¯çš„æ ¹æº"><a href="#é”™è¯¯çš„æ ¹æº" class="headerlink" title="é”™è¯¯çš„æ ¹æº"></a>é”™è¯¯çš„æ ¹æº</h4><p>â€‹                1.åˆ†é…å¯¹è±¡çš„å†…å­˜ç©ºé—´<br>â€‹                2.åˆå§‹åŒ–å¯¹è±¡<br>â€‹                3.è®¾ç½®instanceæ‰§è¡Œåˆ†é…çš„å†…å­˜åœ°å€<br>â€‹            é‡æ’åº 2 å’Œ 3ï¼Œè·å–ä¸€ä¸ªæœªåˆå§‹åŒ–çš„å¯¹è±¡</p><h4 id="è§£å†³æ–¹å¼"><a href="#è§£å†³æ–¹å¼" class="headerlink" title="è§£å†³æ–¹å¼"></a>è§£å†³æ–¹å¼</h4><p>â€‹                ä¸å…è®¸2å’Œ3é‡æ’åº<br>â€‹                    volatile<br>â€‹                å…è®¸2å’Œ3é‡æ’åºï¼Œä½†ä¸å…è®¸å…¶ä»–çº¿ç¨‹â€˜çœ‹åˆ°â€™è¿™ä¸ªé‡æ’åº<br>â€‹                    åœ¨æ‰§è¡Œç±»åˆå§‹åŒ–æœŸé—´ï¼ŒJVMä¼šå»è·å–ä¸€ä¸ªé”ï¼Œè¿™ä¸ªé”å¯ä»¥åŒæ­¥å¤šä¸ªçº¿ç¨‹å¯¹åŒä¸€ä¸ªç±»å¯¹åˆå§‹åŒ–</p><h4 id="ç±»å¯¹åˆå§‹åŒ–"><a href="#ç±»å¯¹åˆå§‹åŒ–" class="headerlink" title="ç±»å¯¹åˆå§‹åŒ–"></a>ç±»å¯¹åˆå§‹åŒ–</h4><p>â€‹                ä¸€ä¸ªç±»æˆ–æ¥å£ç±»å‹ç«‹å³è¢«åˆå§‹åŒ–å¯¹æƒ…å†µ<br>â€‹                    Tæ˜¯ä¸€ä¸ªç±»ï¼ŒTå¯¹ç¤ºä¾‹è¢«åˆ›å»º<br>â€‹                    Tæ˜¯ä¸€ä¸ªç±»ï¼Œä¸”Tä¸­å£°æ˜å¯¹ä¸€ä¸ªé™æ€æ–¹æ³•è¢«è°ƒç”¨<br>â€‹                    Tä¸­å£°æ˜å¯¹ä¸€ä¸ªé™æ€å­—æ®µè¢«èµ‹å€¼<br>â€‹                    Tä¸­å£°æ˜å¯¹ä¸€ä¸ªé™æ€å­—æ®µè¢«ä½¿ç”¨ï¼Œè€Œä¸”è¿™ä¸ªå­—æ®µä¸æ˜¯ä¸€ä¸ªå¸¸é‡å­—æ®µ<br>â€‹                    Tæ˜¯ä¸€ä¸ªé¡¶çº§ç±»ï¼Œè€Œä¸”ä¸€ä¸ªæ–­è¨€è¯­å¥åµŒå¥—åœ¨Tå†…éƒ¨è¢«æ‰§è¡Œ</p><h3 id="Javaå†…å­˜æ¨¡å‹ç»¼è¿°"><a href="#Javaå†…å­˜æ¨¡å‹ç»¼è¿°" class="headerlink" title="Javaå†…å­˜æ¨¡å‹ç»¼è¿°"></a>Javaå†…å­˜æ¨¡å‹ç»¼è¿°</h3><h4 id="å¤„ç†å™¨çš„å†…å­˜æ¨¡å‹"><a href="#å¤„ç†å™¨çš„å†…å­˜æ¨¡å‹" class="headerlink" title="å¤„ç†å™¨çš„å†…å­˜æ¨¡å‹"></a>å¤„ç†å™¨çš„å†…å­˜æ¨¡å‹</h4><p>â€‹                JMMå±è”½äº†ä¸åŒå¤„ç†å™¨å†…å­˜æ¨¡å‹çš„å·®å¼‚</p><h4 id="å„ç§å†…å­˜æ¨¡å‹ä¹‹é—´çš„å…³ç³»"><a href="#å„ç§å†…å­˜æ¨¡å‹ä¹‹é—´çš„å…³ç³»" class="headerlink" title="å„ç§å†…å­˜æ¨¡å‹ä¹‹é—´çš„å…³ç³»"></a>å„ç§å†…å­˜æ¨¡å‹ä¹‹é—´çš„å…³ç³»</h4><p>â€‹                å¤„ç†å™¨å†…å­˜æ¨¡å‹æ˜¯ç¡¬ä»¶çº§çš„å†…å­˜æ¨¡å‹<br>â€‹                JMMè¯­è¨€çº§å†…å­˜æ¨¡å‹<br>â€‹                é¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹æ˜¯ä¸€ä¸ªç†è®ºå‚è€ƒæ¨¡å‹</p><h4 id="JMMçš„å†…å­˜å¯è§æ€§ä¿è¯"><a href="#JMMçš„å†…å­˜å¯è§æ€§ä¿è¯" class="headerlink" title="JMMçš„å†…å­˜å¯è§æ€§ä¿è¯"></a>JMMçš„å†…å­˜å¯è§æ€§ä¿è¯</h4><h4 id="JSR-133å¯¹å†…å­˜è¯­ä¹‰çš„ä¿®å¤"><a href="#JSR-133å¯¹å†…å­˜è¯­ä¹‰çš„ä¿®å¤" class="headerlink" title="JSR-133å¯¹å†…å­˜è¯­ä¹‰çš„ä¿®å¤"></a>JSR-133å¯¹å†…å­˜è¯­ä¹‰çš„ä¿®å¤</h4><h2 id="Javaå¹¶å‘ç¼–ç¨‹åŸºç¡€"><a href="#Javaå¹¶å‘ç¼–ç¨‹åŸºç¡€" class="headerlink" title="Javaå¹¶å‘ç¼–ç¨‹åŸºç¡€"></a>Javaå¹¶å‘ç¼–ç¨‹åŸºç¡€</h2><h3 id="çº¿ç¨‹ç®€ä»‹"><a href="#çº¿ç¨‹ç®€ä»‹" class="headerlink" title="çº¿ç¨‹ç®€ä»‹"></a>çº¿ç¨‹ç®€ä»‹</h3><h3 id="å¯åŠ¨å’Œç»ˆæ­¢çº¿ç¨‹"><a href="#å¯åŠ¨å’Œç»ˆæ­¢çº¿ç¨‹" class="headerlink" title="å¯åŠ¨å’Œç»ˆæ­¢çº¿ç¨‹"></a>å¯åŠ¨å’Œç»ˆæ­¢çº¿ç¨‹</h3><h3 id="çº¿ç¨‹é—´é€šä¿¡"><a href="#çº¿ç¨‹é—´é€šä¿¡" class="headerlink" title="çº¿ç¨‹é—´é€šä¿¡"></a>çº¿ç¨‹é—´é€šä¿¡</h3><h4 id="é€šçŸ¥-ç­‰å¾…"><a href="#é€šçŸ¥-ç­‰å¾…" class="headerlink" title="é€šçŸ¥/ç­‰å¾…"></a>é€šçŸ¥/ç­‰å¾…</h4><p>â€‹    ç›‘è§†å™¨<br>â€‹    å¯¹è±¡<br>â€‹    ç­‰å¾…é˜Ÿåˆ—<br>â€‹    åŒæ­¥é˜Ÿåˆ—</p><h4 id="ç­‰å¾…æ–¹"><a href="#ç­‰å¾…æ–¹" class="headerlink" title="ç­‰å¾…æ–¹"></a>ç­‰å¾…æ–¹</h4><p>â€‹                è·å–å¯¹è±¡é”<br>â€‹                å¦‚æœæ¡ä»¶ä¸æ»¡è¶³ï¼Œé‚£ä¹ˆè°ƒç”¨å¯¹è±¡çš„wait()æ–¹æ³•ï¼Œè¢«é€šçŸ¥åä»è¦æ£€æŸ¥æ¡ä»¶<br>â€‹                æ¡ä»¶æ»¡è¶³åˆ™æ‰§è¡Œå¯¹åº”é€»è¾‘</p><h4 id="é€šçŸ¥æ–¹"><a href="#é€šçŸ¥æ–¹" class="headerlink" title="é€šçŸ¥æ–¹"></a>é€šçŸ¥æ–¹</h4><p>â€‹                è·å¾—å¯¹è±¡çš„é”<br>â€‹                æ”¹å˜æ¡ä»¶<br>â€‹                é€šçŸ¥æ‰€æœ‰ç­‰å¾…åœ¨å¯¹è±¡ä¸Šçš„çº¿ç¨‹<br>â€‹        </p><h2 id="Javaä¸­çš„é”"><a href="#Javaä¸­çš„é”" class="headerlink" title="Javaä¸­çš„é”"></a>Javaä¸­çš„é”</h2><h3 id="Lock"><a href="#Lock" class="headerlink" title="Lock"></a>Lock</h3><h3 id="AQS"><a href="#AQS" class="headerlink" title="AQS"></a>AQS</h3><p>â€‹            ä¸»è¦ä½¿ç”¨æ–¹å¼æ˜¯ç»§æ‰¿ï¼Œæ¨èè¢«å®šä¹‰ä¸ºè‡ªå®šä¹‰åŒæ­¥ç»„ä»¶çš„é™æ€å†…éƒ¨ç±»</p><h3 id="ä¸é”çš„å…³ç³»"><a href="#ä¸é”çš„å…³ç³»" class="headerlink" title="ä¸é”çš„å…³ç³»"></a>ä¸é”çš„å…³ç³»</h3><p>â€‹                é”æ˜¯é¢å‘ä½¿ç”¨è€…ï¼Œå®ƒå®šä¹‰äº†ä½¿ç”¨è€…ä¸é”äº¤äº’çš„æ¥å£ï¼Œéšè—äº†å®ç°ç»†èŠ‚<br>â€‹                åŒæ­¥å™¨é¢å‘çš„æ˜¯é”çš„å®ç°è€…ï¼Œå®ƒç®€åŒ–äº†é”çš„å®ç°æ–¹å¼ï¼Œå±è”½äº†åŒæ­¥çŠ¶æ€ç®¡ç†ï¼Œçº¿ç¨‹çš„æ’é˜Ÿï¼Œç­‰å¾…ä¸å”¤é†’ç­‰åº•å±‚æ“ä½œ</p><h3 id="åŒæ­¥é˜Ÿåˆ—"><a href="#åŒæ­¥é˜Ÿåˆ—" class="headerlink" title="åŒæ­¥é˜Ÿåˆ—"></a>åŒæ­¥é˜Ÿåˆ—</h3><p>â€‹                    èŠ‚ç‚¹<br>â€‹                        æ˜¯ä»€ä¹ˆ<br>â€‹                            å½“å‰çº¿ç¨‹è·å–åŒæ­¥çŠ¶æ€å¤±è´¥æ—¶ï¼ŒåŒæ­¥å™¨ä¼šå°†å½“å‰çº¿ç¨‹ä»¥åŠç­‰å¾…çŠ¶æ€ç­‰ä¿¡æ¯æ„æˆä¸€ä¸ªèŠ‚ç‚¹ï¼Œå½“åŒæ­¥çŠ¶æ€é‡Šæ”¾æ—¶ï¼Œä¼šæŠŠé¦–èŠ‚ç‚¹å”¤é†’ï¼Œå†æ¬¡å°è¯•è·å–åŒæ­¥çŠ¶æ€<br>â€‹                        å±æ€§<br>â€‹                            ç­‰å¾…çŠ¶æ€<br>â€‹                            å‰é©±èŠ‚ç‚¹<br>â€‹                            åç»§èŠ‚ç‚¹<br>â€‹                            ç­‰å¾…é˜Ÿåˆ—ä¸­çš„åç»§èŠ‚ç‚¹<br>â€‹                            è·å–åŒæ­¥çŠ¶æ€çš„çº¿ç¨‹<br>â€‹                    FIFOåŒå‘é˜Ÿåˆ—<br>â€‹                        é€šè¿‡CASè®¾ç½®å°¾èŠ‚ç‚¹</p><h3 id="ReenLock"><a href="#ReenLock" class="headerlink" title="ReenLock"></a>ReenLock</h3><h2 id="Javaä¸­çš„çº¿ç¨‹æ± "><a href="#Javaä¸­çš„çº¿ç¨‹æ± " class="headerlink" title="Javaä¸­çš„çº¿ç¨‹æ± "></a>Javaä¸­çš„çº¿ç¨‹æ± </h2><h3 id="ä¸ºä»€ä¹ˆä½¿ç”¨çº¿ç¨‹æ± "><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨çº¿ç¨‹æ± " class="headerlink" title="ä¸ºä»€ä¹ˆä½¿ç”¨çº¿ç¨‹æ± "></a>ä¸ºä»€ä¹ˆä½¿ç”¨çº¿ç¨‹æ± </h3><p>â€‹            é™ä½èµ„æºæ¶ˆè€—<br>â€‹                é€šè¿‡é‡å¤åˆ©ç”¨å·²åˆ›å»ºçš„çº¿ç¨‹é™ä½çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯é€ æˆçš„æ¶ˆè€—<br>â€‹            æé«˜å“åº”é€Ÿåº¦<br>â€‹                å½“ä»»åŠ¡åˆ°è¾¾æ—¶ï¼Œä»»åŠ¡å¯ä»¥ä¸éœ€è¦ç­‰åˆ°çº¿ç¨‹åˆ›å»ºå°±èƒ½ç«‹å³æ‰§è¡Œ<br>â€‹            æé«˜çº¿ç¨‹çš„å¯ç®¡ç†æ€§<br>â€‹                çº¿ç¨‹æ˜¯ç¨€æœ‰èµ„æºï¼Œä½¿ç”¨çº¿ç¨‹æ± å¯ä»¥è¿›è¡Œç»Ÿä¸€åˆ†é…ã€è°ƒä¼˜å’Œç›‘æ§</p><h3 id="å®ç°åŸç†"><a href="#å®ç°åŸç†" class="headerlink" title="å®ç°åŸç†"></a>å®ç°åŸç†</h3><p>â€‹            çº¿ç¨‹æ± å¤„ç†æµç¨‹<br>â€‹                1.é¦–å…ˆï¼Œåˆ¤æ–­æ ¸å¿ƒçº¿ç¨‹æ± é‡Œçš„çº¿ç¨‹æ˜¯å¦éƒ½åœ¨æ‰§è¡Œä»»åŠ¡ï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ›å»ºä»»åŠ¡ï¼Œå¦åˆ™è¿›å…¥ä¸‹ä¸ªæµç¨‹<br>â€‹                2.åˆ¤æ–­å·¥ä½œé˜Ÿåˆ—æ˜¯å¦å·²ç»æ»¡äº†ï¼Œå¦‚æœä¸æ˜¯ï¼Œå­˜å‚¨åœ¨å·¥ä½œé˜Ÿåˆ—ï¼Œå¦åˆ™è¿›å…¥ä¸‹ä¸ªæµç¨‹<br>â€‹                3.åˆ¤æ–­çº¿ç¨‹æ± çš„çº¿ç¨‹æ˜¯å¦éƒ½å¤„äºå·¥ä½œçŠ¶æ€ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼ˆéœ€è¦å…¨å±€é”ï¼‰ï¼Œå¦åˆ™äº¤ç»™é¥±å’Œç­–ç•¥æ¥å¤„ç†<br>â€‹            ä¸ºä»€ä¹ˆ<br>â€‹                å°½å¯èƒ½åœ°é¿å…è·å–å…¨å±€é”ï¼Œå› ä¸ºä»å¤„ç†æµç¨‹æ¥çœ‹ï¼Œåœ¨å®Œæˆé¢„çƒ­åï¼Œå‡ ä¹æ‰§è¡Œæ­¥éª¤éƒ½æ˜¯è½åœ¨2ä¸Š</p><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><h4 id="å‚æ•°"><a href="#å‚æ•°" class="headerlink" title="å‚æ•°"></a>å‚æ•°</h4><ul><li><p>corePoolSizeï¼ˆçº¿ç¨‹æ± çš„åŸºæœ¬å¤§å°ï¼‰<br>  æäº¤ä¸€ä¸ªä»»åŠ¡åˆ°çº¿ç¨‹æ± æ—¶ï¼Œçº¿ç¨‹æ± ä¼šåˆ›å»ºä¸€ä¸ªä»»åŠ¡ï¼Œå³ä½¿å…¶ä»–ç©ºé—²åˆ°åŸºæœ¬çº¿ç¨‹èƒ½å¤Ÿæ‰§è¡Œæ–°ä»»åŠ¡ï¼Œç­‰éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡æ•°å¤§äºçº¿ç¨‹æ± åŸºæœ¬å¤§å°æ—¶å°±ä¸å†åˆ›å»º<br>  å¯ä»¥æå‰è°ƒç”¨prestartAllCoreThreadsæå‰åˆ›å»ºå¹¶å¯åŠ¨æ‰€æœ‰åŸºæœ¬çº¿ç¨‹</p></li><li><p>runnableTaskQueueï¼ˆä»»åŠ¡é˜Ÿåˆ—ï¼‰</p><pre><code>                  ArrayBlockingQueue                      åŸºäºæ•°ç»„ç»“æ„çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ï¼ŒFIFO                  LinkedBlockingQueue                      åŸºäºé“¾è¡¨çš„é˜»å¡é˜Ÿåˆ—ï¼ŒFIFO                  SynchronousQueue                      ä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—(ä½¿ç”¨åœºæ™¯æ˜¯é˜²æ­¢æœåŠ¡å™¨é‡å¯æˆ–è€…downäº† ä¸¢å¤±é˜Ÿåˆ—ä¸­çš„æ•°æ®)                  PriorityBlockQueue                      å…·æœ‰ä¼˜å…ˆçº§çš„æ— é™é˜»å¡é˜Ÿåˆ—</code></pre><p>  æ³¨æ„ , å»ºè®®ä½¿ç”¨æœ‰ç•Œé˜Ÿåˆ—</p></li><li><p>maximumPoolSize(çº¿ç¨‹æ± æœ€å¤§æ•°é‡)</p><pre><code>  æ³¨æ„ï¼Œå¦‚æœä½¿ç”¨æ— ç•Œçš„ä»»åŠ¡é˜Ÿåˆ—ï¼Œè¿™ä¸ªå‚æ•°å°±æ²¡æœ‰æ„ä¹‰äº†, å»ºè®®æŒ‡å®šçº¿ç¨‹æœ€å¤§å€¼,æ¯ä¸ªçº¿ç¨‹åœ¨åˆ†é…æ—¶å€™çš„å¤§å°é»˜è®¤æ˜¯512K</code></pre></li><li><p>ThreadFactory<br>  ç”¨äºåˆ›å»ºçº¿ç¨‹çš„å·¥å‚ï¼Œå¯ä»¥é€šè¿‡çº¿ç¨‹å·¥å‚ç»™æ¯ä¸ªåˆ›å»ºå‡ºæ¥çš„çº¿ç¨‹è®¾ç½®æ›´æœ‰æ„ä¹‰çš„åå­—,æ–¹ä¾¿é—®é¢˜å®šä½</p></li><li><p>RejectedExecutionHandler(é¥±å’Œç­–ç•¥)</p><pre><code>                  AbortPolicyï¼ˆé»˜è®¤ï¼‰                      ç›´æ¥æŠ›å‡ºå¼‚å¸¸                  CallerRunsPolicy                      åªç”¨è°ƒç”¨è€…æ‰€åœ¨çº¿ç¨‹æ¥è¿è¡Œä»»åŠ¡                  DiscardOldestPolicy                      ä¸¢å¼ƒé˜Ÿåˆ—é‡Œæœ€è¿‘çš„ä¸€ä¸ªä»»åŠ¡ï¼Œå¹¶æ‰§è¡Œå½“å‰ä»»åŠ¡                  DiscardPolicy                      ä¸¢å¼ƒä¸å¤„ç†</code></pre><p>  æ³¨æ„ ä¹Ÿå¯ä»¥å®ç°RejectExecutionHandleræ¥å£è‡ªå®šä¹‰ç­–ç•¥,ä¸€èˆ¬æ¯”è¾ƒé‡è¦çš„,å¯ä»¥æŒä¹…åŒ–åˆ°æ–‡ä»¶,æˆ–è€…å¦å¤–çš„é˜Ÿåˆ—</p></li><li><p>keepAliveTime(çº¿ç¨‹æ´»åŠ¨ä¿æŒæ—¶é—´)</p><pre><code>                  çº¿ç¨‹æ± çš„å·¥ä½œçº¿ç¨‹ç©ºé—²åï¼Œä¿æŒå­˜æ´»çš„æ—¶é—´                  TimeUnit(å•ä½)</code></pre></li></ul><h4 id="æäº¤ä»»åŠ¡æ–¹å¼"><a href="#æäº¤ä»»åŠ¡æ–¹å¼" class="headerlink" title="æäº¤ä»»åŠ¡æ–¹å¼"></a>æäº¤ä»»åŠ¡æ–¹å¼</h4><ul><li>execute ä¸å¸¦è¿”å›ç»“æœ</li><li>submit æºå¸¦è¿”å›ç»“æœ</li></ul><h4 id="å…³é—­çº¿ç¨‹æ± "><a href="#å…³é—­çº¿ç¨‹æ± " class="headerlink" title="å…³é—­çº¿ç¨‹æ± "></a>å…³é—­çº¿ç¨‹æ± </h4><ul><li><p>shutdown</p></li><li><p>shutdownNow</p><p>  éƒ½æ˜¯è®¾ç½®ä¸­æ–­æ ‡è®°, ä¸¤è€…çš„å·®å¼‚åªæ˜¯åœ¨äºshutdownNowä¸ä¼šæ‰§è¡Œç­‰å¾…é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡</p></li></ul><h4 id="åˆç†ä½¿ç”¨"><a href="#åˆç†ä½¿ç”¨" class="headerlink" title="åˆç†ä½¿ç”¨"></a>åˆç†ä½¿ç”¨</h4><h5 id="ä»»åŠ¡æ€§è´¨"><a href="#ä»»åŠ¡æ€§è´¨" class="headerlink" title="ä»»åŠ¡æ€§è´¨"></a>ä»»åŠ¡æ€§è´¨</h5><p>â€‹                    CPUå¯†é›†å‹<br>â€‹                        Cpu+1<br>â€‹                    IOå¯†é›†å‹<br>â€‹                        2*Cpu</p><h5 id="ä»»åŠ¡ä¼˜å…ˆçº§"><a href="#ä»»åŠ¡ä¼˜å…ˆçº§" class="headerlink" title="ä»»åŠ¡ä¼˜å…ˆçº§"></a>ä»»åŠ¡ä¼˜å…ˆçº§</h5><p>â€‹                    ä¼˜å…ˆçº§é˜Ÿåˆ—</p><h5 id="ä»»åŠ¡æ‰§è¡Œæ—¶é—´"><a href="#ä»»åŠ¡æ‰§è¡Œæ—¶é—´" class="headerlink" title="ä»»åŠ¡æ‰§è¡Œæ—¶é—´"></a>ä»»åŠ¡æ‰§è¡Œæ—¶é—´</h5><p>â€‹                    ä½¿ç”¨ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œè®©æ—¶é—´çŸ­çš„ä»»åŠ¡å…ˆæ‰§è¡Œ<br>â€‹                    äº¤ç»™ä¸åŒè§„æ¨¡çš„çº¿ç¨‹æ± å¤„ç†</p><h5 id="ä»»åŠ¡çš„ä¾èµ–æ€§"><a href="#ä»»åŠ¡çš„ä¾èµ–æ€§" class="headerlink" title="ä»»åŠ¡çš„ä¾èµ–æ€§"></a>ä»»åŠ¡çš„ä¾èµ–æ€§</h5><p>â€‹                    ä¾èµ–æ•°æ®åº“é“¾æ¥æ± çš„ä»»åŠ¡ï¼Œå› ä¸ºæäº¤éœ€è¦ç­‰å¾…æ•°æ®åº“è¿”å›ç»“æœï¼Œç­‰å¾…æ—¶é—´è¶Šé•¿ï¼Œç©ºé—²æ—¶é—´è¶Šé•¿ï¼Œæ‰€ä»¥è®¾ç½®çº¿ç¨‹æ•°åº”è¯¥å°½é‡å¤§ï¼ŒåŒæ—¶æ³¨æ„é’ˆå¯¹è¿™ç§æ˜‚è´µçš„èµ„æºï¼Œè®°å¾—ä½¿ç”¨è¶…æ—¶æœºåˆ¶</p><h5 id="ç›‘æ§"><a href="#ç›‘æ§" class="headerlink" title="ç›‘æ§"></a>ç›‘æ§</h5><p>â€‹        largestPoolSize-æœ€å¤§çº¿ç¨‹æ•°<br>â€‹        getPoolSize-çº¿ç¨‹æ± çš„çº¿ç¨‹æ•°é‡<br>â€‹        getActiveCount-è·å–æ´»åŠ¨çš„çº¿ç¨‹æ•°</p><p>â€‹        æ‰©å±•ï¼Œç»§æ‰¿çº¿ç¨‹æ± </p>]]></content>
      
      
      
        <tags>
            
            <tag> juc </tag>
            
            <tag> java </tag>
            
            <tag> note </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nettyæ·±å…¥æµ…å‡º</title>
      <link href="/2019/06/05/Overview_Netty/"/>
      <url>/2019/06/05/Overview_Netty/</url>
      
        <content type="html"><![CDATA[<p><img src="http://ww1.sinaimg.cn/large/006tNc79gy1g3qmnkhrfcj30xc0m8ag3.jpg" alt="image-20190605220200987"></p><a id="more"></a><h2 id="Netty"><a href="#Netty" class="headerlink" title="Netty"></a>Netty</h2><p>â€‹    Netty is <em>an asynchronous event-driven network application framework</em> for rapid development of maintainable high performance protocol servers &amp; clients.</p><p><img src="http://ww2.sinaimg.cn/large/006tNc79gy1g3qn7tloh8j30gg09o758.jpg" alt="img"></p><p>â€‹    ä½¿ç”¨åœºæ™¯  zk ,redis proxy ,dubboç­‰</p><p>more : <a href="https://netty.io/" target="_blank" rel="noopener">https://netty.io/</a></p><h2 id="ç‰ˆæœ¬ç‰¹å¾"><a href="#ç‰ˆæœ¬ç‰¹å¾" class="headerlink" title="ç‰ˆæœ¬ç‰¹å¾"></a>ç‰ˆæœ¬ç‰¹å¾</h2><p>3.x </p><p>4.x  RECOMMENDED VERSION</p><p>5.x   ABANDONED VERSION - NOT SUPPORTED</p><p>more : <a href="https://netty.io/wiki/user-guide.html" target="_blank" rel="noopener">https://netty.io/wiki/user-guide.html</a></p><h2 id="ä¸‰ä¸ªé—®é¢˜"><a href="#ä¸‰ä¸ªé—®é¢˜" class="headerlink" title="ä¸‰ä¸ªé—®é¢˜"></a>ä¸‰ä¸ªé—®é¢˜</h2><ul><li>IOæ¨¡å‹ (NIO)</li><li>æ•°æ®åè®®(é›¶æ‹·è´ã€åºåˆ—åŒ–æ¡†æ¶)</li><li>çº¿ç¨‹æ¨¡å‹(é”)</li></ul><h2 id="é«˜æ€§èƒ½ä¹‹é“"><a href="#é«˜æ€§èƒ½ä¹‹é“" class="headerlink" title="é«˜æ€§èƒ½ä¹‹é“"></a>é«˜æ€§èƒ½ä¹‹é“</h2><h3 id="å¼‚æ­¥éé˜»å¡é€šä¿¡"><a href="#å¼‚æ­¥éé˜»å¡é€šä¿¡" class="headerlink" title="å¼‚æ­¥éé˜»å¡é€šä¿¡"></a>å¼‚æ­¥éé˜»å¡é€šä¿¡</h3><p>â€‹    NIOã€å¤šè·¯å¤ç”¨I/O(JNI epoll)</p><p><a href="http://gee.cs.oswego.edu/dl/cpjslides/nio.pdf" target="_blank" rel="noopener">http://gee.cs.oswego.edu/dl/cpjslides/nio.pdf</a></p><h3 id="é›¶æ‹·è´"><a href="#é›¶æ‹·è´" class="headerlink" title="é›¶æ‹·è´"></a>é›¶æ‹·è´</h3><p>â€‹    Zero-Copy describes computer operations in which the CPU does not perform the task of copying data from one memory area to another.</p><h4 id="ç›´æ¥å †å¤–å†…å­˜"><a href="#ç›´æ¥å †å¤–å†…å­˜" class="headerlink" title="ç›´æ¥å †å¤–å†…å­˜"></a>ç›´æ¥å †å¤–å†…å­˜</h4><p>â€‹        Netty çš„æ¥æ”¶å’Œå‘é€ ByteBuffer é‡‡ç”¨ DIRECTBUFFERSï¼Œä½¿ç”¨å †å¤–ç›´æ¥å†…å­˜è¿›è¡Œ Socket è¯»å†™ï¼Œä¸éœ€è¦è¿›è¡Œå­—èŠ‚ç¼“å†²åŒºçš„äºŒæ¬¡æ‹·è´</p><p>â€‹    å¦‚æœä½¿ç”¨ä¼ ç»Ÿçš„å †å†…å­˜åˆ†é…ï¼Œå½“æˆ‘ä»¬éœ€è¦å°†æ•°æ®é€šè¿‡socketå‘é€çš„æ—¶å€™ï¼Œå°±éœ€è¦ä»å †å†…å­˜æ‹·è´åˆ°ç›´æ¥å†…å­˜ï¼Œç„¶åå†ç”±ç›´æ¥å†…å­˜æ‹·è´åˆ°ç½‘å¡æ¥å£å±‚ã€‚<br>Nettyæä¾›çš„ç›´æ¥Bufferï¼Œç›´æ¥å°†æ•°æ®åˆ†é…åˆ°å†…å­˜ç©ºé—´ï¼Œä»è€Œé¿å…äº†æ•°æ®çš„æ‹·è´ï¼Œå®ç°äº†é›¶æ‹·è´ã€‚</p><h4 id="ç»„åˆBufferå¯¹è±¡"><a href="#ç»„åˆBufferå¯¹è±¡" class="headerlink" title="ç»„åˆBufferå¯¹è±¡"></a>ç»„åˆBufferå¯¹è±¡</h4><p>â€‹        Netty æä¾›äº†ç»„åˆ Buffer å¯¹è±¡ï¼Œå¯ä»¥èšåˆå¤šä¸ª ByteBuffer å¯¹è±¡ï¼Œç”¨æˆ·å¯ä»¥åƒæ“ä½œä¸€ä¸ª Buffer é‚£æ ·æ–¹ä¾¿çš„å¯¹ç»„åˆ Buffer è¿›è¡Œæ“ä½œï¼Œé¿å…äº†ä¼ ç»Ÿé€šè¿‡å†…å­˜æ‹·è´çš„æ–¹å¼å°†å‡ ä¸ªå° Buffer åˆå¹¶æˆä¸€ä¸ªå¤§çš„ Bufferã€‚</p><h4 id="æ–‡ä»¶ä¼ è¾“"><a href="#æ–‡ä»¶ä¼ è¾“" class="headerlink" title="æ–‡ä»¶ä¼ è¾“"></a>æ–‡ä»¶ä¼ è¾“</h4><p>â€‹        Netty çš„æ–‡ä»¶ä¼ è¾“é‡‡ç”¨äº† transferTo æ–¹æ³•ï¼Œå®ƒå¯ä»¥ç›´æ¥å°†æ–‡ä»¶ç¼“å†²åŒºçš„æ•°æ®å‘é€åˆ°ç›®æ ‡ Channelï¼Œé¿å…äº†ä¼ ç»Ÿé€šè¿‡å¾ªç¯ write æ–¹å¼å¯¼è‡´çš„å†…å­˜æ‹·è´é—®é¢˜ã€‚(Linuxå¯¹é›¶æ‹·è´çš„æ”¯æŒ) </p><h3 id="å †å¤–å†…å­˜çš„å†…å­˜æ± "><a href="#å †å¤–å†…å­˜çš„å†…å­˜æ± " class="headerlink" title="å †å¤–å†…å­˜çš„å†…å­˜æ± "></a>å †å¤–å†…å­˜çš„å†…å­˜æ± </h3><p>â€‹    ä¸ºäº†å°½é‡é‡ç”¨ç¼“å†²åŒºï¼ŒNetty æä¾›äº†åŸºäºå†…å­˜æ± çš„ç¼“å†²åŒºé‡ç”¨æœºåˆ¶</p><h3 id="é«˜æ•ˆçš„-Reactor-çº¿ç¨‹æ¨¡å‹"><a href="#é«˜æ•ˆçš„-Reactor-çº¿ç¨‹æ¨¡å‹" class="headerlink" title="é«˜æ•ˆçš„ Reactor çº¿ç¨‹æ¨¡å‹"></a>é«˜æ•ˆçš„ Reactor çº¿ç¨‹æ¨¡å‹</h3><ul><li><p>Reactor å•çº¿ç¨‹æ¨¡å‹</p></li><li><p>Reactor å¤šçº¿ç¨‹æ¨¡å‹         </p><p>  IO pool</p></li><li><p>ä¸»ä» Reactor å¤šçº¿ç¨‹æ¨¡å‹</p></li></ul><p>â€‹        Acceptor pool</p><h3 id="æ— é”åŒ–çš„ä¸²è¡Œè®¾è®¡ç†å¿µ"><a href="#æ— é”åŒ–çš„ä¸²è¡Œè®¾è®¡ç†å¿µ" class="headerlink" title="æ— é”åŒ–çš„ä¸²è¡Œè®¾è®¡ç†å¿µ"></a>æ— é”åŒ–çš„ä¸²è¡Œè®¾è®¡ç†å¿µ</h3><p>â€‹    Netty çš„ NioEventLoop è¯»å–åˆ°æ¶ˆæ¯ä¹‹åï¼Œç›´æ¥è°ƒç”¨ ChannelPipeline çš„ fireChannelRead(Object msg)ï¼Œåªè¦ç”¨æˆ·ä¸ä¸»åŠ¨åˆ‡æ¢çº¿ç¨‹ï¼Œä¸€ç›´ä¼šç”± NioEventLoop è°ƒç”¨åˆ° ç”¨æˆ·çš„ Handlerï¼ŒæœŸé—´ä¸è¿›è¡Œçº¿ç¨‹åˆ‡æ¢ï¼Œè¿™ç§ä¸²è¡ŒåŒ–å¤„ç†æ–¹å¼é¿å…äº†å¤šçº¿ç¨‹æ“ä½œå¯¼è‡´çš„é”çš„ ç«äº‰ï¼Œä»æ€§èƒ½è§’åº¦çœ‹æ˜¯æœ€ä¼˜çš„ã€‚</p><h3 id="é«˜æ•ˆçš„å¹¶å‘ç¼–ç¨‹"><a href="#é«˜æ•ˆçš„å¹¶å‘ç¼–ç¨‹" class="headerlink" title="é«˜æ•ˆçš„å¹¶å‘ç¼–ç¨‹"></a>é«˜æ•ˆçš„å¹¶å‘ç¼–ç¨‹</h3><ul><li>volatile çš„å¤§é‡ã€æ­£ç¡®ä½¿ç”¨</li><li>CAS å’ŒåŸå­ç±»çš„å¹¿æ³›ä½¿ç”¨</li><li>çº¿ç¨‹å®‰å…¨å®¹å™¨çš„ä½¿ç”¨</li><li>é€šè¿‡è¯»å†™é”æå‡å¹¶å‘æ€§èƒ½</li></ul><h3 id="é«˜æ€§èƒ½çš„åºåˆ—åŒ–æ¡†æ¶"><a href="#é«˜æ€§èƒ½çš„åºåˆ—åŒ–æ¡†æ¶" class="headerlink" title="é«˜æ€§èƒ½çš„åºåˆ—åŒ–æ¡†æ¶"></a>é«˜æ€§èƒ½çš„åºåˆ—åŒ–æ¡†æ¶</h3><p>â€‹    å½±å“åºåˆ—åŒ–æ€§èƒ½çš„å…³é”®å› ç´ </p><ul><li>åºåˆ—åŒ–åçš„ç æµå¤§å°(ç½‘ç»œå¸¦å®½çš„å ç”¨)</li><li>åºåˆ—åŒ–&amp;ååºåˆ—åŒ–çš„æ€§èƒ½(CPU èµ„æºå ç”¨)</li><li>æ˜¯å¦æ”¯æŒè·¨è¯­è¨€(å¼‚æ„ç³»ç»Ÿçš„å¯¹æ¥å’Œå¼€å‘è¯­è¨€åˆ‡æ¢)<br>  â€‹    é€šè¿‡æ‰©å±• Netty çš„ç¼–è§£ç æ¥å£ï¼Œç”¨æˆ·å¯ä»¥å® ç°å…¶å®ƒçš„é«˜æ€§èƒ½åºåˆ—åŒ–æ¡†æ¶</li></ul><h3 id="çµæ´»çš„-TCP-å‚æ•°é…ç½®èƒ½åŠ›"><a href="#çµæ´»çš„-TCP-å‚æ•°é…ç½®èƒ½åŠ›" class="headerlink" title="çµæ´»çš„ TCP å‚æ•°é…ç½®èƒ½åŠ›"></a>çµæ´»çš„ TCP å‚æ•°é…ç½®èƒ½åŠ›</h3><p>â€‹    SO_RCVBUF å’Œ SO_SNDBUF<br>â€‹        é€šå¸¸å»ºè®®å€¼ä¸º 128K æˆ–è€… 256K<br>â€‹    SO_TCPNODELAY<br>â€‹        NAGLE ç®—æ³•é€šè¿‡å°†ç¼“å†²åŒºå†…çš„å°å°åŒ…è‡ªåŠ¨ç›¸è¿ï¼Œç»„æˆè¾ƒå¤§çš„å°åŒ…ï¼Œé˜»æ­¢ å¤§é‡å°å°åŒ…çš„å‘é€é˜»å¡ç½‘ç»œï¼Œä»è€Œæé«˜ç½‘ç»œåº”ç”¨æ•ˆç‡ã€‚ä½†æ˜¯å¯¹äºæ—¶å»¶æ•æ„Ÿçš„åº”ç”¨åœºæ™¯éœ€è¦å…³ é—­è¯¥ä¼˜åŒ–ç®—æ³•ã€‚<br>â€‹    è½¯ä¸­æ–­<br>â€‹        RPS æ ¹æ®æ•°æ®åŒ…çš„æºåœ°å€ï¼Œç›®çš„åœ°å€ä»¥åŠç›®çš„å’Œæºç«¯å£ï¼Œè®¡ç®—å‡ºä¸€ä¸ª hash å€¼ï¼Œç„¶åæ ¹æ®è¿™ä¸ª hash å€¼æ¥é€‰æ‹©è½¯ä¸­æ–­è¿è¡Œçš„ cpu</p><p>â€‹                </p>]]></content>
      
      
      
        <tags>
            
            <tag> framework </tag>
            
            <tag> netty </tag>
            
            <tag> nio </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Note_æ·±å…¥ç†è§£javaè™šæ‹Ÿæœº</title>
      <link href="/2019/06/05/Note_%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/"/>
      <url>/2019/06/05/Note_%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/</url>
      
        <content type="html"><![CDATA[<p><img src="http://ww1.sinaimg.cn/large/006tNc79gy1g3qlkg3awoj30yg0mx4qp.jpg" alt="image-20190605212425037"></p><a id="more"></a><p>â€‹    è¿™é‡Œåªæ˜¯ç®€å•çš„åˆ—å‡ºä¹¦ä¸­çš„çŸ¥è¯†ç‚¹, å…¶å®æœ¬ä¹¦æ˜¯å¯¹ç›¸å…³è§„èŒƒ(JVMå’ŒJLS)å’ŒåŸºäºè™šæ‹Ÿæœºè§„èŒƒå®˜æ–¹å®ç°(HotSpot)çš„æ€»ç»“ ,æ›´å¤šè¯¦ç»†å¯ä»¥çœ‹ä¸‹é¢çš„æ‰©å±•é“¾æ¥</p><h2 id="å†…å­˜åŒºåŸŸ"><a href="#å†…å­˜åŒºåŸŸ" class="headerlink" title="å†…å­˜åŒºåŸŸ"></a>å†…å­˜åŒºåŸŸ</h2><h3 id="è¿è¡Œæ—¶æ•°æ®åŒºåŸŸ"><a href="#è¿è¡Œæ—¶æ•°æ®åŒºåŸŸ" class="headerlink" title="è¿è¡Œæ—¶æ•°æ®åŒºåŸŸ"></a>è¿è¡Œæ—¶æ•°æ®åŒºåŸŸ</h3><h4 id="ç¨‹åºè®¡æ•°å™¨"><a href="#ç¨‹åºè®¡æ•°å™¨" class="headerlink" title="ç¨‹åºè®¡æ•°å™¨"></a>ç¨‹åºè®¡æ•°å™¨</h4><p>â€‹    çº¿ç¨‹ç‹¬ç«‹ï¼Œåœ¨è™šæ‹Ÿæœºæ¦‚å¿µæ¨¡å‹é‡Œï¼Œå­—èŠ‚ç è§£é‡Šå™¨å·¥ä½œæ—¶é€šè¿‡è¿™ä¸ªè®¡æ•°å™¨æ¥é€‰å–ä¸‹ä¸€æ¡éœ€è¦æ‰§è¡Œçš„æŒ‡ä»¤</p><h4 id="Javaè™šæ‹Ÿæœºæ ˆ"><a href="#Javaè™šæ‹Ÿæœºæ ˆ" class="headerlink" title="Javaè™šæ‹Ÿæœºæ ˆ"></a>Javaè™šæ‹Ÿæœºæ ˆ</h4><p>â€‹    çº¿ç¨‹ç‹¬ç«‹ï¼Œæ¯ä¸ªæ–¹æ³•åœ¨æ‰§è¡Œæ—¶ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼Œè°ƒç”¨ç›´è‡³æ‰§è¡Œå®Œæˆçš„è¿‡ç¨‹ï¼Œå°±å¯¹åº”ä¸€ä¸ªæ ˆå¸§åœ¨è™šæ‹Ÿæœºæ ˆä¸­å…¥æ ˆåˆ°å‡ºæ ˆçš„è¿‡ç¨‹</p><h4 id="æœ¬åœ°æ–¹æ³•æ ˆ"><a href="#æœ¬åœ°æ–¹æ³•æ ˆ" class="headerlink" title="æœ¬åœ°æ–¹æ³•æ ˆ"></a>æœ¬åœ°æ–¹æ³•æ ˆ</h4><p>â€‹    ä¸è™šæ‹Ÿæœºæ ˆç±»ä¼¼ï¼Œä¸è¿‡å®ƒä¸ºNativeæ–¹æ³•æœåŠ¡</p><h4 id="Javaå †"><a href="#Javaå †" class="headerlink" title="Javaå †"></a>Javaå †</h4><p>â€‹    çº¿ç¨‹å…±äº«ï¼Œæ‰€æœ‰å¯¹è±¡å®ä¾‹ä»¥åŠæ•°ç»„éƒ½è¦åœ¨å †ä¸Šåˆ†é…ï¼ˆä¸ç»å¯¹ï¼‰<br>â€‹    ä¸ç»å¯¹çš„åŸå› ï¼šJITç¼–è¯‘å™¨å‘å±•ä¸é€ƒé€¸åˆ†ææŠ€æœ¯é€æ¸æˆç†Ÿï¼Œæ ˆä¸Šåˆ†é…ã€æ ‡é‡æ›¿æ¢</p><h4 id="æ–¹æ³•åŒº"><a href="#æ–¹æ³•åŒº" class="headerlink" title="æ–¹æ³•åŒº"></a>æ–¹æ³•åŒº</h4><p>â€‹    çº¿ç¨‹å…±äº«ï¼Œç”¨äºå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç <br>â€‹    è¿è¡Œæ—¶å¸¸é‡æ± , ç”¨äºå­˜æ”¾ç¼–è¯‘å™¨ç”Ÿæˆçš„å„ç§å­—é¢é‡å’Œç¬¦å·å¼•ç”¨</p><h4 id="ç›´æ¥å†…å­˜"><a href="#ç›´æ¥å†…å­˜" class="headerlink" title="ç›´æ¥å†…å­˜"></a>ç›´æ¥å†…å­˜</h4><p>â€‹    å¹¶ä¸æ˜¯è™šæ‹Ÿæœºè¿è¡Œæ—¶æ•°æ®åŒºçš„ä¸€éƒ¨åˆ†ï¼Œä¼šæ”¶åˆ°æœ¬æœºæ€»å†…å­˜å¤§å°ä»¥åŠå¤„ç†å™¨å¯»å€ç©ºé—´çš„é™åˆ¶<br>â€‹    NIOï¼Œå¼•å…¥ä¸€ç§åŸºäºé€šé“ä¸ç¼“å†²åŒºçš„I/Oæ–¹å¼</p><h3 id="HotSpotè™šæ‹Ÿæœºå¯¹è±¡æ¢ç§˜"><a href="#HotSpotè™šæ‹Ÿæœºå¯¹è±¡æ¢ç§˜" class="headerlink" title="HotSpotè™šæ‹Ÿæœºå¯¹è±¡æ¢ç§˜"></a>HotSpotè™šæ‹Ÿæœºå¯¹è±¡æ¢ç§˜</h3><h4 id="å¯¹è±¡çš„åˆ›å»º"><a href="#å¯¹è±¡çš„åˆ›å»º" class="headerlink" title="å¯¹è±¡çš„åˆ›å»º"></a>å¯¹è±¡çš„åˆ›å»º</h4><ol><li>æ£€æŸ¥</li><li>ç±»åŠ è½½</li><li>åˆ†é…å†…å­˜</li><li>åˆå§‹åŒ–é›¶å€¼</li><li>å¯¹è±¡å¤´å¤„ç†</li><li><init>åˆå§‹åŒ–</init></li></ol><h4 id="å¯¹è±¡çš„å†…å­˜å¸ƒå±€"><a href="#å¯¹è±¡çš„å†…å­˜å¸ƒå±€" class="headerlink" title="å¯¹è±¡çš„å†…å­˜å¸ƒå±€"></a>å¯¹è±¡çš„å†…å­˜å¸ƒå±€</h4><p>å¯¹è±¡å¤´<br>        å¯¹è±¡è‡ªèº«çš„è¿è¡Œæ—¶æ•°æ®<br>                        å¯¹è±¡å“ˆå¸Œç ã€å¯¹è±¡åˆ†ä»£å¹´é¾„<br>                        GCåˆ†ä»£å¹´é¾„<br>                        é”çŠ¶æ€æ ‡è®°<br>                        çº¿ç¨‹æŒæœ‰çš„é”<br>                        åå‘çº¿ç¨‹ID<br>                        åå‘æ—¶é—´æˆ³<br>        ç±»å‹æŒ‡é’ˆ<br>å®ä¾‹æ•°æ®<br>å¯¹é½å¡«å……<br>        å¯¹è±¡å¤§å°å¿…é¡»æ˜¯8å­—èŠ‚çš„æ•´æ•°å€</p><h4 id="å¯¹è±¡çš„è®¿é—®å®šä½"><a href="#å¯¹è±¡çš„è®¿é—®å®šä½" class="headerlink" title="å¯¹è±¡çš„è®¿é—®å®šä½"></a>å¯¹è±¡çš„è®¿é—®å®šä½</h4><p>ä½¿ç”¨å¥æŸ„<br>        referenceå­˜å‚¨çš„å¯¹è±¡çš„å¥æŸ„åœ°å€,å¥æŸ„åŒ…å«äº†å®ä¾‹æ•°æ®å’Œæ•°æ®ç±»å‹å„ç§çš„åœ°å€<br>        ä¼˜åŠ¿,åœ¨å¯¹è±¡è¢«ç§»åŠ¨æ—¶ï¼Œåªä¼šæ”¹å˜å¥æŸ„ä¸­çš„å®ä¾‹æ•°æ®æŒ‡é’ˆï¼Œè€Œreferenceæœ¬èº«ä¸éœ€è¦ä¿®æ”¹<br>ç›´æ¥æŒ‡é’ˆï¼ˆHotSpotè™šæ‹Ÿæœºä½¿ç”¨ï¼‰<br>        referenceå­˜å‚¨çš„æ˜¯å¯¹è±¡åœ°å€<br>        ä¼˜åŠ¿,é€Ÿåº¦å¿«ï¼ŒèŠ‚çœäº†ä¸€æ¬¡æŒ‡é’ˆå®šä½çš„æ—¶é—´å¼€é”€</p><hr><h2 id="åƒåœ¾æ”¶é›†å™¨ä¸å†…å­˜åˆ†é…ç­–ç•¥"><a href="#åƒåœ¾æ”¶é›†å™¨ä¸å†…å­˜åˆ†é…ç­–ç•¥" class="headerlink" title="åƒåœ¾æ”¶é›†å™¨ä¸å†…å­˜åˆ†é…ç­–ç•¥"></a>åƒåœ¾æ”¶é›†å™¨ä¸å†…å­˜åˆ†é…ç­–ç•¥</h2><h3 id="å¯¹è±¡å¯å›æ”¶åˆ¤æ–­"><a href="#å¯¹è±¡å¯å›æ”¶åˆ¤æ–­" class="headerlink" title="å¯¹è±¡å¯å›æ”¶åˆ¤æ–­"></a>å¯¹è±¡å¯å›æ”¶åˆ¤æ–­</h3><p>â€‹            å¼•ç”¨è®¡æ•°ç®—æ³•<br>â€‹                ç¼ºç‚¹æ˜¯å¾ˆéš¾è§£å†³å¯¹è±¡ç›¸äº’å¼•ç”¨é—®é¢˜<br>â€‹            å¯è¾¾æ€§åˆ†æç®—æ³• GC Rootså¯¹è±¡<br>â€‹                è™šæ‹Ÿæœºæ ˆä¸­å¼•ç”¨çš„å¯¹è±¡<br>â€‹                æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡<br>â€‹                æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡<br>â€‹                æœ¬åœ°æ–¹æ³•æ ˆä¸­JNIå¼•ç”¨çš„å¯¹è±¡<br>â€‹            å¼•ç”¨<br>â€‹                å¼ºå¼•ç”¨<br>â€‹                è½¯å¼•ç”¨<br>â€‹                    åœ¨ç³»ç»Ÿå°†è¦å‘ç”Ÿå†…å­˜æº¢å‡ºå¼‚å¸¸ä¹‹å‰ï¼Œå°†ä¼šæŠŠè¿™äº›å¯¹è±¡åˆ—è¿›å›æ”¶èŒƒå›´ä¹‹ä¸­è¿›è¡ŒäºŒæ¬¡å›æ”¶<br>â€‹                å¼±å¼•ç”¨<br>â€‹                    åªèƒ½ç”Ÿå­˜åˆ°ä¸‹ä¸€æ¬¡åƒåœ¾æ”¶é›†å‘ç”Ÿä¹‹å‰<br>â€‹                è™šå¼•ç”¨<br>â€‹            ç”Ÿå­˜è¿˜æ˜¯æ­»äº¡<br>â€‹                1.ç¬¬ä¸€æ¬¡æ ‡è®°<br>â€‹                2.æ˜¯å¦è¦†ç›–finalizeæ–¹æ³•ï¼Œæˆ–è€…finalizeæ–¹æ³•å·²ç»è¢«è™šæ‹Ÿæœºè°ƒç”¨è¿‡<br>â€‹                3.æ”¾ç½®åœ¨F-Queueé˜Ÿåˆ—<br>â€‹            å›æ”¶æ–¹æ³•åŒº<br>â€‹                åºŸå¼ƒå¸¸é‡<br>â€‹                    æ— å¼•ç”¨<br>â€‹                æ— ç”¨çš„ç±»<br>â€‹                    è¯¥ç±»çš„æ‰€æœ‰å®ä¾‹éƒ½å·²ç»è¢«å›æ”¶<br>â€‹                    åŠ è½½è¯¥ç±»çš„ClassLoaderå·²ç»è¢«å›æ”¶<br>â€‹                    è¯¥ç±»å¯¹åº”çš„java.lang.Classå¯¹è±¡æ²¡æœ‰åœ¨ä»»ä½•åœ°æ–¹è¢«å¼•ç”¨ï¼Œæ— æ³•åœ¨ä»»ä½•åœ°æ–¹é€šè¿‡åå°„è®¿é—®è¯¥ç±»çš„æ–¹æ³•</p><h3 id="åƒåœ¾æ”¶é›†ç®—æ³•"><a href="#åƒåœ¾æ”¶é›†ç®—æ³•" class="headerlink" title="åƒåœ¾æ”¶é›†ç®—æ³•"></a>åƒåœ¾æ”¶é›†ç®—æ³•</h3><h4 id="æ ‡è®°-æ¸…é™¤ç®—æ³•"><a href="#æ ‡è®°-æ¸…é™¤ç®—æ³•" class="headerlink" title="æ ‡è®°-æ¸…é™¤ç®—æ³•"></a>æ ‡è®°-æ¸…é™¤ç®—æ³•</h4><p>â€‹    ä¸è¶³<br>â€‹            æ•ˆç‡é—®é¢˜<br>â€‹            ç©ºé—´é—®é¢˜</p><h4 id="å¤åˆ¶ç®—æ³•"><a href="#å¤åˆ¶ç®—æ³•" class="headerlink" title="å¤åˆ¶ç®—æ³•"></a>å¤åˆ¶ç®—æ³•</h4><p>ä¸è¶³ï¼šå°†å†…å­˜ç¼©å°ä¸ºåŸæ¥çš„ä¸€åŠ<br>ä¼˜åŒ–ï¼šç”±äºæ–°ç”Ÿä»£å¯¹è±¡å¤§éƒ¨åˆ†éƒ½æ˜¯æœç”Ÿå¤•æ­»ï¼Œæ‰€ä»¥å°†å†…å­˜åˆ’åˆ†ä¸º8ï¼š1ï¼ˆEdenå’ŒSurvivorï¼‰</p><h4 id="æ ‡è®°-æ•´ç†ç®—æ³•"><a href="#æ ‡è®°-æ•´ç†ç®—æ³•" class="headerlink" title="æ ‡è®°-æ•´ç†ç®—æ³•"></a>æ ‡è®°-æ•´ç†ç®—æ³•</h4><p>è€å¹´ä»£</p><h4 id="åˆ†ä»£æ”¶é›†ç®—æ³•"><a href="#åˆ†ä»£æ”¶é›†ç®—æ³•" class="headerlink" title="åˆ†ä»£æ”¶é›†ç®—æ³•"></a>åˆ†ä»£æ”¶é›†ç®—æ³•</h4><p>æ ¹æ®å¯¹è±¡å­˜æ´»å‘¨æœŸçš„ä¸åŒå°†å†…å­˜åˆ’åˆ†ä¸ºå‡ å—ï¼Œæ ¹æ®å„ä¸ªå¹´ä»£çš„ç‰¹ç‚¹é‡‡ç”¨æœ€é€‚åˆçš„æ”¶é›†ç®—æ³•</p><h3 id="HotSpotç®—æ³•å®ç°"><a href="#HotSpotç®—æ³•å®ç°" class="headerlink" title="HotSpotç®—æ³•å®ç°"></a>HotSpotç®—æ³•å®ç°</h3><p>æšä¸¾æ ¹èŠ‚ç‚¹<br>                ä½¿ç”¨OopMapçš„æ•°æ®ç»“æ„æ¥å¾—çŸ¥å“ªäº›åœ°æ–¹å­˜æ”¾è¿™å¯¹è±¡å¼•ç”¨ï¼ˆæ‰§è¡Œä¸Šä¸‹æ–‡å’Œå…¨å±€çš„å¼•ç”¨ä½ç½®ï¼‰<br>å®‰å…¨ç‚¹<br>HotSpotæ²¡æœ‰ä¸ºæ¯æ¡æŒ‡ä»¤éƒ½ç”ŸæˆOopMapï¼Œåªæœ‰åœ¨ç‰¹å®šçš„ä½ç½®ï¼Œè¿™äº›ä½ç½®ç§°ä¸ºå®‰å…¨ç‚¹<br>ç¨‹åºæ‰§è¡Œæ—¶ï¼Œåªæœ‰è¾¾åˆ°å®‰å…¨ç‚¹æ‰èƒ½æš‚åœ<br>GCæ—¶å€™æ€ä¹ˆè®©çº¿ç¨‹éƒ½åœ¨æœ€è¿‘å®‰å…¨ç‚¹åœæ­¢<br>        æŠ¢å…ˆå¼ä¸­æ–­<br>            GCæ—¶å€™ï¼Œå…ˆæŠŠæ‰€æœ‰çº¿ç¨‹ä¸­æ–­ï¼Œå¦‚æœå‘ç°æœ‰çº¿ç¨‹æ²¡æœ‰åœ¨å®‰å…¨ç‚¹ä¸Šï¼Œå°±æ¢å¤çº¿ç¨‹ï¼Œè®©å®ƒè·‘åˆ°å®‰å…¨ç‚¹<br>        ä¸»åŠ¨å¼ä¸­æ–­<br>            GCéœ€è¦ä¸­æ–­çš„æ—¶å€™ï¼Œä¸ç›´æ¥å¯¹çº¿ç¨‹æ“ä½œï¼Œé€šè¿‡è®¾ç½®ä¸€ä¸ªæ ‡è®°ï¼Œå„ä¸ªçº¿ç¨‹åœ¨å®‰å…¨ç‚¹æ—¶å€™å»è½®è¯¢è¿™ä¸ªæ ‡è¯†ï¼Œå‘ç°ä¸­æ–­æ ‡è¯†ä¸ºçœŸæ—¶å€™å°±è‡ªåŠ¨æŒ‚èµ·<br>å®‰å…¨åŒºåŸŸ<br>                æ˜¯æŒ‡åœ¨ä¸€æ®µä»£ç ç‰‡æ®µä¹‹ä¸­å¼•ç”¨å…³ç³»ä¸ä¼šå‘ç”Ÿå˜åŒ–<br>                è¿›å…¥safe Regionä¸­çš„ä»£ç ï¼Œä¼šæ ‡è¯†è‡ªå·±è¿›å…¥safe Region</p><h3 id="åƒåœ¾æ”¶é›†å™¨"><a href="#åƒåœ¾æ”¶é›†å™¨" class="headerlink" title="åƒåœ¾æ”¶é›†å™¨"></a>åƒåœ¾æ”¶é›†å™¨</h3><p>Serialæ”¶é›†å™¨<br>                è¿è¡Œåœ¨Clientæ¨¡å¼ä¸‹çš„å•çº¿ç¨‹åƒåœ¾æ”¶é›†å™¨çš„è™šæ‹Ÿæœº<br>ParNewæ”¶é›†å™¨<br>                è¿è¡Œåœ¨Serveræ¨¡å¼ä¸‹çš„å¤šçº¿ç¨‹åƒåœ¾æ”¶é›†å™¨çš„è™šæ‹Ÿæœº<br>Parallel Scavengeæ”¶é›†å™¨<br>                å¯æ§åˆ¶çš„ååé‡<br>Serial Oldæ”¶é›†å™¨<br>ParOldæ”¶é›†å™¨<br>CMSæ”¶é›†å™¨<br>        æœ€çŸ­å›æ”¶åœé¡¿æ—¶é—´ä¸ºç›®æ ‡çš„æ”¶é›†å™¨<br>                è¿è¡Œè¿‡ç¨‹<br>                    åˆå§‹æ ‡è®°<br>                        æ ‡è®°ä¸€ä¸‹GC Rootsèƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡ï¼ŒSTop The World<br>                    å¹¶å‘æ ‡è®°<br>                        GC Roots Tracingçš„è¿‡ç¨‹<br>                    é‡æ–°æ ‡è®°<br>                        ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´å› ç”¨æˆ·ç¨‹åºç»§ç»­è¿è¡Œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•,STop The World<br>                    å¹¶å‘æ¸…é™¤<br>                ç¼ºç‚¹<br>                    å¯¹CPUèµ„æºéå¸¸æ•æ„Ÿ<br>                    æ— æ³•å¤„ç†æµ®åŠ¨åƒåœ¾<br>                    æ ‡è®°æ¸…é™¤ï¼Œç¢ç‰‡è¿‡å¤šçš„è§£å†³æ–¹æ¡ˆ<br>                        UseCMSCompactAtFullCollection<br>                            FullGCå‰å…ˆå†…å­˜åˆå¹¶<br>                        CMSFullGCsBeforeCompaction<br>                            æ‰§è¡Œå¤šå°‘æ¬¡ä¸å‹ç¼©çš„FullGCåï¼Œè·Ÿç€æ¥ä¸€æ¬¡å¸¦å‹ç¼©çš„<br>G1æ”¶é›†å™¨ï¼ˆJDK1.7ï¼‰<br>                ç‰¹ç‚¹<br>                    å¹¶è¡Œä¸å¹¶å‘<br>                    åˆ†ä»£æ”¶é›†<br>                    ç©ºé—´æ•´åˆ<br>                    å¯é¢„æµ‹çš„åœé¡¿<br>                        åŸºäºRegionï¼Œç»´æŠ¤ä¸€ä¸ªä¼˜å…ˆåˆ—è¡¨ï¼Œæœ‰è®¡åˆ’çš„å›æ”¶åŒºåŸŸåƒåœ¾ï¼Œä¼˜å…ˆå›æ”¶ä»·å€¼å¤§çš„Region<br>                        Remembered Setæ¥é¿å…å…¨å †æ‰«æï¼Œä¿å­˜Regionä¹‹é—´çš„å¯¹è±¡å¼•ç”¨ä»¥åŠå…¶ä»–æ”¶é›†å™¨ä¸­çš„æ–°ç”Ÿä»£ä¸è€å¹´ä»£ä¹‹é—´çš„å¯¹è±¡å¼•ç”¨<br>                æ­¥éª¤<br>                    åˆå§‹æ ‡è®°<br>                    å¹¶å‘æ ‡è®°<br>                    æœ€ç»ˆæ ‡è®°<br>                        è™šæ‹Ÿæœºå°†å¹¶å‘æ ‡è®°æœŸé—´å¯¹è±¡çš„å˜åŒ–è®°å½•åœ¨çº¿ç¨‹Remembered Set Logsé‡Œï¼Œåˆå¹¶åˆ°Remember Setä¸­ï¼Œéœ€åœé¡¿ï¼Œå¯å¹¶è¡Œ<br>                    ç­›é€‰å›æ”¶<br>                        å¯¹Regionçš„å›æ”¶ä»·å€¼å’Œæˆæœ¬è¿›è¡Œæ’åºï¼Œæ ¹æ®ç”¨æˆ·æœŸå¾…çš„GCåœé¡¿æ—¶é—´æ¥åˆ¶å®šå›æ”¶è®¡åˆ’</p><h3 id="ç†è§£GCæ—¥å¿—"><a href="#ç†è§£GCæ—¥å¿—" class="headerlink" title="ç†è§£GCæ—¥å¿—"></a>ç†è§£GCæ—¥å¿—</h3><h3 id="åƒåœ¾æ”¶é›†å™¨å‚æ•°"><a href="#åƒåœ¾æ”¶é›†å™¨å‚æ•°" class="headerlink" title="åƒåœ¾æ”¶é›†å™¨å‚æ•°"></a>åƒåœ¾æ”¶é›†å™¨å‚æ•°</h3><h3 id="å†…å­˜åˆ†é…ä¸å›æ”¶ç­–ç•¥"><a href="#å†…å­˜åˆ†é…ä¸å›æ”¶ç­–ç•¥" class="headerlink" title="å†…å­˜åˆ†é…ä¸å›æ”¶ç­–ç•¥"></a>å†…å­˜åˆ†é…ä¸å›æ”¶ç­–ç•¥</h3><p>â€‹            å¯¹è±¡ä¼˜å…ˆåœ¨Edenåˆ†é…<br>â€‹            å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£<br>â€‹            é•¿æœŸå­˜æ´»çš„å¯¹è±¡å°†è¿›å…¥è€å¹´ä»£<br>â€‹            åŠ¨æ€å¯¹è±¡å¹´é¾„åˆ¤æ–­<br>â€‹            ç©ºé—´åˆ†é…æ‹…ä¿</p><hr><h2 id="è™šæ‹Ÿæœºæ€§èƒ½ç›‘æ§ä¸æ•…éšœå¤„ç†å·¥å…·"><a href="#è™šæ‹Ÿæœºæ€§èƒ½ç›‘æ§ä¸æ•…éšœå¤„ç†å·¥å…·" class="headerlink" title="è™šæ‹Ÿæœºæ€§èƒ½ç›‘æ§ä¸æ•…éšœå¤„ç†å·¥å…·"></a>è™šæ‹Ÿæœºæ€§èƒ½ç›‘æ§ä¸æ•…éšœå¤„ç†å·¥å…·</h2><h3 id="JDKçš„å‘½ä»¤è¡Œå·¥å…·"><a href="#JDKçš„å‘½ä»¤è¡Œå·¥å…·" class="headerlink" title="JDKçš„å‘½ä»¤è¡Œå·¥å…·"></a>JDKçš„å‘½ä»¤è¡Œå·¥å…·</h3><p>â€‹            jps<br>â€‹                JVM Process Status Toolï¼Œæ˜¾ç¤ºæŒ‡å®šç³»ç»Ÿå†…æ‰€æœ‰çš„HotSpotè™šæ‹Ÿæœºè¿›ç¨‹<br>â€‹            jstat<br>â€‹                JVM Statistics Monitoring Toolï¼Œç”¨äºæ”¶é›†HotSpotè™šæ‹Ÿæœºå„æ–¹é¢çš„è¿è¡Œæ•°æ®<br>â€‹            jinfo<br>â€‹                Configuration Info for Javaï¼Œæ˜¾ç¤ºè™šæ‹Ÿæœºé…ç½®ä¿¡æ¯<br>â€‹            jmap<br>â€‹                Memory Map for Javaï¼Œç”Ÿæˆè™šæ‹Ÿæœºçš„å†…å­˜å¿«ç…§ï¼ˆheapdumpæ–‡ä»¶ï¼‰ï¼Œå¦å¤–finalizeæ‰§è¡Œé˜Ÿåˆ—ã€Javaå †ã€æ°¸ä¹…ä»£çš„è¯¦ç»†ä¿¡æ¯<br>â€‹            jhat<br>â€‹                JVM Heap Dump Browserï¼Œç”¨äºåˆ†æheaddumpæ–‡ä»¶ï¼Œå»ºç«‹ä¸€ä¸ªHTTP/HTMLæœåŠ¡å™¨<br>â€‹            jstack<br>â€‹                Stack Trace for Java ï¼Œæ˜¾ç¤ºè™šæ‹Ÿæœºçš„çº¿ç¨‹å¿«ç…§ï¼Œä¸»è¦ç›®çš„æ˜¯å®šä½çº¿ç¨‹å‡ºç°é•¿æ—¶é—´åœé¡¿çš„åŸå› ï¼Œå¦‚çº¿ç¨‹é—´æ­»é”ã€æ­»å¾ªç¯ã€è¯·æ±‚å¤–éƒ¨èµ„æº</p><h3 id="JDKçš„å¯è§†åŒ–å·¥å…·"><a href="#JDKçš„å¯è§†åŒ–å·¥å…·" class="headerlink" title="JDKçš„å¯è§†åŒ–å·¥å…·"></a>JDKçš„å¯è§†åŒ–å·¥å…·</h3><h4 id="JConsole"><a href="#JConsole" class="headerlink" title="JConsole"></a>JConsole</h4><p>â€‹        æ¦‚è¿° jps<br>â€‹        å†…å­˜ jstat<br>â€‹        çº¿ç¨‹ jstack<br>â€‹        ç±»<br>â€‹        VMæ¦‚è¦ jinfo<br>â€‹        VMBean</p><h4 id="VisualVM"><a href="#VisualVM" class="headerlink" title="VisualVM"></a>VisualVM</h4><p>â€‹                åŠŸèƒ½<br>â€‹                    æ˜¾ç¤ºè™šæ‹Ÿæœºè¿›ç¨‹ä»¥åŠè¿›ç¨‹çš„é…ç½®ã€ç¯å¢ƒä¿¡æ¯ï¼ˆjpsã€jinfoï¼‰<br>â€‹                    ç›‘è§†åº”ç”¨ç¨‹åºçš„CPUã€GCã€å †ã€æ–¹æ³•åŒºä»¥åŠçº¿ç¨‹çš„ä¿¡æ¯ï¼ˆjstatã€jstackï¼‰<br>â€‹                    dumpä»¥åŠåˆ†æå †è½¬å‚¨å¿«ç…§ï¼ˆjmapã€jhatï¼‰<br>â€‹                    æ–¹æ³•çº§çš„ç¨‹åºè¿è¡Œæ€§èƒ½åˆ†æï¼Œæ‰¾å‡ºè¢«è°ƒç”¨æœ€å¤šã€è¿è¡Œæ—¶é—´æœ€é•¿çš„æ–¹æ³•<br>â€‹                    ç¦»çº¿ç¨‹åºå¿«ç…§ï¼šæ”¶é›†ç¨‹åºçš„è¿è¡Œæ—¶é…ç½®ã€çº¿ç¨‹dumpã€å†…å­˜dumpç­‰ä¿¡æ¯å»ºç«‹igeå¿«ç…§<br>â€‹                    â€¦<br>â€‹                æ’ä»¶<br>â€‹                    BTraceåŠ¨æ€æ—¥å¿—è·Ÿè¸ª</p><hr><h2 id="ç±»æ–‡ä»¶ç»“æ„"><a href="#ç±»æ–‡ä»¶ç»“æ„" class="headerlink" title="ç±»æ–‡ä»¶ç»“æ„"></a>ç±»æ–‡ä»¶ç»“æ„</h2><h3 id="æ— å…³æ€§çš„åŸºçŸ³"><a href="#æ— å…³æ€§çš„åŸºçŸ³" class="headerlink" title="æ— å…³æ€§çš„åŸºçŸ³"></a>æ— å…³æ€§çš„åŸºçŸ³</h3><p>â€‹            å¹³å°æ— å…³æ€§<br>â€‹                æ“ä½œç³»ç»Ÿçš„åº”ç”¨å±‚é¢ä¸Šï¼Œè™šæ‹Ÿæœºè½½å…¥å’Œæ‰§è¡ŒåŒä¸€ç§å¹³å°æ— å…³çš„å­—èŠ‚ç <br>â€‹            è¯­è¨€æ— å…³ç³»<br>â€‹                Groovy<br>â€‹                Scala<br>â€‹                â€¦</p><h3 id="Classç±»æ–‡ä»¶çš„ç»“æ„"><a href="#Classç±»æ–‡ä»¶çš„ç»“æ„" class="headerlink" title="Classç±»æ–‡ä»¶çš„ç»“æ„"></a>Classç±»æ–‡ä»¶çš„ç»“æ„</h3><p>â€‹            é­”æ•°ä¸Classæ–‡ä»¶çš„ç‰ˆæœ¬<br>â€‹            å¸¸é‡æ± <br>â€‹            è®¿é—®æ ‡å¿—<br>â€‹            ç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•ä¸æ¥å£ç´¢å¼•é›†åˆ<br>â€‹            å­—æ®µè¡¨é›†åˆ<br>â€‹            æ–¹æ³•è¡¨é›†åˆ<br>â€‹            å±æ€§è¡¨é›†åˆ</p><h3 id="å­—èŠ‚ç æŒ‡ä»¤ç®€ä»‹"><a href="#å­—èŠ‚ç æŒ‡ä»¤ç®€ä»‹" class="headerlink" title="å­—èŠ‚ç æŒ‡ä»¤ç®€ä»‹"></a>å­—èŠ‚ç æŒ‡ä»¤ç®€ä»‹</h3><p>â€‹            å­—èŠ‚ç ä¸æ•°æ®ç±»å‹<br>â€‹            åŠ è½½å’Œå­˜å‚¨æŒ‡ä»¤<br>â€‹            è¿ç®—æŒ‡ä»¤<br>â€‹            ç±»å‹è½¬æ¢æŒ‡ä»¤<br>â€‹            å¯¹è±¡åˆ›å»ºä¸è®¿é—®æŒ‡ä»¤<br>â€‹            æ“ä½œæ•°æ ˆç®¡ç†æŒ‡ä»¤<br>â€‹            æ§åˆ¶è½¬ç§»æŒ‡ä»¤<br>â€‹            æ–¹æ³•è°ƒç”¨å’Œè¿”å›æŒ‡ä»¤<br>â€‹            å¼‚å¸¸å¤„ç†æŒ‡ä»¤<br>â€‹            åŒæ­¥æŒ‡ä»¤</p><hr><h2 id="è™šæ‹Ÿæœºç±»åŠ è½½æœºåˆ¶"><a href="#è™šæ‹Ÿæœºç±»åŠ è½½æœºåˆ¶" class="headerlink" title="è™šæ‹Ÿæœºç±»åŠ è½½æœºåˆ¶"></a>è™šæ‹Ÿæœºç±»åŠ è½½æœºåˆ¶</h2><h3 id="ç±»åŠ è½½çš„æ—¶æœº"><a href="#ç±»åŠ è½½çš„æ—¶æœº" class="headerlink" title="ç±»åŠ è½½çš„æ—¶æœº"></a>ç±»åŠ è½½çš„æ—¶æœº</h3><p>å¿…é¡»åˆå§‹åŒ–çš„æƒ…å†µ<br>â€‹                é‡è§å­—èŠ‚ç æŒ‡ä»¤<br>â€‹                    new<br>â€‹                        ä½¿ç”¨newå…³é”®å­—å®ä¾‹åŒ–å¯¹è±¡çš„æ—¶å€™<br>â€‹                    getstatic<br>â€‹                    putstatic<br>â€‹                    invokestatic<br>â€‹                    è¯»å–æˆ–è®¾ç½®ä¸€ä¸ªç±»çš„é™æ€å­—æ®µï¼Œè°ƒç”¨ä¸€ä¸ªç±»çš„é™æ€æ–¹æ³•çš„æ—¶å€™<br>â€‹                ä½¿ç”¨java.lang.reflectåŒ…å¯¹ç±»è¿›è¡Œåå°„è°ƒç”¨çš„æ—¶å€™ï¼Œè§¦å‘å…¶åˆå§‹åŒ–<br>â€‹                åˆå§‹ä¸€ä¸ªç±»çš„æ—¶å€™ï¼Œå¦‚æœå‘ç°å…¶çˆ¶ç±»æ²¡æœ‰è¿›è¡Œåˆå§‹åŒ–ï¼Œå¯¹å…¶çˆ¶ç±»è¿›è¡Œåˆå§‹åŒ–<br>â€‹                è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œç”¨æˆ·éœ€è¦æŒ‡å®šä¸€ä¸ªè¦æ‰§è¡Œçš„ä¸»ç±»ï¼Œä¼šå…ˆåˆå§‹åŒ–è¿™ä¸ªä¸»ç±»<br>â€‹                MethodHandleå®ä¾‹æœ€åè§£æç»“æœREF_(..)staticçš„æ–¹æ³•å¥æŸ„ï¼Œå¥æŸ„å¯¹åº”çš„ç±»æ²¡æœ‰åˆå§‹åŒ–ï¼Œéœ€è¦å…ˆè§¦å‘å…¶åˆå§‹åŒ–<br>ç±»çš„ç”Ÿå‘½å‘¨æœŸ<br>åŠ è½½<br>è¿æ¥<br>â€‹                    éªŒè¯<br>â€‹                    å‡†å¤‡<br>â€‹                    è§£æ<br>åˆå§‹åŒ–<br>ä½¿ç”¨<br>å¸è½½<br>â€‹                </p><h3 id="ç±»åŠ è½½çš„è¿‡ç¨‹"><a href="#ç±»åŠ è½½çš„è¿‡ç¨‹" class="headerlink" title="ç±»åŠ è½½çš„è¿‡ç¨‹"></a>ç±»åŠ è½½çš„è¿‡ç¨‹</h3><p>â€‹            åŠ è½½<br>â€‹                1.é€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šåæ¥è·å–å®šä¹‰æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ<br>â€‹                    ä»ZIPåŒ…è·å–<br>â€‹                    ä»ç½‘ç»œä¸­è·å–<br>â€‹                    è¿è¡Œæ—¶è®¡ç®—ç”Ÿæˆï¼ŒåŠ¨æ€ä»£ç†<br>â€‹                    å…¶ä»–æ–‡ä»¶ï¼ŒJSP<br>â€‹                    ä»æ•°æ®åº“ä¸­è¯»å–<br>â€‹                2.å°†è¿™ä¸ªå­—èŠ‚æµæ‰€ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„è½¬æ¢ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„<br>â€‹                3.åœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¿™ä¸ªç±»çš„java.lang.Classå¯¹è±¡ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„å„ç§æ•°æ®çš„è®¿é—®å…¥å£<br>â€‹            è¿æ¥<br>â€‹                éªŒè¯<br>â€‹                    1.æ–‡ä»¶æ ¼å¼<br>â€‹                        Classæ–‡ä»¶æ ¼å¼è§„èŒƒ<br>â€‹                    2.å…ƒæ•°æ®<br>â€‹                        å¯¹å­—èŠ‚ç çš„è¯­ä¹‰åˆ†æ<br>â€‹                    3.å­—èŠ‚ç <br>â€‹                        é€šè¿‡æ•°æ®æµå’Œæ§åˆ¶æµï¼Œè¯­ä¹‰æ˜¯å¦åˆæ³•å’Œç¬¦åˆé€»è¾‘çš„<br>â€‹                    4.ç¬¦åˆå¼•ç”¨<br>â€‹                        å°†ç¬¦å·å¼•ç”¨è½¬åŒ–ä¸ºç›´æ¥å¼•ç”¨çš„æ—¶å€™<br>â€‹                    åŸºäºæ–¹æ³•åŒºçš„å­˜å‚¨ç»“æ„è¿›è¡Œ<br>â€‹                å‡†å¤‡<br>â€‹                    ä¸ºç±»å˜é‡åˆ†é…å†…å­˜å¹¶è®¾ç½®ç±»å˜é‡åˆå§‹åŒ–å€¼çš„é˜¶æ®µ<br>â€‹                è§£æ<br>â€‹                    è™šæ‹Ÿæœºå°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹<br>â€‹                    å®šä¹‰è§£é‡Š<br>â€‹                        ç¬¦å·å¼•ç”¨<br>â€‹                            ä¸è™šæ‹Ÿæœºå¸ƒå±€æ— å…³ï¼Œä½†æ˜¯ç¬¦å·å¼•ç”¨å¿…é¡»ä¸€è‡´ï¼Œå› ä¸ºç¬¦å·å¼•ç”¨çš„å­—é¢é‡å½¢å¼æ˜ç¡®å®šä¹‰åœ¨Javaè™šæ‹Ÿæœºè§„èŒƒClassæ–‡ä»¶æ ¼å¼æ±‡æ€»<br>â€‹                        ç›´æ¥å¼•ç”¨<br>â€‹                            æ˜¯ç›´æ¥æŒ‡å‘ç›®æ ‡çš„æŒ‡é’ˆã€ç›¸å¯¹åç§»é‡æˆ–æ˜¯ä¸€ä¸ªèƒ½é—´æ¥å®šä½åˆ°ç›®æ ‡çš„å¥æŸ„ï¼Œä¸è™šæ‹Ÿæœºå¸ƒå±€ç›¸å…³<br>â€‹                    ä¼˜åŒ–<br>â€‹                        å¯¹ç¬¬ä¸€æ¬¡è§£æçš„ç»“æœè¿›è¡Œç¼“å­˜ï¼Œåœ¨è¿è¡Œæ—¶å¸¸é‡æ± ä¸­è®°å½•ç›´æ¥å¼•ç”¨ï¼Œå¹¶æŠŠå¸¸é‡æ ‡è¯†ä¸ºå·²è§£æçŠ¶æ€ï¼ˆé™¤äº†invokedynamicï¼‰<br>â€‹                    é’ˆå¯¹<br>â€‹                        ç±»æˆ–æ¥å£ã€å­—æ®µã€ç±»æ–¹æ³•ã€æ¥å£æ–¹æ³•ã€æ–¹æ³•ç±»å‹ã€æ–¹æ³•å¥æŸ„å’Œè°ƒç”¨ç‚¹<br>â€‹            åˆå§‹åŒ–</p><h3 id="ç±»åŠ è½½å™¨"><a href="#ç±»åŠ è½½å™¨" class="headerlink" title="ç±»åŠ è½½å™¨"></a>ç±»åŠ è½½å™¨</h3><p>â€‹            ç±»ä¸ç±»åŠ è½½å™¨<br>â€‹                ç±»æ˜¯å¦ç›¸ç­‰çš„æ¯”è¾ƒï¼Œå‰ææ˜¯è¿™ä¸¤ä¸ªç±»ç”±åŒä¸€ä¸ªç±»åŠ è½½å™¨åŠ è½½çš„å‰æä¸‹æ‰æœ‰æ„ä¹‰<br>â€‹            åŒäº²å§”æ´¾æ¨¡å‹<br>â€‹                å¯åŠ¨ç±»åŠ è½½å™¨<br>â€‹                æ‰©å±•ç±»åŠ è½½å™¨<br>â€‹                åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨<br>â€‹            ç ´ååŒäº²å§”æ´¾æ¨¡å‹<br>â€‹                ç¬¬ä¸€æ¬¡ç ´å<br>â€‹                    åŸå› ï¼šå‘å‰å…¼å®¹<br>â€‹                    è§£å†³æ–¹æ³•ï¼šClassLoaderæ–°å¢ä¸€ä¸ªprotectedæ–¹æ³•findClass<br>â€‹                ç¬¬äºŒæ¬¡ç ´å<br>â€‹                    åŸå› ï¼šåŸºç¡€ç±»æƒ³è¦è°ƒç”¨SPIï¼ˆService Provider Interfaceï¼‰<br>â€‹                    è§£å†³æ–¹æ³•ï¼šçº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨<br>â€‹                ç¬¬ä¸‰æ¬¡ç ´å<br>â€‹                    åŸå› ï¼šè¿½æ±‚ç¨‹åºçš„åŠ¨æ€æ€§ï¼Œä»£ç çƒ­æ›¿æ¢ï¼Œæ¨¡å—çƒ­éƒ¨ç½²<br>â€‹                    è§£å†³æ–¹æ³•ï¼šOSGI</p><hr><h2 id="è™šæ‹Ÿæœºå­—èŠ‚ç æ‰§è¡Œå¼•æ“"><a href="#è™šæ‹Ÿæœºå­—èŠ‚ç æ‰§è¡Œå¼•æ“" class="headerlink" title="è™šæ‹Ÿæœºå­—èŠ‚ç æ‰§è¡Œå¼•æ“"></a>è™šæ‹Ÿæœºå­—èŠ‚ç æ‰§è¡Œå¼•æ“</h2><h3 id="è¿è¡Œæ—¶æ ˆå¸§ç»“æ„"><a href="#è¿è¡Œæ—¶æ ˆå¸§ç»“æ„" class="headerlink" title="è¿è¡Œæ—¶æ ˆå¸§ç»“æ„"></a>è¿è¡Œæ—¶æ ˆå¸§ç»“æ„</h3><p>â€‹            å±€éƒ¨å˜é‡è¡¨<br>â€‹                æ˜¯ä¸€ç»„å˜é‡å€¼å­˜å‚¨ç©ºé—´ï¼Œç”¨äºå­˜æ”¾æ–¹æ³•å‚æ•°å’Œæ–¹æ³•å†…éƒ¨å®šä¹‰çš„å±€éƒ¨å˜é‡ï¼ŒSlotä¸ºæœ€å°å•ä½<br>â€‹                å±€éƒ¨å˜é‡è¡¨ä¸åƒç±»å˜é‡ï¼Œå¹¶ä¸ä¼šèµ‹é»˜è®¤å€¼<br>â€‹            æ“ä½œæ ˆ<br>â€‹                LIFOæ ˆ<br>â€‹            åŠ¨æ€è¿æ¥<br>â€‹                æ¯ä¸ªæ ˆå¸§éƒ½åŒ…å«äº†ä¸€ä¸ªæŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± ä¸­è¯¥æ ˆå¸§æ‰€å±æ–¹æ³•çš„å¼•ç”¨ï¼ŒæŒæœ‰è¿™ä¸ªå¼•ç”¨æ˜¯ä¸ºäº†æ”¯æŒæ–¹æ³•è°ƒç”¨è¿‡ç¨‹ä¸­çš„åŠ¨æ€è¿æ¥<br>â€‹            è¿”å›åœ°å€<br>â€‹                æ­£å¸¸æ‰§è¡Œè¿”å›<br>â€‹                å¼‚å¸¸é€€å‡º<br>â€‹            â€¦</p><h3 id="æ–¹æ³•è°ƒç”¨"><a href="#æ–¹æ³•è°ƒç”¨" class="headerlink" title="æ–¹æ³•è°ƒç”¨"></a>æ–¹æ³•è°ƒç”¨</h3><p>â€‹            å”¯ä¸€ä»»åŠ¡å°±æ˜¯ç¡®å®šè¢«è°ƒç”¨æ–¹æ³•çš„ç‰ˆæœ¬ï¼ˆå³è°ƒç”¨å“ªä¸€ä¸ªæ–¹æ³•ï¼‰<br>â€‹            è§£æ<br>â€‹                å­—èŠ‚ç æŒ‡ä»¤<br>â€‹                    invokestatic<br>â€‹                        è°ƒç”¨é™æ€æ–¹æ³•<br>â€‹                    invokespecial<br>â€‹                        è°ƒç”¨å®ä¾‹æ„é€ å™¨<init>æ–¹æ³•ã€ç§æœ‰æ–¹æ³•å’Œçˆ¶ç±»æ–¹æ³•<br>â€‹                    invokevirtual<br>â€‹                        è°ƒç”¨æ‰€æœ‰è™šæ–¹æ³•<br>â€‹                    invokeinterface<br>â€‹                        è°ƒç”¨æ¥å£æ–¹æ³•ï¼Œä¼šåœ¨è¿è¡Œæ—¶å†ç¼ºç‚¹ä¸€ä¸ªå®ç°æ­¤æ¥å£çš„å¯¹è±¡<br>â€‹                    invokedynamic<br>â€‹                        å…ˆåœ¨è¿è¡Œæ—¶åŠ¨æ€è§£æå‡ºè°ƒç”¨ç‚¹é™å®šç¬¦æ‰€å¼•ç”¨çš„çš„æ–¹æ³•ï¼Œç„¶åæ‰§è¡Œï¼Œåˆ†æ´¾é€»è¾‘æ˜¯ç”¨æˆ·æ‰€è®¾å®šçš„å¼•å¯¼æ–¹æ³•å†³å®šçš„<br>â€‹                    éè™šæ–¹æ³•ï¼Œé™¤äº†è¿™ä¸¤ä¸ªæŒ‡ä»¤ï¼Œè¿˜åŒ…å«è¢«finalä¿®é¥°çš„æ–¹æ³•<br>â€‹            åˆ†æ´¾<br>â€‹                é™æ€åˆ†æ´¾<br>â€‹                    æ‰€æœ‰ä¾èµ–é™æ€ç±»å‹æ¥å®šä½æ–¹æ³•æ‰§è¡Œç‰ˆæœ¬çš„åˆ†æ´¾åŠ¨ä½œç§°ä¸ºé™æ€åˆ†æ´¾<br>â€‹                åŠ¨æ€åˆ†æ´¾<br>â€‹                    invokevirtualæŒ‡ä»¤çš„è¿è¡Œæ—¶è§£æè¿‡ç¨‹<br>â€‹                        1.æ‰¾åˆ°æ“ä½œæ•°æ ˆé¡¶çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ‰€æŒ‡å‘çš„å¯¹è±¡çš„å®é™…ç±»å‹ï¼Œè®°ä¸ºC<br>â€‹                        2.å¦‚æœåœ¨ç±»å‹Cä¸­æ‰¾åˆ°ä¸å¸¸é‡ä¸­çš„æè¿°ç¬¦å’Œç®€å•åç§°éƒ½ç›¸ç¬¦çš„æ–¹æ³•ï¼Œåˆ™è¿›è¡Œæƒé™æ ¡éªŒ<br>â€‹                            é€šè¿‡ï¼Œåˆ™è¿”å›è¿™ä¸ªæ–¹æ³•çš„ç›´æ¥å¼•ç”¨ï¼ŒæŸ¥æ‰¾è¿‡ç¨‹ç»“æŸ<br>â€‹                            å¦åˆ™ï¼Œåˆ™è¿”å›java.lang.IllegalAccessErrorå¼‚å¸¸<br>â€‹                        3.å¦åˆ™ï¼ŒæŒ‰ç…§ç»§æ‰¿å…³ç³»ä»ä¸‹å¾€ä¸Šä¾æ¬¡å¯¹Cçš„å„ä¸ªçˆ¶ç±»è¿›è¡Œç¬¬2æ­¥çš„æœç´¢å’ŒéªŒè¯è¿‡ç¨‹<br>â€‹                        4.å¦‚æœå§‹ç»ˆæ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„æ–¹æ³•ï¼Œåˆ™æŠ›å‡ºjava.lang.AbstractMethodErrorå¼‚å¸¸<br>â€‹                å•åˆ†æ´¾ä¸å¤šåˆ†æ´¾<br>â€‹                    Javaè¯­è¨€æ˜¯ä¸€é—¨é™æ€å¤šåˆ†æ´¾ã€åŠ¨æ€å•åˆ†æ´¾çš„è¯­è¨€<br>â€‹                è™šæ‹ŸæœºåŠ¨æ€åˆ†æ´¾çš„å®ç°<br>â€‹                    è™šæ–¹æ³•è¡¨<br>â€‹                        è™šæ–¹æ³•è¡¨ä¸­å­˜æ”¾ç€å„ä¸ªæ–¹æ³•çš„å®é™…å…¥å£åœ°å€<br>â€‹                    éç¨³å®šâ€œæ¿€è¿›â€ä¼˜åŒ–<br>â€‹                        å†…è”ç¼“å­˜<br>â€‹                        åŸºäºâ€œç±»å‹ç»§æ‰¿å…³ç³»åˆ†ææŠ€æœ¯â€çš„å®ˆæŠ¤å†…è”</init></p><h3 id="åŠ¨æ€ç±»å‹è¯­è¨€æ”¯æŒ"><a href="#åŠ¨æ€ç±»å‹è¯­è¨€æ”¯æŒ" class="headerlink" title="åŠ¨æ€ç±»å‹è¯­è¨€æ”¯æŒ"></a>åŠ¨æ€ç±»å‹è¯­è¨€æ”¯æŒ</h3><p>â€‹            åŠ¨æ€ç±»å‹è¯­è¨€<br>â€‹                å…³é”®ç‰¹å¾æ˜¯å®ƒçš„ç±»å‹æ£€æŸ¥çš„ä¸»é¢˜è¿‡ç¨‹æ˜¯åœ¨è¿è¡ŒæœŸè€Œä¸æ˜¯ç¼–è¯‘æœŸ<br>â€‹            JDK1.7ä¸åŠ¨æ€ç±»å‹<br>â€‹                1.7ä¹‹å‰ï¼Œè™šæ‹Ÿæœºå®ç°åŠ¨æ€ç±»å‹è¯­è¨€çš„æ–¹å¼ï¼Œç•™ä¸ªå ä½ç¬¦ç±»å‹ï¼Œè¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆå­—èŠ‚ç å®ç°å…·ä½“ç±»å‹åˆ°å ä½ç¬¦ç±»å‹çš„é€‚é…<br>â€‹            java.lang.invokeåŒ…<br>â€‹                æœ¬è´¨ä¸Š<br>â€‹                    MethodHandleæ˜¯åœ¨æ¨¡æ‹Ÿå­—èŠ‚ç å±‚æ¬¡çš„æ–¹æ³•è°ƒç”¨<br>â€‹                        findStatic<br>â€‹                            invokestatic<br>â€‹                        findVirtual<br>â€‹                            invokevirtual<br>â€‹                        findSpecial<br>â€‹                            invokespecial<br>â€‹                    Reflectionæ˜¯åœ¨æ¨¡æ‹ŸJavaä»£ç å±‚æ¬¡çš„æ–¹æ³•è°ƒç”¨<br>â€‹                å†…å®¹ä¸Š<br>â€‹                    MethodHandleä»…ä»…åŒ…å«ä¸æ‰§è¡Œæ–¹æ³•ç›¸å…³çš„ä¿¡æ¯ è½»é‡çº§<br>â€‹                    ReflectionåŒ…å«äº†æ–¹æ³•çš„ç­¾åã€æè¿°ç¬¦ä»¥åŠæ–¹æ³•å±æ€§è¡¨ä¸­å„ç§å±æ€§çš„Javaç«¯è¡¨ç¤ºæ–¹å¼ï¼Œæ‰§è¡Œæƒé™ç­‰è¿è¡ŒæœŸä¿¡æ¯ é‡é‡çº§<br>â€‹                æ€§èƒ½ä¸Š<br>â€‹                    MethodHandle æ˜¯å¯¹å­—èŠ‚ç çš„æ–¹æ³•æŒ‡ä»¤è°ƒç”¨æ¨¡æ‹Ÿï¼Œæ‰€ä»¥å¯ä»¥å¤ç”¨è™šæ‹Ÿæœºçš„å„ç§ä¼˜åŒ–ï¼Œä¾‹å¦‚æ–¹æ³•å†…è”ç­‰<br>â€‹                    Reflection æ²¡æœ‰ç›¸åº”çš„ä¼˜åŒ–<br>â€‹            invokedynamicæŒ‡ä»¤</p><h3 id="åŸºäºæ ˆçš„å­—èŠ‚ç è§£é‡Šæ‰§è¡Œå¼•æ“"><a href="#åŸºäºæ ˆçš„å­—èŠ‚ç è§£é‡Šæ‰§è¡Œå¼•æ“" class="headerlink" title="åŸºäºæ ˆçš„å­—èŠ‚ç è§£é‡Šæ‰§è¡Œå¼•æ“"></a>åŸºäºæ ˆçš„å­—èŠ‚ç è§£é‡Šæ‰§è¡Œå¼•æ“</h3><p>â€‹            è§£é‡Šæ‰§è¡Œ<br>â€‹                ç¨‹åºæºç <br>â€‹                è¯æ³•åˆ†æ<br>â€‹                å•è¯æµ<br>â€‹                è¯­æ³•åˆ†æ<br>â€‹                æŠ½è±¡è¯­æ³•æ ‘<br>â€‹                æŒ‡ä»¤æµ<br>â€‹                è§£é‡Šå™¨<br>â€‹                è§£é‡Šæ‰§è¡Œ<br>â€‹                ä¼˜åŒ–å™¨<br>â€‹                ä¸­é—´ä»£ç <br>â€‹                ç”Ÿæˆå™¨<br>â€‹                ç›®æ ‡ä»£ç <br>â€‹                æ­¥éª¤ä¸€ï¼š javacæ‰§è¡Œ<br>â€‹                æ­¥éª¤äºŒï¼šè§£é‡Šæ‰§è¡Œ<br>â€‹                æ­¥éª¤äºŒï¼šä¼ ç»Ÿç¼–è¯‘åŸç†<br>â€‹            åŸºäºæ ˆçš„æŒ‡ä»¤é›†ä¸åŸºäºå¯„å­˜å™¨çš„æŒ‡ä»¤é›†<br>â€‹                åŸºäºæ ˆçš„æŒ‡ä»¤é›†<br>â€‹                    ä¼˜ç‚¹<br>â€‹                        å¯ç§»æ¤<br>â€‹                    ç¼ºç‚¹<br>â€‹                        æ€§èƒ½æ…¢<br>â€‹                åŸºäºå¯„å­˜å™¨çš„æŒ‡ä»¤é›†</p><h3 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h3><p>â€‹            Tomcatæ­£ç»Ÿçš„ç±»åŠ è½½å™¨æ¶æ„<br>â€‹                éœ€è¦æ»¡è¶³çš„è¦æ±‚<br>â€‹                    éƒ¨ç½²åœ¨åŒä¸€ä¸ªæœåŠ¡å™¨ä¸Šçš„ä¸¤ä¸ªWebåº”ç”¨ç¨‹åºæ‰€ä½¿ç”¨çš„Javaç±»åº“å¯ä»¥å®ç°ç›¸äº’éš”ç¦»<br>â€‹                    éƒ¨ç½²åœ¨åŒä¸€ä¸ªæœåŠ¡å™¨ä¸Šçš„ä¸¤ä¸ªWebåº”ç”¨ç¨‹åºæ‰€ä½¿ç”¨çš„Javaç±»åº“å¯ä»¥ç›¸äº’å…±äº«<br>â€‹                    æœåŠ¡å™¨éœ€è¦å°½å¯èƒ½åœ°ä¿è¯è‡ªèº«çš„å®‰å…¨ä¸å—éƒ¨ç½²çš„Webåº”ç”¨ç¨‹åºå½±å“<br>â€‹                    æ”¯æŒJSPåº”ç”¨çš„WebæœåŠ¡å™¨<br>â€‹                Tomcatç›®å½•<br>â€‹                    /commonç›®å½•<br>â€‹                        ç±»åº“å¯è¢«Tomcatå’Œæ‰€æœ‰çš„Webåº”ç”¨ç¨‹åºå…±åŒä½¿ç”¨<br>â€‹                    /serverç›®å½•<br>â€‹                        ç±»åº“å¯è¢«Tomcatä½¿ç”¨ï¼Œå¯¹æ‰€æœ‰çš„Webåº”ç”¨ç¨‹åºéƒ½ä¸å¯è§<br>â€‹                    /sharedç›®å½•<br>â€‹                        ç±»åº“å¯è¢«æ‰€æœ‰çš„Webåº”ç”¨ç¨‹åºå…±åŒä½¿ç”¨ï¼Œä½†å¯¹Tomcatè‡ªèº«ä¸å¯è§<br>â€‹                    /WEB-INFç›®å½•<br>â€‹                        ç±»åº“ä»…å¯¹æ­¤Webåº”ç”¨ç¨‹åºä½¿ç”¨<br>â€‹                    Tomcat 6.xç‰ˆæœ¬ åˆå¹¶åˆ°ä¸€ä¸ªlibç›®å½•<br>â€‹            OSGi çµæ´»ç±»åŠ è½½å™¨æ¶æ„<br>â€‹                Bundle<br>â€‹                    å£°æ˜å®ƒæ‰€ä¾èµ–çš„Java Packageï¼ˆé€šè¿‡Import-Packageæè¿°ï¼‰<br>â€‹                    å£°æ˜å…è®¸å¯¼å‡ºå‘å¸ƒçš„Java Packageï¼ˆé€šè¿‡Export-Packageæè¿°ï¼‰<br>â€‹                ç±»åŠ è½½çš„æŸ¥æ‰¾è§„åˆ™<br>â€‹                    ä»¥java.*å¼€å¤´çš„ç±»ï¼Œå§”æ‰˜ç»™çˆ¶ç±»åŠ è½½å™¨åŠ è½½<br>â€‹                    å¦åˆ™ï¼Œå§”æ‰˜åˆ—è¡¨åå•å†…çš„ç±»ï¼Œå§”æ‰˜ç»™çˆ¶ç±»åŠ è½½å™¨<br>â€‹                    å¦åˆ™ï¼ŒImportåˆ—è¡¨ä¸­çš„ç±»ï¼Œå§”æ‰˜ç»™Exportè¿™ä¸ªç±»çš„Bundleçš„ç±»åŠ è½½å™¨å‡æœŸ<br>â€‹                    å¦åˆ™ï¼ŒæŸ¥æ‰¾å½“å‰Bundleçš„Classpathï¼Œä½¿ç”¨è‡ªå·±çš„ç±»åŠ è½½å™¨åŠ è½½<br>â€‹                    å¦åˆ™ï¼ŒæŸ¥æ‰¾æ˜¯å¦åœ¨åœ¨è‡ªå·±Fragment Bundleä¸­ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™å§”æ´¾ç»™Fragment Bundleçš„ç±»åŠ è½½å™¨<br>â€‹                    å¦åˆ™ï¼ŒæŸ¥æ‰¾Dynamic Importåˆ—è¡¨çš„Bundleï¼Œå§”æ´¾ç»™å¯¹åº”Bundleçš„ç±»åŠ è½½å™¨<br>â€‹                    å¦åˆ™ï¼Œç±»æŸ¥æ‰¾å¤±è´¥<br>â€‹                æä¾›å¼ºå¤§åŠŸèƒ½çš„åŒæ—¶ï¼Œä¹Ÿå¼•å…¥äº†é¢å¤–çš„å¤æ‚åº¦ï¼Œå¸¦æ¥äº†çº¿ç¨‹æ­»é”å’Œå†…å­˜æ³„éœ²çš„é£é™©ï¼ˆbundleçš„ç›¸äº’ä¾èµ–ï¼‰<br>â€‹            å­—èŠ‚ç ç”ŸæˆæŠ€æœ¯ä¸åŠ¨æ€ä»£ç†çš„å®ç°<br>â€‹                å­—èŠ‚ç ç”ŸæˆæŠ€æœ¯<br>â€‹                    å­—èŠ‚ç ç±»åº“<br>â€‹                        Javassist<br>â€‹                        CGLib<br>â€‹                        ASM<br>â€‹                    javac<br>â€‹                    JSPã€AOPã€åŠ¨æ€ä»£ç†ã€åå°„<br>â€‹                åŠ¨æ€ä»£ç†<br>â€‹                    ä»£ç†ç±»<br>â€‹                        å¤§è‡´è¿‡ç¨‹å°±æ˜¯æ ¹æ®Classæ–‡ä»¶çš„æ ¼å¼è§„èŒƒå»æ‹¼æ¥å­—èŠ‚ç <br>â€‹            Retrotranslator<br>â€‹                è·¨è¶ŠJDKç‰ˆæœ¬ï¼Œå…·ä½“å®ç°æ˜¯ä½¿ç”¨ASMå¯¹å­—èŠ‚ç ä¿®æ”¹<br>â€‹                JDKæ¯æ¬¡å‡çº§æ–°å¢åŠŸèƒ½åˆ†ç±»<br>â€‹                    ç¼–è¯‘å™¨å±‚é¢åšçš„æ”¹è¿›<br>â€‹                        è‡ªåŠ¨æ‹†ç®±è£…ç®±<br>â€‹                    å¯¹Java APIä»£ç å¢å¼º<br>â€‹                        JDK1.2çš„Collectionsé›†åˆç±»ï¼ŒJDK1.5çš„concurrentå¹¶å‘åŒ…<br>â€‹                    éœ€è¦åœ¨å­—èŠ‚ç ä¸­è¿›è¡Œæ”¯æŒçš„æ”¹åŠ¨<br>â€‹                        è­¬å¦‚ï¼ŒåŠ¨æ€è¯­è¨€æ”¯æŒï¼Œinvokedynamicå­—èŠ‚ç æŒ‡ä»¤<br>â€‹                    è™šæ‹Ÿæœºå†…éƒ¨çš„æ”¹è¿›<br>â€‹                        JDK1.5å®ç°JSR-133è§„èŒƒé‡æ–°å®šä¹‰Javaå†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰<br>â€‹                    åªèƒ½æ¨¡æ‹Ÿè¿™ä¸¤ç±»<br>â€‹            å®æˆ˜ï¼šè¿œç¨‹æ‰§è¡ŒåŠŸèƒ½<br>â€‹                ç›®æ ‡<br>â€‹                    ä¸ä¾èµ–JDKç‰ˆæœ¬<br>â€‹                    ä¸æ”¹å˜åŸæœ‰æœåŠ¡ç«¯ç¨‹åºçš„éƒ¨ç½²ï¼Œä¸ä¾èµ–ä»»ä½•ç¬¬ä¸‰æ–¹ç±»åº“<br>â€‹                    ä¸ä¾µå…¥åŸæœ‰ç¨‹åº<br>â€‹                    â€œä¸´æ—¶ä»£ç â€éœ€è¦ç›´æ¥æ”¯æŒjavaè¯­è¨€<br>â€‹                    â€œä¸´æ—¶ä»£ç â€éœ€è¦å…·å¤‡è¶³å¤Ÿçš„è‡ªç”±åº¦ï¼Œä¸éœ€è¦ä¾èµ–ç‰¹å®šçš„ç±»<br>â€‹                    â€œä¸´æ—¶ä»£ç â€çš„æ‰§è¡Œç»“æœå¯ä»¥è¿”å›å®¢æˆ·ç«¯<br>â€‹                é—®é¢˜åŠè§£å†³æ€è·¯<br>â€‹                    å¦‚ä½•ç¼–è¯‘æäº¤åˆ°æœåŠ¡å™¨çš„Javaä»£ç <br>â€‹                        ä½¿ç”¨tools.jaråŒ…<br>â€‹                        javacç¼–è¯‘å¥½ï¼Œä¸Šä¼ å­—èŠ‚ç ï¼ˆ.classï¼‰æ–‡ä»¶åˆ°æœåŠ¡ç«¯<br>â€‹                    å¦‚ä½•æ‰§è¡Œç¼–è¯‘ä¹‹åçš„Javaä»£ç <br>â€‹                        è®©ç±»åŠ è½½å™¨åŠ è½½è¿™ä¸ªç±»ç”Ÿæˆä¸€ä¸ªClasså¯¹è±¡ï¼Œç„¶ååå°„è°ƒç”¨ä¸€ä¸‹æŸä¸ªæ–¹æ³•<br>â€‹                    å¦‚ä½•æ”¶é›†Javaä»£ç çš„æ‰§è¡Œç»“æœ<br>â€‹                        ä½¿ç”¨æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯è¾“å‡ºè·å–æ‰“å°çš„ä¿¡æ¯ï¼Œä¼šå½±å“åˆ°åŸæœ‰ç¨‹åºï¼Œè¿™é‡Œæ ‡å‡†è¾“å‡ºè®¾å¤‡æ˜¯è™šæ‹Ÿæœºçº¿ç¨‹å…¨å±€å…±äº«çš„èµ„æº<br>â€‹                        ä½¿ç”¨è‡ªå·±å®šä¹‰çš„PrintStreamå¯¹è±¡ï¼Œä¼šæŠŠå…¶ä»–çº¿ç¨‹å‘æ ‡å‡†è¾“å‡ºä¸­æ‰“å°çš„ä¿¡æ¯ä¹Ÿæ”¶é›†äº†<br>â€‹                        ç›´æ¥åœ¨æ‰§è¡Œçš„ç±»ä¸­æŠŠå¯¹System.outçš„ç¬¦åˆå¼•ç”¨æ›¿æ¢ä¸ºæˆ‘ä»¬å‡†å¤‡çš„PrintStreamçš„ç¬¦åˆå¼•ç”¨</p><hr><h2 id="ç¼–è¯‘å™¨ä¼˜åŒ–"><a href="#ç¼–è¯‘å™¨ä¼˜åŒ–" class="headerlink" title="ç¼–è¯‘å™¨ä¼˜åŒ–"></a>ç¼–è¯‘å™¨ä¼˜åŒ–</h2><p>è™šæ‹Ÿæœºå›¢é˜ŸæŠŠå¯¹æ€§èƒ½çš„ä¼˜åŒ–é›†ä¸­åˆ°äº†åç«¯çš„å³æ—¶ç¼–è¯‘å™¨ä¸­ï¼Œè¿™æ ·å¯ä»¥è®©é‚£äº›ä¸æ˜¯ç”±Javacäº§ç”Ÿçš„Classæ–‡ä»¶ä¹ŸåŒæ ·èƒ½äº«å—åˆ°ç¼–è¯‘å™¨ä¼˜åŒ–æ‰€å¸¦æ¥çš„å¥½å¤„    </p><h3 id="Javacç¼–è¯‘å™¨"><a href="#Javacç¼–è¯‘å™¨" class="headerlink" title="Javacç¼–è¯‘å™¨"></a>Javacç¼–è¯‘å™¨</h3><p>ç¼–è¯‘è¿‡ç¨‹<br>                å‡†å¤‡è¿‡ç¨‹ï¼šåˆå§‹åŒ–æ’å…¥å¼æ³¨è§£å¤„ç†å™¨<br>1.è§£æä¸å¡«å……ç¬¦åˆè¡¨è¿‡ç¨‹<br>                    1.è¯æ³•åˆ†æã€è¯­æ³•åˆ†æ<br>                        è¯æ³•åˆ†æ<br>                            å°†æºä»£ç çš„å­—ç¬¦æµè½¬å˜ä¸ºæ ‡è®°ï¼ˆTokenï¼‰é›†åˆ<br>                        è¯­æ³•åˆ†æ<br>                            æ˜¯æ ¹æ®Tokenåºåˆ—æ„é€ æŠ½è±¡è¯­æ³•æ ‘çš„è¿‡ç¨‹<br>                    2.è¾“å…¥åˆ°ç¬¦å·è¡¨<br>                        ç¬¦å·è¡¨<br>                            æ˜¯ç”±ä¸€ç»„ç¬¦å·åœ°å€å’Œç¬¦åˆä¿¡æ¯æ„æˆçš„è¡¨æ ¼ï¼ˆK-Vï¼‰<br>2.æ’å…¥å¼æ³¨è§£å¤„ç†å™¨çš„æ³¨è§£å¤„ç†è¿‡ç¨‹<br>                    æ³¨è§£å¤„ç†å™¨<br>                        å¯ä»¥æŠŠå®ƒçœ‹ä½œæ˜¯ä¸€ç»„ç¼–è¯‘å™¨çš„æ’ä»¶ï¼Œå¯ä»¥è¯»å–ã€ä¿®æ”¹ã€æ·»åŠ æŠ½è±¡è¯­æ³•æ ‘ä¸­çš„ä»»æ„å…ƒç´ <br>                        æ³¨æ„ï¼šæ¯æ¬¡å¤„ç†å®Œæ³¨è§£ï¼Œå¦‚æœç”±ä¿®æ”¹éƒ½ä¼šRound<br>3.åˆ†æä¸å­—èŠ‚ç ç”Ÿæˆè¿‡ç¨‹<br>                    1.æ ‡æ³¨æ£€æŸ¥<br>                        æ£€æŸ¥çš„å†…å®¹åŒ…æ‹¬ï¼Œå˜é‡ä½¿ç”¨å‰æ˜¯å¦å·²è¢«å£°æ˜ï¼Œå˜é‡ä¸èµ‹å€¼ä¹‹é—´çš„æ•°æ®ç±»å‹æ˜¯å¦èƒ½å¤ŸåŒ¹é…ç­‰<br>                    2.æ•°æ®æµåˆ†æ<br>                        æ£€æŸ¥ç¨‹åºå±€éƒ¨å˜é‡åœ¨ä½¿ç”¨å‰æ˜¯å¦æœ‰èµ‹å€¼ã€æ–¹æ³•çš„æ¯æ¡è·¯å¾„æ˜¯å¦éƒ½æœ‰è¿”å›å€¼ã€æ˜¯å¦æ‰€æœ‰çš„å—æŸ¥å¼‚å¸¸éƒ½è¢«æ­£ç¡®å¤„ç†<br>                    3.è§£è¯­æ³•ç³–<br>                        æ³›å‹<br>                        å˜é•¿å‚æ•°<br>                        è‡ªåŠ¨è£…ç®±/æ‹†ç®±<br>                    4.ç”Ÿæˆå­—èŠ‚ç <br>                        æŠŠå‰é¢æ‰€ç”Ÿæˆçš„ä¿¡æ¯ï¼ˆè¯­æ³•ç¬¦åˆè¡¨ï¼‰è½¬æ¢ä¸ºå­—èŠ‚ç å†™åˆ°ç£ç›˜ä¸­<br>                        å°‘é‡ä»£ç æ·»åŠ å’Œè½¬æ¢å·¥ä½œ<br>                            å®ä¾‹æ„é€ å™¨å’Œç±»æ„é€ å™¨<br>                            å­—ç¬¦ä¸²çš„åŠ æ“ä½œæ›¿æ¢ä¸ºStringBufferæˆ–builderçš„appendæ“ä½œ<br>                    è¯­ä¹‰åˆ†æ</p><h3 id="Javaè¯­æ³•ç³–"><a href="#Javaè¯­æ³•ç³–" class="headerlink" title="Javaè¯­æ³•ç³–"></a>Javaè¯­æ³•ç³–</h3><p>â€‹            æ³›å‹ä¸ç±»å‹æ“¦é™¤<br>â€‹                C# ç±»å‹è†¨èƒ€ï¼ŒçœŸå®æ³›å‹<br>â€‹                Java ä¼ªæ³›å‹<br>â€‹            è‡ªåŠ¨æ‹†ç®±/è£…ç®±ã€å˜é•¿å‚æ•°ã€æ³›å‹<br>â€‹            æ¡ä»¶ç¼–è¯‘<br>â€‹                åªèƒ½å®ç°åœ¨è¯­å¥åŸºæœ¬å—çº§åˆ«çš„æ¡ä»¶ç¼–è¯‘ï¼Œå»é™¤åˆ†æ”¯ä¸æˆç«‹çš„ä»£ç å—</p><h3 id="å®æˆ˜ï¼šæ’å…¥å¼æ³¨è§£"><a href="#å®æˆ˜ï¼šæ’å…¥å¼æ³¨è§£" class="headerlink" title="å®æˆ˜ï¼šæ’å…¥å¼æ³¨è§£"></a>å®æˆ˜ï¼šæ’å…¥å¼æ³¨è§£</h3><hr><h2 id="è¿è¡ŒæœŸä¼˜åŒ–"><a href="#è¿è¡ŒæœŸä¼˜åŒ–" class="headerlink" title="è¿è¡ŒæœŸä¼˜åŒ–"></a>è¿è¡ŒæœŸä¼˜åŒ–</h2><h3 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h3><p>â€‹            ä¸ºä½•HotSpotè™šæ‹Ÿæœºè¦ä½¿ç”¨è§£é‡Šå™¨ä¸ç¼–è¯‘å™¨å¹¶å­˜çš„æ¶æ„ï¼Ÿ<br>â€‹            ä¸ºä½•HotSpotè™šæ‹Ÿæœºè¦å®ç°ä¸¤ä¸ªä¸åŒçš„å³æ—¶ç¼–è¯‘å™¨ï¼Ÿ<br>â€‹            ç¨‹åºåˆä½•æ—¶ä½¿ç”¨è§£é‡Šå™¨æ‰§è¡Œï¼Ÿä½•æ—¶ä½¿ç”¨ç¼–è¯‘å™¨æ‰§è¡Œï¼Ÿ<br>â€‹            å“ªäº›ç¨‹åºä»£ç ä¼šè¢«ç¼–è¯‘ä¸ºæœ¬åœ°ä»£ç ï¼Ÿå¦‚ä½•ç¼–è¯‘ä¸ºæœ¬åœ°ä»£ç ï¼Ÿ<br>â€‹            å¦‚ä½•ä»å¤–éƒ¨è§‚å¯Ÿå³æ—¶ç¼–è¯‘å™¨çš„ç¼–è¯‘è¿‡ç¨‹å’Œç¼–è¯‘ç»“æœï¼Ÿ<br>â€‹            </p><h3 id="HotSpotè™šæ‹Ÿæœºå†…çš„å³æ—¶ç¼–è¯‘å™¨"><a href="#HotSpotè™šæ‹Ÿæœºå†…çš„å³æ—¶ç¼–è¯‘å™¨" class="headerlink" title="HotSpotè™šæ‹Ÿæœºå†…çš„å³æ—¶ç¼–è¯‘å™¨"></a>HotSpotè™šæ‹Ÿæœºå†…çš„å³æ—¶ç¼–è¯‘å™¨</h3><p>â€‹    ç¼–è¯‘å™¨ä¸è§£é‡Šå™¨<br>â€‹        è§£é‡Šå™¨<br>â€‹            Interperter<br>â€‹        ç¼–è¯‘å™¨<br>â€‹            Client Compiler<br>â€‹            Server Compiler<br>â€‹    ç¼–è¯‘å¯¹è±¡ä¸è§¦å‘æ¡ä»¶ï¼ˆClientå³æ—¶ç¼–è¯‘æ–¹å¼ï¼‰<br>â€‹        çƒ­ç‚¹ä»£ç <br>â€‹            è¢«å¤šæ¬¡æ‰è°ƒç”¨çš„æ–¹æ³•<br>â€‹            è¢«å¤šæ¬¡æ‰§è¡Œçš„å¾ªç¯ä½“ï¼ˆOSRç¼–è¯‘ï¼Œæ ˆä¸Šæ›¿æ¢ï¼‰<br>â€‹        çƒ­ç‚¹æ¢æµ‹<br>â€‹            åŸºäºé‡‡æ ·çš„çƒ­ç‚¹æ¢æµ‹<br>â€‹            åŸºäºè®¡æ•°å™¨çš„çƒ­ç‚¹æ¢æµ‹ï¼ˆHotSpotï¼‰<br>â€‹                æ–¹æ³•è°ƒç”¨<br>â€‹                å›è¾¹è®¡æ•°å™¨<br>â€‹        çƒ­åº¦è¡°å‡<br>â€‹            å½“è¶…è¿‡ä¸€å®šçš„æ—¶é—´é™åº¦ï¼Œå¦‚æœæ–¹æ³•çš„è°ƒç”¨æ¬¡æ•°ä»ç„¶ä¸è¶³ä»¥è®©å®ƒæäº¤ç»™å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘ï¼Œé‚£è¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨è®¡æ•°å™¨å°±ä¼šè¢«å‡å°‘ä¸€åŠ<br>â€‹    ç¼–è¯‘è¿‡ç¨‹<br>â€‹        Client Compiler<br>â€‹            ç¬¬ä¸€é˜¶æ®µ<br>â€‹                å­—èŠ‚ç <br>â€‹                æ–¹æ³•å†…è”ã€å¸¸é‡ä¼ æ’­ã€å…¶ä»–ä¼˜åŒ–â€¦<br>â€‹                HIRï¼ˆSSAå½¢å¼ï¼‰<br>â€‹            ç¬¬äºŒé˜¶æ®µ<br>â€‹                ç©ºå€¼æ£€æŸ¥æ¶ˆé™¤ã€èŒƒå›´æ£€æŸ¥æ¶ˆé™¤ã€å…¶ä»–ä¼˜åŒ–â€¦<br>â€‹                ä¼˜åŒ–åçš„HIR<br>â€‹                HIRåˆ°LIRçš„è½¬æ¢<br>â€‹            ç¬¬ä¸‰é˜¶æ®µ<br>â€‹                ä½¿ç”¨çº¿æ€§æ‰«æç®—æ³•åœ¨LIRä¸Šåˆ†é…å¯„å­˜å™¨<br>â€‹                åœ¨LIRä¸Šåšçª¥å­”ä¼˜åŒ–<br>â€‹                ç”Ÿæˆæœºå™¨ç <br>â€‹        Server Compiler<br>â€‹            å®ƒè¿˜ä¼šæ‰§è¡Œæ‰€æœ‰ç»å…¸çš„ä¼˜åŒ–åŠ¨ä½œ<br>â€‹                æ— ç”¨ä»£ç æ¶ˆé™¤<br>â€‹                å¾ªç¯å±•å¼€<br>â€‹                å¾ªç¯è¡¨è¾¾å¼å¤–æ<br>â€‹                å¸¸é‡ä¼ æ’­<br>â€‹                æ¶ˆé™¤å…¬å…±å­è¡¨è¾¾å¼<br>â€‹                åŸºæœ¬å—é‡æ’åº<br>â€‹                â€¦<br>â€‹            è¿˜ä¼šå®æ–½ä¸€äº›ä¸Javaè¯­è¨€ç‰¹æ€§å¯†åˆ‡ç›¸å…³çš„ä¼˜åŒ–æŠ€æœ¯<br>â€‹                èŒƒå›´æ£€æŸ¥æ¶ˆé™¤<br>â€‹                ç©ºå€¼æ£€æŸ¥æ¶ˆé™¤<br>â€‹                â€¦<br>â€‹            æ ¹æ®Cllient Compileræä¾›çš„æ€§èƒ½ç›‘æ§ä¿¡æ¯ï¼Œè¿›è¡Œä¸€äº›ä¸ç¨³å®šçš„æ¿€è¿›ä¼˜åŒ–<br>â€‹                å®ˆæŠ¤å†…è”<br>â€‹                åˆ†æ”¯é¢‘ç‡é¢„æµ‹<br>â€‹                â€¦<br>â€‹    æŸ¥çœ‹åŠåˆ†æå³æ—¶ç¼–è¯‘ç»“æœ</p><h3 id="ç¼–è¯‘ä¼˜åŒ–æŠ€æœ¯"><a href="#ç¼–è¯‘ä¼˜åŒ–æŠ€æœ¯" class="headerlink" title="ç¼–è¯‘ä¼˜åŒ–æŠ€æœ¯"></a>ç¼–è¯‘ä¼˜åŒ–æŠ€æœ¯</h3><p>â€‹    ä¼˜åŒ–æŠ€æœ¯æ¦‚è§ˆ<br>â€‹        ç¼–è¯‘å™¨ç­–ç•¥<br>â€‹            å»¶è¿Ÿç¼–è¯‘<br>â€‹            åˆ†å±‚ç¼–è¯‘<br>â€‹            æ ˆä¸Šæ›¿æ¢<br>â€‹            å»¶è¿Ÿä¼˜åŒ–<br>â€‹            ç¨‹åºä¾èµ–å›¾è¡¨ç¤º<br>â€‹            é™æ€å•èµ‹å€¼è¡¨ç¤º<br>â€‹        åŸºäºæ€§èƒ½ç›‘æ§çš„ä¼˜åŒ–æŠ€æœ¯<br>â€‹            ä¹è§‚ç©ºå€¼æ–­è¨€<br>â€‹            ä¹è§‚ç±»å‹æ–­è¨€<br>â€‹            ä¹è§‚ç±»å‹å¢å¼º<br>â€‹            ä¹è§‚æ•°ç»„é•¿åº¦å¢å¼º<br>â€‹            è£å‰ªæœªè¢«é€‰æ‹©çš„åˆ†æ”¯<br>â€‹            ä¹è§‚çš„å¤šæ€å†…è”<br>â€‹            å¤šæ”¯é¢‘ç‡é¢„æµ‹<br>â€‹            è°ƒç”¨é¢‘ç‡é¢„æµ‹<br>â€‹        åŸºäºè¯æ®çš„ä¼˜åŒ–æŠ€æœ¯<br>â€‹            ç²¾ç¡®ç±»å‹åˆ¤æ–­<br>â€‹            å†…å­˜å€¼æ¨æ–­<br>â€‹            å†…å­˜å€¼è·Ÿè¸ª<br>â€‹            å¸¸é‡æŠ˜å <br>â€‹            é‡ç»„<br>â€‹            æ“ä½œç¬¦é€€åŒ–<br>â€‹            ç©ºå€¼æ£€æŸ¥æ¶ˆé™¤<br>â€‹            ç±»å‹æ£€æµ‹é€€åŒ–<br>â€‹            ç±»å‹æ£€æµ‹æ¶ˆé™¤<br>â€‹            ä»£æ•°åŒ–ç®€<br>â€‹            å…¬å…±å­è¡¨è¾¾å¼æ¶ˆé™¤<br>â€‹        æ•°æ®æµæ•æ„Ÿé‡å†™<br>â€‹            æ¡ä»¶å¸¸é‡ä¼ æ’­<br>â€‹            åŸºäºæµæ‰¿è½½çš„ç±»å‹ç¼©å‡è½¬æ¢<br>â€‹            æ— ç”¨ä»£ç æ¶ˆé™¤<br>â€‹        è¯­è¨€ç›¸å…³çš„ä¼˜åŒ–æŠ€æœ¯<br>â€‹            ç±»å‹ç»§æ‰¿å…³ç³»åˆ†æ<br>â€‹            å»è™šæ‹ŸåŒ–<br>â€‹            ç¬¦åˆå¸¸é‡ä¼ æ’­<br>â€‹            è‡ªåŠ¨è£…ç®±æ¶ˆé™¤<br>â€‹            é€ƒé€¸åˆ†æ<br>â€‹            é”æ¶ˆé™¤<br>â€‹            é”è†¨èƒ€<br>â€‹            æ¶ˆé™¤åå°„<br>â€‹        å†…å­˜åŠä»£ç ä½ç½®å˜æ¢<br>â€‹            è¡¨è¾¾å¼æå‡<br>â€‹            è¡¨è¾¾å¼ä¸‹æ²‰<br>â€‹            å†—ä½™å­˜å‚¨æ¶ˆé™¤<br>â€‹            ç›¸é‚»å­˜å‚¨åˆå¹¶<br>â€‹            äº¤æ±‡ç‚¹åˆ†ç¦»<br>â€‹        å¾ªç¯å˜æ¢<br>â€‹            å¾ªç¯å±•å¼€<br>â€‹            å¾ªç¯å‰¥ç¦»<br>â€‹            å®‰å…¨ç‚¹æ¶ˆé™¤<br>â€‹            è¿­ä»£èŒƒå›´åˆ†ç¦»<br>â€‹            èŒƒå›´æ£€æŸ¥æ¶ˆé™¤<br>â€‹            å¾ªç¯å‘é‡åŒ–<br>â€‹        å…¨å±€ä»£ç è°ƒæ•´<br>â€‹            å†…è”<br>â€‹            å…¨å±€ä»£ç å¤–æ<br>â€‹            åŸºäºçƒ­åº¦çš„ä»£ç å¸ƒå±€<br>â€‹            Switchè°ƒæ•´<br>â€‹        æ§åˆ¶æµå›¾å˜æ¢<br>â€‹            æœ¬åœ°ç¼–ç ç¼–æ’<br>â€‹            æœ¬åœ°ä»£ç å°åŒ…<br>â€‹            å»¶è¿Ÿæ§½å¡«å……<br>â€‹            ç€è‰²å›¾å¯„å­˜å™¨åˆ†é…<br>â€‹            çº¿æ€§æ‰«æå¯„å­˜å™¨åˆ†é…<br>â€‹            å¤å†™èšåˆ<br>â€‹            å¸¸é‡åˆ†è£‚<br>â€‹            å¤å†™ç§»é™¤<br>â€‹            åœ°å€æ¨¡å¼åŒ¹é…<br>â€‹            æŒ‡ä»¤çª¥å­”ä¼˜åŒ–<br>â€‹            åŸºäºç¡®å®šæœ‰é™çŠ¶æ€æœºçš„ä»£ç ç”Ÿæˆ</p><h3 id="ä¸C-ç¼–è¯‘å™¨å¯¹æ¯”"><a href="#ä¸C-ç¼–è¯‘å™¨å¯¹æ¯”" class="headerlink" title="ä¸C++ç¼–è¯‘å™¨å¯¹æ¯”"></a>ä¸C++ç¼–è¯‘å™¨å¯¹æ¯”</h3><p>â€‹    åŠ£åŠ¿<br>â€‹        1.å³æ—¶ç¼–è¯‘å™¨è¿è¡Œå ç”¨ç”¨æˆ·ç¨‹åºçš„è¿è¡Œæ—¶é—´ï¼Œå®ƒèƒ½æä¾›çš„ä¼˜åŒ–æ‰‹æ®µå—åˆ¶äºç¼–è¯‘æˆæœ¬<br>â€‹        2.Javaè¯­è¨€æ˜¯åŠ¨æ€çš„ç±»å‹å®‰å…¨è¯­è¨€ï¼Œéœ€è¦ç”±è™šæ‹Ÿæœºæ¥ç¡®ä¿ç¨‹åºä¸ä¼šè¿åè¯­è¨€è¯­ä¹‰æˆ–è®¿é—®éç»“æ„åŒ–å†…å­˜<br>â€‹        3.Javaè¯­è¨€æ²¡æœ‰virtualå…³é”®å­—ï¼Œè¿›è¡Œä¼˜åŒ–æ—¶çš„éš¾åº¦å¤§äºC/C++<br>â€‹        4.Javaè¯­è¨€æ˜¯åŠ¨æ€æ‰©å±•çš„è¯­è¨€ï¼Œè¿è¡Œæ—¶åŠ è½½æ–°çš„ç±»å¯èƒ½æ”¹å˜ç¨‹åºç±»å‹çš„ç»§æ‰¿å…³ç³»ï¼Œè¿™ä½¿å¾—å¯¹ä¸€äº›å…¨å±€ä¼˜åŒ–åªèƒ½ä½¿ç”¨æ¿€è¿›çš„æ‰‹æ®µ<br>â€‹        5.Javaå†…å­˜éƒ½æ˜¯åœ¨å †ä¸Šåˆ†é…çš„ï¼Œåªæœ‰æ–¹æ³•ä¸­çš„å±€éƒ¨å˜é‡æ‰èƒ½åœ¨æ ˆä¸Šåˆ†é…ï¼Œè€ŒC/C++çš„å¯¹è±¡ç”±å¤šç§å†…å­˜åˆ†é…æ–¹å¼<br>â€‹    </p><p>ä¼˜åŠ¿<br>        åŠ¨æ€å®‰å…¨ã€åŠ¨æ€æ‰©å±•ã€åƒåœ¾å›æ”¶</p><hr><h2 id="Javaå†…å­˜æ¨¡å‹ä¸çº¿ç¨‹"><a href="#Javaå†…å­˜æ¨¡å‹ä¸çº¿ç¨‹" class="headerlink" title="Javaå†…å­˜æ¨¡å‹ä¸çº¿ç¨‹"></a>Javaå†…å­˜æ¨¡å‹ä¸çº¿ç¨‹</h2><h3 id="Javaå†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰"><a href="#Javaå†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰" class="headerlink" title="Javaå†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰"></a>Javaå†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰</h3><h4 id="ä¸»å†…å­˜ä¸å·¥ä½œå†…å­˜"><a href="#ä¸»å†…å­˜ä¸å·¥ä½œå†…å­˜" class="headerlink" title="ä¸»å†…å­˜ä¸å·¥ä½œå†…å­˜"></a>ä¸»å†…å­˜ä¸å·¥ä½œå†…å­˜</h4><p>â€‹            ä¸»å†…å­˜<br>â€‹                æ‰€æœ‰å˜é‡éƒ½å­˜å‚¨åœ¨ä¸»å†…å­˜<br>â€‹            å·¥ä½œå†…å­˜<br>â€‹                æ¯æ¡çº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªå·¥ä½œå†…å­˜ï¼Œä¿å­˜äº†è¯¥çº¿ç¨‹ä½¿ç”¨åˆ°çš„å˜é‡çš„ä¸»å†…å­˜å‰¯æœ¬æ‹·è´</p><h4 id="å†…å­˜é—´äº¤äº’æ“ä½œ"><a href="#å†…å­˜é—´äº¤äº’æ“ä½œ" class="headerlink" title="å†…å­˜é—´äº¤äº’æ“ä½œ"></a>å†…å­˜é—´äº¤äº’æ“ä½œ</h4><p>â€‹            lock<br>â€‹                å®ƒæŠŠä¸€ä¸ªå˜é‡æ ‡è¯†ä¸ºä¸€æ¡çº¿ç¨‹ç‹¬å çš„çŠ¶æ€<br>â€‹            unlock<br>â€‹                å®ƒæŠŠä¸€ä¸ªå¤„äºé”å®šçŠ¶æ€çš„å˜é‡é‡Šæ”¾å‡ºæ¥<br>â€‹            read<br>â€‹                å®ƒæŠŠä¸€ä¸ªå˜é‡çš„å€¼ä»ä¸»å†…å­˜ä¼ è¾“åˆ°çº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­<br>â€‹            write<br>â€‹                å®ƒæŠŠstoreæ“ä½œä»å·¥ä½œå†…å­˜ä¸­å¾—åˆ°çš„å˜é‡çš„å€¼æ”¾å…¥ä¸»å†…å­˜å˜é‡<br>â€‹            load<br>â€‹                å®ƒæŠŠreadæ“ä½œä»å†…å­˜ä¸­å¾—åˆ°çš„å˜é‡å€¼æ”¾å…¥å·¥ä½œå†…å­˜çš„å˜é‡å‰¯æœ¬ä¸­<br>â€‹            use<br>â€‹                å®ƒæŠŠå·¥ä½œå†…å­˜ä¸­ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€’ç»™æ‰§è¡Œå¼•æ“ï¼Œæ¯å½“è™šæ‹Ÿæœºé‡åˆ°ä¸€ä¸ªéœ€è¦ä½¿ç”¨åˆ°å˜é‡çš„å€¼çš„å­—èŠ‚ç æŒ‡ä»¤æ—¶å°†ä¼šæ‰§è¡Œè¿™ä¸ªæ“ä½œ<br>â€‹            assign<br>â€‹                å®ƒæŠŠä¸€ä¸ªä»æ‰§è¡Œå¼•æ“æ¥æ”¶åˆ°çš„å€¼èµ‹ç»™å·¥ä½œå†…å­˜çš„å˜é‡ï¼Œæ¯å½“è™šæ‹Ÿæœºé‡åˆ°ä¸€ä¸ªç»™å˜é‡èµ‹å€¼çš„å­—èŠ‚ç æŒ‡ä»¤æ—¶æ‰§è¡Œè¿™ä¸ªæ“ä½œ<br>â€‹            store<br>â€‹                å®ƒæŠŠå·¥ä½œå†…å­˜ä¸­ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€åˆ°ä¸»å†…å­˜ä¸­ï¼Œä»¥ä¾¿writeä½¿ç”¨<br>â€‹            ä½œç”¨äºä¸»å†…å­˜<br>â€‹            ä½œç”¨äºå·¥ä½œå†…å­˜</p><h4 id="çº¦æŸ"><a href="#çº¦æŸ" class="headerlink" title="çº¦æŸ"></a>çº¦æŸ</h4><p>â€‹            ä¸å…è®¸readå’Œloadã€storeå’Œwriteæ“ä½œä¹‹ä¸€å•ç‹¬å‡ºç°<br>â€‹            ä¸å…è®¸ä¸€ä¸ªçº¿ç¨‹ä¸¢å¼ƒå®ƒçš„æœ€è¿‘assignæ“ä½œ<br>â€‹            ä¸å…è®¸ä¸€ä¸ªçº¿ç¨‹æ— åŸå› åœ°æŠŠæ•°æ®ä»çº¿ç¨‹çš„å·¥ä½œå†…å­˜åŒæ­¥å›ä¸»å†…å­˜<br>â€‹            ä¸€ä¸ªæ–°çš„å˜é‡åªèƒ½åœ¨ä¸»å†…å­˜ä¸­â€œè¯ç”Ÿï¼Œuseå’Œstoreæ“ä½œä¹‹å‰ï¼Œå¿…é¡»å…ˆassignå’Œload<br>â€‹            ä¸€ä¸ªå˜é‡åœ¨åŒä¸€æ—¶åˆ»åªå…è®¸ä¸€æ¡çº¿ç¨‹å¯¹å…¶è¿›è¡Œlockæ“ä½œï¼Œä½†æ˜¯åŒä¸€æ¡çº¿ç¨‹å¯ä»¥å¤šæ¬¡lock<br>â€‹            å¦‚æœä¸€ä¸ªå˜é‡æ‰§è¡Œlockæ“ä½œï¼Œé‚£ä¹ˆæ¸…ç©ºå·¥ä½œå†…å­˜ä¸­æ­¤å˜é‡çš„å€¼ï¼Œæ‰§è¡Œå¼•æ“ä½¿ç”¨è¿™ä¸ªå˜é‡å‰ï¼Œéœ€è¦é‡æ–°loadæˆ–assign<br>â€‹            ä¸€ä¸ªå˜é‡æ²¡æœ‰è¢«lock,å°±ä¸å…è®¸è¢«unlockï¼Œå¦å¤–ä¸å…è®¸unlockå…¶ä»–çº¿ç¨‹<br>â€‹            ä¸€ä¸ªå˜é‡æ‰§è¡Œunlockæ“ä½œä¹‹å‰ï¼Œå¿…é¡»å…ˆæŠŠæ­¤å˜é‡åŒæ­¥å›ä¸»å†…å­˜ä¸­ï¼ˆstoreã€writeï¼‰</p><h4 id="volatile"><a href="#volatile" class="headerlink" title="volatile"></a>volatile</h4><p>â€‹            ç‰¹å¾<br>â€‹                1.ä¿è¯æ­¤å˜é‡å¯¹æ‰€æœ‰çº¿ç¨‹çš„å¯è§æ€§<br>â€‹                2.ç¦æ­¢æŒ‡ä»¤é‡æ’<br>â€‹            ä»éœ€è¦åŠ é”çš„åœºæ™¯<br>â€‹                è¿ç®—ç»“æœå¹¶ä¸ä¾èµ–å˜é‡å½“å‰å€¼<br>â€‹                å˜é‡ä¸éœ€è¦ä¸å…¶ä»–çš„çŠ¶æ€å˜é‡å…±åŒå‚ä¸ä¸å˜çº¦æŸ</p><h4 id="ç‰¹å¾"><a href="#ç‰¹å¾" class="headerlink" title="ç‰¹å¾"></a>ç‰¹å¾</h4><p>â€‹            åŸå­æ€§<br>â€‹                synchronizedå—ä¿è¯åŸå­æ€§<br>â€‹            å¯è§æ€§<br>â€‹                volatileå¯è§æ€§ï¼Œsynchronizedå’Œfinal<br>â€‹            æœ‰åºæ€§<br>â€‹                volatileç¦æ­¢æŒ‡ä»¤é‡æ’ï¼Œsynchronizedä¿è¯åŒä¸€ä¸ªé”ä¸¤ä¸ªåŒæ­¥å—åªèƒ½ä¸²è¡Œ</p><h4 id="å…ˆè¡Œå‘ç”ŸåŸåˆ™-happen-before"><a href="#å…ˆè¡Œå‘ç”ŸåŸåˆ™-happen-before" class="headerlink" title="å…ˆè¡Œå‘ç”ŸåŸåˆ™ happen-before"></a>å…ˆè¡Œå‘ç”ŸåŸåˆ™ happen-before</h4><p>â€‹            ç¨‹åºæ¬¡åºè§„åˆ™<br>â€‹            ç®¡ç¨‹é”å®šè§„åˆ™<br>â€‹            volatile<br>â€‹            çº¿ç¨‹å¯åŠ¨è§„åˆ™<br>â€‹            çº¿ç¨‹ç»ˆæ­¢è§„åˆ™<br>â€‹            çº¿ç¨‹ä¸­æ–­è§„åˆ™<br>â€‹            å¯¹è±¡ç»ˆç»“è§„åˆ™<br>â€‹            ä¼ é€’æ€§</p><h3 id="Javaä¸çº¿ç¨‹"><a href="#Javaä¸çº¿ç¨‹" class="headerlink" title="Javaä¸çº¿ç¨‹"></a>Javaä¸çº¿ç¨‹</h3><h4 id="çº¿ç¨‹"><a href="#çº¿ç¨‹" class="headerlink" title="çº¿ç¨‹"></a>çº¿ç¨‹</h4><p>â€‹            1.ä½¿ç”¨å†…æ ¸çº¿ç¨‹å®ç°<br>â€‹            2.ä½¿ç”¨ç”¨æˆ·çº¿ç¨‹å®ç°<br>â€‹            3.ä½¿ç”¨ç”¨æˆ·çº¿ç¨‹åŠ è½»é‡çº§è¿›ç¨‹æ··åˆå®ç°<br>â€‹            4.javaçº¿ç¨‹çš„å®ç°</p><h4 id="Javaçº¿ç¨‹è°ƒåº¦"><a href="#Javaçº¿ç¨‹è°ƒåº¦" class="headerlink" title="Javaçº¿ç¨‹è°ƒåº¦"></a>Javaçº¿ç¨‹è°ƒåº¦</h4><p>â€‹            ååŒå¼çº¿ç¨‹è°ƒåº¦<br>â€‹            æŠ¢å å¼çº¿ç¨‹è°ƒåº¦<br>â€‹                çº¿ç¨‹ä¼˜å…ˆçº§ï¼ˆä¸ç¡®å®šæ€§ï¼‰</p><h4 id="çŠ¶æ€è½¬æ¢"><a href="#çŠ¶æ€è½¬æ¢" class="headerlink" title="çŠ¶æ€è½¬æ¢"></a>çŠ¶æ€è½¬æ¢</h4><p>â€‹            æ–°å»º(New)<br>â€‹            è¿è¡Œ(Runable)<br>â€‹                Running<br>â€‹                Ready<br>â€‹            æ— é™æœŸç­‰å¾… (Wating)<br>â€‹            é™æœŸç­‰å¾…(Timed Wating)<br>â€‹            é˜»å¡(Blocked)<br>â€‹            ç»“æŸ(Terminated)</p><hr><h2 id="çº¿ç¨‹å®‰å…¨ä¸é”ä¼˜åŒ–"><a href="#çº¿ç¨‹å®‰å…¨ä¸é”ä¼˜åŒ–" class="headerlink" title="çº¿ç¨‹å®‰å…¨ä¸é”ä¼˜åŒ–"></a>çº¿ç¨‹å®‰å…¨ä¸é”ä¼˜åŒ–</h2><h3 id="çº¿ç¨‹å®‰å…¨"><a href="#çº¿ç¨‹å®‰å…¨" class="headerlink" title="çº¿ç¨‹å®‰å…¨"></a>çº¿ç¨‹å®‰å…¨</h3><h4 id="å®‰å…¨ç¨‹åº¦"><a href="#å®‰å…¨ç¨‹åº¦" class="headerlink" title="å®‰å…¨ç¨‹åº¦"></a>å®‰å…¨ç¨‹åº¦</h4><p>â€‹            1.ä¸å¯å˜<br>â€‹                final<br>â€‹                String<br>â€‹                æšä¸¾ç±»å‹<br>â€‹                â€¦<br>â€‹            2.ç»å¯¹çº¿ç¨‹å®‰å…¨<br>â€‹                ä¸ç®¡è¿è¡Œæ—¶ç¯å¢ƒå¦‚ä½•ï¼Œè°ƒç”¨è€…éƒ½ä¸éœ€è¦ä»»ä½•é¢å¤–çš„åŒæ­¥æªæ–½<br>â€‹                å¦‚Vectorå°±ä¸æ˜¯ç»å¯¹çº¿ç¨‹å®‰å…¨<br>â€‹            3.ç›¸å¯¹çº¿ç¨‹å®‰å…¨<br>â€‹                æˆ‘ä»¬é€šå¸¸æ„ä¹‰ä¸Šæ‰€è®²çš„çº¿ç¨‹å®‰å…¨<br>â€‹            4.çº¿ç¨‹å…¼å®¹<br>â€‹                ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼ŒArrayListã€HashMap<br>â€‹            5.çº¿ç¨‹å¯¹ç«‹<br>â€‹                æ­»é”</p><h4 id="çº¿ç¨‹å®‰å…¨çš„å®ç°æ–¹æ³•"><a href="#çº¿ç¨‹å®‰å…¨çš„å®ç°æ–¹æ³•" class="headerlink" title="çº¿ç¨‹å®‰å…¨çš„å®ç°æ–¹æ³•"></a>çº¿ç¨‹å®‰å…¨çš„å®ç°æ–¹æ³•</h4><h5 id="1-äº’æ–¥åŒæ­¥ï¼ˆæ‚²è§‚ï¼‰"><a href="#1-äº’æ–¥åŒæ­¥ï¼ˆæ‚²è§‚ï¼‰" class="headerlink" title="1.äº’æ–¥åŒæ­¥ï¼ˆæ‚²è§‚ï¼‰"></a>1.äº’æ–¥åŒæ­¥ï¼ˆæ‚²è§‚ï¼‰</h5><p>â€‹                ä¿è¯å…±äº«æ•°æ®åœ¨åŒä¸€ä¸ªæ—¶åˆ»åªè¢«ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨<br>â€‹                æ‰‹æ®µ<br>â€‹                    ä¸´ç•ŒåŒº<br>â€‹                    äº’æ–¥é‡<br>â€‹                    ä¿¡å·é‡<br>â€‹                synchronized<br>â€‹                    é˜»å¡å”¤é†’ï¼Œéœ€è¦æ“ä½œç³»ç»Ÿæ¥å¸®å¿™ï¼Œæ‰€ä»¥éœ€è¦ä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°æ ¸å¿ƒæ€<br>â€‹                    è™šæ‹Ÿæœºä¼˜åŒ–è‡ªæ—‹é”ï¼Œè‡ªæ—‹ç­‰å¾…<br>â€‹                ReentrantLocké‡å…¥é”<br>â€‹                    ç­‰å¾…å¯ä¸­æ–­<br>â€‹                        å½“æŒæœ‰é”çš„çº¿ç¨‹é•¿æœŸä¸é‡Šæ”¾é”ï¼Œæ­£åœ¨ç­‰å¾…çš„çº¿ç¨‹å¯ä»¥é€‰æ‹©æ”¾å¼ƒç­‰å¾…ï¼Œæ”¹ä¸ºå¤„ç†å…¶ä»–äº‹æƒ…<br>â€‹                    å¯å®ç°å…¬å¹³é”<br>â€‹                        å¤šä¸ªçº¿ç¨‹åœ¨ç­‰å¾…åŒä¸€ä¸ªé”çš„æ—¶å€™ï¼ŒæŒ‰ç…§ç”³è¯·é”çš„æ—¶é—´é¡ºåºæ¥ä¾æ¬¡è·å¾—é”<br>â€‹                    é”å¯ä»¥ç»‘å®šå¤šä¸ªå¯¹è±¡<br>â€‹                        å¯ä»¥åŒæ—¶ç»‘å®šå¤šä¸ªConditionå¯¹è±¡</p><h5 id="2-éé˜»å¡åŒæ­¥ï¼ˆä¹è§‚ï¼‰"><a href="#2-éé˜»å¡åŒæ­¥ï¼ˆä¹è§‚ï¼‰" class="headerlink" title="2.éé˜»å¡åŒæ­¥ï¼ˆä¹è§‚ï¼‰"></a>2.éé˜»å¡åŒæ­¥ï¼ˆä¹è§‚ï¼‰</h5><p>â€‹                æŒ‡ä»¤<br>â€‹                    Test-and-Set<br>â€‹                    Fetch-and-Increment<br>â€‹                    Swap<br>â€‹                    Compare-and-Swapï¼ˆCASï¼‰<br>â€‹                        å†…å­˜ä½ç½®<br>â€‹                        æ—§çš„é¢„æœŸå€¼<br>â€‹                        æ–°å€¼<br>â€‹                    Load-Linked/Store-Conditionalï¼ˆLL/SCï¼‰<br>â€‹                    20ä¸–çºªå·²å­˜åœ¨å¤§å¤šæ•°</p><h5 id="3-æ— åŒæ­¥æ–¹æ¡ˆ"><a href="#3-æ— åŒæ­¥æ–¹æ¡ˆ" class="headerlink" title="3.æ— åŒæ­¥æ–¹æ¡ˆ"></a>3.æ— åŒæ­¥æ–¹æ¡ˆ</h5><p>â€‹                å¯é‡å…¥ä»£ç <br>â€‹                    åªè¦è¾“å…¥ç›¸åŒçš„æ•°æ®ï¼Œéƒ½èƒ½è¿”å›ç›¸åŒçš„ç»“æœ<br>â€‹                çº¿ç¨‹æœ¬åœ°å­˜å‚¨<br>â€‹                    å…±äº«æ•°æ®é™åˆ¶åœ¨ä¸€ä¸ªçº¿ç¨‹å†…</p><h3 id="é”ä¼˜åŒ–"><a href="#é”ä¼˜åŒ–" class="headerlink" title="é”ä¼˜åŒ–"></a>é”ä¼˜åŒ–</h3><p>â€‹        è‡ªæ—‹é”ä¸è‡ªé€‚åº”é”<br>â€‹        é”æ¶ˆé™¤<br>â€‹        é”ç²—åŒ–<br>â€‹        è½»é‡çº§é”<br>â€‹            CASæ“ä½œ<br>â€‹        åå‘é”<br>â€‹            å½“å¦å¤–ä¸€ä¸ªçº¿ç¨‹å»å°è¯•è·å–è¿™ä¸ªé”çš„æ—¶å€™ï¼Œåå‘æ¨¡å¼å°±å®£å‘Šç»“æŸ</p>]]></content>
      
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> note </tag>
            
            <tag> jvm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLæ·±å…¥æµ…å‡º</title>
      <link href="/2019/06/04/Overview_MySQL/"/>
      <url>/2019/06/04/Overview_MySQL/</url>
      
        <content type="html"><![CDATA[<p><img src="http://ww4.sinaimg.cn/large/006tNc79gy1g3ph297snqj30ia0sfjue.jpg" alt="image-20190604220256224"></p><a id="more"></a><h2 id="MySQLç‰ˆæœ¬ç‰¹å¾"><a href="#MySQLç‰ˆæœ¬ç‰¹å¾" class="headerlink" title="MySQLç‰ˆæœ¬ç‰¹å¾"></a>MySQLç‰ˆæœ¬ç‰¹å¾</h2><ul><li><p>2001 , 3.23  </p><ul><li>è¯ç”Ÿ, MyISAMä»£æ›¿ISAM ,å¼•å…¥å…¨æ–‡ç´¢å¼•å’Œå¤åˆ¶</li></ul></li><li><p>2003 , 4.0</p><ul><li>æ–°è¯­æ³•çš„æ”¯æŒ  UNIONã€å¤šè¡¨DELETEè¯­æ³•</li><li>å¤åˆ¶ä¼˜åŒ– , ä¸¤ä¸ªçº¿ç¨‹æ¥å®ç°å¤åˆ¶</li><li>InnoDBæˆä¸ºæ ‡å‡†é…å¤‡   è¡Œçº§é”ã€å¤–é”®</li><li>æŸ¥è¯¢ç¼“å­˜</li></ul></li><li><p>2005 , 4.1</p><ul><li>æ–°è¯­æ³•æ”¯æŒ  å­æŸ¥è¯¢ã€INSERT ON DUPLICATE KEY UPDATE</li><li>æ”¯æŒUTF-8å­—ç¬¦é›†</li><li>æ”¯æŒæ–°çš„äºŒçº§åè®®å’Œpreparedè¯­å¥</li></ul></li><li><p>2006 , 5.0</p><ul><li>ä¼ä¸šçº§ç‰¹å¾ è§†å›¾ã€è§¦å‘å™¨ã€å­˜å‚¨è¿‡ç¨‹ã€å‡½æ•°</li></ul></li><li><p>2008 , 5.1 </p><ul><li>åˆ†åŒº</li><li>åŸºäºè¡Œå¤åˆ¶</li><li>plugin API</li></ul></li><li><p>2010 , 5.5</p><ul><li>InnoDBæˆä¸ºé»˜è®¤å¼•æ“</li><li>åŠåŒæ­¥æ’ä»¶</li><li>çº¿ç¨‹æ± </li></ul></li><li><p>2013, 5.7</p><ul><li>JSONæ”¯æŒ</li></ul></li><li><p>2016, 8.0</p><p>  <a href="https://dev.mysql.com/doc/refman/8.0/en/mysql-nutshell.html" target="_blank" rel="noopener">https://dev.mysql.com/doc/refman/8.0/en/mysql-nutshell.html</a></p></li></ul><hr><h2 id="Schemaä¸æ•°æ®ç±»å‹ä¼˜åŒ–"><a href="#Schemaä¸æ•°æ®ç±»å‹ä¼˜åŒ–" class="headerlink" title="Schemaä¸æ•°æ®ç±»å‹ä¼˜åŒ–"></a>Schemaä¸æ•°æ®ç±»å‹ä¼˜åŒ–</h2><h3 id="åŸåˆ™"><a href="#åŸåˆ™" class="headerlink" title="åŸåˆ™"></a>åŸåˆ™</h3><ul><li><p>æœ€å°çš„é€šå¸¸æ›´å¥½ å ç”¨æ›´å°‘çš„ç£ç›˜ã€å†…å­˜å’ŒCPUç¼“å­˜</p></li><li><p>ç®€å•å°±å¥½ ç®€å•æ•°æ®ç±»å‹çš„æ“ä½œé€šå¸¸éœ€è¦æ›´å°‘çš„CPUå‘¨æœŸ</p></li><li><p>å°½é‡é¿å…NULL  </p><p>  NULL columns require additional space in the row to record whether their values are NULL.<br>  For MyISAM tables, each NULL column takes one bit extra, rounded up to the nearest byte</p></li></ul><h3 id="Schemaè®¾è®¡ä¸­çš„é™·é˜±"><a href="#Schemaè®¾è®¡ä¸­çš„é™·é˜±" class="headerlink" title="Schemaè®¾è®¡ä¸­çš„é™·é˜±"></a>Schemaè®¾è®¡ä¸­çš„é™·é˜±</h3><ul><li><p>å¤ªå¤šçš„åˆ—</p></li><li><p>ä»è¡Œç¼“å†²ä¸­å°†ç¼–ç è¿‡çš„åˆ—è½¬æ¢æˆè¡Œæ•°æ®ç»“æ„çš„æ“ä½œä»£ä»·éå¸¸çš„é«˜</p></li><li><p>å¤ªå¤šçš„å…³è”</p></li><li><p>é™åˆ¶ æœ€å¤šåªèƒ½61å¼ è¡¨,ç»éªŒæ³•åˆ™å•ä¸ªæŸ¥è¯¢æœ€å¥½åœ¨12ä¸ªè¡¨ä»¥å†…</p></li><li><p>è¿‡åº¦æšä¸¾</p></li><li><p>NULL</p></li></ul><h3 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h3><h4 id="æ•´æ•°ç±»å‹"><a href="#æ•´æ•°ç±»å‹" class="headerlink" title="æ•´æ•°ç±»å‹"></a>æ•´æ•°ç±»å‹</h4><ul><li><p>TINYINTï¼ˆ8ï¼‰</p></li><li><p>SMALLINTï¼ˆ16ï¼‰</p></li><li><p>MEDIUMINTï¼ˆ32ï¼‰</p></li><li><p>INTï¼ˆ64ï¼‰</p></li><li><p>BIGINTï¼ˆ128ï¼‰</p><p>  å±æ€§ UNSIGNEDã€å®½åº¦</p></li></ul><h4 id="å®æ•°ç±»å‹"><a href="#å®æ•°ç±»å‹" class="headerlink" title="å®æ•°ç±»å‹"></a>å®æ•°ç±»å‹</h4><ul><li>FLOAT</li><li>DOUBLE</li><li>DECIMAL</li></ul><h4 id="å­—ç¬¦ä¸²ç±»å‹"><a href="#å­—ç¬¦ä¸²ç±»å‹" class="headerlink" title="å­—ç¬¦ä¸²ç±»å‹"></a>å­—ç¬¦ä¸²ç±»å‹</h4><ul><li>VARCHAR<ul><li>éœ€è¦ä½¿ç”¨1æˆ–2ä¸ªé¢å¤–å­—èŠ‚è®°å½•å­—ç¬¦ä¸²çš„é•¿åº¦,ä¼šä¿ç•™æœ«å°¾ç©ºæ ¼</li><li>å­—ç¬¦ä¸²åˆ—çš„æœ€å¤§é•¿åº¦æ¯”å¹³å‡é•¿åº¦å¤§å¾ˆå¤š,åˆ—çš„æ›´æ–°å¾ˆå°‘ï¼Œç¢ç‰‡å°‘            </li></ul></li><li>CHAR<ul><li>é€‚åˆå­˜å‚¨å¾ˆçŸ­çš„å­—ç¬¦ä¸²ï¼Œæˆ–è€…æ‰€æœ‰å€¼éƒ½æ¥è¿‘åŒä¸€ä¸ªé•¿åº¦,ä¼šåˆ é™¤æœ«å°¾ç©ºæ ¼</li><li>ç»å¸¸å˜æ›´çš„æ•°æ®</li></ul></li></ul><h4 id="BLOBå’ŒTEXTç±»å‹"><a href="#BLOBå’ŒTEXTç±»å‹" class="headerlink" title="BLOBå’ŒTEXTç±»å‹"></a>BLOBå’ŒTEXTç±»å‹</h4><ul><li><p>BLOB äºŒè¿›åˆ¶</p></li><li><p>TEXT å­—ç¬¦æ–¹å¼å­˜å‚¨</p><p>  å½“å€¼å¤ªå¤§æ—¶å€™ï¼ŒInnoDBä¼šä½¿ç”¨ä¸“é—¨çš„â€œå¤–éƒ¨â€å­˜å‚¨åŒºåŸŸè¿›è¡Œå­˜å‚¨ï¼Œè¡Œå†…å­˜å‚¨æŒ‡é’ˆ</p></li></ul><h4 id="æšä¸¾ENUM"><a href="#æšä¸¾ENUM" class="headerlink" title="æšä¸¾ENUM"></a>æšä¸¾ENUM</h4><ul><li><p>ä¼˜åŠ¿</p><p>  å­˜å‚¨æšä¸¾éå¸¸ç´§å‡‘<br>  åœ¨åˆ—è¡¨ä¸­ä¿å­˜ä¸ºæ•´æ•°ï¼Œåœ¨è¡¨.frmæ–‡ä»¶ä¸­ä¿å­˜â€æ•°å­—-å­—ç¬¦ä¸²â€æ˜ å°„å…³ç³»è¡¨</p></li><li><p>åŠ£åŠ¿</p><p>  å­—ç¬¦ä¸²åˆ—è¡¨æ˜¯å›ºå®šçš„ï¼Œä¿®æ”¹å¿…é¡»ä½¿ç”¨ALTER TABLE</p></li></ul><h4 id="æ—¥æœŸå’Œæ—¶é—´"><a href="#æ—¥æœŸå’Œæ—¶é—´" class="headerlink" title="æ—¥æœŸå’Œæ—¶é—´"></a>æ—¥æœŸå’Œæ—¶é—´</h4><ul><li><p>DATETIME</p><p>  å­˜å‚¨èŒƒå›´ ä»1001å¹´åˆ°9999å¹´ã€ç²¾åº¦ä¸ºç§’ ,æ ¼å¼ YYYYMMDDHHMMSSã€ä½¿ç”¨8ä¸ªå­—èŠ‚ã€ä¸æ—¶åŒºæ— å…³</p></li><li><p>TIMESTAMP</p><p>  å­˜å‚¨èŒƒå›´ ä»1970åˆ°2038å¹´ã€ä¿å­˜äº†ä»1970å¹´ä»¥æ¥çš„ç§’æ•° å’ŒUNIXæ—¶é—´æˆ³ç›¸åŒã€åªä½¿ç”¨4ä¸ªå­—èŠ‚ã€å’Œæ—¶åŒºæœ‰å…³</p></li></ul><pre><code>å¦‚æœéœ€è¦ä¿å­˜æ›´å°ç²’åº¦çš„æ—¶é—´,å¯ä»¥ä½¿ç”¨BIGINTå­˜å‚¨</code></pre><h4 id="ä½æ•°æ®ç±»å‹"><a href="#ä½æ•°æ®ç±»å‹" class="headerlink" title="ä½æ•°æ®ç±»å‹"></a>ä½æ•°æ®ç±»å‹</h4><p>â€‹        BITã€SET( ä¸å¸¸ç”¨ )</p><h4 id="é€‰æ‹©æ ‡è¯†ç¬¦ï¼ˆä¸»é”®ï¼‰"><a href="#é€‰æ‹©æ ‡è¯†ç¬¦ï¼ˆä¸»é”®ï¼‰" class="headerlink" title="é€‰æ‹©æ ‡è¯†ç¬¦ï¼ˆä¸»é”®ï¼‰"></a>é€‰æ‹©æ ‡è¯†ç¬¦ï¼ˆä¸»é”®ï¼‰</h4><h5 id="æ•´æ•°ç±»å‹-1"><a href="#æ•´æ•°ç±»å‹-1" class="headerlink" title="æ•´æ•°ç±»å‹"></a>æ•´æ•°ç±»å‹</h5><p>â€‹        å¾ˆå¿«ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨AUTO_INCREMENT</p><h5 id="å­—ç¬¦ä¸²ç±»å‹-1"><a href="#å­—ç¬¦ä¸²ç±»å‹-1" class="headerlink" title="å­—ç¬¦ä¸²ç±»å‹"></a>å­—ç¬¦ä¸²ç±»å‹</h5><p>â€‹    æ¶ˆè€—ç©ºé—´ã€æ¯”è¾ƒè®¡ç®—é€Ÿåº¦æ…¢</p><h5 id="ç±»å‹"><a href="#ç±»å‹" class="headerlink" title="ç±»å‹"></a>ç±»å‹</h5><ul><li>MD5 SHA1 </li><li>UUID åˆ†å¸ƒä¸å‡ï¼Œä½†æœ‰ä¸€å®šé¡ºåº    </li></ul><h5 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h5><ul><li>INSERTå˜æ…¢<ul><li>ç£ç›˜éšæœºè®¿é—®</li><li>é¡µåˆ†è£‚</li><li>ç£ç›˜ç¢ç‰‡</li></ul></li><li>SELECTå˜æ…¢<ul><li>éšæœºI/O</li><li>å¯¼è‡´ç¼“å­˜æ•ˆæœå·®</li></ul></li></ul><h3 id="èŒƒå¼å’ŒåèŒƒå¼"><a href="#èŒƒå¼å’ŒåèŒƒå¼" class="headerlink" title="èŒƒå¼å’ŒåèŒƒå¼"></a>èŒƒå¼å’ŒåèŒƒå¼</h3><h4 id="èŒƒå¼"><a href="#èŒƒå¼" class="headerlink" title="èŒƒå¼"></a>èŒƒå¼</h4><p>â€‹        æ˜¯ä»€ä¹ˆ :æ¯ä¸ªæ•°æ®ä¼šå‡ºç°å¹¶ä¸”åªæœ‰ä¸€æ¬¡<br>â€‹        ä¼˜ç‚¹<br>â€‹            æ›´æ–°æ“ä½œæ¯”åèŒƒå¼å¿«<br>â€‹            ä¿®æ”¹æ›´å°‘æ•°æ®<br>â€‹            æ›´å°‘çš„DISTINCTæˆ–è€…GROUP BY<br>â€‹        ç¼ºç‚¹<br>â€‹            éœ€è¦è¡¨å…³è”<br>â€‹            åˆ†æ•£äº†ç´¢å¼•</p><h4 id="åèŒƒå¼"><a href="#åèŒƒå¼" class="headerlink" title="åèŒƒå¼"></a>åèŒƒå¼</h4><p>â€‹        æ˜¯ä»€ä¹ˆ<br>â€‹            ä¿¡æ¯æ˜¯å†—ä½™çš„ï¼Œå¯èƒ½ä¼šå­˜å‚¨åœ¨å¤šä¸ªåœ°æ–¹<br>â€‹        ä¼˜ç‚¹<br>â€‹            ä¸éœ€è¦è¡¨å…³è”ï¼Œæ•°æ®æ¯”å†…å­˜å¤§æ—¶ï¼Œæœ‰æ—¶å€™å…¨è¡¨æ‰«æä¼šæ›´å¿«ï¼Œé¿å…äº†éšæœºI/O<br>â€‹            æ›´æœ‰æ•ˆçš„ç´¢å¼•ç­–ç•¥<br>â€‹        ç¼ºç‚¹<br>â€‹            å¯¹åº”èŒƒå¼çš„ä¼˜ç‚¹</p><h4 id="æ··ç”¨"><a href="#æ··ç”¨" class="headerlink" title="æ··ç”¨"></a>æ··ç”¨</h4><p>â€‹        æœ€å¸¸è§çš„åèŒƒå¼åŒ–æ•°æ®çš„æ–¹æ³•<br>â€‹            å¤åˆ¶<br>â€‹            ç¼“å­˜<br>â€‹            é«˜æ•ˆè·å–ï¼Œæ’åºçš„éœ€è¦</p><p>â€‹    å…¶å®è¿™ç§ç±»å‹çš„å»ºè®®ä½¿ç”¨redis </p><h4 id="æ±‡æ€»è¡¨"><a href="#æ±‡æ€»è¡¨" class="headerlink" title="æ±‡æ€»è¡¨"></a>æ±‡æ€»è¡¨</h4><p>ä¿å­˜ä½¿ç”¨GROUP BYè¯­å¥èšåˆæ•°æ®çš„è¡¨ã€é€»è¾‘ä¸Šéå†—ä½™</p><h5 id="é€‚ç”¨åœºæ™¯"><a href="#é€‚ç”¨åœºæ™¯" class="headerlink" title="é€‚ç”¨åœºæ™¯"></a>é€‚ç”¨åœºæ™¯</h5><p>â€‹        å‡†å®æ—¶æ•°æ®<br>â€‹        å±€éƒ¨çƒ­ç‚¹<br>â€‹                æœ€æ´»è·ƒç”¨æˆ·<br>â€‹                æœ€å¸¸è§æ ‡ç­¾</p><h4 id="ç¼“å­˜è¡¨"><a href="#ç¼“å­˜è¡¨" class="headerlink" title="ç¼“å­˜è¡¨"></a>ç¼“å­˜è¡¨</h4><p>æ¥å­˜å‚¨å¯ä»¥æ¯”è¾ƒç®€å•ä»schemaè¡¨è·å–çš„ã€é€»è¾‘ä¸Šå†—ä½™</p><h5 id="é€‚ç”¨åœºæ™¯-1"><a href="#é€‚ç”¨åœºæ™¯-1" class="headerlink" title="é€‚ç”¨åœºæ™¯"></a>é€‚ç”¨åœºæ™¯</h5><p>â€‹            æŸ¥è¯¢è¯­å¥éœ€è¦ç‰¹æ®Šçš„è¡¨å’Œç´¢å¼•ç»“æ„<br>â€‹            é€‚ç”¨ä¸åŒçš„å­˜å‚¨å¼•æ“ï¼Œé€‚ç”¨MyISAMåšå…¨æ–‡æœç´¢</p><h3 id="åŠ å¿«ALTER-TABLEæ“ä½œçš„é€Ÿåº¦"><a href="#åŠ å¿«ALTER-TABLEæ“ä½œçš„é€Ÿåº¦" class="headerlink" title="åŠ å¿«ALTER TABLEæ“ä½œçš„é€Ÿåº¦"></a>åŠ å¿«ALTER TABLEæ“ä½œçš„é€Ÿåº¦</h3><h4 id="æ³¨æ„ä¿®æ”¹åˆ—çš„åŒºåˆ«"><a href="#æ³¨æ„ä¿®æ”¹åˆ—çš„åŒºåˆ«" class="headerlink" title="æ³¨æ„ä¿®æ”¹åˆ—çš„åŒºåˆ«"></a>æ³¨æ„ä¿®æ”¹åˆ—çš„åŒºåˆ«</h4><p>â€‹        å¦‚MODIFY COLUMN ,ä¼šå¼•èµ·è¡¨é‡å»º  ALTER COLUMN,ä¼šç›´æ¥ä¿®æ”¹.frmæ–‡ä»¶</p><h4 id="ä¸ä¼šé‡å»ºè¡¨çš„æƒ…å†µ"><a href="#ä¸ä¼šé‡å»ºè¡¨çš„æƒ…å†µ" class="headerlink" title="ä¸ä¼šé‡å»ºè¡¨çš„æƒ…å†µ"></a>ä¸ä¼šé‡å»ºè¡¨çš„æƒ…å†µ</h4><p>â€‹        ç§»é™¤ä¸€ä¸ªåˆ—çš„AUTO_INCREMENTå±æ€§<br>â€‹        å¢åŠ ã€ç§»é™¤ï¼Œæˆ–æ›´æ”¹ENUMå’ŒSETå¸¸é‡</p><p>â€‹    MYSQLä¼šåœ¨æ²¡å¿…è¦çš„æ—¶å€™ä¹Ÿé‡å»ºè¡¨ , ä¸ºæƒ³è¦çš„è¡¨ç»“æ„åˆ›å»ºä¸€ä¸ªæ–°çš„.frmæ–‡ä»¶ï¼Œç„¶åç”¨å®ƒæ›¿æ¢æ‰å·²ç»å­˜åœ¨çš„é‚£å¼ è¡¨çš„.frmæ–‡ä»¶</p><hr><h2 id="é«˜æ€§èƒ½ç´¢å¼•"><a href="#é«˜æ€§èƒ½ç´¢å¼•" class="headerlink" title="é«˜æ€§èƒ½ç´¢å¼•"></a>é«˜æ€§èƒ½ç´¢å¼•</h2><h3 id="ç´¢å¼•åŸºç¡€ã€ç±»å‹"><a href="#ç´¢å¼•åŸºç¡€ã€ç±»å‹" class="headerlink" title="ç´¢å¼•åŸºç¡€ã€ç±»å‹"></a>ç´¢å¼•åŸºç¡€ã€ç±»å‹</h3><h4 id="B-tree"><a href="#B-tree" class="headerlink" title="B-tree"></a>B-tree</h4><h5 id="ç±»å‹-1"><a href="#ç±»å‹-1" class="headerlink" title="ç±»å‹"></a>ç±»å‹</h5><h6 id="MyISAM"><a href="#MyISAM" class="headerlink" title="MyISAM"></a>MyISAM</h6><p>â€‹    é€šè¿‡ç‰©ç†ä½ç½®å¼•ç”¨è¢«ç´¢å¼•çš„è¡Œ</p><ul><li><p>ä¼˜ç‚¹</p><pre><code>      ä½¿ç”¨å‰ç¼€å‹ç¼©æŠ€æœ¯ï¼Œç´¢å¼•æ›´å°      å­˜å‚¨ç‰©ç†ä½ç½®ï¼ˆæŒ‡é’ˆï¼‰ï¼Œç©ºé—´å ç”¨æ›´å°‘</code></pre></li><li><p>ç¼ºç‚¹</p><pre><code>      ç‰©ç†ä½ç½®å˜åŒ–ï¼Œéœ€è¦ä¿®æ”¹äºŒçº§ç´¢å¼•æŒ‡é’ˆåœ°å€</code></pre></li></ul><h6 id="InnoDB"><a href="#InnoDB" class="headerlink" title="InnoDB"></a>InnoDB</h6><p>â€‹    æ ¹æ®ä¸»é”®å¼•ç”¨è¢«ç´¢å¼•çš„è¡Œ</p><ul><li><p>ä¼˜ç‚¹</p><pre><code>  æ•°æ®ä½ç½®å˜æ¢æ—¶ï¼Œä¸éœ€è¦ä¿®æ”¹äºŒçº§ç´¢å¼•  é¢å¤–æ‹¥æœ‰ä¸»é”®ï¼Œä¸éœ€è¦å›è¡¨</code></pre></li><li><p>ç¼ºç‚¹</p><pre><code>  å ç”¨å†…å­˜ç©ºé—´å¤š</code></pre></li></ul><h5 id="é€‚ç”¨ç±»å‹"><a href="#é€‚ç”¨ç±»å‹" class="headerlink" title="é€‚ç”¨ç±»å‹"></a>é€‚ç”¨ç±»å‹</h5><ul><li>å…¨å€¼åŒ¹é…</li><li>åŒ¹é…æœ€å·¦å‰ç¼€</li><li>åŒ¹é…åˆ—å‰ç¼€</li><li>åŒ¹é…èŒƒå›´å€¼</li><li>ç²¾ç¡®åŒ¹é…æŸä¸€åˆ—å¹¶èŒƒå›´åŒ¹é…å¦å¤–ä¸€åˆ—</li><li>åªè®¿é—®ç´¢å¼•çš„æŸ¥è¯¢</li></ul><h5 id="é™åˆ¶"><a href="#é™åˆ¶" class="headerlink" title="é™åˆ¶"></a>é™åˆ¶</h5><ul><li>ä¸æŒ‰ç…§æœ€å·¦åˆ—å¼€å§‹æŸ¥æ‰¾ï¼Œæ— æ³•é€‚ç”¨ç´¢å¼•</li><li>ä¸èƒ½è·³è¿‡ç´¢å¼•çš„åˆ—</li><li>å¦‚æœæŸ¥è¯¢æŸä¸ªåˆ—çš„èŒƒå›´æŸ¥è¯¢ï¼Œå…¶å³è¾¹çš„æ‰€æœ‰åˆ—éƒ½æ— æ³•ä½¿ç”¨ç´¢å¼•ä¼˜åŒ–</li></ul><h4 id="å“ˆå¸Œç´¢å¼•"><a href="#å“ˆå¸Œç´¢å¼•" class="headerlink" title="å“ˆå¸Œç´¢å¼•"></a>å“ˆå¸Œç´¢å¼•</h4><p>â€‹    <strong>åªæœ‰Memoryå¼•æ“æ˜¾ç¤ºæ”¯æŒ</strong>(å¦‚æœåœ¨InnoDBåˆ›å»ºæ—¶æŒ‡å®šç´¢å¼•ç±»å‹,ä¼šè‡ªåŠ¨è½¬æ¢ä¸ºb-tree)            </p><p>ä¼˜ç‚¹ å‘½ä¸­å¿«</p><h5 id="é™åˆ¶-1"><a href="#é™åˆ¶-1" class="headerlink" title="é™åˆ¶"></a>é™åˆ¶</h5><ul><li>ä¸èƒ½é€šè¿‡ç´¢å¼•æ¥é¿å…è¯»å–è¡Œ</li><li>ä¸æ˜¯é¡ºåºå­˜å‚¨ï¼Œæ— æ³•ç”¨äºæ’åº</li><li>ä¸æ”¯æŒéƒ¨åˆ†ç´¢å¼•åˆ—æŸ¥æ‰¾</li><li>åªèƒ½æ”¯æŒç­‰å€¼æ¯”è¾ƒæŸ¥è¯¢</li><li>å“ˆå¸Œå†²çª</li></ul><h5 id="InnoDB-â€œè‡ªé€‚åº”å“ˆå¸Œç´¢å¼•â€"><a href="#InnoDB-â€œè‡ªé€‚åº”å“ˆå¸Œç´¢å¼•â€" class="headerlink" title="InnoDB â€œè‡ªé€‚åº”å“ˆå¸Œç´¢å¼•â€"></a>InnoDB â€œè‡ªé€‚åº”å“ˆå¸Œç´¢å¼•â€</h5><p>â€‹    æŸäº›ç´¢å¼•å€¼è¢«ä½¿ç”¨éå¸¸é¢‘ç¹æ—¶ï¼Œä¼šåœ¨å†…å­˜ä¸­åŸºäºB-Treeç´¢å¼•ä¸Šå†åˆ›å»ºå“ˆå¸Œç´¢å¼•ï¼Œè¿™æ ·è®©B-Treeä¹Ÿå…·æœ‰å“ˆå¸Œç´¢å¼•çš„ä¸€äº›ä¼˜ç‚¹</p><h4 id="ç©ºé—´ç´¢å¼•R-Tree"><a href="#ç©ºé—´ç´¢å¼•R-Tree" class="headerlink" title="ç©ºé—´ç´¢å¼•R-Tree"></a>ç©ºé—´ç´¢å¼•R-Tree</h4><p>â€‹    GISæ”¯æŒå¹¶ä¸å®Œå–„</p><h4 id="å…¨æ–‡ç´¢å¼•"><a href="#å…¨æ–‡ç´¢å¼•" class="headerlink" title="å…¨æ–‡ç´¢å¼•"></a>å…¨æ–‡ç´¢å¼•</h4><p>é€‚ç”¨äºMATCH AGAINST ,å¯ä»¥ä½¿ç”¨ Elastic Search</p><h3 id="ç´¢å¼•çš„ä¼˜ç‚¹"><a href="#ç´¢å¼•çš„ä¼˜ç‚¹" class="headerlink" title="ç´¢å¼•çš„ä¼˜ç‚¹"></a>ç´¢å¼•çš„ä¼˜ç‚¹</h3><ul><li>å¤§å¤§å‡å°‘äº†æœåŠ¡å™¨éœ€è¦æ‰«æçš„æ•°æ®é‡</li><li>å¸®åŠ©æœåŠ¡å™¨é¿å…æ’åºå’Œä¸´æ—¶è¡¨</li><li>å°†éšæœºI/Oå˜ä¸ºé¡ºåºI/O</li></ul><h3 id="å¦‚ä½•è¯„ä»·ä¸€ä¸ªç´¢å¼•"><a href="#å¦‚ä½•è¯„ä»·ä¸€ä¸ªç´¢å¼•" class="headerlink" title="å¦‚ä½•è¯„ä»·ä¸€ä¸ªç´¢å¼•"></a>å¦‚ä½•è¯„ä»·ä¸€ä¸ªç´¢å¼•</h3><p>ä¸€æ˜Ÿ ç´¢å¼•å°†ç›¸å…³çš„è®°å½•æ”¾åˆ°ä¸€èµ·<br>äºŒæ˜Ÿ ç´¢å¼•ä¸­çš„æ•°æ®é¡ºåºå’ŒæŸ¥æ‰¾ä¸­çš„æ’åˆ—é¡ºåºä¸€è‡´<br>ä¸‰æ˜Ÿ ç´¢å¼•ä¸­çš„åˆ—åŒ…å«äº†æŸ¥è¯¢ä¸­éœ€è¦çš„å…¨éƒ¨åˆ—</p><h3 id="é«˜æ€§èƒ½çš„ç´¢å¼•ç­–ç•¥"><a href="#é«˜æ€§èƒ½çš„ç´¢å¼•ç­–ç•¥" class="headerlink" title="é«˜æ€§èƒ½çš„ç´¢å¼•ç­–ç•¥"></a>é«˜æ€§èƒ½çš„ç´¢å¼•ç­–ç•¥</h3><p>â€‹    ç´¢å¼•çš„ä½œç”¨ ,ä¸€èˆ¬ç”¨äºå¿«é€Ÿæ£€ç´¢æ•°æ®,é€šå¸¸è¿˜ç”¨äºæ’åº,é™åˆ¶é‡å¤æ•°æ®</p><h4 id="ç‹¬ç«‹çš„åˆ—"><a href="#ç‹¬ç«‹çš„åˆ—" class="headerlink" title="ç‹¬ç«‹çš„åˆ—"></a>ç‹¬ç«‹çš„åˆ—</h4><p>â€‹    æ˜¯æŒ‡æ‰€æœ‰åˆ—ä¸èƒ½æ˜¯è¡¨è¾¾å¼çš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿä¸èƒ½æ˜¯å‡½æ•°çš„å‚æ•°</p><h4 id="å‰ç¼€ç´¢å¼•å’Œç´¢å¼•é€‰æ‹©æ€§"><a href="#å‰ç¼€ç´¢å¼•å’Œç´¢å¼•é€‰æ‹©æ€§" class="headerlink" title="å‰ç¼€ç´¢å¼•å’Œç´¢å¼•é€‰æ‹©æ€§"></a>å‰ç¼€ç´¢å¼•å’Œç´¢å¼•é€‰æ‹©æ€§</h4><p>â€‹    ä¸é‡å¤çš„ç´¢å¼•å€¼å’Œæ•°æ®è¡¨çš„è®°å½•æ€»æ•°çš„æ¯”å€¼,<strong>å¦‚ä½•è®¡ç®—åˆé€‚çš„å‰ç¼€é•¿åº¦å°±æ˜¯å…³é”®</strong><br>ç±»å‹</p><ul><li>BLOB</li><li>TEXT</li><li>VARCHAR</li></ul><p>å‰ç¼€ç´¢å¼•çš„é—®é¢˜æ— æ³•ä½¿ç”¨GROUP BYã€ORDER BY</p><h4 id="è”åˆç´¢å¼•"><a href="#è”åˆç´¢å¼•" class="headerlink" title="è”åˆç´¢å¼•"></a>è”åˆç´¢å¼•</h4><p>ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥ä½¿ç”¨è¡¨ä¸Šçš„å¤šä¸ªå•åˆ—ç´¢å¼•æ¥å®šä½æŒ‡å®šçš„è¡Œ</p><h5 id="é€‰æ‹©åˆé€‚çš„ç´¢å¼•åˆ—é¡ºåº"><a href="#é€‰æ‹©åˆé€‚çš„ç´¢å¼•åˆ—é¡ºåº" class="headerlink" title="é€‰æ‹©åˆé€‚çš„ç´¢å¼•åˆ—é¡ºåº"></a>é€‰æ‹©åˆé€‚çš„ç´¢å¼•åˆ—é¡ºåº</h5><p>å°†é€‰æ‹©æ€§æœ€é«˜çš„åˆ—æ”¾å†æ‰€æœ‰çš„æœ€å‰åˆ—ï¼Œåœ¨ä¸è€ƒè™‘åˆ†ç»„å’Œæ’åºæ—¶</p><h4 id="èšç°‡ç´¢å¼•"><a href="#èšç°‡ç´¢å¼•" class="headerlink" title="èšç°‡ç´¢å¼•"></a>èšç°‡ç´¢å¼•</h4><p>â€‹    <strong>å¦‚æœæ²¡æœ‰å®šä¹‰ä¸»é”®ï¼Œä¼šé€‰æ‹©ä¸€ä¸ªå”¯ä¸€çš„éç©ºç´¢å¼•ä»£æ›¿ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™ä¼šéšå¼å®šä¹‰ä¸€ä¸ªä¸»é”®æ¥ä½œä¸ºèšç°‡ç´¢å¼•</strong></p><h5 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h5><ul><li>å¯ä»¥æŠŠç›¸å…³æ•°æ®ä¿å­˜åœ¨ä¸€èµ·ï¼Œåªéœ€ä»ç£ç›˜è¯»å–å¾ˆå°‘çš„æ•°æ®é¡µ</li><li>æ•°æ®è®¿é—®æ›´å¿«ï¼Œç´¢å¼•å’Œæ•°æ®ä¿å­˜åœ¨åŒä¸€ä¸ªB-Tree</li><li>ä½¿ç”¨è¦†ç›–ç´¢å¼•æ‰«æçš„æŸ¥è¯¢å¯ä»¥ç›´æ¥ä½¿ç”¨é¡µèŠ‚ç‚¹ä¸­çš„ä¸»é”®å€¼</li></ul><h5 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h5><ul><li>æœ€å¤§é™åº¦æé«˜I/Oå¯†é›†å‹åº”ç”¨æ€§èƒ½ï¼Œä½†æ˜¯å¦‚æœæ•°æ®å…¨éƒ¨åŠ è½½åœ¨å†…å­˜ä¸­ï¼Œé¡ºåºå°±æ²¡é‚£ä¹ˆé‡è¦äº†</li><li>æ’å…¥é€Ÿåº¦ä¾èµ–æ’å…¥é¡ºåºï¼ŒæŒ‰ç…§ä¸»é”®é¡ºåºæ’å…¥æœ€å¿«</li><li>æ›´æ–°ç´¢å¼•ä»£ä»·å¾ˆé«˜ï¼Œä¼šå°†æ›´æ–°çš„è¡Œç§»åŠ¨åˆ°æ–°ä½ç½®</li><li>é¡µåˆ†è£‚ï¼Œå¯¼è‡´å ç”¨æ›´å¤šç©ºé—´</li><li>å¯èƒ½å¯¼è‡´å…¨è¡¨æ‰«æå˜æ…¢ï¼Œè¡Œç¨€ç–ï¼Œæˆ–é¡µåˆ†è£‚å¯¼è‡´æ•°æ®å­˜å‚¨ä¸è¿ç»­</li><li>äºŒçº§ç´¢å¼•åŒ…å«ä¸»é”®ï¼Œå ç”¨ç©ºé—´å¯èƒ½ä¼šå¾ˆå¤§</li><li>äºŒçº§ç´¢å¼•éœ€è¦ä¸¤æ¬¡æŸ¥æ‰¾ï¼Œè‡ªé€‚åº”å“ˆå¸Œ</li></ul><h5 id="å¶å­èŠ‚ç‚¹"><a href="#å¶å­èŠ‚ç‚¹" class="headerlink" title="å¶å­èŠ‚ç‚¹"></a>å¶å­èŠ‚ç‚¹</h5><ul><li>ä¸»é”®å€¼</li><li>äº‹åŠ¡ID</li><li>ç”¨äºäº‹åŠ¡å’ŒMVCCçš„å›æ»šæŒ‡é’ˆ</li><li>éä¸»é”®åˆ—</li></ul><h5 id="UUIDæ’å…¥çš„é—®é¢˜"><a href="#UUIDæ’å…¥çš„é—®é¢˜" class="headerlink" title="UUIDæ’å…¥çš„é—®é¢˜"></a>UUIDæ’å…¥çš„é—®é¢˜</h5><p>â€‹    å†™å…¥çš„ç›®æ ‡é¡µå¯èƒ½å·²ç»è¢«åˆ·åˆ°ç£ç›˜ä¸Šå¹¶ä»ç¼“å­˜ä¸­ç§»é™¤ï¼Œæˆ–è€…è¿˜æ²¡æœ‰åŠ è½½åˆ°ç¼“å­˜ï¼Œæ’å…¥ä¹‹å‰ä¸å¾—ä¸å…ˆä»ç£ç›˜è¯»å–ç›®æ ‡é¡µåˆ°å†…å­˜</p><p>å†™å…¥ä¹±åºï¼Œé¢‘ç¹åˆ†è£‚é¡µï¼Œå¯¼è‡´å¤§é‡çš„ç§»åŠ¨æ“ä½œå’Œç©ºé—´å ç”¨</p><p>é¡µåˆ†è£‚ä¼šå¯¼è‡´é¡µå˜å¾—ç¨€ç–å¹¶è¢«ä¸è§„åˆ™å¡«å……ï¼Œä¼šæœ‰ç¢ç‰‡</p><p>å¿…è¦ä½¿ç”¨OPTIMIZE TABLE é‡å»ºè¡¨(åˆ é™¤å¹¶ä¸ä¼šå›æ”¶æ•°æ®å­˜å‚¨ç©ºé—´,ä»¥åŠç´¢å¼•ä½,ä¼šé”è¡¨)ï¼Œå’Œä¼˜åŒ–é¡µçš„å¡«å……</p><h5 id="é¡ºåºä¸»é”®ä»€ä¹ˆæ—¶å€™ä¼šé€ æˆæ›´åçš„ç»“æœ"><a href="#é¡ºåºä¸»é”®ä»€ä¹ˆæ—¶å€™ä¼šé€ æˆæ›´åçš„ç»“æœ" class="headerlink" title="é¡ºåºä¸»é”®ä»€ä¹ˆæ—¶å€™ä¼šé€ æˆæ›´åçš„ç»“æœ"></a>é¡ºåºä¸»é”®ä»€ä¹ˆæ—¶å€™ä¼šé€ æˆæ›´åçš„ç»“æœ</h5><p>å¹¶å‘æ’å…¥å¯¼è‡´é—´éš™é”ç«äº‰ã€AUTO_INCREMENTé”æœºåˆ¶</p><h4 id="è¦†ç›–ç´¢å¼•"><a href="#è¦†ç›–ç´¢å¼•" class="headerlink" title="è¦†ç›–ç´¢å¼•"></a>è¦†ç›–ç´¢å¼•</h4><p>â€‹    å¦‚æœç´¢å¼•ä¸èƒ½è¦†ç›–æŸ¥è¯¢çš„å…¨éƒ¨åˆ—ï¼Œé‚£å°±ä¸å¾—ä¸æ¯æ‰«æä¸€æ¡ç´¢å¼•è®°å½•å°±éƒ½å›è¡¨æŸ¥è¯¢ä¸€æ¬¡å¯¹åº”çš„è¡Œï¼Œé€šå¸¸æ¯”é¡ºåºåœ°å…¨è¡¨æ‰«ææ…¢</p><p>æ‰€ä»¥,ä½¿ç”¨è¦†ç›–ç´¢å¼•æœ‰ä»¥ä¸‹å¥½å¤„</p><ul><li><p>ç´¢å¼•æ¡ç›®å°äºæ•°æ®è¡Œå¤§å°ï¼Œå‡å°‘æ•°æ®é‡è®¿é—®</p></li><li><p>æ— éœ€å›è¡¨ï¼Œé¡ºåºI/O</p></li><li><p>å¯¹äºMyISAMå†…å­˜ä¸­åªç¼“å­˜ç´¢å¼•ï¼Œæ•°æ®ä¾èµ–æ“ä½œç³»ç»Ÿç¼“å­˜ï¼Œè®¿é—®æ•°æ®éœ€è¦ç³»ç»Ÿè°ƒç”¨</p></li></ul><p>â€‹    </p><p>ä¼˜åŒ–index condition pushdown(ICP) , å‘é€æŸ¥è¯¢æ•°æ®åˆ°å¼•æ“å±‚</p><h4 id="ä½¿ç”¨ç´¢å¼•æ‰«ææ¥åšæ’åº"><a href="#ä½¿ç”¨ç´¢å¼•æ‰«ææ¥åšæ’åº" class="headerlink" title="ä½¿ç”¨ç´¢å¼•æ‰«ææ¥åšæ’åº"></a>ä½¿ç”¨ç´¢å¼•æ‰«ææ¥åšæ’åº</h4><h5 id="å¯ä»¥ä½¿ç”¨ä½¿ç”¨ç´¢å¼•åšæ’åºçš„æŸ¥è¯¢"><a href="#å¯ä»¥ä½¿ç”¨ä½¿ç”¨ç´¢å¼•åšæ’åºçš„æŸ¥è¯¢" class="headerlink" title="å¯ä»¥ä½¿ç”¨ä½¿ç”¨ç´¢å¼•åšæ’åºçš„æŸ¥è¯¢"></a>å¯ä»¥ä½¿ç”¨ä½¿ç”¨ç´¢å¼•åšæ’åºçš„æŸ¥è¯¢</h5><p>â€‹    åªæœ‰å½“ç´¢å¼•çš„åˆ—é¡ºåºå’ŒORDER BYå­—å¥çš„é¡ºåºå®Œå…¨ä¸€è‡´ï¼Œå¹¶ä¸”æ‰€æœ‰åˆ—çš„æ’åºæ–¹å‘éƒ½ä¸€æ ·ï¼Œæ‰èƒ½ä½¿ç”¨ç´¢å¼•å¯¹ç»“æœåšæ’åº<br>â€‹    å¦‚æœå…³è”è¡¨ï¼Œåˆ™åªæœ‰å½“ORDER BYå­—å¥å¼•ç”¨çš„å­—æ®µå…¨éƒ¨ä¸ºç¬¬ä¸€ä¸ªè¡¨æ—¶ï¼Œæ‰èƒ½ä½¿ç”¨ç´¢å¼•åšæ’åº</p><h5 id="ä¸èƒ½ä½¿ç”¨ç´¢å¼•åšæ’åºçš„æŸ¥è¯¢"><a href="#ä¸èƒ½ä½¿ç”¨ç´¢å¼•åšæ’åºçš„æŸ¥è¯¢" class="headerlink" title="ä¸èƒ½ä½¿ç”¨ç´¢å¼•åšæ’åºçš„æŸ¥è¯¢"></a>ä¸èƒ½ä½¿ç”¨ç´¢å¼•åšæ’åºçš„æŸ¥è¯¢</h5><p>â€‹    ä½¿ç”¨ä¸åŒæ’åºæ–¹å‘<br>â€‹    OREDR BYå­å¥å¼•ç”¨äº†ä¸€ä¸ªä¸åœ¨ç´¢å¼•çš„åˆ—<br>â€‹    WHERE å’Œ OREDR BYä¸­çš„åˆ—æ— æ³•ç»„æˆç´¢å¼•çš„æœ€å·¦å‰ç¼€<br>â€‹    ç¬¬ä¸€ä¸ªåˆ—ä¸Šæ˜¯èŒƒå›´æ¡ä»¶ï¼Œæ— æ³•ä½¿ç”¨ç´¢å¼•å…¶ä»–åˆ—</p><h4 id="å‹ç¼©ç´¢å¼•"><a href="#å‹ç¼©ç´¢å¼•" class="headerlink" title="å‹ç¼©ç´¢å¼•"></a>å‹ç¼©ç´¢å¼•</h4><h5 id="MyISAMå‹ç¼©ç´¢å¼•-ç©ºé—´æ¢æ—¶é—´"><a href="#MyISAMå‹ç¼©ç´¢å¼•-ç©ºé—´æ¢æ—¶é—´" class="headerlink" title="MyISAMå‹ç¼©ç´¢å¼•(ç©ºé—´æ¢æ—¶é—´)"></a>MyISAMå‹ç¼©ç´¢å¼•(ç©ºé—´æ¢æ—¶é—´)</h5><p>â€‹    å‹ç¼©å—ä½¿ç”¨æ›´å°‘çš„ç©ºé—´ ååˆ†ä¹‹ä¸€ å­˜åœ¨çš„é—®é¢˜, æ“ä½œæ›´æ…¢ æ— æ³•ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾</p><h4 id="å…³äºå†—ä½™å’Œé‡å¤ç´¢å¼•"><a href="#å…³äºå†—ä½™å’Œé‡å¤ç´¢å¼•" class="headerlink" title="å…³äºå†—ä½™å’Œé‡å¤ç´¢å¼•"></a>å…³äºå†—ä½™å’Œé‡å¤ç´¢å¼•</h4><h5 id="é‡å¤ç´¢å¼•ï¼ˆå»é™¤ï¼‰"><a href="#é‡å¤ç´¢å¼•ï¼ˆå»é™¤ï¼‰" class="headerlink" title="é‡å¤ç´¢å¼•ï¼ˆå»é™¤ï¼‰"></a>é‡å¤ç´¢å¼•ï¼ˆå»é™¤ï¼‰</h5><h5 id="å†—ä½™ç´¢å¼•ï¼ˆé€‚å½“ï¼‰"><a href="#å†—ä½™ç´¢å¼•ï¼ˆé€‚å½“ï¼‰" class="headerlink" title="å†—ä½™ç´¢å¼•ï¼ˆé€‚å½“ï¼‰"></a>å†—ä½™ç´¢å¼•ï¼ˆé€‚å½“ï¼‰</h5><p>â€‹    åº”è¯¥å°½é‡æ‰©å±•å·²æœ‰çš„ç´¢å¼•è€Œä¸æ˜¯åˆ›å»ºæ–°ç´¢å¼•ï¼ˆå†—ä½™ï¼‰<br>â€‹    éœ€è¦ä½¿ç”¨æ–°ç´¢å¼•çš„åœºæ™¯<br>â€‹            é¿å…å·²æœ‰ç´¢å¼•å˜å¤§<br>â€‹            æ’åºã€åˆ†ç»„éœ€è¦</p><h4 id="æœªä½¿ç”¨ç´¢å¼•"><a href="#æœªä½¿ç”¨ç´¢å¼•" class="headerlink" title="æœªä½¿ç”¨ç´¢å¼•"></a>æœªä½¿ç”¨ç´¢å¼•</h4><p>â€‹        æœ‰å¯èƒ½æ˜¯å”¯ä¸€çº¦æŸï¼Œç”¨äºé¿å…é‡å¤æ•°æ®</p><h4 id="ç´¢å¼•å’Œé”çš„å…³ç³»"><a href="#ç´¢å¼•å’Œé”çš„å…³ç³»" class="headerlink" title="ç´¢å¼•å’Œé”çš„å…³ç³»"></a>ç´¢å¼•å’Œé”çš„å…³ç³»</h4><p>â€‹    ç´¢å¼•èƒ½å¤Ÿå‡å°‘é”çš„æ•°é‡,InnoDBåªæœ‰åœ¨è®¿é—®è¡Œçš„æ—¶å€™æ‰ä¼šå¯¹å…¶åŠ é”<br>â€‹    ç›¸å…³ç»†èŠ‚ï¼ˆInnoDBï¼‰ äºŒçº§ç´¢å¼•å…±äº«é”ã€ä¸»é”®ç´¢å¼•æ’ä»–é”</p><h3 id="ç»´æŠ¤ç´¢å¼•å’Œè¡¨"><a href="#ç»´æŠ¤ç´¢å¼•å’Œè¡¨" class="headerlink" title="ç»´æŠ¤ç´¢å¼•å’Œè¡¨"></a>ç»´æŠ¤ç´¢å¼•å’Œè¡¨</h3><h4 id="æ‰¾åˆ°æŸåçš„è¡¨"><a href="#æ‰¾åˆ°æŸåçš„è¡¨" class="headerlink" title="æ‰¾åˆ°æŸåçš„è¡¨"></a>æ‰¾åˆ°æŸåçš„è¡¨</h4><p>â€‹    CHECK TABLE</p><h4 id="æ›´æ–°ç´¢å¼•ç»Ÿè®¡ä¿¡æ¯"><a href="#æ›´æ–°ç´¢å¼•ç»Ÿè®¡ä¿¡æ¯" class="headerlink" title="æ›´æ–°ç´¢å¼•ç»Ÿè®¡ä¿¡æ¯"></a>æ›´æ–°ç´¢å¼•ç»Ÿè®¡ä¿¡æ¯</h4><p>innoDB 5.5 éšæœºç´¢å¼•è®¿é—®è¿›è¡Œè¯„ä¼°å¹¶å­˜å‚¨åœ¨å†…å­˜ä¸­<br>åŸºæ•°(Cardinality)<br>â€‹    SHOW INDEX FROM<br>â€‹    å­˜å‚¨å¼•æ“ä¼°ç®—ç´¢å¼•åˆ—æœ‰å¤šå°‘ä¸ªä¸åŒçš„å–å€¼</p><h4 id="å‡å°‘ç´¢å¼•å’Œæ•°æ®ç¢ç‰‡"><a href="#å‡å°‘ç´¢å¼•å’Œæ•°æ®ç¢ç‰‡" class="headerlink" title="å‡å°‘ç´¢å¼•å’Œæ•°æ®ç¢ç‰‡"></a>å‡å°‘ç´¢å¼•å’Œæ•°æ®ç¢ç‰‡</h4><h5 id="å¸¸è§çš„ç¢ç‰‡"><a href="#å¸¸è§çš„ç¢ç‰‡" class="headerlink" title="å¸¸è§çš„ç¢ç‰‡"></a>å¸¸è§çš„ç¢ç‰‡</h5><ul><li>ç¢ç‰‡, æ•°æ®è¡Œè¢«å­˜å‚¨åœ¨å¤šä¸ªåœ°æ–¹ï¼Œå¤šä¸ªç‰‡æ®µä¸­</li><li>è¡Œç¢ç‰‡, é€»è¾‘ä¸Šé¡ºåºçš„é¡µæˆ–è€…è¡Œï¼Œåœ¨ç£ç›˜ä¸Šä¸æ˜¯é¡ºåºå­˜å‚¨</li><li>å‰©ä½™ç©ºé—´ç¢ç‰‡,æ•°æ®é¡µå­˜åœ¨å¤§é‡å‰©ä½™ç©ºé—´(åˆ é™¤ä¼šå¯¼è‡´è¿™ç§é—®é¢˜)</li></ul><h5 id="è§£å†³æ–¹æ³•"><a href="#è§£å†³æ–¹æ³•" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h5><ul><li>OPTIMIZE TABLE(é”è¡¨)</li><li>å¯¼å‡ºå†å¯¼å…¥</li></ul><h5 id="å­˜å‚¨å¼•æ“å®ç°"><a href="#å­˜å‚¨å¼•æ“å®ç°" class="headerlink" title="å­˜å‚¨å¼•æ“å®ç°"></a>å­˜å‚¨å¼•æ“å®ç°</h5><ul><li>InnoDB é€šè¿‡åˆ é™¤ã€å†æ·»åŠ ç´¢å¼•åŠŸèƒ½</li><li>MyISAM é€šè¿‡æ’åºç®—æ³•é‡å»ºç´¢å¼•æ¶ˆé™¤ç¢ç‰‡</li></ul><h3 id="ç´¢å¼•æ€»ç»“"><a href="#ç´¢å¼•æ€»ç»“" class="headerlink" title="ç´¢å¼•æ€»ç»“"></a>ç´¢å¼•æ€»ç»“</h3><h4 id="åŸåˆ™-1"><a href="#åŸåˆ™-1" class="headerlink" title="åŸåˆ™"></a>åŸåˆ™</h4><ul><li>å•è¡Œè®¿é—®æ•ˆç‡ä½</li><li>é¡ºåºè®¿é—®èŒƒå›´æ•°æ®å¿«<br>  â€‹    é¡ºåºIOã€æ— éœ€æ’åºæ“ä½œ</li><li>è¦†ç›–ç´¢å¼•ï¼Œæ— éœ€å›è¡¨ï¼Œé¿å…å•è¡Œè®¿é—®</li></ul><h4 id="å¦‚ä½•åˆ¤æ–­ç´¢å¼•åˆç†"><a href="#å¦‚ä½•åˆ¤æ–­ç´¢å¼•åˆç†" class="headerlink" title="å¦‚ä½•åˆ¤æ–­ç´¢å¼•åˆç†"></a>å¦‚ä½•åˆ¤æ–­ç´¢å¼•åˆç†</h4><h5 id="æ£€æŸ¥è®¾è®¡æ˜¯å¦åˆç†"><a href="#æ£€æŸ¥è®¾è®¡æ˜¯å¦åˆç†" class="headerlink" title="æ£€æŸ¥è®¾è®¡æ˜¯å¦åˆç†"></a>æ£€æŸ¥è®¾è®¡æ˜¯å¦åˆç†</h5><ul><li>schema , æ•°æ®ç»“æ„æ˜¯å¦åˆç†</li><li>SQLè¯­å¥æ˜¯å¦å­˜åœ¨é—®é¢˜</li><li>ç´¢å¼•è®¾è®¡æ˜¯å¦åˆç†</li></ul><h5 id="åˆ¤æ–­æ‰§è¡Œæ˜¯å¦ç¬¦åˆé¢„æœŸ"><a href="#åˆ¤æ–­æ‰§è¡Œæ˜¯å¦ç¬¦åˆé¢„æœŸ" class="headerlink" title="åˆ¤æ–­æ‰§è¡Œæ˜¯å¦ç¬¦åˆé¢„æœŸ"></a>åˆ¤æ–­æ‰§è¡Œæ˜¯å¦ç¬¦åˆé¢„æœŸ</h5><ul><li>æ˜¯å¦æ‰«æäº†å¤ªå¤šçš„è¡Œ</li><li>æ˜¯å¦åšäº†å¾ˆå¤šé¢å¤–æ’åº</li><li>ä½¿ç”¨äº†ä¸´æ—¶è¡¨</li><li>éšæœºI/O</li><li>å¤ªå¤šå›è¡¨æŸ¥è¯¢</li></ul><hr><h2 id="æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–"><a href="#æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–"></a>æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–</h2><h3 id="ä¸ºä»€ä¹ˆæŸ¥è¯¢ä¼šæ…¢"><a href="#ä¸ºä»€ä¹ˆæŸ¥è¯¢ä¼šæ…¢" class="headerlink" title="ä¸ºä»€ä¹ˆæŸ¥è¯¢ä¼šæ…¢"></a>ä¸ºä»€ä¹ˆæŸ¥è¯¢ä¼šæ…¢</h3><h4 id="æ‰§è¡Œä»»åŠ¡"><a href="#æ‰§è¡Œä»»åŠ¡" class="headerlink" title="æ‰§è¡Œä»»åŠ¡"></a>æ‰§è¡Œä»»åŠ¡</h4><ul><li><p>æ¶ˆé™¤æ— ç”¨å­ä»»åŠ¡</p></li><li><p>å‡å°‘å­ä»»åŠ¡æŸ¥è¯¢æ¬¡æ•°</p></li><li><p>åŠ å¿«å­ä»»åŠ¡æŸ¥è¯¢é€Ÿåº¦</p></li></ul><h4 id="æ—¶é—´èŠ±è´¹"><a href="#æ—¶é—´èŠ±è´¹" class="headerlink" title="æ—¶é—´èŠ±è´¹"></a>æ—¶é—´èŠ±è´¹</h4><ul><li>ç½‘ç»œ</li><li>CPUè®¡ç®—</li><li>ç”Ÿæˆç»Ÿè®¡ä¿¡æ¯å’Œæ‰§è¡Œè®¡åˆ’</li><li>é”ç­‰å¾…</li></ul><h3 id="æ…¢æŸ¥è¯¢çš„åŸºç¡€ï¼šä¼˜åŒ–æ•°æ®è®¿é—®"><a href="#æ…¢æŸ¥è¯¢çš„åŸºç¡€ï¼šä¼˜åŒ–æ•°æ®è®¿é—®" class="headerlink" title="æ…¢æŸ¥è¯¢çš„åŸºç¡€ï¼šä¼˜åŒ–æ•°æ®è®¿é—®"></a>æ…¢æŸ¥è¯¢çš„åŸºç¡€ï¼šä¼˜åŒ–æ•°æ®è®¿é—®</h3><h4 id="æ˜¯å¦æ£€ç´¢å¤§é‡è¶…è¿‡éœ€è¦çš„æ•°æ®"><a href="#æ˜¯å¦æ£€ç´¢å¤§é‡è¶…è¿‡éœ€è¦çš„æ•°æ®" class="headerlink" title="æ˜¯å¦æ£€ç´¢å¤§é‡è¶…è¿‡éœ€è¦çš„æ•°æ®"></a>æ˜¯å¦æ£€ç´¢å¤§é‡è¶…è¿‡éœ€è¦çš„æ•°æ®</h4><ul><li>æŸ¥è¯¢ä¸éœ€è¦çš„è®°å½•</li><li>å¤šè¡¨å…³è”æ—¶è¿”å›å…¨éƒ¨çš„åˆ—</li><li>æ€»æ˜¯å–å‡ºå…¨éƒ¨åˆ—</li><li>æŸ¥è¯¢é‡å¤çš„æ•°æ®<br>  â€‹        </li></ul><h4 id="åˆ†æä¸ºä½•æ£€ç´¢å¤§é‡è¶…è¿‡éœ€è¦çš„è¡Œ"><a href="#åˆ†æä¸ºä½•æ£€ç´¢å¤§é‡è¶…è¿‡éœ€è¦çš„è¡Œ" class="headerlink" title="åˆ†æä¸ºä½•æ£€ç´¢å¤§é‡è¶…è¿‡éœ€è¦çš„è¡Œ"></a>åˆ†æä¸ºä½•æ£€ç´¢å¤§é‡è¶…è¿‡éœ€è¦çš„è¡Œ</h4><h5 id="ç›¸å…³æŒ‡æ ‡æŒ‡æ ‡"><a href="#ç›¸å…³æŒ‡æ ‡æŒ‡æ ‡" class="headerlink" title="ç›¸å…³æŒ‡æ ‡æŒ‡æ ‡"></a>ç›¸å…³æŒ‡æ ‡æŒ‡æ ‡</h5><h6 id="å“åº”æ—¶é—´"><a href="#å“åº”æ—¶é—´" class="headerlink" title="å“åº”æ—¶é—´"></a>å“åº”æ—¶é—´</h6><ul><li>æœåŠ¡æ—¶é—´</li><li>æ’é˜Ÿæ—¶é—´</li></ul><h6 id="æ‰«æè¡Œæ•°"><a href="#æ‰«æè¡Œæ•°" class="headerlink" title="æ‰«æè¡Œæ•°"></a>æ‰«æè¡Œæ•°</h6><ul><li>å…¨è¡¨æ‰«æ</li><li>ç´¢å¼•æ‰«æ</li><li>èŒƒå›´æ‰«æ</li><li>å”¯ä¸€ç´¢å¼•æ‰«æ</li><li>å¸¸æ•°å¼•ç”¨</li></ul><h6 id="è¿”å›è¡Œæ•°"><a href="#è¿”å›è¡Œæ•°" class="headerlink" title="è¿”å›è¡Œæ•°"></a>è¿”å›è¡Œæ•°</h6><p>æ‰«æçš„è¡Œæ•°å¯¹è¿”å›çš„è¡Œæ•°çš„æ¯”ç‡  é€šå¸¸1ï¼š1åˆ°1ï¼š10ä¹‹é—´<br>â€‹            </p><h5 id="WHEREæ¡ä»¶"><a href="#WHEREæ¡ä»¶" class="headerlink" title="WHEREæ¡ä»¶"></a>WHEREæ¡ä»¶</h5><ul><li>åœ¨ç´¢å¼•ä¸­ä½¿ç”¨WHEREæ¡ä»¶è¿‡æ»¤ä¸åŒ¹é…è®°å½•ï¼Œå­˜å‚¨å¼•æ“å±‚</li><li>ä½¿ç”¨ç´¢å¼•è¦†ç›–æŸ¥è¯¢ï¼Œç›´æ¥ä»ç´¢å¼•ä¸­è¿‡æ»¤ä¸éœ€è¦çš„è®°å½•å¹¶è¿”å›å‘½ä¸­ç»“æœï¼ŒæœåŠ¡å±‚ï¼Œæ— éœ€å›è¡¨</li><li>ä»æ•°æ®è¡¨ä¸­è¿”å›ï¼Œç„¶åè¿‡æ»¤ä¸æ»¡è¶³æ¡ä»¶çš„è®°å½•ï¼ŒæœåŠ¡å±‚</li></ul><h5 id="ä¼˜åŒ–"><a href="#ä¼˜åŒ–" class="headerlink" title="ä¼˜åŒ–"></a>ä¼˜åŒ–</h5><ul><li><p>ç´¢å¼•è¦†ç›–</p></li><li><p>æ”¹å˜åº“è¡¨ç»“æœ</p></li><li><p>ä½¿ç”¨æ±‡æ€»è¡¨</p></li><li><p>é‡å†™æŸ¥è¯¢</p></li></ul><h3 id="é‡æ„æŸ¥è¯¢æ–¹å¼"><a href="#é‡æ„æŸ¥è¯¢æ–¹å¼" class="headerlink" title="é‡æ„æŸ¥è¯¢æ–¹å¼"></a>é‡æ„æŸ¥è¯¢æ–¹å¼</h3><p>â€‹        ä¸€ä¸ªå¤æ‚æŸ¥è¯¢è¿˜æ˜¯å¤šä¸ªç®€å•æŸ¥è¯¢,å‡å°‘é”çš„å æœ‰æ—¶é—´</p><p>â€‹        </p><h4 id="åˆ†è§£å…³è”æŸ¥è¯¢"><a href="#åˆ†è§£å…³è”æŸ¥è¯¢" class="headerlink" title="åˆ†è§£å…³è”æŸ¥è¯¢"></a>åˆ†è§£å…³è”æŸ¥è¯¢</h4><p>â€‹                è®©ç¼“å­˜æ•ˆç‡æ›´é«˜<br>â€‹                æ‰§è¡Œå•ä¸ªæŸ¥è¯¢å¯ä»¥å‡å°‘é”çš„ç«äº‰<br>â€‹                åœ¨åº”ç”¨å±‚åšå…³è”ï¼Œå¯ä»¥æ›´å®¹æ˜“å¯¹æ•°æ®åº“è¿›è¡Œæ‹†åˆ†ï¼Œæ›´å®¹æ˜“åšåˆ°é«˜æ€§èƒ½å’Œå¯æ‰©å±•<br>â€‹                å¯ä»¥å‡å°‘å†—ä½™è®°å½•çš„æŸ¥è¯¢<br>â€‹                å“ˆå¸Œå…³è”ï¼Œè€Œä¸æ˜¯åµŒå¥—å¾ªç¯å…³è”</p><h3 id="æŸ¥è¯¢æ‰§è¡Œçš„åŸºç¡€"><a href="#æŸ¥è¯¢æ‰§è¡Œçš„åŸºç¡€" class="headerlink" title="æŸ¥è¯¢æ‰§è¡Œçš„åŸºç¡€"></a>æŸ¥è¯¢æ‰§è¡Œçš„åŸºç¡€</h3><h4 id="ä¸€æ¬¡SQLæŸ¥è¯¢åšäº†ä»€ä¹ˆ"><a href="#ä¸€æ¬¡SQLæŸ¥è¯¢åšäº†ä»€ä¹ˆ" class="headerlink" title="ä¸€æ¬¡SQLæŸ¥è¯¢åšäº†ä»€ä¹ˆ"></a>ä¸€æ¬¡SQLæŸ¥è¯¢åšäº†ä»€ä¹ˆ</h4><p>â€‹    ç®€å•æ¥è¯´å°±æ˜¯, å…ˆæŸ¥è¯¢ç¼“å­˜,åœ¨å†æ ¹æ®æŸ¥è¯¢ä¼˜åŒ–å™¨è§£ææˆæ‰§è¡Œè®¡åˆ’,äº¤ç»™æ‰§è¡Œå¼•æ“,æœ€åå°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ </p><p>æ›´å¤šå¯ä»¥å‚è€ƒ<a href="https://zyumin.github.io/2019/03/30/%E8%AE%B0%E4%B8%80%E6%AC%A1mysql%E6%9F%A5%E8%AF%A2in%E7%9A%84%E6%80%9D%E8%80%83/#more" target="_blank" rel="noopener">å¦ä¸€ç¯‡æ–‡ç« ä¸­è¯¦ç»†çš„ä»‹ç»</a></p><h4 id="MySQLå®¢æˆ·ç«¯-æœåŠ¡å™¨é€šä¿¡åè®®"><a href="#MySQLå®¢æˆ·ç«¯-æœåŠ¡å™¨é€šä¿¡åè®®" class="headerlink" title="MySQLå®¢æˆ·ç«¯/æœåŠ¡å™¨é€šä¿¡åè®®"></a>MySQLå®¢æˆ·ç«¯/æœåŠ¡å™¨é€šä¿¡åè®®</h4><h5 id="é€šä¿¡åè®®"><a href="#é€šä¿¡åè®®" class="headerlink" title="é€šä¿¡åè®®"></a>é€šä¿¡åè®®</h5><p>â€‹    åŠåŒå·¥,åªèƒ½ä¸€æ–¹å‘é€æ¶ˆæ¯,ç®€å•å¿«é€Ÿ,ä½†ç¼ºå°‘æµé‡æ§åˆ¶,å…¨éƒ¨æ¨é€å®Œæˆæ‰é‡Šæ”¾é“¾æ¥</p><h5 id="é€šä¿¡è¿‡ç¨‹"><a href="#é€šä¿¡è¿‡ç¨‹" class="headerlink" title="é€šä¿¡è¿‡ç¨‹"></a>é€šä¿¡è¿‡ç¨‹</h5><ol><li>å®¢æˆ·ç«¯ç”¨ä¸€ä¸ªå•ç‹¬çš„æ•°æ®åŒ…å°†æŸ¥è¯¢ä¼ ç»™æœåŠ¡å™¨ï¼Œmax_allowed_packet</li><li>æœåŠ¡å™¨è¿”å›å¤šä¸ªæ•°æ®åŒ…ï¼Œå¿…é¡»å®Œæ•´æ¥æ”¶</li><li>å¤šæ•°è¿æ¥MySQLçš„åº“å‡½æ•°éƒ½å¯ä»¥è·å¾—å…¨éƒ¨ç»“æœé›†å¹¶ç¼“å­˜åˆ°å†…å­˜é‡Œ</li></ol><h5 id="æŸ¥è¯¢çŠ¶æ€"><a href="#æŸ¥è¯¢çŠ¶æ€" class="headerlink" title="æŸ¥è¯¢çŠ¶æ€"></a>æŸ¥è¯¢çŠ¶æ€</h5><ul><li>Sleep</li><li>Query</li><li>Locked</li><li>Analyzing and statistics</li><li>Copying to tmp table[on disk]</li><li>Sorting result</li><li>Sending data</li></ul><h4 id="æŸ¥è¯¢ç¼“å­˜ï¼ˆQuery-Cacheï¼‰"><a href="#æŸ¥è¯¢ç¼“å­˜ï¼ˆQuery-Cacheï¼‰" class="headerlink" title="æŸ¥è¯¢ç¼“å­˜ï¼ˆQuery Cacheï¼‰"></a>æŸ¥è¯¢ç¼“å­˜ï¼ˆQuery Cacheï¼‰</h4><p>â€‹    è§£æä¸€ä¸ªæŸ¥è¯¢è¯­å¥ä¹‹å‰å¦‚æœæŸ¥è¯¢ç¼“å­˜æ˜¯æ‰“å¼€çš„ï¼Œé€šè¿‡ä¸€ä¸ªå¯¹å¤§å°å†™æ•æ„Ÿçš„å“ˆå¸ŒæŸ¥æ‰¾å®ç°çš„,ç¼“å­˜å‘½ä¸­ç‡</p><h4 id="æŸ¥è¯¢ä¼˜åŒ–å¤„ç†"><a href="#æŸ¥è¯¢ä¼˜åŒ–å¤„ç†" class="headerlink" title="æŸ¥è¯¢ä¼˜åŒ–å¤„ç†"></a>æŸ¥è¯¢ä¼˜åŒ–å¤„ç†</h4><p>â€‹    å°†ä¸€ä¸ªSQLè½¬æ¢æˆæ‰§è¡Œè®¡åˆ’ï¼Œå†æŒ‰ç…§æ‰§è¡Œè®¡åˆ’å’Œå­˜å‚¨å¼•æ“è¿›è¡Œäº¤äº’</p><h5 id="è¯­æ³•è§£æå™¨å’Œé¢„å¤„ç†"><a href="#è¯­æ³•è§£æå™¨å’Œé¢„å¤„ç†" class="headerlink" title="è¯­æ³•è§£æå™¨å’Œé¢„å¤„ç†"></a>è¯­æ³•è§£æå™¨å’Œé¢„å¤„ç†</h5><p>â€‹    é€šè¿‡å…³é”®å­—å°†SQLè¯­å¥è¿›è¡Œè§£æï¼Œå¹¶ç”Ÿæˆä¸€é¢—å¯¹åº”çš„â€˜è§£ææ ‘â€™</p><h6 id="è§£æå™¨"><a href="#è§£æå™¨" class="headerlink" title="è§£æå™¨"></a>è§£æå™¨</h6><p>â€‹    ä½¿ç”¨è¯­æ³•è§„åˆ™éªŒè¯å’Œè§£ææŸ¥è¯¢</p><h6 id="é¢„å¤„ç†å™¨"><a href="#é¢„å¤„ç†å™¨" class="headerlink" title="é¢„å¤„ç†å™¨"></a>é¢„å¤„ç†å™¨</h6><p>â€‹    æ ¹æ®ä¸€äº›MySQLè§„åˆ™è¿›ä¸€æ­¥è§£ææ ‘æ˜¯å¦åˆæ³•,éªŒè¯æƒé™(ä¾‹å¦‚æ£€æŸ¥æ•°æ®è¡¨å’Œåˆ—æ˜¯å¦å­˜åœ¨,è§£æåå­—å’Œåˆ«å)<br>â€‹                    </p><h5 id="æŸ¥è¯¢ä¼˜åŒ–å™¨"><a href="#æŸ¥è¯¢ä¼˜åŒ–å™¨" class="headerlink" title="æŸ¥è¯¢ä¼˜åŒ–å™¨"></a>æŸ¥è¯¢ä¼˜åŒ–å™¨</h5><h6 id="åŸºäºæˆæœ¬çš„ä¼˜åŒ–å™¨"><a href="#åŸºäºæˆæœ¬çš„ä¼˜åŒ–å™¨" class="headerlink" title="åŸºäºæˆæœ¬çš„ä¼˜åŒ–å™¨"></a>åŸºäºæˆæœ¬çš„ä¼˜åŒ–å™¨</h6><p>â€‹    å°è¯•é¢„æµ‹ä¸€ä¸ªæŸ¥è¯¢ä½¿ç”¨äº†æŸç§æ‰§è¡Œè®¡åˆ’æ—¶çš„æˆæœ¬ï¼Œå¹¶é€‰æ‹©å…¶ä¸­æˆæœ¬æœ€å°çš„ä¸€ä¸ª</p><h6 id="å¯¼è‡´é€‰æ‹©é”™è¯¯æ‰§è¡Œè®¡åˆ’çš„åŸå› "><a href="#å¯¼è‡´é€‰æ‹©é”™è¯¯æ‰§è¡Œè®¡åˆ’çš„åŸå› " class="headerlink" title="å¯¼è‡´é€‰æ‹©é”™è¯¯æ‰§è¡Œè®¡åˆ’çš„åŸå› "></a>å¯¼è‡´é€‰æ‹©é”™è¯¯æ‰§è¡Œè®¡åˆ’çš„åŸå› </h6><ul><li>ç»Ÿè®¡ä¿¡æ¯ä¸å‡†ç¡®</li><li>æ‰§è¡Œè®¡åˆ’æ±‡æ€»çš„æˆæœ¬ä¼°ç®—ä¸ç­‰åŒäºå®é™…æ‰§è¡Œçš„æˆæœ¬</li><li>æœ€ä¼˜æ˜¯åŸºäºæˆæœ¬ï¼Œè€Œæœ‰äº›æ—¶å€™å¹¶ä¸æ˜¯æœ€å¿«</li><li>ä¸è€ƒè™‘å…¶ä»–å¹¶å‘æ‰§è¡Œçš„æŸ¥è¯¢</li><li>å¹¶ä¸æ˜¯ä»»ä½•æ—¶å€™éƒ½åŸºäºæˆæœ¬çš„ä¼˜åŒ–ï¼Œæœ‰æ—¶ä¼šåŸºäºä¸€äº›å›ºå®šçš„è§„åˆ™</li><li>ä¸ä¼šè€ƒè™‘ä¸å—å…¶æ§åˆ¶çš„æ“ä½œæˆæœ¬</li></ul><h6 id="ä¼˜åŒ–ç­–ç•¥"><a href="#ä¼˜åŒ–ç­–ç•¥" class="headerlink" title="ä¼˜åŒ–ç­–ç•¥"></a>ä¼˜åŒ–ç­–ç•¥</h6><p>â€‹    é™æ€ä¼˜åŒ– ç¼–è¯‘æ—¶ä¼˜åŒ–ï¼Œç›´æ¥å¯¹è§£ææ ‘è¿›è¡Œåˆ†æï¼Œå¹¶å®Œæˆä¼˜åŒ–<br>â€‹    åŠ¨æ€ä¼˜åŒ– å’ŒæŸ¥è¯¢çš„ä¸Šä¸‹æ–‡æœ‰å…³ï¼Œæ¯æ¬¡æŸ¥è¯¢éƒ½é‡æ–°è¯„ä¼°</p><h6 id="èƒ½å¤Ÿå¤„ç†çš„ä¼˜åŒ–ç±»å‹"><a href="#èƒ½å¤Ÿå¤„ç†çš„ä¼˜åŒ–ç±»å‹" class="headerlink" title="èƒ½å¤Ÿå¤„ç†çš„ä¼˜åŒ–ç±»å‹"></a>èƒ½å¤Ÿå¤„ç†çš„ä¼˜åŒ–ç±»å‹</h6><ul><li>é‡æ–°å®šä¹‰å…³è”è¡¨çš„é¡ºåº</li><li>å°†å¤–è¿æ¥è½¬æ¢æˆå†…è¿æ¥</li><li>ä½¿ç”¨ç­‰ä»·å˜æ¢è§„åˆ™</li><li>ä¼˜åŒ–COUNT() MIN() MAX()</li><li>é¢„ä¼°å¹¶è½¬åŒ–ä¸ºå¸¸æ•°è¡¨è¾¾å¼</li><li>è¦†ç›–ç´¢å¼•æ‰«æ</li><li>å­æŸ¥è¯¢ä¼˜åŒ–</li><li>æå‰ç»ˆæ­¢æŸ¥è¯¢</li><li>ç­‰å€¼ä¼ æ’­</li><li>åˆ—è¡¨IN()çš„æ¯”è¾ƒ</li></ul><h6 id="æ•°æ®å’Œç´¢å¼•çš„ç»Ÿè®¡ä¿¡æ¯"><a href="#æ•°æ®å’Œç´¢å¼•çš„ç»Ÿè®¡ä¿¡æ¯" class="headerlink" title="æ•°æ®å’Œç´¢å¼•çš„ç»Ÿè®¡ä¿¡æ¯"></a>æ•°æ®å’Œç´¢å¼•çš„ç»Ÿè®¡ä¿¡æ¯</h6><p>â€‹    å­˜å‚¨å¼•æ“æä¾›ç»™ä¼˜åŒ–å™¨</p><ul><li>æ¯ä¸ªè¡¨æˆ–è€…ç´¢å¼•æœ‰å¤šå°‘ä¸ªé¡µé¢</li><li>æ¯ä¸ªè¡¨çš„æ¯ä¸ªç´¢å¼•çš„åŸºæ•°æ˜¯å¤šå°‘</li><li>æ•°æ®è¡Œå’Œç´¢å¼•é•¿åº¦</li><li>ç´¢å¼•çš„åˆ†å¸ƒä¿¡æ¯</li></ul><h6 id="MySQLå¦‚ä½•æ‰§è¡Œå…³è”æŸ¥è¯¢"><a href="#MySQLå¦‚ä½•æ‰§è¡Œå…³è”æŸ¥è¯¢" class="headerlink" title="MySQLå¦‚ä½•æ‰§è¡Œå…³è”æŸ¥è¯¢"></a>MySQLå¦‚ä½•æ‰§è¡Œå…³è”æŸ¥è¯¢</h6><p>â€‹    ç­–ç•¥  å¯¹ä»»ä½•å…³è”éƒ½æ‰§è¡ŒåµŒå¥—å¾ªç¯å…³è”æ“ä½œ<br>â€‹    æ³³é“å›¾</p><h6 id="æ‰§è¡Œè®¡åˆ’"><a href="#æ‰§è¡Œè®¡åˆ’" class="headerlink" title="æ‰§è¡Œè®¡åˆ’"></a>æ‰§è¡Œè®¡åˆ’</h6><p>â€‹    å·¦ä¾§æ·±åº¦ä¼˜å…ˆçš„æŒ‡ä»¤æ ‘</p><h6 id="å…³è”æŸ¥è¯¢ä¼˜åŒ–å™¨"><a href="#å…³è”æŸ¥è¯¢ä¼˜åŒ–å™¨" class="headerlink" title="å…³è”æŸ¥è¯¢ä¼˜åŒ–å™¨"></a>å…³è”æŸ¥è¯¢ä¼˜åŒ–å™¨</h6><p>â€‹        é€šè¿‡è¯„ä¼°ä¸åŒé¡ºåºæ—¶çš„æˆæœ¬æ¥é€‰æ‹©ä¸€ä¸ªä»£ä»·æœ€å°çš„å…³è”é¡ºåº<br>â€‹        å½“å…³è”è¡¨è¶…è¿‡optimizer_search_depthçš„é™åˆ¶é€‰æ‹©â€˜è´ªå©ªâ€™æœç´¢æ¨¡å¼</p><h6 id="æ’åºä¼˜åŒ–"><a href="#æ’åºä¼˜åŒ–" class="headerlink" title="æ’åºä¼˜åŒ–"></a>æ’åºä¼˜åŒ–</h6><p>æ’åºç®—æ³•</p><ul><li><p>ä¸¤æ¬¡ä¼ è¾“æ’åº</p><ul><li>è¯»å–è¡ŒæŒ‡é’ˆå’Œéœ€è¦æ’åºçš„å­—æ®µï¼Œå¯¹å…¶è¿›è¡Œæ’åº</li><li>å†æ ¹æ®æ’åºç»“æœè¯»å–æ‰€è¦çš„æ•°æ®è¡Œ</li></ul></li><li><p>å•æ¬¡ä¼ è¾“æ’åº</p><p>  è¯»å–æ‰€éœ€è¦çš„æ‰€æœ‰åˆ—ï¼Œæ’åºï¼Œç›´æ¥è¿”å›æ’åºç»“æœ</p></li></ul><p>å¯¹äºå…³è”æ’åº<br>å¦‚æœå…³è”æ“ä½œä¸­ORDER BYå­å¥ä¸­æ‰€æœ‰åˆ—éƒ½æ¥è‡ªå…³è”çš„ç¬¬ä¸€ä¸ªè¡¨ï¼Œåˆ™å¤„ç†å…³è”ç¬¬ä¸€ä¸ªè¡¨çš„æ—¶å€™å°±è¿›è¡Œæ–‡ä»¶æ’åº</p><p>å¦åˆ™ï¼Œéƒ½ä¼šå°†å…³è”ç»“æœå­˜æ”¾åˆ°ä¸€ä¸ªä¸´æ—¶è¡¨ï¼Œç„¶åæ‰€æœ‰å…³è”ç»“æŸåï¼Œå†è¿›è¡Œæ–‡ä»¶æ’åº<br>â€‹</p><h4 id="æŸ¥è¯¢æ‰§è¡Œå¼•æ“"><a href="#æŸ¥è¯¢æ‰§è¡Œå¼•æ“" class="headerlink" title="æŸ¥è¯¢æ‰§è¡Œå¼•æ“"></a>æŸ¥è¯¢æ‰§è¡Œå¼•æ“</h4><p>â€‹    æ ¹æ®æ‰§è¡Œè®¡åˆ’ç»™å‡ºçš„æŒ‡ä»¤æ‰§è¡Œï¼Œè°ƒç”¨å­˜å‚¨å¼•æ“å®ç°çš„æ¥å£æ¥å®Œæˆï¼ŒæŸ¥è¯¢ä¸­çš„æ¯ä¸€ä¸ªè¡¨ç”±ä¸€ä¸ªhandlerçš„å®ä¾‹è¡¨ç¤º<br>å¦‚æœæ˜¯æ‰€æœ‰å­˜å‚¨å¼•æ“å…±æœ‰çš„ç‰¹æ€§åˆ™ç”±æœåŠ¡å™¨å±‚å®ç°</p><h4 id="è¿”å›ç»“æœç»™å®¢æˆ·ç«¯"><a href="#è¿”å›ç»“æœç»™å®¢æˆ·ç«¯" class="headerlink" title="è¿”å›ç»“æœç»™å®¢æˆ·ç«¯"></a>è¿”å›ç»“æœç»™å®¢æˆ·ç«¯</h4><p>ä¸éœ€è¦ç»“æœé›†ï¼Œåˆ™è¿”å›å½±å“åˆ°çš„è¡Œæ•°, å¦‚æœæŸ¥è¯¢ç¼“å­˜å¼€å¯ï¼Œå°†ç»“æœå­˜æ”¾åˆ°æŸ¥è¯¢ç¼“å­˜ä¸­</p><p>æ˜¯ä¸€ä¸ªå¢é‡ã€é€æ­¥çš„è¿‡ç¨‹,æœåŠ¡å™¨ç«¯æ— éœ€å­˜å‚¨å¤ªå¤šçš„ç»“æœ,å®¢æˆ·ç«¯ç¬¬ä¸€æ—¶é—´è·å¾—è¿”å›ç»“æœ</p><ol><li>æ¯ä¸€è¡Œéƒ½ä»¥ä¸€ä¸ªæ»¡è¶³MySQLå®¢æˆ·ç«¯/æœåŠ¡å™¨ç«¯é€šä¿¡åè®®çš„å°åŒ…å‘é€</li><li>åœ¨é€šè¿‡TCPåè®®è¿›è¡Œä¼ è¾“</li><li>å¯èƒ½ä¼šç¼“å­˜å°åŒ…ï¼Œå¹¶æ‰¹é‡ä¼ è¾“</li></ol><h3 id="æŸ¥è¯¢ä¼˜åŒ–å™¨çš„å±€é™"><a href="#æŸ¥è¯¢ä¼˜åŒ–å™¨çš„å±€é™" class="headerlink" title="æŸ¥è¯¢ä¼˜åŒ–å™¨çš„å±€é™"></a>æŸ¥è¯¢ä¼˜åŒ–å™¨çš„å±€é™</h3><ul><li>å…³è”å­æŸ¥è¯¢</li><li>UNIONçš„é™åˆ¶</li><li>ç´¢å¼•åˆå¹¶ä¼˜åŒ–</li><li>ç­‰å€¼ä¼ é€’</li><li>å¹¶è¡Œæ‰§è¡Œ</li><li>å“ˆå¸Œå…³è”</li><li>æ¾æ•£ç´¢å¼•æ‰«æ</li><li>æœ€å¤§å€¼å’Œæœ€å°å€¼çš„ä¼˜åŒ–</li><li>åœ¨åŒä¸€ä¸ªè¡¨ä¸ŠæŸ¥è¯¢å’Œæ›´æ–°</li></ul><p>hint, ä¸å»ºè®®ä½¿ç”¨ï¼ŒMySQLç‰ˆæœ¬å‡çº§ä¼šè®©æ–°ç‰ˆçš„ä¼˜åŒ–ç­–ç•¥å¤±æ•ˆ</p><h3 id="ä¼˜åŒ–ç‰¹å®šç±»å‹çš„æŸ¥è¯¢"><a href="#ä¼˜åŒ–ç‰¹å®šç±»å‹çš„æŸ¥è¯¢" class="headerlink" title="ä¼˜åŒ–ç‰¹å®šç±»å‹çš„æŸ¥è¯¢"></a>ä¼˜åŒ–ç‰¹å®šç±»å‹çš„æŸ¥è¯¢</h3><h4 id="ä¼˜åŒ–COUNTæŸ¥è¯¢"><a href="#ä¼˜åŒ–COUNTæŸ¥è¯¢" class="headerlink" title="ä¼˜åŒ–COUNTæŸ¥è¯¢"></a>ä¼˜åŒ–COUNTæŸ¥è¯¢</h4><ul><li>ä½¿ç”¨ç›¸ä¼¼å€¼ EXPLAINå‡ºæ¥çš„ä¼˜åŒ–å™¨ä¼°ç®—çš„è¡Œæ•°</li><li>è¦†ç›–ç´¢å¼•</li><li>å¢åŠ æ±‡æ€»è¡¨</li><li>ç¼“å­˜</li></ul><h4 id="ä¼˜åŒ–å…³è”æŸ¥è¯¢"><a href="#ä¼˜åŒ–å…³è”æŸ¥è¯¢" class="headerlink" title="ä¼˜åŒ–å…³è”æŸ¥è¯¢"></a>ä¼˜åŒ–å…³è”æŸ¥è¯¢</h4><p>â€‹    åªéœ€è¦åœ¨å…³è”é¡ºåºä¸­çš„ç¬¬äºŒä¸ªè¡¨çš„ç›¸åº”åˆ—ä¸Šåˆ›å»ºç´¢å¼•,ç¡®ä¿ä»»ä½•çš„GROUP BY å’Œ ORDER BYä¸­çš„è¡¨è¾¾å¼åªæ¶‰åŠåˆ°ä¸€ä¸ªè¡¨ä¸­çš„åˆ—<br>ä¼˜åŒ–å­æŸ¥è¯¢<br>ä¼˜åŒ–GROUP BY å’Œ DISTINCT<br>â€‹ä¼˜åŒ–GROUP BY WITH ROLLUP (è½¬ç§»åˆ°åº”ç”¨ç¨‹åºä¸­å¤„ç†)</p><p>#### </p><p>å‚è€ƒ:</p><blockquote><p>é«˜æ€§èƒ½MySQL</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Zookeeperæ·±å…¥æµ…å‡º</title>
      <link href="/2019/06/03/Overview_Zookeeper/"/>
      <url>/2019/06/03/Overview_Zookeeper/</url>
      
        <content type="html"><![CDATA[<p><img src="http://ww1.sinaimg.cn/large/006tNc79gy1g3oad10mpuj31hc0u0gp4.jpg" alt="image-20190603212535941"></p><a id="more"></a><h2 id="ç‰ˆæœ¬ç‰¹å¾"><a href="#ç‰ˆæœ¬ç‰¹å¾" class="headerlink" title="ç‰ˆæœ¬ç‰¹å¾"></a>ç‰ˆæœ¬ç‰¹å¾</h2><ul><li><p>25 March, 2010: release 3.3.0 available  æ·»åŠ Observerã€å››å­—å‘½ä»¤åŠŸèƒ½ã€JMXç®¡ç†</p></li><li><p>22 Nov, 2011: release 3.4.0 availableã€‚3.4 å¼•å…¥Netty åšä¸ºNIOæ¡†æ¶å¤„ç†å®¢æˆ·ç«¯è¿æ¥ , åºŸå¼ƒä¸¤ç§é€‰ä¸¾ç®—æ³•</p></li><li><p>6 August, 2014: release 3.5.0-alpha available ã€‚ ZooKeeper Dynamic Reconfiguration ,3.5.3ä¸­é»˜è®¤å…³é—­</p></li></ul><pre><code>æœ€æ–°çš„ç‰ˆæœ¬ä¸º 20 May, 2019: release 3.5.5 available  </code></pre><p>more  <a href="http://zookeeper.apache.org/releases.html#news" target="_blank" rel="noopener">http://zookeeper.apache.org/releases.html#news</a></p><h2 id="è®¾è®¡ç›®æ ‡"><a href="#è®¾è®¡ç›®æ ‡" class="headerlink" title="è®¾è®¡ç›®æ ‡"></a>è®¾è®¡ç›®æ ‡</h2><ul><li><p>ç®€å•è®¾è®¡æ¨¡å‹ã€‚</p><ul><li><p>å…±äº«ã€æ ‘å½¢ç»“æ„çš„åå­—ç©ºé—´</p><p>  <img src="http://ww3.sinaimg.cn/large/006tNc79gy1g3p70vvka4j30ca071q31.jpg" alt="ZooKeeper&#39;s Hierarchical Namespace"></p></li></ul></li><li><p>å¯ä»¥æ„å»ºé›†ç¾¤</p><ul><li><p>(æ‰©å®¹ã€ç¼©å®¹ æ”¯æŒä¸å¥½  éœ€è¦å…¨éƒ¨é‡å¯ ,æˆ–ä¸€å°å°é‡å¯rolling update ã€3.5ç‰ˆæœ¬è§£å†³äº†è¯¥é—®é¢˜)</p><p>  <img src="http://ww2.sinaimg.cn/large/006tNc79gy1g3p6yo4dhhj30go055aaj.jpg" alt="ZooKeeper Service"></p></li></ul></li><li><p>é¡ºåºè®¿é—®</p></li><li><p>é«˜æ€§èƒ½ </p><ul><li><p>å†…å­˜,ç›´æ¥æœåŠ¡æ‰€æœ‰éäº‹åŠ¡è¯·æ±‚,é€‚åˆè¯»å¤šå†™å°‘( it performs best where reads are more common than writes, at ratios of around 10:1)</p><p>  <img src="http://ww3.sinaimg.cn/large/006tNc79gy1g3p74rq20ij30dw09qq3b.jpg" alt="ZooKeeper Throughput as the Read-Write Ratio Varies"></p></li></ul></li></ul><h2 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h2><h3 id="é›†ç¾¤è§’è‰²"><a href="#é›†ç¾¤è§’è‰²" class="headerlink" title="é›†ç¾¤è§’è‰²"></a>é›†ç¾¤è§’è‰²</h3><p>â€‹    ä¼ ç»ŸMaster/Slave ( redis/es )</p><p>â€‹    å¼•å…¥ Leader ã€Follower å’Œ Observer( ä¸å‚ä¸æŠ•ç¥¨ã€ä¸å†™äº‹åŠ¡æ—¥å¿— )è§’è‰² </p><h3 id="ä¼šè¯-Session"><a href="#ä¼šè¯-Session" class="headerlink" title="ä¼šè¯(Session)"></a>ä¼šè¯(Session)</h3><p>â€‹    TCPé•¿è¿æ¥ ã€Watchã€SessionTimeout</p><h3 id="æ•°æ®èŠ‚ç‚¹-Znode"><a href="#æ•°æ®èŠ‚ç‚¹-Znode" class="headerlink" title="æ•°æ®èŠ‚ç‚¹(Znode)"></a>æ•°æ®èŠ‚ç‚¹(Znode)</h3><p>â€‹    æŒä¹…èŠ‚ç‚¹å’Œä¸´æ—¶èŠ‚ç‚¹( ä¸Sessionæœ‰å…³)ã€é¡ºåºèŠ‚ç‚¹</p><h3 id="ç‰ˆæœ¬-ä¿è¯åˆ†å¸ƒå¼æ•°æ®åŸå­æ€§æ“ä½œã€ä¹è§‚é”"><a href="#ç‰ˆæœ¬-ä¿è¯åˆ†å¸ƒå¼æ•°æ®åŸå­æ€§æ“ä½œã€ä¹è§‚é”" class="headerlink" title="ç‰ˆæœ¬(ä¿è¯åˆ†å¸ƒå¼æ•°æ®åŸå­æ€§æ“ä½œã€ä¹è§‚é”)"></a>ç‰ˆæœ¬(ä¿è¯åˆ†å¸ƒå¼æ•°æ®åŸå­æ€§æ“ä½œã€ä¹è§‚é”)</h3><p>â€‹    Znodeä¼šæœ‰ä¸€ä¸ªStat åˆ†åˆ«æ˜¯ versionã€cversion ã€aversion( ACL )</p><h3 id="Watcher-å®¢æˆ·ç«¯çº¿ç¨‹ã€å®¢æˆ·ç«¯WatchManagerå’ŒæœåŠ¡å™¨"><a href="#Watcher-å®¢æˆ·ç«¯çº¿ç¨‹ã€å®¢æˆ·ç«¯WatchManagerå’ŒæœåŠ¡å™¨" class="headerlink" title="Watcher(å®¢æˆ·ç«¯çº¿ç¨‹ã€å®¢æˆ·ç«¯WatchManagerå’ŒæœåŠ¡å™¨)"></a>Watcher(å®¢æˆ·ç«¯çº¿ç¨‹ã€å®¢æˆ·ç«¯WatchManagerå’ŒæœåŠ¡å™¨)</h3><p>â€‹    å…è®¸ç”¨æˆ·åœ¨æŒ‡å®šèŠ‚ç‚¹æ³¨å†Œä¸€äº›Watcher,å¹¶ä¸”åœ¨ç‰¹å®šäº‹ä»¶è§¦å‘,æœåŠ¡ç«¯ä¼šè¿›è¡Œé€šçŸ¥.ä½†å…·ä½“çš„å†…å®¹è¿˜éœ€è¦å®¢æˆ·ç«¯è‡ªå·±å»æ‹‰å–.</p><ul><li>å®¢æˆ·ç«¯æ³¨å†ŒWatcher</li><li>æœåŠ¡ç«¯Watcherå¤„ç†<ul><li>ServerCnxn æ˜¯å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„è¿æ¥æ¥å£( NIOServerCnxnå’ŒNettyServerCnxn )</li></ul></li><li>å®¢æˆ·ç«¯å›è°ƒWatcher</li></ul><p>ç‰¹æ€§</p><ul><li>ä¸€æ¬¡æ€§( éœ€è¦é‡å¤æ³¨å†Œ )</li><li>å®¢æˆ·ç«¯ä¸²è¡Œæ‰§è¡Œ</li><li>è½»é‡  </li></ul><p>â€‹        é€šçŸ¥çŠ¶æ€ã€äº‹ä»¶ç±»å‹ã€èŠ‚ç‚¹è·¯å¾„</p><h3 id="ACL-Access-Control-Lists-ç±»ä¼¼UNIXæ–‡ä»¶ç³»ç»Ÿçš„æƒé™æ§åˆ¶"><a href="#ACL-Access-Control-Lists-ç±»ä¼¼UNIXæ–‡ä»¶ç³»ç»Ÿçš„æƒé™æ§åˆ¶" class="headerlink" title="ACL( Access Control Lists ç±»ä¼¼UNIXæ–‡ä»¶ç³»ç»Ÿçš„æƒé™æ§åˆ¶ )"></a>ACL( Access Control Lists ç±»ä¼¼UNIXæ–‡ä»¶ç³»ç»Ÿçš„æƒé™æ§åˆ¶ )</h3><ul><li>æƒé™æ¨¡å¼( Scheme )</li><li>æˆæƒå¯¹è±¡( ID )</li><li>æƒé™( permission )</li></ul><p>â€‹        CREATEã€READã€WRITEã€DELETEã€ADMIN</p><h2 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h2><ul><li>æ•°æ®å‘å¸ƒ/è®¢é˜…  </li><li>åˆ†å¸ƒå¼åè°ƒ/é€šçŸ¥ </li><li>é›†ç¾¤ç®¡ç†</li><li>Masteré€‰ä¸¾</li><li>åˆ†å¸ƒå¼é”(ç¾Šç¾¤æ•ˆåº”,Watcheråªå…³æ³¨æ¯”è‡ªå·±ä½çš„) </li><li>åˆ†å¸ƒå¼é˜Ÿåˆ—</li></ul><p>ä¸€èˆ¬ç”¨äºæœåŠ¡æ³¨å†Œä¸­å¿ƒ,å¦‚ä¸‹å›¾çš„Dubbo ä¸­çš„Registry ,æˆ–è€…é…ç½®æ¨é€ ( é…ç½®ä¸­å¿ƒ è§„æ¨¡ä¸å¤§çš„ ) </p><p><img src="http://ww2.sinaimg.cn/large/006tNc79gy1g3p5jteoz1j30tg0mw3zr.jpg" alt="Architecture"></p><h2 id="ZABåè®®"><a href="#ZABåè®®" class="headerlink" title="ZABåè®®"></a>ZABåè®®</h2><p>æ ¸å¿ƒæ˜¯å®šä¹‰äº†å¯¹äºé‚£äº›ä¼šæ”¹å˜ZooKeeperæœåŠ¡å™¨æ•°æ®çŠ¶æ€çš„äº‹åŠ¡è¯·æ±‚çš„å¤„ç†æ–¹å¼:</p><ol><li>æ‰€æœ‰äº‹åŠ¡è¯·æ±‚ç”±ä¸€ä¸ªå…¨å±€å”¯ä¸€æœåŠ¡å™¨å¤„ç† Leader</li><li>Leader è´Ÿè´£å°†å®¢æˆ·ç«¯äº‹åŠ¡è¯·æ±‚è½¬æ¢æˆä¸€ä¸ªäº‹åŠ¡Proposal .åˆ†å‘ç»™é›†ç¾¤ä¸­çš„æ‰€æœ‰Follower</li><li>ç­‰å¾…æ‰€æœ‰æœåŠ¡å™¨åé¦ˆ,ä¸€æ—¦è¶…è¿‡åŠæ•°FolloweræœåŠ¡å™¨æ­£ç¡®åé¦ˆ Leader ä¼šå†æ¬¡å‘æ‰€æœ‰FolloweræœåŠ¡å™¨åˆ†å‘commit</li></ol><h3 id="ä¸¤ä¸ªè¿‡ç¨‹"><a href="#ä¸¤ä¸ªè¿‡ç¨‹" class="headerlink" title="ä¸¤ä¸ªè¿‡ç¨‹"></a>ä¸¤ä¸ªè¿‡ç¨‹</h3><h4 id="å¥”æºƒæ¢å¤-åˆå§‹åŒ–å’Œé€‰ä¸¾"><a href="#å¥”æºƒæ¢å¤-åˆå§‹åŒ–å’Œé€‰ä¸¾" class="headerlink" title="å¥”æºƒæ¢å¤(åˆå§‹åŒ–å’Œé€‰ä¸¾)"></a>å¥”æºƒæ¢å¤(åˆå§‹åŒ–å’Œé€‰ä¸¾)</h4><ul><li>åŸºæœ¬ç‰¹å¾<ul><li>ç¡®ä¿é‚£äº›å·²ç»åœ¨LeaderæœåŠ¡å™¨ä¸Šæäº¤çš„äº‹åŠ¡æœ€ç»ˆè¢«æ‰€æœ‰æœåŠ¡å™¨æäº¤</li><li>ç¡®ä¿ä¸¢å¼ƒé‚£äº›åªåœ¨LeaderæœåŠ¡å™¨ä¸Šæå‡ºçš„äº‹åŠ¡</li></ul></li><li>æ•°æ®åŒæ­¥<ul><li>ç›´æ¥å·®å¼‚åŒ–åŒæ­¥</li><li>å…ˆå›æ»šå†å·®å¼‚åŒ–åŒæ­¥</li><li>ä»…å›æ»šåŒæ­¥</li><li>å…¨é‡åŒæ­¥  (ä¼˜å…ˆ)</li></ul></li></ul><p>â€‹        ZKDatabaseä¼šå®šæ—¶å‘ç£ç›˜dumpå¿«ç…§æ•°æ®,å†ZooKeeperæœåŠ¡å™¨å¯åŠ¨çš„æ—¶å€™,ä¼šé€šè¿‡ç£ç›˜ä¸Šçš„äº‹åŠ¡æ—¥å¿—(äº‹åŠ¡æ“ä½œæ—¶é—´ã€å®¢æˆ·ç«¯ä¼šè¯IDã€CXID å®¢æˆ·ç«¯æ“ä½œIDã€ZXIDã€æ“ä½œç±»å‹ã€èŠ‚ç‚¹è·¯å¾„ã€èŠ‚ç‚¹æ•°æ®å†…å®¹ã€èŠ‚ç‚¹çš„ACLä¿¡æ¯ã€æ˜¯å¦ä¸´æ—¶èŠ‚ç‚¹å’Œçˆ¶èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ç‰ˆæœ¬å·)å’Œå¿«ç…§æ•°æ®æ–‡ä»¶æ¢å¤æˆä¸€ä¸ªå®Œæ•´çš„å†…å­˜æ•°æ®åº“</p><h4 id="æ¶ˆæ¯å¹¿æ’­"><a href="#æ¶ˆæ¯å¹¿æ’­" class="headerlink" title="æ¶ˆæ¯å¹¿æ’­"></a>æ¶ˆæ¯å¹¿æ’­</h4><p>â€‹            äº‹åŠ¡å…¨å±€å•è°ƒé€’å¢å”¯ä¸€ID (äº‹åŠ¡ID :åŒ…å«epoch é€‰ä¸¾å‘¨æœŸ) å’Œmyid(æœºå™¨åºå·å”¯ä¸€id)  ,ä¸ºæ¯ä¸ªFolloweråˆ†é…ä¸€ä¸ªFIFOé˜Ÿåˆ— ,Followeræ¥æ”¶åå›å†™å…¥äº‹åŠ¡æ—¥å¿—,æœ¬åœ°ç£ç›˜(åŸºäºFIFO ç‰¹æ€§çš„TCPåè®®ã€‚ä¿è¯æ¶ˆæ¯å¹¿æ’­è¿‡ç¨‹ä¸­æ¶ˆæ¯æ¥æ”¶ä¸å‘é€çš„é¡ºåºæ€§)</p><h3 id="å››ä¸ªé˜¶æ®µ"><a href="#å››ä¸ªé˜¶æ®µ" class="headerlink" title="å››ä¸ªé˜¶æ®µ"></a>å››ä¸ªé˜¶æ®µ</h3><ul><li>é€‰ä¸¾ <ul><li>æ ¹æ®Vote(zxid,myid). electionEpochå½“å‰é€‰ä¸¾å‘¨æœŸã€‚ state LOOKING</li></ul></li><li>å‘ç°<ul><li>Followerå°†æœ€åepochå‘é€ç»™å‡†Leader</li><li>æ”¶åˆ°è¿‡åŠQuorum ç”Ÿæˆæ–°epoch ç»™è¿™äº›è¿‡åŠFollower</li><li>åé¦ˆACKå’Œå†å²Proposalé›†åˆ ,  Leader ä»ä¸­é€‰æ‹©äº‹åŠ¡é›†åˆ</li></ul></li><li>åŒæ­¥<ul><li>Leader å°†äº‹åŠ¡é›†åˆ å‘ç»™æ‰€æœ‰Quorum</li></ul></li><li>å¹¿æ’­<ul><li>å¼€å§‹æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚,å¹¶è¿›è¡Œæ¶ˆæ¯å¹¿æ’­æµç¨‹</li></ul></li></ul><p>èŠ‚ç‚¹çŠ¶æ€</p><ul><li><p>LOOKING </p></li><li><p>FOLLOWING</p></li><li><p>LEADING</p></li></ul><h3 id="ZABå’ŒPaxosåŒºåˆ«"><a href="#ZABå’ŒPaxosåŒºåˆ«" class="headerlink" title="ZABå’ŒPaxosåŒºåˆ«"></a>ZABå’ŒPaxosåŒºåˆ«</h3><ul><li>ZABåè®®ä¸»è¦ç”¨äºæ„å»ºä¸€ä¸ªé«˜å¯ç”¨çš„åˆ†å¸ƒå¼æ•°æ®ä¸»å¤‡ç³»ç»Ÿ</li><li>Paxosç®—æ³•ç”¨äºæ„å»ºä¸€ä¸ªåˆ†å¸ƒå¼çš„ä¸€è‡´æ€§çŠ¶æ€æœºç³»ç»Ÿ</li></ul><h2 id="ç¼ºé™·å’Œä¸è¶³"><a href="#ç¼ºé™·å’Œä¸è¶³" class="headerlink" title="ç¼ºé™·å’Œä¸è¶³"></a>ç¼ºé™·å’Œä¸è¶³</h2><p>â€‹    å®˜ç½‘çš„ä»‹ç»ä¸­</p><p><code>ZooKeeper is a distributed, open-source coordination service for distributed applications. It exposes a simple set of primitives that distributed applications can build upon to implement higher level services for synchronization, configuration maintenance, and groups and naming.</code> </p><p>â€‹    ç¿»è¯‘å¦‚ä¸‹</p><pre><code>        ZooKeeperæ˜¯ä¸€ç§ç”¨äºåˆ†å¸ƒå¼åº”ç”¨ç¨‹åºçš„åˆ†å¸ƒå¼å¼€æºåè°ƒæœåŠ¡ã€‚å®ƒå…¬å¼€äº†ä¸€ç»„ç®€å•çš„åŸè¯­ï¼Œåˆ†å¸ƒå¼åº”ç”¨ç¨‹åºå¯ä»¥æ„å»ºè¿™äº›åŸè¯­ï¼Œä»¥å®ç°æ›´é«˜çº§åˆ«çš„æœåŠ¡ï¼Œä»¥å®ç°åŒæ­¥ï¼Œé…ç½®ç»´æŠ¤ä»¥åŠç»„å’Œå‘½åã€‚</code></pre><ul><li>æä¾›æ¯”è¾ƒåº•å±‚çš„API, å…·ä½“ç”±ä½¿ç”¨æ–¹å®ç°(è¿™ä¸ªç±»ä¼¼äºJ.U.C æä¾›äº†validate å’Œ CAS )</li><li>javaåŸç”Ÿå®¢æˆ·ç«¯ä½¿ç”¨ç¹çå¤æ‚,å¦‚Watcheréœ€è¦åå¤æ³¨å†Œ ,æ¨èä½¿ç”¨Curator</li><li>æ•°æ®æ¨¡å‹ä¸ºCP, æ‰€ä»¥åœ¨å¯ç”¨æ€§æ–¹é¢ä¼šæœ‰æ‰€ä¸è¶³,ä¾‹å¦‚é€‰ä¸¾æœŸé—´æœåŠ¡ä¸å¯ç”¨(å› ä¸ºå¯ç”¨æ€§é—®é¢˜,æ‰€ä»¥å®¢æˆ·ç«¯ä¸åº”è¯¥å¼ºä¾èµ–zookeeper ,ä¸€èˆ¬çš„åšæ³•æ˜¯å®¢æˆ·ç«¯éœ€è¦æœ¬åœ°ç¼“å­˜)</li><li>zookeeperçš„é€‰ä¸¾è¿‡ç¨‹é€Ÿåº¦å¾ˆæ…¢ï¼Œzookeeperçš„é€‰ä¸¾æµç¨‹é€šå¸¸è€—æ—¶30åˆ°120ç§’ï¼ŒæœŸé—´zookeeperç”±äºæ²¡æœ‰masterï¼Œéƒ½æ˜¯ä¸å¯ç”¨çš„ã€‚(å®˜ç½‘ä¸­æåˆ° To show the behavior of the system over time as failures are injected we ran a ZooKeeper service made up of 7 machines.In our observations, ZooKeeper takes less than 200ms to elect a new leader.)</li><li>Zookeeperæ ‘å½¢æ–‡ä»¶ç»“æ„ã€æ•°æ®å­˜å‚¨åœ¨å†…å­˜, ä½† snapshotï¼ˆå³æ•°æ®é‡ï¼‰ä¸å»ºè®®è¶…è¿‡ 1G,å¦åˆ™å®¹æ˜“å‡ºç°é€‰ä¸»å¤±è´¥ï¼Œå¯¼è‡´æ•´ä¸ªé›†ç¾¤ä¸å¯ç”¨</li><li>Zookeeperä¸èƒ½ä¿è¯è·¨sessionçš„å¼ºä¸€è‡´æ€§</li><li>Scalabilityå¾ˆå¼±ï¼Œ3.5.0ä¹‹å‰çš„ç‰ˆæœ¬ä¿®æ”¹ä»»ä½•é…ç½®è¿˜å¾—è¦rolling updateï¼›3.5.0ä¹‹åæ–°å¢æ”¯æŒåŠ¨æ€reconfiguration</li><li>å…¶ä»– ç›‘æ§å®Œå–„ã€ä¸æä¾›RESTful APIã€ç¤¾åŒºæ´»è·ƒåº¦</li></ul><p>å‚è€ƒ:</p><blockquote><p>å®˜æ–¹é“¾æ¥: <a href="http://zookeeper.apache.org/doc/r3.5.5/zookeeperOver.html" target="_blank" rel="noopener">http://zookeeper.apache.org/doc/r3.5.5/zookeeperOver.html</a></p><p>Zookeeperç¼ºç‚¹ :<a href="https://www.zhihu.com/question/42931473" target="_blank" rel="noopener">https://www.zhihu.com/question/42931473</a></p><p>ä»Paxosåˆ°Zookeåˆ†å¸ƒå¼ä¸€è‡´æ€§åŸç†ä¸å®è·µ</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> distributed </tag>
            
            <tag> framework </tag>
            
            <tag> zookeeper </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ†å¸ƒå¼ç†è®ºåŸºç¡€</title>
      <link href="/2019/06/03/Overview_Distributed/"/>
      <url>/2019/06/03/Overview_Distributed/</url>
      
        <content type="html"><![CDATA[<p><img src="http://ww3.sinaimg.cn/large/006tNc79gy1g3p3wk755qj31400u0gog.jpg" alt="image-20190604142744558"></p><a id="more"></a><h3 id="å­˜åœ¨çš„é—®é¢˜"><a href="#å­˜åœ¨çš„é—®é¢˜" class="headerlink" title="å­˜åœ¨çš„é—®é¢˜"></a>å­˜åœ¨çš„é—®é¢˜</h3><hr><h4 id="ç½‘ç»œé€šä¿¡å¼‚å¸¸"><a href="#ç½‘ç»œé€šä¿¡å¼‚å¸¸" class="headerlink" title="ç½‘ç»œé€šä¿¡å¼‚å¸¸"></a>ç½‘ç»œé€šä¿¡å¼‚å¸¸</h4><p>â€‹        ç½‘ç»œå»¶è¿Ÿ</p><h4 id="ç½‘ç»œåˆ†åŒº"><a href="#ç½‘ç»œåˆ†åŒº" class="headerlink" title="ç½‘ç»œåˆ†åŒº"></a>ç½‘ç»œåˆ†åŒº</h4><p>â€‹        è„‘è£‚ ä¸¤ä¸ªç‹¬ç«‹é›†ç¾¤</p><h4 id="ä¸‰æ€"><a href="#ä¸‰æ€" class="headerlink" title="ä¸‰æ€"></a>ä¸‰æ€</h4><ul><li>æˆåŠŸ </li><li>å¤±è´¥ </li><li>è¶…æ—¶  <ul><li>å‘é€è¿‡ç¨‹ä¸¢å¤±</li><li>ç»“æœåé¦ˆä¸¢å¤±</li></ul></li></ul><p>â€‹             </p><h3 id="ä»ACID-åˆ°CAP-BASE"><a href="#ä»ACID-åˆ°CAP-BASE" class="headerlink" title="ä»ACID åˆ°CAP/ BASE"></a>ä»ACID åˆ°CAP/ BASE</h3><hr><h4 id="ä¼ ç»ŸDBMS-ä¸­çš„ACID"><a href="#ä¼ ç»ŸDBMS-ä¸­çš„ACID" class="headerlink" title="ä¼ ç»ŸDBMS ä¸­çš„ACID"></a>ä¼ ç»ŸDBMS ä¸­çš„ACID</h4><ul><li>Atomicity åŸå­æ€§   </li><li>Isolation éš”ç¦»çº¿<ul><li>æœªæˆæƒè¯»å–(<em>RU</em>); </li><li>æˆæƒè¯»å–(<em>RC</em>); </li><li>å¯é‡å¤è¯»å–(<em>RR</em>); </li><li>ä¸²è¡ŒåŒ–(<em>S</em>)</li></ul></li><li>Consistency ä¸€è‡´æ€§</li><li>Durability æŒä¹…æ€§</li></ul><p>â€‹    </p><h4 id="CAP"><a href="#CAP" class="headerlink" title="CAP"></a>CAP</h4><ul><li>A é«˜å¯ç”¨ </li><li>C ä¸€è‡´æ€§ </li><li>P åˆ†åŒº å‰¯æœ¬</li></ul><p>åœ¨Cå’ŒAä¹‹ä¸­å¯»æ‰¾å¹³è¡¡</p><h4 id="BASE"><a href="#BASE" class="headerlink" title="BASE"></a>BASE</h4><ul><li>Basically Acaliable <ul><li>å“åº”æ—¶é—´æŸå¤±</li><li>åŠŸèƒ½ä¸Šé™çº§</li></ul></li><li>Soft state</li><li>Eventually consistent</li></ul><p>ä¸æ­¢åˆ†å¸ƒå¼ç¯å¢ƒ,ç°ä»£æ•°æ®åº“ä¸»ä»å¤åˆ¶</p><h3 id="ä¸€è‡´æ€§åè®®"><a href="#ä¸€è‡´æ€§åè®®" class="headerlink" title="ä¸€è‡´æ€§åè®®"></a>ä¸€è‡´æ€§åè®®</h3><hr><p>â€‹    ä¸€è‡´æ€§é—®é¢˜çš„è§£æ³•å°±æ˜¯åˆ†å¸ƒå¼æ—¶é’Ÿï¼Œåˆ†å¸ƒå¼äº‹åŠ¡ä¸ä¸€è‡´æ€§ç®—æ³•ã€‚ </p><p>â€‹    é€‰ä¸¾ã€å¤šæ•°æ´¾ã€ç§Ÿçº¦</p><p>â€‹    é¡ºåºæ—¶é’Ÿ</p><h4 id="XA-è§„èŒƒ"><a href="#XA-è§„èŒƒ" class="headerlink" title="XA è§„èŒƒ"></a>XA è§„èŒƒ</h4><h4 id="2PC"><a href="#2PC" class="headerlink" title="2PC"></a>2PC</h4><p>â€‹     åŒæ­¥é˜»å¡ã€æ— é™åˆ¶ç­‰å¾…ã€ å­˜åœ¨è„‘è£‚é—®é¢˜</p><h4 id="3PC"><a href="#3PC" class="headerlink" title="3PC"></a>3PC</h4><p>â€‹    ç¼©å°é˜»å¡èŒƒå›´ã€åŠ å…¥è¶…æ—¶ ã€å­˜åœ¨è„‘è£‚é—®é¢˜</p><h4 id="Paxosç®—æ³•"><a href="#Paxosç®—æ³•" class="headerlink" title="Paxosç®—æ³•"></a>Paxosç®—æ³•</h4><p>â€‹     <a href="https://github.com/Tencent/phxpaxos" target="_blank" rel="noopener">https://github.com/Tencent/phxpaxos</a>  è…¾è®¯å¾®ä¿¡åå°çš„å®ç°</p><h4 id="RAFTç®—æ³•"><a href="#RAFTç®—æ³•" class="headerlink" title="RAFTç®—æ³•:"></a>RAFTç®—æ³•:</h4><p><a href="https://www.jianshu.com/p/8279d6fd65bb" target="_blank" rel="noopener">https://www.jianshu.com/p/8279d6fd65bb</a></p><p><a href="https://redis.io/topics/cluster-spec" target="_blank" rel="noopener">https://redis.io/topics/cluster-spec</a></p><h4 id="Bullyç®—æ³•"><a href="#Bullyç®—æ³•" class="headerlink" title="Bullyç®—æ³•"></a>Bullyç®—æ³•</h4><p> <a href="http://www.cs.colostate.edu/~cs551/CourseNotes/Synchronization/BullyExample.html" target="_blank" rel="noopener">http://www.cs.colostate.edu/~cs551/CourseNotes/Synchronization/BullyExample.html</a></p><p>â€‹        å®ç°:Es   ä¸»ä»æ¨¡å¼ (èŠ‚ç‚¹ã€åˆ†ç‰‡ã€å‰¯æœ¬) å®¹æ˜“å‡ºç°è„‘è£‚,æ‰€ä»¥ä½¿ç”¨è¿‡åŠæ¥è§£å†³</p><p>â€‹        ESçš„å†™å…¥ä¼˜åŒ–</p><h4 id="Gossipåè®®"><a href="#Gossipåè®®" class="headerlink" title="Gossipåè®®"></a>Gossipåè®®</h4><p>â€‹        å®ç°:redis (gossipåè®®ã€‚p2p)   ä¸»ä»æ¨¡å¼ ,ä¸»ä»å¤åˆ¶  æŒä¹…åŒ–(AOFã€RDB)</p><p>â€‹        <a href="https://www.v2ex.com/t/453036" target="_blank" rel="noopener">https://www.v2ex.com/t/453036</a></p><h4 id="ZABåè®®"><a href="#ZABåè®®" class="headerlink" title="ZABåè®®"></a>ZABåè®®</h4><p>â€‹        å®ç° : zk(hadoopã€hbase ã€kafka)</p>]]></content>
      
      
      
        <tags>
            
            <tag> distributed </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>spring-api-1.0</title>
      <link href="/2019/04/10/spring-api-1-0/"/>
      <url>/2019/04/10/spring-api-1-0/</url>
      
        <content type="html"><![CDATA[<p>spring-api-1.0</p><p><a href="https://docs.spring.io/spring/docs/1.0.0/javadoc-api/" target="_blank" rel="noopener">https://docs.spring.io/spring/docs/1.0.0/javadoc-api/</a></p><a id="more"></a><hr><h3 id="base"><a href="#base" class="headerlink" title="base"></a>base</h3><p><a href="https://docs.spring.io/spring/docs/1.0.0/javadoc-api/org/springframework/aop/package-frame.html" target="_blank" rel="noopener">org.springframework.aop</a> </p><p><a href="https://docs.spring.io/spring/docs/1.0.0/javadoc-api/org/springframework/beans/package-frame.html" target="_blank" rel="noopener">org.springframework.beans</a> </p><p>â€‹    The classes in this package are discussed in Chapter 11 of <a href="https://www.amazon.com/exec/obidos/tg/detail/-/0764543857/" target="_blank" rel="noopener">Expert One-On-One J2EE Design and Development</a> by Rod Johnson (Wrox, 2002).</p><p><a href="https://docs.spring.io/spring/docs/1.0.0/javadoc-api/org/springframework/context/package-frame.html" target="_blank" rel="noopener">org.springframework.context</a> </p><p>â€‹    This package builds on the beans package to add support for message sources and for the Observer design pattern, and the ability for application objects to obtain resources using a consistent API.</p><p><a href="https://docs.spring.io/spring/docs/1.0.0/javadoc-api/org/springframework/core/package-frame.html" target="_blank" rel="noopener">org.springframework.core</a> </p><hr><h3 id="component"><a href="#component" class="headerlink" title="component"></a>component</h3><p><a href="https://docs.spring.io/spring/docs/1.0.0/javadoc-api/org/springframework/metadata/package-frame.html" target="_blank" rel="noopener">org.springframework.metadata</a> </p><p>â€‹    Package defining a facade for accessing source-level metadata attributes at runtime.</p><p><a href="https://docs.spring.io/spring/docs/1.0.0/javadoc-api/org/springframework/ejb/access/package-frame.html" target="_blank" rel="noopener">org.springframework.ejb.access</a>  ejb</p><p><a href="https://docs.spring.io/spring/docs/1.0.0/javadoc-api/org/springframework/mail/package-frame.html" target="_blank" rel="noopener">org.springframework.mail</a> </p><p><a href="https://docs.spring.io/spring/docs/1.0.0/javadoc-api/org/springframework/remoting/package-frame.html" target="_blank" rel="noopener">org.springframework.remoting</a>   </p><p><a href="https://docs.spring.io/spring/docs/1.0.0/javadoc-api/org/springframework/scheduling/quartz/package-frame.html" target="_blank" rel="noopener">org.springframework.scheduling.quartz</a>  scheduling</p><p><a href="https://docs.spring.io/spring/docs/1.0.0/javadoc-api/org/springframework/jndi/package-frame.html" target="_blank" rel="noopener">org.springframework.jndi</a> </p><p>â€‹    The classes in this package are discussed in Chapter 11 of <a href="https://www.amazon.com/exec/obidos/tg/detail/-/0764543857/" target="_blank" rel="noopener">Expert One-On-One J2EE Design and Development</a> by Rod Johnson (Wrox, 2002).</p><hr><h3 id="data-access"><a href="#data-access" class="headerlink" title="data access"></a>data access</h3><p><a href="https://docs.spring.io/spring/docs/1.0.0/javadoc-api/org/springframework/dao/package-summary.html" target="_blank" rel="noopener">org.springframework.dao</a></p><p><a href="https://docs.spring.io/spring/docs/1.0.0/javadoc-api/org/springframework/jdbc/package-frame.html" target="_blank" rel="noopener">org.springframework.jdbc</a> </p><p>â€‹    This package and related packages are discussed in Chapter 9 of <a href="https://www.amazon.com/exec/obidos/tg/detail/-/0764543857/" target="_blank" rel="noopener">Expert One-On-One J2EE Design and Development</a> by Rod Johnson (Wrox, 2002).</p><p><a href="https://docs.spring.io/spring/docs/1.0.0/javadoc-api/org/springframework/orm/package-frame.html" target="_blank" rel="noopener">org.springframework.orm</a> </p><p><a href="https://docs.spring.io/spring/docs/1.0.0/javadoc-api/org/springframework/transaction/package-frame.html" target="_blank" rel="noopener">org.springframework.transaction</a>  </p><hr><h3 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h3><p><a href="https://docs.spring.io/spring/docs/1.0.0/javadoc-api/org/springframework/ui/context/package-frame.html" target="_blank" rel="noopener">org.springframework.ui.context</a>  ui</p><p><a href="https://docs.spring.io/spring/docs/1.0.0/javadoc-api/org/springframework/validation/package-frame.html" target="_blank" rel="noopener">org.springframework.validation</a> </p><p><a href="https://docs.spring.io/spring/docs/1.0.0/javadoc-api/org/springframework/web/context/package-frame.html" target="_blank" rel="noopener">org.springframework.web.context</a>  web</p><p><a href="https://docs.spring.io/spring/docs/1.0.0/javadoc-api/org/springframework/web/filter/package-frame.html" target="_blank" rel="noopener">org.springframework.web.filter</a> </p><p><a href="https://docs.spring.io/spring/docs/1.0.0/javadoc-api/org/springframework/web/multipart/package-frame.html" target="_blank" rel="noopener">org.springframework.web.multipart</a> </p><p><a href="https://docs.spring.io/spring/docs/1.0.0/javadoc-api/org/springframework/web/servlet/package-frame.html" target="_blank" rel="noopener">org.springframework.web.servlet</a>  servlet</p>]]></content>
      
      
      <categories>
          
          <category> spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>3æœˆç¬¬å››å‘¨çŸ¥è¯†ç‚¹è®°å½•</title>
      <link href="/2019/04/01/3%E6%9C%88%E7%AC%AC%E5%9B%9B%E5%91%A8%E7%9F%A5%E8%AF%86%E7%82%B9%E8%AE%B0%E5%BD%95/"/>
      <url>/2019/04/01/3%E6%9C%88%E7%AC%AC%E5%9B%9B%E5%91%A8%E7%9F%A5%E8%AF%86%E7%82%B9%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<p>ç¬¬å››å‘¨ 25-31 è®°å½•</p><p>ä¸€å‘¨å­¦ä¹ çš„çŸ¥è¯†ç‚¹ç½—åˆ—ï¼Œæ¯”è¾ƒå‘æ•£ï¼Œç²¾åŠ›æœ‰é™ï¼Œä¼šé€‰å–ç›¸å…³æ€»ç»“ã€‚</p><p>åªè¦ä½ ä¸€ç›´èµ°åœ¨è·¯ä¸Šï¼Œé‚£ä¹ˆ æœªæ¥å¯æœŸä¹Ÿã€‚</p><a id="more"></a><h2 id="å‘¨ä¸€"><a href="#å‘¨ä¸€" class="headerlink" title="å‘¨ä¸€"></a>å‘¨ä¸€</h2><p>éjvmå†…çš„è°ƒç”¨</p><p>Distributed object communication</p><p><a href="https://en.wikipedia.org/wiki/Distributed_object_communication" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Distributed_object_communication</a></p><p>rmi  stub ã€skeleton</p><p><a href="https://en.wikipedia.org/wiki/Java_remote_method_invocation" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Java_remote_method_invocation</a></p><p><img src="https://ws4.sinaimg.cn/large/006tKfTcgy1g1euo90mujj30b401odfr.jpg" alt="img"></p><p>rpc å’Œ rmi</p><p>åœ¨é‡Œé¢<a href="https://en.wikipedia.org/wiki/Object-oriented_programming" target="_blank" rel="noopener">é¢å‘å¯¹è±¡çš„ç¼–ç¨‹</a>èŒƒä¾‹ï¼ŒRPCè°ƒç”¨ç”±<a href="https://en.wikipedia.org/wiki/Remote_method_invocation" target="_blank" rel="noopener">è¿œç¨‹æ–¹æ³•è°ƒç”¨</a>ï¼ˆRMIï¼‰è¡¨ç¤º</p><h2 id="å‘¨äºŒ"><a href="#å‘¨äºŒ" class="headerlink" title="å‘¨äºŒ"></a>å‘¨äºŒ</h2><p>serveltè§„èŒƒ</p><p>304 ç›¸å…³</p><p><a href="https://zhuanlan.zhihu.com/p/59171313" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/59171313</a></p><h2 id="å‘¨ä¸‰"><a href="#å‘¨ä¸‰" class="headerlink" title="å‘¨ä¸‰"></a>å‘¨ä¸‰</h2><p>é«˜å¯ç”¨</p><p>â€‹    ç°åº¦<br>â€‹    log ç›‘æ§<br>â€‹    åŒå†™åŒè¯» é˜²å•ç‚¹<br>â€‹    æ•°æ®ç¾å¤‡</p><p>tcp/http</p><p><a href="https://cs.chromium.org/chromium/src/net/socket/tcp_socket_win.cc?sq=package:chromium&amp;g=0&amp;l=45" target="_blank" rel="noopener">https://cs.chromium.org/chromium/src/net/socket/tcp_socket_win.cc?sq=package:chromium&amp;g=0&amp;l=45</a></p><p><a href="https://www.jianshu.com/p/cd71efa49d63" target="_blank" rel="noopener">https://www.jianshu.com/p/cd71efa49d63</a></p><p><a href="https://segmentfault.com/a/1190000006923359" target="_blank" rel="noopener">https://segmentfault.com/a/1190000006923359</a></p><p>es http </p><p>es ä½¿ç”¨clientçš„æ€§èƒ½</p><p>es in too many é”™è¯¯ï¼Œé»˜è®¤æƒ…å†µä¸‹ inçš„é™åˆ¶ä¸è¶…è¿‡1000</p><p>http çŠ¶æ€</p><p><a href="https://www.cnblogs.com/aspirant/p/5702338.html" target="_blank" rel="noopener">https://www.cnblogs.com/aspirant/p/5702338.html</a></p><p>çº¿ç¨‹æ± </p><h2 id="å‘¨å››"><a href="#å‘¨å››" class="headerlink" title="å‘¨å››"></a>å‘¨å››</h2><p>åæ¨¡å¼</p><p>â€‹    ç¥ä»™å¤§ç±»ï¼š ç±»èŒè´£ä¸å•ä¸€ï¼Œå¤ç”¨æ€§ä½</p><p>â€‹    é»„é‡‘å¤§é”¤ï¼šä¸è¦ä¸€å‘³ä½¿ç”¨map Stringï¼Œé›¾æ˜¯Stringçš„æµ“ï¼Œéœ¾æ˜¯Mapçš„åš</p><p>æšä¸¾</p><p>final å¯ä»¥å†™abstractï¼Ÿ æšä¸¾çš„å­—èŠ‚ç ï¼Œfinal ï¼Œextend</p><p>æšä¸¾è®¾è®¡ï¼šç†è§£æšä¸¾å¼•å…¥çš„æ„ä¹‰ä»¥åŠå˜åŒ–ï¼Œ JDK ä¸­å¸¸è§æšä¸¾çš„è®¾è®¡</p><p>å¤šçº¿ç¨‹ ï¼Œå¤šæ ¸ï¼Ÿ</p><p><a href="https://www.zhihu.com/question/271821176/answer/364029483?utm_source=wechat_session&amp;utm_medium=social&amp;utm_oi=557574927448846336" target="_blank" rel="noopener">https://www.zhihu.com/question/271821176/answer/364029483?utm_source=wechat_session&amp;utm_medium=social&amp;utm_oi=557574927448846336</a></p><h2 id="å‘¨äº”"><a href="#å‘¨äº”" class="headerlink" title="å‘¨äº”"></a>å‘¨äº”</h2><p>â€‹    æ³›å‹å’Œç±»å‹æ“¦é™¤åçš„classæ–‡ä»¶</p><p>æ³›å‹å‚æ•°çš„è·å–ï¼Œè¢«æ“¦é™¤åå¦‚ä½•è·å–</p><p>â€‹    å¦‚æœæ³›å‹å‚æ•°æ˜¯åœ¨å±æ€§ï¼Œå¯ä»¥é€šè¿‡å­—èŠ‚ç çš„æ–¹å¼è·å–å­—ç¬¦æè¿°ï¼Œç„¶ååæ¨</p><p>â€‹    å¦‚æœæ³›å‹å‚æ•°åœ¨ç±»å‹ä¸Šé¢äº†ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡åå°„è·å–</p><pre><code class="java">ParameterizedType parameterizedType = (ParameterizedType)             declaredClass.getGenericSuperclass();Type[] actualTypeArguments = parameterizedType.getActualTypeArguments();return (Class&lt;T&gt;) actualTypeArguments[0];</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> week </tag>
            
            <tag> hide </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®°ä¸€æ¬¡mysqlæŸ¥è¯¢inçš„æ€è€ƒ</title>
      <link href="/2019/03/30/%E8%AE%B0%E4%B8%80%E6%AC%A1mysql%E6%9F%A5%E8%AF%A2in%E7%9A%84%E6%80%9D%E8%80%83/"/>
      <url>/2019/03/30/%E8%AE%B0%E4%B8%80%E6%AC%A1mysql%E6%9F%A5%E8%AF%A2in%E7%9A%84%E6%80%9D%E8%80%83/</url>
      
        <content type="html"><![CDATA[<h3 id="ä»ä¸€ä¸ªæ—¥å¸¸çš„in-æŸ¥è¯¢çš„ä¼˜åŒ–è¯´èµ·"><a href="#ä»ä¸€ä¸ªæ—¥å¸¸çš„in-æŸ¥è¯¢çš„ä¼˜åŒ–è¯´èµ·" class="headerlink" title="ä»ä¸€ä¸ªæ—¥å¸¸çš„in æŸ¥è¯¢çš„ä¼˜åŒ–è¯´èµ·"></a>ä»ä¸€ä¸ªæ—¥å¸¸çš„in æŸ¥è¯¢çš„ä¼˜åŒ–è¯´èµ·</h3><p>â€‹    ä¸šåŠ¡åœºæ™¯éœ€è¦ <code>select * from table where id in( )</code>ï¼Œ ç„¶åå°±ä¼šæŠ›å‡ºä¸€ä¸ªé—®é¢˜ï¼Œä½¿ç”¨in ä¼šä¸ä¼šèµ°ç´¢å¼•ï¼Ÿ</p><p>â€‹    å¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºä¹‹å‰åœ¨ç½‘ä¸Šçœ‹è¿‡è¯´ä¸ä¼šï¼Œè¯´ä¼šçš„ï¼Œå……æ–¥ç€å„ç§è¯´æ³•ï¼Œç„¶åè‡ªå·±å¯¹è¿™å—ä¹Ÿæ˜¯å¾ˆä¹…ä¹‹å‰çœ‹è¿‡ã€‚å‚è€ƒäº†ä¸€äº›èµ„æ–™ã€‚å†™ä¸‹è‡ªå·±çš„æ€è€ƒã€‚</p><p>â€‹    å…¶å®å…³äºè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ç¼©å°èŒƒå›´ï¼Œé¦–å…ˆæ˜¯ç¡®å®šç‰ˆæœ¬ï¼Œç‰ˆæœ¬æ„è¯†å¾ˆé‡è¦ï¼Œè¿™é‡Œæˆ‘ä»¬è®¨è®ºå»ºç«‹åœ¨5.5.39-log è¿™ä¸ªç‰ˆæœ¬ä¸Šã€‚ï¼ˆä½¿ç”¨ <code>select version()</code>; å‘½ä»¤å¯ä»¥æŸ¥çœ‹å½“å‰ç‰ˆæœ¬ï¼‰</p><a id="more"></a><p>â€‹    </p><h3 id="ä½¿ç”¨EXPLAIN"><a href="#ä½¿ç”¨EXPLAIN" class="headerlink" title="ä½¿ç”¨EXPLAIN"></a>ä½¿ç”¨<a href="https://dev.mysql.com/doc/refman/5.5/en/explain.html" target="_blank" rel="noopener"><code>EXPLAIN</code></a></h3><p>â€‹    å½“æ‚¨åœ¨<a href="https://dev.mysql.com/doc/refman/5.5/en/select.html" target="_blank" rel="noopener"><code>SELECT</code></a> å¸¦æœ‰å…³é”®å­—çš„è¯­å¥ ä¹‹å‰æ—¶<a href="https://dev.mysql.com/doc/refman/5.5/en/explain.html" target="_blank" rel="noopener"><code>EXPLAIN</code></a>ï¼ŒMySQLä¼šæ˜¾ç¤ºä¼˜åŒ–ç¨‹åºä¸­æœ‰å…³è¯­å¥æ‰§è¡Œè®¡åˆ’çš„ä¿¡æ¯ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒMySQLè§£é‡Šäº†å®ƒå°†å¦‚ä½•å¤„ç†è¯­å¥ï¼ŒåŒ…æ‹¬æœ‰å…³å¦‚ä½•è¿æ¥è¡¨ä»¥åŠä»¥ä½•ç§é¡ºåºè¿æ¥çš„ä¿¡æ¯ã€‚</p><h4 id="MySQLè¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹"><a href="#MySQLè¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹" class="headerlink" title="MySQLè¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹"></a>MySQLè¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹</h4><p>â€‹    é¦–å…ˆæˆ‘ä»¬è¦äº†è§£ä½•ä¸ºæ‰§è¡Œè®¡åˆ’ï¼Œè¿™åˆå¾—ä»ä¸€æ¡SQLè¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹è¯´èµ·ï¼ˆè¿™ä¸ªåœ¨é«˜æ€§èƒ½mysqlçš„6.4èŠ‚ä¸­æœ‰ä»‹ç»ï¼‰</p><p>æ•´ä¸ªæŸ¥è¯¢æµç¨‹å¤§è‡´å¦‚ä¸‹</p><ul><li>å®¢æˆ·ç«¯å‘ MySQL æœåŠ¡å™¨å‘é€ä¸€æ¡æŸ¥è¯¢è¯·æ±‚ï¼ˆåŠåŒå·¥ï¼Œå³å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¸èƒ½äº’ç›¸é€šä¿¡ï¼‰</li><li>æœåŠ¡å™¨é¦–å…ˆæ£€æŸ¥æŸ¥è¯¢ç¼“å­˜ï¼Œå¦‚æœå‘½ä¸­ç¼“å­˜ï¼Œåˆ™ç«‹åˆ»è¿”å›å­˜å‚¨åœ¨ç¼“å­˜ä¸­çš„ç»“æœï¼Œå¦åˆ™è¿›å…¥ä¸‹ä¸€é˜¶æ®µã€‚</li><li>æœåŠ¡å™¨è¿›è¡Œ SQL è§£æï¼ˆé€šè¿‡è¯­æ³•è§„åˆ™æ¥éªŒè¯å’Œè§£æï¼Œç”Ÿæˆè§£ææ ‘ï¼‰ã€é¢„å¤„ç†ï¼ˆæ£€æŸ¥è¦æŸ¥è¯¢çš„æ•°æ®è¡¨å’Œæ•°æ®åˆ—æ˜¯å¦å­˜åœ¨ï¼‰ã€å†ç”±ä¼˜åŒ–å™¨ç”Ÿæˆæœ€ä¼˜çš„æ‰§è¡Œè®¡åˆ’ã€‚</li><li>MySQL æ ¹æ®æ‰§è¡Œè®¡åˆ’ï¼Œè°ƒç”¨å­˜å‚¨å¼•æ“çš„ API æ¥æ‰§è¡ŒæŸ¥è¯¢ã€‚</li><li>å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ï¼ŒåŒæ—¶ç¼“å­˜æŸ¥è¯¢ç»“æœã€‚</li></ul><p>==ç®€å•æ¥è¯´ï¼Œæ‰§è¡Œè®¡åˆ’å°±æ˜¯MySQLæ ¹æ®è§£æã€å¤„ç†ã€ä¼˜åŒ–åç”Ÿæˆçš„è®¡åˆ’ã€‚==<img src="https://ws4.sinaimg.cn/large/006tKfTcgy1g1l1l6bkkfj313i0o4gok.jpg" alt="image-20190330192427534"></p><h4 id="ä½¿ç”¨EXPLAIN-1"><a href="#ä½¿ç”¨EXPLAIN-1" class="headerlink" title="ä½¿ç”¨EXPLAIN"></a>ä½¿ç”¨EXPLAIN</h4><p>â€‹    å…·ä½“ç”¨æ³•å¦‚ä¸‹<code>explain select * from table where id in( )</code>ï¼Œè¿”å›è¾“å‡ºç»“æœå¦‚ä¸‹ï¼ˆå®˜æ–¹ç½‘ç«™çš„é“¾æ¥å¦‚ä¸‹<a href="https://dev.mysql.com/doc/refman/5.5/en/explain-output.html" target="_blank" rel="noopener">https://dev.mysql.com/doc/refman/5.5/en/explain-output.html</a>ï¼‰</p><table><thead><tr><th>Column</th><th>Meaning</th></tr></thead><tbody><tr><td><a href="https://dev.mysql.com/doc/refman/5.5/en/explain-output.html#explain_id" target="_blank" rel="noopener"><code>id</code></a></td><td>The <code>SELECT</code> identifier</td></tr><tr><td><a href="https://dev.mysql.com/doc/refman/5.5/en/explain-output.html#explain_select_type" target="_blank" rel="noopener"><code>select_type</code></a></td><td>The <code>SELECT</code> type</td></tr><tr><td><a href="https://dev.mysql.com/doc/refman/5.5/en/explain-output.html#explain_table" target="_blank" rel="noopener"><code>table</code></a></td><td>The table for the output row</td></tr><tr><td><a href="https://dev.mysql.com/doc/refman/5.5/en/explain-output.html#explain_partitions" target="_blank" rel="noopener"><code>partitions</code></a></td><td>The matching partitions</td></tr><tr><td><a href="https://dev.mysql.com/doc/refman/5.5/en/explain-output.html#explain_type" target="_blank" rel="noopener"><code>type</code></a></td><td>The join type</td></tr><tr><td><a href="https://dev.mysql.com/doc/refman/5.5/en/explain-output.html#explain_possible_keys" target="_blank" rel="noopener"><code>possible_keys</code></a></td><td>The possible indexes to choose</td></tr><tr><td><a href="https://dev.mysql.com/doc/refman/5.5/en/explain-output.html#explain_key" target="_blank" rel="noopener"><code>key</code></a></td><td>The index actually chosen</td></tr><tr><td><a href="https://dev.mysql.com/doc/refman/5.5/en/explain-output.html#explain_key_len" target="_blank" rel="noopener"><code>key_len</code></a></td><td>The length of the chosen key</td></tr><tr><td><a href="https://dev.mysql.com/doc/refman/5.5/en/explain-output.html#explain_ref" target="_blank" rel="noopener"><code>ref</code></a></td><td>The columns compared to the index</td></tr><tr><td><a href="https://dev.mysql.com/doc/refman/5.5/en/explain-output.html#explain_rows" target="_blank" rel="noopener"><code>rows</code></a></td><td>Estimate of rows to be examined</td></tr><tr><td><a href="https://dev.mysql.com/doc/refman/5.5/en/explain-output.html#explain_filtered" target="_blank" rel="noopener"><code>filtered</code></a></td><td>Percentage of rows filtered by table condition</td></tr><tr><td><a href="https://dev.mysql.com/doc/refman/5.5/en/explain-output.html#explain_extra" target="_blank" rel="noopener"><code>Extra</code></a></td><td>Additional information</td></tr></tbody></table><p>è¿™é‡Œæˆ‘ä»¬æ³¨æ„ç‚¹æ˜¯select_type ã€typeã€possible_keysã€keyã€rowsã€Extraï¼ˆæ›´å¤šç»†èŠ‚å¯ä»¥æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼‰</p><p><code>select_type</code> : è¡¨ç¤ºäº†æŸ¥è¯¢çš„ç±»å‹ï¼Œå¸¸è§çš„æ˜¯SIMPLEï¼Œè¿™ä¸ªæ˜¯åœ¨æœ‰å­æŸ¥è¯¢ã€è”åˆæŸ¥è¯¢éœ€è¦æ³¨æ„çš„ã€‚</p><p><code>type</code> ï¼šè¿™ä¸ªå­—æ®µæ¯”è¾ƒé‡è¦, å®ƒæä¾›äº†åˆ¤æ–­æŸ¥è¯¢æ˜¯å¦é«˜æ•ˆçš„é‡è¦ä¾æ®ä¾æ®. é€šè¿‡ <code>type</code> å­—æ®µ, æˆ‘ä»¬åˆ¤æ–­æ­¤æ¬¡æŸ¥è¯¢æ˜¯ <code>å…¨è¡¨æ‰«æ</code> è¿˜æ˜¯ <code>ç´¢å¼•æ‰«æ</code> ç­‰. </p><p>æ ¹æ®æ€§èƒ½ï¼š</p><p>ALL &lt; index &lt; range ~ index_merge &lt; ref &lt; eq_ref &lt; const &lt; system</p><p>é™¤äº†ALLï¼Œå…¶ä»–éƒ½æ˜¯èµ°ç´¢å¼•</p><p><code>possible_keys</code>ï¼šè¡¨ç¤ºå¯ä»¥é€‰æ‹©çš„ç´¢å¼•</p><p><code>key</code>ï¼šè¡¨ç¤ºæ‰§è¡Œæ—¶å€™çœŸæ­£ä½¿ç”¨çš„ç´¢å¼•</p><p><code>ref</code> : è¯¥<code>ref</code>åˆ—æ˜¾ç¤ºå°†å“ªäº›åˆ—æˆ–å¸¸é‡ä¸åˆ—ä¸­æŒ‡å®šçš„ç´¢å¼•è¿›è¡Œæ¯”è¾ƒ(ä¾‹å¦‚è”åˆç´¢å¼•çš„æ—¶å€™ï¼Œå‘½ä¸­äº†å‡ ä¸ª)ï¼Œä»¥ <code>key</code>ä»è¡¨ä¸­é€‰æ‹©è¡Œã€‚</p><p><code>rows</code>ï¼šæ‰«æçš„è¡Œæ•°</p><p><code>Extra</code>ï¼šä¹Ÿæ˜¯æ¯”è¾ƒé‡è¦çš„ä¸€ä¸ªå­—æ®µï¼Œå¸¸è§çš„ç±»å‹å¦‚ä¸‹</p><p> Using filesortï¼Œè¡¨ç¤ºMySQLå¿…é¡»æ‰§è¡Œé¢å¤–çš„ä¼ é€’ä»¥æ‰¾å‡ºå¦‚ä½•æŒ‰æ’åºé¡ºåºæ£€ç´¢è¡Œã€‚</p><p>Using indexï¼Œä»…éœ€è¦ä»ç´¢å¼•æ ‘ä¸­è·å–ï¼Œä¾‹å¦‚é€šè¿‡ä¸»é”®æŸ¥è¯¢ï¼ˆèšåˆç´¢å¼•ç±»å‹ï¼Œæ‰€ä»¥ä¸»é”®ä¸Šå¸¦æœ‰keyçš„æ‰€æœ‰ä¿¡æ¯ï¼‰ï¼Œæˆ–è€…æ˜¯å‘½ä¸­ç´¢å¼•ï¼Œä¸”ä»…å–ç´¢å¼•ä¸Šçš„ç›¸å…³å­—æ®µã€‚</p><p>Using whereï¼Œè¡¨ç¤ºé™åˆ¶å“ªäº›è¡Œä¸ä¸‹ä¸€ä¸ªè¡¨åŒ¹é…æˆ–å‘é€åˆ°å®¢æˆ·ç«¯ã€‚ é™¤éç‰¹æ„æ‰“ç®—ä»è¡¨ä¸­è·å–æˆ–æ£€æŸ¥æ‰€æœ‰è¡Œï¼Œå¦åˆ™å¦‚æœExtraå€¼æ˜¯Using whereå¹¶ä¸”è¡¨è¿æ¥ç±»å‹ä¸ºALLæˆ–indexï¼Œåˆ™å¯ä»¥æ˜¯æŸ¥è¯¢æœ‰é—®é¢˜äº†ã€‚</p><h3 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h3><p>â€‹    æœ‰äº†ä¸Šè¿°ç›¸å…³çŸ¥è¯†ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨<code>explain select * from table where id in( )</code> æ¥è·å–ç›¸å…³ä¿¡æ¯åˆ†æï¼Œå¯ä»¥å‘ç° typeä¸ºrange ,Extra ä¸ºUsing where ï¼Œæ˜¯æœ‰èµ°ç´¢å¼•çš„ã€‚</p><p><img src="https://ws1.sinaimg.cn/large/006tKfTcgy1g1l35it2ghj325a03saat.jpg" alt="image-20190330201851186"></p><h3 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a>æ‰©å±•</h3><p>â€‹    æœ€åï¼Œå†ç®€å•æ‰©å±•ä¸€äº›MYSQLç›¸å…³çŸ¥è¯†ã€‚</p><h4 id="å¦‚ä½•åˆ›å»ºé«˜æ€§èƒ½çš„ç´¢å¼•"><a href="#å¦‚ä½•åˆ›å»ºé«˜æ€§èƒ½çš„ç´¢å¼•" class="headerlink" title="å¦‚ä½•åˆ›å»ºé«˜æ€§èƒ½çš„ç´¢å¼•"></a>å¦‚ä½•åˆ›å»ºé«˜æ€§èƒ½çš„ç´¢å¼•</h4><h5 id="ç´¢å¼•ç±»å‹"><a href="#ç´¢å¼•ç±»å‹" class="headerlink" title="ç´¢å¼•ç±»å‹"></a>ç´¢å¼•ç±»å‹</h5><p>â€‹    å…³äºç´¢å¼•ç±»å‹ï¼Œæœ‰b-tree,å“ˆå¸Œ,r-tree,  éœ€è¦é‡ç‚¹å…³æ³¨Innodbå¼•æ“çš„ç´¢å¼•ç±»å‹b-tree ,</p><p>äº†è§£èšç°‡ç´¢å¼•ï¼Œå¯ä»¥å…¨å€¼åŒ¹é…ã€åŒ¹é…æœ€å·¦å‰ç¼€ï¼ˆä¾‹å¦‚ï¼Œåœ¨ä½¿ç”¨likeçš„æ—¶å€™ â€œa%â€ ç´¢å¼•ä¼šç”Ÿæ•ˆï¼Œè€Œåœ¨ä½¿ç”¨â€œ%aâ€çš„æ—¶å€™å°±ä¸ä¼šç”Ÿæ•ˆï¼‰ã€åŒ¹é…å•åˆ—å‰ç¼€ã€åŒ¹é…èŒƒå›´å€¼ã€åªè®¿é—®ç´¢å¼•çš„æŸ¥è¯¢ï¼ˆè¦†ç›–ç´¢å¼•ï¼Œç´¢å¼•è‡ªèº«åŒ…å«äº†æŸ¥è¯¢ç›¸å…³ä¿¡æ¯ï¼Œä¸ç”¨å†é€šè¿‡æŸ¥è¯¢ä¸»é”®è·å–ä¿¡æ¯ï¼‰ã€‚</p><h5 id="ç´¢å¼•çš„ä¼˜ç‚¹"><a href="#ç´¢å¼•çš„ä¼˜ç‚¹" class="headerlink" title="ç´¢å¼•çš„ä¼˜ç‚¹"></a>ç´¢å¼•çš„ä¼˜ç‚¹</h5><ul><li>ç´¢å¼•å¤§å¤§å‡å°‘äº†æœåŠ¡å™¨éœ€è¦æ‰«æçš„æ•°æ®é‡</li><li>ç´¢å¼•å¯ä»¥å¸®åŠ©æœåŠ¡å™¨é¿å…æ’åºå’Œä¸´æ—¶è¡¨</li><li>ç´¢å¼•å¯ä»¥å°†éšæœºI/Oå˜æˆé¡ºåºI/O</li></ul><p>å½“ç„¶ç´¢å¼•å¹¶ä¸æ˜¯ä¸‡èƒ½çš„ â€˜é“¶å¼¹â€™ï¼Œéœ€è¦è€ƒè™‘å…¶é€‰æ‹©çš„ä¾æ®ï¼ˆ è¡¨çš„å¤§å° ã€æ•°æ®é‡ï¼‰ ï¼Œä½¿ç”¨çš„æ–¹å¼ï¼ˆæ€ä¹ˆä½¿ç”¨è”åˆç´¢å¼•ç­‰ï¼‰ä»¥åŠå¸¦æ¥çš„é—®é¢˜ï¼ˆé¢‘ç¹å†™è¡¨çš„åŒæ—¶ä¹Ÿä¼šå¸¦æ¥ç´¢å¼•é‡å»ºã€ä¿®æ”¹çš„æŸè€—ï¼Œç´¢å¼•æœ¬èº«çš„å­˜å‚¨ç©ºé—´å ç”¨ï¼‰</p><h4 id="ä¸ºä»€ä¹ˆä¼šæ…¢æŸ¥è¯¢"><a href="#ä¸ºä»€ä¹ˆä¼šæ…¢æŸ¥è¯¢" class="headerlink" title="ä¸ºä»€ä¹ˆä¼šæ…¢æŸ¥è¯¢"></a>ä¸ºä»€ä¹ˆä¼šæ…¢æŸ¥è¯¢</h4><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ç±»</p><ul><li>æ˜¯å¦è¯·æ±‚äº†ä¸éœ€è¦çš„æ•°æ®ï¼ˆå¸¸è§ select * ï¼Œæ³¨æ„è¿™ä¸€å°ç»†èŠ‚ï¼Œå¯èƒ½ä¼šå¸¦æ¥ä¾‹å¦‚æ•°æ®è¿”å›çš„æ—¶å€™ä¼šæŸè€—æ—¶é—´ï¼Œä½¿ç”¨ä¸´æ—¶è¡¨ç­‰é—®é¢˜ï¼‰</li><li>æ‰«æé¢å¤–çš„è®°å½•ï¼ˆé€šå¸¸æ˜¯æœªèµ°ç´¢å¼•ï¼Œæ­£ç¡®ä½¿ç”¨ç´¢å¼•çš„å§¿åŠ¿ï¼‰</li></ul><p>éæ­£å¸¸æƒ…å†µä¸‹ï¼Œå³ä¸€äº›éå¯æ§å› ç´  ï¼Œé”çš„å ç”¨ï¼Œè¿æ¥æ•°è€—å°½ç­‰ã€‚</p><p>å‚è€ƒï¼š</p><ul><li>é«˜æ€§èƒ½MySQL</li><li><a href="https://dev.mysql.com/doc/refman/5.5/en/execution-plan-information.html" target="_blank" rel="noopener">8.8 Understanding the Query Execution Plan</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®°ä¸€æ¬¡Broken pipeé—®é¢˜çš„æ€è€ƒ</title>
      <link href="/2019/03/26/%E8%AE%B0%E4%B8%80%E6%AC%A1Broken-pipe%E9%97%AE%E9%A2%98%E7%9A%84%E6%80%9D%E8%80%83/"/>
      <url>/2019/03/26/%E8%AE%B0%E4%B8%80%E6%AC%A1Broken-pipe%E9%97%AE%E9%A2%98%E7%9A%84%E6%80%9D%E8%80%83/</url>
      
        <content type="html"><![CDATA[<p>â€‹    ä»Šå¤©é‡åˆ°ä¸€ä¸ªBroken pipeçš„é—®é¢˜ï¼Œè§‰å¾—æŒºæœ‰æ„æ€çš„å°±è®°å½•ä¸€ä¸‹ï¼Œå› ä¸ºè¿™æ•´ä¸ªè¿‡ç¨‹è¿˜æ˜¯æ¶‰åŠæŒºå¤šç›¸å…³çŸ¥è¯†çš„ï¼ˆnginx ã€tomcat ã€å†…å­˜æŸ¥çœ‹ç­‰ï¼‰ï¼Œä¾‹å¦‚æ˜¯ä¸ºäº†æ‰¾åˆ°è¿è¡Œæœºå™¨ipï¼Œé€šè¿‡æŸ¥è¯¢nginxçš„access.log è·å–é”™è¯¯æœºå™¨ipï¼Œ æ”¶è·æŒºå¤šã€‚</p><a id="more"></a><h2 id="ä¸šåŠ¡åœºæ™¯"><a href="#ä¸šåŠ¡åœºæ™¯" class="headerlink" title="ä¸šåŠ¡åœºæ™¯"></a>ä¸šåŠ¡åœºæ™¯</h2><p>â€‹    springmvc å‘é€è¯·æ±‚ï¼Œæ ¹æ®ç­›é€‰æŸ¥è¯¢MongoDB ï¼Œç„¶åå°†æŸ¥è¯¢ç»“æœå¯¼å‡ºExeclï¼Œå“åº”æ—¶é—´æ¯”è¾ƒä¹…ï¼Œ</p><p>ç„¶åå°±è¿”å›é”™è¯¯ã€‚</p><h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><pre><code class="java">Caused by: java.net.SocketException: Broken pipe   at java.net.SocketOutputStream.socketWrite0(Native Method) ~[?:1.6.0_25]   at java.net.SocketOutputStream.socketWrite(SocketOutputStream.java:92) ~[?:1.6.0_25]   at java.net.SocketOutputStream.write(SocketOutputStream.java:136) ~[?:1.6.0_25]   at org.apache.coyote.http11.InternalOutputBuffer.realWriteBytes(InternalOutputBuffer.java:216) ~[tomcat-coyote.jar:7.0.82]   at org.apache.tomcat.util.buf.ByteChunk.flushBuffer(ByteChunk.java:487) ~[tomcat-coyote.jar:7.0.82]   at org.apache.tomcat.util.buf.ByteChunk.append(ByteChunk.java:373) ~[tomcat-coyote.jar:7.0.82]   at org.apache.coyote.http11.InternalOutputBuffer$OutputStreamOutputBuffer.doWrite(InternalOutputBuffer.java:239) ~[tomcat-coyote.jar:7.0.82]   at org.apache.coyote.http11.filters.IdentityOutputFilter.doWrite(IdentityOutputFilter.java:93) ~[tomcat-coyote.jar:7.0.82]   at org.apache.coyote.http11.AbstractOutputBuffer.doWrite(AbstractOutputBuffer.java:192) ~[tomcat-coyote.jar:7.0.82]   at org.apache.coyote.Response.doWrite(Response.java:506) ~[tomcat-coyote.jar:7.0.82]   at org.apache.catalina.connector.OutputBuffer.realWriteBytes(OutputBuffer.java:405) ~[catalina.jar:7.0.82]   ... 67 more</code></pre><h2 id="çŒœæµ‹æ€è·¯"><a href="#çŒœæµ‹æ€è·¯" class="headerlink" title="çŒœæµ‹æ€è·¯"></a>çŒœæµ‹æ€è·¯</h2><p>â€‹    å› ä¸ºåœ¨é€‰æ‹©å½“å¤©æ•°æ®çš„æ—¶å€™å¯¼å‡ºæ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œè€Œé€‰æ‹©7å¤©çš„æ—¶å€™å°±æŠ¥é”™äº†ã€‚åˆæ­¥çš„ç°çŠ¶è®¤å®šå°±æ˜¯å“åº”æ—¶é—´é•¿ï¼Œæˆ–è€…æ–‡ä»¶è¿‡å¤§å¯¼è‡´ã€‚</p><p>çŒœæµ‹ä¸€ï¼š æŸ¥è¯¢å‡ºæ¥çš„æ•°æ®å¤ªå¤šï¼Œå¯¼è‡´å†…å­˜ä¸è¶³ï¼Œä¸€ç›´full gc ï¼Œå¯¼è‡´å“åº”å˜æ…¢</p><p>â€‹    é€šè¿‡<code>jstat  -gcutil  pid</code>    å‘½ä»¤æŸ¥çœ‹ï¼Œå‘ç°å¹¶æ²¡æœ‰åƒæ»¡å†…å­˜ï¼Œåªæ˜¯young gc é¢‘ç¹äº†ç‚¹ã€‚</p><p>çŒœæµ‹äºŒï¼š æŸ¥è¯¢å‡ºæ¥çš„æ•°æ®å¤ªå¤§ï¼Œtomcatå®¹å™¨æœ‰é™åˆ¶</p><p>â€‹    åˆæƒ³æ˜¯å¦æ˜¯å¯¼å‡ºæ–‡ä»¶å¤ªå¤§ï¼Œtomcat ä¼šå¯¹è¿™ä¸ªé™åˆ¶ï¼Œç„¶åå»googleäº†ä¸€æ³¢â€˜tomcat response body size limitâ€™ å‘ç°å¹¶æ²¡æœ‰ç›¸å…³èµ„æ–™</p><p>æœ‰çš„åªæ˜¯tomcatä¼šå¯¹post è¯·æ±‚bodyåšé™åˆ¶ï¼Œé»˜è®¤æ˜¯2m</p><pre><code>Having said that*, if this is the issue, you should have got an exception on the lines of `Post data too big` in tomcat</code></pre><p>äºæ˜¯ä¸Šå®˜ç½‘<a href="http://tomcat.apache.org/tomcat-7.0-doc/connectors.html#HTTP" target="_blank" rel="noopener">http://tomcat.apache.org/tomcat-7.0-doc/connectors.html#HTTP</a> ï¼ˆä»é”™è¯¯ä¿¡æ¯é‡Œè·å–åˆ°çš„ç‰ˆæœ¬æ˜¯7.0.82ï¼‰ ä¹Ÿæ²¡æœ‰å‘ç°ä»€ä¹ˆè¯´æ˜ã€‚ï¼ˆç®€ç•¥ç¿»äº†ä¸€ä¸‹ï¼Œæˆ–è®¸æ˜¯æ²¡æ‰¾åˆ°ï¼‰</p><p><a href="http://tomcat.apache.org/tomcat-7.0-doc/config/http.html" target="_blank" rel="noopener">http://tomcat.apache.org/tomcat-7.0-doc/config/http.html</a>  ,ï¼ˆè¿™é‡Œå¯ä»¥å…³æ³¨ä¸‹timeoutç›¸å…³é…ç½®ï¼Œå¦å¤–ä¹Ÿå¯ä»¥çœ‹ä¸‹tomcatçš„å¼‚å¸¸å®šä¹‰ï¼‰</p><table><thead><tr><th><strong>Attribute</strong></th><th><strong>Description</strong></th></tr></thead><tbody><tr><td><code>maxPostSize</code></td><td>The maximum size in bytes of the POST which will be handled by the container FORM URL parameter parsing. The limit can be disabled by setting this attribute to a value less than zero. If not specified, this attribute is set to 2097152 (2 megabytes). Note that the <a href="http://tomcat.apache.org/tomcat-7.0-doc/config/filter.html#Failed_Request_Filter" target="_blank" rel="noopener"><code>FailedRequestFilter</code></a> can be used to reject requests that exceed this limit.</td></tr></tbody></table><h2 id="è§£å†³è¿‡ç¨‹"><a href="#è§£å†³è¿‡ç¨‹" class="headerlink" title="è§£å†³è¿‡ç¨‹"></a>è§£å†³è¿‡ç¨‹</h2><h4 id="Tomcatæºç "><a href="#Tomcatæºç " class="headerlink" title="Tomcatæºç "></a>Tomcatæºç </h4><p>äºæ˜¯ç›´æ¥ä¸‹è½½æºç æŸ¥çœ‹ï¼Œé€šè¿‡åœ¨mavené…ç½®</p><ol><li><pre><code> &lt;dependency&gt;     &lt;groupId&gt;org.apache.tomcat.embed&lt;/groupId&gt;     &lt;artifactId&gt;tomcat-embed-core&lt;/artifactId&gt;     &lt;version&gt;7.0.82&lt;/version&gt; &lt;/dependency&gt;</code></pre><p> ç„¶åå®šä½åˆ°æŠ¥é”™ä½ç½®org.apache.coyote.http11.InternalOutputBuffer.OutputStreamOutputBuffer#doWrite</p><p> <img src="https://ws4.sinaimg.cn/large/006tKfTcgy1g1g9hxu9n8j31040fo0v2.jpg" alt="image-20190326161033556"></p><p>è¿™é‡Œçš„socketBufferï¼Œå®šä¹‰å¦‚ä¸‹</p></li></ol><pre><code class="javaj">/** * Socket buffer. */private ByteChunk socketBuffer;</code></pre><p>æŸ¥çœ‹ByteChunkçš„å®šä¹‰ï¼Œå‘ç°å®ƒæ˜¯å°è£…äº†ä¸€å±‚byte[]</p><pre><code>- This class is used to represent a chunk of bytes, and- utilities to manipulate byte[].</code></pre><p>å†é€šè¿‡é”™è¯¯ä¿¡æ¯å®šä½åˆ° org.apache.tomcat.util.buf.ByteChunk#append(byte[], int, int)</p><p><img src="https://ws4.sinaimg.cn/large/006tKfTcgy1g1g0k4t1gkj315a0fo40s.jpg" alt="image-20190326110116891"></p><p>ç„¶åå‘ç°æœ‰limit !!</p><p>è¿›å»çœ‹ï¼Œå‘ç°å…¶å®åªæ˜¯å¯¹limitåšäº†é•¿åº¦é™åˆ¶ï¼Œå¹¶ä¸ä¼šå¯¼è‡´ä»€ä¹ˆå¼‚å¸¸ï¼Œè¿™é‡Œlimité»˜è®¤æ˜¯-1ï¼Œå³æ²¡æœ‰é™åˆ¶ï¼Œå³ä½¿è®¾ç½®äº†ä¹Ÿåªæ˜¯å†™å—çš„æ—¶å€™é™åˆ¶å¤§å°ï¼Œå¹¶ä¸ä¼šå¯¼è‡´å¼‚å¸¸ã€‚</p><pre><code class="java">/** * Make space for len chars. If len is small, allocate a reserve space too. * Never grow bigger than limit. */public void makeSpace(int count) {    byte[] tmp = null;    int newSize;    int desiredSize=end + count;    // Can&#39;t grow above the limit    if( limit &gt; 0 &amp;&amp;        desiredSize &gt; limit) {        desiredSize=limit;    }    if( buff==null ) {        if( desiredSize &lt; 256 )         {            desiredSize=256; // take a minimum        }        buff=new byte[desiredSize];    }    // limit &lt; buf.length ( the buffer is already big )    // or we already have space XXX    if( desiredSize &lt;= buff.length ) {        return;    }    // grow in larger chunks    if( desiredSize &lt; 2 * buff.length ) {        newSize= buff.length * 2;        if( limit &gt;0 &amp;&amp;            newSize &gt; limit ) {            newSize=limit;        }        tmp=new byte[newSize];    } else {        newSize= buff.length * 2 + count ;        if( limit &gt; 0 &amp;&amp;            newSize &gt; limit ) {            newSize=limit;        }        tmp=new byte[newSize];    }    System.arraycopy(buff, start, tmp, 0, end-start);    buff = tmp;    tmp = null;    end=end-start;    start=0;}</code></pre><p>å†æ ¹æ®é”™è¯¯ä¿¡æ¯ å®šä½åˆ°å¦‚ä¸‹</p><p><img src="https://ws4.sinaimg.cn/large/006tKfTcgy1g1g0strvuej31cm0pk42c.jpg" alt="image-20190326110936819"></p><p>å‘ç°æ˜¯åœ¨ ä»æœåŠ¡å‘å®¢æˆ·ç«¯å†™bufferçš„æ—¶å€™å‡ºé”™ã€‚äºæ˜¯çŒœæµ‹æ˜¯ç”±äº<strong>æŸ¥è¯¢æ—¶é—´è¿‡é•¿ï¼Œ å®¢æˆ·ç«¯ç”±äºè¶…æ—¶æ–­å¼€ï¼ŒæœåŠ¡ç«¯è¿˜åœ¨å†™æ•°æ®ï¼Œ</strong>è¿™ä¸ªæ—¶å€™å°±ä¼šæŠ¥å‡ºè¿™ä¸ªé”™è¯¯ã€‚</p><h4 id="è¶…æ—¶æ—¶é—´"><a href="#è¶…æ—¶æ—¶é—´" class="headerlink" title="è¶…æ—¶æ—¶é—´"></a>è¶…æ—¶æ—¶é—´</h4><ol><li>æŸ¥çœ‹å®¢æˆ·ç«¯çš„è¶…æ—¶æ—¶é—´ï¼Œä½¿ç”¨çš„æ˜¯chromï¼ˆ<a href="https://cs.chromium.org/chromium/src/net/socket/client_socket_pool.cc?sq=package:chromium&amp;l=25" target="_blank" rel="noopener">https://cs.chromium.org/chromium/src/net/socket/client_socket_pool.cc?sq=package:chromium&amp;l=25</a>ï¼‰</li></ol><p><img src="https://ws2.sinaimg.cn/large/006tKfTcgy1g1g1lpoleaj31g50u07df.jpg" alt="image-20190326113723854"></p><p>â€‹    é»˜è®¤æ˜¯5åˆ†é’Ÿï¼Œå®é™…è¯·æ±‚å¹¶æ²¡æœ‰æ€ä¹ˆé•¿ï¼Œç­‰å¾…ä¸ªåç§’å·¦å³å°±è¿”å›é”™è¯¯äº†</p><ol start="2"><li>äºæ˜¯æƒ³åˆ°è¿˜æœ‰ä¸ªnginxé…ç½®ï¼ŒæŸ¥çœ‹å‘ç°é…ç½®ä¸º</li></ol><p>keepalive_timeout  8 8;</p><p>è¿™é‡Œé€šè¿‡æŸ¥è¯¢ç›¸å…³èµ„æ–™å‘ç°</p><p>â€‹    </p><p>keepalive_timeout timeout [header_timeout];</p><p>â€‹    ç¬¬ä¸€ä¸ªå‚æ•°ï¼šè®¾ç½®keep-aliveå®¢æˆ·ç«¯è¿æ¥åœ¨æœåŠ¡å™¨ç«¯ä¿æŒå¼€å¯çš„è¶…æ—¶å€¼ï¼ˆé»˜è®¤75sï¼‰ï¼›å€¼ä¸º0ä¼šç¦ç”¨keep-aliveå®¢æˆ·ç«¯è¿æ¥ï¼›</p><p>â€‹    ç¬¬äºŒä¸ªå‚æ•°ï¼šå¯é€‰ã€åœ¨å“åº”çš„headeråŸŸä¸­è®¾ç½®ä¸€ä¸ªå€¼â€œKeep-Alive: timeout=timeâ€ï¼›é€šå¸¸å¯ä»¥ä¸ç”¨è®¾ç½®ï¼›</p><p>â€‹    æ³¨ï¼škeepalive_timeouté»˜è®¤75s</p><p>â€‹    æ‰€ä»¥è¿™é‡Œçš„è¶…æ—¶æ—¶é—´æ˜¯8sï¼Œäºæ˜¯ä¿®æ”¹keepalive_timeoutä¸º60såï¼Œåˆ·æ–°é…ç½®ï¼Œé‡æ–°æµ‹è¯•ï¼Œå‘ç°å¯ä»¥å¯¼å‡ºäº†ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> tomcat </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>3æœˆç¬¬ä¸‰å‘¨çŸ¥è¯†ç‚¹è®°å½•</title>
      <link href="/2019/03/24/3%E6%9C%88%E7%AC%AC%E4%B8%89%E5%91%A8%E7%9F%A5%E8%AF%86%E7%82%B9%E8%AE%B0%E5%BD%95/"/>
      <url>/2019/03/24/3%E6%9C%88%E7%AC%AC%E4%B8%89%E5%91%A8%E7%9F%A5%E8%AF%86%E7%82%B9%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<p>### </p><p>3æœˆ ç¬¬ä¸‰å‘¨ 18-24 è®°å½•</p><p>â€‹    å¤ä¹ Web</p><p>â€‹        Model-View-Controller å»¶è¿Ÿ</p><p>â€‹        Servlet API (<a href="https://jcp.org/en/jsr/detail?id=340" target="_blank" rel="noopener">JSR 340</a>)  å»¶è¿Ÿ</p><p>â€‹        WebSocket API (<a href="https://www.jcp.org/en/jsr/detail?id=356" target="_blank" rel="noopener">JSR 356</a>)  æš‚ä¸å…³å¿ƒ</p><p>â€‹    MQ : JMS (<a href="https://jcp.org/en/jsr/detail?id=914" target="_blank" rel="noopener">JSR 914</a>)</p><p>â€‹    RPC:RMI</p><p>å½“ä½ å‘ç°è‡ªå·±çš„æ‰åæ’‘ä¸èµ·é‡å¿ƒæ—¶ï¼Œå°±è¯·å®‰é™ä¸‹æ¥å­¦ä¹ å§</p><a id="more"></a><h2 id="å‘¨ä¸€"><a href="#å‘¨ä¸€" class="headerlink" title="å‘¨ä¸€"></a>å‘¨ä¸€</h2><p>JTA </p><p>åˆ†è€Œæ²»ä¹‹çš„æ€æƒ³  ã€ å¤šçº¿ç¨‹ã€å¤§æ•°æ® </p><p>â€‹    è´Ÿè½½å‡è¡¡ è§£å†³å•æœºå¤„ç†é—®é¢˜  å‚ç›´æ‰©å±•ï¼ˆå•æœºæœºå™¨æ€§èƒ½ï¼‰å’Œæ°´å¹³æ‰©å±•ï¼ˆå¢åŠ å¤šå°æœºå™¨åˆ†æ‹…ï¼‰</p><p>â€‹    è´Ÿè½½å‡è¡¡ç­–ç•¥çš„ä¼˜åŠ£åŠå…¶å®ç°çš„éš¾æ˜“ç¨‹åº¦æœ‰ä¸¤ä¸ªå…³é”®å› ç´ ï¼šè´Ÿè½½å‡è¡¡ç®—æ³•ï¼›å¯¹ç½‘ç»œç³»ç»ŸçŠ¶å†µçš„æ£€æµ‹æ–¹å¼å’Œèƒ½åŠ›ã€‚</p><p>â€‹    è½®è®­ ã€åŠ æƒã€æœ€å°‘è¿æ¥æ•°ã€å“åº”é€Ÿåº¦ã€éšæœºã€å¤„ç†èƒ½åŠ›</p><p>â€‹    ç¡¬ä»¶ï¼ˆDNS ï¼‰å’Œè½¯ä»¶</p><p>â€‹    LVSçš„NATå’ŒDRã€‚è´£ä»»åˆ†ç¦»</p><p><a href="https://www.cnblogs.com/kevingrace/p/6137881.html" target="_blank" rel="noopener">https://www.cnblogs.com/kevingrace/p/6137881.html</a></p><p>ç½‘ç»œæ¨¡å‹</p><p><a href="https://juejin.im/post/59a0472f5188251240632f92" target="_blank" rel="noopener">https://juejin.im/post/59a0472f5188251240632f92</a></p><p>åå°„å’Œå­—èŠ‚ç ï¼ˆASM AOPæ€æƒ³ï¼‰</p><p><a href="http://www.fanyilun.me/2015/10/29/Java%E5%8F%8D%E5%B0%84%E5%8E%9F%E7%90%86/" target="_blank" rel="noopener">http://www.fanyilun.me/2015/10/29/Java%E5%8F%8D%E5%B0%84%E5%8E%9F%E7%90%86/</a></p><h2 id="å‘¨äºŒ"><a href="#å‘¨äºŒ" class="headerlink" title="å‘¨äºŒ"></a>å‘¨äºŒ</h2><p>jvm <a href="https://blog.csdn.net/zhoufanyang_china/article/details/54601311,å¯¹è±¡" target="_blank" rel="noopener">https://blog.csdn.net/zhoufanyang_china/article/details/54601311,å¯¹è±¡</a><br>    å¯¹è±¡å¤´ ä¿¡æ¯å’ŒæŒ‡é’ˆ<br>    å®ä¾‹æ•°æ®<br>    å¯¹é½å¡«å……</p><p>é™æµ</p><p>redis+luaåœ¨é›†ç¾¤é‡Œæ§åˆ¶æ–¹æ³•çš„è°ƒç”¨é‡äº†</p><p>å•æœº ä»¤ç‰Œï¼ˆä¹Ÿå¯ä»¥å…¨å±€å‘ç‰Œï¼‰ æˆ–è€…jucä¿¡å·é‡ ã€ guavaçš„ limitrater</p><p>mysqlç‰ˆæœ¬ã€å­¦ä¹ </p><p>mysql sending data</p><p>explain</p><p>iostat IOPS</p><p> mysql: show processlist è¯¦è§£</p><p><a href="https://zhuanlan.zhihu.com/p/30743094" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/30743094</a></p><h2 id="å‘¨ä¸‰"><a href="#å‘¨ä¸‰" class="headerlink" title="å‘¨ä¸‰"></a>å‘¨ä¸‰</h2><p>JMM è§„èŒƒ <a href="https://www.jcp.org/en/jsr/detail?id=133" target="_blank" rel="noopener">https://www.jcp.org/en/jsr/detail?id=133</a></p><p><a href="http://www.fanyilun.me/2015/10/29/Java%E5%8F%8D%E5%B0%84%E5%8E%9F%E7%90%86/" target="_blank" rel="noopener">http://www.fanyilun.me/2015/10/29/Java%E5%8F%8D%E5%B0%84%E5%8E%9F%E7%90%86/</a></p><p>Spring è‡ªå®šä¹‰æ³¨è§£</p><p><a href="https://apollochen123.github.io/2018/05/25/%E7%94%B1%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3%E6%89%AB%E6%8F%8F%E7%94%9F%E6%88%90SpringBean%E5%85%A8%E8%BF%87%E7%A8%8B/" target="_blank" rel="noopener">https://apollochen123.github.io/2018/05/25/%E7%94%B1%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3%E6%89%AB%E6%8F%8F%E7%94%9F%E6%88%90SpringBean%E5%85%A8%E8%BF%87%E7%A8%8B/</a></p><p>jdkä»‹ç»<br><a href="https://www.jianshu.com/p/f98c3acd8df8" target="_blank" rel="noopener">https://www.jianshu.com/p/f98c3acd8df8</a></p><p>ç¦»èŒ ç“¶é¢ˆå’Œè–ªèµ„</p><p>ã€Šæœªæ¥æ¶æ„ï¼šä»æœåŠ¡åŒ–åˆ°äº‘åŸç”Ÿã€‹</p><p>springboot  :<a href="http://blog.yuqiyu.com/" target="_blank" rel="noopener">http://blog.yuqiyu.com/</a></p><p>çº¿ç¨‹ï¼Ÿ    </p><p><a href="https://mp.weixin.qq.com/s/2ZjgLI3lgJJjpAjPdb9XSw" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/2ZjgLI3lgJJjpAjPdb9XSw</a></p><h2 id="å‘¨å››"><a href="#å‘¨å››" class="headerlink" title="å‘¨å››"></a>å‘¨å››</h2><p>å…¨å±€å¼‚å¸¸å¤„ç†â€”&gt;å¸¸ç”¨æ³¨è§£</p><p>@ControllerAdvice</p><p>@ResponseStatus </p><p>@ExceptionHandler</p><p>å‹ç¼©åè®®</p><p>Protocol Buffers - PBåè®®æ¦‚è¿°</p><p>å¦‚ä½•éªŒè¯ java çš„åŒäº²å§”æ´¾æœºåˆ¶</p><p>è™šæ‹Ÿæœº</p><p>æµ‹è¯•</p><p><a href="https://www.cnkirito.moe/java-jmh/" target="_blank" rel="noopener">https://www.cnkirito.moe/java-jmh/</a></p><p><a href="https://www.zhihu.com/question/58735131" target="_blank" rel="noopener">https://www.zhihu.com/question/58735131</a></p><h2 id="å‘¨äº”"><a href="#å‘¨äº”" class="headerlink" title="å‘¨äº”"></a>å‘¨äº”</h2><p>https</p><p><a href="https://www.jianshu.com/p/b0b6b88fe9fe" target="_blank" rel="noopener">https://www.jianshu.com/p/b0b6b88fe9fe</a></p><p>ç»Ÿä¸€ç‰ˆæœ¬ç®¡ç†</p><p><a href="https://maven.apache.org/maven-ci-friendly.html" target="_blank" rel="noopener">https://maven.apache.org/maven-ci-friendly.html</a></p><p>spring åˆå§‹åŒ–</p><p>Springboot å·¥ç¨‹</p><p>jpa <a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repository-query-keywords" target="_blank" rel="noopener">https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repository-query-keywords</a></p><p>å‘¨å…­æ—¥æ€»ç»“</p><ul><li style="list-style: none"><input type="checkbox"> hibernateåå°„è¿ç”¨åœºæ™¯ï¼Ÿ</li><li style="list-style: none"><input type="checkbox"> mybatiså’Œhibernateï¼Ÿ</li><li style="list-style: none"><input type="checkbox"> Spring ä¸€ä¸ªè¯·æ±‚ä¸€ä¸ªçº¿ç¨‹ï¼Ÿçº¿ç¨‹æ± ï¼Ÿ</li><li style="list-style: none"><input type="checkbox"> springè§‚å¯Ÿè€…æ¨¡å¼æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿå…·ä½“å›è°ƒæ–¹å¼ï¼Ÿ</li><li style="list-style: none"><input type="checkbox"> ä¸ºä»€ä¹ˆæŠ›å¼‚å¸¸ï¼Œè€Œä¸æ˜¯è¿”å›ä¸€ä¸ªçŠ¶æ€ç ï¼Ÿ ç»Ÿä¸€å¤„ç†ï¼Ÿæ€§èƒ½å½±å“ï¼Ÿ</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> week </tag>
            
            <tag> hide </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Expert One-on-One J2EE Development without EJB</title>
      <link href="/2019/03/10/Note_Expert%20One-on-One-J2EE-Development-without-EJB/"/>
      <url>/2019/03/10/Note_Expert%20One-on-One-J2EE-Development-without-EJB/</url>
      
        <content type="html"><![CDATA[<p>é˜…è¯»çš„ç›®çš„ï¼Ÿæˆ‘æƒ³è¦ä»ä¸­è·å¾—ä»€ä¹ˆï¼Ÿ</p><p>â€‹    æ¶æ„å¸ˆçš„æ€ç»´ï¼Œå½“ä¸€ä¸ªæ¡†æ¶ä¸ç¬¦åˆä¸»æµæ—¶å€™æ˜¯æ€ä¹ˆæ€è€ƒçš„ï¼Œspringæ˜¯ä¸ºè§£å†³ä»€ä¹ˆé—®é¢˜å‡ºç°çš„ï¼Ÿ</p><p>â€‹    springç›¸å…³çš„å‘å±•å†å²</p><ul><li>ä¸ç¬¦åˆçš„åŸå›   </li><li>åˆ†ææˆ‘ä»¬çœŸæ­£éœ€è¦çš„æ˜¯ä»€ä¹ˆã€‚</li><li>æ›¿ä»£æ–¹æ¡ˆï¼Œè§£å†³æ–¹æ³•</li></ul><a id="more"></a><h3 id="Chapeter-1"><a href="#Chapeter-1" class="headerlink" title="Chapeter 1"></a>Chapeter 1</h3><p>Why  without ï¼Ÿ</p><h4 id="EJBå­˜åœ¨çš„é—®é¢˜"><a href="#EJBå­˜åœ¨çš„é—®é¢˜" class="headerlink" title="EJBå­˜åœ¨çš„é—®é¢˜"></a>EJBå­˜åœ¨çš„é—®é¢˜</h4><ul><li>EJBè§„èŒƒä¸­çš„ä¸€äº›éƒ¨åˆ†å·²ç»è¿‡æ—¶,J2SE1.3å¼•å…¥çš„åŠ¨æ€ä»£ç†(dynamicproxy)</li><li>EJBå’ŒRMIä¹‹é—´é‚£ç§ä¼ ç»Ÿçš„ç´§å¯†å…³ç³»ä¹Ÿå¼€å§‹æ˜¾å¾—æœ‰äº›ä¸åˆæ—¶å®œ(local å’Œ remote çš„è°ƒç”¨ï¼Ÿ)è¿™ä¸€æ–¹é¢æ˜¯å› ä¸ºwebservices çš„è¿…é€Ÿå‘å±•ï¼Œå¦ä¸€æ–¹é¢æ˜¯å› ä¸ºäººä»¬å‘ç°:å¾ˆå¤šæ—¶å€™ EJB åªéœ€è¦æœ¬åœ°æ¥å£</li><li>EJB æœ€å–„äºå®ç°ä¸šåŠ¡å¯¹è±¡åˆ†å¸ƒçš„ä½“ç³»ç»“æ„ï¼Œç„¶è€Œè¿™ç§ä½“ç³»ç»“æ„ç©¶ç«Ÿæœ‰å¤šå¤§ç¨‹åº¦çš„æ™®éæ€§</li><li>SLSB ï¼ˆæ— çŠ¶æ€session beanï¼‰å’Œ MDB ä½¿ç”¨è¾ƒå¤šï¼Œæ•´ä¸ªå®¹å™¨æˆæœ¬é«˜æ˜‚</li><li>EJBçš„å¤æ‚æ€§ï¼ŒEJBè§„èŒƒçš„å¤æ‚æ€§ -&gt;å¼€å‘æ•ˆç‡</li><li>TDDæµè¡Œ ï¼Œéš¾ä»¥æµ‹è¯•</li><li>å¯¹äº EJB è‡´åŠ›è§£å†³çš„ä¸­é—´ä»¶é—®é¢˜ï¼Œé¢å‘æ–¹é¢çš„ç¨‹åºè®¾è®¡(Aspect Oriented Programmingï¼ŒAOPï¼‰</li></ul><p>EJB è¯•å›¾è§£å†³å¤ªå¤šçš„é—®é¢˜ï¼Œå…¶ä¸­å¾ˆå¤šé—®é¢˜æœ¬ä¸åº”è¯¥ç”±å®ƒæ¥è§£å†³çš„ã€‚</p><h4 id="J2EEè¿˜å‰©ä¸‹ä»€ä¹ˆ"><a href="#J2EEè¿˜å‰©ä¸‹ä»€ä¹ˆ" class="headerlink" title="J2EEè¿˜å‰©ä¸‹ä»€ä¹ˆ"></a>J2EEè¿˜å‰©ä¸‹ä»€ä¹ˆ</h4><p>â€‹    EJBåªæ˜¯J2EEçš„ä¸€ç§å®ç°æ¡†æ¶ã€‚å› ä¸ºè¿™äº›åº“å’Œæ¡†æ¶ä¸ä»…å¯ä»¥è®©æˆ‘ä»¬æ‘†è„±ä½¿ç”¨ J2EE æœåŠ¡çš„å¤æ‚åº¦ï¼Œè€Œä¸”ä¹Ÿä¸ä¼šæ‹›è‡´ EJB æ‰€å¸¦æ¥çš„å¤æ‚åº¦ã€‚</p><p>â€‹    J2EE éƒ½æ˜¯ä¸€ä¸ªä¼Ÿå¤§çš„æˆåŠŸ:</p><ul><li>å®ƒæˆåŠŸåœ°åœ¨ä»å‰æ²¡æœ‰æ ‡å‡†çš„åœ°æ–¹å»ºç«‹äº†æ ‡å‡†;</li><li>å®ƒå¤§å¤§æå‡äº†ä¼ä¸šçº§è½¯ä»¶çš„å¼€æ”¾ç¨‹åº¦;</li><li>å¹¶ä¸”å®ƒå¾—åˆ°äº†æ•´ä¸ªè¡Œä¸šå’Œå¼€å‘è€…çš„å¹¿æ³›è®¤å¯ã€‚</li></ul><h5 id="J2EE-åœ¨æ˜“ç”¨æ€§æ–¹é¢å­˜åœ¨ç€ä¸¥é‡çš„é—®é¢˜"><a href="#J2EE-åœ¨æ˜“ç”¨æ€§æ–¹é¢å­˜åœ¨ç€ä¸¥é‡çš„é—®é¢˜" class="headerlink" title="J2EE åœ¨æ˜“ç”¨æ€§æ–¹é¢å­˜åœ¨ç€ä¸¥é‡çš„é—®é¢˜"></a>J2EE åœ¨æ˜“ç”¨æ€§æ–¹é¢å­˜åœ¨ç€ä¸¥é‡çš„é—®é¢˜</h5><p><em>Core J2EE Patterns</em>ï¼Œä¹¦ä¸­å·²ç»å¼€å§‹æå€¡ä½¿ ç”¨æ™®é€š Java å¯¹è±¡ã€‚</p><h6 id="ä»¥è§„èŒƒä¸ºé©±åŠ¨çš„é—®é¢˜"><a href="#ä»¥è§„èŒƒä¸ºé©±åŠ¨çš„é—®é¢˜" class="headerlink" title="ä»¥è§„èŒƒä¸ºé©±åŠ¨çš„é—®é¢˜"></a>ä»¥è§„èŒƒä¸ºé©±åŠ¨çš„é—®é¢˜</h6><p>â€‹    æœ‰çŠ¶æ€ session beanï¼ŒçŠ¶æ€çš„å¤åˆ¶å¸¦æ¥äº†å¾ˆå¤šå¾®å¦™æ£˜æ‰‹çš„é—®é¢˜ï¼Œæ‰€ä»¥å¤§å¤šæ•°æ¶æ„å¸ˆæ€»æ˜¯å°½é‡é¿å…ä½¿ç”¨æœ‰çŠ¶æ€ session beanã€‚ </p><p>â€‹    å¦‚æœå¸Œæœ›å¼€å‘è€…éµå¾ª J2EE è§„èŒƒï¼Œé‚£ä¹ˆ J2EE è§„èŒƒé¦–å…ˆå¿…é¡»æ˜¯ä¸€ä¸ªå®ç”¨ã€æ˜“ç”¨çš„è§„èŒƒã€‚</p><h5 id="J2EE-é¡¹ç›®å…·å¤‡æ¶æ„é‡æ„èƒ½åŠ›çš„å…³é”®"><a href="#J2EE-é¡¹ç›®å…·å¤‡æ¶æ„é‡æ„èƒ½åŠ›çš„å…³é”®" class="headerlink" title="J2EE é¡¹ç›®å…·å¤‡æ¶æ„é‡æ„èƒ½åŠ›çš„å…³é”®"></a>J2EE é¡¹ç›®å…·å¤‡æ¶æ„é‡æ„èƒ½åŠ›çš„å…³é”®</h5><p>â€‹    ç®€å•ã€æ•ˆç‡ã€é¢å‘å¯¹è±¡ï¼ˆæ€æƒ³ï¼‰ã€ä¸šåŠ¡éœ€æ±‚è‡³ä¸Šã€å¯æµ‹è¯•æ€§</p><p> ô°€ éµå¾ªè‰¯å¥½çš„ OO è®¾è®¡æ³•åˆ™ï¼Œå¹¶ä¸”å§‹ç»ˆé’ˆå¯¹æ¥å£ç¼–ç¨‹ã€è€Œéé’ˆå¯¹ç±»ç¼–ç¨‹ã€‚è¿™æ˜¯ç»å…¸å›¾ä¹¦ </p><p>Design Patterns æ•™ç»™æˆ‘ä»¬çš„åŸºæœ¬å¸¸è¯†ï¼Œå¯æƒœäººä»¬å¸¸å¸¸å¿½è§†äº†è¿™ä¸€ç‚¹ã€‚ </p><p>â€‹    ô°€ å°†EJBä¹‹ç±»çš„æŠ€æœ¯éšè—åœ¨æ™®é€šJavaå¯¹è±¡èƒŒåã€‚ </p><p>åˆ©ç”¨ç°æœ‰çš„æ¡†æ¶æä¾›è¿™äº›åŸºç¡€è®¾æ–½æœåŠ¡</p><p>spring</p><p>â€‹    åŸºç¡€æ¡†æ¶çš„è®¾è®¡ç”šè‡³æ—©äº<em>Expert One-on-One J2EE Design and Development</em>çš„å†™ä½œï¼Œ<br>å®ƒä»¬æ¥è‡ªæˆ‘è¿‡å»å‡ ä¸ªå•†ä¸šé¡¹ç›®çš„ç»éªŒã€‚</p><h3 id="Chapeter-5-EJBçš„5å¹´é—´"><a href="#Chapeter-5-EJBçš„5å¹´é—´" class="headerlink" title="Chapeter 5   EJBçš„5å¹´é—´"></a>Chapeter 5   EJBçš„5å¹´é—´</h3><h4 id="ä¸åº”è¯¥ä»¥è§„èŒƒå…ˆè¡Œ-ï¼Œè€Œåº”è¯¥å¼€æºå¼•å¯¼"><a href="#ä¸åº”è¯¥ä»¥è§„èŒƒå…ˆè¡Œ-ï¼Œè€Œåº”è¯¥å¼€æºå¼•å¯¼" class="headerlink" title="ä¸åº”è¯¥ä»¥è§„èŒƒå…ˆè¡Œ  ï¼Œè€Œåº”è¯¥å¼€æºå¼•å¯¼"></a>ä¸åº”è¯¥ä»¥è§„èŒƒå…ˆè¡Œ  ï¼Œè€Œåº”è¯¥å¼€æºå¼•å¯¼</h4><p>â€‹    EJBå‡ºç°çš„èƒŒæ™¯ï¼Œåˆ¶å®šæ ‡å‡† ï¼ˆå¥½å¤„æ˜¯ å¼ºåˆ¶æ¥å£å®ç°åˆ†ç¦» ã€å®¹å™¨çš„æ¦‚å¿µã€ç®¡ç†å¯¹è±¡ï¼Œç²—ç²’åº¦ï¼‰</p><p>rmiåˆ°Ws ï¼ˆSOAP æ˜¯åŸºäº XML çš„ç®€æ˜“åè®®ï¼Œå¯ä½¿åº”ç”¨ç¨‹åºåœ¨ HTTP ä¹‹ä¸Šè¿›è¡Œä¿¡æ¯äº¤æ¢ã€‚ä½¿ç”¨æè¿°è¯­è¨€WSDLï¼‰</p><h4 id="éœ€è¦EJBä¸­çš„ä»€ä¹ˆï¼ˆä»ä¸­è·å–ä»·å€¼ï¼Œå¹¶ç”¨ç®€å•çš„æ–¹å¼å®ç°ï¼‰"><a href="#éœ€è¦EJBä¸­çš„ä»€ä¹ˆï¼ˆä»ä¸­è·å–ä»·å€¼ï¼Œå¹¶ç”¨ç®€å•çš„æ–¹å¼å®ç°ï¼‰" class="headerlink" title="éœ€è¦EJBä¸­çš„ä»€ä¹ˆï¼ˆä»ä¸­è·å–ä»·å€¼ï¼Œå¹¶ç”¨ç®€å•çš„æ–¹å¼å®ç°ï¼‰"></a>éœ€è¦EJBä¸­çš„ä»€ä¹ˆï¼ˆä»ä¸­è·å–ä»·å€¼ï¼Œå¹¶ç”¨ç®€å•çš„æ–¹å¼å®ç°ï¼‰</h4><ul><li>å£°æ˜å¼äº‹åŠ¡ï¼ˆç¼–ç¨‹å¼äº‹åŠ¡å¯ä»¥è§£å†³å¤æ‚çš„äº‹åŠ¡ã€ JTA webLogicï¼‰</li><li>è¿œç¨‹è°ƒç”¨ï¼ˆåè®®ã€‚JMSã€ wsï¼‰</li><li>é›†ç¾¤ï¼ˆwebå±‚ã€æ•°æ®è®¿é—®å±‚ã€æ•°æ®åº“ã€‚çœŸæ­£é™åˆ¶æ˜¯åœ¨æ•°æ®è®¿é—® ååã€å¹¶ç½®çš„åº”ç”¨æ›´æœ‰æ•ˆï¼‰</li><li>çº¿ç¨‹æ± ï¼ˆé¿å…jvmåƒåœ¾å›æ”¶ã€tomcatçš„çº¿ç¨‹æ± ï¼‰å’Œèµ„æºæ± </li><li>å®‰å…¨ï¼ˆwebå±‚ã€tomcat filterã€springmvc filterï¼‰</li><li>ç®¡ç†ä¸šåŠ¡å¯¹è±¡ï¼ˆJNDIã€é‡é‡çº§å·¥å‚ ã€iocæŠ„è¢­ã€springæä¾›åŸºäºé…ç½® è€Œä¸æ˜¯ä»£ç ã€picoContainerã€EJBæä¾›äº†ä¸€ä¸ªé‡é‡çº§å·¥å‚ï¼ˆå®ç°ã€éƒ¨ç½²EJBã€ä½¿ç”¨JNDI åº”ç”¨ä»£ç ï¼‰ã€æ¶ˆé™¤äº†æ¥å£ä¸å®ç°ä¹‹é—´çš„è€¦åˆã€‚ï¼‰</li></ul><p>â€‹    </p><p>æ€»ç»“</p><p>â€‹    SLSBã€ MDB      entity beans æ€§èƒ½ã€æœ€å¥½è®¾è®¡æˆå“‘æ•°æ®ï¼ˆè´«è¡€æ¨¡å‹ï¼‰ ä¸åŒ…å«ä¸šåŠ¡é€»è¾‘</p><h4 id="ä¸æƒ³è¦ä»€ä¹ˆ"><a href="#ä¸æƒ³è¦ä»€ä¹ˆ" class="headerlink" title="ä¸æƒ³è¦ä»€ä¹ˆ"></a>ä¸æƒ³è¦ä»€ä¹ˆ</h4><ul><li>å®¹å™¨çš„é”å®š</li></ul><p>â€‹        é™åˆ¶åº”ç”¨æœåŠ¡å™¨çš„é€‰æ‹©</p><p>â€‹        åªä½¿ç”¨ä¸€å°éƒ¨åˆ†ï¼Œå´è¦æ¥å—å…¶å¤æ‚æ€§ï¼ˆä¸èƒ½æŒ‰éœ€å¼•å…¥ï¼‰</p><p>â€‹        ä¸šåŠ¡å¯¹è±¡ä¼šè¢«EJB APIæµ¸å…¥</p><p>â€‹        ä¸èƒ½åœ¨å®¹å™¨ä¹‹å¤–å¤ç”¨ä¸šåŠ¡é€»è¾‘</p><ul><li>ä¸‘é™‹çš„ç»“æ„ã€æ³›æ»¥çš„ç±»</li></ul><p>â€‹        å®ç°ä¸€ä¸ªsession bean ï¼Œè‡³å°‘éœ€è¦ä¸‰ä¸ªJavaæºæ–‡ä»¶homeæ¥å£ ã€ç»„ä»¶æ¥å£ ã€beanå®ç°ç±»ã€‚é€šå¸¸è¿˜éœ€è¦ä¸šåŠ¡æ¥å£ï¼Œæ¥ä¿æŒbeanå’Œç»„ä»¶çš„åŒæ­¥ã€‚</p><ul><li>éƒ¨ç½²æè¿°æ–‡ä»¶çš„åœ°ç‹±</li></ul><p>â€‹        æè¿°æ–‡ä»¶å†—é•¿ï¼Œä¾èµ–ä»£ç ç”Ÿæˆå·¥å…·ï¼Œä¸å¯æ‰‹å·¥ç»´æŠ¤</p><ul><li>==ç±»åŠ è½½å™¨çš„åœ°ç‹±==</li></ul><p>â€‹        EJBå®¹å™¨ä¸webå®¹å™¨ä½¿ç”¨çš„ä¸æ˜¯ä¸€ä¸ªç±»åŠ è½½å™¨</p><p>â€‹        EJBç±»åŠ è½½å™¨æ˜¯WARç±»åŠ è½½å™¨çš„çˆ¶äº²ã€‚ EJBç±»åŠ è½½å™¨ä¸èƒ½çœ‹åˆ°WARç±»åŠ è½½å™¨åŠ è½½çš„ç±»ï¼Ÿ</p><ul><li>æµ‹è¯•</li></ul><p>â€‹        ä¾èµ–å®¹å™¨å¯¼è‡´é—®é¢˜</p><h4 id="ç®€å•çš„äº‹æƒ…å˜å›°éš¾"><a href="#ç®€å•çš„äº‹æƒ…å˜å›°éš¾" class="headerlink" title="ç®€å•çš„äº‹æƒ…å˜å›°éš¾"></a>ç®€å•çš„äº‹æƒ…å˜å›°éš¾</h4><p>â€‹    ç”¨EJBå®ç°singleton</p><p>â€‹    åœ¨EJBå®¹å™¨å¯åŠ¨æ—¶åšä¸€äº›å¤„ç† ï¼ˆservelt listener ã€webçš„listener æˆ–è€…æ˜¯beançš„åˆå§‹åŒ–åç½®æ“ä½œç­‰ ã€åŒæ—¶æä¾›äº†ä¾èµ–å…³ç³»å’Œé¡ºåºçš„æ”¯æŒï¼‰</p><p>â€‹    åœ¨EJBä¹‹é—´ä»¥åŠEJBå’ŒEJBå®¹å™¨å¤–çš„å¯¹è±¡ä¹‹é—´çš„å…±äº«é…ç½®</p><p>â€‹    ä¸èƒ½è‡ªç”±è®¿é—®å…¶ä»–Java API  ç¦æ­¢è®¿é—®ä¸€äº›Java API</p><p>EJB3.0ï¼ˆJSR 220 2003å¹´6æœˆï¼‰</p><p>â€‹    ä¸»è¦åŠ¨æœºæ˜¯å®¹æ˜“ä½¿ç”¨ é™ä½EJBå¼€å‘è€…ä½¿ç”¨æ—¶çš„å¤æ‚åº¦ï¼Œæ”¹è‰¯EJBçš„ä½“ç³»æ¶æ„</p><p>â€‹        ä½¿ç”¨æºç çº§å…ƒæ•°æ® -&gt;åºŸé™¤éƒ¨ç½²æè¿°æ–‡ä»¶ã€‚</p><p>â€‹        æä¾›ä¸€ä¸ªç®€å•ã€åŸºäºå…ƒæ•°æ®æ ‡æ³¨çš„ä¾èµ–æ³¨å…¥æœºåˆ¶ã€‚</p><p>â€‹        é‡‡ç”¨æ–°çš„æŒä¹…åŒ–æœºåˆ¶ã€‚Hibernateé‡‡ç”¨çš„æŒä¹…åŒ–æ–¹å¼</p><p>â€‹    æ—¶é—´å¤ªé•¿ã€ä¸å¤§å¯èƒ½å¼•å…¥AOPæ–¹æ¡ˆã€è¿˜æ˜¯ä¾èµ–ç‰¹å®šEJBå®¹å™¨ã€‚ï¼ˆä»æœ€è¿‘çœ‹webfluxçš„åšæ³•ï¼Œå†³å®šå‡å°‘å¯¹serveltçš„ä¾èµ–å¯ä»¥çœ‹å‡ºã€‚ä¸å¼ºä¾èµ–äºServeltï¼Œä»è€Œè¾¾åˆ°ä¸ä¾èµ–äºç‰¹å®šæœåŠ¡å™¨ï¼‰            </p><p>YAGNI     </p><h3 id="Chapter-6-è½»é‡çº§å®¹å™¨"><a href="#Chapter-6-è½»é‡çº§å®¹å™¨" class="headerlink" title="Chapter 6 è½»é‡çº§å®¹å™¨"></a>Chapter 6 è½»é‡çº§å®¹å™¨</h3><h4 id="å®¹å™¨éœ€æä¾›çš„æœåŠ¡"><a href="#å®¹å™¨éœ€æä¾›çš„æœåŠ¡" class="headerlink" title="å®¹å™¨éœ€æä¾›çš„æœåŠ¡"></a>å®¹å™¨éœ€æä¾›çš„æœåŠ¡</h4><p>â€‹    ç”Ÿå‘½å‘¨æœŸï¼Œå›è°ƒ</p><p>â€‹    æŸ¥çœ‹æœåŠ¡ å®¹å™¨çš„æ ¸å¿ƒæ˜¯å·¥å‚</p><p>â€‹    é…ç½®ç®¡ç† ç»Ÿä¸€æ–¹æ³•æ¥é…ç½®è¿è¡Œå…¶ä¸­çš„å¯¹è±¡</p><p>â€‹    ä¾èµ–ç®¡ç†</p><h4 id="å¢å€¼æœåŠ¡"><a href="#å¢å€¼æœåŠ¡" class="headerlink" title="å¢å€¼æœåŠ¡"></a>å¢å€¼æœåŠ¡</h4><p>â€‹    ä¼ä¸šçº§æœåŠ¡ ï¼Œäº‹åŠ¡ç®¡ç†æˆ–å…¶ä»–å£°æ˜å¼æœåŠ¡</p><p>â€‹    çº¿ç¨‹ç®¡ç†</p><p>â€‹    å¯¹è±¡æ± </p><p>â€‹    é›†ç¾¤æœåŠ¡</p><p>â€‹    ç®¡ç† jmxæˆ–æš´éœ²æ¥å£</p><p>â€‹    è¿œç¨‹æœåŠ¡ http å¤šåè®®</p><p>â€‹        æš´éœ²</p><p>â€‹        æ¶ˆè´¹</p><p>â€‹    å¯å®šåˆ¶æ€§å’Œæ‰©å±•æ€§</p><p>EJBå®¹å™¨ ç®¡ç†çš„æ˜¯ç²—ç²’åº¦çš„ç»„ä»¶ï¼ˆå¤šä¸ªå¯¹è±¡ç»„åˆï¼‰</p><p>IOC</p><p>åˆ©ç”¨DI æ¶ˆé™¤lookupä»£ç ï¼Œè®©å®¹å™¨è‡ªåŠ¨å†³å®šå¯¹è±¡é—´çš„ä¾èµ–å…³ç³»</p><p>ä¾èµ–æŸ¥æ‰¾ å®¹å™¨ç®¡ç†å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸï¼Œå—ç®¡å¯¹è±¡åˆ™è´Ÿè´£æŸ¥æ‰¾è‡ªå·±çš„ä¾èµ–å…³ç³» JNDI</p><p>ä¾èµ–æ³¨å…¥ è®©å®¹å™¨å…¨æƒå»è´Ÿè´£ä¾èµ–æŸ¥è¯¢ï¼Œå—ç®¡å¯¹è±¡æš´éœ²Java Bean çš„setter æ–¹æ³•æˆ–å¸¦å‚æ•°çš„æ„é€ ã€‚ï¼ˆæˆ–è€…é€šè¿‡å…ƒæ•°æ®ï¼‰ </p><p>â€‹    è®¾å€¼æ–¹æ³•æ³¨å…¥ å»ºç«‹åœ¨JavaBeanè§„èŒƒä¹‹ä¸Š</p><p>â€‹    æ„é€ æ³¨å…¥ï¼ˆpicoContainerå›¢é˜Ÿå‘æ˜ï¼‰</p><p>å¯ä»¥æŒ‡å®šinit å’Œ destroy æ–¹æ³•</p><p>æ³¨å…¥å¼‚å¸¸æ£€æŸ¥</p><p>è‡ªåŠ¨è£…é… é€šè¿‡ç±»å‹</p><p>å¯¹äºå¯ç§»æ¤æ€§ </p><p>â€‹    å‡å°‘ä»£ç å¯¹å®¹å™¨çš„ä¾èµ–</p><p>â€‹    ä¼ä¸šæœåŠ¡ä¾èµ–å®¹å™¨ï¼Œå°½é‡ä»¥å£°æ˜å¼è€Œéç¼–ç¨‹å¼</p><p>ä»£ç é£æ ¼</p><p> é’ˆå¯¹æ¥å£</p><p>ä¼˜å…ˆä½¿ç”¨strategyè®¾è®¡æ¨¡å¼</p><p>æ˜ç¡®æ¯ä¸ªå¯¹è±¡è´£ä»»ï¼Œä¸è¦å¤§è€Œå…¨ ï¼ˆå¤§ä¸€ç»Ÿï¼Œè€Œæ˜¯åº”è¯¥èŒè´£æ˜ç¡®ï¼ŒæŠ½æˆç»„ä»¶åŒ–ï¼‰</p><p>èƒ½ä¾é å®¹å™¨è§£å†³çš„é—®é¢˜ï¼Œå°±ä¸è¦è‡ªå·±ç¼–å†™ä»£ç </p><p>ä¸ºä»€ä¹ˆspring èƒ½ä»è½»é‡çº§æ¡†æ¶ä¸­è„±å¼•è€Œå‡ºï¼Œæä¾›ä¼ä¸šçº§æœåŠ¡çš„æ¡†æ¶ç´§å¯†åˆä½œï¼Œå…è®¸å¼€å‘è€…é€šè¿‡ç¼–ç¨‹æ–¹å¼æˆ–å£°æ˜æ–¹å¼è½»æ¾åœ°è®¿é—®å„ç§ä¼ä¸šçº§æœåŠ¡ã€‚ï¼ˆç²˜åˆå‰‚ä½œç”¨ï¼Œä¾‹å¦‚æ•´åˆsshï¼‰</p><h3 id="Chapter-7-Springæ¡†æ¶ä»‹ç»"><a href="#Chapter-7-Springæ¡†æ¶ä»‹ç»" class="headerlink" title="Chapter 7 Springæ¡†æ¶ä»‹ç»"></a>Chapter 7 Springæ¡†æ¶ä»‹ç»</h3><p>springä¸é‡å¤é€ è½®å­ ä¾‹å¦‚æ²¡æœ‰loggerç»„ä»¶</p><p>å·¥å‚bean ä¸»è¦åœ¨springæ¡†æ¶å†…éƒ¨ä½¿ç”¨</p><p>â€‹    ä¾‹å¦‚ </p><p>â€‹        JndiObjectFactoryBean</p><p>â€‹        ProxyFactoryBean</p><p>â€‹        TransactionProxyFactoryBean</p><p>â€‹        RmiProxyFactoryBean</p><p>springä»¥ç»Ÿä¸€çš„æ–¹å¼ä¸ºå¤šç§j2eeæœåŠ¡æä¾›äº†æŠ½è±¡ï¼Œä½¿å¾—å¼€å‘è€…çµæ´»é€‰æ‹©å„ç§èµ„æºå®šä½ç­–ç•¥</p><p>æœ€å¥½ä¸è¦ä¾èµ–servletç¯å¢ƒï¼Œåº”è¯¥å°½é‡ä½¿ç”¨springçš„æŠ½è±¡ï¼Œå› ä¸ºè¿™æ ·å°±ä¸ä¼šä¾èµ–äºä»»ä½•ç¯å¢ƒ</p><p>ApplicationContext</p><p>â€‹    ApplicationEvent</p><p>â€‹    MessageResource</p><p>â€‹    ResourceLoader. use Resource</p><p>BeanFactoryAware</p><p>ApplicationContextAware</p><p>â€‹     ResoureLoaderAware </p><p>BeanFactoryçš„åå¤„ç†</p><p>â€‹    å…è®¸åœ¨åº•å±‚beanå·¥å‚è¯»å–beanå£°æ˜ä»¥åè¿›è¡Œåå¤„ç†ï¼Œå¯ä»¥è¦†ç›–æŸä¸ªå±æ€§å€¼ï¼Œæˆ–æ˜¯ä¸ºæŸäº›å±æ€§æä¾›å ä½å€¼ã€‚</p><p>â€‹    å‚è€ƒç°æˆçš„å®ç°</p><p>â€‹        PropertyOverriderConfigurer</p><p>â€‹        PropertyPlaceholderConfigurer</p><p>BeanPostProcessor</p><p>â€‹        å¯ä»¥ç”¨äºAOPä»£ç†</p><p>IoCå®¹å™¨å¼ºå¤§åœ¨äºï¼šå®ƒå‡ ä¹å¯ä»¥ç”¨äºé…ç½®ä»»ä½•å¯¹è±¡ã€æ¡†æ¶å’Œåº”ç”¨</p><h3 id="Chapter-8-åŸºäºAOPæ¦‚å¿µçš„å£°æ˜æ€§ä¸­é—´ä»¶"><a href="#Chapter-8-åŸºäºAOPæ¦‚å¿µçš„å£°æ˜æ€§ä¸­é—´ä»¶" class="headerlink" title="Chapter 8 åŸºäºAOPæ¦‚å¿µçš„å£°æ˜æ€§ä¸­é—´ä»¶"></a>Chapter 8 åŸºäºAOPæ¦‚å¿µçš„å£°æ˜æ€§ä¸­é—´ä»¶</h3><p>â€‹    ä¸ºä½•AOPå¯¹J2EEçš„æœªæ¥è‡³å…³é‡è¦</p><p>â€‹    ä¸ºä½•AOPæ˜¯J2EE without EJBçš„å…³é”®</p><p>OOP æœ‰äº›æ—¶å€™æ— æ³•é¿å…ä»£ç é‡å¤</p><p>æ¦‚å¿µ</p><ul><li>aspect  æ–¹é¢</li><li>adivce å¢å¼ºï¼Œæ‹¦æˆªå™¨</li><li>Join point  è¿æ¥ç‚¹</li><li>Point cut åˆ‡å…¥ç‚¹</li></ul><p>å†å²</p><p>ä¸€äº›OOPè®¾è®¡æ¨¡å¼å·²ç»è§£å†³äº†AOPå¸Œæœ›è§£å†³çš„éƒ¨åˆ†é—®é¢˜</p><p>â€‹    Decorator</p><p>â€‹    Observer</p><p>â€‹    Chain of Responsibility</p><p>ä½¿ç”¨OOè®¾è®¡æ¨¡å¼ï¼Œä¸å¯èƒ½åšåˆ°æ—¢ä¿æŒè¢«å¢å¼ºæ–¹æ³•çš„å¼ºç±»å‹æ€§ã€åˆä¸å¿…è‡ªå·±åŠ¨æ‰‹ä¸ºæ¯ä¸ªæ–¹æ³•ç¼–å†™è½¬å‘ä»£ç </p><p>â€‹    æ‹¦æˆªå™¨ å¦‚ servlet ã€EJB ç­‰ ï¼Œå­˜åœ¨çš„é—®é¢˜æ˜¯ å®ƒä»¬å°†è¢«æ‹¦æˆªçš„ä»£ç ä¸ç‰¹ç‚¹çš„APIæˆ–ä¸Šä¸‹æ–‡ç¯å¢ƒç»‘åœ¨ä¸€èµ·ï¼Œå¤§å¤šæŸå¤±äº†å¼ºç±»å‹æ€§ã€‚</p><p>AOPçš„å®ç°ç­–ç•¥</p><ul><li>J2SEåŠ¨æ€ä»£ç†    </li></ul><p>â€‹         java1.3yå¼•å…¥åŠ¨æ€ä»£ç†ï¼Œè°ƒç”¨å¿…è¦çš„æ‹¦æˆªå™¨é“¾ï¼Œæœ€åä¸€ä¸ªæ‹¦æˆªå™¨å€ŸåŠ©åå°„è°ƒç”¨ç›®æ ‡å¯¹è±¡</p><p>â€‹        å¥½å¤„ï¼šæ ‡å‡†çš„è¯­è¨€ç‰¹å¾</p><p>â€‹        å±€é™ï¼šé’ˆå¯¹æ¥å£</p><p>â€‹        å®ç°ï¼šspring</p><ul><li>åŠ¨æ€å­—èŠ‚ç ç”Ÿæˆ</li></ul><p>â€‹        CGLIBåŒ…ï¼Œè¢«åº”ç”¨åœ¨Hibernate 2.xç‰ˆæœ¬ä¸­ï¼Œå¹¶è¢«è¯æ˜æ˜¯ä¸€ç§æˆç†Ÿçš„æŠ€æœ¯</p><p>â€‹        å­˜åœ¨çš„é—®é¢˜ï¼Œé€šè¿‡ç»§æ‰¿æ¥å®ç°ä»£ç†çš„ï¼Œæ‰€ä»¥æ— æ³•ä¸ºfinalæ–¹æ³•æä¾›ä»£ç†</p><p>â€‹        å®ç°ï¼šspringã€Hibernate</p><ul><li>Javaä»£ç ç”Ÿæˆ </li></ul><p>â€‹        OOPè®¾è®¡æ¨¡å¼ï¼ŒEJBä»£ç ç”Ÿæˆç­–ç•¥ï¼Œé¢„è®¾çš„æ–¹å¼ï¼Œç”±äºåŠ¨æ€ä»£ç†å’ŒåŠ¨æ€å­—èŠ‚ç ç”ŸæˆæŠ€æœ¯çš„å‡ºç°ï¼Œè¿™ç§åšæ³•é€æ¸é€€å‡º</p><ul><li>ä½¿ç”¨å®šåˆ¶çš„ç±»åŠ è½½å™¨</li></ul><p>â€‹        å¯¹æŸä¸ªç±»çš„æ‰€æœ‰å®ä¾‹è¿›è¡Œå¢å¼º</p><p>â€‹        é£é™©ï¼šåç¦»äº†Javaæ ‡å‡†</p><p>â€‹        å®ç°ï¼šJBoss4ã€AspectWerkz</p><ul><li>è¯­è¨€æ‰©å±• </li></ul><p>â€‹        å®ç°ï¼šAspectJ</p><p>springAOPçš„ç¼ºç‚¹</p><p>â€‹    ä¸æ”¯æŒå­—æ®µæ‹¦æˆªï¼Œä½†æ˜¯å°è£…æ€§è€ƒè™‘æ˜¯ä¸åº”è¯¥</p><p>â€‹    åªæœ‰é€šè¿‡SpringIocå®¹å™¨è·å–çš„å¯¹è±¡æ‰èƒ½è¿›è¡Œå¢å¼ºï¼Œä¸èƒ½åœ¨ç±»è£…è½½å™¨å±‚é¢è¿›è¡Œå¢å¼º</p><p>â€‹    æ‹¦æˆªå™¨ä»£ç ä¸­æ²¡æœ‰å¼ºç±»å‹æ£€æŸ¥</p><p>AOPé£é™©</p><p>â€‹    æ‹¦æˆªå­—æ®µçš„é£é™© ï¼Œç ´åå°è£…æ€§</p><p>â€‹    å¤ªå¤šçš„æ–¹é¢ï¼Œç»´æŠ¤</p><p>â€‹    æ­£äº¤æ€§ï¼Œä¸ä¾èµ–é¡ºåºï¼Œç‹¬ç«‹</p><p>â€‹    æµ‹è¯• AOPæå‡å¯æµ‹è¯•æ€§ï¼Œå•å…ƒæµ‹è¯•ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘</p><p>â€‹    è°ƒè¯• </p><p>â€‹    æ€§èƒ½ ç²’åº¦</p><p>â€‹        å¦‚æœä½ ç»™ç»†ç²’åº¦çš„æŒä¹…åŒ–å¯¹è±¡åŠ ä¸ŠAOPå¢å¼ºï¼Œåœ¨æ¯æ¬¡æ“ä½œå°†ä¼šæœ‰æ•°ç™¾ä¸ªæŒä¹…åŒ–å¯¹è±¡è¢«åˆ›å»ºå‡ºæ¥ï¼Œé‚£ä¹ˆæ‰ä¼šæœ‰å¼€é”€é—®é¢˜ã€‚</p><p>â€‹    ä¸€æ¬¡æ¶‰åŠåå°„çš„æ–¹æ³•è°ƒç”¨éœ€è¦è€—è´¹çš„æ—¶é—´æ˜¯æ¯«ç§’çº§çš„ </p><p>â€‹    ä¸€æ¬¡æ•°æ®åº“åªè¯»è®¿é—®çš„æ—¶é—´å¼€é”€é€šå¸¸æ˜¯æ•°åæ¯«ç§’</p><p>â€‹    é€šè¿‡æµè§ˆå™¨è®¿é—®webé¡µé¢çš„ç½‘ç»œå»¶è¿Ÿåˆ™æ˜¯ç™¾æ¯«ç§’çº§</p><p>AOPè®¾è®¡å»ºè®®</p><p>â€‹    æ¸è¿›å¼ã€å®ç”¨è‡³ä¸Šçš„æ–¹å¼æ¥ä½¿ç”¨AOP</p><p>â€‹    å°†AOPåº”ç”¨äºä¸šåŠ¡å¯¹è±¡ï¼Œæœ€æœ‰ä»·å€¼çš„ç”¨é€”å°±æ˜¯åœ¨ä¸šåŠ¡æ–¹æ³•çš„ç²’åº¦ä¸Šæä¾›é€šç”¨çš„ä¼ä¸šçº§æœåŠ¡</p><p>â€‹    å…¸å‹é—®é¢˜ï¼š</p><p>â€‹        è°ƒç”¨å †è·Ÿè¸ªå’Œæ€§èƒ½ç›‘æ§</p><p>â€‹        å®¡è®¡</p><p>â€‹        æ¶ˆæ¯é€šçŸ¥ï¼ˆä¾‹å¦‚å½“ç‰¹å®šçš„å¼‚å¸¸æŠ›å‡ºæ—¶ç»™ç®¡ç†å‘˜å‘é€ç”µå­é‚®ä»¶ï¼‰</p><p>â€‹    ä¸å»ºè®®åœ¨éå¸¸ç»†ç²’åº¦çš„å¯¹è±¡ï¼ˆä¾‹å¦‚æŒä¹…åŒ–å¯¹è±¡ï¼‰è¿›è¡Œå¢å¼º</p><p>springAOP</p><p>â€‹    ä¸€ä¸ªå¯ç§»æ¤çš„æœåŠ¡å±‚ï¼Œç±»ä¼¼äºJTAã€JDBCå’Œåˆ«çš„åº•å±‚APIï¼ˆå°†å£°æ˜æ€§æœåŠ¡ä»EJBå®¹å™¨ä¸­è§£è€¦å‡ºæ¥ï¼ŒJ2eeï¼‰</p><p>â€‹    ä¸€ç§åŸºäºAOPçš„æœåŠ¡è·å–æœºåˆ¶ï¼ŒåŸºäºJava</p><h3 id="Chapter-9-äº‹åŠ¡ç®¡ç†"><a href="#Chapter-9-äº‹åŠ¡ç®¡ç†" class="headerlink" title="Chapter 9  äº‹åŠ¡ç®¡ç†"></a>Chapter 9  äº‹åŠ¡ç®¡ç†</h3><p>â€‹    åœ¨ä¸€ä¸ª webå±‚ ã€ä¸šåŠ¡å¯¹è±¡å±‚ ã€æ•°æ®è®¿é—®å±‚ä¸­ï¼Œäº‹åŠ¡ç®¡ç†å±äºä¸šåŠ¡å¯¹è±¡å±‚ï¼Œé€šè¿‡å°†æ•°æ®åº“åˆ‡æ¢åˆ°æ‰‹å·¥æäº¤äº‹åŠ¡çš„æ¨¡å¼ã€‚è¿™ç§æ¨¡å¼ä¸šåŠ¡å¯¹è±¡å±‚å’Œæ•°æ®è®¿é—®å±‚éƒ½ç»‘å®šåˆ°äº†ç‰¹å®šçš„äº‹åŠ¡å¤„ç†ç­–ç•¥å’Œæ•°æ®è®¿é—®ç­–ç•¥ã€‚</p><p>â€‹    éœ€è¦åˆ†ç¦»è¿™äº›å…³æ³¨ç‚¹</p><ul><li>ä¸šåŠ¡å¯¹è±¡åˆ’åˆ†æŠ½è±¡äº‹åŠ¡ï¼Œè€Œæ— éœ€å…³æ³¨äº‹åŠ¡æ¶‰åŠçš„æ•°æ®åº“èµ„æº</li><li>æ•°æ®è®¿é—®å¯¹è±¡è·å–æ•°æ®åº“èµ„æºï¼Œæ— éœ€å…³æ³¨æ•°æ®åº“èµ„æºå¦‚ä½•åŠ å…¥äº‹åŠ¡</li></ul><h4 id="ä¼ ç»ŸJ2EE-äº‹åŠ¡ç®¡ç†"><a href="#ä¼ ç»ŸJ2EE-äº‹åŠ¡ç®¡ç†" class="headerlink" title="ä¼ ç»ŸJ2EE äº‹åŠ¡ç®¡ç†"></a>ä¼ ç»ŸJ2EE äº‹åŠ¡ç®¡ç†</h4><p>â€‹    ä½¿ç”¨å…¨å±€å®¹å™¨äº‹åŠ¡ï¼šäº‹åŠ¡ç”±åº”ç”¨æœåŠ¡å™¨æ¥ç®¡ç†ï¼Œç™»è®°æ‰€æœ‰å‚ä¸äº‹åŠ¡çš„èµ„æºã€‚ä¸€æ—¦æ•°æ®è®¿é—®å¯¹è±¡ä½¿ç”¨äº†æ¶‰åŠäº‹åŠ¡çš„èµ„æºï¼Œåº”ç”¨æœåŠ¡å™¨å®¹å™¨å°†æ ¹æ®éœ€è¦è¿›è¡Œæäº¤æˆ–å›æ»šã€‚</p><p>â€‹    åº•å±‚è®¾æ–½æ˜¯ç”±å®¹å™¨å®ç°çš„JTAï¼Œå…¨å±€äº‹åŠ¡ç®¡ç†ä½¿ç”¨CMT</p><h4 id="J2EEå®¹å™¨ä½œä¸ºäº‹åŠ¡åè°ƒå™¨"><a href="#J2EEå®¹å™¨ä½œä¸ºäº‹åŠ¡åè°ƒå™¨" class="headerlink" title="J2EEå®¹å™¨ä½œä¸ºäº‹åŠ¡åè°ƒå™¨"></a>J2EEå®¹å™¨ä½œä¸ºäº‹åŠ¡åè°ƒå™¨</h4><p>â€‹    å…·å¤‡åˆ†å¸ƒå¼äº‹åŠ¡çš„å¤„ç†èƒ½åŠ›ï¼Œåº”è¯¥å®Œæ•´æ”¯æŒéµå¾ªX/Open XAè§„èŒƒçš„ä¸¤é˜¶æ®µæäº¤åè®®ï¼ˆ2-Phase-Commitï¼‰</p><p>â€‹    ç¬¬ä¸€é˜¶æ®µ äº‹åŠ¡åè°ƒå™¨å‘æ‰€æœ‰ç›¸å…³èµ„æºå‘å¸ƒ â€˜å‡†å¤‡â€™æŒ‡ä»¤</p><p>â€‹    ç¬¬äºŒé˜¶æ®µ ç­‰æ‰€æœ‰çš„èµ„æºå‡†å¤‡å¥½ä»¥åè§¦å‘å®é™…çš„æäº¤åŠ¨ä½œ</p><p>â€‹    ä¸€ã€å‚ä¸äº‹åŠ¡çš„èµ„æºå¿…é¡»è¢«æ­£ç¡®åœ°é…ç½®å¥½ï¼Œä¾‹å¦‚JDBCï¼Œé€šè¿‡javax.sql.XADataSourceæ¥å£å®ç°ç±»æ¥å»ºç«‹JNDI DataSource</p><p>â€‹    J2EE 1.3 å¼•å…¥å‚ä¸äº‹åŠ¡çš„èµ„æºçš„ç»Ÿä¸€æ¨¡å‹ javaè¿æ¥å™¨æ¶æ„ ï¼ˆJava Connector Architectureï¼‰</p><p>â€‹    äºŒã€ä½¿ç”¨ç‰¹å®šçš„æœåŠ¡å™¨ç‰¹æ€§æ¥è·å–JTAå†…ç½®çš„TransactionManageå¯¹è±¡ï¼ŒTransactionManageå¯¹è±¡å…è®¸æ•°æ®è®¿é—®æ¡†æ¶æ³¨å†Œåˆ°å®ç‰©åŒæ­¥å›è°ƒæ¥å£ä¸Š</p><p>â€‹    ç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†ï¼ˆä½¿ç”¨javaä»£ç ï¼‰  é€šè¿‡JNDI,ç›´æ¥ä½¿ç”¨JTA UserTransaction ï¼ˆå¤šä¸ªå—æ§å¼‚å¸¸ï¼Œæ²¡æœ‰å…±åŒçˆ¶ç±»ï¼Œäº‹åŠ¡å¤„ç†ä»£ç æ±¡æŸ“ä¸šåŠ¡å¯¹è±¡ï¼‰</p><p>â€‹    å£°æ˜å¼äº‹åŠ¡ç®¡ç†ï¼ˆä½¿ç”¨xmlé…ç½®ï¼Œæ³¨è§£çš„æ–¹å¼ï¼‰ ç»„ä»¶æ¨¡å‹CMT ï¼Œå»ºç«‹åœ¨JTAåŸºç¡€è®¾æ–½ä¹‹ä¸Šçš„æœåŠ¡(åªæœ‰EJBæ‰èƒ½ä½¿ç”¨ï¼Œè§£å†³äº†80%çš„é—®é¢˜ï¼Œå¿…é¡»ä½¿ç”¨å…¨å±€äº‹åŠ¡ç®¡ç†ï¼ŒEJB2.0æ‰æ”¯æŒæœ¬åœ°æ¥å£)</p><h4 id="è½»é‡çº§äº‹åŠ¡åŸºç¡€è®¾æ–½"><a href="#è½»é‡çº§äº‹åŠ¡åŸºç¡€è®¾æ–½" class="headerlink" title="è½»é‡çº§äº‹åŠ¡åŸºç¡€è®¾æ–½"></a>è½»é‡çº§äº‹åŠ¡åŸºç¡€è®¾æ–½</h4><p>â€‹    æä¾›çš„åŠŸèƒ½ï¼š</p><p>â€‹    å¯ç¼–ç¨‹çš„äº‹åŠ¡å£°æ˜å’Œä¸€è‡´çš„å¼‚å¸¸å¤„ç†æœºåˆ¶ã€‚é”™è¯¯æ˜¯ä¸å¯æ¢å¤çš„ï¼Œæ‰€ä»¥åº”è¯¥é‡‡ç”¨éå—æ§å¼‚å¸¸ï¼Œå¹¶ä¸”æ‰€æœ‰çš„å¼‚å¸¸åº”è¯¥ç»§æ‰¿è‡ªä¸€ä¸ªå…¬å…±çš„åŸºç¡€çˆ¶ç±»</p><p>â€‹    åœ¨OPJOä¸Šé¢å®ç°å£°æ˜å¼äº‹åŠ¡ï¼Œæ— éœ€ç»‘å®šé‡é‡çº§ç»„ä»¶æ¨¡å‹</p><p>â€‹    å¯æ’å…¥çš„äº‹åŠ¡ç­–ç•¥ï¼Œä»¥åŠè®©èµ„æºèƒ½å¤Ÿè‡ªåŠ¨åŠ å…¥äº‹åŠ¡çš„æ‰‹æ®µ</p><p>â€‹    ä¸ºé‡‡ç”¨åˆ†å¸ƒå¼å®¹å™¨äº‹åŠ¡è€Œéœ€è¦çš„JTA</p><p>â€‹    ç‹¬ç«‹çš„JDBCæ•°æ®æº</p><p>â€‹    ç‹¬ç«‹çš„JDO PersistenceManagerFactory</p><p>â€‹    ç‹¬ç«‹çš„Hibernate SessionFactory</p><p>ä¸åº”è¯¥ä¾èµ–J2EEå®¹å™¨æä¾›çš„æœåŠ¡ï¼Œä¾‹å¦‚JNDIæ•°æ®æºã€‚åˆ‡æ¢äº‹åŠ¡ç­–ç•¥å’Œèµ„æºå®šä¹‰åº”è¯¥æ˜¯å¯é…ç½®çš„ã€‚</p><h4 id="Spring-Frameworkçš„äº‹åŠ¡ç®¡ç†"><a href="#Spring-Frameworkçš„äº‹åŠ¡ç®¡ç†" class="headerlink" title="Spring Frameworkçš„äº‹åŠ¡ç®¡ç†"></a>Spring Frameworkçš„äº‹åŠ¡ç®¡ç†</h4><p><img src="https://ws4.sinaimg.cn/large/006tKfTcgy1g18zgtukb9j31kz0u0af4.jpg" alt="image-20190320090427683"></p><h5 id="äº‹åŠ¡å£°æ˜"><a href="#äº‹åŠ¡å£°æ˜" class="headerlink" title="äº‹åŠ¡å£°æ˜"></a>äº‹åŠ¡å£°æ˜</h5><p>äº‹åŠ¡çš„å±æ€§ TransactionDefinition</p><p>â€‹    äº‹åŠ¡ä¼ æ’­ç±»å‹ required ã€supports ã€mandatoryã€  requires new ã€not supportã€ never</p><p>â€‹    éš”ç¦»çº§åˆ« default ã€ruã€ rcã€ rr ã€serializable</p><p>â€‹    è¶…æ—¶</p><p>â€‹    åªè¯»</p><p>åŸºç¡€è®¾æ–½æ¥å£ PlatfromTransactionManager</p><p>â€‹    æŠ½è±¡äº†å®é™…çš„å…·ä½“äº‹åŠ¡ç­–ç•¥ï¼Œé’ˆå¯¹ä¸€ä¸ªç»™å®šçš„TransactionDefinitionç¬¦åˆä¸€ä¸ªTransactionStatuså¯¹è±¡ï¼Œå¹¶ä¸”å¯¹è¿™ä¸ªçŠ¶æ€å¯¹è±¡è§¦å‘æäº¤æˆ–å›æ»šæ“ä½œã€‚</p><p>TransactionStatuså¯¹è±¡ä»£è¡¨å½“å‰è¿è¡Œä¸­çš„äº‹åŠ¡ã€‚</p><p>â€‹    setRollbackOnly ä¸ä¼šæŠ›å‡ºå¼‚å¸¸</p><blockquote><p>Invoking this method outside a Spring transactionally advised AOP invocation is a programming error and will result in a runtime exception.</p></blockquote><h5 id="ç¼–ç¨‹å¼äº‹åŠ¡å¤„ç†"><a href="#ç¼–ç¨‹å¼äº‹åŠ¡å¤„ç†" class="headerlink" title="ç¼–ç¨‹å¼äº‹åŠ¡å¤„ç†"></a>ç¼–ç¨‹å¼äº‹åŠ¡å¤„ç†</h5><p>ç›´æ¥ä½¿ç”¨ PlatfromTransactionManager</p><p>äº‹åŠ¡æ¨¡æ¿ TransactionTemplate</p><p>â€‹    æ¯”ç›´æ¥ä½¿ç”¨JTAç®€å•</p><h5 id="å£°æ˜å¼äº‹åŠ¡ç®¡ç†"><a href="#å£°æ˜å¼äº‹åŠ¡ç®¡ç†" class="headerlink" title="å£°æ˜å¼äº‹åŠ¡ç®¡ç†"></a>å£°æ˜å¼äº‹åŠ¡ç®¡ç†</h5><p>â€‹    é¿å…EJBå¸¦æ¥çš„ç¼ºé™·</p><p>é€šç”¨çš„ Aop ProxyFactoryBean å’Œ TransactionInterceptor</p><p>â€‹    ç”±äºTransactionInterceptoræ˜¯é€šè¿‡ThreadLocalæ¥å­˜å–äº‹åŠ¡çŠ¶æ€å¯¹è±¡çš„ã€‚</p><p>ä¸€ç«™å¼ TransactionProxyFactoryBean</p><p>â€‹    ä¼˜ç‚¹ï¼š</p><p>â€‹    æŠŠå…³è”çš„é…ç½®ç»„ç»‡åœ¨ä¸€èµ·</p><p>â€‹    ä¸éœ€è¦äº†è§£æ•´ä¸ªæ‹¦æˆªå™¨é“¾</p><p>â€‹    ä»£ç†æ¥å£é€šè¿‡ç›®æ ‡ç±»è‡ªåŠ¨ç¡®å®šï¼Œå¹¶ä¸éœ€è¦æ˜¾ç¤ºçš„æŒ‡å®š    </p><p>â€‹    ç¼ºç‚¹ï¼š</p><p>â€‹    ä¸§å¤±äº†æ›´å¼ºçš„å¯é…ç½®èƒ½åŠ›</p><p>æºä»£ç çº§åˆ«çš„å…ƒæ•°æ®ï¼ˆæ³¨è§£ï¼‰</p><p>1.2å¼€å§‹æ”¯æŒï¼ŒåŸºäºJDK5 </p><h5 id="äº‹åŠ¡ç®¡ç†ç­–ç•¥"><a href="#äº‹åŠ¡ç®¡ç†ç­–ç•¥" class="headerlink" title="äº‹åŠ¡ç®¡ç†ç­–ç•¥"></a>äº‹åŠ¡ç®¡ç†ç­–ç•¥</h5><p>â€‹    DataSourceTransactionManager</p><p>â€‹    JtaTransactionManager</p><p>â€‹    JdoTransactionManager</p><p>â€‹    HibernateTransactionManager</p><h3 id="Chapter10-æŒä¹…åŒ–"><a href="#Chapter10-æŒä¹…åŒ–" class="headerlink" title="Chapter10 æŒä¹…åŒ–"></a>Chapter10 æŒä¹…åŒ–</h3><h4 id="å¸¸è§æŒä¹…åŒ–ç­–ç•¥"><a href="#å¸¸è§æŒä¹…åŒ–ç­–ç•¥" class="headerlink" title="å¸¸è§æŒä¹…åŒ–ç­–ç•¥"></a>å¸¸è§æŒä¹…åŒ–ç­–ç•¥</h4><h5 id="æŒä¹…åŒ–ç­–ç•¥æ¦‚è§ˆ"><a href="#æŒä¹…åŒ–ç­–ç•¥æ¦‚è§ˆ" class="headerlink" title="æŒä¹…åŒ–ç­–ç•¥æ¦‚è§ˆ"></a>æŒä¹…åŒ–ç­–ç•¥æ¦‚è§ˆ</h5><p>â€‹    æ¨èMartin Fowleråœ¨ Patterns of Enterprise Application Architecture (POEAA) </p><p>â€‹    åŸºäºSQL  ç›´æ¥æ“ä½œå…³ç³»æ¨¡å‹ï¼Œäº‹åŠ¡è„šæœ¬ï¼ˆtransaction script ï¼‰ï¼Œä¸šåŠ¡é€»è¾‘ç»„ç»‡åœ¨ä¸€ä¸ªè¿‡ç¨‹ä¸­ï¼Œé€‚ç”¨äºé›†åˆæŸ¥è¯¢å’Œæ‰¹é‡æ›´æ–°ã€‚</p><p>â€‹    åŸºäºO/R æ˜ å°„ï¼ˆå¯¹è±¡-å…³ç³»æ˜ å°„ï¼‰  ï¼ŒæŸ¥è¯¢ç›¸å¯¹ç®€å•ï¼Œåªéœ€è¦å–å‡ºå¾ˆå°‘çš„å‡ è¡Œæ•°æ®ï¼Œå¹¶å¯¹è¿™äº›æ•°æ®è¿›è¡Œé€‰æ‹©æ–°çš„æ›´æ–°ã€‚è¿™äº›æ•°æ®å®ä½“é€šå¸¸å¯ä»¥æ˜ å°„åˆ°æŒä¹…åŒ–çš„Javaå¯¹è±¡ï¼Œç»„æˆäº†é¢†åŸŸæ¨¡å‹ï¼ˆdomain modelï¼‰ï¼Œä¸šåŠ¡é€»è¾‘è¡¨ç°ä¸ºå¯¹è±¡ä¹‹é—´çš„äº¤äº’ï¼Œè€Œä¸æ˜¯ç›´æ¥æ“ä½œæ•°æ®åº“é‡Œçš„è¡¨å’Œå­—æ®µã€‚</p><p>â€‹    ä¸€ç§ç®€å•çš„O/Ræ˜ å°„å°±æ˜¯active record ï¼Œä¸€è¡Œè®°å½•éƒ½ç”±å¯¹åº”çš„gatewayç±»çš„ä¸€ä¸ªå®ä¾‹æ¥è¡¨ç°ï¼Œè¿™ä¸ªæŒä¹…åŒ–ç±»æä¾›insertã€updateã€deleteã€‚æ¯å¼ è¡¨é€šå¸¸è¿˜æœ‰ä¸€ä¸ªfinderç±»ã€‚ å°†æŒä¹…åŒ–æ“ä½œå®šä¹‰åœ¨é¢†åŸŸç±»å†…éƒ¨ã€‚</p><p>â€‹    è€Œæ•°æ®æ˜ å°„å™¨ï¼ˆdata mapperï¼‰çš„ç”¨é€”åˆ™æ˜¯ åœ¨å¯¹è±¡ä¸æ•°æ®åº“ä¹‹é—´ä¼ é€’æ•°æ®ï¼Œå¹¶ä¸”ä¿æŒè¿™ä¸¤è€…ä»¥åŠæ˜ å°„å™¨çš„ç‹¬ç«‹æ€§ã€‚è€ƒè™‘æŒä¹…åŒ–çš„é—®é¢˜ã€‚</p><p>â€‹    é€æ˜æŒä¹…åŒ–ï¼ˆtransparent persistenceï¼‰è¿™ä¸ªè¯é€šå¸¸å°±æ˜¯æŒ‡è¿™ç§éä¾µå…¥æ€§çš„ã€æä¾›å·¥ä½œå•å…ƒï¼ˆunit-of-workï¼‰ ï¼Œä¾‹å¦‚Hibernateï¼Œsessionå¯¹è±¡,ç»´æŠ¤çŠ¶æ€è¢«å½“å‰äº‹åŠ¡ä¸­çš„ä¸šåŠ¡æ“ä½œä¿®æ”¹è¿‡çš„å¯¹è±¡åˆ—è¡¨ ã€‚åŒæ—¶è¿˜æ‰®æ¼” identity mapè§’è‰²ã€‚</p><h5 id="é€‰æ‹©æŒä¹…åŒ–æ˜ å°„"><a href="#é€‰æ‹©æŒä¹…åŒ–æ˜ å°„" class="headerlink" title="é€‰æ‹©æŒä¹…åŒ–æ˜ å°„"></a>é€‰æ‹©æŒä¹…åŒ–æ˜ å°„</h5><h6 id="ä½•æ—¶ä½¿ç”¨O-Ræ˜ å°„"><a href="#ä½•æ—¶ä½¿ç”¨O-Ræ˜ å°„" class="headerlink" title="ä½•æ—¶ä½¿ç”¨O/Ræ˜ å°„"></a>ä½•æ—¶ä½¿ç”¨O/Ræ˜ å°„</h6><p>â€‹    é’ˆå¯¹é¢†åŸŸå¯¹è±¡çš„ â€˜åŠ è½½/ç¼–è¾‘/å­˜å‚¨â€™ æµç¨‹</p><p>â€‹    æ‰¹é‡æŸ¥è¯¢ï¼Œæ›´æ–°å’Œåˆ é™¤æ˜¯å•ç‹¬è¿›è¡Œ</p><p>â€‹    å¤§é‡å¯¹è±¡éœ€è¦ç§¯æåœ°ç¼“å­˜ï¼ˆé€šå¸¸å‡ºç°åœ¨â€˜è¯»æ“ä½œå¯¹äºå†™æ“ä½œâ€™çš„æƒ…å†µï¼Œwebåº”ç”¨ï¼‰</p><p>â€‹    åœ¨é¢†åŸŸå¯¹è±¡ä¸æ•°æ®åº“è¡¨/å­—æ®µä¹‹é—´æœ‰ä¸€ä¸ªç›¸å½“è‡ªç„¶çš„å¯¹åº”å…³ç³»</p><p>â€‹    ä¸éœ€è¦å¯¹SQLè¿›è¡Œç‰¹åˆ«ä¼˜åŒ–ã€‚</p><h6 id="ä½¿ç”¨O-Ræ˜ å°„åˆ°å¥½å¤„"><a href="#ä½¿ç”¨O-Ræ˜ å°„åˆ°å¥½å¤„" class="headerlink" title="ä½¿ç”¨O/Ræ˜ å°„åˆ°å¥½å¤„"></a>ä½¿ç”¨O/Ræ˜ å°„åˆ°å¥½å¤„</h6><p>â€‹    ä¸å¿…ç¼–å†™é‡å¤çš„JDBCä»£ç æ¥å¤„ç†é¢†åŸŸå¯¹è±¡çš„å®ä¾‹</p><p>â€‹    é€æ˜æŒä¹…åŒ–ï¼ŒJDOä½¿ç”¨ç¼–è¯‘å™¨å­—èŠ‚ç ä¿®æ”¹çš„æ–¹å¼ï¼Œä½¿å¾—StateManagerèƒ½å¤ŸçŸ¥é“å¯¹è±¡å­—æ®µçš„ä¿®æ”¹æƒ…å†µã€‚Hibernateå’ŒTopLinkåˆ™ä½¿ç”¨äº†å¿«ç…§æ¯”è¾ƒçš„æ–¹å¼ã€‚Hibernateé‡‡ç”¨äº†è¿è¡ŒæœŸå­—èŠ‚ç ç”Ÿæˆï¼ŒTopLinké‡‡ç”¨åå°„çš„æ¶æ„ï¼Œéœ€è¦å°†å¯¹è±¡æ³¨å†Œåˆ°å·¥ä½œå•å…ƒä¸Šã€‚</p><h4 id="æŒä¹…åŒ–å‘å±•å²"><a href="#æŒä¹…åŒ–å‘å±•å²" class="headerlink" title="æŒä¹…åŒ–å‘å±•å²"></a>æŒä¹…åŒ–å‘å±•å²</h4><h5 id="å…³ç³»å‹æ˜ å°„å‘å±•å²"><a href="#å…³ç³»å‹æ˜ å°„å‘å±•å²" class="headerlink" title="å…³ç³»å‹æ˜ å°„å‘å±•å²"></a>å…³ç³»å‹æ˜ å°„å‘å±•å²</h5><p>1996å¹´æŠŠ JDBC åŠ å…¥j2SE1.1ä¹‹ä¸­ï¼Œå°†å…¶ä½œä¸ºRDBMSèµ„æºç®¡ç†å’Œæ•°æ®è®¿é—®çš„æ ‡æ³¨ä½çº§æŠ½è±¡å±‚ã€‚</p><p>JDBC 2.0 å’ŒJDBCæ ‡å‡†æ‰©å±•ï¼ˆJ2SE 1.2ï¼‰</p><p>â€‹    ç‰¹æ€§ï¼Œå¯æ»šåŠ¨ç»“æœé›†ï¼ˆResultSetå¯¹è±¡ï¼‰ï¼Œæ–°å¢javax.sql.DataSourceæ¥å£</p><p>JDBC 3.0ï¼ˆJ2SE1.4ï¼‰</p><p>â€‹    å°†JDBCæ ‡å‡†æ‰©å±•æ•´åˆåˆ°J2SEçš„æ ¸å¿ƒä¸­ï¼Œæ–°ç‰¹å¾ï¼ŒsavePoint ã€PreparedStatement</p><h5 id="O-Ræ˜ å°„å‘å±•å²"><a href="#O-Ræ˜ å°„å‘å±•å²" class="headerlink" title="O/Ræ˜ å°„å‘å±•å²"></a>O/Ræ˜ å°„å‘å±•å²</h5><p>1997-1998 TopLink,CocoBase ODMG</p><p>1999-2001 entity bean , JDO</p><p>â€‹    entity bean ,j2ee ejb 1.1çš„å‘å¸ƒï¼Œå´›èµ·ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰ä¿ƒè¿›O/Ræ˜ å°„çš„å‘å±•ï¼Œåè€Œæ˜¯é˜»ç¢</p><p>â€‹    JDO java Data Objects</p><p>2002-2003: TopLink, Hibernate,ibatisæ•°æ®åº“å±‚</p><p>â€‹    TopLink Oracleæ”¶è´­ï¼Œæä¾›ç±»ä¼¼JDO çš„API</p><p>â€‹    Hibernate åœ¨JDBCä¹‹ä¸Šæä¾›ä¸€å±‚è–„è–„çš„å°è£…ï¼Œåœ¨æä¾›å®Œå…¨é€æ˜çš„æŒä¹…åŒ–æœºåˆ¶çš„åŒæ—¶ï¼Œåˆæä¾›å°½å¯èƒ½å¤šçš„çµæ´»æ€§ã€‚</p><p>â€‹    ibatis ä»¥SQLæ˜ å°„çš„å½¢å¼æä¾›äº†ç®€å•çš„O/Ræ˜ å°„</p><p>2004ï¼šJDOç¨³æ­¥å‘å±• Hibernateé£é»„è…¾è¾¾</p><p>â€‹    Hibernateæˆä¸ºJBoss4.0 CMPå¼•æ“çš„åŸºçŸ³</p><p>JPA</p><p>11 May 2006ï¼š</p><p>â€‹    The final release date of the JPA 1.0 specification was 11 May 2006 as part of <a href="https://en.wikipedia.org/wiki/Java_Community_Process" target="_blank" rel="noopener">Java Community Process</a> JSR 220. </p><p>10 December 2009</p><p>â€‹    The JPA 2.0 specification was released 10 December 2009 (The Java EE 6 platform requires JPA 2.0<a href="https://en.wikipedia.org/wiki/Java_Persistence_API#cite_note-1" target="_blank" rel="noopener">[1]</a>.) </p><p>22 April 2013</p><p>â€‹    The JPA 2.1 specification was released 22 April 2013 (The Java EE 7 platform requires JPA 2.1<a href="https://en.wikipedia.org/wiki/Java_Persistence_API#cite_note-2" target="_blank" rel="noopener">[2]</a>.)</p><h5 id="entity-beanè´¥ç¬”"><a href="#entity-beanè´¥ç¬”" class="headerlink" title="entity beanè´¥ç¬”"></a>entity beanè´¥ç¬”</h5><p>â€‹    ä¸EJBç¼–ç¨‹æ¨¡å‹ç´§å¯†è€¦åˆï¼ŒCMPï¼Œä¾èµ–å®Œæ•´J2EEå®¹å™¨</p><p>â€‹    å¼€å‘éƒ¨ç½²å·¥ä½œé‡å¤§</p><p>â€‹    BMPå®ç°éº»çƒ¦ï¼Œæ€§èƒ½é—®é¢˜</p><p>â€‹    EJB QLèƒ½åŠ›æœ‰é™</p><p>â€‹    </p><p>EJB 2.1å¼€å§‹èµ°å‘ä¸€ä¸ªå¯ç”¨çš„O/Ræ˜ å°„è§£å†³æ–¹æ¡ˆã€‚</p><h4 id="å®è·µä¸­çš„æ•°æ®è®¿é—®æŠ€æœ¯"><a href="#å®è·µä¸­çš„æ•°æ®è®¿é—®æŠ€æœ¯" class="headerlink" title="å®è·µä¸­çš„æ•°æ®è®¿é—®æŠ€æœ¯"></a>å®è·µä¸­çš„æ•°æ®è®¿é—®æŠ€æœ¯</h4><p>â€‹    ç»†ç²’åº¦çš„é¢†åŸŸæ¨¡å‹ä¸åº”è¯¥ç”¨é‡é‡çº§çš„EJBç»„ä»¶æ¥å»ºæ¨¡ï¼Œè€Œåº”è¯¥ä½¿ç”¨ç®€å•çš„Javaå¯¹è±¡-POJO</p><h5 id="èµ„æºç®¡ç†"><a href="#èµ„æºç®¡ç†" class="headerlink" title="èµ„æºç®¡ç†"></a>èµ„æºç®¡ç†</h5><p>â€‹    è¿æ¥å·¥å‚ï¼šé€šè¿‡å®ƒåˆ›å»ºè¿æ¥ï¼ˆDataSource ã€SessionFactoryï¼‰</p><p>â€‹    è¿æ¥ï¼šä»£è¡¨äº†ä¸ç‰¹å®šæ•°æ®å­˜å‚¨ä»‹è´¨ä¹‹é—´çš„é€šä¿¡ä¼šè¯ï¼ˆConnectionã€Sessionï¼‰</p><p>è¿æ¥å·¥å‚ä¼šç»´æŠ¤ä¸€ä¸ªè¿æ¥æ± ï¼Œé¿å…é¢‘ç¹çš„åˆ›å»ºè¿æ¥ã€‚</p><p>åœ¨å“ªé‡Œå®šä¹‰è¿æ¥å·¥å‚ï¼Ÿ</p><p>â€‹    åœ¨å®¹å™¨ä¸­å®šä¹‰ä¸€ä¸ªJDBC DataSourceå¯¹è±¡ï¼Œåœ¨åº”ç”¨ç¨‹åºå®šä¹‰O/R ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨JCAè¿æ¥å™¨åœ¨J2EEå®¹å™¨ä¸­å®šä¹‰</p><p>åœ¨å“ªé‡Œåˆå§‹åŒ–è¿æ¥å·¥å‚ï¼Ÿ</p><p>â€‹    åœ¨ServletContextListenerä¸­åˆå§‹åŒ–ï¼Œæˆ–è€…ç‰¹å®šJ2EEå®¹å™¨äº§å“å¯åŠ¨ç±»</p><p>å¦‚ä½•è·å¾—è¿æ¥å·¥å‚ï¼Ÿ</p><p>â€‹    ä½¿ç”¨JNDIæŸ¥æ‰¾J2EEå®¹å™¨ä¸­å®šä¹‰çš„è¿æ¥å·¥å‚ã€‚æœ¬åœ°å®šä¹‰å·¥å‚ï¼Œå€ŸåŠ©ä¸€ä¸ªè‡ªåˆ¶å¯åŠ¨ç±»ç»‘å®šåˆ°JNDI</p><p>å¦‚ä½•åœ¨åŒä¸€æ¡çº¿ç¨‹çš„å¤šæ¬¡æ–¹æ³•è°ƒç”¨ä¹‹é—´å¤ç”¨è¿æ¥ï¼Ÿ</p><p>â€‹    ä½¿ç”¨ServletFilteræ¥æŸ¥æ‰¾è¿æ¥å·¥å‚ï¼Œæ¯æ¬¡è¯·æ±‚å¼€å§‹å°†ä¸€ä¸ªè¿æ¥ç»‘å®šåˆ°ThreadLocalå¯¹è±¡ï¼Œå½“è¯·æ±‚å¤„ç†å®Œæˆåå†å–æ¶ˆç»‘å®šã€‚    </p><p>äº‹åŠ¡ä¸è¿æ¥ä¹‹é—´çš„å…³ç³»æ˜¯ä»€ä¹ˆï¼šäº‹åŠ¡é©±åŠ¨è¿æ¥è¿˜æ˜¯ç›¸åï¼Ÿ</p><p>â€‹    è¿æ¥é©±åŠ¨äº‹åŠ¡ï¼Œåœ¨æ•°æ®è®¿é—®æˆ–ServletFliterä¸­ç®¡ç†</p><p>â€‹    å¦ä¸€ç§æ˜¯ä»¥J2EEçš„JTAé©±åŠ¨äº‹åŠ¡ï¼Œå¹¶å¯¹è¿æ¥å·¥å‚è¿›è¡Œé…ç½®ã€‚</p><p>å½“å¼‚å¸¸å‘ç”Ÿçš„æ—¶å€™ï¼Œå¦‚ä½•ä¿è¯è¿æ¥æ­£ç¡®å…³é—­ï¼Œè€Œåˆä¸ä¼šç ´ååŸæ¥çš„å¼‚å¸¸ï¼Ÿ</p><p>â€‹    æ¯æ®µä»£ç å‰ååŠ ä¸Š try/catch/finallyã€‚</p><p>ä»¥ä¸Šè™½ç„¶å¯ä»¥è§£å†³ï¼Œä½†æ˜¯éƒ½ä¸ç‰¹å®šç¯å¢ƒç»‘å®šJ2EEå®¹å™¨ï¼ŒServlet</p><h5 id="JDBC"><a href="#JDBC" class="headerlink" title="JDBC"></a>JDBC</h5><p>â€‹    SQLå±‚é¢ä¸Šæ“ä½œå…³ç³»æ•°æ®åº“ï¼ŒJDBCæ˜¯ä¸€ä¸ªå…¬è®¤ã€å¼ºå¤§çš„APIã€‚ä¸»è¦ç¼ºç‚¹åœ¨äºï¼Œéœ€è¦ç¼–å†™å¾ˆå¤šé‡å¤çš„åŸºç¡€è®¾æ–½ä»£ç ã€‚ï¼ˆiBATIS æ˜ å°„å’ŒSPringJDBCæ¨¡æ¿æ”¯æŒï¼Œç®€åŒ–ç¼–ç ï¼Œæ•´åˆèµ„æºç®¡ç†ä¸å®åŠ¡ç®¡ç†ï¼Œå¹¶ä¸”åœ¨äº‹åŠ¡èŒƒå›´å†…å¤ç”¨è¿æ¥ï¼‰</p><h5 id="iBATIS-SQLæ˜ å°„"><a href="#iBATIS-SQLæ˜ å°„" class="headerlink" title="iBATIS SQLæ˜ å°„"></a>iBATIS SQLæ˜ å°„</h5><p>â€‹    å°†ä½¿ç”¨JDBCçš„ç»†èŠ‚å…¨éƒ¨æŠ½è±¡éš”ç¦»èµ·æ¥ï¼ŒSQLè¯­å¥åœ¨XMLæ–‡ä»¶ä¸­å®šä¹‰ï¼Œå¹¶é¢„ç•™å‚æ•°å ä½ç¬¦ï¼Œåœ¨æ‰§è¡Œæ—¶ï¼Œå ä½ç¬¦å°†è¢«æŒ‡å®šçš„å‚æ•°å€¼æ‰€å–ä»£ã€‚SQLæŸ¥è¯¢æ—¶ï¼Œç»“æœå­—æ®µå°†è¢«æ˜ å°„åˆ°å¯¹è±¡ã€‚</p><p>â€‹    è¿˜å¯ä»¥ç¼“å­˜æŸ¥è¯¢ç»“æœï¼Œç¼“å­˜æ¨¡å‹æ˜¯é’ˆå¯¹æ¯ä¸ªæŸ¥è¯¢è¯­å¥åˆ†åˆ«æŒ‡å®šçš„ï¼Œå¹¶ä¸”å¯ä»¥æŒ‡å®šå“ªäº›æ’å…¥/æ›´æ–°/åˆ é™¤è¯­å¥åº”è¯¥å¯¼è‡´åˆ·æ–°ç‰¹å®šç¼“å­˜ã€‚</p><p>â€‹    ä¸æä¾›é€æ˜æŒä¹…åŒ–ï¼Œä¸ä¼šå¯¹å–å‡ºçš„å¯¹è±¡è¿›è¡Œä»»ä½•å˜æ›´ã€‚</p><p>ä¸é«˜çº§é€æ˜æŒä¹…åŒ–ç›¸æ¯”ï¼ŒSQLå±‚é¢ä¸Šçš„æ˜ å°„æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š</p><p>â€‹    ä¿æŒäº†SQLçš„å…¨éƒ¨èƒ½åŠ›</p><p>â€‹    å¯ä»¥ä½¿ç”¨åŸºäºæ•°æ®é›†çš„æ›´æ–°å’Œåˆ é™¤é«˜æ•ˆåœ°å¤„ç†å¤šè¡Œæ•°æ®</p><p>â€‹    å¯ä»¥æ¯«æ— é™åˆ¶çš„ä½¿ç”¨ç»Ÿè®¡å‡½æ•°ï¼ˆavgã€sumã€maxå’Œcountï¼‰</p><p>â€‹    å¯ä»¥è½»æ¾å°†é¢†åŸŸå¯¹è±¡æ˜ å°„åˆ°å¤šå¼ è¡¨çš„å­—æ®µ</p><p>ç¼ºç‚¹ï¼š</p><p>â€‹    æ˜¾ç¤ºæ›´æ–°è¢«ä¿®æ”¹å¯¹è±¡</p><p>â€‹    å°†åº”ç”¨å±‚é¢çš„å€¼è½¬æ¢æˆæ•°æ®åº“å…¼å®¹çš„å€¼</p><p>æ²¡æœ‰å®ç°å·¥ä½œå•å…ƒå’Œèº«ä»½å¯¹åº”è¡¨ï¼Œå®ƒä¸é‚£ä¹ˆå¤æ‚ã€‚</p><h5 id="JDO"><a href="#JDO" class="headerlink" title="JDO"></a>JDO</h5><p>â€‹    è§„èŒƒ</p><p>â€‹    JDOQL javaæŸ¥è¯¢API</p><h5 id="Hibernate"><a href="#Hibernate" class="headerlink" title="Hibernate"></a>Hibernate</h5><p>â€‹    ç›®æ ‡æ˜¯åœ¨JDBCä¸Šæä¾›ä¸€å±‚è–„è–„çš„å°è£…ï¼ŒåŒæ—¶æä¾›å®Œå–„çš„é€æ˜æŒä¹…åŒ–ï¼›ä¸ºåº”ç”¨ç¨‹åºå¢åŠ O/Ræ˜ å°„çš„è¯­æ„ï¼Œä½†åˆä¸è„±ç¦»åº•å±‚çš„å…³ç³»æ•°æ®åº“ã€‚</p><p>â€‹    æŸ¥è¯¢è¯­è¨€HQLæä¾›äº†è¿æ¥ã€ç»Ÿè®¡å‡½æ•°ç­‰é‡è¦çš„å…³ç³»å‹æ¦‚å¿µï¼Œä¸SQLä¸åŒæ˜¯ï¼ŒæŸ¥è¯¢æ˜¯ä»¥é¢†åŸŸå¯¹è±¡ç†Ÿæ‚‰çš„å½¢å¼è¡¨ç°å‡ºæ¥çš„ã€‚</p><p>â€‹    æ ¸å¿ƒè¿æ¥æ¥å£æ˜¯net.sf.hibernate.Session</p><p>â€‹    å¿«ç…§å¯¹æ¯” å˜æ›´ä¾¦æµ‹ å€ŸåŠ©CGLIBä»¥åŠ¨æ€å­—èŠ‚ç ç”Ÿæˆçš„æ–¹å¼ä¸ºæŒä¹…å¯¹è±¡åˆ›å»ºè¿è¡Œæ—¶ä»£ç†ï¼Œä»è€Œé™ä½äº†å¿«ç…§å¯¹æ¯”çš„æ€§èƒ½æŸè€—</p><h6 id="çŠ¶æ€ç®¡ç†"><a href="#çŠ¶æ€ç®¡ç†" class="headerlink" title="çŠ¶æ€ç®¡ç†"></a>çŠ¶æ€ç®¡ç†</h6><p>â€‹    å…è®¸å°†æŒä¹…å¯¹è±¡æ–­å¼€ä¸Sessionçš„å…³è”ï¼Œç¨ååˆå¯ä»¥å¾ˆå®¹æ˜“åœ°é‡å»ºå…³è”ï¼ŒæŒä¹…åŒ–å¯¹è±¡å‘é€åˆ°å®¢æˆ·ç«¯å±‚ï¼Œå¯¹è±¡ä¼šæš‚æ—¶ä»äº‹åŠ¡ä¸­è„±ç¦»ï¼Œå½“ç”¨æˆ·æäº¤æ—¶åˆå›åˆ°äº‹åŠ¡ã€‚</p><p>â€‹    å¥½å¤„å°±æ˜¯ï¼šä½¿å¾—å€ŸåŠ©ç‰ˆæœ¬æˆ–æ—¶é—´æˆ³å®ç°è·¨å¤šä¸ªè¯·æ±‚ã€å¤šä¸ªSessionå®ä¾‹çš„ä¹è§‚é”æˆä¸ºå¯èƒ½ã€‚</p><p>â€‹    è¾ƒä¸ºæ”¾æ¾çš„çŠ¶æ€ç®¡ç†æºè‡ª å¿«ç…§æ¯”è¾ƒçš„å˜æ›´ä¾¦æµ‹æ–¹å¼ï¼Œ åˆ·æ–°æ•°æ®åº“çš„æ—¶å€™å°†å¿«ç…§ä¸æŒä¹…å¯¹è±¡çš„å½“å‰å†…å®¹è¿›è¡Œæ¯”è¾ƒã€‚ä»è€Œå°†éœ€è¦å‘å‡ºçš„æ›´æ–°è¯­å¥å‡å°‘åˆ°æœ€ä½é™åº¦</p><pre><code class="java">@org.hibernate.annotations.Entity(dynamicInsert = true, dynamicUpdate = true)</code></pre><p>### </p><h6 id="å»¶è¿ŸåŠ è½½"><a href="#å»¶è¿ŸåŠ è½½" class="headerlink" title="å»¶è¿ŸåŠ è½½"></a>å»¶è¿ŸåŠ è½½</h6><h4 id="æ•°æ®è®¿é—®å¯¹è±¡æ¨¡å¼"><a href="#æ•°æ®è®¿é—®å¯¹è±¡æ¨¡å¼" class="headerlink" title="æ•°æ®è®¿é—®å¯¹è±¡æ¨¡å¼"></a>æ•°æ®è®¿é—®å¯¹è±¡æ¨¡å¼</h4><p>â€‹    DAO æ—¶æœ€ä¸ºé‡è¦çš„J2EEæ¨¡å¼ä¹‹ä¸€ï¼Œä¹Ÿæ˜¯GoF Strategyæ¨¡å¼çš„ä¸€ç§ç‰¹æ®Šå½¢å¼ã€‚</p><h5 id="DAOå’Œé€æ˜åŒ–æŒä¹…åŒ–"><a href="#DAOå’Œé€æ˜åŒ–æŒä¹…åŒ–" class="headerlink" title="DAOå’Œé€æ˜åŒ–æŒä¹…åŒ–"></a>DAOå’Œé€æ˜åŒ–æŒä¹…åŒ–</h5><p>â€‹    å…¸å‹çš„DAO æ¥å£åªé’ˆå¯¹ç›¸å¯¹ç®€å•ã€ç»†ç²’åº¦çš„æŒä¹…åŒ–æœºåˆ¶ï¼Œå½“å¯¹è±¡çŠ¶æ€å‘é€æ”¹å˜æ—¶ï¼Œå¿…é¡»æ˜¾å¼è°ƒç”¨å­˜å‚¨æ“ä½œã€‚ä»–ä»¬æ²¡æœ‰åŒºåˆ†ä¸€ç­‰å¯¹è±¡ï¼ˆé¢†åŸŸå¯¹è±¡ï¼‰å’ŒäºŒç­‰å¯¹è±¡ï¼ˆä»å±æ€§çš„é¢†åŸŸå¯¹è±¡ï¼Œç”Ÿå‘½å‘¨æœŸç”±çˆ¶å¯¹è±¡æ§åˆ¶ï¼‰ã€‚ JDBC</p><p>â€‹    é€æ˜æŒä¹…åŒ–è§£å†³æ–¹æ¡ˆï¼Œåªéœ€è¦å¯¹ä¸€ç­‰å¯¹è±¡è¿›è¡ŒæŒä¹…åŒ–æ“ä½œï¼Œä»å±å¯¹è±¡çš„æ“ä½œåˆ™é€šè¿‡çº§è”æ›´æ–°æˆ–åˆ é™¤éšå«è¿›è¡Œã€‚ï¼ˆpersistence by reachabilityï¼‰ ps:å¤æ‚ ä¸å¯æ§</p><h5 id="DAOè®¾è®¡ä¸­çš„é—®é¢˜"><a href="#DAOè®¾è®¡ä¸­çš„é—®é¢˜" class="headerlink" title="DAOè®¾è®¡ä¸­çš„é—®é¢˜"></a>DAOè®¾è®¡ä¸­çš„é—®é¢˜</h5><p>â€‹    æ•°æ®è®¿é—®æ“ä½œçš„ç²’åº¦</p><p>â€‹    é€æ˜æŒä¹…åº¦å’Œå¯¹è±¡çŠ¶æ€</p><p>â€‹    äº‹åŠ¡èŒƒå›´å’Œå»¶è¿ŸåŠ è½½</p><h5 id="DAOåŸºç¡€è®¾æ–½çš„é—®é¢˜"><a href="#DAOåŸºç¡€è®¾æ–½çš„é—®é¢˜" class="headerlink" title="DAOåŸºç¡€è®¾æ–½çš„é—®é¢˜"></a>DAOåŸºç¡€è®¾æ–½çš„é—®é¢˜</h5><p>â€‹    åŒä¹‹å‰èµ„æºå¤„ç†é—®é¢˜æœ‰å†™å…³ç³»</p><p>ç»„è£…</p><p>å‚ä¸äº‹åŠ¡</p><p>å¼‚å¸¸å¤„ç†</p><p>â€‹    è¿™äº›é—®é¢˜å±äºä¸­é—´å±‚é¢†åœ°ï¼Œåº”è¯¥ç”±åº”ç”¨æ¡†æ¶æ¥æä¾›å„ç§åº“ä¸ç»„ä»¶ä¹‹é—´çš„æ•´åˆåŠæ³•ã€‚</p><h4 id="ä½¿ç”¨springæ¡†æ¶è¿›è¡Œæ•°æ®è®¿é—®"><a href="#ä½¿ç”¨springæ¡†æ¶è¿›è¡Œæ•°æ®è®¿é—®" class="headerlink" title="ä½¿ç”¨springæ¡†æ¶è¿›è¡Œæ•°æ®è®¿é—®"></a>ä½¿ç”¨springæ¡†æ¶è¿›è¡Œæ•°æ®è®¿é—®</h4><p>â€‹    beanå·¥å‚å’Œä¸Šä¸‹æ–‡å®¹å™¨å¯ä»¥è½»æ¾è£…é…</p><p>â€‹    æ¸…æ™°çš„äº‹åŠ¡æ¨¡å‹</p><p>â€‹    é€šç”¨çš„æ•°æ®åº“è®¿é—®å¼‚å¸¸ä½“ç³»ï¼Œå¾ˆå¥½åœ°å®šä¹‰äº†äº‹åŠ¡ä¸è¿æ¥çš„å…³ç³»ï¼Œå°¤å…¶æ˜¯å¦‚ä½•åœ¨äº‹åŠ¡ä¹‹é—´é‡å¤ä½¿ç”¨è¿æ¥ï¼Œ</p><p>â€‹    å¯¹äºå„ç§æŒä¹…åŒ–æ–¹å¼ï¼ŒSpringç”¨å½¢å¼ç»Ÿä¸€çš„æ¨¡æ¿æœºåˆ¶è§£å†³äº†å…³é—­è¿æ¥ã€å¤„ç†å¼‚å¸¸ç­‰é—®é¢˜</p><p>ä¸‹å›¾æ˜¯è®¿é—®å¼‚å¸¸ä½“ç³»</p><p><img src="https://ws4.sinaimg.cn/large/006tKfTcgy1g1e5z44nkbj31m60t2ade.jpg" alt="image-20190324203729362"></p><h3 id="Chapter11-è¿œç¨‹è°ƒç”¨"><a href="#Chapter11-è¿œç¨‹è°ƒç”¨" class="headerlink" title="Chapter11 è¿œç¨‹è°ƒç”¨"></a>Chapter11 è¿œç¨‹è°ƒç”¨</h3><h4 id="RMI-EJB-JAX-RPC-ï¼ˆjavaï¼‰"><a href="#RMI-EJB-JAX-RPC-ï¼ˆjavaï¼‰" class="headerlink" title="RMI/EJB/JAX-RPC ï¼ˆjavaï¼‰"></a>RMI/EJB/JAX-RPC ï¼ˆjavaï¼‰</h4><p>â€‹    éƒ½æ˜¯ä¼ ç»ŸRMIæ¨¡å‹ï¼šæœåŠ¡æ¥å£éœ€è¦ç»§æ‰¿ä¸€ä¸ªæ ‡è®°æ¥å£ï¼Œå¹¶ä¸”æ¯ä¸ªæ–¹æ³•éƒ½éœ€è¦å£°æ˜æŠ›å‡ºå—æ§çš„RemoteExceptionå¼‚å¸¸ã€‚</p><h4 id="Webserviceï¼ˆå¹³å°æ— å…³è°ƒç”¨ï¼‰"><a href="#Webserviceï¼ˆå¹³å°æ— å…³è°ƒç”¨ï¼‰" class="headerlink" title="Webserviceï¼ˆå¹³å°æ— å…³è°ƒç”¨ï¼‰"></a>Webserviceï¼ˆå¹³å°æ— å…³è°ƒç”¨ï¼‰</h4><h5 id="WSDL-Web-Service-Definition-Language-è¯­è¨€"><a href="#WSDL-Web-Service-Definition-Language-è¯­è¨€" class="headerlink" title="WSDL( Web Service Definition Language )  è¯­è¨€"></a>WSDL( Web Service Definition Language )  è¯­è¨€</h5><p>â€‹    WSDL is an XML format for describing network services as a set of endpoints operating on messages containing either document-oriented or procedure-oriented information.</p><h5 id="SOAP-Simple-Object-Access-Protocol-åè®®"><a href="#SOAP-Simple-Object-Access-Protocol-åè®®" class="headerlink" title="SOAP(Simple Object Access Protocol) åè®®"></a>SOAP(Simple Object Access Protocol) åè®®</h5><p>â€‹    SOAP (abbreviation for <strong>Simple Object Access Protocol</strong>) is a messaging <a href="https://en.wikipedia.org/wiki/Protocol_(computing" target="_blank" rel="noopener">protocol</a>) specification for exchanging structured information in the implementation of <a href="https://en.wikipedia.org/wiki/Web_service" target="_blank" rel="noopener">web services</a> in <a href="https://en.wikipedia.org/wiki/Computer_network" target="_blank" rel="noopener">computer networks</a>. Its purpose is to provide <a href="https://en.wikipedia.org/wiki/Extensibility" target="_blank" rel="noopener">extensibility</a>, <a href="https://en.wikipedia.org/wiki/Neutrality_(philosophy" target="_blank" rel="noopener">neutrality</a>) and independence. It uses <a href="https://en.wikipedia.org/wiki/XML_Information_Set" target="_blank" rel="noopener">XML Information Set</a> for its <a href="https://en.wikipedia.org/wiki/Message_format" target="_blank" rel="noopener">message format</a>, and relies on <a href="https://en.wikipedia.org/wiki/Application_layer" target="_blank" rel="noopener">application layer</a> protocols, most often <a href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol" target="_blank" rel="noopener">Hypertext Transfer Protocol</a> (HTTP) or <a href="https://en.wikipedia.org/wiki/Simple_Mail_Transfer_Protocol" target="_blank" rel="noopener">Simple Mail Transfer Protocol</a> (SMTP), for message negotiation and transmission.</p><p>â€‹    å¯¹äºjavaè¿œç¨‹è°ƒç”¨è€Œè¨€ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªä»¤äººä¿¡æœçš„é€‰æ‹©ï¼Œå› ä¸ºå®ƒå¯¹æ–¹æ³•å‚æ•°æœ‰è¯¸å¤šé™åˆ¶ï¼Œéƒ¨ç½²ä¹Ÿç›¸å½“éº»çƒ¦ã€‚</p><pre><code>A WSDL is an XML document that describes a web service. It actually stands for Web Services Description Language.SOAP is an XML-based protocol that lets you exchange info over a particular protocol (can be HTTP or SMTP, for example) between applications. It stands for Simple Object Access Protocol and uses XML for its messaging format to relay the information.REST is an architectural style of networked systems and stands for Representational State Transfer. It&#39;s not a standard itself, but does use standards such as HTTP, URL, XML, etc.</code></pre><p>Wsç›¸å…³å­åè®®</p><p>â€‹    JAX-RPC</p><p>â€‹    EJBç«¯ç‚¹JSR-109 J2ee 1.4</p><h4 id="è½»é‡çº§è¿œç¨‹æ–¹æ¡ˆï¼ˆå¹³å°æ— å…³è°ƒç”¨ï¼‰"><a href="#è½»é‡çº§è¿œç¨‹æ–¹æ¡ˆï¼ˆå¹³å°æ— å…³è°ƒç”¨ï¼‰" class="headerlink" title="è½»é‡çº§è¿œç¨‹æ–¹æ¡ˆï¼ˆå¹³å°æ— å…³è°ƒç”¨ï¼‰"></a>è½»é‡çº§è¿œç¨‹æ–¹æ¡ˆï¼ˆå¹³å°æ— å…³è°ƒç”¨ï¼‰</h4><p>RMIç¯å¢ƒé…ç½®ç›¸å½“éº»çƒ¦ï¼Œå¹¶ä¸”å®ƒä½¿ç”¨çš„ç½‘ç»œç«¯å£å¸¸å¸¸è¢«é˜²ç«å¢™ç¦æ­¢ã€‚</p><p>åŸºäºWSDLå’ŒSOAP çš„web servicesåˆå¾ˆéš¾ä»¥ä¸€ç§==å¯ç§»æ¤==çš„æ–¹å¼å¯¼å‡ºï¼Œå¹¶ä¸”å®ƒä»¬çš„åè®®è‡ƒè‚¿å†—é•¿ï¼Œä¼šæµªè´¹å¤§é‡å¸¦å®½ã€‚</p><p>åŸºäºHTTPçš„è½»é‡çº§è¿œç¨‹è°ƒç”¨åè®®ï¼ˆlightweight HTTP-based remotion protocolï¼‰è§£å†³äº†ä¸Šè¿°ä¸¤ä¸ªé—®é¢˜ï¼šå®ƒä»¬å¯ä»¥åœ¨ä»»ä½•æ ‡å‡†çš„servletå®¹å™¨ä¹‹ä¸Šè¿è¡Œï¼Œå¹¶ä¸”å¯ä»¥ç©¿è¶Šä»»ä½•é˜²ç«å¢™ã€‚</p><p>åŸºäºHTTPçš„è¿œç¨‹æœåŠ¡æœ‰ä¸€ä¸ªç‰¹åˆ«çš„å¥½å¤„ï¼šå®ƒä»¬å¯ä»¥å¾ˆè½»æ¾åœ°åˆ©ç”¨webæœåŠ¡å™¨æä¾›çš„æƒé™ç®¡ç†ã€åŠ å¯†ã€å‹ç¼©ç­‰èƒ½åŠ›â€”å¯ä»¥è¦æ±‚å¯¹ç‰¹å®šçš„èµ„æºè®¿é—®è¿›è¡Œèº«ä»½è®¤è¯ï¼Œå¯ä»¥ä½¿ç”¨SSLä¼ è¾“ï¼Œå¯ä»¥å¯¹HTTPåº”ç­”è¿›è¡ŒGZIPå‹ç¼©ï¼Œç­‰ç­‰ã€‚</p><p>Hessian/burlap æ¯”wsæ•ˆç‡é«˜ </p><p>Hessian ï¼šäºŒè¿›åˆ¶ï¼Œç®€çº¦ã€æ•ˆç‡é«˜</p><p>burlapçš„ä¼˜ç‚¹åœ¨äºï¼šåŸºäºXMLï¼Œå®ƒä¼ è¾“çš„æ¶ˆæ¯å¯ä»¥è¢«äººè¯»æ‡‚ï¼Œä¹Ÿå¯ä»¥è¢«XMLè§£æå™¨è§£æã€‚</p><p>relationships between http and servlet</p><pre><code>A servlet is a &#39;module&#39; that can be integrated into a server application to respond to client requests. Although a servlet need not use a specific protocol, we will use the HTTP protocol for communication (see figure 21.1). In practice, the term servlet refers to an HTTP servlet.The classic method of constructing dynamic HTML pages on a server is to use CGI (Common Gateway Interface) commands. These take as argument a URL which can contain data coming from an HTML form. The execution then produces a new HTML page which is sent to the client. The following links describe the HTTP and CGI protocols.</code></pre><p>Link : <a href="https://caml.inria.fr/pub/docs/oreilly-book/html/book-ora196.html" target="_blank" rel="noopener">https://caml.inria.fr/pub/docs/oreilly-book/html/book-ora196.html</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> spring </tag>
            
            <tag> j2ee </tag>
            
            <tag> ejb </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Expert One-on-One J2EE Design and Development</title>
      <link href="/2019/03/10/Note_Expert-One-on-One-J2EE-Design-and-Development/"/>
      <url>/2019/03/10/Note_Expert-One-on-One-J2EE-Design-and-Development/</url>
      
        <content type="html"><![CDATA[<p>â€‹    j2eeçš„ç›¸å…³å†å²ï¼Œspringçš„è¯ç”ŸèƒŒæ™¯ï¼Œç†å¿µï¼Œé‡ç‚¹ç« èŠ‚ã€‚ 4ï¼ˆDesign and Standardsï¼‰ã€9ï¼ˆdata accessï¼‰ã€11ï¼ˆInfrastructureï¼‰ã€12-13ï¼ˆweb Tierï¼‰</p><a id="more"></a><p>æœ‰ç‚¹ä¹±ï¼Œå¾…æ•´ç†æ€è·¯</p><ul><li>4 Design Techniques and Coding<br>  Standards for J2EE Projects</li><li><p>9 Practical Data Access</p></li><li><p>11 Infrastructure and Application Implementation </p></li><li><p>12 Web-Tier MVC Design</p></li><li><p>13 Views in the Web Tier</p></li></ul><h3 id="Chapter-1"><a href="#Chapter-1" class="headerlink" title="Chapter 1"></a>Chapter 1</h3><p>J2EE Architectures</p><p>Summary </p><ul><li><p>ä½“ç³»åˆ†å±‚</p><p>  â€‹    EISå±‚ ä¼ä¸šä¿¡æ¯ç³»ç»Ÿå±‚ æ•°æ®è®¿é—®å±‚ï¼Ÿ daoå±‚</p><p>  â€‹    ä¸­é—´å±‚ ä¸šåŠ¡å¯¹è±¡ bizservice</p><p>  â€‹    ç”¨æˆ·æ¥å£å±‚UIå±‚ webå±‚</p><p>  â€‹    web å±‚</p><p>  â€‹        æ¨¡å‹ vo?  Model-&gt; json</p><p>  â€‹        è§†å›¾  html   uiæ¡†æ¶jsp æ¸²æŸ“å¼•æ“ï¼Ÿ-&gt;å‰ç«¯æ§åˆ¶</p><p>  â€‹        æ§åˆ¶å™¨ ä¸åº”è¯¥æœ‰ä¸šåŠ¡é€»è¾‘  è´Ÿè´£è½¬å‘ structâ€”&gt;controller</p><p>  â€‹    æ§åˆ¶æµç¨‹æ˜¯ä¸€ç§ commandçš„è®¾è®¡æ¨¡å¼</p></li></ul><pre><code>å¯ç§»æ¤æ€§ï¼Ÿé€šè¿‡ä½¿ç”¨ä¸€ä¸ªæŠ½è±¡å±‚ï¼ˆAbstraction layerï¼‰ï¼Œå¯ä»¥åˆ©ç”¨æ¾è€¦åˆæŠŠè¯¥åº”ç”¨çš„å¥‡é‡éƒ¨åˆ†ä¸å¿…é¡»ç”¨ä¸€ç§å¹³å°ç‰¹æœ‰æ–¹å¼æ¥å®ç°çš„ä»»ä½•éƒ¨åˆ†éš”ç¦»å¼€ã€‚æŠ½è±¡å±‚æŒ‡ä¸€ä¸ªå…¶æœ¬èº«å°±ç‹¬ç«‹äºå¹³å°çš„æ¥å£ã€‚â€‹    spiçš„æ€æƒ³ã€ æ’æ‹”å¼</code></pre><h3 id="Chapter-2"><a href="#Chapter-2" class="headerlink" title="Chapter 2"></a>Chapter 2</h3><p>é€‰æ‹©ä¸€ä¸ªåº”ç”¨æœåŠ¡å™¨æ ‡å‡† </p><p>â€‹    å¾—åˆ°æ”¯æŒçš„è§„èŒƒ</p><p>â€‹    sunèµ„æº CTS  ECPerf </p><p>â€‹    æˆæœ¬</p><p>â€‹    å¼€å‘ä¸éƒ¨ç½²</p><p>â€‹        å¯åŠ¨é€Ÿåº¦ éƒ¨ç½²é€Ÿåº¦ å†…å­˜éœ€æ±‚</p><p>â€‹        é¢å¤–æ­¥éª¤ã€‚ç¼–å†™éƒ¨ç½²æè¿°ç¬¦ï¼Ÿ</p><p>â€‹        çƒ­éƒ¨ç½²çš„èƒ½åŠ›</p><p>â€‹        æœåŠ¡å™¨æ‰€æä¾›çš„ç®¡ç†å·¥å…·çš„å®Œå–„åº¦</p><p>â€‹        SNMPï¼ˆSimple Network Management Protocolï¼‰å’ŒJMXçš„ç®¡ç†æ ‡å‡†é›†æˆåº¦</p><p>â€‹        è¿è¡Œæ—¶å€™é”™è¯¯æŠ¥å‘Šçš„è´¨é‡    </p><p>â€‹    æ–‡æ¡£è´¨é‡</p><p>â€‹    å¯ç§»æ¤æ€§çš„å«ä¹‰</p><p>â€‹        åº”ç”¨åœ¨åº”ç”¨æœåŠ¡å™¨ä¹‹é—´çš„å¯ä»¥ç§»æ¤æ€§</p><p>â€‹        åº”ç”¨åœ¨æœåŠ¡å™¨æ“ä½œç³»ç»Ÿä¹‹é—´çš„å¯ç§»æ¤æ€§</p><p>â€‹        æ›´æ”¹J2EEåº”ç”¨æ‰€ä¾èµ–çš„é‡è¦èµ„æºçš„èƒ½åŠ› æ•°æ®åº“åˆ‡æ¢ï¼Ÿ</p><p>â€‹    å‘å¸ƒç®¡ç† æŒ‡ï¼šä¿è¯ä¸€ä¸ªåº”ç”¨å‘å¸ƒä»â€˜å¼€å‘â€™ ã€â€˜æµ‹è¯•â€™åˆ°â€˜ç”Ÿäº§â€™åˆ°å‘å±•æ˜¯å¯é€†å’Œå¯é‡å¤çš„</p><h3 id="Chapter3"><a href="#Chapter3" class="headerlink" title="Chapter3"></a>Chapter3</h3><p>â€‹    å•å…ƒæµ‹è¯•çš„é‡è¦æ€§</p><h3 id="Chapter4-J2EEé¡¹ç›®çš„å®é™…æŠ€æœ¯ä¸ç¼–ç¨‹æ ‡å‡†"><a href="#Chapter4-J2EEé¡¹ç›®çš„å®é™…æŠ€æœ¯ä¸ç¼–ç¨‹æ ‡å‡†" class="headerlink" title="Chapter4    J2EEé¡¹ç›®çš„å®é™…æŠ€æœ¯ä¸ç¼–ç¨‹æ ‡å‡†"></a>Chapter4    J2EEé¡¹ç›®çš„å®é™…æŠ€æœ¯ä¸ç¼–ç¨‹æ ‡å‡†</h3><p>â€‹    J2EEåº”ç”¨çš„OOè®¾è®¡æ¨èæ ‡å‡†</p><ul><li><p>åˆ©ç”¨æ¥å£æ¥å®ç°æ¾è€¦åˆ</p></li><li><p>é¦–é€‰å¯¹è±¡åˆæˆè€Œéå…·ä½“ç»§æ‰¿æ€§</p></li><li><p>Template Methodè®¾è®¡æ¨¡å¼  å°†ç‰¹å®šæ­¥éª¤ç•™ç»™å­ç±»å®ç°</p></li><li><p>Strategy  å°†ç‰¹å®šæ­¥éª¤æŠ½æˆä¸€ä¸ªæ¥å£ã€‚åœ¨å…·ä½“ç»§æ‰¿æ€§å’Œæ¥å£å§”æ‰˜ä¹‹é—´è¿›è¡ŒæŠ˜è¡·çš„ä¾‹å­</p></li><li><p>ä½¿ç”¨å›è°ƒæ¥å®ç°å¯æ‰©å±• è¿™æ˜¯Strategyè®¾è®¡æ¨¡å¼çš„ä¸€ç§ç‰¹æ®Šæ¨¡å¼</p></li></ul><p>â€‹            jdbcTemplate</p><p>â€‹                query(String sql,RowCallBackHandler callbackHandler)</p><p>â€‹                public interface RowCallBackHandler{<br>â€‹                        void processRow(ResultSet rs) throws SQLException</p><p>â€‹                }</p><ul><li>Observerè®¾è®¡æ¨¡å¼ã€‚å®ç°å…³ç³»åˆ†ç¦» </li></ul><p>â€‹                ä¾‹å¦‚å¤„ç†ç™»é™†çš„å¯¹è±¡ä¸ºä»€ä¹ˆéœ€è¦çŸ¥é“ç®¡ç†å‘˜çš„ç”µå­é‚®ä»¶åœ°å€ã€æˆ–è€…è¯´å¦‚ä½•å‘é€é‚®ä»¶</p><p>â€‹                æ ¸å¿ƒèŒè´£è¢«æ·¹æ²¡åœ¨ç‰¹æ€§ä¸­</p><p>â€‹                publisher-&gt;events-&gt;Observer</p><ul><li><p>è€ƒè™‘åˆå¹¶æ–¹æ³•å‚æ•° Command</p></li><li><p>å¼‚å¸¸å¤„ç†-å·²æ£€æŸ¥æˆ–æœªæ£€æŸ¥å¼‚å¸¸</p></li></ul><p>â€‹            ä½¿ç”¨å·²æ£€æŸ¥å¼‚å¸¸ä¼šç‰¹æœ‰å¼•èµ·å‡ ä¸ªé—®é¢˜ï¼š</p><p>â€‹                å¤ªå¤šä»£ç </p><p>â€‹                éš¾ä»¥è¯»æ‡‚çš„ä»£ç </p><p>â€‹                å¼‚å¸¸çš„æ— æ­¢ä¼‘å°è£…</p><p>â€‹            ä¸€ä¸ªå¼‚å¸¸ç›¸å½“äºæ¥è‡ªæ–¹æ³•çš„ä¸€ä¸ªå¯æ›¿ä»£è¿”å›å€¼çš„åœ°æ–¹</p><p>â€‹            å·²æ£€æŸ¥å¼‚å¸¸è¦æ¯”é”™è¯¯è¿”å›ç å¥½å¾—å¤š    </p><p>â€‹            å¦‚æœè°ƒç”¨ä»£ç èƒ½å¤Ÿå¯¹è¯¥å¼‚å¸¸åšäº›åˆ‡åˆå®é™…çš„äº‹æƒ…å¯ä»¥ä½¿ç”¨ï¼Œå¦åˆ™ä½¿ç”¨æœªæ£€æŸ¥å¼‚å¸¸RuntimeExceptionï¼Œé€‰æ‹©æ˜¯å¦æ•æ‰ï¼Œä¾èµ–åº”ç”¨æœåŠ¡å™¨å®¹å™¨æ¥æ•æ‰.ï¼ˆè€Œä¸æ˜¯jvmï¼‰    </p><p>â€‹            å¯¹å¼‚å¸¸è¿›è¡Œè¯¦ç»†æå†™</p><ul><li><p>ä½¿ç”¨åå°„ Factory</p><p>  è¯¯è§£ </p><p>  â€‹        ä½¿ç”¨åå°„çš„ä»£ç æ˜¯æ…¢çš„ </p><p>  â€‹        è¿‡åˆ†å¤æ‚</p><p>  â€‹    å¦‚æœä½¿ç”¨å¾—å½“ï¼Œåå°„ä¸ä¼šé™ä½æ€§èƒ½ã€‚æ­£ç¡®ä½¿ç”¨åå°„å®é™…å“ˆæ¡‘åº”è¯¥æ”¹è¿›ä»£ç å¯ç»´æŠ¤æ€§ã€‚</p><p>  â€‹    åå°„çš„ç›´æ¥ä½¿ç”¨åº”è¯¥ä»…å±€é™äºåŸºç¡€ç»“æ„ç±»ã€‚</p></li><li><p>ä½¿ç”¨Javaç»„ä»¶æ¥å®ç°çµæ´»æ€§</p></li><li><p>ä½¿ç”¨åº”ç”¨ç»„å†Œè¡¨æ¥å®ç°å•ä¾‹ Singleton Prototype Factory</p><p>  â€‹    æ”¯æŒæ¥å£</p><p>  â€‹    æ™®é€šjavabean</p><p>  â€‹    é…ç½®æºä¸Šä¸‹æ–‡ç»Ÿä¸€ç®¡ç†</p><p>  â€‹    ä¸ºä»€ä¹ˆä¸é€‚ç”¨jndi ? å¤æ‚ å•ä¸€</p></li></ul><p>ç¼–ç¨‹è§„èŒƒ</p><p>â€‹    ä¸€ä¸ªæ–¹æ³•åªåº”æœ‰ä¸€é¡¹æ˜ç¡®çš„è´£ä»»ï¼Œè€Œä¸”æ‰€æœ‰æ“ä½œéƒ½åº”è¯¥åœ¨åŒä¸€ä¸ªæŠ½è±¡çº§åˆ«ä¸Š</p><p>â€‹    é¿å…ä»£ç é‡å¤</p><p>â€‹    é¿å…å­—é¢å¸¸é‡</p><p>â€‹    å¯è§åº¦å’Œä½œç”¨èŒƒå›´å°½å¯èƒ½å°</p><p>â€‹    å†…éƒ¨ç±»å’Œæ¥å£ é¿å…ç©ºé—´æ±¡æŸ“ </p><p>â€‹    ä½¿ç”¨finalå…³é”®å­—</p><p>â€‹        å¼€æ”¾å¼å°é—­åŸç†ï¼šå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å°é—­ã€‚è¦†ç›–å…·ä½“æ–¹æ³•å®é™…ä¸Šæ˜¯ä¿®æ”¹ã€‚</p><p>â€‹        å’ŒæŠ½è±¡æ–¹æ³•è”åˆä½¿ç”¨ï¼Œä¿æŠ¤è¶…ç±»çš„å®Œæ•´æ€§ã€‚</p><p>â€‹    ä½¿ç”¨ç•Œå®šç¬¦</p><p>å®ç°ä¸€ä¸ªæ¡†æ¶</p><p>â€‹    å‘ç°æœ‰æ¡†æ¶å­¦ä¹ </p><p>â€‹    æ˜ç¡®ç›®æ ‡ ã€ä½œç”¨èŒƒå›´ã€ ç”¨æœ€å°å¤æ‚æ€§æ¥å®ç°æœ€å¤§ä»·å€¼ </p><p>â€‹        Pareto Principleï¼ˆ2/8åŸåˆ™ï¼‰ æŸä¸ªç‰¹å®šåŠŸèƒ½å¾ˆéš¾å®ç°ï¼Œé—®é—®è‡ªå·±æ˜¯ä¸æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œèƒ½ä¸èƒ½å®ç°å…¶ä»·å€¼çš„å¤§éƒ¨åˆ†</p><h3 id="Chapter-5-Chapter-9"><a href="#Chapter-5-Chapter-9" class="headerlink" title="Chapter 5-Chapter 9"></a>Chapter 5-Chapter 9</h3><h4 id="Chpter-6"><a href="#Chpter-6" class="headerlink" title="Chpter 6"></a>Chpter 6</h4><p>é«˜é€Ÿç¼“å­˜ï¼Œå‡å°‘æ²¡å¿…è¦çš„è°ƒç”¨å’Œæ¶ˆè€—</p><p>DATA ACCESS</p><p>DB mysqlè‡ªèº«</p><p>DBç»„ä»¶ hibernateç¼“å­˜</p><p>åº”ç”¨å±‚</p><p>â€‹    åˆ†å¸ƒå¼ç¼“å­˜ redis  </p><p>â€‹    å•æœºjvmç¼“å­˜ map  guava cache  </p><p>HTTP 304</p><h4 id="Chapter-7"><a href="#Chapter-7" class="headerlink" title="Chapter 7"></a>Chapter 7</h4><p>â€‹    RDBMS ä¸ ODBMS</p><p>â€‹    èŒƒå¼åŒ–æ•°æ® æ¶ˆé™¤æ•°æ®å†—ä½™åº¦</p><p>â€‹    O/R æ˜ å°„ å°è¯•å°†Javaå¯¹è±¡çš„çŠ¶æ€æ˜ å°„åˆ°RDMBMSä¸Š</p><p>â€‹    ç”¨äºOLTPï¼Œä¸é€‚ç”¨äºOLAP</p><h4 id="Chapter-8"><a href="#Chapter-8" class="headerlink" title="Chapter 8"></a>Chapter 8</h4><p>â€‹    å…³äºSession Beans å’Œ Entity Beansçš„è®¨è®º</p><p>â€‹    å®ä½“ç»„ä»¶ åˆ†å¸ƒå¼ã€å…±äº«çš„ã€äº‹åŠ¡æ€§ã€æŒä¹…æ€§å¯¹è±¡</p><p>â€‹    Entity Bean æ˜¯ä¸€ç§ç³Ÿç³•çš„è®¾è®¡ ï¼Œä¸åº”è¯¥ç»‘å®šåœ¨EJBå®¹å™¨ä¸Šï¼Œåº”è¯¥äº¤ç”±ä¸“ç”¨çš„æ–¹æ¡ˆè§£å†³</p><p>â€‹    æ— æ³•ç»§æ‰¿ï¼Œä¸å…·å¤‡javaå¯¹è±¡</p><h4 id="Chapter-9-å®é™…æ•°æ®å­˜å–"><a href="#Chapter-9-å®é™…æ•°æ®å­˜å–" class="headerlink" title="Chapter 9 å®é™…æ•°æ®å­˜å–"></a>Chapter 9 å®é™…æ•°æ®å­˜å–</h4><p>JDBCTemplete</p><p>â€‹    è¾ƒé«˜çº§çš„æŠ½è±¡ RDBMSå»ºæ¨¡ä¸ºJavaå¯¹è±¡</p><h3 id="Chapter-11"><a href="#Chapter-11" class="headerlink" title="==Chapter 11=="></a>==Chapter 11==</h3><h5 id="The-Problem"><a href="#The-Problem" class="headerlink" title="The Problem"></a>The Problem</h5><p>â€‹    Without such infrastructure, configuration management is usually haphazard. J2EE applications often hold configuration in a variety of formats, such as properties files, XML documents (an increasingly popular choice), EJB JAR and WAR development descriptors, and database tables. </p><p>â€‹    æ²¡æœ‰è¿™æ ·çš„åŸºç¡€è®¾æ–½ï¼Œé…ç½®ç®¡ç†é€šå¸¸æ˜¯éšæ„çš„ã€‚ J2EEåº”ç”¨ç¨‹åºé€šå¸¸ä»¥å„ç§æ ¼å¼è¿›è¡Œé…ç½®ï¼Œä¾‹å¦‚å±æ€§æ–‡ä»¶ï¼ŒXMLæ–‡æ¡£ï¼ˆè¶Šæ¥è¶Šæµè¡Œçš„é€‰æ‹©ï¼‰ï¼ŒEJB JARå’ŒWARå¼€å‘æè¿°ç¬¦ä»¥åŠæ•°æ®åº“è¡¨ã€‚</p><p>More seriously, application classes are bloated by configuration management code irrelevant to business responsibilities</p><p>åº”ç”¨ç¨‹åºç±»å› ä¸ä¸šåŠ¡èŒè´£æ— å…³çš„é…ç½®ç®¡ç†ä»£ç è€Œè†¨èƒ€ã€‚</p><p>Equally harmfully, without a central infrastructure for configuration management, application code is to<br>likely to use variety to approaches to locating application objects. The Singleton design pattern is often<br>overused, resulting in problems weâ€™ll discuss below. Alternatively, some application objects may be bound<br>to JNDI or attached to the global ServletContext (in web applications), both of which approaches<br>may complicate testing outside a JNDI server. Each application object is usually reconfigured<br>independently.</p><p>â€‹    é€šè¿‡å„ç§æ–¹å¼å»è·å–é…ç½®ã€‚æ¯ä¸ªåº”ç”¨ç¨‹åºå¯¹è±¡é€šå¸¸éƒ½æ˜¯ç‹¬ç«‹é‡æ–°é…ç½®çš„ã€‚</p><h5 id="Using-a-Framework-to-Configure-Application-Components"><a href="#Using-a-Framework-to-Configure-Application-Components" class="headerlink" title="Using a Framework to Configure Application Components"></a>Using a Framework to Configure Application Components</h5><p>å¤–éƒ¨åŒ–é…ç½®å’ŒOOè®¾è®¡</p><p>ä½¿ç”¨javaBean beanWapper</p><h6 id="Using-JavaBeans"><a href="#Using-JavaBeans" class="headerlink" title="Using JavaBeans"></a>Using JavaBeans</h6><p>â€‹    If we make all application components JavaBeans, we maximize our ability to separate </p><p>configuration data from application code </p><p>â€‹    However, manipulating beans is more complex, and requires the use of<br>reflection to instantiate objects and invoke methods by name. The core JavaBeans API does not provide<br>the ability to perform some useful operations on beans, such as</p><p>why ï¼Ÿ</p><p>â€‹    This provides the ability to manipulate beanseasily and adds the enhanced functionality described above, while respecting andavoiding duplicating the standard JavaBeans infrastructure.(andavoidingé¿å…)</p><h6 id="Using-a-â€œBean-Factoryâ€"><a href="#Using-a-â€œBean-Factoryâ€" class="headerlink" title="Using a â€œBean Factoryâ€"></a>Using a â€œBean Factoryâ€</h6><p>why?</p><p>â€‹    The com.interface21.beans.factory package defines a way of obtaining beans by<br>name from a central configuration repository using a â€œbean factoryâ€. ==The goal of a bean==<br>==factory is to remove any need for individual Java objects to read configuration properties==<br>==or instantiate objects. Instead, configuration is read by a central component, the bean==<br>==factory, and the bean properties exposed by each application object are set to reflect==<br>configuration data.== The factory then makes available instances of beans, each with a<br>unique name. Sophisticated object graphs can be created within the bean factory, as<br>managed beans may reference other beans within the same factory.</p><p>å¯¹å¤–æš´éœ²BeanWapper</p><h6 id="Application-Context-Goals"><a href="#Application-Context-Goals" class="headerlink" title="Application Context Goals"></a>Application Context Goals</h6><p>â€‹    Building on the bean factory, an application context provides a namespace for the JavaBeans that compose an application or subsystem, and the ability to share working objects at run time. The com.interface21.context.ApplicationContext interface extends the ListableBeanFact interface, adding the ability to: </p><p>o Publish events using the Observer design pattern. As we discussed in Chapter 4, the Observer design pattern provides the ability to decouple application components and achieve clean separation of concerns. </p><p>o Participate in a hierarchy of application contexts. Application contexts can have parent contexts, allowing developers to choose the amount of configuration shared between subsystems. </p><p>o Share working objects between application components at run time. </p><p>o Look up messages by string name, allowing support for internationalization. </p><p>o Facilitate testing. With an application context, as well as a bean factory, itâ€™s often possible to provide a test implementation that enables application code to be tested outside an application server. </p><p>o Provide consistent configuration management in different types of applications. Application contexts behave the same way in different kinds of applications, such as Swing GUI applications or web applications, and inside and outside a J2EE application server. </p><p>webå±‚ ï¼ˆä¸æ˜¯æœ¬å‘¨é‡ç‚¹ï¼‰</p><p>æ€§èƒ½æ¡†æ¶æµ‹è¯•ï¼ˆä¸æ˜¯æœ¬å‘¨é‡ç‚¹ï¼‰</p>]]></content>
      
      
      
        <tags>
            
            <tag> spring </tag>
            
            <tag> j2ee </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Overview-Spring</title>
      <link href="/2019/03/02/Overview_Spring/"/>
      <url>/2019/03/02/Overview_Spring/</url>
      
        <content type="html"><![CDATA[<p>é˜…è¯»çš„ç›®çš„ï¼Ÿæˆ‘æƒ³è¦ä»ä¸­è·å¾—ä»€ä¹ˆï¼Ÿ</p><p>â€‹    springå‘å±•å†å²çš„æ€»ç»“ï¼Œå‡ºç°çš„èƒŒæ™¯ï¼Œä»¥åŠç›¸å…³å†…å®¹çš„æ€»ç»“</p><a id="more"></a><h2 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h2><p>â€‹    <a href="https://en.wikipedia.org/wiki/Spring_Framework" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Spring_Framework</a></p><p>â€‹    <a href="https://docs.spring.io/spring/docs/" target="_blank" rel="noopener">https://docs.spring.io/spring/docs/</a></p><h3 id="Spring-å‘å±•å²"><a href="#Spring-å‘å±•å²" class="headerlink" title="Spring å‘å±•å²"></a>Spring å‘å±•å²</h3><p> ä¸‹é¢è®²springåˆ†æˆå‡ ä¸ªé˜¶æ®µ</p><h4 id="ç”±æ¥"><a href="#ç”±æ¥" class="headerlink" title="ç”±æ¥"></a>ç”±æ¥</h4><h5 id="å¼€ç«¯-J2EE"><a href="#å¼€ç«¯-J2EE" class="headerlink" title="å¼€ç«¯ J2EE"></a>å¼€ç«¯ J2EE</h5><p>â€‹    è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿä¸ºä»€ä¹ˆéœ€è¦ï¼Ÿ</p><p>â€‹        applications are often slow, unduly complex, and take too long to develop.Rod Johnson believes that the problem lies not in J2EE itself, but in that it is often used badly</p><p>â€‹    Rod Johnson 2002-10 å†™äº† Expert One-on-One J2EE Design and Development </p><p>â€‹    åœ¨è¿™ æœ¬ä¹¦ä¸­ è®²è§£äº†ä½•æ—¶ä½¿ç”¨EJBï¼ˆéœ€è¦åˆ†å¸ƒå¼äº‹åŠ¡å’Œæ¶ˆæ¯çš„æ—¶å€™ä½¿ç”¨ï¼‰ ä»¥åŠJ2EEèµ°å‘ä½•æ–¹ï¼Œå†™äº†interface21åŒ… æ¥ç®€åŒ–J2EEçš„å¼€å‘ï¼Œæå‡ºäº†using a Framework to Configure Application Components ï¼Œå…¶ä¸­æåŠ ä½¿ç”¨ javaBeansã€ BeanFactoryã€applictionContext (ç®€åŒ–ã€å‚è€ƒejb)æ¥ç®€åŒ–J2EEå¼€å‘ï¼Œ ä»¥åŠå¦‚ä½•ç®€åŒ–EJBçš„ä½¿ç”¨ ï¼Œé€šè¿‡æŠ½è±¡EJBçš„ Beanï¼Œå°†ä½¿ç”¨EJBçš„ä»£ç ä¸ä¾èµ–JNDIå’ŒEJB APIçš„ä»£ç åˆ†ç¦»ã€‚</p><p>â€‹    åŒå¹´ï¼Œ å¼€æºäº†interface21ï¼Œ å¹¶æ”¹åä¸º spring</p><p>â€‹    2003 å¹´6æœˆ  å‘å¸ƒ spring0.9</p><p>â€‹    2004-3 å‘å¸ƒ spring 1.0 XML Bean Definitions</p><p>â€‹               Spring MVC</p><p>â€‹               spring 1.2    æ”¯æŒæ³¨è§£ï¼Œè¦æ±‚jdk1.5</p><p>â€‹                ç²˜åˆå‰‚     æŠŠStruts,Hibernateç­‰é»åˆåˆ°ä¸€èµ·ï¼Œå²ç§°SSHã€‚ </p><h5 id="ç¹ççš„EJB-ï¼šInversion-of-Control-Dependency-Injection"><a href="#ç¹ççš„EJB-ï¼šInversion-of-Control-Dependency-Injection" class="headerlink" title="ç¹ççš„EJB ï¼šInversion of Control / Dependency Injection"></a>ç¹ççš„EJB ï¼šInversion of Control / Dependency Injection</h5><p>â€‹    è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿä¸ºä»€ä¹ˆéœ€è¦ï¼Ÿ</p><p>â€‹        In early 2004, Martin Fowler asked the readers of his site: when talking about Inversion of Control: â€œthe question is, what aspect of control are [they] inverting?â€</p><p>â€‹        æˆ‘ä»¬æ›¾ç»åœ¨æ— æ•°çš„ä¹¦ç±å’Œæ–‡ç« ä¸­çœ‹åˆ°ï¼ŒEJBæ˜¯J2EEçš„æ ¸å¿ƒæŠ€æœ¯ä¹‹ä¸€ï¼ŒEJBå¤ªç¹çï¼Œçº¦æŸå¤ªå¤šï¼Œä¾èµ–EJBå®¹å™¨ï¼Œè½»é‡çº§j2ee</p><p>â€‹    Rod Johnsonç­‰å†™äº†</p><p>â€‹    2004-6  J2EE Development without EJBï¼ˆè®¨è®ºäº†æˆ‘ä»¬çœŸæ­£éœ€è¦EJBçš„ä»€ä¹ˆï¼Œå¦‚ä½•åŒæ ·å®ç°è¿™äº›åŠŸèƒ½ï¼‰</p><p>â€‹    2005-7  Professional Java Development with the Spring Framework</p><p>â€‹    </p><h5 id="Annotation"><a href="#Annotation" class="headerlink" title="Annotation"></a>Annotation</h5><p>â€‹    è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿä¸ºä»€ä¹ˆéœ€è¦ï¼Ÿ</p><p>â€‹        åŸºäºæ³¨è§£çš„ä¾èµ–æ³¨å…¥å’Œç»„ä»¶æ‰«æ @Autowise @Configurable</p><p>â€‹    2006å¹´å‘å¸ƒSpring 2.0 </p><p>â€‹        Ruby on Railsçš„æ¡†æ¶çªç„¶å´›èµ·ï¼Œçº¦å®šé‡äºé…ç½®ï¼ŒDonâ€™t repeat yourselfçš„æ€æƒ³éšç€RoRæ·±å…¥äººå¿ƒã€‚</p><p>â€‹    2007å¹´å‘å¸ƒSpring 2.5 ã€‚</p><p>â€‹    2009å¹´Spring 3.0 RESTfulçš„æ”¯æŒ</p><p>â€‹    </p><h5 id="å¾®æœåŠ¡çš„å´›èµ·"><a href="#å¾®æœåŠ¡çš„å´›èµ·" class="headerlink" title="å¾®æœåŠ¡çš„å´›èµ·"></a>å¾®æœåŠ¡çš„å´›èµ·</h5><p>â€‹    è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿä¸ºä»€ä¹ˆéœ€è¦ï¼Ÿ</p><p>â€‹        xmlé…ç½®ç¹çï¼Œè‡ªåŠ¨è£…é…springbootï¼Œ å¾®æœåŠ¡ç­‰å…´èµ· </p><p>â€‹    2013å¹´12æœˆ Spring4.0 æ”¯æŒjdk8</p><p>â€‹    2014  Spring Boot çº¦å®šå¤§äºé…ç½®</p><p>â€‹    2015 Spring Cloud</p><h5 id="ååº”å¼ç¼–ç¨‹"><a href="#ååº”å¼ç¼–ç¨‹" class="headerlink" title="ååº”å¼ç¼–ç¨‹"></a>ååº”å¼ç¼–ç¨‹</h5><p>â€‹    è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿä¸ºä»€ä¹ˆéœ€è¦ï¼Ÿ</p><p>â€‹        é«˜å¹¶å‘ï¼ŒIOå¯†é›†å‹åº”ç”¨ï¼ŒåŒæ­¥é˜»å¡çš„æ¨¡å‹ï¼Œå—è¿æ¥æ± ç­‰çº¦æŸï¼Œååº”å¼ç¼–ç¨‹ reactive stream</p><p>â€‹    2017å¹´9æœˆ     Spring 5.0  WebFlux</p><h4 id="ç‰ˆæœ¬ç‰¹å¾"><a href="#ç‰ˆæœ¬ç‰¹å¾" class="headerlink" title="ç‰ˆæœ¬ç‰¹å¾"></a>ç‰ˆæœ¬ç‰¹å¾</h4><table><thead><tr><th>Version</th><th>Date</th><th>Notes</th></tr></thead><tbody><tr><td>0.9</td><td>2002</td><td></td></tr><tr><td>1.0</td><td>2003</td><td></td></tr><tr><td>2.0</td><td>2006</td><td></td></tr><tr><td>3.0</td><td>2009</td><td></td></tr><tr><td>4.0</td><td>2013</td><td></td></tr><tr><td>5.0</td><td>2017</td></tr></tbody></table><blockquote><p>â€‹    The first version was written by <a href="https://en.wikipedia.org/wiki/Rod_Johnson_(programmer" target="_blank" rel="noopener">Rod Johnson</a>), who released the framework with the publication of his book <em>Expert One-on-One J2EE Design and Development</em> in October 2002. The framework was first released under the <a href="https://en.wikipedia.org/wiki/Apache_License" target="_blank" rel="noopener">Apache 2.0 license</a> in June 2003. The first milestone release, 1.0, was released in March 2004 with further milestone releases in September 2004 and March 2005. The Spring 1.2.6 framework won a <a href="https://en.wikipedia.org/wiki/Jolt_Awards" target="_blank" rel="noopener">Jolt productivity award</a> and a <a href="https://en.wikipedia.org/w/index.php?title=JAX_Innovation_Award&amp;action=edit&amp;redlink=1" target="_blank" rel="noopener">JAX (Java API for XML) Innovation Award</a> in 2006.<a href="https://en.wikipedia.org/wiki/Spring_Framework#cite_note-2" target="_blank" rel="noopener">[2]</a><a href="https://en.wikipedia.org/wiki/Spring_Framework#cite_note-3" target="_blank" rel="noopener">[3]</a> Spring 2.0 was released in October 2006, Spring 2.5 in November 2007, Spring 3.0 in December 2009, Spring 3.1 in December 2011, and Spring 3.2.5 in November 2013.<a href="https://en.wikipedia.org/wiki/Spring_Framework#cite_note-4" target="_blank" rel="noopener">[4]</a> Spring Framework 4.0 was released in December 2013.<a href="https://en.wikipedia.org/wiki/Spring_Framework#cite_note-5" target="_blank" rel="noopener">[5]</a> Notable improvements in Spring 4.0 included support for Java SE (Standard Edition) 8, <a href="https://en.wikipedia.org/wiki/Groovy_(programming_language" target="_blank" rel="noopener">Groovy</a>) 2, some aspects of Java EE 7, and <a href="https://en.wikipedia.org/wiki/WebSocket" target="_blank" rel="noopener">WebSocket</a>.</p><p>â€‹    Spring Framework 4.2.0 was released on 31 July 2015 and was immediately upgraded to version 4.2.1, which was released on 01 Sept 2015.<a href="https://en.wikipedia.org/wiki/Spring_Framework#cite_note-6" target="_blank" rel="noopener">[6]</a> It is <em>â€œcompatible with Java 6, 7 and 8, with a focus on core refinements and modern web capabilitiesâ€</em>.<a href="https://en.wikipedia.org/wiki/Spring_Framework#cite_note-7" target="_blank" rel="noopener">[7]</a></p><p>Spring Framework 4.3 has been released on 10 June 2016 and will be supported until 2020.<a href="https://en.wikipedia.org/wiki/Spring_Framework#cite_note-8" target="_blank" rel="noopener">[8]</a> It <em>â€œwill be the final generation within the general Spring 4 system requirements (Java 6+, Servlet 2.5+), [â€¦]â€</em>.<a href="https://en.wikipedia.org/wiki/Spring_Framework#cite_note-9" target="_blank" rel="noopener">[9]</a></p><p>Spring 5 is announced to be built upon <a href="https://en.wikipedia.org/wiki/Reactive_Streams" target="_blank" rel="noopener">Reactive Streams</a> compatible Reactor Core.<a href="https://en.wikipedia.org/wiki/Spring_Framework#cite_note-10" target="_blank" rel="noopener">[10]</a></p></blockquote><h3 id="JavaBeansçš„å‘å±•å²"><a href="#JavaBeansçš„å‘å±•å²" class="headerlink" title="JavaBeansçš„å‘å±•å²"></a>JavaBeansçš„å‘å±•å²</h3><h4 id="å®¢æˆ·ç«¯"><a href="#å®¢æˆ·ç«¯" class="headerlink" title="å®¢æˆ·ç«¯"></a>å®¢æˆ·ç«¯</h4><p>â€‹    ä¸€å¼€å§‹çš„ç›®æ ‡æ˜¯å®¢æˆ·ç«¯</p><p>javaBeans</p><p>ã€ŠjavaBeansè§„èŒƒã€‹</p><ol><li>è¿™ä¸ªç±»éœ€è¦æ˜¯public çš„ï¼Œ ç„¶åéœ€è¦æœ‰ä¸ªæ— å‚æ•°çš„æ„é€ å‡½æ•°</li><li>è¿™ä¸ªç±»çš„å±æ€§åº”è¯¥æ˜¯private çš„ï¼Œ é€šè¿‡setXXX()å’ŒgetXXX()æ¥è®¿é—®</li><li>è¿™ä¸ªç±»éœ€è¦èƒ½æ”¯æŒâ€œäº‹ä»¶â€ï¼Œ ä¾‹å¦‚addXXXXListener(XXXEvent e),  äº‹ä»¶å¯ä»¥æ˜¯Clickäº‹ä»¶ï¼ŒKeyboardäº‹ä»¶ç­‰ç­‰ï¼Œ å½“ç„¶å’±ä»¬ä¹Ÿæ”¯æŒè‡ªå®šä¹‰çš„äº‹ä»¶ã€‚ </li><li>æˆ‘ä»¬å¾—æä¾›ä¸€ä¸ªæ‰€è°“çš„è‡ªçœ/åå°„æœºåˆ¶ï¼Œ è¿™æ ·èƒ½åœ¨è¿è¡Œæ—¶æŸ¥çœ‹java bean çš„å„ç§ä¿¡æ¯â€œ</li><li>è¿™ä¸ªç±»åº”è¯¥æ˜¯å¯ä»¥åºåˆ—åŒ–çš„ï¼Œ å³å¯ä»¥æŠŠbeançš„çŠ¶æ€ä¿å­˜çš„ç¡¬ç›˜ä¸Šï¼Œ ä»¥ä¾¿ä»¥åæ¥æ¢å¤ã€‚ </li></ol><h4 id="Model"><a href="#Model" class="headerlink" title="Model"></a>Model</h4><p>â€‹    Model-View-Controller  -ã€‹struct -ã€‰spring</p><h4 id="Enterprise-Java-bean"><a href="#Enterprise-Java-bean" class="headerlink" title="Enterprise Java bean"></a>Enterprise Java bean</h4><h5 id="J2EE"><a href="#J2EE" class="headerlink" title="J2EE"></a>J2EE</h5><p>â€‹    1998å¹´å‘è¡¨ JDK1.2 å¹¶åˆ†ä¸ºæ ‡å‡†ç‰ˆ(Standard Editionï¼Œ<a href="https://baike.baidu.com/item/J2SE" target="_blank" rel="noopener">J2SE</a>), ä¼ä¸šç‰ˆ(Enterprise Editionï¼ŒJ2EE)ï¼Œå¾®å‹ç‰ˆ(MicroEditionï¼Œ<a href="https://baike.baidu.com/item/J2ME" target="_blank" rel="noopener">J2ME</a>)ã€‚J2EEä¾¿ç”±æ­¤è¯ç”Ÿã€‚</p><p>â€‹    å››å±‚æ¨¡å‹</p><p>â€‹        å®¢æˆ·å±‚ç»„ä»¶ ï¼šè¿è¡Œåœ¨å®¢æˆ·ç«¯æœºå™¨ä¸Šçš„å®¢æˆ·å±‚ç»„ä»¶</p><p>â€‹        session bean</p><p>â€‹        webå±‚ç»„ä»¶ ï¼šè¿è¡Œåœ¨J2EE<a href="https://baike.baidu.com/item/%E6%9C%8D%E5%8A%A1%E5%99%A8" target="_blank" rel="noopener">æœåŠ¡å™¨</a>ä¸Š,java Servletå’ŒJavaServer Pages(JSPï¼‰æ˜¯webå±‚ç»„ä»¶</p><p>â€‹        entity Bean</p><p>â€‹        ä¸šåŠ¡å±‚ç»„ä»¶:  è¿è¡Œåœ¨J2EEæœåŠ¡å™¨ä¸Š,Enterprise JavaBeans(EJBï¼‰æ˜¯ä¸šåŠ¡å±‚ç»„ä»¶.</p><p>â€‹        message-driven beans.</p><p>â€‹        ä¿¡æ¯ç³»ç»Ÿå±‚ : EISæœåŠ¡å™¨ä¸Šçš„<a href="https://baike.baidu.com/item/%E4%BC%81%E4%B8%9A%E4%BF%A1%E6%81%AF%E7%B3%BB%E7%BB%9F" target="_blank" rel="noopener">ä¼ä¸šä¿¡æ¯ç³»ç»Ÿ</a>ï¼ˆEnterprise information systemï¼‰å±‚è½¯ä»¶</p><p>â€‹                </p><h5 id="J2EE-ç²˜åˆå‰‚ï¼šEJB"><a href="#J2EE-ç²˜åˆå‰‚ï¼šEJB" class="headerlink" title="J2EE ç²˜åˆå‰‚ï¼šEJB"></a>J2EE ç²˜åˆå‰‚ï¼šEJB</h5><p>â€‹    EJB(Enterprise JavaBean) æ˜¯J2EEçš„ä¸€ç§è§„èŒƒã€‚è®¾è®¡ç›®æ ‡ä¸æ ¸å¿ƒåº”ç”¨æ˜¯éƒ¨ç½²åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºã€‚</p><p>â€‹    EJB 1.0 (1998-03-24)</p><p>â€‹    EJB 2.0, final release (2001-08-22)</p><p>â€‹    EJB 3.0, final release (2006-05-11)</p><p>â€‹        JDBC</p><p>â€‹        JNDI</p><p>â€‹        RMI</p><p>â€‹        JMS</p><p>â€‹        JTA</p><p>â€‹        Java mail</p><p>â€‹        éƒ¨ç½²ã€é›†ç¾¤</p><h4 id="POJO"><a href="#POJO" class="headerlink" title="POJO"></a>POJO</h4><p>â€‹    EJBå®¹å™¨ï¼šEnterprise java bean å®¹å™¨ã€‚æ›´å…·æœ‰è¡Œä¸šé¢†åŸŸç‰¹è‰²ã€‚ä»–æä¾›ç»™è¿è¡Œåœ¨å…¶ä¸­çš„ç»„ä»¶EJBå„ç§ç®¡ç†åŠŸèƒ½</p><p>â€‹    -ã€‹JavaBeanå®¹å™¨</p><p>â€‹    è½»é‡çº§javaBeans æ²¡æœ‰è§„èŒƒ</p><p>â€‹    spring</p><h3 id="Spring-Framework-Module"><a href="#Spring-Framework-Module" class="headerlink" title="Spring Framework Module"></a>Spring Framework Module</h3><p>Show a picture (ä»spring 4.3.xä¸­æ‰’çš„ï¼Œå› ä¸ºspring5çš„æ‰¾ä¸åˆ°è¿™ä¸ªmoduleå›¾äº†)</p><p><img src="https://ws3.sinaimg.cn/large/006tKfTcgy1g0pnp0m1luj313l0u0ju7.jpg" alt="image-20190303154934664"></p><p>The Spring Framework includes several modules that provide a range of services:</p><ul><li>Spring Core Container: this is the base module of Spring and provides spring containers (BeanFactory and ApplicationContext).<a href="https://en.wikipedia.org/wiki/Spring_Framework#cite_note-11" target="_blank" rel="noopener">[11]</a></li><li><a href="https://en.wikipedia.org/wiki/Aspect-oriented_programming" target="_blank" rel="noopener">Aspect-oriented programming</a>: enables implementing <a href="https://en.wikipedia.org/wiki/Cross-cutting_concern" target="_blank" rel="noopener">cross-cutting concerns</a>.</li><li><a href="https://en.wikipedia.org/wiki/Authentication" target="_blank" rel="noopener">Authentication</a> and <a href="https://en.wikipedia.org/wiki/Authorization" target="_blank" rel="noopener">authorization</a>: configurable security processes that support a range of standards, protocols, tools and practices via the <a href="https://en.wikipedia.org/wiki/Spring_Security" target="_blank" rel="noopener">Spring Security</a> sub-project (formerly Acegi Security System for Spring).</li><li><a href="https://en.wikipedia.org/wiki/Convention_over_configuration" target="_blank" rel="noopener">Convention over configuration</a>: a rapid application development solution for Spring-based enterprise applications is offered in the <a href="https://en.wikipedia.org/wiki/Spring_Roo" target="_blank" rel="noopener">Spring Roo</a> module</li><li><a href="https://en.wikipedia.org/wiki/Data_access" target="_blank" rel="noopener">Data access</a>: working with <a href="https://en.wikipedia.org/wiki/RDBMS" target="_blank" rel="noopener">relational database management systems</a> on the Java platform using <a href="https://en.wikipedia.org/wiki/Java_Database_Connectivity" target="_blank" rel="noopener">Java Database Connectivity</a> (JDBC) and <a href="https://en.wikipedia.org/wiki/Object-relational_mapping" target="_blank" rel="noopener">object-relational mapping</a> tools and with <a href="https://en.wikipedia.org/wiki/NoSQL" target="_blank" rel="noopener">NoSQL</a> databases</li><li><a href="https://en.wikipedia.org/wiki/Inversion_of_control" target="_blank" rel="noopener">Inversion of control</a> container: configuration of application components and lifecycle management of Java objects, done mainly via <a href="https://en.wikipedia.org/wiki/Dependency_injection" target="_blank" rel="noopener">dependency injection</a></li><li>Messaging: configurative registration of message listener objects for transparent message-consumption from <a href="https://en.wikipedia.org/wiki/Message_queue" target="_blank" rel="noopener">message queues</a> via <a href="https://en.wikipedia.org/wiki/Java_Message_Service" target="_blank" rel="noopener">Java Message Service</a> (JMS), improvement of message sending over standard JMS APIs</li><li><a href="https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller" target="_blank" rel="noopener">Modelâ€“viewâ€“controller</a>: an <a href="https://en.wikipedia.org/wiki/HTTP" target="_blank" rel="noopener">HTTP</a>- and <a href="https://en.wikipedia.org/wiki/Java_Servlet_API" target="_blank" rel="noopener">servlet</a>-based framework providing hooks for extension and customization for web applications and <a href="https://en.wikipedia.org/wiki/REST" target="_blank" rel="noopener">RESTful</a> (representational state transfer) Web services.</li><li>Remote access framework: configurative <a href="https://en.wikipedia.org/wiki/Remote_procedure_call" target="_blank" rel="noopener">remote procedure call</a> (RPC)-style <a href="https://en.wikipedia.org/wiki/Marshalling_(computer_science" target="_blank" rel="noopener">marshalling</a>) of Java objects over networks supporting <a href="https://en.wikipedia.org/wiki/Java_remote_method_invocation" target="_blank" rel="noopener">Java remote method invocation</a> (RMI), <a href="https://en.wikipedia.org/wiki/CORBA" target="_blank" rel="noopener">CORBA</a> (Common Object Request Broker Architecture) and <a href="https://en.wikipedia.org/wiki/HTTP" target="_blank" rel="noopener">HTTP</a>-based protocols including <a href="https://en.wikipedia.org/wiki/Web_services" target="_blank" rel="noopener">Web services</a> (<a href="https://en.wikipedia.org/wiki/SOAP_(protocol" target="_blank" rel="noopener">SOAP (Simple Object Access Protocol)</a>))</li><li><a href="https://en.wikipedia.org/wiki/Transaction_processing" target="_blank" rel="noopener">Transaction management</a>: unifies several transaction management APIs and coordinates transactions for Java objects</li><li>Remote management: configurative exposure and management of Java objects for local or remote configuration via <a href="https://en.wikipedia.org/wiki/Java_Management_Extensions" target="_blank" rel="noopener">Java Management Extensions</a> (JMX)</li><li><a href="https://en.wikipedia.org/wiki/Software_testing" target="_blank" rel="noopener">Testing</a>: support classes for writing unit tests and integration tests</li></ul><h3 id="springç†å¿µ"><a href="#springç†å¿µ" class="headerlink" title="springç†å¿µ"></a>springç†å¿µ</h3><h4 id="æ ¸å¿ƒIOCå’ŒAOP"><a href="#æ ¸å¿ƒIOCå’ŒAOP" class="headerlink" title="æ ¸å¿ƒIOCå’ŒAOP"></a>æ ¸å¿ƒIOCå’ŒAOP</h4><p>â€‹    javaEEçš„æœåŠ¡éƒ½è¢«æŠ½è±¡åˆ°Iocå®¹å™¨ä¸­ï¼Œå¹¶é€šè¿‡AOPè¿›è¡Œæœ‰æ•ˆå°è£…ï¼Œå› ä¸ºä¾èµ–æ³¨å…¥åˆ°ç‰¹æ€§ï¼Œè¿™äº›å¤æ‚çš„ä¾èµ–å…³ç³»çš„ç®¡ç†è¢«åè½¬å¹¶äº¤ç»™å®¹å™¨ï¼Œä½¿å¤æ‚çš„ä¾èµ–å…³ç³»ç®¡ç†ä»åº”ç”¨è§£æ”¾å‡ºæ¥ã€‚</p><h4 id="éä¾µå…¥å¼ã€é¢å‘æ¥å£ã€ä½“ç³»ç»“æ„çš„é€‰æ‹©"><a href="#éä¾µå…¥å¼ã€é¢å‘æ¥å£ã€ä½“ç³»ç»“æ„çš„é€‰æ‹©" class="headerlink" title="éä¾µå…¥å¼ã€é¢å‘æ¥å£ã€ä½“ç³»ç»“æ„çš„é€‰æ‹©"></a>éä¾µå…¥å¼ã€é¢å‘æ¥å£ã€ä½“ç³»ç»“æ„çš„é€‰æ‹©</h4><h4 id="interface21-ã€‹spring"><a href="#interface21-ã€‹spring" class="headerlink" title="interface21-ã€‹spring"></a>interface21-ã€‹spring</h4><p>â€‹    ç”Ÿæ€çš„ä¸°å¯Œï¼Œå¾—åˆ°j2eeæœåŠ¡çš„æœ‰åŠ›æ”¯æŒï¼Œä½¿åº”ç”¨æ›´å…³æ³¨ä¸šåŠ¡é€»è¾‘ï¼Œä¾‹å¦‚äº‹åŠ¡ã€æŒä¹…åŒ–jdbc ormã€æ ¡éªŒã€å®‰å…¨ã€rmiã€webMvcã€æ¶ˆæ¯ç­‰</p><h4 id="é¢å‘æ¥å£å¼€å‘"><a href="#é¢å‘æ¥å£å¼€å‘" class="headerlink" title="é¢å‘æ¥å£å¼€å‘"></a>é¢å‘æ¥å£å¼€å‘</h4><p>â€‹    ä¾‹å¦‚ ORM å¯ä»¥ä½¿ç”¨mybatis å’Œ hibernate</p><h4 id="åº”ç”¨å¹³å°ï¼ˆä½“ç³»ç»“æ„çš„é€‰æ‹©ï¼‰"><a href="#åº”ç”¨å¹³å°ï¼ˆä½“ç³»ç»“æ„çš„é€‰æ‹©ï¼‰" class="headerlink" title="åº”ç”¨å¹³å°ï¼ˆä½“ç³»ç»“æ„çš„é€‰æ‹©ï¼‰"></a>åº”ç”¨å¹³å°ï¼ˆä½“ç³»ç»“æ„çš„é€‰æ‹©ï¼‰</h4><p>â€‹    å®ƒä¸ä¼šä¸ç¬¬ä¸‰æ–¹çš„è§£å†³æ–¹æ¡ˆè¿›è¡Œç«äº‰ï¼Œè€Œæ˜¯è‡´åŠ›äºä¸ºåº”ç”¨æä¾›ä½¿ç”¨ä¼˜ç§€æ–¹æ¡ˆçš„é›†æˆå¹³å°ã€‚è®©ç”¨æˆ·å¯¹å…·ä½“æŠ€æœ¯æ–¹æ¡ˆæ‹¥æœ‰ä½¿ç”¨æƒï¼ŒAopé›†æˆäº†aspectJæ¡†æ¶ åŒæ—¶ä¹Ÿæœ‰proxyFactoryä»£ç†å·¥å‚ï¼ˆjvmåŠ¨æ€ã€cglibç¬¬ä¸‰æ–¹ï¼‰ï¼ŒMvcæ¨¡å¼ä¸æ˜¯æŒ‡springMvc ï¼Œè€Œæ˜¯ä¸å±äºGOF23çš„ä¸€ç§è®¾è®¡æ¨¡å¼</p>]]></content>
      
      
      <categories>
          
          <category> spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> framework </tag>
            
            <tag> spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>servlet_spring-mvc</title>
      <link href="/2019/02/03/spring-mvc/"/>
      <url>/2019/02/03/spring-mvc/</url>
      
        <content type="html"><![CDATA[<p>é˜…è¯»çš„ç›®çš„ï¼Ÿæˆ‘æƒ³è¦ä»ä¸­è·å¾—ä»€ä¹ˆï¼Ÿ</p><p>â€‹    å¯¹springmvc æµç¨‹å¯¹åˆ†æï¼Œä»£ç çš„åˆ†ææ€»ç»“</p><a id="more"></a><hr><h4 id="1-springMVC-æ ¸å¿ƒservlet-â€”DispatcherServlet"><a href="#1-springMVC-æ ¸å¿ƒservlet-â€”DispatcherServlet" class="headerlink" title="1. springMVC æ ¸å¿ƒservlet â€”DispatcherServlet"></a>1. springMVC æ ¸å¿ƒservlet â€”DispatcherServlet</h4><p>â€‹    <code>åŸºäºspring-webmvc 4.0.3.RELEASE</code></p><h5 id="1-1-æ•´ä½“ç»“æ„"><a href="#1-1-æ•´ä½“ç»“æ„" class="headerlink" title="1.1 æ•´ä½“ç»“æ„"></a>1.1 æ•´ä½“ç»“æ„</h5><p><img src="https://ws3.sinaimg.cn/large/006tNbRwgy1fyc0ein61sj31m20u0adx.jpg" alt="image-20181219135235499"></p><blockquote><p>Awareï¼šå¦‚æœæŸä¸ªç±»æƒ³ä½¿ç”¨Springçš„ä¸€äº›ä¸œè¥¿ï¼Œå°±å¯ä»¥å®ç°Awareæ¥å£</p><p>Capable:å…·æœ‰springæŸä¸ªç±»çš„èƒ½åŠ›</p></blockquote><h5 id="1-2-åˆ›å»ºè¿‡ç¨‹"><a href="#1-2-åˆ›å»ºè¿‡ç¨‹" class="headerlink" title="1.2 åˆ›å»ºè¿‡ç¨‹"></a>1.2 åˆ›å»ºè¿‡ç¨‹</h5><h6 id="1-2-1-HttpServletBeançš„åˆ›å»º"><a href="#1-2-1-HttpServletBeançš„åˆ›å»º" class="headerlink" title="1.2.1 HttpServletBeançš„åˆ›å»º"></a>1.2.1 HttpServletBeançš„åˆ›å»º</h6><p>â€‹        å®ç°äº†<code>EnvironmentCapable</code>ã€<code>EnvironmentAware</code> ï¼Œä¸»è¦ä½œç”¨æ˜¯å°†Servletä¸­é…ç½®çš„å‚æ•°è®¾ç½®åˆ°ç›¸åº”çš„</p><h6 id="1-2-2-FramewordkServletçš„åˆ›å»º"><a href="#1-2-2-FramewordkServletçš„åˆ›å»º" class="headerlink" title="1.2.2 FramewordkServletçš„åˆ›å»º"></a>1.2.2 FramewordkServletçš„åˆ›å»º</h6><p>â€‹        å®ç°äº†<code>ApplicationContextAware</code>ï¼Œå…¶ä¸»è¦ä½œç”¨æ˜¯è°ƒç”¨<code>initWebApplicationContext()</code>åˆå§‹åŒ–<code>WebApplicationContext</code></p><ul><li>è·å–springçš„æ ¹å·¥æœŸrootContext</li><li>è®¾ç½®webApplicationContextå¹¶æ ¹æ®æƒ…å†µè°ƒç”¨onRefreshæ–¹æ³•</li><li>å°†WebApplicationContextè®¾ç½®åˆ°ServletContextä¸­            </li></ul><h6 id="1-2-3-DispatcherServletçš„åˆ›å»º"><a href="#1-2-3-DispatcherServletçš„åˆ›å»º" class="headerlink" title="1.2.3 DispatcherServletçš„åˆ›å»º"></a>1.2.3 DispatcherServletçš„åˆ›å»º</h6><p>â€‹    onRefreshæ–¹æ³•æ˜¯DispatcherServletçš„å…¥å£æ–¹æ³•ï¼ŒonRefreshä¸­è°ƒç”¨äº†initStrategies()æ–¹æ³•æ¥åˆå§‹åŒ–ä¸€äº›ç­–ç•¥ç»„ä»¶</p><pre><code class="java">protected void onRefresh(ApplicationContext context) {    this.initStrategies(context);}/** * Initialize the strategy objects that this servlet uses. * &lt;p&gt;May be overridden in subclasses in order to initialize further strategy objects. */protected void initStrategies(ApplicationContext context) {    initMultipartResolver(context);    initLocaleResolver(context);    initThemeResolver(context);    initHandlerMappings(context);    initHandlerAdapters(context);    initHandlerExceptionResolvers(context);    initRequestToViewNameTranslator(context);    initViewResolvers(context);    initFlashMapManager(context);}</code></pre><p>å¦‚æœæ²¡æœ‰é…ç½®ç›¸å…³ï¼Œä¼šä½¿ç”¨é»˜è®¤çš„é…ç½®ï¼Œåœ¨DispatcherServlet.propertiesæ–‡ä»¶ä¸­</p><pre><code class="properties"># Default implementation classes for DispatcherServlet&#39;s strategy interfaces.# Used as fallback when no matching beans are found in the DispatcherServlet context.# Not meant to be customized by application developers.org.springframework.web.servlet.LocaleResolver=org.springframework.web.servlet.i18n.AcceptHeaderLocaleResolverorg.springframework.web.servlet.ThemeResolver=org.springframework.web.servlet.theme.FixedThemeResolverorg.springframework.web.servlet.HandlerMapping=org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping,\   org.springframework.web.servlet.mvc.annotation.DefaultAnnotationHandlerMappingorg.springframework.web.servlet.HandlerAdapter=org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter,\   org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter,\   org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapterorg.springframework.web.servlet.HandlerExceptionResolver=org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerExceptionResolver,\   org.springframework.web.servlet.mvc.annotation.ResponseStatusExceptionResolver,\   org.springframework.web.servlet.mvc.support.DefaultHandlerExceptionResolverorg.springframework.web.servlet.RequestToViewNameTranslator=org.springframework.web.servlet.view.DefaultRequestToViewNameTranslatororg.springframework.web.servlet.ViewResolver=org.springframework.web.servlet.view.InternalResourceViewResolverorg.springframework.web.servlet.FlashMapManager=org.springframework.web.servlet.support.SessionFlashMapManager</code></pre><blockquote><p>Tipsï¼šIf no bean is defined with the given name in the BeanFactory for this namespace, no multipart handling is provided.</p></blockquote><h5 id="1-3-ç»„ä»¶æ¦‚è§ˆ"><a href="#1-3-ç»„ä»¶æ¦‚è§ˆ" class="headerlink" title="1.3 ç»„ä»¶æ¦‚è§ˆ"></a>1.3 ç»„ä»¶æ¦‚è§ˆ</h5><h6 id="1-3-1-HandlerMapping"><a href="#1-3-1-HandlerMapping" class="headerlink" title="1.3.1 HandlerMapping"></a>1.3.1 HandlerMapping</h6><p>â€‹    å®ƒçš„ä½œç”¨æ˜¯æ ¹æ®requestæ‰¾åˆ°å¯¹åº”çš„å¤„ç†å™¨handlerå’ŒInterceptors ,é¦–å…ˆçœ‹ä¸‹æ¥å£ä¿¡æ¯</p><pre><code class="java">package org.springframework.web.servlet;import javax.servlet.http.HttpServletRequest;/** * Interface to be implemented by objects that define a mapping between * requests and handler objects. * @see org.springframework.core.Ordered * @see org.springframework.web.servlet.handler.AbstractHandlerMapping * @see org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping * @see org.springframework.web.servlet.handler.SimpleUrlHandlerMapping */public interface HandlerMapping {   String PATH_WITHIN_HANDLER_MAPPING_ATTRIBUTE = HandlerMapping.class.getName() + &quot;.pathWithinHandlerMapping&quot;;   String BEST_MATCHING_PATTERN_ATTRIBUTE = HandlerMapping.class.getName() + &quot;.bestMatchingPattern&quot;;   String INTROSPECT_TYPE_LEVEL_MAPPING = HandlerMapping.class.getName() + &quot;.introspectTypeLevelMapping&quot;;   String URI_TEMPLATE_VARIABLES_ATTRIBUTE = HandlerMapping.class.getName() + &quot;.uriTemplateVariables&quot;;   String MATRIX_VARIABLES_ATTRIBUTE = HandlerMapping.class.getName() + &quot;.matrixVariables&quot;;   String PRODUCIBLE_MEDIA_TYPES_ATTRIBUTE = HandlerMapping.class.getName() + &quot;.producibleMediaTypes&quot;;   /**    * Return a handler and any interceptors for this request. The choice may be made    * on request URL, session state, or any factor the implementing class chooses.    * &lt;p&gt;The returned HandlerExecutionChain contains a handler Object, rather than    * even a tag interface, so that handlers are not constrained in any way.    * For example, a HandlerAdapter could be written to allow another framework&#39;s    * handler objects to be used.    * &lt;p&gt;Returns {@code null} if no match was found. This is not an error.    * The DispatcherServlet will query all registered HandlerMapping beans to find    * a match, and only decide there is an error if none can find a handler.    * @param request current HTTP request    * @return a HandlerExecutionChain instance containing handler object and    * any interceptors, or {@code null} if no mapping found    * @throws Exception if there is an internal error    */   HandlerExecutionChain getHandler(HttpServletRequest request) throws Exception;}</code></pre><p>ä»¥å¸¸ç”¨æ¥å£å®ç°ä¸ºä¾‹ï¼ŒRequestMappingHandlerMapping</p><p><img src="https://ws4.sinaimg.cn/large/006tNbRwly1fyc839v8vdj31l20u043g.jpg" alt="image-20181219181838287"></p><blockquote><p>è¿™é‡Œæä¾›äº†Orderedæ¥å£ï¼Œå¯ä»¥ç¡®å®šåŒ¹é…çš„é¡ºåºï¼ŒåŒæ—¶é€šè¿‡ç»§æ‰¿WebApplicationObjectSupportæŠ½è±¡ç±»ï¼Œå¯ä»¥è·å–ç›¸å…³Beanï¼ˆhandlerï¼‰,æ›´å¤šç»†èŠ‚å¯æŸ¥çœ‹ ç±»AbstractHandlerMappingã€‚</p></blockquote><h6 id="1-3-2-HandlerAdapter"><a href="#1-3-2-HandlerAdapter" class="headerlink" title="1.3.2 HandlerAdapter"></a>1.3.2 HandlerAdapter</h6><p>â€‹    ä¹‹æ‰€ä»¥è¦ä½¿ç”¨HandlerAdapterï¼Œæ˜¯ä¸ºSpringMVCä¸­å¹¶æ²¡æœ‰å¯¹å¤„ç†å™¨åšä»»ä½•çš„é™åˆ¶ï¼Œå¯ä»¥æ˜¯ä¸ªç±»ï¼Œæ–¹æ³•ï¼ˆHandlerMethodï¼‰è¿™ç‚¹ä»hanlderæ˜¯Objectå°±å¯ä»¥çœ‹å‡ºï¼Œé¦–å…ˆæ˜¯æ¥å£å®ç°</p><pre><code class="java">package org.springframework.web.servlet;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;/** * MVC framework SPI interface, allowing parameterization of core MVC workflow. * * &lt;p&gt;Interface that must be implemented for each handler type to handle a request. * This interface is used to allow the {@link DispatcherServlet} to be indefinitely * extensible. The DispatcherServlet accesses all installed handlers through this * interface, meaning that it does not contain code specific to any handler type. * * &lt;p&gt;Note that a handler can be of type {@code Object}. This is to enable * handlers from other frameworks to be integrated with this framework without * custom coding, as well as to allow for annotation handler objects that do * not obey any specific Java interface. * * &lt;p&gt;This interface is not intended for application developers. It is available * to handlers who want to develop their own web workflow. * * &lt;p&gt;Note: HandlerAdaptger implementators may implement the * {@link org.springframework.core.Ordered} interface to be able to specify a * sorting order (and thus a priority) for getting applied by DispatcherServlet. * Non-Ordered instances get treated as lowest priority. * * @author Rod Johnson * @author Juergen Hoeller * @see org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter * @see org.springframework.web.servlet.handler.SimpleServletHandlerAdapter */public interface HandlerAdapter {   /**    * Given a handler instance, return whether or not this HandlerAdapter can    * support it. Typical HandlerAdapters will base the decision on the handler    * type. HandlerAdapters will usually only support one handler type each.    * &lt;p&gt;A typical implementation:    * &lt;p&gt;{@code    * return (handler instanceof MyHandler);    * }    * @param handler handler object to check    * @return whether or not this object can use the given handler    */   boolean supports(Object handler);   /**    * Use the given handler to handle this request.    * The workflow that is required may vary widely.    * @param request current HTTP request    * @param response current HTTP response    * @param handler handler to use. This object must have previously been passed    * to the {@code supports} method of this interface, which must have    * returned {@code true}.    * @throws Exception in case of errors    * @return ModelAndView object with the name of the view and the required    * model data, or {@code null} if the request has been handled directly    */   ModelAndView handle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception;   /**    * Same contract as for HttpServlet&#39;s {@code getLastModified} method.    * Can simply return -1 if there&#39;s no support in the handler class.    * @param request current HTTP request    * @param handler handler to use    * @return the lastModified value for the given handler    * @see javax.servlet.http.HttpServlet#getLastModified    * @see org.springframework.web.servlet.mvc.LastModified#getLastModified    */   long getLastModified(HttpServletRequest request, Object handler);}</code></pre><p>å…¶ä¸­ä¸€ä¸ªå®ç°ç±»<code>SimpleControllerHandlerAdapter</code></p><pre><code class="java">package org.springframework.web.servlet.mvc;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import org.springframework.web.servlet.HandlerAdapter;import org.springframework.web.servlet.ModelAndView;/** * Adapter to use the plain {@link Controller} workflow interface with * the generic {@link org.springframework.web.servlet.DispatcherServlet}. * Supports handlers that implement the {@link LastModified} interface. * &lt;p&gt;This is an SPI class, not used directly by application code. * * @author Rod Johnson * @author Juergen Hoeller * @see org.springframework.web.servlet.DispatcherServlet * @see Controller * @see LastModified * @see HttpRequestHandlerAdapter */public class SimpleControllerHandlerAdapter implements HandlerAdapter {   @Override   public boolean supports(Object handler) {      return (handler instanceof Controller);   }   @Override   public ModelAndView handle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {      return ((Controller) handler).handleRequest(request, response);   }   @Override   public long getLastModified(HttpServletRequest request, Object handler) {      if (handler instanceof LastModified) {         return ((LastModified) handler).getLastModified(request);      }      return -1L;   }}</code></pre><p>ä¸€èˆ¬é»˜è®¤ä½¿ç”¨çš„æ˜¯ RequestMappingHandlerAdapter ,åœ¨å…¶çˆ¶ç±»ä¸­æœ‰è¿™æ ·ä¸€å¥è®¾ç½®Order</p><p><code>private int order = Ordered.LOWEST_PRECEDENCE;</code></p><p><img src="https://ws1.sinaimg.cn/large/006tNbRwly1fyc7lnlrzmj318o0u042e.jpg" alt="image-20181219180136155"></p><blockquote><p>HandlerAdapter implementators may implement the Orderï¼Œä½¿ç”¨æ—¶å€™æ˜¯éå† handlerAdapters ï¼Œè°ƒç”¨supportsåˆ¤æ–­ç›´æ¥è¿”å›ï¼ˆé™¤äº†è®¾ç½®çš„ï¼Œé»˜è®¤çš„å®ç°æœ‰3ä¸ªï¼‰ã€‚æ³¨æ„Orderæ˜¯è¶Šä½ä¼˜å…ˆçº§è¶Šé«˜çš„ã€‚æ›´å¤šç»†èŠ‚å¯ä»¥æŸ¥çœ‹#afterPropertiesSet()æ–¹æ³•</p></blockquote><p>æ€»ç»“ä¸€ä¸‹ï¼Œä¸»è¦åšäº†ä¸‰ä»¶äº‹ï¼Œè§£æå‚æ•°ã€æ‰§è¡Œè¯·æ±‚ï¼Œå¤„ç†è¿”å›ç»“æœ</p><ul><li>è§£æå‚æ•°çš„è¿‡ç¨‹ä¸­ç”¨åˆ°çš„å‚æ•°æ¥æºæœ‰å¤šä¸ªï¼Œå¤§ä½“å¯åˆ†ä¸ºä¸¤ç±»ï¼Œä¸€ç±»æ˜¯ä»Modelæ¥çš„ï¼ˆé€šè¿‡FlashMapManagerå’ŒModelFactoryï¼‰ï¼Œå¦ä¸€ç±»æ˜¯ä»Requestæ¥çš„, å…·ä½“ä½¿ç”¨HandlerMethodArgumentResolverè¿›è¡Œè§£æï¼ˆæœ‰çš„æ˜¯@InitBinder WebDataBinderï¼‰</li><li>æ‰§è¡Œè¯·æ±‚çš„æ˜¯ç”¨HandlerMethodçš„å­ç±»ServletInvocableHandlerMethod</li><li>è¿”å›å€¼ç”¨HandlerMethodReturnValueHandlerè¿›è¡Œè§£æã€‚</li></ul><p>å¦å¤–ï¼Œæ•´ä¸ªå¤„ç†è¿‡ç¨‹ä¸­ModelAndViewContainerèµ·ç€å‚æ•°ä¼ é€’çš„ä½œç”¨ã€‚</p><p>â€‹    è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªéœ€è¦æ³¨æ„çš„ï¼Œå°±æ˜¯<code>RequestMappingHandlerAdapter</code> æ˜¯æ€ä¹ˆæ³¨å…¥çš„ï¼Œé€šè¿‡debugå‘ç°ï¼Œé»˜è®¤çš„å®ç°HandlerAdapter æœ‰ 3ä¸ª ,é™¤äº†å‰è€…è¿˜æœ‰<code>HttpRequestHandlerAdapte</code>ã€<code>SimpleControllerHandlerAdapte</code>çš„ï¼Œ<a href="https://docs.spring.io/spring/docs/3.2.10.RELEASE/spring-framework-reference/html/mvc.html#mvc-config-enable" target="_blank" rel="noopener">é€šè¿‡æŸ¥è¯¢å®˜æ–¹æ–‡æ¡£å‘ç°</a>ï¼Œåªè¦åœ¨é…ç½®æ–‡ä»¶é…ç½®äº†<code>mvc:annotation-driven</code> ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆç›¸å…³@RequestMappingçš„ç±»ã€‚</p><p><img src="https://ws1.sinaimg.cn/large/006tNbRwly1fydcs34e4rj31y60qu11o.jpg" alt="image-20181220174621313"></p><blockquote><p>å®˜æ–¹æ–‡æ¡£çš„æˆªå›¾</p></blockquote><h6 id="1-3-3-HandlerExceptionResolver"><a href="#1-3-3-HandlerExceptionResolver" class="headerlink" title="1.3.3 HandlerExceptionResolver"></a>1.3.3 HandlerExceptionResolver</h6><p>â€‹    æ ¹æ®å¼‚å¸¸è®¾ç½®ModelAndViewï¼Œä¹‹åäº¤ç»™renderæ–¹æ³•å»æ¸²æŸ“ï¼Œè¿™é‡Œè¦æ³¨æ„å®ƒæ˜¯åœ¨renderä¹‹å‰å·¥ä½œï¼Œæ‰€ä»¥åªä½œç”¨äºè§£æå¯¹è¯·æ±‚åšå¤„ç†è¿‡ç¨‹ä¸­çš„äº§ç”Ÿçš„å¼‚å¸¸ã€‚</p><pre><code class="java">package org.springframework.web.servlet;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;/** * Interface to be implemented by objects than can resolve exceptions thrown * during handler mapping or execution, in the typical case to error views. * Implementors are typically registered as beans in the application context. * * &lt;p&gt;Error views are analogous to the error page JSPs, but can be used with * any kind of exception including any checked exception, with potentially * fine-granular mappings for specific handlers. * * @author Juergen Hoeller * @since 22.11.2003 */public interface HandlerExceptionResolver {   /**    * Try to resolve the given exception that got thrown during on handler execution,    * returning a ModelAndView that represents a specific error page if appropriate.    * &lt;p&gt;The returned ModelAndView may be {@linkplain ModelAndView#isEmpty() empty}    * to indicate that the exception has been resolved successfully but that no view    * should be rendered, for instance by setting a status code.    * @param request current HTTP request    * @param response current HTTP response    * @param handler the executed handler, or {@code null} if none chosen at the    * time of the exception (for example, if multipart resolution failed)    * @param ex the exception that got thrown during handler execution    * @return a corresponding ModelAndView to forward to,    * or {@code null} for default processing    */   ModelAndView resolveException(         HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex);}</code></pre><p>å…¶å®ç°SimpleMappingExceptionResolver å¯ä»¥é€šè¿‡æ‰©å±•é…ç½®ï¼Œè®¾ç½®è‡ªå®šä¹‰ç±»å‹</p><p><img src="https://ws4.sinaimg.cn/large/006tNbRwly1fyc6u9xp9nj30zn0u0ag3.jpg" alt="image-20181219173520333"></p><blockquote><p>å¯ä»¥é…åˆå®šåˆ¶è‡ªå®šä¹‰Exceptionï¼Œå‰ç«¯ç»Ÿä¸€å±•ç¤ºç­‰</p></blockquote><h6 id="1-3-4-ViewResolver"><a href="#1-3-4-ViewResolver" class="headerlink" title="1.3.4 ViewResolver"></a>1.3.4 ViewResolver</h6><p>â€‹    é€šè¿‡viewNameæ¥æ‰¾åˆ° å¯¹åº”çš„Viewï¼ŒViewæ˜¯ç”¨æ¥æ¸²æŸ“é¡µé¢çš„ï¼Œä¸»è¦è§£å†³ç”¨ä»€ä¹ˆæ¨¡ç‰ˆå’Œç”¨ä»€ä¹ˆè§„åˆ™å¡«å…¥å‚æ•°</p><pre><code class="java">package org.springframework.web.servlet;import java.util.Locale;/** * Interface to be implemented by objects that can resolve views by name. * * &lt;p&gt;View state doesn&#39;t change during the running of the application, * so implementations are free to cache views. * * &lt;p&gt;Implementations are encouraged to support internationalization, * i.e. localized view resolution. * * @author Rod Johnson * @author Juergen Hoeller * @see org.springframework.web.servlet.view.InternalResourceViewResolver * @see org.springframework.web.servlet.view.ResourceBundleViewResolver * @see org.springframework.web.servlet.view.XmlViewResolver */public interface ViewResolver {   /**    * Resolve the given view by name.    * &lt;p&gt;Note: To allow for ViewResolver chaining, a ViewResolver should    * return {@code null} if a view with the given name is not defined in it.    * However, this is not required: Some ViewResolvers will always attempt    * to build View objects with the given name, unable to return {@code null}    * (rather throwing an exception when View creation failed).    * @param viewName name of the view to resolve    * @param locale Locale in which to resolve the view.    * ViewResolvers that support internationalization should respect this.    * @return the View object, or {@code null} if not found    * (optional, to allow for ViewResolver chaining)    * @throws Exception if the view cannot be resolved    * (typically in case of problems creating an actual View object)    */   View resolveViewName(String viewName, Locale locale) throws Exception;}</code></pre><p>å¸¸ç”¨çš„jspè§£æ</p><p><img src="https://ws1.sinaimg.cn/large/006tNbRwly1fycat4mrudj310q0u043a.jpg" alt="image-20181219195241323"></p><p>æŒ‰ç…§ç±»å›¾å¯ä»¥æŠŠç»§æ‰¿<code>AbstractCachingViewResolver</code>(é‡Œé¢ä¸¤ä¸ªMapçš„æ–¹å¼å€¼å¾—å­¦ä¹ )åˆ†æˆä¸¤ç±»</p><ul><li><code>ResourceBundleViewResolver</code>  å¯ä»¥åŒæ—¶æ”¯æŒå¤šç§ç±»å‹çš„è§†å›¾ï¼Œéœ€è¦å°†æ¯ä¸€ä¸ªè§†å›¾åå’Œå¯¹åº”çš„è§†å›¾ç±»å‹é…ç½®åˆ°ç›¸åº”çš„propertiesæ–‡ä»¶ä¸­,è¯¥ç±»çš„æ³¨é‡Šä¸­ï¼Œè§£é‡Šäº†å…¶ç”¨æ³•,</li></ul><pre><code class="java"> /* &lt;p&gt;This {@code ViewResolver} supports localized view definitions, * using the default support of {@link java.util.PropertyResourceBundle}. * For example, the basename &quot;views&quot; will be resolved as class path resources * &quot;views_de_AT.properties&quot;, &quot;views_de.properties&quot;, &quot;views.properties&quot; - * for a given Locale &quot;de_AT&quot;./</code></pre><ul><li><code>UrlBasedViewResolver</code>ç³»åˆ—çš„è§£æå™¨éƒ½æ˜¯å¯¹å•ä¸€è§†å›¾è¿›è¡Œè§£æçš„ï¼Œåªéœ€æ‰¾åˆ°æ¨¡ç‰ˆå°±è¡Œï¼Œä¾‹å¦‚</li></ul><p><code>InternalResourceViewResolver</code> æ˜¯ä¸“é—¨ç”¨æ¥è§£æjspï¼Œ<code>FreeMarkerViewResolver</code>åªé’ˆå¯¹FreeMarker</p><blockquote><p>ç›¸å…³æ‰©å±•ExecelViewResolverã€SimpleMapViewResolver</p><p>é»˜è®¤å®ç°æ˜¯ InternalResourceViewResolver</p></blockquote><h6 id="1-3-5-RequestToViewNameTranslator"><a href="#1-3-5-RequestToViewNameTranslator" class="headerlink" title="1.3.5 RequestToViewNameTranslator"></a>1.3.5 RequestToViewNameTranslator</h6><p>æ¯”è¾ƒç®€å•ï¼Œå½“handlerå¤„ç†å®Œåï¼Œæ²¡æœ‰Viewå’ŒViewNameçš„ä¼šè°ƒç”¨è¯¥æ–¹æ³•ã€‚</p><pre><code class="java">/** * Do we need view name translation? */private void applyDefaultViewName(HttpServletRequest request, ModelAndView mv) throws Exception {   if (mv != null &amp;&amp; !mv.hasView()) {      mv.setViewName(getDefaultViewName(request));   }}/** * Translate the supplied request into a default view name. * @param request current HTTP servlet request * @return the view name (or {@code null} if no default found) * @throws Exception if view name translation failed */protected String getDefaultViewName(HttpServletRequest request) throws Exception {    return this.viewNameTranslator.getViewName(request);}</code></pre><blockquote><p>â€‹    é»˜è®¤å®ç°æ˜¯RequestToViewNameTranslator</p></blockquote><h6 id="1-3-6-LocaleResolver"><a href="#1-3-6-LocaleResolver" class="headerlink" title="1.3.6 LocaleResolver"></a>1.3.6 LocaleResolver</h6><p>â€‹    ç”¨äºä»requestä¸­è§£æå‡ºLocale,é»˜è®¤å®ç°æ˜¯</p><pre><code class="java">package org.springframework.web.servlet.i18n;import java.util.Locale;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import org.springframework.web.servlet.LocaleResolver;/** * {@link LocaleResolver} implementation that simply uses the primary locale * specified in the &quot;accept-language&quot; header of the HTTP request (that is, * the locale sent by the client browser, normally that of the client&#39;s OS). * * &lt;p&gt;Note: Does not support {@code setLocale}, since the accept header * can only be changed through changing the client&#39;s locale settings. * * @author Juergen Hoeller * @since 27.02.2003 * @see javax.servlet.http.HttpServletRequest#getLocale() */public class AcceptHeaderLocaleResolver implements LocaleResolver {   public Locale resolveLocale(HttpServletRequest request) {      return request.getLocale();   }   public void setLocale(HttpServletRequest request, HttpServletResponse response, Locale locale) {      throw new UnsupportedOperationException(            &quot;Cannot change HTTP accept header - use a different locale resolution strategy&quot;);   }}</code></pre><p>â€‹    åœ¨DispatcherServlet#doSerive()æ–¹æ³•ä¸­ï¼Œ <code>request.setAttribute(LOCALE_RESOLVER_ATTRIBUTE, this.localeResolver);</code> æ”¾è¿›requestä¸­ï¼Œè¿™é‡Œé™¤äº†è§†å›¾è§£æçš„æ—¶å€™éœ€è¦ç”¨åˆ°ï¼Œåœ¨ä½¿ç”¨å›½é™…åŒ–ä¸»é¢˜çš„æ—¶å€™ä¹Ÿä¼šç”¨åˆ°</p><blockquote><p>åˆ‡æ¢ç›¸å…³ï¼Œå¯æŸ¥çœ‹ LocaleChangeInterceptor</p></blockquote><h6 id="1-3-7-ThemeResolver"><a href="#1-3-7-ThemeResolver" class="headerlink" title="1.3.7 ThemeResolver"></a>1.3.7 ThemeResolver</h6><p>â€‹    SpringMVCä¸­å’Œä¸»é¢˜ç›¸å…³çš„ç±»æœ‰å¦‚ä¸‹</p><ul><li>ThemeResolver ä½œç”¨æ˜¯ä»requestä¸­è§£æå‡ºä¸»é¢˜å,é»˜è®¤å®ç°FixedThemeResolver</li><li>ThemeSource æ ¹æ®ä¸»é¢˜åæ‰¾åˆ°å¯¹åº”çš„ä¸»é¢˜ ï¼Œé»˜è®¤ä½¿ç”¨WebApplicationContext</li><li>Theme å°±æ˜¯ä¸»é¢˜ï¼ŒåŒ…å«äº†å…·ä½“èµ„æº</li></ul><pre><code class="java">package org.springframework.web.servlet.theme;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;/** * {@link org.springframework.web.servlet.ThemeResolver} implementation * that simply uses a fixed theme. The fixed name can be defined via * the &quot;defaultThemeName&quot; property; out of the box, it is &quot;theme&quot;. * * &lt;p&gt;Note: Does not support {@code setThemeName}, as the fixed theme * cannot be changed. * * @author Jean-Pierre Pawlak * @author Juergen Hoeller * @since 17.06.2003 * @see #setDefaultThemeName */public class FixedThemeResolver extends AbstractThemeResolver {   @Override   public String resolveThemeName(HttpServletRequest request) {      return getDefaultThemeName();   }   @Override   public void setThemeName(HttpServletRequest request, HttpServletResponse response, String themeName) {      throw new UnsupportedOperationException(&quot;Cannot change theme - use a different theme resolution strategy&quot;);   }}</code></pre><blockquote><p>åˆ‡æ¢ç›¸å…³ï¼Œå¯æŸ¥çœ‹ ThemeChangeInterceptor</p></blockquote><h6 id="1-3-8-MultipartResolver"><a href="#1-3-8-MultipartResolver" class="headerlink" title="1.3.8 MultipartResolver"></a>1.3.8 MultipartResolver</h6><p>â€‹    ç”¨äºå¤„ç†æ–‡ä»¶ä¸Šä¼ ï¼Œæ³¨æ„è¿™ä¸ªç»„ä»¶åœ¨DispatcherServlet.properties ä¸­ æ²¡æœ‰é»˜è®¤å®ç°,é¦–å…ˆæ˜¯æ¥å£å®ç°</p><pre><code class="java">package org.springframework.web.multipart;import javax.servlet.http.HttpServletRequest;/** * A strategy interface for multipart file upload resolution in accordance * with &lt;a href=&quot;http://www.ietf.org/rfc/rfc1867.txt&quot;&gt;RFC 1867&lt;/a&gt;. * Implementations are typically usable both within an application context * and standalone. * * &lt;p&gt;There are two concrete implementations included in Spring, as of Spring 3.1: * &lt;ul&gt; * &lt;li&gt;{@link org.springframework.web.multipart.commons.CommonsMultipartResolver} for Jakarta Commons FileUpload * &lt;li&gt;{@link org.springframework.web.multipart.support.StandardServletMultipartResolver} for Servlet 3.0 Part API * &lt;/ul&gt; * * &lt;p&gt;There is no default resolver implementation used for Spring * {@link org.springframework.web.servlet.DispatcherServlet DispatcherServlets}, * as an application might choose to parse its multipart requests itself. To define * an implementation, create a bean with the id &quot;multipartResolver&quot; in a * {@link org.springframework.web.servlet.DispatcherServlet DispatcherServlet&#39;s} * application context. Such a resolver gets applied to all requests handled * by that {@link org.springframework.web.servlet.DispatcherServlet}. * * &lt;p&gt;If a {@link org.springframework.web.servlet.DispatcherServlet} detects * a multipart request, it will resolve it via the configured * {@link MultipartResolver} and pass on a * wrapped {@link javax.servlet.http.HttpServletRequest}. * Controllers can then cast their given request to the * {@link MultipartHttpServletRequest} * interface, which permits access to any * {@link MultipartFile MultipartFiles}. * Note that this cast is only supported in case of an actual multipart request. * * &lt;pre class=&quot;code&quot;&gt; * public ModelAndView handleRequest(HttpServletRequest request, HttpServletResponse response) { *   MultipartHttpServletRequest multipartRequest = (MultipartHttpServletRequest) request; *   MultipartFile multipartFile = multipartRequest.getFile(&quot;image&quot;); *   ... * }&lt;/pre&gt; * * Instead of direct access, command or form controllers can register a * {@link org.springframework.web.multipart.support.ByteArrayMultipartFileEditor} * or {@link org.springframework.web.multipart.support.StringMultipartFileEditor} * with their data binder, to automatically apply multipart content to command * bean properties. * * &lt;p&gt;As an alternative to using a * {@link MultipartResolver} with a * {@link org.springframework.web.servlet.DispatcherServlet}, * a {@link org.springframework.web.multipart.support.MultipartFilter} can be * registered in {@code web.xml}. It will delegate to a corresponding * {@link MultipartResolver} bean in the root * application context. This is mainly intended for applications that do not * use Spring&#39;s own web MVC framework. * * &lt;p&gt;Note: There is hardly ever a need to access the * {@link MultipartResolver} itself * from application code. It will simply do its work behind the scenes, * making * {@link MultipartHttpServletRequest MultipartHttpServletRequests} * available to controllers. * * @author Juergen Hoeller * @author Trevor D. Cook * @since 29.09.2003 * @see MultipartHttpServletRequest * @see MultipartFile * @see org.springframework.web.multipart.commons.CommonsMultipartResolver * @see org.springframework.web.multipart.support.ByteArrayMultipartFileEditor * @see org.springframework.web.multipart.support.StringMultipartFileEditor * @see org.springframework.web.servlet.DispatcherServlet */public interface MultipartResolver {   /**    * Determine if the given request contains multipart content.    * &lt;p&gt;Will typically check for content type &quot;multipart/form-data&quot;, but the actually    * accepted requests might depend on the capabilities of the resolver implementation.    * @param request the servlet request to be evaluated    * @return whether the request contains multipart content    */   boolean isMultipart(HttpServletRequest request);   /**    * Parse the given HTTP request into multipart files and parameters,    * and wrap the request inside a    * {@link org.springframework.web.multipart.MultipartHttpServletRequest} object    * that provides access to file descriptors and makes contained    * parameters accessible via the standard ServletRequest methods.    * @param request the servlet request to wrap (must be of a multipart content type)    * @return the wrapped servlet request    * @throws MultipartException if the servlet request is not multipart, or if    * implementation-specific problems are encountered (such as exceeding file size limits)    * @see MultipartHttpServletRequest#getFile    * @see MultipartHttpServletRequest#getFileNames    * @see MultipartHttpServletRequest#getFileMap    * @see javax.servlet.http.HttpServletRequest#getParameter    * @see javax.servlet.http.HttpServletRequest#getParameterNames    * @see javax.servlet.http.HttpServletRequest#getParameterMap    */   MultipartHttpServletRequest resolveMultipart(HttpServletRequest request) throws MultipartException;   /**    * Cleanup any resources used for the multipart handling,    * like a storage for the uploaded files.    * @param request the request to cleanup resources for    */   void cleanupMultipart(MultipartHttpServletRequest request);}</code></pre><p>å¸¸ç”¨å®ç°CommonsMultipartResolver</p><p><img src="https://ws1.sinaimg.cn/large/006tNbRwly1fycdyq4kmxj31ta0u0ahy.jpg" alt="image-20181219214146380"></p><blockquote><p>å¯¹äºä¸Šä¼ ç±»å‹åˆ¤æ–­æ˜¯ multipart/form-data</p><p>ä¸¤ç§å®ç°ï¼Œä¸€ç§æ˜¯Servletçš„æ ‡å‡†å®ç°StandardServletMultipartResolver ä¸€ç§æ˜¯Apacheçš„commons-fileuploadæ–¹å¼</p></blockquote><h6 id="1-3-9-FlashMapManager"><a href="#1-3-9-FlashMapManager" class="headerlink" title="1.3.9 FlashMapManager"></a>1.3.9 FlashMapManager</h6><p>â€‹    FlashMapä¸»è¦ç”¨äºredirectä¸­ä¼ é€’å‚æ•°ï¼ŒFlashMapManageæ˜¯ç”¨æ¥ç®¡ç†FlashMapçš„</p><pre><code class="java">package org.springframework.web.servlet;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;/** * A strategy interface for retrieving and saving FlashMap instances. * See {@link FlashMap} for a general overview of flash attributes. * * @author Rossen Stoyanchev * @since 3.1 * @see FlashMap */public interface FlashMapManager {   /**    * Find a FlashMap saved by a previous request that matches to the current    * request, remove it from underlying storage, and also remove other    * expired FlashMap instances.    * &lt;p&gt;This method is invoked in the beginning of every request in contrast    * to {@link #saveOutputFlashMap}, which is invoked only when there are    * flash attributes to be saved - i.e. before a redirect.    * @param request the current request    * @param response the current response    * @return a FlashMap matching the current request or {@code null}    */   FlashMap retrieveAndUpdate(HttpServletRequest request, HttpServletResponse response);   /**    * Save the given FlashMap, in some underlying storage and set the start    * of its expiration period.    * &lt;p&gt;&lt;strong&gt;NOTE:&lt;/strong&gt; Invoke this method prior to a redirect in order    * to allow saving the FlashMap in the HTTP session or in a response    * cookie before the response is committed.    * @param flashMap the FlashMap to save    * @param request the current request    * @param response the current response    */   void saveOutputFlashMap(FlashMap flashMap, HttpServletRequest request, HttpServletResponse response);}</code></pre><p>â€‹    ä¸¤ä¸ªæ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯retrieveAndUpdate ç”¨äºæ¢å¤å‚æ•°ï¼ŒsaveOutputFlashMapç”¨äºä¿å­˜å‚æ•°</p><p>ç±»å›¾ä¹Ÿæ¯”è¾ƒç®€å•</p><p><img src="https://ws4.sinaimg.cn/large/006tNbRwly1fyce346qynj30zc0u0q9t.jpg" alt="image-20181219214559988"></p><blockquote><p>é»˜è®¤å®ç°æ˜¯SessionFlashMapManager</p></blockquote><p>æ•´ä¸ªredirects çš„å‚æ•°é€šè¿‡FlashMapä¼ é€’çš„è¿‡ç¨‹åˆ†ä¸‰æ­¥</p><ol><li>é¦–å…ˆï¼ŒRequestMappingHandlerAapterä¼šå°†å…¶è®¾ç½®åˆ°<code>outputFlashMap</code>ä¸­ï¼Œå¦‚æœæ˜¯redirectç±»å‹çš„è¿”å›ç±»å‹å€¼ï¼ˆå°†éœ€è¦ä¼ é€’çš„å‚æ•°è®¾ç½®åˆ°<code>outputFlashMap</code>ä¸­ï¼Œä¹Ÿå¯ä»¥æ˜¯RedirectAttributesç±»å‹çš„å‚æ•°ä¸­ï¼‰</li><li>åœ¨RedirectViewä¸­ä¼šè°ƒç”¨<code>#saveOutputFlashMap()</code>æ–¹æ³•ï¼Œå°†<code>outputFlashMap</code>ä¸­çš„å‚æ•°è®¾ç½®åˆ°Session</li><li>è¯·æ±‚redirectåï¼ŒDispatcherServletä¼šè°ƒæœ‰ä½ <code>#retrieveAndUpdate()</code>æ–¹æ³•ä»Sessionä¸­è·å–<code>inputFlashMap</code>å¹¶è®¾ç½®åˆ°Requestçš„å±æ€§ä¸­å¤‡ç”¨ï¼ŒåŒæ—¶ä»Sessionä¸­åˆ é™¤</li></ol><h5 id="1-4-å¤„ç†è¯·æ±‚"><a href="#1-4-å¤„ç†è¯·æ±‚" class="headerlink" title="1.4 å¤„ç†è¯·æ±‚"></a>1.4 å¤„ç†è¯·æ±‚</h5><h6 id="1-4-1-FrameworkServlet"><a href="#1-4-1-FrameworkServlet" class="headerlink" title="1.4.1 FrameworkServlet"></a>1.4.1 FrameworkServlet</h6><p>â€‹    Servletçš„å¤„ç†è¿‡ç¨‹ï¼Œé¦–å…ˆæ˜¯ä»Servletæ¥å£çš„serviceï¼Œç„¶ååœ¨HttpServletçš„serviceæ–¹æ³•ä¸­æ ¹æ®è¯·æ±‚çš„ç±»å‹ä¸åŒå°†è¯·æ±‚è·¯ç”±åˆ°äº†doGetã€doHeadç­‰æ–¹æ³•ã€‚</p><p>â€‹    FrameworkServletä¸­é‡å†™äº†doGetç­‰æ–¹æ³•ã€‚å°†è¯·æ±‚é›†ä¸­åˆ°processRequestæ–¹æ³•è¿›è¡Œç»Ÿä¸€å¤„ç†</p><pre><code class="java">/** * Override the parent class implementation in order to intercept PATCH * requests. */@Overrideprotected void service(HttpServletRequest request, HttpServletResponse response)        throws ServletException, IOException {    String method = request.getMethod();    if (method.equalsIgnoreCase(RequestMethod.PATCH.name())) {        processRequest(request, response);    }    else {        super.service(request, response);    }}/** * Delegate GET requests to processRequest/doService. * &lt;p&gt;Will also be invoked by HttpServlet&#39;s default implementation of {@code doHead}, * with a {@code NoBodyResponse} that just captures the content length. * @see #doService * @see #doHead */@Overrideprotected final void doGet(HttpServletRequest request, HttpServletResponse response)        throws ServletException, IOException {    processRequest(request, response);}</code></pre><p>â€‹    processRequestè¿™ä¸ªæ–¹æ³•ä¸»è¦åšäº†ä¸¤ä»¶äº‹æƒ…(å½“ç„¶è¿˜æœ‰doServiceï¼Œå’Œå¯¹å¼‚æ­¥è¯·æ±‚å¯¹å¤„ç†)</p><ul><li>å¯¹LocaleContextï¼ˆè·å–localeï¼‰å’ŒRequestAttributes(ç®¡ç†requestå’Œsessionå±æ€§)çš„è®¾ç½®åŠæ¢å¤</li><li>å¤„ç†å®Œåå‘å¸ƒServletRequestHandledEventæ¶ˆæ¯</li></ul><p>LocaleContextHolder ã€RequestContextHolder </p><pre><code class="java">public abstract class LocaleContextHolder {    private static final ThreadLocal localeContextHolder = new NamedThreadLocal(&quot;Locale context&quot;);    private static final ThreadLocal inheritableLocaleContextHolder = new NamedInheritableThreadLocal(&quot;Locale context&quot;);    ....}</code></pre><p> è¿™é‡Œæ¯”è¾ƒæœ‰æ„æ€çš„åœ°æ–¹æ˜¯è¿™æ˜¯ä¸ªæŠ½è±¡ç±»ï¼Œé‡Œé¢çš„æ–¹æ³•å®ç°éƒ½æ˜¯é™æ€æ–¹æ³•ï¼Œåªèƒ½è°ƒç”¨ä¸èƒ½å®ä¾‹åŒ–ã€‚RequestContextHolderçš„å®ç°ç±»ä¼¼ï¼Œå°è£…çš„æ˜¯ServletRequestAttributes</p><blockquote><p>è¿™é‡Œä¹‹æ‰€ä»¥éœ€è¦å¯¹LocaleContextå’ŒRequestAttributesæ¢å¤ï¼Œæ˜¯å› ä¸ºåœ¨Servletå¤–é¢å¯èƒ½è¿˜æœ‰åˆ«ç­‰æ“ä½œï¼Œä¾‹å¦‚Filterï¼ˆSpring-MVCçš„HandlerInterceptorï¼‰,ä¸ºäº†ä¸å½±å“é‚£äº›æ“ä½œã€‚</p></blockquote><h6 id="1-4-2-DispatcherServlet"><a href="#1-4-2-DispatcherServlet" class="headerlink" title="1.4.2 DispatcherServlet"></a>1.4.2 DispatcherServlet</h6><p>â€‹    DispatcherServletæ˜¯FrameworkServletçš„å­ç±»ï¼Œå®ç°äº†doServiceæ–¹æ³•</p><pre><code class="java">/** * Exposes the DispatcherServlet-specific request attributes and delegates to {@link #doDispatch} * for the actual dispatching. */@Overrideprotected void doService(HttpServletRequest request, HttpServletResponse response)     throws Exception {    // Keep a snapshot of the request attributes in case of an include,    // to be able to restore the original attributes after the include.    Map&lt;String, Object&gt; attributesSnapshot = null;    if (WebUtils.isIncludeRequest(request)) {        attributesSnapshot = new HashMap&lt;String, Object&gt;();        Enumeration&lt;?&gt; attrNames = request.getAttributeNames();        while (attrNames.hasMoreElements()) {            String attrName = (String) attrNames.nextElement();            if (this.cleanupAfterInclude || attrName.startsWith(&quot;org.springframework.web.servlet&quot;)) {                attributesSnapshot.put(attrName, request.getAttribute(attrName));            }        }    }    // Make framework objects available to handlers and view objects.    request.setAttribute(WEB_APPLICATION_CONTEXT_ATTRIBUTE, getWebApplicationContext());    request.setAttribute(LOCALE_RESOLVER_ATTRIBUTE, this.localeResolver);    request.setAttribute(THEME_RESOLVER_ATTRIBUTE, this.themeResolver);    request.setAttribute(THEME_SOURCE_ATTRIBUTE, getThemeSource());    //Pass paramter use to Redirect    FlashMap inputFlashMap = this.flashMapManager.retrieveAndUpdate(request, response);    if (inputFlashMap != null) {        request.setAttribute(INPUT_FLASH_MAP_ATTRIBUTE, Collections.unmodifiableMap(inputFlashMap));    }    request.setAttribute(OUTPUT_FLASH_MAP_ATTRIBUTE, new FlashMap());    request.setAttribute(FLASH_MAP_MANAGER_ATTRIBUTE, this.flashMapManager);    try {        doDispatch(request, response);    }    finally {        if (WebAsyncUtils.getAsyncManager(request).isConcurrentHandlingStarted()) {            return;        }        // Restore the original attribute snapshot, in case of an include.        if (attributesSnapshot != null) {            restoreAttributesAfterInclude(request, attributesSnapshot);        }    }}</code></pre><p>åœ¨doDispatchä¹‹å‰åšäº†</p><ul><li>åˆ¤æ–­æ˜¯å¦includeè¯·æ±‚ï¼Œæ˜¯çš„è¯ä¿å­˜å¿«ç…§ï¼ˆattributesSnapshotï¼‰</li><li>ä¸ºrequestè®¾ç½®é»˜è®¤çš„å±æ€§ï¼Œåœ¨åé¢çš„handlerså’Œviewä¸­éœ€è¦ä½¿ç”¨</li></ul><p>ä¸‹é¢æ˜¯doDispatchçš„æ–¹æ³•çš„å®ç°ï¼Œä¸»è¦çš„åŠŸèƒ½æ˜¯ Process the actual dispatching to the handler.</p><pre><code class="java">/** * Process the actual dispatching to the handler. * &lt;p&gt;The handler will be obtained by applying the servlet&#39;s HandlerMappings in order. * The HandlerAdapter will be obtained by querying the servlet&#39;s installed HandlerAdapters * to find the first that supports the handler class. * &lt;p&gt;All HTTP methods are handled by this method. It&#39;s up to HandlerAdapters or handlers * themselves to decide which methods are acceptable. * @param request current HTTP request * @param response current HTTP response * @throws Exception in case of any kind of processing failure */protected void doDispatch(HttpServletRequest request, HttpServletResponse response)     throws Exception {    HttpServletRequest processedRequest = request;    HandlerExecutionChain mappedHandler = null;    boolean multipartRequestParsed = false;    WebAsyncManager asyncManager = WebAsyncUtils.getAsyncManager(request);    try {        ModelAndView mv = null;        Exception dispatchException = null;        try {            processedRequest = checkMultipart(request);            multipartRequestParsed = processedRequest != request;            // Determine handler for the current request.            mappedHandler = getHandler(processedRequest);            if (mappedHandler == null || mappedHandler.getHandler() == null) {                noHandlerFound(processedRequest, response);                return;            }            // Determine handler adapter for the current request.            HandlerAdapter ha = getHandlerAdapter(mappedHandler.getHandler());            // Process last-modified header, if supported by the handler.            String method = request.getMethod();            boolean isGet = &quot;GET&quot;.equals(method);            if (isGet || &quot;HEAD&quot;.equals(method)) {                long lastModified = ha.getLastModified(request, mappedHandler.getHandler());                if (logger.isDebugEnabled()) {                    logger.debug(&quot;Last-Modified value for [&quot; + getRequestUri(request) + &quot;] is: &quot; + lastModified);                }                if (new ServletWebRequest(request, response).checkNotModified(lastModified) &amp;&amp; isGet) {                    return;                }            }            if (!mappedHandler.applyPreHandle(processedRequest, response)) {                return;            }            try {                // Actually invoke the handler.                mv = ha.handle(processedRequest, response, mappedHandler.getHandler());            }            finally {                if (asyncManager.isConcurrentHandlingStarted()) {                    return;                }            }            applyDefaultViewName(request, mv);            mappedHandler.applyPostHandle(processedRequest, response, mv);        }catch (Exception ex) {            dispatchException = ex;        }        processDispatchResult(processedRequest, response, mappedHandler, mv, dispatchException);    }catch (Exception ex) {        triggerAfterCompletion(processedRequest, response, mappedHandler, ex);    }catch (Error err) {        triggerAfterCompletionWithError(processedRequest, response, mappedHandler, err);    }finally {        if (asyncManager.isConcurrentHandlingStarted()) {            // Instead of postHandle and afterCompletion            mappedHandler.applyAfterConcurrentHandlingStarted(processedRequest, response);            return;        }        // Clean up any resources used by a multipart request.        if (multipartRequestParsed) {            cleanupMultipart(processedRequest);        }    }}</code></pre><p>æ•´ä¸ªå¤„ç†è¿‡ç¨‹æœ€æ ¸å¿ƒçš„ä»£ç åªæœ‰4å¥</p><ul><li>æ ¹æ®requestè¯·æ±‚åœ¨HandlerMappingæ‰¾åˆ°å¯¹åº”çš„Handler </li><li>æ ¹æ®Handleræ‰¾åˆ°å¯¹åº”çš„HandlerAdapter</li><li>ç”¨HandlerAdapterå¤„ç†Handler,è¿”å›ä¸€ä¸ªModelAndView(Controllerå°±æ˜¯åœ¨è¿™ä¸ªåœ°æ–¹æ‰§è¡Œ)</li><li>æ ¹æ®ModelAndViewçš„ä¿¡æ¯ï¼ˆæˆ–å¼‚å¸¸å¤„ç†ï¼‰ï¼Œé€šè¿‡ViewResolveræ‰¾åˆ°View,å¹¶æ ¹æ®Modelä¸­çš„æ•°æ®æ¸²æŸ“è¾“å‡ºåç»™ç”¨æˆ·</li></ul><p>æ•´ä¸ª<code>#doDispatcher()</code>å¤„ç†æµç¨‹å¦‚ä¸‹</p><p><img src="https://ws4.sinaimg.cn/large/006tNbRwgy1fybvzj6p72j30u00ynju2.jpg" alt="image-20181219111943655"></p><blockquote><p>â€‹    ä»è¯·æ±‚å¼€å§‹çš„è¯ï¼Œå½“è¯·æ±‚åˆ°è¾¾æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨(Tomcat connector)åˆ†é…ä¸€ä¸ªsocketçº¿ç¨‹æ¥è¿æ¥ï¼Œåˆ›å»ºrequestå’Œresponse ï¼Œç„¶åäº¤ç»™å¯¹åº”çš„servletå¤„ç†ï¼ˆä¸­é—´ç»è¿‡Pipeline,Filterï¼‰ï¼Œè¿™æ ·è¯·æ±‚å°±ä»å®¹å™¨(Tomcat)åˆ°Servletï¼ˆspringMVCï¼‰</p></blockquote><p>â€‹    </p><h4 id="2-å¼‚æ­¥è¯·æ±‚"><a href="#2-å¼‚æ­¥è¯·æ±‚" class="headerlink" title="2. å¼‚æ­¥è¯·æ±‚"></a>2. å¼‚æ­¥è¯·æ±‚</h4><p>â€‹    httpåè®®æ˜¯å•å‘çš„ï¼Œåªèƒ½å®¢æˆ·ç«¯è‡ªå·±æ‹‰ï¼Œä¸èƒ½æœåŠ¡ç«¯ä¸»åŠ¨æ¨ã€‚å¼‚æ­¥è¯·æ±‚ä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼ï¼Œå®šæ—¶è½®è¯¢æˆ–é•¿é“¾æ¥ã€‚Servletå¯¹å¼‚æ­¥çš„æ”¯æŒæ˜¯é€šè¿‡é•¿é“¾æ¥çš„æ–¹å¼ã€‚</p><h5 id="2-1-servletå¼‚æ­¥æ”¯æŒ"><a href="#2-1-servletå¼‚æ­¥æ”¯æŒ" class="headerlink" title="2.1 servletå¼‚æ­¥æ”¯æŒ"></a>2.1 servletå¼‚æ­¥æ”¯æŒ</h5><h6 id="2-1-1ServletRequest"><a href="#2-1-1ServletRequest" class="headerlink" title="2.1.1ServletRequest"></a>2.1.1ServletRequest</h6><p>â€‹    é¦–å…ˆæ˜¯åœ¨ 3.0åçš„ ServletRequest ä¸­å¯ä»¥æ‰¾åˆ°<code>#startAsync()</code> è¿”å›ä¸€ä¸ªå¼‚æ­¥å®¹å™¨</p><pre><code class="java">package javax.servlet;import java.io.*;import java.util.*;/** * Defines an object to provide client request information to a servlet.  The * servlet container creates a &lt;code&gt;ServletRequest&lt;/code&gt; object and passes * it as an argument to the servlet&#39;s &lt;code&gt;service&lt;/code&gt; method. * * &lt;p&gt;A &lt;code&gt;ServletRequest&lt;/code&gt; object provides data including * parameter name and values, attributes, and an input stream. * Interfaces that extend &lt;code&gt;ServletRequest&lt;/code&gt; can provide * additional protocol-specific data (for example, HTTP data is * provided by {@link javax.servlet.http.HttpServletRequest}. *  * @author     Various * * @see     javax.servlet.http.HttpServletRequest * */public interface ServletRequest {    /**     * Puts this request into asynchronous mode, and initializes its     * {@link AsyncContext} with the original (unwrapped) ServletRequest     * and ServletResponse objects.     *     * &lt;p&gt;Calling this method will cause committal of the associated     * response to be delayed until {@link AsyncContext#complete} is     * called on the returned {@link AsyncContext}, or the asynchronous     * operation has timed out.     *     * &lt;p&gt;Calling {@link AsyncContext#hasOriginalRequestAndResponse()} on     * the returned AsyncContext will return &lt;code&gt;true&lt;/code&gt;. Any filters     * invoked in the &lt;i&gt;outbound&lt;/i&gt; direction after this request was put     * into asynchronous mode may use this as an indication that any request     * and/or response wrappers that they added during their &lt;i&gt;inbound&lt;/i&gt;     * invocation need not stay around for the duration of the asynchronous     * operation, and therefore any of their associated resources may be     * released.     *     * &lt;p&gt;This method clears the list of {@link AsyncListener} instances     * (if any) that were registered with the AsyncContext returned by the     * previous call to one of the startAsync methods, after calling each     * AsyncListener at its {@link AsyncListener#onStartAsync onStartAsync}     * method.     *     * &lt;p&gt;Subsequent invocations of this method, or its overloaded      * variant, will return the same AsyncContext instance, reinitialized     * as appropriate.     *     * @return the (re)initialized AsyncContext     *      * @throws IllegalStateException if this request is within the scope of     * a filter or servlet that does not support asynchronous operations     * (that is, {@link #isAsyncSupported} returns false),     * or if this method is called again without any asynchronous dispatch     * (resulting from one of the {@link AsyncContext#dispatch} methods),     * is called outside the scope of any such dispatch, or is called again     * within the scope of the same dispatch, or if the response has     * already been closed     *     * @since Servlet 3.0     */    public AsyncContext startAsync() throws IllegalStateException;    //...}</code></pre><h6 id="2-1-2-å¼‚æ­¥å®¹å™¨AsyncContext"><a href="#2-1-2-å¼‚æ­¥å®¹å™¨AsyncContext" class="headerlink" title="2.1.2  å¼‚æ­¥å®¹å™¨AsyncContext"></a>2.1.2  å¼‚æ­¥å®¹å™¨AsyncContext</h6><pre><code class="java">package javax.servlet;/** * Class representing the execution context for an asynchronous operation * that was initiated on a ServletRequest. * * &lt;p&gt;An AsyncContext is created and initialized by a call to * {@link ServletRequest#startAsync()} or * {@link ServletRequest#startAsync(ServletRequest, ServletResponse)}. * Repeated invocations of these methods will return the same AsyncContext * instance, reinitialized as appropriate. * * &lt;p&gt;In the event that an asynchronous operation has timed out, the * container must run through these steps: * &lt;ol&gt; * &lt;li&gt;Invoke, at their {@link AsyncListener#onTimeout onTimeout} method, all * {@link AsyncListener} instances registered with the ServletRequest * on which the asynchronous operation was initiated.&lt;/li&gt; * &lt;li&gt;If none of the listeners called {@link #complete} or any of the * {@link #dispatch} methods, perform an error dispatch with a status code * equal to &lt;tt&gt;HttpServletResponse.SC_INTERNAL_SERVER_ERROR&lt;/tt&gt;.&lt;/li&gt; * &lt;li&gt;If no matching error page was found, or the error page did not call * {@link #complete} or any of the {@link #dispatch} methods, call * {@link #complete}.&lt;/li&gt; * &lt;/ol&gt; * * @since Servlet 3.0 */public interface AsyncContext {    /**     * The name of the request attribute under which the original     * request URI is made available to the target of a     * {@link #dispatch(String)} or {@link #dispatch(ServletContext,String)}      */    static final String ASYNC_REQUEST_URI = &quot;javax.servlet.async.request_uri&quot;;    /**     * The name of the request attribute under which the original     * context path is made available to the target of a     * {@link #dispatch(String)} or {@link #dispatch(ServletContext,String)}      */    static final String ASYNC_CONTEXT_PATH = &quot;javax.servlet.async.context_path&quot;;    /**     * The name of the request attribute under which the original     * path info is made available to the target of a     * {@link #dispatch(String)} or {@link #dispatch(ServletContext,String)}      */    static final String ASYNC_PATH_INFO = &quot;javax.servlet.async.path_info&quot;;    /**     * The name of the request attribute under which the original     * servlet path is made available to the target of a     * {@link #dispatch(String)} or {@link #dispatch(ServletContext,String)}       */    static final String ASYNC_SERVLET_PATH = &quot;javax.servlet.async.servlet_path&quot;;    /**     * The name of the request attribute under which the original     * query string is made available to the target of a     * {@link #dispatch(String)} or {@link #dispatch(ServletContext,String)}      */    static final String ASYNC_QUERY_STRING = &quot;javax.servlet.async.query_string&quot;;    /**     * Gets the request that was used to initialize this AsyncContext     * by calling {@link ServletRequest#startAsync()} or     * {@link ServletRequest#startAsync(ServletRequest, ServletResponse)}.     *     * @return the request that was used to initialize this AsyncContext     */    public ServletRequest getRequest();    /**     * Gets the response that was used to initialize this AsyncContext     * by calling {@link ServletRequest#startAsync()} or     * {@link ServletRequest#startAsync(ServletRequest, ServletResponse)}.     *     * @return the response that was used to initialize this AsyncContext     */    public ServletResponse getResponse();    /**     * Checks if this AsyncContext was initialized with the original or     * application-wrapped request and response objects.     *      * &lt;p&gt;This information may be used by filters invoked in the     * &lt;i&gt;outbound&lt;/i&gt; direction, after a request was put into     * asynchronous mode, to determine whether any request and/or response     * wrappers that they added during their &lt;i&gt;inbound&lt;/i&gt; invocation need     * to be preserved for the duration of the asynchronous operation, or may     * be released.     *     * @return true if this AsyncContext was initialized with the original     * request and response objects by calling     * {@link ServletRequest#startAsync()}, or if it was initialized by     * calling     * {@link ServletRequest#startAsync(ServletRequest, ServletResponse)},     * and neither the ServletRequest nor ServletResponse arguments      * carried any application-provided wrappers; false otherwise     */    public boolean hasOriginalRequestAndResponse();    /**     * Dispatches the request and response objects of this AsyncContext     * to the servlet container.     *      * &lt;p&gt;If the asynchronous cycle was started with     * {@link ServletRequest#startAsync(ServletRequest, ServletResponse)},     * and the request passed is an instance of HttpServletRequest,     * then the dispatch is to the URI returned by     * {@link javax.servlet.http.HttpServletRequest#getRequestURI}.     * Otherwise, the dispatch is to the URI of the request when it was     * last dispatched by the container.     *     * &lt;p&gt;The following sequence illustrates how this will work:     * &lt;code&gt;&lt;pre&gt;     * // REQUEST dispatch to /url/A     * AsyncContext ac = request.startAsync();     * ...     * ac.dispatch(); // ASYNC dispatch to /url/A     *      * // FORWARD dispatch to /url/B     * getRequestDispatcher(&quot;/url/B&quot;).forward(request,response);     * // Start async operation from within the target of the FORWARD     * // dispatch     * ac = request.startAsync();     * ...     * ac.dispatch(); // ASYNC dispatch to /url/A     *      * // FORWARD dispatch to /url/B     * getRequestDispatcher(&quot;/url/B&quot;).forward(request,response);     * // Start async operation from within the target of the FORWARD     * // dispatch     * ac = request.startAsync(request,response);     * ...     * ac.dispatch(); // ASYNC dispatch to /url/B     * &lt;/pre&gt;&lt;/code&gt;     *     * &lt;p&gt;This method returns immediately after passing the request     * and response objects to a container managed thread, on which the     * dispatch operation will be performed.     * If this method is called before the container-initiated dispatch     * that called &lt;tt&gt;startAsync&lt;/tt&gt; has returned to the container, the     * dispatch operation will be delayed until after the container-initiated     * dispatch has returned to the container.     *     * &lt;p&gt;The dispatcher type of the request is set to     * &lt;tt&gt;DispatcherType.ASYNC&lt;/tt&gt;. Unlike     * {@link RequestDispatcher#forward(ServletRequest, ServletResponse)     * forward dispatches}, the response buffer and     * headers will not be reset, and it is legal to dispatch even if the     * response has already been committed.     *     * &lt;p&gt;Control over the request and response is delegated     * to the dispatch target, and the response will be closed when the     * dispatch target has completed execution, unless     * {@link ServletRequest#startAsync()} or     * {@link ServletRequest#startAsync(ServletRequest, ServletResponse)}     * are called.     *      * &lt;p&gt;Any errors or exceptions that may occur during the execution     * of this method must be caught and handled by the container, as     * follows:     * &lt;ol&gt;     * &lt;li&gt;Invoke, at their {@link AsyncListener#onError onError} method, all     * {@link AsyncListener} instances registered with the ServletRequest     * for which this AsyncContext was created, and make the caught      * &lt;tt&gt;Throwable&lt;/tt&gt; available via {@link AsyncEvent#getThrowable}.&lt;/li&gt;     * &lt;li&gt;If none of the listeners called {@link #complete} or any of the     * {@link #dispatch} methods, perform an error dispatch with a status code     * equal to &lt;tt&gt;HttpServletResponse.SC_INTERNAL_SERVER_ERROR&lt;/tt&gt;, and     * make the above &lt;tt&gt;Throwable&lt;/tt&gt; available as the value of the     * &lt;tt&gt;RequestDispatcher.ERROR_EXCEPTION&lt;/tt&gt; request attribute.&lt;/li&gt;     * &lt;li&gt;If no matching error page was found, or the error page did not call     * {@link #complete} or any of the {@link #dispatch} methods, call     * {@link #complete}.&lt;/li&gt;     * &lt;/ol&gt;     *     * &lt;p&gt;There can be at most one asynchronous dispatch operation per     * asynchronous cycle, which is started by a call to one of the     * {@link ServletRequest#startAsync} methods. Any attempt to perform an     * additional asynchronous dispatch operation within the same     * asynchronous cycle will result in an IllegalStateException.     * If startAsync is subsequently called on the dispatched request,     * then any of the dispatch or {@link #complete} methods may be called.     *     * @throws IllegalStateException if one of the dispatch methods     * has been called and the startAsync method has not been     * called during the resulting dispatch, or if {@link #complete}     * was called     *     * @see ServletRequest#getDispatcherType     */    public void dispatch();    /**     * Dispatches the request and response objects of this AsyncContext     * to the given &lt;tt&gt;path&lt;/tt&gt;.     *     * &lt;p&gt;The &lt;tt&gt;path&lt;/tt&gt; parameter is interpreted in the same way      * as in {@link ServletRequest#getRequestDispatcher(String)}, within     * the scope of the {@link ServletContext} from which this     * AsyncContext was initialized.     *     * &lt;p&gt;All path related query methods of the request must reflect the     * dispatch target, while the original request URI, context path,     * path info, servlet path, and query string may be recovered from     * the {@link #ASYNC_REQUEST_URI}, {@link #ASYNC_CONTEXT_PATH},     * {@link #ASYNC_PATH_INFO}, {@link #ASYNC_SERVLET_PATH}, and     * {@link #ASYNC_QUERY_STRING} attributes of the request. These     * attributes will always reflect the original path elements, even under     * repeated dispatches.     *     * &lt;p&gt;There can be at most one asynchronous dispatch operation per     * asynchronous cycle, which is started by a call to one of the     * {@link ServletRequest#startAsync} methods. Any attempt to perform an     * additional asynchronous dispatch operation within the same     * asynchronous cycle will result in an IllegalStateException.     * If startAsync is subsequently called on the dispatched request,     * then any of the dispatch or {@link #complete} methods may be called.     *     * &lt;p&gt;See {@link #dispatch()} for additional details, including error     * handling.     *     * @param path the path of the dispatch target, scoped to the     * ServletContext from which this AsyncContext was initialized     *     * @throws IllegalStateException if one of the dispatch methods     * has been called and the startAsync method has not been     * called during the resulting dispatch, or if {@link #complete}     * was called     *     * @see ServletRequest#getDispatcherType     */    public void dispatch(String path);    /**     * Dispatches the request and response objects of this AsyncContext     * to the given &lt;tt&gt;path&lt;/tt&gt; scoped to the given &lt;tt&gt;context&lt;/tt&gt;.     *     * &lt;p&gt;The &lt;tt&gt;path&lt;/tt&gt; parameter is interpreted in the same way      * as in {@link ServletRequest#getRequestDispatcher(String)}, except that     * it is scoped to the given &lt;tt&gt;context&lt;/tt&gt;.     *     * &lt;p&gt;All path related query methods of the request must reflect the     * dispatch target, while the original request URI, context path,     * path info, servlet path, and query string may be recovered from     * the {@link #ASYNC_REQUEST_URI}, {@link #ASYNC_CONTEXT_PATH},     * {@link #ASYNC_PATH_INFO}, {@link #ASYNC_SERVLET_PATH}, and     * {@link #ASYNC_QUERY_STRING} attributes of the request. These     * attributes will always reflect the original path elements, even under     * repeated dispatches.     *     * &lt;p&gt;There can be at most one asynchronous dispatch operation per     * asynchronous cycle, which is started by a call to one of the     * {@link ServletRequest#startAsync} methods. Any attempt to perform an     * additional asynchronous dispatch operation within the same     * asynchronous cycle will result in an IllegalStateException.     * If startAsync is subsequently called on the dispatched request,     * then any of the dispatch or {@link #complete} methods may be called.     *     * &lt;p&gt;See {@link #dispatch()} for additional details, including error     * handling.     *     * @param context the ServletContext of the dispatch target     * @param path the path of the dispatch target, scoped to the given     * ServletContext     *     * @throws IllegalStateException if one of the dispatch methods     * has been called and the startAsync method has not been     * called during the resulting dispatch, or if {@link #complete}     * was called     *     * @see ServletRequest#getDispatcherType     */    public void dispatch(ServletContext context, String path);    /**     * Completes the asynchronous operation that was started on the request     * that was used to initialze this AsyncContext, closing the response     * that was used to initialize this AsyncContext.     *     * &lt;p&gt;Any listeners of type {@link AsyncListener} that were registered     * with the ServletRequest for which this AsyncContext was created will     * be invoked at their {@link AsyncListener#onComplete(AsyncEvent)     * onComplete} method.     *     * &lt;p&gt;It is legal to call this method any time after a call to     * {@link ServletRequest#startAsync()} or     * {@link ServletRequest#startAsync(ServletRequest, ServletResponse)},     * and before a call to one of the &lt;tt&gt;dispatch&lt;/tt&gt; methods     * of this class.      * If this method is called before the container-initiated dispatch     * that called &lt;tt&gt;startAsync&lt;/tt&gt; has returned to the container, then     * the call will not take effect (and any invocations of     * {@link AsyncListener#onComplete(AsyncEvent)} will be delayed) until     * after the container-initiated dispatch has returned to the container.     */    public void complete();    /**     * Causes the container to dispatch a thread, possibly from a managed     * thread pool, to run the specified &lt;tt&gt;Runnable&lt;/tt&gt;. The container may     * propagate appropriate contextual information to the &lt;tt&gt;Runnable&lt;/tt&gt;.      *     * @param run the asynchronous handler     */    public void start(Runnable run);    /**     * Registers the given {@link AsyncListener} with the most recent     * asynchronous cycle that was started by a call to one of the     * {@link ServletRequest#startAsync} methods.     *     * &lt;p&gt;The given AsyncListener will receive an {@link AsyncEvent} when     * the asynchronous cycle completes successfully, times out, or results     * in an error.     *     * &lt;p&gt;AsyncListener instances will be notified in the order in which     * they were added.     *     * @param listener the AsyncListener to be registered     *      * @throws IllegalStateException if this method is called after     * the container-initiated dispatch, during which one of the     * {@link ServletRequest#startAsync} methods was called, has     * returned to the container     */    public void addListener(AsyncListener listener);    /**     * Registers the given {@link AsyncListener} with the most recent     * asynchronous cycle that was started by a call to one of the     * {@link ServletRequest#startAsync} methods.     *     * &lt;p&gt;The given AsyncListener will receive an {@link AsyncEvent} when     * the asynchronous cycle completes successfully, times out, or results     * in an error.     *     * &lt;p&gt;AsyncListener instances will be notified in the order in which     * they were added.     *     * &lt;p&gt;The given ServletRequest and ServletResponse objects will     * be made available to the given AsyncListener via the     * {@link AsyncEvent#getSuppliedRequest getSuppliedRequest} and     * {@link AsyncEvent#getSuppliedResponse getSuppliedResponse} methods,     * respectively, of the {@link AsyncEvent} delivered to it. These objects     * should not be read from or written to, respectively, at the time the     * AsyncEvent is delivered, because additional wrapping may have     * occurred since the given AsyncListener was registered, but may be used     * in order to release any resources associated with them.     *     * @param listener the AsyncListener to be registered     * @param servletRequest the ServletRequest that will be included     * in the AsyncEvent     * @param servletResponse the ServletResponse that will be included     * in the AsyncEvent     *     * @throws IllegalStateException if this method is called after     * the container-initiated dispatch, during which one of the     * {@link ServletRequest#startAsync} methods was called, has     * returned to the container     */    public void addListener(AsyncListener listener,                            ServletRequest servletRequest,                            ServletResponse servletResponse);    /**     * Instantiates the given {@link AsyncListener} class.     *     * &lt;p&gt;The returned AsyncListener instance may be further customized     * before it is registered with this AsyncContext via a call to one of      * the &lt;code&gt;addListener&lt;/code&gt; methods.     *     * &lt;p&gt;The given AsyncListener class must define a zero argument     * constructor, which is used to instantiate it.     *     * &lt;p&gt;This method supports resource injection if the given     * &lt;tt&gt;clazz&lt;/tt&gt; represents a Managed Bean.     * See the Java EE platform and JSR 299 specifications for additional     * details about Managed Beans and resource injection.     * &lt;p&gt;This method supports any annotations applicable to AsyncListener.     *     * @param clazz the AsyncListener class to instantiate     *     * @return the new AsyncListener instance     *     * @throws ServletException if the given &lt;tt&gt;clazz&lt;/tt&gt; fails to be     * instantiated     */    public &lt;T extends AsyncListener&gt; T createListener(Class&lt;T&gt; clazz)        throws ServletException;     /**     * Sets the timeout (in milliseconds) for this AsyncContext.     *     * &lt;p&gt;The timeout applies to this AsyncContext once the     * container-initiated dispatch during which one of the     * {@link ServletRequest#startAsync} methods was called has     * returned to the container.      *     * &lt;p&gt;The timeout will expire if neither the {@link #complete} method     * nor any of the dispatch methods are called. A timeout value of     * zero or less indicates no timeout.      *      * &lt;p&gt;If {@link #setTimeout} is not called, then the container&#39;s     * default timeout, which is available via a call to     * {@link #getTimeout}, will apply.     *     * @param timeout the timeout in milliseconds     *     * @throws IllegalStateException if this method is called after     * the container-initiated dispatch, during which one of the     * {@link ServletRequest#startAsync} methods was called, has     * returned to the container     */    public void setTimeout(long timeout);    /**     * Gets the timeout (in milliseconds) for this AsyncContext.     *     * &lt;p&gt;This method returns the container&#39;s default timeout for     * asynchronous operations, or the timeout value passed to the most     * recent invocation of {@link #setTimeout}.     *     * &lt;p&gt;A timeout value of zero or less indicates no timeout.     *     * @return the timeout in milliseconds     */    public long getTimeout();}</code></pre><pre><code> æ¯”è¾ƒç®€å•ï¼Œé€šè¿‡çœ‹ä»£ç ä¸­çš„æ³¨é‡Šå°±èƒ½çŸ¥å…¶å¤§æ„äº†ï¼Œå¼‚æ­¥å°±æ˜¯ä¸ç­‰å¾…ç»“æœç«‹å³è¿”å›ï¼Œè¿™é‡Œstartä¸€èˆ¬ç”¨æ–°çº¿ç¨‹çš„æ–¹å¼ï¼Œçº¿ç¨‹è¿è¡Œå®Œå(#complete)ï¼Œéœ€è¦é€šçŸ¥ï¼ˆ#addListenerï¼‰,ä»¥åŠè¶…æ—¶æ£€æµ‹å¤„ç†ï¼ˆ#setTimeout,ç”±å®¹å™¨Tomcatæ¥è®¾ç½®ï¼‰</code></pre><h6 id="2-1-3-AsyncListenerç›‘å¬å™¨"><a href="#2-1-3-AsyncListenerç›‘å¬å™¨" class="headerlink" title="2.1.3 AsyncListenerç›‘å¬å™¨"></a>2.1.3 AsyncListenerç›‘å¬å™¨</h6><pre><code class="java">package javax.servlet;import java.io.IOException;import java.util.EventListener;/** * Listener that will be notified in the event that an asynchronous * operation initiated on a ServletRequest to which the listener had been  * added has completed, timed out, or resulted in an error. * * @since Servlet 3.0 */public interface AsyncListener extends EventListener {    /**     * Notifies this AsyncListener that an asynchronous operation     * has been completed.     *      * &lt;p&gt;The {@link AsyncContext} corresponding to the asynchronous     * operation that has been completed may be obtained by calling     * {@link AsyncEvent#getAsyncContext getAsyncContext} on the given     * &lt;tt&gt;event&lt;/tt&gt;.     *     * &lt;p&gt;In addition, if this AsyncListener had been registered via a call     * to {@link AsyncContext#addListener(AsyncListener,     * ServletRequest, ServletResponse)}, the supplied ServletRequest and     * ServletResponse objects may be retrieved by calling     * {@link AsyncEvent#getSuppliedRequest getSuppliedRequest} and     * {@link AsyncEvent#getSuppliedResponse getSuppliedResponse},     * respectively, on the given &lt;tt&gt;event&lt;/tt&gt;.     *     * @param event the AsyncEvent indicating that an asynchronous     * operation has been completed     *     * @throws IOException if an I/O related error has occurred during the     * processing of the given AsyncEvent     */    public void onComplete(AsyncEvent event) throws IOException;    /**     * Notifies this AsyncListener that an asynchronous operation     * has timed out.     *      * &lt;p&gt;The {@link AsyncContext} corresponding to the asynchronous     * operation that has timed out may be obtained by calling     * {@link AsyncEvent#getAsyncContext getAsyncContext} on the given     * &lt;tt&gt;event&lt;/tt&gt;.     *     * &lt;p&gt;In addition, if this AsyncListener had been registered via a call     * to {@link AsyncContext#addListener(AsyncListener,     * ServletRequest, ServletResponse)}, the supplied ServletRequest and     * ServletResponse objects may be retrieved by calling     * {@link AsyncEvent#getSuppliedRequest getSuppliedRequest} and     * {@link AsyncEvent#getSuppliedResponse getSuppliedResponse},     * respectively, on the given &lt;tt&gt;event&lt;/tt&gt;.     *     * @param event the AsyncEvent indicating that an asynchronous     * operation has timed out     *     * @throws IOException if an I/O related error has occurred during the     * processing of the given AsyncEvent     */    public void onTimeout(AsyncEvent event) throws IOException;    /**     * Notifies this AsyncListener that an asynchronous operation      * has failed to complete.     *      * &lt;p&gt;The {@link AsyncContext} corresponding to the asynchronous     * operation that failed to complete may be obtained by calling     * {@link AsyncEvent#getAsyncContext getAsyncContext} on the given     * &lt;tt&gt;event&lt;/tt&gt;.     *      * &lt;p&gt;In addition, if this AsyncListener had been registered via a call     * to {@link AsyncContext#addListener(AsyncListener,     * ServletRequest, ServletResponse)}, the supplied ServletRequest and     * ServletResponse objects may be retrieved by calling     * {@link AsyncEvent#getSuppliedRequest getSuppliedRequest} and     * {@link AsyncEvent#getSuppliedResponse getSuppliedResponse},     * respectively, on the given &lt;tt&gt;event&lt;/tt&gt;.     *     * @param event the AsyncEvent indicating that an asynchronous     * operation has failed to complete     *     * @throws IOException if an I/O related error has occurred during the     * processing of the given AsyncEvent     */    public void onError(AsyncEvent event) throws IOException;    /**     * Notifies this AsyncListener that a new asynchronous cycle is being     * initiated via a call to one of the {@link ServletRequest#startAsync}     * methods.     *     * &lt;p&gt;The {@link AsyncContext} corresponding to the asynchronous     * operation that is being reinitialized may be obtained by calling     * {@link AsyncEvent#getAsyncContext getAsyncContext} on the given     * &lt;tt&gt;event&lt;/tt&gt;.     *      * &lt;p&gt;In addition, if this AsyncListener had been registered via a call     * to {@link AsyncContext#addListener(AsyncListener,     * ServletRequest, ServletResponse)}, the supplied ServletRequest and     * ServletResponse objects may be retrieved by calling     * {@link AsyncEvent#getSuppliedRequest getSuppliedRequest} and     * {@link AsyncEvent#getSuppliedResponse getSuppliedResponse},     * respectively, on the given &lt;tt&gt;event&lt;/tt&gt;.     *     * &lt;p&gt;This AsyncListener will not receive any events related to the     * new asynchronous cycle unless it registers itself (via a call     * to {@link AsyncContext#addListener}) with the AsyncContext that     * is delivered as part of the given AsyncEvent.     *     * @param event the AsyncEvent indicating that a new asynchronous     * cycle is being initiated     *     * @throws IOException if an I/O related error has occurred during the     * processing of the given AsyncEvent     */    public void onStartAsync(AsyncEvent event) throws IOException;     }</code></pre><p>â€‹    ç›‘å¬å™¨ä¸»è¦æœ‰4ä¸ªäº‹ä»¶ï¼Œå¼€å§‹ã€å®Œæˆã€è¶…æ—¶ã€é”™è¯¯ã€‚</p><h5 id="2-2-SpringMVCä¸­çš„ç›¸å…³ç»„ä»¶"><a href="#2-2-SpringMVCä¸­çš„ç›¸å…³ç»„ä»¶" class="headerlink" title="2.2 SpringMVCä¸­çš„ç›¸å…³ç»„ä»¶"></a>2.2 SpringMVCä¸­çš„ç›¸å…³ç»„ä»¶</h5><p>â€‹    SpringMVCä¸­å¼‚æ­¥è¯·æ±‚ç›¸å…³ç»„ä»¶ AsyncWebRequestã€WebAsyncManagerã€WebAsyncUtils    </p><h6 id="2-2-1-AsyncWebRequest"><a href="#2-2-1-AsyncWebRequest" class="headerlink" title="2.2.1 AsyncWebRequest"></a>2.2.1 AsyncWebRequest</h6><p><img src="https://ws4.sinaimg.cn/large/006tNbRwly1fydgk0syd0j30u019f7aj.jpg" alt="image-20181220195645682"></p><p>å…¶å®ç°æœ‰ä¸¤ä¸ªï¼Œå…¶ä¸­<code>NoSupportAsyncWebRequest</code>ä¸æ”¯æŒå¼‚æ­¥ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å…³æ³¨<code>StandarServletAsyncWebRequest</code>å³å¯ã€‚ï¼ˆå¯ä»¥çœ‹åˆ°å…¶å®ä¸»è¦æ˜¯å¯¹Serveltä¸­æ”¯æŒå¼‚æ­¥çš„ç±»çš„ä¸€äº›ç‰¹æ€§è¿›è¡Œæ•´åˆï¼‰</p><p><img src="https://ws2.sinaimg.cn/large/006tNbRwly1fydgqk142nj31bm0pawie.jpg" alt="image-20181220200306736"></p><blockquote><p>å…·ä½“ç»†èŠ‚çœ‹StandarServletAsyncWebRequestçš„å®ç°</p></blockquote><h6 id="2-2-2-WebAsyncManager"><a href="#2-2-2-WebAsyncManager" class="headerlink" title="2.2.2 WebAsyncManager"></a>2.2.2 WebAsyncManager</h6><pre><code class="java">package org.springframework.web.context.request.async;import java.util.ArrayList;import java.util.LinkedHashMap;import java.util.List;import java.util.Map;import java.util.concurrent.Callable;import javax.servlet.http.HttpServletRequest;import org.apache.commons.logging.Log;import org.apache.commons.logging.LogFactory;import org.springframework.core.task.AsyncTaskExecutor;import org.springframework.core.task.SimpleAsyncTaskExecutor;import org.springframework.util.Assert;import org.springframework.web.context.request.RequestAttributes;import org.springframework.web.context.request.async.DeferredResult.DeferredResultHandler;import org.springframework.web.util.UrlPathHelper;/** * The central class for managing asynchronous request processing, mainly intended * as an SPI and not typically used directly by application classes. * * &lt;p&gt;An async scenario starts with request processing as usual in a thread (T1). * Concurrent request handling can be initiated by calling * {@link #startCallableProcessing(Callable, Object...) startCallableProcessing} or * {@link #startDeferredResultProcessing(DeferredResult, Object...) startDeferredResultProcessing}, * both of which produce a result in a separate thread (T2). The result is saved * and the request dispatched to the container, to resume processing with the saved * result in a third thread (T3). Within the dispatched thread (T3), the saved * result can be accessed via {@link #getConcurrentResult()} or its presence * detected via {@link #hasConcurrentResult()}. * * @author Rossen Stoyanchev * @since 3.2 * * @see org.springframework.web.context.request.AsyncWebRequestInterceptor * @see org.springframework.web.servlet.AsyncHandlerInterceptor * @see org.springframework.web.filter.OncePerRequestFilter#shouldNotFilterAsyncDispatch * @see org.springframework.web.filter.OncePerRequestFilter#isAsyncDispatch */public final class WebAsyncManager {   private static final Object RESULT_NONE = new Object();   private static final Log logger = LogFactory.getLog(WebAsyncManager.class);   private static final UrlPathHelper urlPathHelper = new UrlPathHelper();   private static final CallableProcessingInterceptor timeoutCallableInterceptor =         new TimeoutCallableProcessingInterceptor();   private static final DeferredResultProcessingInterceptor timeoutDeferredResultInterceptor =         new TimeoutDeferredResultProcessingInterceptor();   private AsyncWebRequest asyncWebRequest;   private AsyncTaskExecutor taskExecutor = new SimpleAsyncTaskExecutor(this.getClass().getSimpleName());   private Object concurrentResult = RESULT_NONE;   private Object[] concurrentResultContext;   private final Map&lt;Object, CallableProcessingInterceptor&gt; callableInterceptors =         new LinkedHashMap&lt;Object, CallableProcessingInterceptor&gt;();   private final Map&lt;Object, DeferredResultProcessingInterceptor&gt; deferredResultInterceptors =         new LinkedHashMap&lt;Object, DeferredResultProcessingInterceptor&gt;();   /**    * Package private constructor.    * @see WebAsyncUtils#getAsyncManager(javax.servlet.ServletRequest)    * @see WebAsyncUtils#getAsyncManager(org.springframework.web.context.request.WebRequest)    */   WebAsyncManager() {   }   /**    * Configure the {@link AsyncWebRequest} to use. This property may be set    * more than once during a single request to accurately reflect the current    * state of the request (e.g. following a forward, request/response    * wrapping, etc). However, it should not be set while concurrent handling    * is in progress, i.e. while {@link #isConcurrentHandlingStarted()} is    * {@code true}.    *    * @param asyncWebRequest the web request to use    */   public void setAsyncWebRequest(final AsyncWebRequest asyncWebRequest) {      Assert.notNull(asyncWebRequest, &quot;AsyncWebRequest must not be null&quot;);      Assert.state(!isConcurrentHandlingStarted(), &quot;Can&#39;t set AsyncWebRequest with concurrent handling in progress&quot;);      this.asyncWebRequest = asyncWebRequest;      this.asyncWebRequest.addCompletionHandler(new Runnable() {         @Override         public void run() {            asyncWebRequest.removeAttribute(WebAsyncUtils.WEB_ASYNC_MANAGER_ATTRIBUTE, RequestAttributes.SCOPE_REQUEST);         }      });   }   /**    * Configure an AsyncTaskExecutor for use with concurrent processing via    * {@link #startCallableProcessing(Callable, Object...)}.    * &lt;p&gt;By default a {@link SimpleAsyncTaskExecutor} instance is used.    */   public void setTaskExecutor(AsyncTaskExecutor taskExecutor) {      this.taskExecutor = taskExecutor;   }   /**    * Whether the selected handler for the current request chose to handle the    * request asynchronously. A return value of &quot;true&quot; indicates concurrent    * handling is under way and the response will remain open. A return value    * of &quot;false&quot; means concurrent handling was either not started or possibly    * that it has completed and the request was dispatched for further    * processing of the concurrent result.    */   public boolean isConcurrentHandlingStarted() {      return ((this.asyncWebRequest != null) &amp;&amp; this.asyncWebRequest.isAsyncStarted());   }   /**    * Whether a result value exists as a result of concurrent handling.    */   public boolean hasConcurrentResult() {      return (this.concurrentResult != RESULT_NONE);   }   /**    * Provides access to the result from concurrent handling.    *    * @return an Object, possibly an {@code Exception} or {@code Throwable} if    * concurrent handling raised one.    * @see #clearConcurrentResult()    */   public Object getConcurrentResult() {      return this.concurrentResult;   }   /**    * Provides access to additional processing context saved at the start of    * concurrent handling.    *    * @see #clearConcurrentResult()    */   public Object[] getConcurrentResultContext() {      return this.concurrentResultContext;   }   /**    * Get the {@link CallableProcessingInterceptor} registered under the given key.    * @param key the key    * @return the interceptor registered under that key or {@code null}    */   public CallableProcessingInterceptor getCallableInterceptor(Object key) {      return this.callableInterceptors.get(key);   }   /**    * Get the {@link DeferredResultProcessingInterceptor} registered under the given key.    * @param key the key    * @return the interceptor registered under that key or {@code null}    */   public DeferredResultProcessingInterceptor getDeferredResultInterceptor(Object key) {      return this.deferredResultInterceptors.get(key);   }   /**    * Register a {@link CallableProcessingInterceptor} under the given key.    * @param key the key    * @param interceptor the interceptor to register    */   public void registerCallableInterceptor(Object key, CallableProcessingInterceptor interceptor) {      Assert.notNull(key, &quot;Key is required&quot;);      Assert.notNull(interceptor, &quot;CallableProcessingInterceptor  is required&quot;);      this.callableInterceptors.put(key, interceptor);   }   /**    * Register a {@link CallableProcessingInterceptor} without a key.    * The key is derived from the class name and hashcode.    * @param interceptors one or more interceptors to register    */   public void registerCallableInterceptors(CallableProcessingInterceptor... interceptors) {      Assert.notNull(interceptors, &quot;A CallableProcessingInterceptor is required&quot;);      for (CallableProcessingInterceptor interceptor : interceptors) {         String key = interceptor.getClass().getName() + &quot;:&quot; + interceptor.hashCode();         this.callableInterceptors.put(key, interceptor);      }   }   /**    * Register a {@link DeferredResultProcessingInterceptor} under the given key.    * @param key the key    * @param interceptor the interceptor to register    */   public void registerDeferredResultInterceptor(Object key, DeferredResultProcessingInterceptor interceptor) {      Assert.notNull(key, &quot;Key is required&quot;);      Assert.notNull(interceptor, &quot;DeferredResultProcessingInterceptor is required&quot;);      this.deferredResultInterceptors.put(key, interceptor);   }   /**    * Register a {@link DeferredResultProcessingInterceptor} without a key.    * The key is derived from the class name and hashcode.    * @param interceptors one or more interceptors to register    */   public void registerDeferredResultInterceptors(DeferredResultProcessingInterceptor... interceptors) {      Assert.notNull(interceptors, &quot;A DeferredResultProcessingInterceptor is required&quot;);      for (DeferredResultProcessingInterceptor interceptor : interceptors) {         String key = interceptors.getClass().getName() + &quot;:&quot; + interceptors.hashCode();         this.deferredResultInterceptors.put(key, interceptor);      }   }   /**    * Clear {@linkplain #getConcurrentResult() concurrentResult} and    * {@linkplain #getConcurrentResultContext() concurrentResultContext}.    */   public void clearConcurrentResult() {      this.concurrentResult = RESULT_NONE;      this.concurrentResultContext = null;   }   /**    * Start concurrent request processing and execute the given task with an    * {@link #setTaskExecutor(AsyncTaskExecutor) AsyncTaskExecutor}. The result    * from the task execution is saved and the request dispatched in order to    * resume processing of that result. If the task raises an Exception then    * the saved result will be the raised Exception.    *    * @param callable a unit of work to be executed asynchronously    * @param processingContext additional context to save that can be accessed    * via {@link #getConcurrentResultContext()}    * @throws Exception If concurrent processing failed to start    *    * @see #getConcurrentResult()    * @see #getConcurrentResultContext()    */   @SuppressWarnings({&quot;unchecked&quot;, &quot;rawtypes&quot; })   public void startCallableProcessing(final Callable&lt;?&gt; callable, Object... processingContext) throws Exception {      Assert.notNull(callable, &quot;Callable must not be null&quot;);      startCallableProcessing(new WebAsyncTask(callable), processingContext);   }   /**    * Use the given {@link WebAsyncTask} to configure the task executor as well as    * the timeout value of the {@code AsyncWebRequest} before delegating to    * {@link #startCallableProcessing(Callable, Object...)}.    *    * @param webAsyncTask a WebAsyncTask containing the target {@code Callable}    * @param processingContext additional context to save that can be accessed    * via {@link #getConcurrentResultContext()}    * @throws Exception If concurrent processing failed to start    */   public void startCallableProcessing(final WebAsyncTask&lt;?&gt; webAsyncTask, Object... processingContext) throws Exception {      Assert.notNull(webAsyncTask, &quot;WebAsyncTask must not be null&quot;);      Assert.state(this.asyncWebRequest != null, &quot;AsyncWebRequest must not be null&quot;);      Long timeout = webAsyncTask.getTimeout();      if (timeout != null) {         this.asyncWebRequest.setTimeout(timeout);      }      AsyncTaskExecutor executor = webAsyncTask.getExecutor();      if (executor != null) {         this.taskExecutor = executor;      }      List&lt;CallableProcessingInterceptor&gt; interceptors = new ArrayList&lt;CallableProcessingInterceptor&gt;();      interceptors.add(webAsyncTask.getInterceptor());      interceptors.addAll(this.callableInterceptors.values());      interceptors.add(timeoutCallableInterceptor);      final Callable&lt;?&gt; callable = webAsyncTask.getCallable();      final CallableInterceptorChain interceptorChain = new CallableInterceptorChain(interceptors);      this.asyncWebRequest.addTimeoutHandler(new Runnable() {         @Override         public void run() {            logger.debug(&quot;Processing timeout&quot;);            Object result = interceptorChain.triggerAfterTimeout(asyncWebRequest, callable);            if (result != CallableProcessingInterceptor.RESULT_NONE) {               setConcurrentResultAndDispatch(result);            }         }      });      this.asyncWebRequest.addCompletionHandler(new Runnable() {         @Override         public void run() {            interceptorChain.triggerAfterCompletion(asyncWebRequest, callable);         }      });      interceptorChain.applyBeforeConcurrentHandling(asyncWebRequest, callable);      startAsyncProcessing(processingContext);      this.taskExecutor.submit(new Runnable() {         @Override         public void run() {            Object result = null;            try {               interceptorChain.applyPreProcess(asyncWebRequest, callable);               result = callable.call();            }            catch (Throwable t) {               result = t;            }            finally {               result = interceptorChain.applyPostProcess(asyncWebRequest, callable, result);            }            setConcurrentResultAndDispatch(result);         }      });   }   private void setConcurrentResultAndDispatch(Object result) {      synchronized (WebAsyncManager.this) {         if (hasConcurrentResult()) {            return;         }         concurrentResult = result;      }      if (asyncWebRequest.isAsyncComplete()) {         logger.error(&quot;Could not complete async processing due to timeout or network error&quot;);         return;      }      logger.debug(&quot;Concurrent result value [&quot; + concurrentResult + &quot;]&quot;);      logger.debug(&quot;Dispatching request to resume processing&quot;);      asyncWebRequest.dispatch();   }   /**    * Start concurrent request processing and initialize the given    * {@link DeferredResult} with a {@link DeferredResultHandler} that saves    * the result and dispatches the request to resume processing of that    * result. The {@code AsyncWebRequest} is also updated with a completion    * handler that expires the {@code DeferredResult} and a timeout handler    * assuming the {@code DeferredResult} has a default timeout result.    *    * @param deferredResult the DeferredResult instance to initialize    * @param processingContext additional context to save that can be accessed    * via {@link #getConcurrentResultContext()}    * @throws Exception If concurrent processing failed to start    *    * @see #getConcurrentResult()    * @see #getConcurrentResultContext()    */   public void startDeferredResultProcessing(         final DeferredResult&lt;?&gt; deferredResult, Object... processingContext) throws Exception {      Assert.notNull(deferredResult, &quot;DeferredResult must not be null&quot;);      Assert.state(this.asyncWebRequest != null, &quot;AsyncWebRequest must not be null&quot;);      Long timeout = deferredResult.getTimeoutValue();      if (timeout != null) {         this.asyncWebRequest.setTimeout(timeout);      }      List&lt;DeferredResultProcessingInterceptor&gt; interceptors = new ArrayList&lt;DeferredResultProcessingInterceptor&gt;();      interceptors.add(deferredResult.getInterceptor());      interceptors.addAll(this.deferredResultInterceptors.values());      interceptors.add(timeoutDeferredResultInterceptor);      final DeferredResultInterceptorChain interceptorChain = new DeferredResultInterceptorChain(interceptors);      this.asyncWebRequest.addTimeoutHandler(new Runnable() {         @Override         public void run() {            try {               interceptorChain.triggerAfterTimeout(asyncWebRequest, deferredResult);            }            catch (Throwable t) {               setConcurrentResultAndDispatch(t);            }         }      });      this.asyncWebRequest.addCompletionHandler(new Runnable() {         @Override         public void run() {            interceptorChain.triggerAfterCompletion(asyncWebRequest, deferredResult);         }      });      interceptorChain.applyBeforeConcurrentHandling(asyncWebRequest, deferredResult);      startAsyncProcessing(processingContext);      try {         interceptorChain.applyPreProcess(this.asyncWebRequest, deferredResult);         deferredResult.setResultHandler(new DeferredResultHandler() {            @Override            public void handleResult(Object result) {               result = interceptorChain.applyPostProcess(asyncWebRequest, deferredResult, result);               setConcurrentResultAndDispatch(result);            }         });      }      catch (Throwable t) {         setConcurrentResultAndDispatch(t);      }   }   private void startAsyncProcessing(Object[] processingContext) {      clearConcurrentResult();      this.concurrentResultContext = processingContext;      this.asyncWebRequest.startAsync();      if (logger.isDebugEnabled()) {         HttpServletRequest request = this.asyncWebRequest.getNativeRequest(HttpServletRequest.class);         String requestUri = urlPathHelper.getRequestUri(request);         logger.debug(&quot;Concurrent handling starting for &quot; + request.getMethod() + &quot; [&quot; + requestUri + &quot;]&quot;);      }   }}</code></pre><p>â€‹    ç±»ä¸­æœ‰ä¸¤ä¸ªé‡è¦çš„æ–¹æ³•#startCallableProcessingï¼ˆç”¨äºå¤„ç†Callableå’ŒWebAsyncTaskç±»å‹ï¼‰ï¼Œ#startDeferredResultProcessingï¼ˆç”¨äºå¤„ç†DeferredResultå’ŒListenableFutureç±»å‹ï¼‰,æ˜¯å¯åŠ¨å¼‚æ­¥å¤„ç†çš„å…¥å£æ–¹æ³•ï¼Œå®ƒä»¬ä¸€å…±åšäº†ä¸‰ä»¶äº‹</p><ul><li>å¯åŠ¨å¼‚æ­¥å¤„ç†</li><li>ç»™Requestè®¾ç½®ç›¸åº”å±æ€§ï¼ˆtimeoutã€timeoutHandlerå’ŒcompletionHandlerï¼‰</li><li>åœ¨ç›¸åº”çš„ä½ç½®è°ƒç”¨ç›¸åº”çš„æ‹¦æˆªå™¨ï¼ˆCallableProcessingInterceptorå’ŒDeferredResultProcessingInterceptoréƒ½å°è£…åœ¨ç›¸åº”çš„Chainä¸­ï¼‰</li></ul><blockquote><p>æ›´å¤šç»†èŠ‚ å¯æŸ¥çœ‹startCallableProcessingçš„æ‰§è¡Œè¿‡ç¨‹</p></blockquote><h6 id="2-2-3-WebAsyncUtils"><a href="#2-2-3-WebAsyncUtils" class="headerlink" title="2.2.3 WebAsyncUtils"></a>2.2.3 WebAsyncUtils</h6><pre><code class="java">package org.springframework.web.context.request.async;import java.lang.reflect.Constructor;import javax.servlet.ServletRequest;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import org.springframework.beans.BeanUtils;import org.springframework.util.ClassUtils;import org.springframework.web.context.request.RequestAttributes;import org.springframework.web.context.request.WebRequest;/** * Utility methods related to processing asynchronous web requests. * * @author Rossen Stoyanchev * @since 3.2 */public abstract class WebAsyncUtils {   public static final String WEB_ASYNC_MANAGER_ATTRIBUTE = WebAsyncManager.class.getName() + &quot;.WEB_ASYNC_MANAGER&quot;;   private static Constructor&lt;?&gt; standardAsyncRequestConstructor;   /**    * Obtain the {@link WebAsyncManager} for the current request, or if not    * found, create and associate it with the request.    */   public static WebAsyncManager getAsyncManager(ServletRequest servletRequest) {      WebAsyncManager asyncManager = (WebAsyncManager) servletRequest.getAttribute(WEB_ASYNC_MANAGER_ATTRIBUTE);      if (asyncManager == null) {         asyncManager = new WebAsyncManager();         servletRequest.setAttribute(WEB_ASYNC_MANAGER_ATTRIBUTE, asyncManager);      }      return asyncManager;   }   /**    * Obtain the {@link WebAsyncManager} for the current request, or if not    * found, create and associate it with the request.    */   public static WebAsyncManager getAsyncManager(WebRequest webRequest) {      int scope = RequestAttributes.SCOPE_REQUEST;      WebAsyncManager asyncManager = (WebAsyncManager) webRequest.getAttribute(WEB_ASYNC_MANAGER_ATTRIBUTE, scope);      if (asyncManager == null) {         asyncManager = new WebAsyncManager();         webRequest.setAttribute(WEB_ASYNC_MANAGER_ATTRIBUTE, asyncManager, scope);      }      return asyncManager;   }   /**    * Create an AsyncWebRequest instance. By default an instance of    * {@link StandardServletAsyncWebRequest} is created if running in Servlet    * 3.0 (or higher) environment or as a fallback, an instance of    * {@link NoSupportAsyncWebRequest} is returned.    *    * @param request the current request    * @param response the current response    * @return an AsyncWebRequest instance, never {@code null}    */   public static AsyncWebRequest createAsyncWebRequest(HttpServletRequest request, HttpServletResponse response) {      return ClassUtils.hasMethod(ServletRequest.class, &quot;startAsync&quot;) ?            createStandardServletAsyncWebRequest(request, response) : new NoSupportAsyncWebRequest(request, response);   }   private static AsyncWebRequest createStandardServletAsyncWebRequest(HttpServletRequest request, HttpServletResponse response) {      try {         if (standardAsyncRequestConstructor == null) {            String className = &quot;org.springframework.web.context.request.async.StandardServletAsyncWebRequest&quot;;            Class&lt;?&gt; clazz = ClassUtils.forName(className, WebAsyncUtils.class.getClassLoader());            standardAsyncRequestConstructor = clazz.getConstructor(HttpServletRequest.class, HttpServletResponse.class);         }         return (AsyncWebRequest) BeanUtils.instantiateClass(standardAsyncRequestConstructor, request, response);      }      catch (Throwable t) {         throw new IllegalStateException(&quot;Failed to instantiate StandardServletAsyncWebRequest&quot;, t);      }   }}</code></pre><p>â€‹    å¯ä»¥çœ‹åˆ°è¿™ä¸ªç±»ä¸»è¦æ˜¯æä¾›WebAsyncManageã€AsyncWebRequest ç›¸å…³çš„æ“ä½œ</p><h5 id="2-3-SpringMVCä¸­è¯·æ±‚çš„æ”¯æŒ"><a href="#2-3-SpringMVCä¸­è¯·æ±‚çš„æ”¯æŒ" class="headerlink" title="2.3 SpringMVCä¸­è¯·æ±‚çš„æ”¯æŒ"></a>2.3 SpringMVCä¸­è¯·æ±‚çš„æ”¯æŒ</h5><ol><li><p><code>FrameworkServlet</code>ä¸­æ·»åŠ äº†<code>RequestBindingInterceptor</code></p></li><li><p><code>RequestMappingHandlerAdapter</code>çš„<code>#invokeHandlerMethod</code> æä¾›äº†å¯¹å¼‚æ­¥è¯·æ±‚çš„æ ¸å¿ƒæ”¯æŒ</p><p> â€‹    2.1 åˆ›å»º<code>AsyncWebRequest</code>å¹¶è®¾ç½®è¶…æ—¶æ—¶é—´</p><p> â€‹    2.2 å¯¹å½“å‰è¯·æ±‚<code>WebAsyncManager</code>è®¾ç½®äº†å±æ€§<code>ï¼ˆtaskExecutorã€asyncWebRequestã€callabltinterceptorså’ŒdeferredResultInterceptorsï¼‰</code></p><p> â€‹    2.3 å¹¶åˆ¤æ–­æ˜¯å¦æœ‰ç»“æœï¼Œå¦‚æœæœ‰å¯¹ç»“æœè¿›è¡Œå¤„ç†ã€‚<code>requestMappingMethod = requestMappingMethod.wrapConcurrentResult(result);</code></p><p> â€‹    2.4 ç„¶åæ‰§è¡Œæ–¹æ³• <code>requestMappingMethod.invokeAndHandle(webRequest, mavContainer);</code></p></li><li><p>è¿”å›å€¼å¤„ç†å™¨ï¼Œ<code>AsyncTaskMethodReturnValueHandler</code> <code>CallableMethodReturnValueHandler</code> <code>DeferredResultMethodReturnValueHandler</code> <code>ListenableFutureReturnValueHandler</code></p></li><li><p><code>DispatcherServlet</code>çš„<code>#doDispatcher</code>ï¼Œå¦‚æœæ˜¯å¼‚æ­¥ç›´æ¥è¿”å›ã€‚</p></li></ol><pre><code class="java">/** * Invoke the {@link RequestMapping} handler method preparing a {@link ModelAndView} * if view resolution is required. */private ModelAndView invokeHandleMethod(HttpServletRequest request,      HttpServletResponse response, HandlerMethod handlerMethod) throws Exception {   ServletWebRequest webRequest = new ServletWebRequest(request, response);   WebDataBinderFactory binderFactory = getDataBinderFactory(handlerMethod);   ModelFactory modelFactory = getModelFactory(handlerMethod, binderFactory);   ServletInvocableHandlerMethod requestMappingMethod = createRequestMappingMethod(handlerMethod, binderFactory);   ModelAndViewContainer mavContainer = new ModelAndViewContainer();   mavContainer.addAllAttributes(RequestContextUtils.getInputFlashMap(request));   modelFactory.initModel(webRequest, mavContainer, requestMappingMethod);   mavContainer.setIgnoreDefaultModelOnRedirect(this.ignoreDefaultModelOnRedirect);   AsyncWebRequest asyncWebRequest = WebAsyncUtils.createAsyncWebRequest(request, response);   asyncWebRequest.setTimeout(this.asyncRequestTimeout);   final WebAsyncManager asyncManager = WebAsyncUtils.getAsyncManager(request);   asyncManager.setTaskExecutor(this.taskExecutor);   asyncManager.setAsyncWebRequest(asyncWebRequest);   asyncManager.registerCallableInterceptors(this.callableInterceptors);   asyncManager.registerDeferredResultInterceptors(this.deferredResultInterceptors);   if (asyncManager.hasConcurrentResult()) {      Object result = asyncManager.getConcurrentResult();      mavContainer = (ModelAndViewContainer) asyncManager.getConcurrentResultContext()[0];      asyncManager.clearConcurrentResult();      if (logger.isDebugEnabled()) {         logger.debug(&quot;Found concurrent result value [&quot; + result + &quot;]&quot;);      }      requestMappingMethod = requestMappingMethod.wrapConcurrentResult(result);   }   requestMappingMethod.invokeAndHandle(webRequest, mavContainer);   if (asyncManager.isConcurrentHandlingStarted()) {      return null;   }   return getModelAndView(mavContainer, modelFactory, webRequest);}</code></pre><h5 id="2-4-SpringWebFlux-å¾…è¡¥å……"><a href="#2-4-SpringWebFlux-å¾…è¡¥å……" class="headerlink" title="2.4 SpringWebFlux  ==å¾…è¡¥å……=="></a>2.4 SpringWebFlux  ==å¾…è¡¥å……==</h5>]]></content>
      
      
      <categories>
          
          <category> spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> spring </tag>
            
            <tag> servlet </tag>
            
            <tag> spring-mvc </tag>
            
            <tag> spring-webflux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>servlet_tomcat</title>
      <link href="/2019/02/03/Overview_Tomcat/"/>
      <url>/2019/02/03/Overview_Tomcat/</url>
      
        <content type="html"><![CDATA[<p>é˜…è¯»çš„ç›®çš„ï¼Ÿæˆ‘æƒ³è¦ä»ä¸­è·å¾—ä»€ä¹ˆï¼Ÿ</p><p>â€‹    å¯¹tomcatå®¹å™¨çš„åˆ†æ æ€»ç»“</p><h2 id="ç‰ˆæœ¬æƒ…å†µ"><a href="#ç‰ˆæœ¬æƒ…å†µ" class="headerlink" title="ç‰ˆæœ¬æƒ…å†µ"></a>ç‰ˆæœ¬æƒ…å†µ</h2><p><img src="https://ws4.sinaimg.cn/large/006tNc79gy1fztadjl1lbj31680mmtd6.jpg" alt="image-20190203155202660"></p><h2 id="Tomcatçš„é¡¶å±‚ç»“æ„"><a href="#Tomcatçš„é¡¶å±‚ç»“æ„" class="headerlink" title="Tomcatçš„é¡¶å±‚ç»“æ„"></a>Tomcatçš„é¡¶å±‚ç»“æ„</h2><ul><li><p>Catalina ç®¡ç†æ•´ä¸ªTomcatçš„ç®¡ç†ç±»</p></li><li><p>Server æœ€é¡¶å±‚å®¹å™¨ï¼Œä»£è¡¨æ•´ä¸ªæœåŠ¡å™¨</p></li><li>Service æä¾›å…·ä½“æœåŠ¡ ï¼ˆå¤šä¸ªï¼‰</li><li>Connector è´Ÿè´£ç½‘ç»œè¿æ¥ã€request/responseçš„åˆ›å»ºï¼ˆå¯ä»¥æœ‰å¤šä¸ªè¿æ¥ï¼Œä»servet.xmlçš„é…ç½®ä¹Ÿå¯ä»¥çœ‹å‡ºï¼ŒåŒæ—¶æä¾›httpå’Œhttpsï¼Œä¹Ÿå¯ä»¥æä¾›ç›¸åŒåè®®ä¸åŒç«¯å£çš„è¿æ¥ï¼‰</li><li>Container å…·ä½“å¤„ç†Servlet</li></ul><p><img src="http://ww3.sinaimg.cn/large/006tNc79gy1g3j4xp3inmj30iw0bwmz4.jpg" alt="img"></p><p>è´´ä¸ªå›¾(æºè‡ªè¿™é‡Œ<a href="https://my.oschina.net/masterworker/blog/844225" target="_blank" rel="noopener">https://my.oschina.net/masterworker/blog/844225</a>)</p><h2 id="Tomcatçš„å¯åŠ¨è¿‡ç¨‹"><a href="#Tomcatçš„å¯åŠ¨è¿‡ç¨‹" class="headerlink" title="Tomcatçš„å¯åŠ¨è¿‡ç¨‹"></a>Tomcatçš„å¯åŠ¨è¿‡ç¨‹</h2><p><code>org.apache.catalina.startup.Bootstrap</code> æ˜¯Tomcatçš„å…¥å£ï¼Œä½œç”¨ç±»ä¼¼ä¸€ä¸ª<code>CatalinaAdptor</code>ï¼Œå…·ä½“å¤„ç†è¿˜æ˜¯Catalinaæ¥å®Œæˆï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯å¯ä»¥æŠŠå¯åŠ¨çš„å…¥å£å’Œå…·ä½“çš„ç®¡ç†ç±»åˆ†å¼€ï¼Œä»è€Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°åˆ›å»ºå‡ºå¤šç§å¯åŠ¨æ–¹å¼ã€‚ </p><blockquote><p>BootStrapä¸åœ¨Tomcatä¾èµ–åŒ…ä¸‹ ï¼Œè€Œæ˜¯åœ¨binç›®å½• é€šè¿‡åå°„ å®Œå…¨æ¾è€¦åˆ</p></blockquote><pre><code class="java">package org.apache.catalina.startup;import ...;public final class Bootstrap {    private static final Log log = LogFactory.getLog(Bootstrap.class);    /**     * Daemon object used by main.     */    private static Bootstrap daemon = null;    /**     * Daemon reference.     */    private Object catalinaDaemon = null;    ClassLoader commonLoader = null;    ClassLoader catalinaLoader = null;    ClassLoader sharedLoader = null;    private void initClassLoaders() {        try {            commonLoader = createClassLoader(&quot;common&quot;, null);            if( commonLoader == null ) {                // no config file, default to this loader - we might be in a &#39;single&#39; env.                commonLoader=this.getClass().getClassLoader();            }            catalinaLoader = createClassLoader(&quot;server&quot;, commonLoader);            sharedLoader = createClassLoader(&quot;shared&quot;, commonLoader);        } catch (Throwable t) {            handleThrowable(t);            log.error(&quot;Class loader creation threw exception&quot;, t);            System.exit(1);        }    }    private ClassLoader createClassLoader(String name, ClassLoader parent)        throws Exception {        String value = CatalinaProperties.getProperty(name + &quot;.loader&quot;);        if ((value == null) || (value.equals(&quot;&quot;)))            return parent;        value = replace(value);        List&lt;Repository&gt; repositories = new ArrayList&lt;&gt;();        String[] repositoryPaths = getPaths(value);        for (String repository : repositoryPaths) {            // Check for a JAR URL repository            try {                @SuppressWarnings(&quot;unused&quot;)                URL url = new URL(repository);                repositories.add(new Repository(repository, RepositoryType.URL));                continue;            } catch (MalformedURLException e) {                // Ignore            }            // Local repository            if (repository.endsWith(&quot;*.jar&quot;)) {                repository = repository.substring                    (0, repository.length() - &quot;*.jar&quot;.length());                repositories.add(                        new Repository(repository, RepositoryType.GLOB));            } else if (repository.endsWith(&quot;.jar&quot;)) {                repositories.add(                        new Repository(repository, RepositoryType.JAR));            } else {                repositories.add(                        new Repository(repository, RepositoryType.DIR));            }        }        return ClassLoaderFactory.createClassLoader(repositories, parent);    }    /**     * Initialize daemon.     * @throws Exception Fatal initialization error     */    public void init() throws Exception {        initClassLoaders();        Thread.currentThread().setContextClassLoader(catalinaLoader);        SecurityClassLoad.securityClassLoad(catalinaLoader);        // Load our startup class and call its process() method        if (log.isDebugEnabled())            log.debug(&quot;Loading startup class&quot;);        Class&lt;?&gt; startupClass =            catalinaLoader.loadClass            (&quot;org.apache.catalina.startup.Catalina&quot;);        Object startupInstance = startupClass.newInstance();        // Set the shared extensions class loader        if (log.isDebugEnabled())            log.debug(&quot;Setting startup class properties&quot;);        String methodName = &quot;setParentClassLoader&quot;;        Class&lt;?&gt; paramTypes[] = new Class[1];        paramTypes[0] = Class.forName(&quot;java.lang.ClassLoader&quot;);        Object paramValues[] = new Object[1];        paramValues[0] = sharedLoader;        Method method =            startupInstance.getClass().getMethod(methodName, paramTypes);        method.invoke(startupInstance, paramValues);        catalinaDaemon = startupInstance;    }    /**     * Load daemon.     */    private void load(String[] arguments)        throws Exception {        // Call the load() method        String methodName = &quot;load&quot;;        Object param[];        Class&lt;?&gt; paramTypes[];        if (arguments==null || arguments.length==0) {            paramTypes = null;            param = null;        } else {            paramTypes = new Class[1];            paramTypes[0] = arguments.getClass();            param = new Object[1];            param[0] = arguments;        }        Method method =            catalinaDaemon.getClass().getMethod(methodName, paramTypes);        if (log.isDebugEnabled())            log.debug(&quot;Calling startup class &quot; + method);        method.invoke(catalinaDaemon, param);    }    // ----------------------------------------------------------- Main Program    /**     * Load the Catalina daemon.     * @param arguments Initialization arguments     * @throws Exception Fatal initialization error     */    public void init(String[] arguments)        throws Exception {        init();        load(arguments);    }    /**     * Start the Catalina daemon.     * @throws Exception Fatal start error     */    public void start()        throws Exception {        if( catalinaDaemon==null ) init();        Method method = catalinaDaemon.getClass().getMethod(&quot;start&quot;, (Class [] )null);        method.invoke(catalinaDaemon, (Object [])null);    }    /**     * Stop the Catalina Daemon.     * @throws Exception Fatal stop error     */    public void stop()        throws Exception {        //å®ç°ç•¥,ä¸»è¦é€šè¿‡åå°„è°ƒç”¨äº†catalinaçš„stop    }    /**     * Stop the standalone server.     * @throws Exception Fatal stop error     */    public void stopServer()        throws Exception {        //å®ç°ç•¥,ä¸»è¦é€šè¿‡åå°„è°ƒç”¨äº†catalinaçš„stopServer    }    /**     * Set flag.     * @param await &lt;code&gt;true&lt;/code&gt; if the daemon should block     * @throws Exception Reflection error     */    public void setAwait(boolean await)        throws Exception {        //å®ç°ç•¥ ,ä¸»è¦é€šè¿‡åå°„è°ƒç”¨äº†catalinaçš„setAwait    }    public boolean getAwait()        throws Exception{        //å®ç°ç•¥ ,ä¸»è¦é€šè¿‡åå°„è°ƒç”¨äº†catalinaçš„getAwait    }    /**     * Destroy the Catalina Daemon.     */    public void destroy() {        // FIXME    }    /**     * Main method and entry point when starting Tomcat via the provided     * scripts.     *     * @param args Command line arguments to be processed     */    public static void main(String args[]) {        if (daemon == null) {            // Don&#39;t set daemon until init() has completed            Bootstrap bootstrap = new Bootstrap();            try {                bootstrap.init();            } catch (Throwable t) {                handleThrowable(t);                t.printStackTrace();                return;            }            daemon = bootstrap;        } else {            // When running as a service the call to stop will be on a new            // thread so make sure the correct class loader is used to prevent            // a range of class not found exceptions.            Thread.currentThread().setContextClassLoader(daemon.catalinaLoader);        }        try {            String command = &quot;start&quot;;            if (args.length &gt; 0) {                command = args[args.length - 1];            }            if (command.equals(&quot;startd&quot;)) {                args[args.length - 1] = &quot;start&quot;;                daemon.load(args);                daemon.start();            } else if (command.equals(&quot;stopd&quot;)) {                args[args.length - 1] = &quot;stop&quot;;                daemon.stop();            } else if (command.equals(&quot;start&quot;)) {                daemon.setAwait(true);                daemon.load(args);                daemon.start();            } else if (command.equals(&quot;stop&quot;)) {                daemon.stopServer(args);            } else if (command.equals(&quot;configtest&quot;)) {                daemon.load(args);                if (null==daemon.getServer()) {                    System.exit(1);                }                System.exit(0);            } else {                log.warn(&quot;Bootstrap: command \&quot;&quot; + command + &quot;\&quot; does not exist.&quot;);            }        } catch (Throwable t) {            // Unwrap the Exception for clearer error reporting            if (t instanceof InvocationTargetException &amp;&amp;                    t.getCause() != null) {                t = t.getCause();            }            handleThrowable(t);            t.printStackTrace();            System.exit(1);        }    }}</code></pre><pre><code>Tomcat å¯åŠ¨è„šæœ¬ startup.bat æ˜¯ä»mainæ–¹æ³•ä¸­å¼€å§‹çš„ã€‚å…¶ä¸­ä¸»è¦åšäº†:</code></pre><ul><li><p>å‡†å¤‡å®¹å™¨ç¯å¢ƒï¼Œ<code>init()</code>åˆå§‹åŒ–ç±»åŠ è½½å™¨, </p></li><li><p>åˆå§‹åŒ–å®¹å™¨ï¼Œè°ƒç”¨<code>load()</code> å®é™…æ˜¯è°ƒç”¨catalinaé‡Œçš„<code>init()</code></p></li><li><p>å¯åŠ¨å®¹å™¨ï¼Œé€šè¿‡å¼•ç”¨<code>catalinaDaemon</code> åå°„å°„è°ƒç”¨<code>start()</code>æ–¹æ³•ï¼ˆå®é™…è¿˜æ˜¯é€šè¿‡catalinaæ“ä½œå®¹å™¨ï¼‰</p><pre><code> å…³äºç±»åŠ è½½ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ J2EE é»˜è®¤çš„ç±»åŠ è½½æœºåˆ¶æ˜¯åŒäº²å§”æ´¾åŸåˆ™ï¼ˆè¯¦ç»†æŸ¥çœ‹å¦‚ä¸‹ğŸ”https://www.cnblogs.com/miduos/p/9250565.htmlï¼‰</code></pre><p>  é€šè¿‡debugå¯ä»¥å‘ç°  commonLoaderã€catalinaLoader ã€sharedLoader å…¶å®ä¸‰ä¸ªæ˜¯åŒä¸€ä¸ªï¼ˆåº•å±‚éƒ½æ˜¯URLClassLoaderï¼‰ï¼ŒåŸå› æ˜¯å› ä¸º<code>catalina.properties</code> çš„é…ç½®ä¸­é»˜è®¤æ˜¯ç©ºçš„ã€‚</p><p>  å¦å¤–åœ¨<code>init()</code> ä¸­ <code>Thread.currentThread().setContextClassLoader(catalinaLoader);</code> </p></li></ul><h3 id="Catalinaçš„å¯åŠ¨è¿‡ç¨‹"><a href="#Catalinaçš„å¯åŠ¨è¿‡ç¨‹" class="headerlink" title="Catalinaçš„å¯åŠ¨è¿‡ç¨‹"></a>Catalinaçš„å¯åŠ¨è¿‡ç¨‹</h3><p>Catalinaçš„å¯åŠ¨ä¸»è¦æ˜¯è°ƒç”¨<code>setAwait()</code>ã€<code>load()</code>å’Œ<code>start()</code>æ–¹æ³•æ¥å®Œæˆã€‚</p><ul><li><code>setAwait()</code> æ–¹æ³•ç”¨äºè®¾ç½®Serverå¯åŠ¨å®Œæˆåæ˜¯å¦è¿›å…¥ç­‰å¾…çŠ¶æ€çš„æ ‡è®°</li><li><code>load()</code>æ–¹æ³•ä¸»è¦æ˜¯ç”¨æ¥åŠ è½½é…ç½®æ–‡ä»¶<code>conf/server.xml</code>åˆ›å»ºServerå¯¹è±¡ ï¼ˆè§£ææ˜¯é€šè¿‡Digesterï¼‰ï¼Œç„¶åè°ƒç”¨Serverçš„<code>init()</code></li><li><code>start()</code> ä¸»è¦æ˜¯è°ƒç”¨Serverçš„ <code>start()</code></li></ul><h3 id="Serverçš„å¯åŠ¨è¿‡ç¨‹"><a href="#Serverçš„å¯åŠ¨è¿‡ç¨‹" class="headerlink" title="Serverçš„å¯åŠ¨è¿‡ç¨‹"></a>Serverçš„å¯åŠ¨è¿‡ç¨‹</h3><p>Serverçš„é»˜è®¤å®ç°<code>org.apache.catalina.core.StandardServer</code> ,åœ¨å…¶çˆ¶ç±»ä¸­<code>org.apache.catalina.util.LifecycleBase</code> ä¸­çš„<code>init()</code> å®ç°å¦‚ä¸‹</p><pre><code class="java">@Overridepublic final synchronized void init() throws LifecycleException {    if (!state.equals(LifecycleState.NEW)) {        invalidTransition(Lifecycle.BEFORE_INIT_EVENT);    }    try {        setStateInternal(LifecycleState.INITIALIZING, null, false);        initInternal();        setStateInternal(LifecycleState.INITIALIZED, null, false);    } catch (Throwable t) {        ExceptionUtils.handleThrowable(t);        setStateInternal(LifecycleState.FAILED, null, false);        throw new LifecycleException(                sm.getString(&quot;lifecycleBase.initFail&quot;,toString()), t);    }}</code></pre><p> <code>start()</code> å®ç°å¦‚ä¸‹</p><pre><code class="java">/** * {@inheritDoc} */@Overridepublic final synchronized void start() throws LifecycleException {    if (LifecycleState.STARTING_PREP.equals(state) || LifecycleState.STARTING.equals(state) ||LifecycleState.STARTED.equals(state)) {        if (log.isDebugEnabled()) {            Exception e = new LifecycleException();            log.debug(sm.getString(&quot;lifecycleBase.alreadyStarted&quot;, toString()), e);        } else if (log.isInfoEnabled()) {            log.info(sm.getString(&quot;lifecycleBase.alreadyStarted&quot;, toString()));        }        return;    }    if (state.equals(LifecycleState.NEW)) {        init();    } else if (state.equals(LifecycleState.FAILED)) {        stop();    } else if (!state.equals(LifecycleState.INITIALIZED) &amp;&amp;            !state.equals(LifecycleState.STOPPED)) {        invalidTransition(Lifecycle.BEFORE_START_EVENT);    }    try {        setStateInternal(LifecycleState.STARTING_PREP, null, false);        startInternal();        if (state.equals(LifecycleState.FAILED)) {            // This is a &#39;controlled&#39; failure. The component put itself into the            // FAILED state so call stop() to complete the clean-up.            stop();        } else if (!state.equals(LifecycleState.STARTING)) {            // Shouldn&#39;t be necessary but acts as a check that sub-classes are            // doing what they are supposed to.            invalidTransition(Lifecycle.AFTER_START_EVENT);        } else {            setStateInternal(LifecycleState.STARTED, null, false);        }    } catch (Throwable t) {        // This is an &#39;uncontrolled&#39; failure so put the component into the        // FAILED state and throw an exception.        ExceptionUtils.handleThrowable(t);        setStateInternal(LifecycleState.FAILED, null, false);        throw new LifecycleException(sm.getString(&quot;lifecycleBase.startFail&quot;, toString()), t);    }}</code></pre><p>å…¶ä¸­ <code>startInternal() å’Œ initInternal()</code> ä¸ºæ¨¡ç‰ˆæ–¹æ³• ï¼ŒæŸ¥çœ‹å…¶å®ç°ç±» å¯ä»¥å‘ç°æ˜¯å¾ªç¯è°ƒç”¨äº†æ¯ä¸ª<code>service</code>çš„<code>start()</code>å’Œ<code>init()</code></p><h3 id="Serviceçš„å¯åŠ¨è¿‡ç¨‹"><a href="#Serviceçš„å¯åŠ¨è¿‡ç¨‹" class="headerlink" title="Serviceçš„å¯åŠ¨è¿‡ç¨‹"></a>Serviceçš„å¯åŠ¨è¿‡ç¨‹</h3><p>ç±»ä¼¼äºServer , <code>StandardService</code>çš„<code>initInternal()</code>å’Œ <code>startInternal()</code>çš„æ–¹æ³•ä¸»è¦è°ƒç”¨<code>container</code>ã€<code>executors</code>ã€<code>mapperListener</code>ã€<code>connectors</code>çš„<code>init()</code>å’Œ<code>start()</code>æ–¹æ³•ã€‚</p><blockquote><p>mapperListeneræ˜¯Mapperçš„ç›‘å¬å™¨ï¼Œå¯ä»¥ç›‘å¬containerå®¹å™¨çš„å˜åŒ–</p><p>executorsæ˜¯ç”¨åœ¨connectorsä¸­ç®¡ç†çº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œåœ¨server.xmlé…ç½®æ–‡ä»¶ä¸­tomcatThreadPool</p></blockquote><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ä¸‹å›¾ä¸ºæ•´ä¸ªå¯åŠ¨æµç¨‹</p><p><img src="https://ws4.sinaimg.cn/large/006tNbRwgy1fyasgs52ycj30wk0k6jxv.jpg" alt="image-20181218123224591"></p><h2 id="è¯·æ±‚å¤„ç†"><a href="#è¯·æ±‚å¤„ç†" class="headerlink" title="è¯·æ±‚å¤„ç†"></a>è¯·æ±‚å¤„ç†</h2><p>â€‹        Connectorç”¨äºæ¥æ”¶è¯·æ±‚å¹¶å°†è¯·æ±‚å°è£…æˆ<code>Request</code>å’Œ<code>Response</code>æ¥å¤„ç†ï¼Œæœ€åº•å±‚æ˜¯ä½¿ç”¨Socketæ¥è¿›è¡Œè¿æ¥çš„ï¼Œå°è£…å®Œåäº¤ç»™Containerè¿›è¡Œå¤„ç†ï¼ˆé€šè¿‡pipeline-Valueç®¡é“æ¥å¤„ç†ï¼‰ï¼ŒContainerå¤„ç†å®Œä¹‹åè¿”å›ç»™Connectorï¼Œæœ€åConnectorä½¿ç”¨Socketå°†å¤„ç†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œæ•´ä¸ªè¯·æ±‚å°±å¤„ç†å®Œäº†ã€‚</p><h3 id="Connectorçš„ç»“æ„"><a href="#Connectorçš„ç»“æ„" class="headerlink" title="Connectorçš„ç»“æ„"></a>Connectorçš„ç»“æ„</h3><p>â€‹    <code>Connector</code>ä¸­å…·ä½“æ˜¯ç”¨<code>ProtocolHandler</code>æ¥å¤„ç†è¯·æ±‚çš„ï¼Œæœ‰å¤šç§ä¸åŒçš„è¿æ¥ç±»å‹ï¼ˆAjpã€HTTPå’ŒSpdyï¼‰ã€‚</p><p>å…¶ä¸­æœ‰3ä¸ªéå¸¸é‡è¦çš„ç»„ä»¶ã€‚ï¼ˆ<code>Connector</code>çš„åˆ›å»ºè¿‡ç¨‹ä¸»è¦æ˜¯åˆå§‹åŒ–<code>ProtocolHandler</code>,serverx.xmlä¸­å¯é…ç½®ï¼‰</p><ul><li>Endpoint  ç”¨äºå¤„ç†åº•å±‚çš„Socketçš„ç½‘ç»œè¿æ¥ï¼Œç”¨æ¥å®ç°TCP/IPåè®®</li><li>Processor  ç”¨äºå°†Endpointæ¥æ”¶åˆ°çš„Socketå°è£…æˆRequestï¼Œç”¨æ¥å®ç°HTTPåè®®(BIOã€NIOã€APR)</li><li>Adapter ç”¨äºå°†å°è£…å¥½çš„Requestäº¤ç»™Containerè¿›è¡Œå…·ä½“å¤„ç†ï¼Œå°†é€‚é…åˆ°Servletå®¹å™¨ï¼ˆè½¬æ¢<code>org.apache.coyote.Request</code>ä¸º<code>org.apache.catalina.connector.Request</code> ï¼‰</li></ul><blockquote><p>Ajp ï¼šè¿æ¥å™¨ç›‘å¬8009ç«¯å£ï¼Œè´Ÿè´£å’Œå…¶ä»–çš„HTTPæœåŠ¡å™¨å»ºç«‹è¿æ¥ã€‚åœ¨æŠŠTomcatä¸å…¶ä»–HTTPæœåŠ¡å™¨é›†æˆæ—¶ï¼Œå°±éœ€è¦ç”¨åˆ°è¿™ä¸ªè¿æ¥å™¨ã€‚</p><p>Apr : æ˜¯ä»æ“ä½œç³»ç»Ÿçº§åˆ«è§£å†³å¼‚æ­¥IOé—®é¢˜ï¼Œå¤§å¹…åº¦æé«˜æœåŠ¡å™¨çš„å¹¶å‘å¤„ç†æ€§èƒ½ <a href="http://tomcat.apache.org/tomcat-8.5-doc/apr.html" target="_blank" rel="noopener">http://tomcat.apache.org/tomcat-8.5-doc/apr.html</a></p><p>åè®®å‡çº§ï¼šåœ¨servlet 3.1ä¹‹åæ–°å¢ WebSocketåè®®ï¼Œå¦‚æœProcessorå¤„ç†ä¹‹åSocketçš„çŠ¶æ€æ˜¯UPGRADING,åˆ™EndPointä¸­çš„handlerå›æ¥ç€åˆ›å»ºå¹¶è°ƒç”¨upgradeåŒ…ä¸­çš„processorè¿›è¡Œå¤„ç†</p><p>requestè½¬æ¢ï¼šAdapterè½¬æ¢åçš„requestï¼Œå…¶å®å°±æ˜¯å°è£…äº†ä¸€å±‚ï¼Œ  <code>public class Request implements org.apache.catalina.servlet4preview.http.HttpServletRequest</code></p></blockquote><h3 id="Pipeline-Valueç®¡é“"><a href="#Pipeline-Valueç®¡é“" class="headerlink" title="Pipeline-Valueç®¡é“"></a>Pipeline-Valueç®¡é“</h3><p>â€‹    Piepelineçš„ç®¡é“æ¨¡å‹å’Œæ™®é€šçš„è´£ä»»é“¾æ¨¡å¼ç¨å¾®æœ‰ç‚¹ä¸åŒï¼ŒåŒºåˆ«ä¸»è¦å¦‚ä¸‹</p><ul><li>æ¯ä¸ªpipelineéƒ½æœ‰ç‰¹å®šçš„valueï¼Œè€Œä¸”æ˜¯åœ¨ç®¡é“çš„æœ€åä¸€ä¸ªæ‰§è¡Œï¼Œè¿™ä¸ªValueå«åšBaseValue</li><li>ä¸Šå±‚çš„BaseValueï¼ˆç±»ä¼¼é…è´§è½¦åˆ°ä¸­è½¬ç«™çš„æ„Ÿè§‰ï¼‰ä¼šè°ƒç”¨ä¸‹å±‚å®¹å™¨çš„ç®¡é“</li></ul><blockquote><p>æ¯ä¸ªBaseValueéƒ½æœ‰ä¸€ä¸ªStandarValueçš„å®ç°ï¼Œä¾‹å¦‚WrapperValueçš„æ ‡å‡†å®ç°æ˜¯StanderWrpperValue</p></blockquote><p>â€‹    ç»è¿‡æ‰€æœ‰ç®¡é“ï¼ˆEnginePipelineã€HostPipelineã€ContextPipelineã€WrapperPielineï¼‰åï¼Œåœ¨æœ€åçš„WrapperPielineçš„BaseValueä¸­ä¼šåˆ›å»º<code>FilterChain</code>å¹¶è°ƒç”¨å…¶doFilteræ¥å¤„ç†è¯·æ±‚ï¼ŒFilterChainåŒ…å«ç€æˆ‘ä»¬é…ç½®çš„ä¸è¯·æ±‚ç›¸åŒ¹é…çš„<code>Filter</code>å’Œ<code>Servlet</code>ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> tomcat </tag>
            
            <tag> servlet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Overview_java</title>
      <link href="/2019/02/02/Overview_java/"/>
      <url>/2019/02/02/Overview_java/</url>
      
        <content type="html"><![CDATA[<p>â€‹    å¯¹javaçŸ¥è¯†ä½“ç³»çš„æ•´ç†ï¼ŒæŠŠçŸ¥è¯†ä»ç‚¹åˆ°çº¿ é¢çš„ ,å­¦ä¹ åœ°å›¾</p><a id="more"></a><p>çŸ¥è¯†ä½“ç³»æ€»ç»“</p><!-- toc --><h2 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h2><h3 id="è‹±è¯­"><a href="#è‹±è¯­" class="headerlink" title="è‹±è¯­"></a>è‹±è¯­</h3><p>â€‹    äº†è§£ä¸€æ‰‹èµ„æ–™ï¼Œå®˜æ–¹æ–‡æ¡£ï¼Œgithubèµ„æ–™ </p><p>â€‹    ä¹¦ç±ğŸ“šã€Šç¨‹åºå‘˜è‹±è¯­ã€‹ </p><h3 id="linux-è®¡ç®—æœºåŸºç¡€ã€åŸç†"><a href="#linux-è®¡ç®—æœºåŸºç¡€ã€åŸç†" class="headerlink" title="linux / è®¡ç®—æœºåŸºç¡€ã€åŸç†"></a>linux / è®¡ç®—æœºåŸºç¡€ã€åŸç†</h3><p>â€‹    linuxå¸¸ç”¨å‘½ä»¤ï¼Œé—®é¢˜å®šä½éœ€è¦çŸ¥é“ </p><p>â€‹    è®¡ç®—æœºåŸç†è¿™é‡Œï¼ŒåŸºäºå†¯è¯ºä¼Šæ›¼æ¨¡å‹å»ºé€ çš„è®¡ç®—æœºåˆ†ä¸º4ä¸ªå­ç³»ç»Ÿï¼šå­˜å‚¨å™¨ã€ç®—æœ¯é€»è¾‘å•å…ƒã€æ§åˆ¶å•å…ƒã€å’Œè¾“å…¥/è¾“å‡ºå•å…ƒ</p><p>â€‹    ä¹¦ç±ğŸ“šã€Šlinuxé¸Ÿå“¥ç§æˆ¿èœã€‹ã€ã€Šè®¡ç®—æœºåŸç†ã€‹ã€ã€Šæ·±å…¥ç†è§£è®¡ç®—æœºåŸç†ã€‹ã€ã€Šç¨‹åºæ˜¯æ€ä¹ˆè·‘èµ·æ¥çš„ã€‹ã€ŠLinuxå†…æ ¸ã€‹</p><h3 id="ç½‘ç»œç¼–ç¨‹-tcp-ipåè®®-http"><a href="#ç½‘ç»œç¼–ç¨‹-tcp-ipåè®®-http" class="headerlink" title="ç½‘ç»œç¼–ç¨‹ tcp/ipåè®®  http"></a>ç½‘ç»œç¼–ç¨‹ tcp/ipåè®®  http</h3><p>â€‹    TPC/IPåè®®æ˜¯ä¼ è¾“å±‚åè®®ï¼Œä¸»è¦è§£å†³æ•°æ®å¦‚ä½•åœ¨ç½‘ç»œä¸­ä¼ è¾“ï¼Œè€ŒHTTPæ˜¯åº”ç”¨å±‚åè®®ï¼Œä¸»è¦è§£å†³å¦‚ä½•åŒ…è£…æ•°æ®ï¼ŒIPæƒ³åƒæˆä¸€ç§é«˜é€Ÿå…¬è·¯ï¼ŒTCPå’ŒUDPæ˜¯é«˜é€Ÿå…¬è·¯ä¸Šçš„â€œå¡è½¦â€ï¼Œå®ƒä»¬æºå¸¦çš„è´§ç‰©å°±æ˜¯åƒHTTPï¼ŒHTTPåè®®å³è¶…æ–‡æœ¬ä¼ é€åè®®(Hypertext Transfer Protocol )</p><p>â€‹    ä¹¦ç±ğŸ“šã€Šhttpæƒå¨æŒ‡å—ã€‹ã€ã€Štcp/ipè¯¦è§£ã€‹ã€ã€Šå›¾è§£httpã€‹ã€ã€Šç½‘ç»œæ˜¯æ€ä¹ˆé“¾æ¥çš„ã€‹</p><h3 id="æ•°æ®ç»“æ„å’Œç®—æ³•"><a href="#æ•°æ®ç»“æ„å’Œç®—æ³•" class="headerlink" title="æ•°æ®ç»“æ„å’Œç®—æ³•"></a>æ•°æ®ç»“æ„å’Œç®—æ³•</h3><p>â€‹    æ•°æ®ç»“æ„å’Œç®—æ³•ï¼Œå¸¸è§çš„æ’åºç±»å‹ï¼ŒçŸ¥é“æ—¶é—´å¤æ‚åº¦ï¼Œç©ºé—´å¤æ‚åº¦ç­‰æ¦‚å¿µï¼Œ==å®ç°æ–¹é¢å¯ä»¥çœ‹jdkçš„é›†åˆç±»==</p><p>â€‹    ä¹¦ç±ğŸ“š ã€Šç®—æ³•ã€‹</p><h3 id="æ•°æ®åº“MySQL"><a href="#æ•°æ®åº“MySQL" class="headerlink" title="æ•°æ®åº“MySQL"></a>æ•°æ®åº“MySQL</h3><p>â€‹    å…³ç³»å‹æ•°æ®åº“ï¼Œäº‹åŠ¡éš”ç¦»çº§åˆ«ã€å¯¹åº”è§£å†³çš„é—®é¢˜ï¼Œæ‡‚çš„ç´¢å¼•ï¼ˆb+ tree ä»¥åŠç›¸å…³ä¼˜åŒ–ï¼‰ã€é”ï¼ˆMVCCå®ç°ç›¸å…³ã€ é—´éš™é”ï¼‰ï¼Œè°ƒä¼˜ï¼Œå®šä½é—®é¢˜</p><p>â€‹    ä¹¦ç±ğŸ“š ã€Šé«˜æ€§èƒ½MySQLã€‹</p><pre><code>mysqlåˆ†æã€‚â€”-ã€‹https://mp.weixin.qq.com/s/213sPk-0RtWwwX6YotN6eQåŸå› 1.ç¡¬ä»¶é—®é¢˜ã€‚å¦‚ç½‘ç»œé€Ÿåº¦æ…¢ï¼Œå†…å­˜ä¸è¶³ï¼ŒI/Oååé‡å°ï¼Œç£ç›˜ç©ºé—´æ»¡äº†ç­‰ã€‚2.æ²¡æœ‰ç´¢å¼•æˆ–è€…ç´¢å¼•å¤±æ•ˆã€‚ï¼ˆä¸€èˆ¬åœ¨äº’è”ç½‘å…¬å¸ï¼ŒDBAä¼šåœ¨åŠå¤œæŠŠè¡¨é”äº†ï¼Œé‡æ–°å»ºç«‹ä¸€éç´¢å¼•ï¼Œå› ä¸ºå½“ä½ åˆ é™¤æŸä¸ªæ•°æ®çš„æ—¶å€™ï¼Œç´¢å¼•çš„æ ‘ç»“æ„å°±ä¸å®Œæ•´äº†ã€‚æ‰€ä»¥äº’è”ç½‘å…¬å¸çš„æ•°æ®åšçš„æ˜¯å‡åˆ é™¤.ä¸€æ˜¯ä¸ºäº†åšæ•°æ®åˆ†æ,äºŒæ˜¯ä¸ºäº†ä¸ç ´åç´¢å¼• ï¼‰3.æ•°æ®è¿‡å¤šï¼ˆåˆ†åº“åˆ†è¡¨ï¼‰4.æœåŠ¡å™¨è°ƒä¼˜åŠå„ä¸ªå‚æ•°è®¾ç½®ï¼ˆè°ƒæ•´my.cnfåˆ‡å…¥ç‚¹1.å…ˆè§‚å¯Ÿï¼Œå¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œè®¾ç½®ç›¸åº”çš„é˜ˆå€¼ï¼ˆæ¯”å¦‚è¶…è¿‡3ç§’å°±æ˜¯æ…¢SQLï¼‰ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒè·‘ä¸Šä¸ªä¸€å¤©è¿‡åï¼Œçœ‹çœ‹å“ªäº›SQLæ¯”è¾ƒæ…¢ã€‚2.Explainå’Œæ…¢SQLåˆ†æã€‚æ¯”å¦‚SQLè¯­å¥å†™çš„çƒ‚ï¼Œç´¢å¼•æ²¡æœ‰æˆ–å¤±æ•ˆï¼Œå…³è”æŸ¥è¯¢å¤ªå¤šï¼ˆæœ‰æ—¶å€™æ˜¯è®¾è®¡ç¼ºé™·æˆ–è€…ä¸å¾—ä»¥çš„éœ€æ±‚ï¼‰ç­‰ç­‰ã€‚3.Show Profileæ˜¯æ¯”Explainæ›´è¿‘ä¸€æ­¥çš„æ‰§è¡Œç»†èŠ‚ï¼Œå¯ä»¥æŸ¥è¯¢åˆ°æ‰§è¡Œæ¯ä¸€ä¸ªSQLéƒ½å¹²äº†ä»€ä¹ˆäº‹ï¼Œè¿™äº›äº‹åˆ†åˆ«èŠ±äº†å¤šå°‘ç§’ã€‚4.æ‰¾DBAæˆ–è€…è¿ç»´å¯¹MySQLè¿›è¡ŒæœåŠ¡å™¨çš„å‚æ•°è°ƒä¼˜ã€‚</code></pre><h2 id="Java-SEï¼ˆJava-Standard-Editionï¼‰"><a href="#Java-SEï¼ˆJava-Standard-Editionï¼‰" class="headerlink" title="Java SEï¼ˆJava Standard Editionï¼‰"></a>Java SEï¼ˆJava Standard Editionï¼‰</h2><h3 id="Javaè¯­è¨€-è¯­æ³•åŸºç¡€"><a href="#Javaè¯­è¨€-è¯­æ³•åŸºç¡€" class="headerlink" title="Javaè¯­è¨€/è¯­æ³•åŸºç¡€"></a>Javaè¯­è¨€/è¯­æ³•åŸºç¡€</h3><p>â€‹    å¯¹è±¡ï¼šå°è£…æ€§ã€æ´¾ç”Ÿæ€§ã€å¤šæ€æ€§</p><p>â€‹    åˆ‡é¢ï¼š JavaåŠ¨æ€ä»£ç† å­—èŠ‚ç æå‡</p><p>â€‹    å…ƒç¼–ç¨‹ ï¼šæ³›å‹ã€ åå°„ã€ æ³¨è§£</p><p>â€‹    å‡½æ•°ç¼–ç¨‹ï¼šå‡½æ•°å¼ç¼–ç¨‹ã€Stream APIè®¾è®¡</p><p>â€‹    ä¹¦ç±ğŸ“š ã€ŠThinking in javaã€‹ ã€Šcore Javaã€‹ ã€ŠSCJPè€ƒè¯•æŒ‡å—ã€‹ã€Šjava8å‡½æ•°å¼ç¼–ç¨‹ã€‹</p><p>â€‹    æ–‡æ¡£ å®˜æ–¹æŒ‡å¯¼æ–‡æ¡£ï¼š<a href="https://docs.oracle.com/javase/tutorial/index.html" target="_blank" rel="noopener">https://docs.oracle.com/javase/tutorial/index.html</a></p><h3 id="é›†åˆæ¡†æ¶"><a href="#é›†åˆæ¡†æ¶" class="headerlink" title="é›†åˆæ¡†æ¶"></a>é›†åˆæ¡†æ¶</h3><p>â€‹    Java Collections Framework Java Collectionsä¸»è¦åŒ…æ‹¬ä»¥ä¸‹ä¸‰éƒ¨åˆ†ï¼šæ¥å£ï¼ˆInterfaceï¼‰ã€å®ç°ï¼ˆImplementionï¼‰å’Œç®—æ³•ï¼ˆAlgorithmï¼‰</p><h3 id="Java-IO-ç½‘ç»œ"><a href="#Java-IO-ç½‘ç»œ" class="headerlink" title="Java IO/ç½‘ç»œ"></a>Java IO/ç½‘ç»œ</h3><p>â€‹     æ–‡ä»¶æµã€ javaç½‘ç»œç¼–ç¨‹  ã€é˜»å¡IOã€éé˜»å¡IO</p><p>â€‹    ä¹¦ç±ğŸ“šã€ŠNIOä¸Socketã€‹ã€ã€ŠNettyæƒå¨æŒ‡å—ã€‹ã€ã€ŠNettyå®æˆ˜ã€‹</p><p>â€‹    å¯ä»¥æ²¿ç€è¿™ä¸ªè·¯çº¿æ·±å…¥å­¦ä¹ ï¼Œsocket -&gt; Netty  -&gt; dubbo </p><p>â€‹    Socketæ˜¯åº”ç”¨å±‚ä¸TCP/IPåè®®æ—é€šä¿¡çš„ä¸­é—´è½¯ä»¶æŠ½è±¡å±‚ï¼Œå®ƒæ˜¯ä¸€ç»„æ¥å£ã€‚åœ¨è®¾è®¡æ¨¡å¼ä¸­ï¼ŒSocketå…¶å®å°±æ˜¯ä¸€ä¸ªé—¨é¢æ¨¡å¼ï¼Œå®ƒæŠŠå¤æ‚çš„TCP/IPåè®®æ—éšè—åœ¨Socketæ¥å£åé¢ï¼Œå¯¹ç”¨æˆ·æ¥è¯´ï¼Œä¸€ç»„ç®€å•çš„æ¥å£å°±æ˜¯å…¨éƒ¨ï¼Œè®©Socketå»ç»„ç»‡æ•°æ®ï¼Œä»¥ç¬¦åˆæŒ‡å®šçš„åè®®ã€‚Socket åªæ˜¯ä¸ªæ¥å£ä¸æ˜¯åè®®</p><p>â€‹    nettyèµ„æ–™ï¼š==å¾…æ•´ç†==</p><p><a href="https://mp.weixin.qq.com/s/nVqjSbocs4kFFz2pJqovhQ" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/nVqjSbocs4kFFz2pJqovhQ</a><br><a href="https://mp.weixin.qq.com/s/WBV4Tm-I5VNWXqjxMgw0yw" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/WBV4Tm-I5VNWXqjxMgw0yw</a><br><a href="https://www.jianshu.com/p/cde27461c226" target="_blank" rel="noopener">https://www.jianshu.com/p/cde27461c226</a><br><a href="https://mp.weixin.qq.com/s/zf_LY0MSD4S4p0wXKOyhZg" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/zf_LY0MSD4S4p0wXKOyhZg</a></p><h3 id="å¤šçº¿ç¨‹"><a href="#å¤šçº¿ç¨‹" class="headerlink" title="å¤šçº¿ç¨‹"></a>å¤šçº¿ç¨‹</h3><p>â€‹    ==J.U.C== ï¼Œå¤šçº¿ç¨‹çš„æ•´ä¸ªä½“ç³»åŸºäºvolatile ã€cas -&gt;aqsï¼Œé€šå¸¸éœ€è¦äº†è§£çš„ JMMå†…å­˜æ¨¡å‹ã€é”ã€çº¿ç¨‹æ± ã€å·¥å…·ç±» </p><p>â€‹    ä¹¦ç±ğŸ“šã€ŠJavaå¹¶å‘ç¼–ç¨‹è‰ºæœ¯ã€‹ ã€ã€Šå¹¶å‘ç¼–ç¨‹å®è·µã€‹ ç¿»è¯‘ä¸å¤ªå¥½ï¼Œå»ºè®®çœ‹è‹±æ–‡ç‰ˆã€ã€ŠConcurrent_Programming_in_Javaã€‹å¹¶å‘æ¡†æ¶çš„ä½œè€…DougLeaå†™çš„</p><h3 id="JVM"><a href="#JVM" class="headerlink" title="JVM"></a>JVM</h3><p>â€‹    è°ƒä¼˜ï¼Œé—®é¢˜å®šä½ï¼Œå¸¸ç”¨çš„å·¥å…·ï¼Œjstack ç­‰ï¼Œå­—èŠ‚ç ã€ç¼–è¯‘è¿‡ç¨‹ã€åƒåœ¾æ”¶é›†å™¨ã€å³æ—¶ç¼–è¯‘ç­‰ã€è™šæ‹Ÿæœºè§„èŒƒ</p><p>â€‹    ä¹¦ç±ğŸ“šã€Šæ·±å…¥ç†è§£ Java è™šæ‹Ÿæœºã€‹</p><h4 id="ç‰ˆæœ¬ç‰¹å¾-å¾…æ•´ç†"><a href="#ç‰ˆæœ¬ç‰¹å¾-å¾…æ•´ç†" class="headerlink" title="ç‰ˆæœ¬ç‰¹å¾ ==å¾…æ•´ç†=="></a>ç‰ˆæœ¬ç‰¹å¾ ==å¾…æ•´ç†==</h4><p>â€‹    JDKå‘å±•å²ï¼šä»å‡ ä¸ªè§’åº¦çœ‹ jvmç‰¹æ€§ã€å¹¶å‘å·¥å…·ã€è¯­è¨€ç‰¹æ€§ ï¼Œä¾‹å¦‚</p><pre><code class="html">JDK1.0ç‰ˆæœ¬ï¼šJAVA è™šæ‹Ÿæœºã€AWTJDK1.1ç‰ˆæœ¬:JARæ–‡ä»¶æ ¼å¼ã€JDBCã€JavaBeansã€RMIã€Javaè¯­æ³•ï¼šå†…éƒ¨ç±»ï¼ˆInner Classï¼‰å’Œåå°„ï¼ˆReflectionï¼‰JDK1.2ç‰ˆæœ¬:JavaæŠ€æœ¯ä½“ç³»æ‹†åˆ†ä¸º3ä¸ªæ–¹å‘ï¼ˆé¢å‘æ¡Œé¢åº”ç”¨å¼€å‘J2SE/é¢å‘ä¼ä¸šçº§å¼€å‘çš„J2EE/é¢å‘æ‰‹æœºç­‰ç§»åŠ¨ç«¯å¼€å‘çš„J2MEï¼‰      ä»£è¡¨æ€§æŠ€æœ¯ï¼šEJBã€Java plugin-inã€JavaIDLã€Swing      è™šæ‹Ÿæœºä¸­å†…ç½®äº†JIT(JUST IN TIME)ç¼–è¯‘å™¨ã€3ä¸ªè™šæ‹Ÿæœºå¹¶å­˜ï¼ˆClassic VM /HotSpot VM/Exact VMï¼‰      è¯­è¨€å’ŒAPIçº§åˆ«ä¸Šï¼šæ·»åŠ äº†strictfpå…³é”®å­—ä¸Collectionsé›†åˆç±»JDK1.3ç‰ˆæœ¬:ä¸€äº›ç±»åº“ï¼ˆæ•°å­¦è¿ç®—å’Œæ–°çš„Timer APIï¼‰/JNDIæœåŠ¡ä½œä¸ºå¹³å°çº§æœåŠ¡æä¾›ã€ä½¿ç”¨CORBA IIOPæ¥å®ç°RMIé€šä¿¡/æ·»åŠ äº†JavaSoundç±»åº“JDK1.4ç‰ˆæœ¬ï¼šæ­£åˆ™è¡¨è¾¾å¼ã€å¼‚å¸¸é“¾ã€NIOã€æ—¥å¿—ç±»ã€XMLè§£æå™¨ã€XSLTè½¬æ¢å™¨JDK1.5ç‰ˆæœ¬ï¼šè¯­æ³•ï¼šè‡ªåŠ¨è£…ç®±ã€æ³›å‹ã€åŠ¨æ€æ³¨è§£ã€æšä¸¾ã€å¯å˜é•¿å‚æ•°ã€éå†å¾ªç¯ï¼ˆforeachå¾ªç¯ï¼‰jmx å…ƒæ•°æ®(æ³¨è§£); å¼•å…¥Instrumentation(Agentï¼Œjvmçº§åˆ«çš„AOP)      è™šæ‹Ÿæœºå’ŒAPI:æ”¹è¿›äº†Javaçš„å†…å­˜æ¨¡å‹ã€æä¾›äº†Java.util.concurrentå¹¶å‘åŒ…JDK1.6ç‰ˆæœ¬ï¼šç»ˆç»“äº†J2ME/J2SE/J2EEçš„å‘½åæ–¹å¼ï¼Œå¯ç”¨Java SE6/Java EE6/Java ME6çš„å‘½åæ–¹å¼      æä¾›åŠ¨æ€è¯­è¨€æ”¯æŒï¼ˆé€šè¿‡å†…ç½®çš„Mozilla javaScript Rhionå¼•æ“å®ç°ï¼‰      æä¾›ç¼–è¯‘APIå’Œå¾®å‹HTTPæœåŠ¡å™¨APIï¼Œå¢å¼ºInstrumentationï¼Œè™šæ‹Ÿæœºå¯åŠ¨åçš„      è™šæ‹Ÿæœºæ”¹è¿›ï¼šé”ä¸åŒæ­¥ã€åƒåœ¾æ”¶é›†ã€ç±»åŠ è½½JDK1.7ç‰ˆæœ¬ï¼šnio2 try resource autocloseable JVMæ–°å¢äº†ä¸€å¥—å«åšinvokedynamicçš„æŒ‡ä»¤ä¸ºä¸ºæ”¯æŒåŠ¨æ€ç±»å‹åŒ–ç¨‹åºè¯­è¨€çš„å®ç°ï¼›å¹¶å‘APIæ–°å¢äº†è½»é‡çº§çš„åˆ†æ”¯/åˆå¹¶ï¼ˆFork/Joinï¼‰æ¡†æ¶      Javaå¼€æº      æä¾›æ–°çš„G1æ”¶é›†å™¨ï¼ˆG1åœ¨å‘å¸ƒæ—¶ä¾ç„¶å¤„äºExperimentalçŠ¶æ€ï¼‰      åŠ å¼ºå¯¹éJavaè¯­è¨€çš„è°ƒç”¨æ”¯æŒï¼ˆJSR-292åˆ°ç›®å‰æ²¡æœ‰å®Œå…¨å®ç°å®šå‹ï¼‰ã€å‡çº§ç±»åŠ è½½æ¶æ„JDK1.8ç‰ˆæœ¬ï¼šLambdaè¡¨è¾¾å¼ã€CoinJDK1.9ç‰ˆæœ¬ï¼šflow reative æ¨¡å—åŒ–JDK10ç‰ˆæœ¬ï¼švar åƒåœ¾æ”¶é›†æ”¹è¿›JDK11ç‰ˆæœ¬ï¼šhttpclient åƒåœ¾æ”¶é›†æ”¹è¿› Epsilon åƒåœ¾æ”¶é›†å™¨è¢«ç§°ä¸ºâ€œno-opâ€æ”¶é›†å™¨ï¼Œå°†å¤„ç†å†…å­˜åˆ†é…è€Œä¸å®æ–½ä»»ä½•å®é™…çš„å†…å­˜å›æ”¶æœºåˆ¶</code></pre><h4 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h4><h5 id="classLoder"><a href="#classLoder" class="headerlink" title="classLoder"></a>classLoder</h5><p>â€‹    åŒäº²å§”æ´¾ï¼Œä»¥åŠæ€ä¹ˆç ´ååŒäº²å§”æ´¾ï¼Œåœ¨springå’Œtomcatä¸­çš„ä½“ç°</p><p>â€‹    æ–‡æ¡£ï¼š<a href="https://zhuanlan.zhihu.com/p/51374915?utm_source=wechat_session&amp;utm_medium=social&amp;utm_oi=557574927448846336" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/51374915?utm_source=wechat_session&amp;utm_medium=social&amp;utm_oi=557574927448846336</a></p><h5 id="javaå®˜æ–¹è®¢é˜…"><a href="#javaå®˜æ–¹è®¢é˜…" class="headerlink" title="javaå®˜æ–¹è®¢é˜…"></a>javaå®˜æ–¹è®¢é˜…</h5><p>â€‹    è·å–äº†è§£æœ€æ–°å˜åŒ–æƒ…å†µ</p><p>â€‹    æ–‡æ¡£ï¼šmail.openjdk.java.net Mailing Lists</p><h2 id="Java-EEï¼ˆEnterprise-Editionï¼‰"><a href="#Java-EEï¼ˆEnterprise-Editionï¼‰" class="headerlink" title="Java EEï¼ˆEnterprise Editionï¼‰"></a>Java EEï¼ˆEnterprise Editionï¼‰</h2><p>â€‹    å¸¸ç”¨çš„æŠ€æœ¯æ ˆspring + springmvc + mybatis(æˆ–è€…å…¶ä»–çš„ormæ¡†æ¶) ï¼Œè¿™é‡Œå»ºè®®å­¦ä¹ j2eeçš„å¸¸ç”¨è§„èŒƒ</p><h3 id="Spring-Spring-boot"><a href="#Spring-Spring-boot" class="headerlink" title="Spring /Spring boot"></a>Spring /Spring boot</h3><p>â€‹    ==æ³¨æ„å…³æ³¨ç‰ˆæœ¬ç‰¹å¾==</p><p>â€‹    spring å®ç°äº†å¤§éƒ¨åˆ†çš„j2eeè§„èŒƒï¼Œæœ¬èº«ä¸»è¦æ˜¯DIï¼ˆç®¡ç†å¯¹è±¡ä¹‹é—´çš„å…³ç³»ï¼‰å’ŒAOPï¼ˆåˆ‡é¢ç¼–ç¨‹ï¼‰ ï¼Œæ·±åº¦å­¦ä¹ æºç å’Œç†è§£å®ƒçš„ä¼˜ç§€æ€æƒ³ï¼ˆç®€å•ï¼Œå¼€æ”¾ï¼‰ï¼Œspringmvc</p><p>â€‹    SpringBootçš„ç®€åŒ–é…ç½®ï¼Œéƒ¨ç½²ï¼Œè‡ªåŠ¨è£…é…ã€‚</p><p>â€‹    ä¹¦ç±ğŸ“šã€Šspringå®æˆ˜ã€‹ã€ã€ŠspringæŠ€æœ¯å†…å¹•ã€‹ã€ã€Šspringæºç å‰–æã€‹ã€ã€ŠExpert One-on-One J2EE Design and Developmentã€‹ã€ŠExpert One-on-One J2EE Development without EJBã€‹ springä½œè€…å†™çš„ä¹¦</p><p>â€‹    æ–‡æ¡£ï¼šspring åŠ¨æ€ä»£ç† <a href="https://mp.weixin.qq.com/s/vCZP8sPrtnXWvg6IlcHQOg" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/vCZP8sPrtnXWvg6IlcHQOg</a></p><p>â€‹            ç‰¹æ€§ <a href="https://mp.weixin.qq.com/s/09lMCJKvACOU_umkzu2StQ" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/09lMCJKvACOU_umkzu2StQ</a></p><h3 id="å…¶ä»–-1"><a href="#å…¶ä»–-1" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><h4 id="web-Frameworkæ¡†æ¶æ€§èƒ½"><a href="#web-Frameworkæ¡†æ¶æ€§èƒ½" class="headerlink" title="web Frameworkæ¡†æ¶æ€§èƒ½"></a>web Frameworkæ¡†æ¶æ€§èƒ½</h4><p>â€‹    å…³æ³¨å¸¸ç”¨æ¡†æ¶æ€§èƒ½</p><p>â€‹    æ–‡æ¡£ <a href="https://www.techempower.com/benchmarks/#section=data-r17" target="_blank" rel="noopener">https://www.techempower.com/benchmarks/#section=data-r17</a>    </p><h2 id="é‡è§†è§„èŒƒ"><a href="#é‡è§†è§„èŒƒ" class="headerlink" title="é‡è§†è§„èŒƒ"></a>é‡è§†è§„èŒƒ</h2><h3 id="JVMè§„èŒƒ"><a href="#JVMè§„èŒƒ" class="headerlink" title="JVMè§„èŒƒ"></a>JVMè§„èŒƒ</h3><p>â€‹    Javaè¯­è¨€è§„èŒƒã€Javaè™šæ‹Ÿæœºè§„èŒƒã€Javaå†…å­˜æ¨¡å‹è§„èŒƒ</p><p>â€‹    ä¹¦ç±ğŸ“š/æ–‡æ¡£ï¼šå®˜æ–¹æ–‡æ¡£ ==å¾…è¡¥å……==</p><h3 id="JSRè§„èŒƒ"><a href="#JSRè§„èŒƒ" class="headerlink" title="JSRè§„èŒƒ"></a>JSRè§„èŒƒ</h3><p>â€‹    Servletã€RESTã€JDBCã€JNDIã€JPAã€JTAã€Bean Validationã€JMSç­‰</p><p>â€‹    ä¹¦ç±ğŸ“š/æ–‡æ¡£ï¼šJSR <a href="https://jcp.org/en/jsr/platform" target="_blank" rel="noopener">https://jcp.org/en/jsr/platform</a></p><p>â€‹    Servlet :  servletè§„èŒƒ -&gt; springMVC -&gt; serveltå®¹å™¨ tomcat jetty</p><p>â€‹    JNDI: Java Naming and Directory Interfaceï¼ŒJNDIé¿å…äº†ç¨‹åºä¸æ•°æ®åº“ä¹‹é—´çš„ç´§è€¦åˆï¼Œä½¿åº”ç”¨æ›´åŠ æ˜“äºé…ç½®ã€æ˜“äºéƒ¨ç½²ã€‚ SPI  <a href="https://www.zhihu.com/question/49667892/answer/404097870" target="_blank" rel="noopener">https://www.zhihu.com/question/49667892/answer/404097870</a>    /   <a href="https://blog.hhui.top/hexblog/2017/05/26/SPI%E6%A1%86%E6%9E%B6%E5%AE%9E%E7%8E%B0%E4%B9%8B%E6%97%85%E4%B8%80%EF%BC%9A%E8%83%8C%E6%99%AF%E4%BB%8B%E7%BB%8D/#%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%EF%BC%9A-Z-blog" target="_blank" rel="noopener">https://blog.hhui.top/hexblog/2017/05/26/SPI%E6%A1%86%E6%9E%B6%E5%AE%9E%E7%8E%B0%E4%B9%8B%E6%97%85%E4%B8%80%EF%BC%9A%E8%83%8C%E6%99%AF%E4%BB%8B%E7%BB%8D/#%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%EF%BC%9A-Z-blog</a></p><p>â€‹    restfulé£æ ¼ â€”â€“ã€‹ã€‰ <a href="https://mp.weixin.qq.com/s/_CeSX_lSoyg9zPxs52twRA" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/_CeSX_lSoyg9zPxs52twRA</a></p><h3 id="IETFè§„èŒƒ"><a href="#IETFè§„èŒƒ" class="headerlink" title="IETFè§„èŒƒ"></a>IETFè§„èŒƒ</h3><p>â€‹    URL/URIã€HTTPã€RESTã€WebSocketsç­‰</p><p>â€‹    ä¹¦ç±ğŸ“š/æ–‡æ¡£ï¼šRFC 2616 æ–°æ ‡å‡†</p><h3 id="æ¶ˆæ¯è§„èŒƒ"><a href="#æ¶ˆæ¯è§„èŒƒ" class="headerlink" title="æ¶ˆæ¯è§„èŒƒ"></a>æ¶ˆæ¯è§„èŒƒ</h3><p>â€‹    AMQPã€MQTT</p><p>â€‹    ä¹¦ç±ğŸ“š/æ–‡æ¡£ï¼šå®˜æ–¹æ–‡æ¡£ ==å¾…è¡¥å……==</p><h3 id="å…³ç³»å‹æ•°æ®åº“è§„èŒƒ"><a href="#å…³ç³»å‹æ•°æ®åº“è§„èŒƒ" class="headerlink" title="å…³ç³»å‹æ•°æ®åº“è§„èŒƒ"></a>å…³ç³»å‹æ•°æ®åº“è§„èŒƒ</h3><p>â€‹    SQL99ã€SQL03ç­‰</p><p>â€‹    ä¹¦ç±ğŸ“š/æ–‡æ¡£ï¼šå®˜æ–¹æ–‡æ¡£ ==å¾…è¡¥å……==</p><h3 id="Reactive-è§„èŒƒ"><a href="#Reactive-è§„èŒƒ" class="headerlink" title="Reactive è§„èŒƒ"></a>Reactive è§„èŒƒ</h3><p>â€‹    Reactive Manifestoã€Reactive Streams    </p><p>â€‹    ä¹¦ç±ğŸ“š/æ–‡æ¡£ï¼šå®˜æ–¹æ–‡æ¡£ ==å¾…è¡¥å……==</p><h2 id="é«˜æ•ˆ-ä¼˜é›…"><a href="#é«˜æ•ˆ-ä¼˜é›…" class="headerlink" title="é«˜æ•ˆ/ä¼˜é›…"></a>é«˜æ•ˆ/ä¼˜é›…</h2><p>â€‹    å¤šçœ‹ï¼Œå¤šå†™æ¨¡ä»¿ï¼Œä¾‹å¦‚springä¸­çš„è®¾è®¡æ¨¡å¼ï¼Œtomcatä¸­çš„è®¾è®¡æ¨¡å¼</p><p>â€‹    å¸¸ç”¨å·¥å…·Gitã€Maven ã€Nginx</p><p>â€‹    ä¹¦ç±ğŸ“š/æ–‡æ¡£ ï¼šã€ŠMavenå®æˆ˜ã€‹ã€ã€ŠEffective Javaã€‹ã€ã€Šé‡æ„ã€‹ã€ã€ŠHead Firstè®¾è®¡æ¨¡å¼ã€‹ã€ã€Šæµ‹è¯•é©±åŠ¨å¼€å‘ by Exampleã€‹ã€ã€Šç¨‹åºå‘˜ä¿®ç‚¼ä¹‹é“ã€‹ç¿»è¯‘ä¸å¤ªå¥½</p><h2 id="æ¡†æ¶-ä¸­é—´ä»¶"><a href="#æ¡†æ¶-ä¸­é—´ä»¶" class="headerlink" title="æ¡†æ¶/ä¸­é—´ä»¶"></a>æ¡†æ¶/ä¸­é—´ä»¶</h2><p>â€‹    å…³æ³¨å¸¸ç”¨æ¡†æ¶ï¼Œä»¥åŠç”Ÿå‘½å‘¨æœŸAtticâ€”â€“&gt; <a href="https://attic.apache.org/ï¼Œæ³¨æ„ä¸»æµæ¡†æ¶çš„ç‰ˆæœ¬ç‰¹å¾" target="_blank" rel="noopener">https://attic.apache.org/ï¼Œæ³¨æ„ä¸»æµæ¡†æ¶çš„ç‰ˆæœ¬ç‰¹å¾</a> / ä½¿ç”¨äº†ä»€ä¹ˆè®¾è®¡æ¨¡å¼</p><h3 id="Webæ ˆ"><a href="#Webæ ˆ" class="headerlink" title="Webæ ˆ"></a>Webæ ˆ</h3><p>â€‹    Strutsã€ Spring </p><h3 id="å…³ç³»å‹æ•°æ®åº“"><a href="#å…³ç³»å‹æ•°æ®åº“" class="headerlink" title="å…³ç³»å‹æ•°æ®åº“"></a>å…³ç³»å‹æ•°æ®åº“</h3><p>â€‹     MyBatisã€Hiberanteã€JPA</p><h3 id="NoSQL"><a href="#NoSQL" class="headerlink" title="NoSQL"></a>NoSQL</h3><p>â€‹      Redis ã€Mongoã€ ELasticSearchã€Hbase</p><h3 id="RPC"><a href="#RPC" class="headerlink" title="RPC"></a>RPC</h3><p>â€‹    CXF(WebServices)ã€Spring Cloud Feign(REST)ã€Dubbo (å¤šåè®®)</p><h3 id="ä»»åŠ¡è°ƒåº¦"><a href="#ä»»åŠ¡è°ƒåº¦" class="headerlink" title="ä»»åŠ¡è°ƒåº¦"></a>ä»»åŠ¡è°ƒåº¦</h3><p>â€‹    Java Timer/ScheduleExecutorServiceã€ Spring @Scheduled</p><h3 id="æ¶ˆæ¯æœåŠ¡"><a href="#æ¶ˆæ¯æœåŠ¡" class="headerlink" title="æ¶ˆæ¯æœåŠ¡"></a>æ¶ˆæ¯æœåŠ¡</h3><p>â€‹    ActiveMQï¼ˆJMSï¼‰ã€RabbitMQï¼ˆAMQPï¼‰ã€Kafka</p><h3 id="å®¢æˆ·ç«¯"><a href="#å®¢æˆ·ç«¯" class="headerlink" title="å®¢æˆ·ç«¯"></a>å®¢æˆ·ç«¯</h3><p>â€‹    HttpClient(HTTP) ã€Spring RestTemplate ( REST )</p><h3 id="Webå®¹å™¨"><a href="#Webå®¹å™¨" class="headerlink" title="Webå®¹å™¨"></a>Webå®¹å™¨</h3><p>â€‹    Tomcatã€Jettyâ€‹    </p><p>ä¹¦ç±ğŸ“š/èµ„æ–™</p><p>â€‹    ã€Šå¤§å‹ç½‘ç»œæ¶æ„ä¸ä¸­é—´ä»¶ã€‹ã€ã€ŠTomcatæ¶æ„è§£æã€‹</p><p>â€‹         tomcatè®¾è®¡æ¨¡å¼ <a href="https://www.cnblogs.com/coldridgeValley/p/6606271.html" target="_blank" rel="noopener">https://www.cnblogs.com/coldridgeValley/p/6606271.html</a></p><p>â€‹    </p><h2 id="å¾®æœåŠ¡æ¼”å˜"><a href="#å¾®æœåŠ¡æ¼”å˜" class="headerlink" title="å¾®æœåŠ¡æ¼”å˜"></a>å¾®æœåŠ¡æ¼”å˜</h2><p>â€‹    SOAå‘å¾®æœåŠ¡çš„æ¼”å˜ï¼Œè¡ç”Ÿäº†è®¸å¤šæŠ€æœ¯ï¼ŒCAP ã€BASEç†è®º</p><h3 id="æœåŠ¡è°ƒç”¨"><a href="#æœåŠ¡è°ƒç”¨" class="headerlink" title="æœåŠ¡è°ƒç”¨"></a>æœåŠ¡è°ƒç”¨</h3><p>â€‹    å¦‚ä½•é«˜å¹¶å‘ã€é«˜å¯ç”¨</p><h3 id="åˆ†å¸ƒå¼é…ç½®"><a href="#åˆ†å¸ƒå¼é…ç½®" class="headerlink" title="åˆ†å¸ƒå¼é…ç½®"></a>åˆ†å¸ƒå¼é…ç½®</h3><p>â€‹    Nacosã€Spring Cloud Feign</p><h3 id="æœåŠ¡æ³¨å†Œ-å‘ç°"><a href="#æœåŠ¡æ³¨å†Œ-å‘ç°" class="headerlink" title="æœåŠ¡æ³¨å†Œ/å‘ç°"></a>æœåŠ¡æ³¨å†Œ/å‘ç°</h3><p>â€‹    zkã€Eureka Consulã€‚å¯¹æ¯”ï¼Œä½¿ç”¨åœºæ™¯ã€‚ cpã€ap</p><p>â€‹    ä¹¦ç±ğŸ“šï¼šã€Šproxysåˆ°zookeeperä¸€è‡´æ€§åè®®ã€‹</p><h3 id="è·¯ç”±-è´Ÿè½½å‡è¡¡"><a href="#è·¯ç”±-è´Ÿè½½å‡è¡¡" class="headerlink" title="è·¯ç”±/è´Ÿè½½å‡è¡¡"></a>è·¯ç”±/è´Ÿè½½å‡è¡¡</h3><p>â€‹    Netflix Ribbon</p><h3 id="ç†”æ–­-é™æµ"><a href="#ç†”æ–­-é™æµ" class="headerlink" title="ç†”æ–­/é™æµ"></a>ç†”æ–­/é™æµ</h3><p>â€‹    Spring Cloud Hystrix</p><p>ç›¸å…³æŠ€æœ¯ï¼š</p><p>â€‹    é™æµ -ã€‹RateLimiteræ˜¯Guavaçš„concurrentåŒ…ä¸‹çš„ä¸€ä¸ªç”¨äºé™åˆ¶è®¿é—®é¢‘ç‡çš„ç±».</p><h3 id="ç½‘å…³"><a href="#ç½‘å…³" class="headerlink" title="ç½‘å…³"></a>ç½‘å…³</h3><p>â€‹    Spring Cloud Zuul     </p><h3 id="å…¶ä»–-2"><a href="#å…¶ä»–-2" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><p>â€‹    åˆ†å¸ƒå¼é”    </p><p>â€‹    åˆ†å¸ƒå¼äº‹åŠ¡ <a href="https://mp.weixin.qq.com/s/oKOzvN49zOhl8cwliy3SEg" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/oKOzvN49zOhl8cwliy3SEg</a></p><p>â€‹        XAä¸¤é˜¶æ®µæäº¤çš„ä¸è¶³  XAä¸‰é˜¶æ®µ</p><p>â€‹    è§£å†³ä¸€è‡´æ€§é—®é¢˜ï¼Œraftã€Gossip ï¼ˆredisï¼‰ã€Paxos(zk)</p><h3 id="Spring-Cloud-ï¼ˆä¾µå…¥å¼ï¼‰"><a href="#Spring-Cloud-ï¼ˆä¾µå…¥å¼ï¼‰" class="headerlink" title="Spring Cloud ï¼ˆä¾µå…¥å¼ï¼‰"></a>Spring Cloud ï¼ˆä¾µå…¥å¼ï¼‰</h3><p>â€‹    å¯ä»¥çœ‹çœ‹springCloudéƒ½åšäº†äº›ä»€ä¹ˆå®ç°</p><p>â€‹    Compare with k8s  <a href="https://en.wikipedia.org/wiki/Kubernetes#Comparison_to_Spring_Cloud" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Kubernetes#Comparison_to_Spring_Cloud</a></p><p>â€‹    ç›¸å…³æ–‡æ¡£/ä¹¦ç±ğŸ“šï¼šã€Šé¢†åŸŸé©±åŠ¨ã€‹ã€ã€ŠSpringCloudå¾®æœåŠ¡å®è·µã€‹</p><h3 id="Service-Mesh-ï¼ˆéä¾µå…¥å¼ï¼‰"><a href="#Service-Mesh-ï¼ˆéä¾µå…¥å¼ï¼‰" class="headerlink" title="Service Mesh ï¼ˆéä¾µå…¥å¼ï¼‰"></a>Service Mesh ï¼ˆéä¾µå…¥å¼ï¼‰</h3><p>â€‹    kubernetes ä¸ºåŸºç¡€ï¼Œdockerä¸ºå®¹å™¨ï¼ˆ<a href="https://zhuanlan.zhihu.com/p/54512286?utm_source=wechat_session&amp;utm_medium=social&amp;utm_oi=557574927448846336ï¼‰" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/54512286?utm_source=wechat_session&amp;utm_medium=social&amp;utm_oi=557574927448846336ï¼‰</a></p><p>â€‹    ç›¸å…³æŠ€æœ¯ï¼šCI/CD æŒç»­é›†æˆ</p><p>ç›¸å…³æ–‡æ¡£/ä¹¦ç±ğŸ“šï¼šã€ŠDockerè¿›é˜¶ä¸å®æˆ˜ã€‹</p><h2 id="å¤§æ•°æ®ç”Ÿæ€"><a href="#å¤§æ•°æ®ç”Ÿæ€" class="headerlink" title="å¤§æ•°æ®ç”Ÿæ€"></a>å¤§æ•°æ®ç”Ÿæ€</h2><p>â€‹    Kafka zookeeper flume</p><p>â€‹    å®æ—¶ sparker</p><p>â€‹    ç¦»çº¿ hive</p><h2 id="å…¶ä»–-3"><a href="#å…¶ä»–-3" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><h3 id="å¼€é˜”è§†é‡"><a href="#å¼€é˜”è§†é‡" class="headerlink" title="å¼€é˜”è§†é‡"></a>å¼€é˜”è§†é‡</h3><p>â€‹    æ­£æ‰€è°“ç«™çš„é«˜çœ‹å¾—è¿œï¼Œå¤šå…³æ³¨ä¸šç•Œå‘å±•ã€‚ </p><p>â€‹    ç›¸å…³èµ„æ–™ï¼š<a href="https://www.zhihu.com/question/305924723/answer/556971474?utm_source=wechat_session&amp;utm_medium=social&amp;utm_oi=557574927448846336" target="_blank" rel="noopener">https://www.zhihu.com/question/305924723/answer/556971474?utm_source=wechat_session&amp;utm_medium=social&amp;utm_oi=557574927448846336</a></p><p>â€‹    <a href="https://mp.weixin.qq.com/s/CPUaB60pue0Zf3fUL9xqvw" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/CPUaB60pue0Zf3fUL9xqvw</a></p><p>â€‹    <a href="http://www.iocoder.cn/chinese-comment-repository/?xing" target="_blank" rel="noopener">http://www.iocoder.cn/chinese-comment-repository/?xing</a></p><h3 id="æ€§èƒ½-å‹åŠ›æµ‹è¯•-è°ƒä¼˜"><a href="#æ€§èƒ½-å‹åŠ›æµ‹è¯•-è°ƒä¼˜" class="headerlink" title="æ€§èƒ½/å‹åŠ›æµ‹è¯•/è°ƒä¼˜"></a>æ€§èƒ½/å‹åŠ›æµ‹è¯•/è°ƒä¼˜</h3><p>â€‹    æ‡‚å¸¸ç”¨æ€§èƒ½æŒ‡æ ‡ï¼Œä»¥åŠå¦‚ä½•é¢„ä¼°æ€§èƒ½</p><p>â€‹    ç›¸å…³èµ„æ–™ï¼š</p><p>â€‹    <a href="https://mp.weixin.qq.com/s/w0TxuFQZAIED879JRax8vg" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/w0TxuFQZAIED879JRax8vg</a></p><p>â€‹    <a href="https://mp.weixin.qq.com/s/Lz4cEt0LY_Fvqz2zAgOafw" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/Lz4cEt0LY_Fvqz2zAgOafw</a></p><h3 id="å‰ç«¯åŸºç¡€"><a href="#å‰ç«¯åŸºç¡€" class="headerlink" title="å‰ç«¯åŸºç¡€"></a>å‰ç«¯åŸºç¡€</h3><p>â€‹    é™¤äº†htmlã€cssã€javascript ç›¸å…³ã€ ä¸€äº›å‰ç«¯æ¡†æ¶ä¹Ÿéœ€è¦äº†è§£Vueã€React</p><p>â€‹    å‰åç«¯åˆ†ç¦»/å•é¡µé¢åº”ç”¨â€”ã€‹ã€‰<a href="https://blog.csdn.net/Nicorui/article/details/74945839" target="_blank" rel="noopener">https://blog.csdn.net/Nicorui/article/details/74945839</a></p><p>â€‹    ä¹¦ç±ğŸ“šã€ŠJavascript DOMç¼–ç¨‹è‰ºæœ¯ã€‹</p><h3 id="æ€åº¦"><a href="#æ€åº¦" class="headerlink" title="æ€åº¦"></a>æ€åº¦</h3><p>â€‹    ä¿æŒè‡ªæˆ‘é©±åŠ¨å’Œçƒ­æƒ…/ä¸æ»¡è¶³äºå®Œæˆé¢„æœŸ</p><h3 id="å­¦ä¹ æ–¹æ³•"><a href="#å­¦ä¹ æ–¹æ³•" class="headerlink" title="å­¦ä¹ æ–¹æ³•"></a>å­¦ä¹ æ–¹æ³•</h3><ul><li><p>æ˜¯ä»€ä¹ˆ :å®˜æ–¹ã€wikiã€åŒç±»æŠ€æœ¯å¯¹æ¯”ã€ç»„æˆéƒ¨åˆ†ã€ç‰ˆæœ¬ç‰¹æ€§</p></li><li><p>ä¸ºä»€ä¹ˆ : è§£å†³äº†ä»€ä¹ˆé—®é¢˜ã€æ²¡æœ‰å‡ºç°ä¹‹å‰æ€ä¹ˆåšã€ è‡ªå·±å®ç°çš„è¯ä¼šæ€ä¹ˆåš</p></li><li><p>æ€ä¹ˆåš  :å®˜æ–¹ç¤ºä¾‹/æ–‡æ¡£ ã€ç›¸å…³å­¦ä¹ è§†é¢‘ã€å†™Demoã€å¸¦ç€é—®é¢˜çœ‹æºç ã€å®è·µ</p></li><li><p>è¾“å‡º :å†™blogã€åˆ†äº«</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> summary </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>j2ee_servlet</title>
      <link href="/2019/02/02/Spec_Servlet/"/>
      <url>/2019/02/02/Spec_Servlet/</url>
      
        <content type="html"><![CDATA[<p>é˜…è¯»çš„ç›®çš„ï¼Ÿæˆ‘æƒ³è¦ä»ä¸­è·å¾—ä»€ä¹ˆï¼Ÿ</p><p>â€‹    servletè§„èŒƒç›¸å…³ , ç†è§£tomcat å’ŒdispatchServletå®ç°</p><a id="more"></a><h2 id="servlet-3-1è§„èŒƒæ¦‚è§ˆ"><a href="#servlet-3-1è§„èŒƒæ¦‚è§ˆ" class="headerlink" title="servlet 3.1è§„èŒƒæ¦‚è§ˆ"></a>servlet 3.1è§„èŒƒæ¦‚è§ˆ</h2><h3 id="What-is-servlet"><a href="#What-is-servlet" class="headerlink" title="What is servlet"></a>What is servlet</h3><pre><code>A servlet is a JavaTM technology-based Web component, managed by a container, that generates dynamic content. </code></pre><blockquote><p>From servlet 3.1</p></blockquote><h3 id="History"><a href="#History" class="headerlink" title="History"></a>History</h3><p><img src="https://ws1.sinaimg.cn/large/006tNbRwly1fy9oye7wq4j31pm0hyarl.jpg" alt=""></p><blockquote><p>From wiki</p></blockquote><h3 id="Servlet-Life-Cycle"><a href="#Servlet-Life-Cycle" class="headerlink" title="Servlet Life Cycle"></a>Servlet Life Cycle</h3><ul><li><p>Loading and Instantiation</p><p>  When the servlet engine is started, needed servlet classes must be located by the<br>  servlet container(WEB-INF/lib)</p></li><li><p>Initialization</p><pre><code>  The container initializes the servlet instance by calling the init method of the Servlet interface with a unique (per servlet declaration) object implementing the ServletConfig interface</code></pre></li></ul><p>ï¼ˆServletConfig used by Servletï¼‰</p><ul><li><p>Request Handling</p><p>  After a servlet is properly initialized, the servlet container may use it to handle client<br>  requests. </p></li><li><p>End of Service</p></li></ul><h3 id="Servlet-ç»§æ‰¿ç»“æ„"><a href="#Servlet-ç»§æ‰¿ç»“æ„" class="headerlink" title="Servlet ç»§æ‰¿ç»“æ„"></a>Servlet ç»§æ‰¿ç»“æ„</h3><p><img src="https://ws2.sinaimg.cn/large/006tNbRwly1fycf0mk9d5j30u00u6dqo.jpg" alt="image-20181219221816845"></p><h3 id="ServletContext"><a href="#ServletContext" class="headerlink" title="ServletContext"></a>ServletContext</h3><blockquote><p>â€‹    The ServletContext interface defines a servletâ€™s view of the Web application within which the servlet is running.  (web.xml) The Container Provider is responsible for providing an implementation of the ServletContext interface in the servlet container.</p></blockquote><pre><code class="markdown">InitParameterconfig     -Filter    -Listenr    -ServletAttributeResource...</code></pre><blockquote><p>see : ApplicationContextã€ApplicationContextFacade (tomcat)</p></blockquote><h3 id="Request"><a href="#Request" class="headerlink" title="Request"></a>Request</h3><p>HttpServletRequest</p><ul><li><p>HTTP Protocol Parameters</p><blockquote><p>â–  getParameter</p><p>â–  getParameterNames </p><p>â–  getParameterValues </p><p>â–  getParameterMap</p></blockquote></li><li><p>File upload </p><p>  content-type : multipart/form-data </p></li><li><p>Attributes </p></li><li><p>Headers</p></li><li><p>Request Path Elements</p><blockquote><p>requestURI = contextPath + servletPath + pathInfo</p></blockquote></li><li><p>Path Translation Methods</p><blockquote><p>â–  ServletContext.getRealPath  </p><p>â–  HttpServletRequest.getPathTranslated</p></blockquote></li><li><p>Non Blocking IO</p><p>  Non-blocking IO only works with async request processing in Servlets and Filters</p></li><li><p>Cookies</p></li><li><p>SSL</p></li><li><p>Internationalization</p><p>  Accept-Language : zh-cn</p></li><li><blockquote><p>â–  getLocale<br>â–  getLocales</p></blockquote></li><li><p>Request data encoding </p><p>  The default encoding of a request the container uses to create the request reader and parse POST data must be â€œISO-8859-1â€ if none has been specified by the client request. </p></li><li><p>Lifetime of the Request Object </p><p>  Each request object is valid only within the scope of a servletâ€™s service method, or within the scope of a filterâ€™s doFilter method, unless the asynchronous processing is enabled for the component and the startAsync method is invoked on the request object. </p></li></ul><h3 id="Response"><a href="#Response" class="headerlink" title="Response"></a>Response</h3><p><img src="https://ws1.sinaimg.cn/large/006tNbRwly1fyceza35scj30lc0luwf3.jpg" alt="image-20181219221656097"></p><h3 id="Filter"><a href="#Filter" class="headerlink" title="Filter"></a>Filter</h3><p> what is Filter? </p><blockquote><p>A filter is a reusable piece of code that can transform the content of HTTP requests,responses, and header information.</p></blockquote><p>org.springframework.web.servlet.HandlerInterceptor</p><pre><code class="java">/* &lt;p&gt;HandlerInterceptor is basically similar to a Servlet 2.3 Filter, but in* contrast to the latter it just allows custom pre-processing with the option* of prohibiting the execution of the handler itself, and custom post-processing.* Filters are more powerful, for example they allow for exchanging the request* and response objects that are handed down the chain. Note that a filter* gets configured in web.xml, a HandlerInterceptor in the application context.*/</code></pre><h3 id="Lifecycle-Events"><a href="#Lifecycle-Events" class="headerlink" title="Lifecycle Events"></a>Lifecycle Events</h3><pre><code class="json">Event    -Servlet    -Session    -RequestEventListener    -Servlet    -Session    -Request</code></pre><p>Example : <code>ServletContextListener</code></p><pre><code class="java">public class ContextLoaderListener implements ServletContextListener {    private ContextLoader contextLoader;    public ContextLoaderListener() {    }    public void contextInitialized(ServletContextEvent event) {        this.contextLoader = this.createContextLoader();        this.contextLoader.initWebApplicationContext(event.getServletContext());    }    protected ContextLoader createContextLoader() {        return new ContextLoader();    }    public ContextLoader getContextLoader() {        return this.contextLoader;    }    public void contextDestroyed(ServletContextEvent event) {        if(this.contextLoader != null) {            this.contextLoader.closeWebApplicationContext(event.getServletContext());        }    }}</code></pre><h3 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h3><h2 id="Servletæºç åˆ†æ"><a href="#Servletæºç åˆ†æ" class="headerlink" title="Servletæºç åˆ†æ"></a>Servletæºç åˆ†æ</h2><p>Server + Applet çš„ç¼©å†™ï¼Œè¡¨ç¤ºä¸€ä¸ªæœåŠ¡å™¨åº”ç”¨ , ä»¥ä¸‹å†…å®¹ä¸º<code>javax.servlet</code></p><h3 id="Servletæ¥å£"><a href="#Servletæ¥å£" class="headerlink" title="Servletæ¥å£"></a>Servletæ¥å£</h3><pre><code class="java">package javax.servlet;import java.io.IOException;public interface Servlet {    public void init(ServletConfig config) throws ServletException;    public ServletConfig getServletConfig();    public void service(ServletRequest req, ServletResponse res)   throws ServletException, IOException;    public String getServletInfo();    public void destroy();}</code></pre><blockquote><p>Load-on-startup ä¸ºè´Ÿçš„è¯ä¸ä¼šåœ¨å®¹å™¨å¯åŠ¨è°ƒç”¨</p></blockquote><h3 id="ServletConfigæ¥å£"><a href="#ServletConfigæ¥å£" class="headerlink" title="ServletConfigæ¥å£"></a>ServletConfigæ¥å£</h3><pre><code class="java">package javax.servlet;import java.util.Enumeration;/** * A servlet configuration object used by a servlet container * to pass information to a servlet during initialization.  */ public interface ServletConfig {    public String getServletName();    public ServletContext getServletContext();    public String getInitParameter(String name);    public Enumeration&lt;String&gt; getInitParameterNames();}</code></pre><p>å¦‚ä¸‹é…ç½®</p><pre><code class="xml">&lt;!--web.xml--&gt;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;web-app ...&gt;    &lt;context-param&gt;        &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;        &lt;param-value&gt;application-context.xml&lt;/param-value&gt;    &lt;/context-param&gt;&lt;servlet&gt;    &lt;servlet-name&gt;demoDispatcher&lt;/servlet-name&gt;    &lt;servlet-class&gt;org.springframework.web.servlet.Dispatcher&lt;/servlet-class&gt;    &lt;init-param&gt;        &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;        &lt;param-value&gt;demo-servlet.xml&lt;/param-value&gt;    &lt;/init-param&gt;    &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;&lt;/servlet&gt;&lt;/web-app&gt;</code></pre><p>åœ¨Servletä¸­ å¯ä»¥åˆ†åˆ«é€šè¿‡å®ƒä»¬çš„getInitParameteræ–¹æ³•è·å–ï¼Œæ¯”å¦‚ï¼š</p><pre><code class="java">String contextLocation = getServletConfig().getServletContext().getInitParameter(    &quot;contextConfigLocation&quot;);String servletLocation = getServletConfig().getInitParameter(&quot;contextConfigLocation&quot;);</code></pre><h3 id="GenerieServlet"><a href="#GenerieServlet" class="headerlink" title="GenerieServlet"></a>GenerieServlet</h3><pre><code>`Servlet`çš„é»˜è®¤å®ç°ï¼ŒåŒæ—¶å®ç°äº†`ServletConfig`æ¥å£ã€`Serializable`æ¥å£ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥è°ƒç”¨`ServletConfig`é‡Œé¢çš„æ–¹æ³•ã€‚è¯¦ç»†å¯å‚è€ƒå¦‚ä¸‹ç±»æ³¨é‡Šã€‚</code></pre><pre><code class="java">package javax.servlet;import java.io.IOException;import java.util.Enumeration;/** * * Defines a generic, protocol-independent * servlet. To write an HTTP servlet for use on the * Web, extend {@link javax.servlet.http.HttpServlet} instead. * * &lt;p&gt;&lt;code&gt;GenericServlet&lt;/code&gt; implements the &lt;code&gt;Servlet&lt;/code&gt; * and &lt;code&gt;ServletConfig&lt;/code&gt; interfaces. &lt;code&gt;GenericServlet&lt;/code&gt; * may be directly extended by a servlet, although it&#39;s more common to extend * a protocol-specific subclass such as &lt;code&gt;HttpServlet&lt;/code&gt;. * * &lt;p&gt;&lt;code&gt;GenericServlet&lt;/code&gt; makes writing servlets * easier. It provides simple versions of the lifecycle methods  * &lt;code&gt;init&lt;/code&gt; and &lt;code&gt;destroy&lt;/code&gt; and of the methods  * in the &lt;code&gt;ServletConfig&lt;/code&gt; interface. &lt;code&gt;GenericServlet&lt;/code&gt; * also implements the &lt;code&gt;log&lt;/code&gt; method, declared in the * &lt;code&gt;ServletContext&lt;/code&gt; interface.  * * &lt;p&gt;To write a generic servlet, you need only * override the abstract &lt;code&gt;service&lt;/code&gt; method.  * */public abstract class GenericServlet     implements Servlet, ServletConfig, java.io.Serializable{    private transient ServletConfig config;    public GenericServlet() {}    public void destroy() {}    public String getInitParameter(String name) {        return getServletConfig().getInitParameter(name);    }    public Enumeration getInitParameterNames() {        return getServletConfig().getInitParameterNames();    }       public ServletConfig getServletConfig() {        return config;    }    public ServletContext getServletContext() {        return getServletConfig().getServletContext();    }    public String getServletInfo() {        return &quot;&quot;;    }    public void init(ServletConfig config) throws ServletException {        this.config = config;        this.init();    }    public void init() throws ServletException {    }    public void log(String msg) {        getServletContext().log(getServletName() + &quot;: &quot;+ msg);    }    public void log(String message, Throwable t) {        getServletContext().log(getServletName() + &quot;: &quot; + message, t);    }    public abstract void service(ServletRequest req, ServletResponse res)    throws ServletException, IOException;    public String getServletName() {        return config.getServletName();    }}</code></pre><p>é™„ï¼šä¸ºä»€ä¹ˆéœ€è¦å®ç° <code>java.io.Serializable</code> æ¥å£ï¼Ÿ</p><p>ç­”ï¼šåœ¨ Servlet 2.4 è§„èŒƒçš„ 7.7.2 Distributed Environments ç« èŠ‚ä¸­ï¼Œæœ‰ä¸€å¥è¿™æ ·çš„æè¿°ï¼š</p><pre><code class="markdown">The distributed servlet container must support the mechanism necessary formigrating objects that implement Serializable.</code></pre><blockquote><p>æŒ‰ç…§è§„èŒƒçš„è®¾è®¡ï¼ŒServlet æœ‰ä¸€ä¸ªé’åŒ–çš„ç‰¹æ€§ï¼Œç±»ä¼¼äº Servlet æŒä¹…åŒ–åˆ°æ–‡ä»¶ï¼Œç„¶åå½“å®¹å™¨ Crash å›å¤åï¼Œå¯ä»¥é‡æ–°æ¢å¤ä¿å­˜å‰çš„çŠ¶æ€ã€‚</p></blockquote><h3 id="HttpServlet"><a href="#HttpServlet" class="headerlink" title="HttpServlet"></a>HttpServlet</h3><pre><code class="java">package javax.servlet.http;import ....;/** * Provides an abstract class to be subclassed to create * an HTTP servlet suitable for a Web site. A subclass of * &lt;code&gt;HttpServlet&lt;/code&gt; must override at least  * one method, usually one of these: * * &lt;ul&gt; * &lt;li&gt; &lt;code&gt;doGet&lt;/code&gt;, if the servlet supports HTTP GET requests * &lt;li&gt; &lt;code&gt;doPost&lt;/code&gt;, for HTTP POST requests * &lt;li&gt; &lt;code&gt;doPut&lt;/code&gt;, for HTTP PUT requests * &lt;li&gt; &lt;code&gt;doDelete&lt;/code&gt;, for HTTP DELETE requests * &lt;li&gt; &lt;code&gt;init&lt;/code&gt; and &lt;code&gt;destroy&lt;/code&gt;,  * to manage resources that are held for the life of the servlet * &lt;li&gt; &lt;code&gt;getServletInfo&lt;/code&gt;, which the servlet uses to * provide information about itself  * &lt;/ul&gt; * * &lt;p&gt;There&#39;s almost no reason to override the &lt;code&gt;service&lt;/code&gt; * method. &lt;code&gt;service&lt;/code&gt; handles standard HTTP * requests by dispatching them to the handler methods * for each HTTP request type (the &lt;code&gt;do&lt;/code&gt;&lt;i&gt;XXX&lt;/i&gt; * methods listed above). * * &lt;p&gt;Likewise, there&#39;s almost no reason to override the  * &lt;code&gt;doOptions&lt;/code&gt; and &lt;code&gt;doTrace&lt;/code&gt; methods. * */public abstract class HttpServlet extends GenericServlet    implements java.io.Serializable{    private static final String METHOD_DELETE = &quot;DELETE&quot;;    private static final String METHOD_HEAD = &quot;HEAD&quot;;    private static final String METHOD_GET = &quot;GET&quot;;    private static final String METHOD_OPTIONS = &quot;OPTIONS&quot;;    private static final String METHOD_POST = &quot;POST&quot;;    private static final String METHOD_PUT = &quot;PUT&quot;;    private static final String METHOD_TRACE = &quot;TRACE&quot;;    private static final String HEADER_IFMODSINCE = &quot;If-Modified-Since&quot;;    private static final String HEADER_LASTMOD = &quot;Last-Modified&quot;;    /**    * Resource bundles contain locale-specific objects.    */    private static final String LSTRING_FILE =    &quot;javax.servlet.http.LocalStrings&quot;;    private static ResourceBundle lStrings =    ResourceBundle.getBundle(LSTRING_FILE);    public HttpServlet() { }    protected void doGet(HttpServletRequest req, HttpServletResponse resp)    throws ServletException, IOException{        String protocol = req.getProtocol();        String msg = lStrings.getString(&quot;http.method_get_not_supported&quot;);        if (protocol.endsWith(&quot;1.1&quot;)) {            resp.sendError(HttpServletResponse.SC_METHOD_NOT_ALLOWED, msg);        } else {            resp.sendError(HttpServletResponse.SC_BAD_REQUEST, msg);        }    }    protected long getLastModified(HttpServletRequest req) {        return -1;    }    protected void doHead(HttpServletRequest req, HttpServletResponse resp)    throws ServletException, IOException{        NoBodyResponse response = new NoBodyResponse(resp);        doGet(req, response);        response.setContentLength();    }    protected void doPost(HttpServletRequest req, HttpServletResponse resp)    throws ServletException, IOException{        String protocol = req.getProtocol();        String msg = lStrings.getString(&quot;http.method_post_not_supported&quot;);        if (protocol.endsWith(&quot;1.1&quot;)) {            resp.sendError(HttpServletResponse.SC_METHOD_NOT_ALLOWED, msg);        } else {            resp.sendError(HttpServletResponse.SC_BAD_REQUEST, msg);        }    }    protected void doPut(HttpServletRequest req, HttpServletResponse resp)    throws ServletException, IOException{       //ç•¥,ç±»ä¼¼doPost    }    protected void doDelete(HttpServletRequest req,                HttpServletResponse resp)    throws ServletException, IOException{       //ç•¥,ç±»ä¼¼doPost    }    protected void doOptions(HttpServletRequest req, HttpServletResponse resp)    throws ServletException, IOException{      //ç•¥,ä¸»è¦ç”¨äºè°ƒè¯•,è¾“å‡ºå…è®¸ç±»å‹    }    protected void service(HttpServletRequest req, HttpServletResponse resp)    throws ServletException, IOException{        String method = req.getMethod();        if (method.equals(METHOD_GET)) {            long lastModified = getLastModified(req);            if (lastModified == -1) {            // servlet doesn&#39;t support if-modified-since, no reason            // to go through further expensive logic            doGet(req, resp);            } else {            long ifModifiedSince = req.getDateHeader(HEADER_IFMODSINCE);            if (ifModifiedSince &lt; (lastModified / 1000 * 1000)) {                // If the servlet mod time is later, call doGet()                        // Round down to the nearest second for a proper compare                        // A ifModifiedSince of -1 will always be less                maybeSetLastModified(resp, lastModified);                doGet(req, resp);            } else {                resp.setStatus(HttpServletResponse.SC_NOT_MODIFIED);            }            }        } else if (method.equals(METHOD_HEAD)) {            long lastModified = getLastModified(req);            maybeSetLastModified(resp, lastModified);            doHead(req, resp);        } else if (method.equals(METHOD_POST)) {            doPost(req, resp);        } else if (method.equals(METHOD_PUT)) {            doPut(req, resp);            } else if (method.equals(METHOD_DELETE)) {            doDelete(req, resp);        } else if (method.equals(METHOD_OPTIONS)) {            doOptions(req,resp);        } else if (method.equals(METHOD_TRACE)) {            doTrace(req,resp);        } else {            //            // Note that this means NO servlet supports whatever            // method was requested, anywhere on this server.            //            String errMsg = lStrings.getString(&quot;http.method_not_implemented&quot;);            Object[] errArgs = new Object[1];            errArgs[0] = method;            errMsg = MessageFormat.format(errMsg, errArgs);            resp.sendError(HttpServletResponse.SC_NOT_IMPLEMENTED, errMsg);        }    }    public void service(ServletRequest req, ServletResponse res)    throws ServletException, IOException{        HttpServletRequest    request;        HttpServletResponse    response;        try {            request = (HttpServletRequest) req;            response = (HttpServletResponse) res;        } catch (ClassCastException e) {            throw new ServletException(&quot;non-HTTP request or response&quot;);        }        service(request, response);    }}/* * A response that includes no body, for use in (dumb) &quot;HEAD&quot; support. * This just swallows that body, counting the bytes in order to set * the content length appropriately.  All other methods delegate directly * to the HTTP Servlet Response object used to construct this one. */// file privateclass NoBodyResponse extends HttpServletResponseWrapper {    private NoBodyOutputStream        noBody;    private PrintWriter            writer;    private boolean            didSetContentLength;    // file private    NoBodyResponse(HttpServletResponse r) {        super(r);    noBody = new NoBodyOutputStream();    }    // ....}/* * Servlet output stream that gobbles up all its data. */// file privateclass NoBodyOutputStream extends ServletOutputStream {    //...}</code></pre><pre><code>doXXX éƒ½æ˜¯æ¨¡æ¿æ–¹æ³•ï¼Œå¦‚æœå­ç±»æ²¡æœ‰å®ç°å°†æŠ›å‡ºå¼‚å¸¸doGet æ–¹æ³•å‰è¿˜ä¼šå¯¹æ˜¯å¦è¿‡æœŸåšæ£€æŸ¥ï¼Œå¦‚æœæ²¡æœ‰è¿‡æœŸï¼Œåˆ™ç›´æ¥è¿”å›304çŠ¶æ€ç åšç¼“å­˜ã€‚doHeadè°ƒç”¨äº†doGetçš„è¯·æ±‚ï¼Œç„¶åè¿”å›ç©ºbodyçš„responsedoOptionså’ŒdoTrace ä¸»è¦æ˜¯ç”¨æ¥åšä¸€äº›è°ƒè¯•å·¥ä½œ </code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> j2ee </tag>
            
            <tag> servlet </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
