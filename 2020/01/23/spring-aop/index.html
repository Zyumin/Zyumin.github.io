<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>spring-aop | Zyumin</title>
  <meta name="keywords" content=" spring , aop ">
  <meta name="description" content="spring-aop | Zyumin">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="为了将事情做好，首先你得喜欢做这件事，而不是喜欢这件事的结果，那仅仅是第二位。">
<meta property="og:type" content="website">
<meta property="og:title" content="tags">
<meta property="og:url" content="http://yoursite.com/tags/index.html">
<meta property="og:site_name" content="Zyumin">
<meta property="og:description" content="为了将事情做好，首先你得喜欢做这件事，而不是喜欢这件事的结果，那仅仅是第二位。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2019-03-23T07:09:38.000Z">
<meta property="article:modified_time" content="2019-03-23T07:09:56.000Z">
<meta property="article:author" content="zhengyumin">
<meta property="article:tag" content="java">
<meta name="twitter:card" content="summary">


<link rel="icon" href="/img/avatar.png">

<link href="/css/style.css?v=1.1.0" rel="stylesheet">

<link href="/css/hl_theme/github-gist.css?v=1.1.0" rel="stylesheet">

<link href="//cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" rel="stylesheet">

<script src="//cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="/js/titleTip.js?v=1.1.0" ></script>

<script src="//cdn.jsdelivr.net/npm/highlightjs@9.16.2/highlight.pack.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script>



<script src="//cdn.jsdelivr.net/npm/jquery.cookie@1.4.1/jquery.cookie.min.js" ></script>

<script src="/js/iconfont.js?v=1.1.0" ></script>

<meta name="generator" content="Hexo 6.2.0"></head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="">
  <input class="theme_blog_path" value="">
  <input id="theme_shortcut" value="true" />
  <input id="theme_highlight_on" value="true" />
  <input id="theme_code_copy" value="true" />
</div>



<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/"
   class="avatar_target">
    <img class="avatar"
         src="/img/avatar.png"/>
</a>
<div class="author">
    <span>zhengyumin</span>
</div>

<div class="icon">
    
        
            <a title="github"
               href="https://github.com/Zyumin"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-github"></use>
                    </svg>
                
            </a>
        
    
        
            <a title="neteasemusic"
               href="https://music.163.com/#/user/home?id=60037019"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-neteasemusic"></use>
                    </svg>
                
            </a>
        
    
</div>




<ul>
    <li>
        <div class="all active" data-rel="全部文章">全部文章
            
                <small>(57)</small>
            
        </div>
    </li>
    
        
            
                <li>
                    <div data-rel="design">
                        
                        design
                        <small>(1)</small>
                        
                    </div>
                    
                </li>
            
        
    
        
            
                <li>
                    <div data-rel="java">
                        
                        java
                        <small>(9)</small>
                        
                    </div>
                    
                </li>
            
        
    
        
            
                <li>
                    <div data-rel="jdk">
                        
                        jdk
                        <small>(13)</small>
                        
                    </div>
                    
                </li>
            
        
    
        
            
                <li>
                    <div data-rel="mysql">
                        
                        mysql
                        <small>(2)</small>
                        
                    </div>
                    
                </li>
            
        
    
        
            
                <li>
                    <div data-rel="redis">
                        
                        redis
                        <small>(4)</small>
                        
                    </div>
                    
                </li>
            
        
    
        
            
                <li>
                    <div data-rel="spring">
                        
                        spring
                        <small>(10)</small>
                        
                    </div>
                    
                </li>
            
        
    
</ul>
<div class="left-bottom">
    <div class="menus">
        
            
            
            
    </div>
    <div>
        
            <a class="about  site_url"
               
               href="/about">关于</a>
        
        
    </div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="57">
<input type="hidden" id="yelog_site_word_count" value="189.6k">
<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        友情链接
        <i class="iconfont icon-left"></i>
    </div>
    <div class="friends-content">
        <ul>
            
            <li><a target="_blank" href="http://yelog.org/">叶落阁</a></li>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <div class="right-top">
        <div id="default-panel">
            <i class="iconfont icon-search" data-title="搜索 快捷键 i"></i>
            <div class="right-title">全部文章</div>
            <i class="iconfont icon-file-tree" data-title="切换到大纲视图 快捷键 w"></i>
        </div>
        <div id="search-panel">
            <i class="iconfont icon-left" data-title="返回"></i>
            <input id="local-search-input" autocomplete="off"/>
            <label class="border-line" for="input"></label>
            <i class="iconfont icon-case-sensitive" data-title="大小写敏感"></i>
            <i class="iconfont icon-tag" data-title="标签"></i>
        </div>
        <div id="outline-panel" style="display: none">
            <div class="right-title">大纲</div>
            <i class="iconfont icon-list" data-title="切换到文章列表"></i>
        </div>
    </div>

    <div class="tags-list">
    <input id="tag-search" />
    <div class="tag-wrapper">
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>aop</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>applicationContext</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>beanFactory</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>classLoader</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>collections</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>design</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>distributed</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>doc</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>ejb</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>elasticsearch</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>event</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>file</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>framework</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>gc</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>hbase</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>hide</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>hotspot</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>io</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>ioc</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>j2ee</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>java</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>jdk</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>job</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>juc</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>jvm</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>kafka</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>lang</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>map</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>mysql</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>netty</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>nio</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>note</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>packages</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>redis</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>serialization</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>servlet</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>spark</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Spec</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>spring</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>spring-mvc</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>spring-webflux</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>summary</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>thread</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>tomcat</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>utils</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>week</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>zookeeper</a>
            </li>
        
    </div>

</div>

    
    <div id="local-search-result">

    </div>
    
    <nav id="title-list-nav">
        
        
        <a id="top" class="全部文章 java "
           href="/2019/02/02/Overview_java/"
           data-tag="summary"
           data-author="" >
            <span class="post-title" title="Overview_java">Overview_java</span>
            <span class="post-date" title="2019-02-02 20:43:14">2019/02/02</span>
        </a>
        
        
        <a id="top" class="全部文章 spring "
           href="/2019/03/02/Overview_Spring/"
           data-tag="spring,framework"
           data-author="" >
            <span class="post-title" title="Overview-Spring">Overview-Spring</span>
            <span class="post-date" title="2019-03-02 12:29:06">2019/03/02</span>
        </a>
        
        
        <a id="top" class="全部文章 jdk "
           href="/2019/06/13/Overview_JDK/"
           data-tag="jdk,hotspot"
           data-author="" >
            <span class="post-title" title="Overview_JDK">Overview_JDK</span>
            <span class="post-date" title="2019-06-13 19:36:54">2019/06/13</span>
        </a>
        
        
        <a id="top" class="全部文章 java "
           href="/2020/05/10/%E9%9D%A2%E8%AF%95%E5%B8%B8%E8%A7%81%E7%9F%A5%E8%AF%86%E7%82%B9%E6%A2%B3%E7%90%86/"
           data-tag="job"
           data-author="" >
            <span class="post-title" title="面试常见知识点梳理">面试常见知识点梳理</span>
            <span class="post-date" title="2020-05-10 23:46:06">2020/05/10</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2022/06/30/about/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="about">about</span>
            <span class="post-date" title="2022-06-30 17:44:53">2022/06/30</span>
        </a>
        
        
        <a  class="全部文章 design "
           href="/2022/06/30/%E5%86%8D%E8%AF%BB%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"
           data-tag="design"
           data-author="" >
            <span class="post-title" title="再读设计模式">再读设计模式</span>
            <span class="post-date" title="2022-06-30 16:11:33">2022/06/30</span>
        </a>
        
        
        <a  class="全部文章 java "
           href="/2021/01/13/GC%E8%B0%83%E4%BC%98%E6%80%BB%E7%BB%93/"
           data-tag="jvm,gc,summary"
           data-author="" >
            <span class="post-title" title="GC调优总结">GC调优总结</span>
            <span class="post-date" title="2021-01-13 21:36:01">2021/01/13</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2020/03/18/Overview-Hbase/"
           data-tag="distributed,framework,hbase"
           data-author="" >
            <span class="post-title" title="Overview_Hbase">Overview_Hbase</span>
            <span class="post-date" title="2020-03-18 22:00:51">2020/03/18</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2020/03/18/Overview-Spark/"
           data-tag="distributed,spark,framework"
           data-author="" >
            <span class="post-title" title="Overview_Spark">Overview_Spark</span>
            <span class="post-date" title="2020-03-18 22:00:43">2020/03/18</span>
        </a>
        
        
        <a  class="全部文章 redis "
           href="/2020/02/28/Redis%E9%9B%86%E7%BE%A4%E7%AF%87/"
           data-tag="framework,redis"
           data-author="" >
            <span class="post-title" title="Redis集群篇">Redis集群篇</span>
            <span class="post-date" title="2020-02-28 18:52:52">2020/02/28</span>
        </a>
        
        
        <a  class="全部文章 redis "
           href="/2020/02/28/Redis%E5%AE%9E%E6%88%98%E7%AF%87/"
           data-tag="framework,redis"
           data-author="" >
            <span class="post-title" title="Redis实战篇">Redis实战篇</span>
            <span class="post-date" title="2020-02-28 18:52:43">2020/02/28</span>
        </a>
        
        
        <a  class="全部文章 redis "
           href="/2020/02/28/Redis%E5%8E%9F%E7%90%86%E7%AF%87/"
           data-tag="framework,redis"
           data-author="" >
            <span class="post-title" title="Redis原理篇">Redis原理篇</span>
            <span class="post-date" title="2020-02-28 18:52:35">2020/02/28</span>
        </a>
        
        
        <a  class="全部文章 spring "
           href="/2020/01/23/spring-aop/"
           data-tag="spring,aop"
           data-author="" >
            <span class="post-title" title="spring-aop">spring-aop</span>
            <span class="post-date" title="2020-01-23 23:54:29">2020/01/23</span>
        </a>
        
        
        <a  class="全部文章 spring "
           href="/2020/01/16/Spring-ApplicationContext/"
           data-tag="spring,applicationContext"
           data-author="" >
            <span class="post-title" title="Spring-ApplicationContext">Spring-ApplicationContext</span>
            <span class="post-date" title="2020-01-16 21:04:45">2020/01/16</span>
        </a>
        
        
        <a  class="全部文章 spring "
           href="/2019/12/05/spring-BeanFactory/"
           data-tag="spring,beanFactory"
           data-author="" >
            <span class="post-title" title="spring-BeanFactory">spring-BeanFactory</span>
            <span class="post-date" title="2019-12-05 21:28:57">2019/12/05</span>
        </a>
        
        
        <a  class="全部文章 spring "
           href="/2019/12/02/spring-Q-A/"
           data-tag="spring"
           data-author="" >
            <span class="post-title" title="spring Q&amp;A">spring Q&amp;A</span>
            <span class="post-date" title="2019-12-02 18:20:38">2019/12/02</span>
        </a>
        
        
        <a  class="全部文章 spring "
           href="/2019/10/29/Documentation-Spring-Core-IOC/"
           data-tag="spring,doc"
           data-author="" >
            <span class="post-title" title="Documentation-Spring_Core_IOC">Documentation-Spring_Core_IOC</span>
            <span class="post-date" title="2019-10-29 21:51:07">2019/10/29</span>
        </a>
        
        
        <a  class="全部文章 jdk "
           href="/2019/09/26/JDK-Packages-java-nio/"
           data-tag="jdk,packages,nio"
           data-author="" >
            <span class="post-title" title="JDK_Packages_java_nio">JDK_Packages_java_nio</span>
            <span class="post-date" title="2019-09-26 10:39:22">2019/09/26</span>
        </a>
        
        
        <a  class="全部文章 jdk "
           href="/2019/09/23/JDK-Packages-java-io/"
           data-tag="jdk,packages,io,serialization,file"
           data-author="" >
            <span class="post-title" title="JDK_Packages_java_io">JDK_Packages_java_io</span>
            <span class="post-date" title="2019-09-23 16:07:43">2019/09/23</span>
        </a>
        
        
        <a  class="全部文章 jdk "
           href="/2019/08/31/JDK-Class/"
           data-tag="jdk"
           data-author="" >
            <span class="post-title" title="JDK_Class">JDK_Class</span>
            <span class="post-date" title="2019-08-31 19:38:34">2019/08/31</span>
        </a>
        
        
        <a  class="全部文章 jdk "
           href="/2019/08/31/JDK-Thread/"
           data-tag="jvm,jdk,hotspot"
           data-author="" >
            <span class="post-title" title="JDK_Thread">JDK_Thread</span>
            <span class="post-date" title="2019-08-31 18:16:08">2019/08/31</span>
        </a>
        
        
        <a  class="全部文章 java "
           href="/2019/08/29/JVM-main%E6%96%B9%E6%B3%95%E5%88%86%E6%9E%90/"
           data-tag="jvm,java"
           data-author="" >
            <span class="post-title" title="JVM_main方法分析">JVM_main方法分析</span>
            <span class="post-date" title="2019-08-29 23:38:13">2019/08/29</span>
        </a>
        
        
        <a  class="全部文章 jdk "
           href="/2019/08/24/JDK-ReentrantLock/"
           data-tag="juc,jdk"
           data-author="" >
            <span class="post-title" title="JDK_ReentrantLock">JDK_ReentrantLock</span>
            <span class="post-date" title="2019-08-24 18:48:54">2019/08/24</span>
        </a>
        
        
        <a  class="全部文章 java "
           href="/2019/08/17/JVM-Synchronized/"
           data-tag="jvm"
           data-author="" >
            <span class="post-title" title="JVM_Synchronized">JVM_Synchronized</span>
            <span class="post-date" title="2019-08-17 17:01:54">2019/08/17</span>
        </a>
        
        
        <a  class="全部文章 java "
           href="/2019/08/11/Overview-Java-Virtual-Machine/"
           data-tag="jvm"
           data-author="" >
            <span class="post-title" title="Overview_Java Virtual Machine">Overview_Java Virtual Machine</span>
            <span class="post-date" title="2019-08-11 19:05:38">2019/08/11</span>
        </a>
        
        
        <a  class="全部文章 jdk "
           href="/2019/08/11/JDK-Packages-java-lang/"
           data-tag="jdk,packages,lang"
           data-author="" >
            <span class="post-title" title="JDK_Packages_java_lang">JDK_Packages_java_lang</span>
            <span class="post-date" title="2019-08-11 19:04:56">2019/08/11</span>
        </a>
        
        
        <a  class="全部文章 jdk "
           href="/2019/08/11/JDK-Packages-java-utils/"
           data-tag="jdk,packages,utils"
           data-author="" >
            <span class="post-title" title="JDK_Packages_java_utils">JDK_Packages_java_utils</span>
            <span class="post-date" title="2019-08-11 19:04:25">2019/08/11</span>
        </a>
        
        
        <a  class="全部文章 jdk "
           href="/2019/08/10/JDK-The-Concurrent-Framework/"
           data-tag="juc,jdk"
           data-author="" >
            <span class="post-title" title="JDK_The Concurrent Framework">JDK_The Concurrent Framework</span>
            <span class="post-date" title="2019-08-10 19:45:39">2019/08/10</span>
        </a>
        
        
        <a  class="全部文章 jdk "
           href="/2019/07/29/JDK-The-Collections-Framework/"
           data-tag="jdk,collections"
           data-author="" >
            <span class="post-title" title="JDK_The Collections Framework">JDK_The Collections Framework</span>
            <span class="post-date" title="2019-07-29 15:26:01">2019/07/29</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2019/07/10/Note-%E7%A0%81%E5%86%9C%E7%BF%BB%E8%BA%AB/"
           data-tag="java,note"
           data-author="" >
            <span class="post-title" title="Note_码农翻身">Note_码农翻身</span>
            <span class="post-date" title="2019-07-10 22:18:56">2019/07/10</span>
        </a>
        
        
        <a  class="全部文章 jdk "
           href="/2019/07/06/JDK-ClassLoader/"
           data-tag="jdk,classLoader"
           data-author="" >
            <span class="post-title" title="JDK_ClassLoader">JDK_ClassLoader</span>
            <span class="post-date" title="2019-07-06 23:12:51">2019/07/06</span>
        </a>
        
        
        <a  class="全部文章 spring "
           href="/2019/07/03/spring-ApplicationContext%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%E5%92%8C%E4%BA%8B%E4%BB%B6%E6%9C%BA%E5%88%B6/"
           data-tag="spring,classLoader,servlet,tomcat,event"
           data-author="" >
            <span class="post-title" title="spring-ApplicationContext启动流程和事件机制">spring-ApplicationContext启动流程和事件机制</span>
            <span class="post-date" title="2019-07-03 09:37:08">2019/07/03</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2019/06/26/Overview_Elasticsearch/"
           data-tag="framework,elasticsearch"
           data-author="" >
            <span class="post-title" title="Overview_Elasticsearch">Overview_Elasticsearch</span>
            <span class="post-date" title="2019-06-26 18:06:48">2019/06/26</span>
        </a>
        
        
        <a  class="全部文章 jdk "
           href="/2019/06/24/J-U-C-ConcurrentHashMap/"
           data-tag="juc,map"
           data-author="" >
            <span class="post-title" title="J.U.C_ConcurrentHashMap">J.U.C_ConcurrentHashMap</span>
            <span class="post-date" title="2019-06-24 19:03:29">2019/06/24</span>
        </a>
        
        
        <a  class="全部文章 java "
           href="/2019/06/19/JVM-Garbage-Collection/"
           data-tag="jvm,gc"
           data-author="" >
            <span class="post-title" title="JVM_Garbage Collection">JVM_Garbage Collection</span>
            <span class="post-date" title="2019-06-19 00:28:10">2019/06/19</span>
        </a>
        
        
        <a  class="全部文章 jdk "
           href="/2019/06/16/J-U-C-InterruptedException/"
           data-tag="juc"
           data-author="" >
            <span class="post-title" title="J.U.C_InterruptedException">J.U.C_InterruptedException</span>
            <span class="post-date" title="2019-06-16 16:09:43">2019/06/16</span>
        </a>
        
        
        <a  class="全部文章 java "
           href="/2019/06/14/Spec-JSR133/"
           data-tag="jvm,Spec,thread"
           data-author="" >
            <span class="post-title" title="Spec_JSR133">Spec_JSR133</span>
            <span class="post-date" title="2019-06-14 19:26:57">2019/06/14</span>
        </a>
        
        
        <a  class="全部文章 java "
           href="/2019/06/13/Spec-Java-Virtual-Machine/"
           data-tag="jvm,Spec"
           data-author="" >
            <span class="post-title" title="Spec_Java Virtual Machine">Spec_Java Virtual Machine</span>
            <span class="post-date" title="2019-06-13 17:25:17">2019/06/13</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2019/06/12/Overview_Kafka/"
           data-tag="framework,kafka"
           data-author="" >
            <span class="post-title" title="kafka深入浅出">kafka深入浅出</span>
            <span class="post-date" title="2019-06-12 20:05:37">2019/06/12</span>
        </a>
        
        
        <a  class="全部文章 redis "
           href="/2019/06/10/Overview_Redis/"
           data-tag="framework,redis"
           data-author="" >
            <span class="post-title" title="redis深入浅出">redis深入浅出</span>
            <span class="post-date" title="2019-06-10 18:33:40">2019/06/10</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2019/06/06/Note_java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%9A%84%E8%89%BA%E6%9C%AF/"
           data-tag="juc,java,note"
           data-author="" >
            <span class="post-title" title="Note_java并发编程的艺术">Note_java并发编程的艺术</span>
            <span class="post-date" title="2019-06-06 19:05:01">2019/06/06</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2019/06/05/Overview_Netty/"
           data-tag="nio,framework,netty"
           data-author="" >
            <span class="post-title" title="Netty深入浅出">Netty深入浅出</span>
            <span class="post-date" title="2019-06-05 22:01:31">2019/06/05</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2019/06/05/Note_%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/"
           data-tag="jvm,java,note"
           data-author="" >
            <span class="post-title" title="Note_深入理解java虚拟机">Note_深入理解java虚拟机</span>
            <span class="post-date" title="2019-06-05 21:12:25">2019/06/05</span>
        </a>
        
        
        <a  class="全部文章 mysql "
           href="/2019/06/04/Overview_MySQL/"
           data-tag="mysql"
           data-author="" >
            <span class="post-title" title="MySQL深入浅出">MySQL深入浅出</span>
            <span class="post-date" title="2019-06-04 22:02:31">2019/06/04</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2019/06/03/Overview_Zookeeper/"
           data-tag="distributed,framework,zookeeper"
           data-author="" >
            <span class="post-title" title="Zookeeper深入浅出">Zookeeper深入浅出</span>
            <span class="post-date" title="2019-06-03 21:15:05">2019/06/03</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2019/06/03/Overview_Distributed/"
           data-tag="distributed"
           data-author="" >
            <span class="post-title" title="分布式理论基础">分布式理论基础</span>
            <span class="post-date" title="2019-06-03 20:34:37">2019/06/03</span>
        </a>
        
        
        <a  class="全部文章 spring "
           href="/2019/04/10/spring-api-1-0/"
           data-tag="spring"
           data-author="" >
            <span class="post-title" title="spring-api-1.0">spring-api-1.0</span>
            <span class="post-date" title="2019-04-10 09:45:25">2019/04/10</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2019/04/01/3%E6%9C%88%E7%AC%AC%E5%9B%9B%E5%91%A8%E7%9F%A5%E8%AF%86%E7%82%B9%E8%AE%B0%E5%BD%95/"
           data-tag="week,hide"
           data-author="" >
            <span class="post-title" title="3月第四周知识点记录">3月第四周知识点记录</span>
            <span class="post-date" title="2019-04-01 09:51:07">2019/04/01</span>
        </a>
        
        
        <a  class="全部文章 mysql "
           href="/2019/03/30/%E8%AE%B0%E4%B8%80%E6%AC%A1mysql%E6%9F%A5%E8%AF%A2in%E7%9A%84%E6%80%9D%E8%80%83/"
           data-tag="mysql"
           data-author="" >
            <span class="post-title" title="记一次mysql查询in的思考">记一次mysql查询in的思考</span>
            <span class="post-date" title="2019-03-30 20:39:49">2019/03/30</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2019/03/26/%E8%AE%B0%E4%B8%80%E6%AC%A1Broken-pipe%E9%97%AE%E9%A2%98%E7%9A%84%E6%80%9D%E8%80%83/"
           data-tag="tomcat"
           data-author="" >
            <span class="post-title" title="记一次Broken pipe问题的思考">记一次Broken pipe问题的思考</span>
            <span class="post-date" title="2019-03-26 10:53:37">2019/03/26</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2019/03/24/3%E6%9C%88%E7%AC%AC%E4%B8%89%E5%91%A8%E7%9F%A5%E8%AF%86%E7%82%B9%E8%AE%B0%E5%BD%95/"
           data-tag="week,hide"
           data-author="" >
            <span class="post-title" title="3月第三周知识点记录">3月第三周知识点记录</span>
            <span class="post-date" title="2019-03-24 20:55:31">2019/03/24</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2019/03/10/Note_Expert%20One-on-One-J2EE-Development-without-EJB/"
           data-tag="spring,j2ee,ejb"
           data-author="" >
            <span class="post-title" title="Expert One-on-One J2EE Development without EJB">Expert One-on-One J2EE Development without EJB</span>
            <span class="post-date" title="2019-03-10 19:45:57">2019/03/10</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2019/03/10/Note_Expert-One-on-One-J2EE-Design-and-Development/"
           data-tag="spring,j2ee"
           data-author="" >
            <span class="post-title" title="Expert One-on-One J2EE Design and Development">Expert One-on-One J2EE Design and Development</span>
            <span class="post-date" title="2019-03-10 19:45:18">2019/03/10</span>
        </a>
        
        
        <a  class="全部文章 spring "
           href="/2019/03/03/spring-Core-Container%E9%A2%84%E8%A7%88/"
           data-tag="spring,ioc"
           data-author="" >
            <span class="post-title" title="spring-Core-Container预览">spring-Core-Container预览</span>
            <span class="post-date" title="2019-03-03 14:51:56">2019/03/03</span>
        </a>
        
        
        <a  class="全部文章 spring "
           href="/2019/02/03/spring-mvc/"
           data-tag="spring,servlet,spring-mvc,spring-webflux"
           data-author="" >
            <span class="post-title" title="servlet_spring-mvc">servlet_spring-mvc</span>
            <span class="post-date" title="2019-02-03 15:50:16">2019/02/03</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2019/02/03/Overview_Tomcat/"
           data-tag="servlet,tomcat"
           data-author="" >
            <span class="post-title" title="servlet_tomcat">servlet_tomcat</span>
            <span class="post-date" title="2019-02-03 15:49:08">2019/02/03</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2019/02/02/Spec_Servlet/"
           data-tag="j2ee,servlet"
           data-author="" >
            <span class="post-title" title="j2ee_servlet">j2ee_servlet</span>
            <span class="post-date" title="2019-02-02 18:05:54">2019/02/02</span>
        </a>
        
        <div id="no-item-tips">

        </div>
    </nav>
    <div id="outline-list">
    </div>
</div>

    </div>
    <div class="hide-list">
        <div class="semicircle" data-title="切换全屏 快捷键 s">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div id="post">
    <div class="pjax">
        <article id="post-spring-aop" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">spring-aop</h1>
    
    <div class="article-meta">
        
        
        
        <span class="book">
            <i class="iconfont icon-category"></i>
            
            
            <a  data-rel="spring">spring</a>
            
        </span>
        
        
        <span class="tag">
            <i class="iconfont icon-tag"></i>
            
            <a class="color2">spring</a>
            
            <a class="color4">aop</a>
            
        </span>
        
    </div>
    <div class="article-meta">
        
            发布时间 : <time class="date" title='最后更新: 2020-04-29 17:02:30'>2020-01-23 23:54</time>
        
    </div>
    <div class="article-meta">
        
        <span>字数:3.9k</span>
        
        
        <span id="busuanzi_container_page_pv">
            阅读 :<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#AOP-%E6%A6%82%E5%BF%B5%E3%80%81%E7%9B%AE%E6%A0%87"><span class="toc-text">AOP 概念、目标</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-text">是什么</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring%E4%B8%AD%E7%9A%84AOP"><span class="toc-text">Spring中的AOP</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Concepts-%E6%A6%82%E5%BF%B5"><span class="toc-text">Concepts(概念)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Aspect-%E5%88%87%E9%9D%A2"><span class="toc-text">Aspect (切面)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Join-point-%E8%BF%9E%E6%8E%A5%E7%82%B9"><span class="toc-text">Join point(连接点)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Advice-%E9%80%9A%E7%9F%A5"><span class="toc-text">Advice(通知)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Pointcut-%E5%88%87%E7%82%B9"><span class="toc-text">Pointcut(切点)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Target-object-%E7%9B%AE%E6%A0%87%E5%AF%B9%E8%B1%A1"><span class="toc-text">Target object(目标对象)</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AOP-proxy-AOP%E4%BB%A3%E7%90%86"><span class="toc-text">AOP proxy(AOP代理)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Weaving-%E7%BC%96%E7%BB%87"><span class="toc-text">Weaving(编织)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Capabilities-%E8%83%BD%E5%8A%9B"><span class="toc-text">Capabilities(能力)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#goals-%E7%9B%AE%E6%A0%87"><span class="toc-text">goals(目标)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Packages-overView-%E5%8C%85%E9%A2%84%E8%A7%88"><span class="toc-text">Packages overView(包预览)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AOP%E5%AE%9E%E7%8E%B0%E5%88%86%E6%9E%90"><span class="toc-text">AOP实现分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%B5%81%E7%A8%8B"><span class="toc-text">创建流程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E7%B1%BB%E9%A2%84%E8%A7%88"><span class="toc-text">核心类预览</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#AnnotationAwareAspectJAutoProxyCreator%E7%B1%BB%E5%9B%BE"><span class="toc-text">AnnotationAwareAspectJAutoProxyCreator类图</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ReflectiveAspectJAdvisorFactory%E7%B1%BB%E5%9B%BE"><span class="toc-text">ReflectiveAspectJAdvisorFactory类图</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#DefaultAopProxyFactory%E7%B1%BB%E5%9B%BE"><span class="toc-text">DefaultAopProxyFactory类图</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%B6%E5%BA%8F%E5%9B%BE%E5%8F%8A%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90"><span class="toc-text">时序图及源码分析</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#AnnotationAwareAspectJAutoProxyCreator%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B"><span class="toc-text">AnnotationAwareAspectJAutoProxyCreator执行流程</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#postProcessBeforeInstantiation"><span class="toc-text">#postProcessBeforeInstantiation</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#postProcessAfterInitialization"><span class="toc-text">#postProcessAfterInitialization</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Advisor%E5%88%9B%E5%BB%BA%E6%B5%81%E7%A8%8B"><span class="toc-text">Advisor创建流程</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Proxy%E5%88%9B%E5%BB%BA%E6%B5%81%E7%A8%8B"><span class="toc-text">Proxy创建流程</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B"><span class="toc-text">执行流程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E7%B1%BB%E9%A2%84%E8%A7%88-1"><span class="toc-text">核心类预览</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#JdkDynamicAopProxy%E7%B1%BB%E5%9B%BE"><span class="toc-text">JdkDynamicAopProxy类图</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ReflectiveMethodInvocation%E7%B1%BB%E5%9B%BE"><span class="toc-text">ReflectiveMethodInvocation类图</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#MethodInterceptor%E7%B1%BB%E5%9B%BE"><span class="toc-text">MethodInterceptor类图</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%B6%E5%BA%8F%E5%9B%BE%E5%8F%8A%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-1"><span class="toc-text">时序图及源码分析</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E7%A4%BA%E4%BE%8B"><span class="toc-text">简单示例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%87%E9%9D%A2%E7%B1%BB"><span class="toc-text">切面类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%AE%E6%A0%87%E5%AF%B9%E8%B1%A1%E6%8E%A5%E5%8F%A3"><span class="toc-text">目标对象接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%AE%E6%A0%87%E6%8E%A5%E5%8F%A3%E5%AE%9E%E7%8E%B0%E7%B1%BB"><span class="toc-text">目标接口实现类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E7%B1%BB"><span class="toc-text">启动类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E7%BB%93%E6%9E%9C"><span class="toc-text">执行结果</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">总结</span></a></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-4 i,
    .toc-level-4 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>先来看下提纲</p>
<ul>
<li>AOP 概念、目标</li>
<li>AOP实现分析、源码细节</li>
<li>示例</li>
<li>总结</li>
</ul>
<p>基于5.1.3.RELEASE分析</p>
<h2 id="AOP-概念、目标"><a href="#AOP-概念、目标" class="headerlink" title="AOP 概念、目标"></a>AOP 概念、目标</h2><h3 id="是什么"><a href="#是什么" class="headerlink" title="是什么"></a>是什么</h3><p>​	在软件业，AOP为Aspect Oriented Programming的缩写，意为：<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E9%9D%A2%E5%90%91%E5%88%87%E9%9D%A2%E7%BC%96%E7%A8%8B/6016335">面向切面编程</a>，通过<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E9%A2%84%E7%BC%96%E8%AF%91/3191547">预编译</a>方式和运行期间动态代理实现程序功能的统一维护的一种技术。</p>
<p>​	AOP是<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/OOP">OOP</a>的延续，是软件开发中的一个热点，也是<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/Spring">Spring</a>框架中的一个重要内容，是<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/4035031">函数式编程</a>的一种衍生范型。</p>
<p>​	利用AOP可以对业务逻辑的各个部分进行隔离，从而使得业务逻辑各部分之间的<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E8%80%A6%E5%90%88%E5%BA%A6/2603938">耦合度</a>降低，提高程序的可重用性，同时提高了开发的效率。(日志记录，性能统计，安全控制，事务处理，<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86">异常处理</a>等等)</p>
<p>(来源百度百科)</p>
<h3 id="Spring中的AOP"><a href="#Spring中的AOP" class="headerlink" title="Spring中的AOP"></a>Spring中的AOP</h3><p>参考官网文档简单翻译一下</p>
<h4 id="Concepts-概念"><a href="#Concepts-概念" class="headerlink" title="Concepts(概念)"></a>Concepts(概念)</h4><p>先来了解下涉及的相关概念</p>
<h5 id="Aspect-切面"><a href="#Aspect-切面" class="headerlink" title="Aspect (切面)"></a>Aspect (切面)</h5><p>​	关注点的模块化，跨多个类。事务管理是企业Java应用程序中横切关注的一个很好的例子。在Spring AOP中，切面是通过使用类(xml配置)或使用带有@Aspect注解的类来实现的。(通常是一个功能,一个类)</p>
<h5 id="Join-point-连接点"><a href="#Join-point-连接点" class="headerlink" title="Join point(连接点)"></a>Join point(连接点)</h5><p>​	程序执行过程中的一个点，例如方法的执行或异常的处理。在Spring AOP中，切点始终代表方法的执行。(通常为需要拦截的方法)</p>
<h5 id="Advice-通知"><a href="#Advice-通知" class="headerlink" title="Advice(通知)"></a>Advice(通知)</h5><p>​	在连接点的行为, 可以简单认为是拦截器.</p>
<p>拦截类型</p>
<ul>
<li>Before advice 执行前拦截</li>
<li>After returning advice 执行后拦截</li>
<li>After throwing advice 异常时拦截</li>
<li>After (finally) advice	返回前最终拦截</li>
<li>Around advice	自定义拦截</li>
</ul>
<h5 id="Pointcut-切点"><a href="#Pointcut-切点" class="headerlink" title="Pointcut(切点)"></a>Pointcut(切点)</h5><p>​	简单理解为一个集合体(连接点的), 通知是面向切点,看代码好理解点</p>
<pre><code class="java">@Pointcut(value=&quot;execution(* aop.ServerImpl.*(..))&quot;)
private void pointCut()&#123;&#125;

@Before(value=&quot;pointCut()&quot;)
public void before(JoinPoint joinPoint)&#123;
  System.out.println(&quot;@Before前置通知:&quot;+ Arrays.toString(joinPoint.getArgs()));
&#125;
</code></pre>
<h5 id="Target-object-目标对象"><a href="#Target-object-目标对象" class="headerlink" title="Target object(目标对象)"></a>Target object(目标对象)</h5><p>​	连接点(需要拦截的)方法所在的类</p>
<h4 id="AOP-proxy-AOP代理"><a href="#AOP-proxy-AOP代理" class="headerlink" title="AOP proxy(AOP代理)"></a>AOP proxy(AOP代理)</h4><p>​	一个对象用于实现切面的功能(代理),在spring 中通常有两种呢实现JDK代理和CGLIB代理</p>
<h4 id="Weaving-编织"><a href="#Weaving-编织" class="headerlink" title="Weaving(编织)"></a>Weaving(编织)</h4><p>​	完成通知(advice)和连接点(Join point)的编织, 这个动作可以在编译期(AspectJ compiler)、加载期(类加载)、运行时. SpringAOP的实现是通过动态代理的方式(运行时)</p>
<h3 id="Capabilities-能力"><a href="#Capabilities-能力" class="headerlink" title="Capabilities(能力)"></a>Capabilities(能力)</h3><blockquote>
<p>Spring AOP currently supports only method execution join points (advising the execution of methods on Spring beans). </p>
<p>Field interception is not implemented, although support for field interception could be added without breaking the core Spring AOP APIs. </p>
<p>If you need to advise field access and update join points, consider a language such as AspectJ.</p>
</blockquote>
<p>spring AOP的粒度只支持方法级别,不支持字段级别(如果需要使用AspectJ)</p>
<h3 id="goals-目标"><a href="#goals-目标" class="headerlink" title="goals(目标)"></a>goals(目标)</h3><blockquote>
<p>Spring AOP’s approach to AOP differs from that of most other AOP frameworks. </p>
<p>The aim is not to provide the most complete AOP implementation (although Spring AOP is quite capable).</p>
<p>Rather, the aim is to provide a close integration between AOP implementation and Spring IoC, to help solve common problems in enterprise applications.</p>
</blockquote>
<p>目的不是提供最完整的AOP实现（尽管Spring AOP相当强大）。</p>
<p>相反，其目的是在AOP实现和Spring IoC之间提供紧密的集成，以帮助解决企业应用程序中的常见问题。(OOP的补充)</p>
<h3 id="Packages-overView-包预览"><a href="#Packages-overView-包预览" class="headerlink" title="Packages overView(包预览)"></a>Packages overView(包预览)</h3><table>
<thead>
<tr>
<th>Package</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.2.x/javadoc-api/org/aopalliance/aop/package-summary.html">org.aopalliance.aop</a></td>
<td>The core AOP Alliance advice marker.</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.2.x/javadoc-api/org/aopalliance/intercept/package-summary.html">org.aopalliance.intercept</a></td>
<td>The AOP Alliance reflective interception abstraction.</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.2.x/javadoc-api/org/springframework/aop/package-summary.html">org.springframework.aop</a></td>
<td>Core Spring AOP interfaces, built on AOP Alliance AOP interoperability interfaces.</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.2.x/javadoc-api/org/springframework/aop/aspectj/package-summary.html">org.springframework.aop.aspectj</a></td>
<td>AspectJ integration package.</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.2.x/javadoc-api/org/springframework/aop/aspectj/annotation/package-summary.html">org.springframework.aop.aspectj.annotation</a></td>
<td>Classes enabling AspectJ 5 @Annotated classes to be used in Spring AOP.</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.2.x/javadoc-api/org/springframework/aop/aspectj/autoproxy/package-summary.html">org.springframework.aop.aspectj.autoproxy</a></td>
<td>Base classes enabling auto-proxying based on AspectJ.</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.2.x/javadoc-api/org/springframework/aop/config/package-summary.html">org.springframework.aop.config</a></td>
<td>Support package for declarative AOP configuration, with XML schema being the primary configuration format.</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.2.x/javadoc-api/org/springframework/aop/framework/package-summary.html">org.springframework.aop.framework</a></td>
<td>Package containing Spring’s basic AOP infrastructure, compliant with the <a target="_blank" rel="noopener" href="http://aopalliance.sourceforge.net/">AOP Alliance</a> interfaces.</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.2.x/javadoc-api/org/springframework/aop/framework/adapter/package-summary.html">org.springframework.aop.framework.adapter</a></td>
<td>SPI package allowing Spring AOP framework to handle arbitrary advice types.</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.2.x/javadoc-api/org/springframework/aop/framework/autoproxy/package-summary.html">org.springframework.aop.framework.autoproxy</a></td>
<td>Bean post-processors for use in ApplicationContexts to simplify AOP usage by automatically creating AOP proxies without the need to use a ProxyFactoryBean.</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.2.x/javadoc-api/org/springframework/aop/framework/autoproxy/target/package-summary.html">org.springframework.aop.framework.autoproxy.target</a></td>
<td></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.2.x/javadoc-api/org/springframework/aop/interceptor/package-summary.html">org.springframework.aop.interceptor</a></td>
<td>Provides miscellaneous interceptor implementations.</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.2.x/javadoc-api/org/springframework/aop/scope/package-summary.html">org.springframework.aop.scope</a></td>
<td>Support for AOP-based scoping of target objects, with configurable backend.</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.2.x/javadoc-api/org/springframework/aop/support/package-summary.html">org.springframework.aop.support</a></td>
<td>Convenience classes for using Spring’s AOP API.</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.2.x/javadoc-api/org/springframework/aop/support/annotation/package-summary.html">org.springframework.aop.support.annotation</a></td>
<td>Annotation support for AOP pointcuts.</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.2.x/javadoc-api/org/springframework/aop/target/package-summary.html">org.springframework.aop.target</a></td>
<td></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.2.x/javadoc-api/org/springframework/aop/target/dynamic/package-summary.html">org.springframework.aop.target.dynamic</a></td>
<td></td>
</tr>
</tbody></table>
<h2 id="AOP实现分析"><a href="#AOP实现分析" class="headerlink" title="AOP实现分析"></a>AOP实现分析</h2><p>​	接下来我们来看下AOP在Spring 中是怎么实现的,我们简单分为两个方面,创建和执行</p>
<h3 id="创建流程"><a href="#创建流程" class="headerlink" title="创建流程"></a>创建流程</h3><p>​	根据之前BeanFactory的分析, 我们都知道bean的创建流程. Spring AOP的实现就是通过Bean的后置通知实现的, 而在核心类 AnnotationAwareAspectJAutoProxyCreator中,它又把advisor和proxy的创建委派给其他类(ReflectiveAspectJAdvisorFactory,DefaultAopProxyFactory)</p>
<h4 id="核心类预览"><a href="#核心类预览" class="headerlink" title="核心类预览"></a>核心类预览</h4><h5 id="AnnotationAwareAspectJAutoProxyCreator类图"><a href="#AnnotationAwareAspectJAutoProxyCreator类图" class="headerlink" title="AnnotationAwareAspectJAutoProxyCreator类图"></a>AnnotationAwareAspectJAutoProxyCreator类图</h5><p><img src="http://tva1.sinaimg.cn/large/006tNbRwgy1gb6xobu7vuj31ou0r2wje.jpg" alt="image-20200123210402304"></p>
<p>需要关注的方法</p>
<ul>
<li>AbstractAutoProxyCreator#wrapIfNecessary (判断是否需要包装)</li>
<li>AbstractAutoProxyCreator#getAdvicesAndAdvisorsForBean (获取通知(advices),包装为advisors)</li>
<li>AbstractAutoProxyCreator#createProxy(编织,创建代理类)</li>
</ul>
<h5 id="ReflectiveAspectJAdvisorFactory类图"><a href="#ReflectiveAspectJAdvisorFactory类图" class="headerlink" title="ReflectiveAspectJAdvisorFactory类图"></a>ReflectiveAspectJAdvisorFactory类图</h5><p><img src="http://tva1.sinaimg.cn/large/006tNbRwgy1gb6xoc6icqj31ou0r2wje.jpg" alt="image-20200123211728249"></p>
<p>AspectJAdvisorFactory相关源码如下</p>
<pre><code class="java">/**
 * Interface for factories that can create Spring AOP Advisors from classes
 * annotated with AspectJ annotation syntax.
 *
 * @author Rod Johnson
 * @author Juergen Hoeller
 * @since 2.0
 * @see AspectMetadata
 * @see org.aspectj.lang.reflect.AjTypeSystem
 */
public interface AspectJAdvisorFactory &#123;

   boolean isAspect(Class&lt;?&gt; clazz);

   void validate(Class&lt;?&gt; aspectClass) throws AopConfigException;

   List&lt;Advisor&gt; getAdvisors(MetadataAwareAspectInstanceFactory aspectInstanceFactory);

   @Nullable
   Advisor getAdvisor(Method candidateAdviceMethod, MetadataAwareAspectInstanceFactory aspectInstanceFactory,int declarationOrder, String aspectName);

   /**
    * Build a Spring AOP Advice for the given AspectJ advice method.
    * @param candidateAdviceMethod the candidate advice method
    * @param expressionPointcut the AspectJ expression pointcut
    * @param aspectInstanceFactory the aspect instance factory
    * @param declarationOrder the declaration order within the aspect
    * @param aspectName the name of the aspect
    * @return &#123;@code null&#125; if the method is not an AspectJ advice method
    * or if it is a pointcut that will be used by other advice but will not
    * create a Spring advice in its own right
    * @see org.springframework.aop.aspectj.AspectJAroundAdvice
    * @see org.springframework.aop.aspectj.AspectJMethodBeforeAdvice
    * @see org.springframework.aop.aspectj.AspectJAfterAdvice
    * @see org.springframework.aop.aspectj.AspectJAfterReturningAdvice
    * @see org.springframework.aop.aspectj.AspectJAfterThrowingAdvice
    */
   @Nullable
   Advice getAdvice(Method candidateAdviceMethod, AspectJExpressionPointcut expressionPointcut,MetadataAwareAspectInstanceFactory aspectInstanceFactory, int declarationOrder, String aspectName);

&#125;
</code></pre>
<h5 id="DefaultAopProxyFactory类图"><a href="#DefaultAopProxyFactory类图" class="headerlink" title="DefaultAopProxyFactory类图"></a>DefaultAopProxyFactory类图</h5><p><img src="http://tva1.sinaimg.cn/large/006tNbRwgy1gb6xofqnwfj30zu08a0tm.jpg" alt="image-20200123212809125"></p>
<p>AopProxyFactory base on org.springframework.aop.framework.AdvisedSupport</p>
<pre><code class="java">public interface AopProxyFactory &#123;

   /**
    * Create an &#123;@link AopProxy&#125; for the given AOP configuration.
    * @param config the AOP configuration in the form of an
    * AdvisedSupport object
    * @return the corresponding AOP proxy
    * @throws AopConfigException if the configuration is invalid
    */
   AopProxy createAopProxy(AdvisedSupport config) throws AopConfigException;

&#125;
</code></pre>
<h4 id="时序图及源码分析"><a href="#时序图及源码分析" class="headerlink" title="时序图及源码分析"></a>时序图及源码分析</h4><p>我们可以创建流程分为3部分,回调类,advisor创建,代理类创建</p>
<p><img src="http://tva1.sinaimg.cn/large/006tNbRwgy1gb6xof16exj32080o60zy.jpg" alt="image-20200123220926562"></p>
<h5 id="AnnotationAwareAspectJAutoProxyCreator执行流程"><a href="#AnnotationAwareAspectJAutoProxyCreator执行流程" class="headerlink" title="AnnotationAwareAspectJAutoProxyCreator执行流程"></a>AnnotationAwareAspectJAutoProxyCreator执行流程</h5><p>入口是AbstractAutoProxyCreator</p>
<p>因为实现了SmartInstantiationAwareBeanPostProcessor ,所以重写了两个方法</p>
<h6 id="postProcessBeforeInstantiation"><a href="#postProcessBeforeInstantiation" class="headerlink" title="#postProcessBeforeInstantiation"></a>#postProcessBeforeInstantiation</h6><p>在AspectJAwareAdvisorAutoProxyCreator#shouldSkip方法中初始化了advisor</p>
<pre><code class="java">@Override
protected boolean shouldSkip(Class&lt;?&gt; beanClass, String beanName) &#123;
   // TODO: Consider optimization by caching the list of the aspect names
   List&lt;Advisor&gt; candidateAdvisors = findCandidateAdvisors();
   for (Advisor advisor : candidateAdvisors) &#123;
      if (advisor instanceof AspectJPointcutAdvisor &amp;&amp;
            ((AspectJPointcutAdvisor) advisor).getAspectName().equals(beanName)) &#123;
         return true;
      &#125;
   &#125;
   return super.shouldSkip(beanClass, beanName);
&#125;
</code></pre>
<p>在AnnotationAwareAspectJAutoProxyCreator#findCandidateAdvisors中的调用就到了advisor的创建流程</p>
<h6 id="postProcessAfterInitialization"><a href="#postProcessAfterInitialization" class="headerlink" title="#postProcessAfterInitialization"></a>#postProcessAfterInitialization</h6><p>返回代理对象</p>
<pre><code class="java">    /**
     * Create a proxy with the configured interceptors if the bean is
     * identified as one to proxy by the subclass.
     * @see #getAdvicesAndAdvisorsForBean
     */
    @Override
    public Object postProcessAfterInitialization(@Nullable Object bean, String beanName) &#123;
        if (bean != null) &#123;
            Object cacheKey = getCacheKey(bean.getClass(), beanName);
            if (!this.earlyProxyReferences.contains(cacheKey)) &#123;
                return wrapIfNecessary(bean, beanName, cacheKey);
            &#125;
        &#125;
        return bean;
    &#125;
    
  protected Object wrapIfNecessary(Object bean, String beanName, Object cacheKey) &#123;
     if (StringUtils.hasLength(beanName) &amp;&amp; this.targetSourcedBeans.contains(beanName)) &#123;
        return bean;
     &#125;
     if (Boolean.FALSE.equals(this.advisedBeans.get(cacheKey))) &#123;
        return bean;
     &#125;
     if (isInfrastructureClass(bean.getClass()) || shouldSkip(bean.getClass(), beanName)) &#123;
        this.advisedBeans.put(cacheKey, Boolean.FALSE);
        return bean;
     &#125;

     // Create proxy if we have advice. 如果有adive创建代理
     Object[] specificInterceptors = getAdvicesAndAdvisorsForBean(bean.getClass(), beanName, null);
     if (specificInterceptors != DO_NOT_PROXY) &#123;
        this.advisedBeans.put(cacheKey, Boolean.TRUE);
        Object proxy = createProxy(
              bean.getClass(), beanName, specificInterceptors, new SingletonTargetSource(bean));
        this.proxyTypes.put(cacheKey, proxy.getClass());
        return proxy;
     &#125;

     this.advisedBeans.put(cacheKey, Boolean.FALSE);
     return bean;
  &#125;
</code></pre>
<p>​	上面的方法简单来说做了一些判断, 主要是获取advice,并创建代理</p>
<h5 id="Advisor创建流程"><a href="#Advisor创建流程" class="headerlink" title="Advisor创建流程"></a>Advisor创建流程</h5><p>BeanFactoryAspectJAdvisorsBuilder#buildAspectJAdvisors</p>
<pre><code class="java">/**
 * Look for AspectJ-annotated aspect beans in the current bean factory,
 * and return to a list of Spring AOP Advisors representing them.
 * &lt;p&gt;Creates a Spring Advisor for each AspectJ advice method.
 * @return the list of &#123;@link org.springframework.aop.Advisor&#125; beans
 * @see #isEligibleBean
 */
public List&lt;Advisor&gt; buildAspectJAdvisors() &#123;
   List&lt;String&gt; aspectNames = this.aspectBeanNames;
   //初次创建aspectNames为null,否则从缓存中获取
   if (aspectNames == null) &#123;
     //double check
      synchronized (this) &#123;
         aspectNames = this.aspectBeanNames;
         if (aspectNames == null) &#123;
            List&lt;Advisor&gt; advisors = new ArrayList&lt;&gt;();
            aspectNames = new ArrayList&lt;&gt;();
            String[] beanNames = BeanFactoryUtils.beanNamesForTypeIncludingAncestors(
                  this.beanFactory, Object.class, true, false);
            //遍历查找所有bean
            for (String beanName : beanNames) &#123;
               if (!isEligibleBean(beanName)) &#123;
                  continue;
               &#125;
               // We must be careful not to instantiate beans eagerly as in this case they
               // would be cached by the Spring container but would not have been weaved.
               Class&lt;?&gt; beanType = this.beanFactory.getType(beanName);
               if (beanType == null) &#123;
                  continue;
               &#125;
               //是否是Aspect的类(带了@Aspect注解)
               if (this.advisorFactory.isAspect(beanType)) &#123;
                  aspectNames.add(beanName);
                  AspectMetadata amd = new AspectMetadata(beanType, beanName);
                  if (amd.getAjType().getPerClause().getKind() == PerClauseKind.SINGLETON) &#123;
                     MetadataAwareAspectInstanceFactory factory =
                           new BeanFactoryAspectInstanceFactory(this.beanFactory, beanName);
                    //获取advice的包装类advisors,并放置在缓存中 
                    List&lt;Advisor&gt; classAdvisors = this.advisorFactory.getAdvisors(factory);
                     if (this.beanFactory.isSingleton(beanName)) &#123;
                        this.advisorsCache.put(beanName, classAdvisors);
                     &#125;else &#123;
                        this.aspectFactoryCache.put(beanName, factory);
                     &#125;
                     advisors.addAll(classAdvisors);
                  &#125;
                  else &#123;
                     // Per target or per this.
                     if (this.beanFactory.isSingleton(beanName)) &#123;
                        throw new IllegalArgumentException(&quot;Bean with name &#39;&quot; + beanName +
                              &quot;&#39; is a singleton, but aspect instantiation model is not singleton&quot;);
                     &#125;
                     MetadataAwareAspectInstanceFactory factory =
                           new PrototypeAspectInstanceFactory(this.beanFactory, beanName);
                     this.aspectFactoryCache.put(beanName, factory);
                     advisors.addAll(this.advisorFactory.getAdvisors(factory));
                  &#125;
               &#125;
            &#125;
            this.aspectBeanNames = aspectNames;
            return advisors;
         &#125;
      &#125;
   &#125;

  //从缓存中获取
  ...
   return advisors;
&#125;
</code></pre>
<p>遍历beanFactory,找出切面(Aspect)类,获取通知(advice)的包装类(advisors)</p>
<p>ReflectiveAspectJAdvisorFactory#getAdvisors</p>
<pre><code class="java">  public List&lt;Advisor&gt; getAdvisors(MetadataAwareAspectInstanceFactory aspectInstanceFactory) &#123;
     Class&lt;?&gt; aspectClass = aspectInstanceFactory.getAspectMetadata().getAspectClass();
     String aspectName = aspectInstanceFactory.getAspectMetadata().getAspectName();
     validate(aspectClass);

     // We need to wrap the MetadataAwareAspectInstanceFactory with a decorator
     // so that it will only instantiate once.
     MetadataAwareAspectInstanceFactory lazySingletonAspectInstanceFactory =
           new LazySingletonAspectInstanceFactoryDecorator(aspectInstanceFactory);

     List&lt;Advisor&gt; advisors = new ArrayList&lt;&gt;();
     for (Method method : getAdvisorMethods(aspectClass)) &#123;
        Advisor advisor = getAdvisor(method, lazySingletonAspectInstanceFactory, advisors.size(), aspectName);
        if (advisor != null) &#123; advisors.add(advisor); &#125;
     &#125;
     // If it&#39;s a per target aspect, emit the dummy instantiating aspect.
     ...
     // Find introduction fields.
     ...
     return advisors;
  &#125;

    private List&lt;Method&gt; getAdvisorMethods(Class&lt;?&gt; aspectClass) &#123;
        final List&lt;Method&gt; methods = new ArrayList&lt;&gt;();
        ReflectionUtils.doWithMethods(aspectClass, method -&gt; &#123;
            // Exclude pointcuts
            if (AnnotationUtils.getAnnotation(method, Pointcut.class) == null) &#123;
                methods.add(method);
            &#125;
        &#125;);
        methods.sort(METHOD_COMPARATOR);
        return methods;
    &#125;

    @Override
    @Nullable
    public Advisor getAdvisor(Method candidateAdviceMethod, MetadataAwareAspectInstanceFactory aspectInstanceFactory,
            int declarationOrderInAspect, String aspectName) &#123;

        validate(aspectInstanceFactory.getAspectMetadata().getAspectClass());

        AspectJExpressionPointcut expressionPointcut = getPointcut(
                candidateAdviceMethod, aspectInstanceFactory.getAspectMetadata().getAspectClass());
        if (expressionPointcut == null) &#123;
            return null;
        &#125;

        return new InstantiationModelAwarePointcutAdvisorImpl(expressionPointcut, candidateAdviceMethod,
                this, aspectInstanceFactory, declarationOrderInAspect, aspectName);
    &#125;
</code></pre>
<p>​	所以我们可以知道Advisor 对应的类为InstantiationModelAwarePointcutAdvisorImpl</p>
<p>另外, 这里会有个细节就是顺序(影响后续的调用链chain的执行顺序),在getAdvisorMethods中</p>
<pre><code class="java">private static final Comparator&lt;Method&gt; METHOD_COMPARATOR;

static &#123;
   Comparator&lt;Method&gt; adviceKindComparator = new ConvertingComparator&lt;&gt;(
         new InstanceComparator&lt;&gt;(
               Around.class, Before.class, After.class, AfterReturning.class, AfterThrowing.class),
         (Converter&lt;Method, Annotation&gt;) method -&gt; &#123;
            AspectJAnnotation&lt;?&gt; annotation =
               AbstractAspectJAdvisorFactory.findAspectJAnnotationOnMethod(method);
            return (annotation != null ? annotation.getAnnotation() : null);
         &#125;);
   Comparator&lt;Method&gt; methodNameComparator = new ConvertingComparator&lt;&gt;(Method::getName);
   METHOD_COMPARATOR = adviceKindComparator.thenComparing(methodNameComparator);
&#125;
</code></pre>
<p>​	按照如下顺序 Around.class, Before.class, After.class, AfterReturning.class, AfterThrowing.class 排序(从小到大),而在 AbstractAdvisorAutoProxyCreator#sortAdvisors 中会对所有通知(advice) 根据Order 再次排序(从大到小)</p>
<h5 id="Proxy创建流程"><a href="#Proxy创建流程" class="headerlink" title="Proxy创建流程"></a>Proxy创建流程</h5><p>在DefaultAopProxyFactory中</p>
<pre><code class="java">package org.springframework.aop.framework;
import java.io.Serializable;
import java.lang.reflect.Proxy;
import org.springframework.aop.SpringProxy;

/**
 * Default &#123;@link AopProxyFactory&#125; implementation, creating either a CGLIB proxy
 * or a JDK dynamic proxy.
 *
 * &lt;p&gt;Creates a CGLIB proxy if one the following is true for a given
 * &#123;@link AdvisedSupport&#125; instance:
 * &lt;ul&gt;
 * &lt;li&gt;the &#123;@code optimize&#125; flag is set
 * &lt;li&gt;the &#123;@code proxyTargetClass&#125; flag is set
 * &lt;li&gt;no proxy interfaces have been specified
 * &lt;/ul&gt;
 *
 * &lt;p&gt;In general, specify &#123;@code proxyTargetClass&#125; to enforce a CGLIB proxy,
 * or specify one or more interfaces to use a JDK dynamic proxy.
 *
 * @author Rod Johnson
 * @author Juergen Hoeller
 * @since 12.03.2004
 * @see AdvisedSupport#setOptimize
 * @see AdvisedSupport#setProxyTargetClass
 * @see AdvisedSupport#setInterfaces
 */
@SuppressWarnings(&quot;serial&quot;)
public class DefaultAopProxyFactory implements AopProxyFactory, Serializable &#123;

   @Override
   public AopProxy createAopProxy(AdvisedSupport config) throws AopConfigException &#123;
      if (config.isOptimize() || config.isProxyTargetClass() || hasNoUserSuppliedProxyInterfaces(config)) &#123;
         Class&lt;?&gt; targetClass = config.getTargetClass();
         if (targetClass == null) &#123;
            throw new AopConfigException(&quot;TargetSource cannot determine target class: &quot; +
                  &quot;Either an interface or a target is required for proxy creation.&quot;);
         &#125;
         if (targetClass.isInterface() || Proxy.isProxyClass(targetClass)) &#123;
            return new JdkDynamicAopProxy(config);
         &#125;
         return new ObjenesisCglibAopProxy(config);
      &#125;
      else &#123;
         return new JdkDynamicAopProxy(config);
      &#125;
   &#125;

   /**
    * Determine whether the supplied &#123;@link AdvisedSupport&#125; has only the
    * &#123;@link org.springframework.aop.SpringProxy&#125; interface specified
    * (or no proxy interfaces specified at all).
    */
   private boolean hasNoUserSuppliedProxyInterfaces(AdvisedSupport config) &#123;
      Class&lt;?&gt;[] ifcs = config.getProxiedInterfaces();
      return (ifcs.length == 0 || 
              (ifcs.length == 1 &amp;&amp; SpringProxy.class.isAssignableFrom(ifcs[0])));
   &#125;

&#125;
</code></pre>
<p>三种情况下使用cglib(默认使用jdk)</p>
<ul>
<li>the {@code optimize} flag is set</li>
<li>the {@code proxyTargetClass} flag is set</li>
<li>no proxy interfaces have been specified</li>
</ul>
<p>其中当targetClass 为接口或者是代理类时,使用jdk代理</p>
<h3 id="执行流程"><a href="#执行流程" class="headerlink" title="执行流程"></a>执行流程</h3><p>注意这里,执行流程是按照代码分析的</p>
<h4 id="核心类预览-1"><a href="#核心类预览-1" class="headerlink" title="核心类预览"></a>核心类预览</h4><h5 id="JdkDynamicAopProxy类图"><a href="#JdkDynamicAopProxy类图" class="headerlink" title="JdkDynamicAopProxy类图"></a>JdkDynamicAopProxy类图</h5><img src="http://tva1.sinaimg.cn/large/006tNbRwgy1gb6wu5onp8j30uk0acgmf.jpg" alt="image-20200123232546312" style="zoom:50%;" />

<h5 id="ReflectiveMethodInvocation类图"><a href="#ReflectiveMethodInvocation类图" class="headerlink" title="ReflectiveMethodInvocation类图"></a>ReflectiveMethodInvocation类图</h5><img src="http://tva1.sinaimg.cn/large/006tNbRwgy1gb6wusrs3wj30n00ncq4e.jpg" alt="image-20200123232624501" style="zoom:50%;" />



<h5 id="MethodInterceptor类图"><a href="#MethodInterceptor类图" class="headerlink" title="MethodInterceptor类图"></a>MethodInterceptor类图</h5><p><img src="http://tva1.sinaimg.cn/large/006tNbRwgy1gb6xocz27pj31im0gyq6c.jpg" alt="image-20200123233448201"></p>
<h4 id="时序图及源码分析-1"><a href="#时序图及源码分析-1" class="headerlink" title="时序图及源码分析"></a>时序图及源码分析</h4><p> 整个时序图流程非常简单, 首先JdkDynamicAopProxy 实现invoke,之后执行chain 调用链</p>
<p><img src="http://tva1.sinaimg.cn/large/006tNbRwgy1gb6xodbywlj314c0u0798.jpg" alt="image-20200123231701249"></p>
<p>JdkDynamicAopProxy 实现了InvocationHandler(代理实现需要), 重写了invoke方法</p>
<pre><code class="java">    /**
     * Implementation of &#123;@code InvocationHandler.invoke&#125;.
     * &lt;p&gt;Callers will see exactly the exception thrown by the target,
     * unless a hook method throws an exception.
     */
    @Override
    @Nullable
    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123;
        // Get the interception chain for this method.
            List&lt;Object&gt; chain = this.advised.getInterceptorsAndDynamicInterceptionAdvice(method, targetClass);
            // Check whether we have any advice. If we don&#39;t, we can fallback on direct
            // reflective invocation of the target, and avoid creating a MethodInvocation.
            if (chain.isEmpty()) &#123;
                // We can skip creating a MethodInvocation: just invoke the target directly
                // Note that the final invoker must be an InvokerInterceptor so we know it does
                // nothing but a reflective operation on the target, and no hot swapping or fancy proxying.
                Object[] argsToUse = AopProxyUtils.adaptArgumentsIfNecessary(method, args);
                retVal = AopUtils.invokeJoinpointUsingReflection(target, method, argsToUse);
            &#125;
            else &#123;
                // We need to create a method invocation...
                invocation = new ReflectiveMethodInvocation(proxy, target, method, args, targetClass, chain);
                // Proceed to the joinpoint through the interceptor chain.
                retVal = invocation.proceed();
            &#125;
        //...
    &#125;
</code></pre>
<p>​	可以发现只是简单的取出调用链,并将实际操作委派给ReflectiveMethodInvocation ,注意这里根据join PointCut,去匹配命中的方法, 找出对应的调用链</p>
<p><strong>ReflectiveMethodInvocation</strong></p>
<pre><code class="java">@Override
@Nullable
public Object proceed() throws Throwable &#123;
   // We start with an index of -1 and increment early.
   if (this.currentInterceptorIndex == this.interceptorsAndDynamicMethodMatchers.size() - 1) &#123;
      return invokeJoinpoint();
   &#125;

   Object interceptorOrInterceptionAdvice =
         this.interceptorsAndDynamicMethodMatchers.get(++this.currentInterceptorIndex);
   if (interceptorOrInterceptionAdvice instanceof InterceptorAndDynamicMethodMatcher) &#123;
      // Evaluate dynamic method matcher here: static part will already have
      // been evaluated and found to match.
      InterceptorAndDynamicMethodMatcher dm =
            (InterceptorAndDynamicMethodMatcher) interceptorOrInterceptionAdvice;
      Class&lt;?&gt; targetClass = (this.targetClass != null ? this.targetClass : this.method.getDeclaringClass());
      if (dm.methodMatcher.matches(this.method, targetClass, this.arguments)) &#123;
         return dm.interceptor.invoke(this);
      &#125;
      else &#123;
         // Dynamic matching failed.
         // Skip this interceptor and invoke the next in the chain.
         return proceed();
      &#125;
   &#125;
   else &#123;
      // It&#39;s an interceptor, so we just invoke it: The pointcut will have
      // been evaluated statically before this object was constructed.
      return ((MethodInterceptor) interceptorOrInterceptionAdvice).invoke(this);
   &#125;
&#125;
</code></pre>
<p>依次执行dvice,即切面中的各个通知, 通过反射实现方法调用,实例是通过工厂方法创建LazySingletonAspectInstanceFactoryDecorator</p>
<p>org.springframework.aop.interceptor.ExposeInvocationInterceptor</p>
<p>org.springframework.aop.aspectj.AspectJAfterThrowingAdvice</p>
<p>org.springframework.aop.aspectj.AspectJAfterAdvice</p>
<p>org.springframework.aop.aspectj.AspectJMethodBeforeAdvice</p>
<p>最后用反射调用方法</p>
<h2 id="简单示例"><a href="#简单示例" class="headerlink" title="简单示例"></a>简单示例</h2><h4 id="切面类"><a href="#切面类" class="headerlink" title="切面类"></a>切面类</h4><p>注意这里为了简单,所以只写了三个通知(advice)</p>
<pre><code class="java">package aop;
import org.aspectj.lang.JoinPoint;
import org.aspectj.lang.ProceedingJoinPoint;
import org.aspectj.lang.annotation.*;
import org.springframework.context.annotation.EnableAspectJAutoProxy;
import org.springframework.stereotype.Component;
import java.util.Arrays;

/**
 * @author zhengyumin
 * @description 切面demo
 * @date 2020-01-22 9:46 PM
 * EnableAspectJAutoProxy 等同于xml中 &lt;aop:aspectj-autoproxy&gt;
 * proxyTargetClass为true时 开启cglib(比较规范是写在一个配置类里)
 */
@Aspect
@Component
@EnableAspectJAutoProxy(proxyTargetClass = false)
public class AspectInterceptor &#123;
    @Pointcut(value=&quot;execution(* aop.ServerImpl.*(..))&quot;)
    private void pointCut()&#123;
        //定义一个切入点 后面的通知直接引入切入点方法pointCut即可
        // ServerImpl下面的所有方法
    &#125;
    /**
     * 前置通知（进入环绕后执行，下一步执行方法）
     * @param joinPoint
     */
    @Before(value=&quot;pointCut()&quot;)
    public void before(JoinPoint joinPoint)&#123;
        System.out.println(&quot;@Before前置通知:&quot;+ Arrays.toString(joinPoint.getArgs()));
    &#125;

    /**
     * 异常通知（出错时执行）
     * @param joinPoint
     * @param ex
     */
    @AfterThrowing(value=&quot;pointCut()&quot;,throwing=&quot;ex&quot;)
    public void doAfterThrow(JoinPoint joinPoint,Throwable ex)&#123;
        System.out.println(&quot;@AfterThrowing例外通知(异常通知)&quot;+Arrays.toString(joinPoint.getArgs()));
        System.out.println(&quot;@AfterThrowing异常信息：&quot;+ex);
    &#125;

    /**
     * 后置通知(返回之前执行)
     */
    @After(value=&quot;pointCut()&quot;)
    public void after()&#123;
        System.out.println(&quot;@After后置通知...&quot;);
    &#125;

&#125;
</code></pre>
<h4 id="目标对象接口"><a href="#目标对象接口" class="headerlink" title="目标对象接口"></a>目标对象接口</h4><pre><code class="java">/**
 * @author zhengyumin
 * @description target Object
 * @date 2020-01-22 9:52 PM
 */
public interface Server &#123;
     void doSomething();
&#125;
</code></pre>
<h4 id="目标接口实现类"><a href="#目标接口实现类" class="headerlink" title="目标接口实现类"></a>目标接口实现类</h4><pre><code class="java">/**
 * @author zhengyumin
 * @description target Object Impl
 * @date 2020-01-22 9:53 PM
 */
@Component
public class ServerImpl implements Server &#123;

    @Override
    public void doSomething() &#123;
        System.out.println(&quot;do something.....&quot;);
    &#125;
&#125;
</code></pre>
<h4 id="启动类"><a href="#启动类" class="headerlink" title="启动类"></a>启动类</h4><pre><code class="java">package aop;

import org.springframework.context.annotation.AnnotationConfigApplicationContext;

/**
 * @author zhengyumin
 * @description 启动器类
 * @date 2020-01-14 9:25 PM
 * @see AspectInterceptor
 */
public class AopStarter &#123;
    public static void main(String[] args) &#123;
        //scan package &#39;aop&#39;
        AnnotationConfigApplicationContext applicationContext =
                new AnnotationConfigApplicationContext(&quot;aop&quot;);
        //构建代理
        Server server = (Server) applicationContext.getBean(&quot;serverImpl&quot;);
        //执行拦截的方法
        server.doSomething();
    &#125;
&#125;
</code></pre>
<h4 id="执行结果"><a href="#执行结果" class="headerlink" title="执行结果"></a>执行结果</h4><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a><img src="http://tva1.sinaimg.cn/large/006tNbRwgy1gb6xoe1vkcj32ek0nyn87.jpg" alt="image-20200123234554918">总结</h2><p> 通过以上分析,我们知道了Aop的实现是通过代理的方式实现的,这里我们分为两部分讨论</p>
<p>一是代理类的创建</p>
<p>​	代理类的创建是通过BeanPostProcess(具体子类)的回调实现的,主要是从BeanFactory中找出切面(Aspect)类,并获取类中的通知(advice), 根据配置、目标类(是否接口、代理类)决定代理方式</p>
<p>二是代理类执行(我们以jdk代理的分析)</p>
<p>​	执行主要是实现了InvocationHandler,并按顺序执行chain调用链(advice),最后执行方法本身(join point)</p>
<p>​	</p>

      
       <hr><span style="font-style: italic;color: gray;"> 转载请注明来源，欢迎对文章中的引用来源进行考证，欢迎指出任何有错误或不够清晰的表达。可以在下面评论区评论，也可以邮件至 951488791@qq.com </span>
    </div>
</article>



<div class="article_copyright">
    <p><span class="copy-title">文章标题:</span>spring-aop</p>
    <p><span class="copy-title">字数:</span><span class="post-count">3.9k</span></p>
    <p><span class="copy-title">本文作者:</span><a  title="zhengyumin">zhengyumin</a></p>
    <p><span class="copy-title">发布时间:</span>2020-01-23, 23:54:29</p>
    <p><span class="copy-title">最后更新:</span>2020-04-29, 17:02:30</p>
    <span class="copy-title">原始链接:</span><a class="post-url" href="/2020/01/23/spring-aop/" title="spring-aop">http://yoursite.com/2020/01/23/spring-aop/</a>
    <p>
        <span class="copy-title">版权声明:</span><i class="fa fa-creative-commons"></i> <a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">&#34;署名-非商用-相同方式共享 4.0&#34;</a> 转载请保留原文链接及作者。
    </p>
</div>





    




    </div>
    <div class="copyright">
        <p class="footer-entry">
    ©2016-2022 zhengyumin
</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full" data-title="切换全屏 快捷键 s"><span class="min "></span></button>
<a class="" id="rocket" ></a>

    </div>
</div>

</body>
<script src="/js/jquery.pjax.js?v=1.1.0" ></script>

<script src="/js/script.js?v=1.1.0" ></script>
<script>
    var img_resize = 'default';
    function initArticle() {
        /*渲染对应的表格样式*/
        
            $("#post .pjax table").addClass("green_title");
        

        /*渲染打赏样式*/
        

        /*高亮代码块行号*/
        
        $('pre code').each(function(){
            var lines = $(this).text().trim().split('\n').length, widther='';
            if (lines>99) {
                widther = 'widther'
            }
            var $numbering = $('<ul/>').addClass('pre-numbering ' + widther).attr("unselectable","on");
            $(this).addClass('has-numbering ' + widther)
                    .parent()
                    .append($numbering);
            for(var i=1;i<=lines;i++){
                $numbering.append($('<li/>').text(i));
            }
        });
        

        /*访问数量*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*代码高亮，行号对齐*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
        
    }

    /*打赏页面隐藏与展示*/
    

</script>

<!--加入行号的高亮代码块样式-->

<style>
    pre{
        position: relative;
        margin-bottom: 24px;
        border-radius: 10px;
        border: 1px solid #e2dede;
        background: #FFF;
        overflow: hidden;
    }
    code.has-numbering{
        margin-left: 30px;
    }
    code.has-numbering.widther{
        margin-left: 35px;
    }
    .pre-numbering{
        margin: 0;
        position: absolute;
        top: 0;
        left: 0;
        width: 20px;
        padding: 0.5em 3px 0.7em 5px;
        border-right: 1px solid #C3CCD0;
        text-align: right;
        color: #AAA;
        background-color: ;
    }
    .pre-numbering.widther {
        width: 35px;
    }
</style>

<!--自定义样式设置-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*列表样式*/
    

    /* 背景图样式 */
    
    


    /*引用块样式*/
    

    /*文章列表背景图*/
    
    .nav-right:before {
        content: ' ';
        display: block;
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        opacity: 0.3;
        background: url("https://i.loli.net/2019/07/22/5d3521411f3f169375.png");
        background-repeat: no-repeat;
        background-position: 50% 0;
        -ms-background-size: cover;
        -o-background-size: cover;
        -moz-background-size: cover;
        -webkit-background-size: cover;
        background-size: cover;
    }
    

    
</style>







</html>
